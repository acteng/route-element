import{V as qn,W as Fn,X as We,r as ae,e as $,v as ue,t as _,Y as Un,S as le,i as ie,s as re,Z as On,_ as Qn,$ as x,a0 as Pn,L as Gn,b as oe,a as fe,c as M,m as T,d as de,f as I,g as Jn,h as Me,u as Te,j as Ie,k as De,l as be,y as k,z as B,q as w,w as v,a1 as Ye,M as Oe,A as F,a2 as Qe,U as W,p as Ge,B as te,a3 as Hn,o as V,F as G,a4 as Rn,O as g,a5 as st,Q as P,H as se,x as me,R as $e,N as _e,K as Kn,G as ge,D as je,E as Ve,a6 as Je,a7 as J,a8 as Ee,a9 as Ke,aa as Xn,ab as nt,ac as Zn,C as Xe,P as Bn,ad as Yn,I as Vn,T as Wn}from"./Layout-d1a27f85.js";function xn(n,e){const r=e.token={};function t(o,l,i,a){if(e.token!==r)return;e.resolved=a;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=a);const f=o&&(e.current=o)(s);let u=!1;e.block&&(e.blocks?e.blocks.forEach((d,c)=>{c!==l&&d&&(ae(),$(d,1,1,()=>{e.blocks[c]===d&&(e.blocks[c]=null)}),ue())}):e.block.d(1),f.c(),_(f,1),f.m(e.mount(),e.anchor),u=!0),e.block=f,e.blocks&&(e.blocks[l]=f),u&&Un()}if(qn(n)){const o=Fn();if(n.then(l=>{We(o),t(e.then,1,e.value,l),We(null)},l=>{if(We(o),t(e.catch,2,e.error,l),We(null),!e.hasCatch)throw l}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function er(n,e,r){const t=e.slice(),{resolved:o}=n;n.current===n.then&&(t[n.value]=o),n.current===n.catch&&(t[n.error]=o),n.block.p(t,r)}function tr(n,e,r){let t;const o=On();let{layer:l=void 0}=e;const{map:i}=Qn();x(n,i,u=>r(2,t=u));function a(u){o(u.type,{...u,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Pn(()=>{if(t)if(l)for(const u of s)t.off(u,l,a);else for(const u of f)t.off(u,a)}),n.$$set=u=>{"layer"in u&&r(1,l=u.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(l)for(const u of s)t.on(u,l,a);else for(const u of f)t.on(u,a)},[i,l,t]}class Sn extends le{constructor(e){super(),ie(this,e,tr,null,re,{layer:1})}}function nr(n){let e;const r=n[16].default,t=Me(r,n,n[24],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16777216)&&Te(t,r,o,o[24],e?De(r,o[24],l,null):Ie(o[24]),null)},i(o){e||(_(t,o),e=!0)},o(o){$(t,o),e=!1},d(o){t&&t.d(o)}}}function rr(n){let e,r,t;function o(i){n[17](i)}let l={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[nr]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.hovered=n[0]),e=new Gn({props:l}),oe.push(()=>fe(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){M(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.hovered=i[0],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function or(n,e,r){let{$$slots:t={},$$scope:o}=e,{id:l=Jn("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u=void 0}=e,{layout:d=void 0}=e,{filter:c=void 0}=e,{applyToClusters:m=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:A=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:b=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:y=!0}=e;function j(L){h=L,r(0,h)}function C(L){be.call(this,n,L)}function z(L){be.call(this,n,L)}function N(L){be.call(this,n,L)}function O(L){be.call(this,n,L)}function Y(L){be.call(this,n,L)}function X(L){be.call(this,n,L)}return n.$$set=L=>{"id"in L&&r(1,l=L.id),"source"in L&&r(2,i=L.source),"sourceLayer"in L&&r(3,a=L.sourceLayer),"beforeId"in L&&r(4,s=L.beforeId),"beforeLayerType"in L&&r(5,f=L.beforeLayerType),"paint"in L&&r(6,u=L.paint),"layout"in L&&r(7,d=L.layout),"filter"in L&&r(8,c=L.filter),"applyToClusters"in L&&r(9,m=L.applyToClusters),"minzoom"in L&&r(10,p=L.minzoom),"maxzoom"in L&&r(11,A=L.maxzoom),"hoverCursor"in L&&r(12,D=L.hoverCursor),"manageHoverState"in L&&r(13,b=L.manageHoverState),"hovered"in L&&r(0,h=L.hovered),"eventsIfTopMost"in L&&r(14,U=L.eventsIfTopMost),"interactive"in L&&r(15,y=L.interactive),"$$scope"in L&&r(24,o=L.$$scope)},[h,l,i,a,s,f,u,d,c,m,p,A,D,b,U,y,t,j,C,z,N,O,Y,X,o]}class Ne extends le{constructor(e){super(),ie(this,e,or,rr,re,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const lr=n=>({}),at=n=>({}),ir=n=>({}),ut=n=>({});function sr(n){let e,r,t,o;const l=n[3].sidebar,i=Me(l,n,n[2],ut),a=n[3].map,s=Me(a,n,n[2],at);return{c(){e=k("div"),i&&i.c(),r=B(),t=k("div"),s&&s.c()},m(f,u){w(f,e,u),i&&i.m(e,null),n[4](e),w(f,r,u),w(f,t,u),s&&s.m(t,null),n[5](t),o=!0},p(f,[u]){i&&i.p&&(!o||u&4)&&Te(i,l,f,f[2],o?De(l,f[2],u,ir):Ie(f[2]),ut),s&&s.p&&(!o||u&4)&&Te(s,a,f,f[2],o?De(a,f[2],u,lr):Ie(f[2]),at)},i(f){o||(_(i,f),_(s,f),o=!0)},o(f){$(i,f),$(s,f),o=!1},d(f){f&&(v(e),v(r),v(t)),i&&i.d(f),n[4](null),s&&s.d(f),n[5](null)}}}function ar(n,e,r){let t,o;x(n,ot,f=>r(0,t=f)),x(n,lt,f=>r(1,o=f));let{$$slots:l={},$$scope:i}=e;function a(f){oe[f?"unshift":"push"](()=>{t=f,ot.set(t)})}function s(f){oe[f?"unshift":"push"](()=>{o=f,lt.set(o)})}return n.$$set=f=>{"$$scope"in f&&r(2,i=f.$$scope)},[t,o,i,l,a,s]}class Se extends le{constructor(e){super(),ie(this,e,ar,sr,re,{})}}let ot=Ye(null),lt=Ye(null);const Ln="data:image/png;base64,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",Mn="data:image/png;base64,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";function ke(){return["","2","1","0","Critical"]}let Ce=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"];function ur(n){let e,r;const t=n[4].default,o=Me(t,n,n[6],null);return{c(){e=k("span"),o&&o.c(),F(e,"class","dot svelte-117v9mi"),Qe(e,"outline",n[3]),W(e,"background-color",n[3]?void 0:n[1]),W(e,"border-color",n[3]?n[1]:void 0),W(e,"width",n[2]),W(e,"height",n[2])},m(l,i){w(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&64)&&Te(o,t,l,l[6],r?De(t,l[6],i,null):Ie(l[6]),null),(!r||i&8)&&Qe(e,"outline",l[3]),i&10&&W(e,"background-color",l[3]?void 0:l[1]),i&10&&W(e,"border-color",l[3]?l[1]:void 0),i&4&&W(e,"width",l[2]),i&4&&W(e,"height",l[2])},i(l){r||(_(o,l),r=!0)},o(l){$(o,l),r=!1},d(l){l&&v(e),o&&o.d(l)}}}function cr(n){let e,r,t;function o(i){n[5](i)}let l={draggable:!0,$$slots:{default:[ur]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.lngLat=n[0]),e=new Oe({props:l}),oe.push(()=>fe(e,"lngLat",o)),{c(){M(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,[a]){const s={};a&78&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.lngLat=i[0],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function fr(n,e,r){let{$$slots:t={},$$scope:o}=e,{lngLat:l}=e,{color:i}=e,{radius:a="30px"}=e,{outline:s=!1}=e;function f(u){l=u,r(0,l)}return n.$$set=u=>{"lngLat"in u&&r(0,l=u.lngLat),"color"in u&&r(1,i=u.color),"radius"in u&&r(2,a=u.radius),"outline"in u&&r(3,s=u.outline),"$$scope"in u&&r(6,o=u.$$scope)},[l,i,a,s,t,f,o]}class it extends le{constructor(e){super(),ie(this,e,fr,cr,re,{lngLat:0,color:1,radius:2,outline:3})}}function ct(n,e,r){const t=n.slice();return t[10]=e[r][0],t[11]=e[r][1],t}function ft(n,e,r){const t=n.slice();return t[10]=e[r][0],t[11]=e[r][1],t}function dr(n){let e,r,t,o,l,i,a=V(n[3]),s=[];for(let f=0;f<a.length;f+=1)s[f]=dt(ct(n,a,f));return{c(){e=k("label"),r=G(n[2]),t=B(),o=k("select");for(let f=0;f<s.length;f+=1)s[f].c();n[0]===void 0&&Rn(()=>n[9].call(o))},m(f,u){w(f,e,u),g(e,r),g(e,t),g(e,o);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(o,null);st(o,n[0],!0),l||(i=[P(o,"change",n[9]),P(o,"change",n[6])],l=!0)},p(f,u){if(u&4&&se(r,f[2]),u&8){a=V(f[3]);let d;for(d=0;d<a.length;d+=1){const c=ct(f,a,d);s[d]?s[d].p(c,u):(s[d]=dt(c),s[d].c(),s[d].m(o,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=a.length}u&9&&st(o,f[0])},d(f){f&&v(e),me(s,f),l=!1,$e(i)}}}function mr(n){let e,r,t,o,l=V(n[3]),i=[];for(let a=0;a<l.length;a+=1)i[a]=mt(ft(n,l,a));return{c(){e=k("fieldset"),r=G(n[2]),t=B(),o=k("div");for(let a=0;a<i.length;a+=1)i[a].c();F(o,"class","svelte-1vb210n"),Qe(o,"horiz_radio",n[1]=="horiz-radio")},m(a,s){w(a,e,s),g(e,r),g(e,t),g(e,o);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(o,null)},p(a,s){if(s&4&&se(r,a[2]),s&9){l=V(a[3]);let f;for(f=0;f<l.length;f+=1){const u=ft(a,l,f);i[f]?i[f].p(u,s):(i[f]=mt(u),i[f].c(),i[f].m(o,null))}for(;f<i.length;f+=1)i[f].d(1);i.length=l.length}s&2&&Qe(o,"horiz_radio",a[1]=="horiz-radio")},d(a){a&&v(e),me(i,a)}}}function dt(n){let e,r=n[11]+"",t;return{c(){e=k("option"),t=G(r),e.__value=n[10],_e(e,e.__value)},m(o,l){w(o,e,l),g(e,t)},p:te,d(o){o&&v(e)}}}function mt(n){let e,r,t,o=n[11]+"",l,i,a,s,f;return a=Kn(n[8][0]),{c(){e=k("label"),r=k("input"),t=B(),l=G(o),i=B(),F(r,"type","radio"),r.__value=n[10],_e(r,r.__value),a.p(r)},m(u,d){w(u,e,d),g(e,r),r.checked=r.__value===n[0],g(e,t),g(e,l),g(e,i),s||(f=[P(r,"change",n[7]),P(r,"change",n[5])],s=!0)},p(u,d){d&9&&(r.checked=r.__value===u[0])},d(u){u&&v(e),a.r(),s=!1,$e(f)}}}function pr(n){let e;function r(l,i){if(l[1]=="horiz-radio"||l[1]=="vert-radio")return mr;if(l[1]=="dropdown")return dr}let t=r(n),o=t&&t(n);return{c(){o&&o.c(),e=Ge()},m(l,i){o&&o.m(l,i),w(l,e,i)},p(l,[i]){t===(t=r(l))&&o?o.p(l,i):(o&&o.d(1),o=t&&t(l),o&&(o.c(),o.m(e.parentNode,e)))},i:te,o:te,d(l){l&&v(e),o&&o.d(l)}}}function gr(n,e,r){let{k:t}=e,{label:o}=e,{value:l}=e,{choices:i}=e,a=i[0].length==2?i:i.map(m=>[m,m]);const s=[[]];function f(m){be.call(this,n,m)}function u(m){be.call(this,n,m)}function d(){l=this.__value,r(0,l),r(3,a)}function c(){l=Hn(this),r(0,l),r(3,a)}return n.$$set=m=>{"k"in m&&r(1,t=m.k),"label"in m&&r(2,o=m.label),"value"in m&&r(0,l=m.value),"choices"in m&&r(4,i=m.choices)},[l,t,o,a,i,f,u,d,s,c]}class ze extends le{constructor(e){super(),ie(this,e,gr,pr,re,{k:1,label:2,value:0,choices:4})}}let Pe=Ye(void 0),Q=Ye(_r());function ne(n){return{type:"FeatureCollection",features:n}}let R=Ye({kind:"neutral"});function _r(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if("links"in n&&"jats"in n&&"crossings"in n&&"side_roads"in n)return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[],side_roads:[]}}function pt(n){let e,r;return e=new ge({props:{data:ne(n[2].links),$$slots:{default:[hr]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=ne(t[2].links)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function hr(n){let e,r;return e=new je({props:{paint:{"line-color":n[1]?["get","color"]:"black","line-width":6}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"line-color":t[1]?["get","color"]:"black","line-width":6}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function gt(n){let e,r;return e=new ge({props:{data:ne(n[2].bus_stops),$$slots:{default:[$r]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=ne(t[2].bus_stops)),o&8&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function $r(n){let e,r;return e=new Ne({props:{layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function _t(n){let e,r;return e=new ge({props:{data:ne(n[2].crossings),$$slots:{default:[kr]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=ne(t[2].crossings)),o&8&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function kr(n){let e,r;return e=new Ne({props:{layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ht(n){let e,r;return e=new ge({props:{data:ne(n[2].jats),$$slots:{default:[br]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=ne(t[2].jats)),o&8&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function br(n){let e,r;return e=new Ve({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function $t(n){let e,r;return e=new ge({props:{data:ne(n[2].side_roads),$$slots:{default:[wr]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=ne(t[2].side_roads)),o&8&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function wr(n){let e,r;return e=new je({props:{paint:{"line-color":"black","line-width":3}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function vr(n){let e,r,t,o,l,i,a=n[0]!="links"&&pt(n),s=n[0]!="bus_stops"&&gt(n),f=n[0]!="crossings"&&_t(n),u=n[0]!="jats"&&ht(n),d=n[0]!="side_roads"&&$t(n);return{c(){a&&a.c(),e=B(),s&&s.c(),r=B(),f&&f.c(),t=B(),u&&u.c(),o=B(),d&&d.c(),l=Ge()},m(c,m){a&&a.m(c,m),w(c,e,m),s&&s.m(c,m),w(c,r,m),f&&f.m(c,m),w(c,t,m),u&&u.m(c,m),w(c,o,m),d&&d.m(c,m),w(c,l,m),i=!0},p(c,[m]){c[0]!="links"?a?(a.p(c,m),m&1&&_(a,1)):(a=pt(c),a.c(),_(a,1),a.m(e.parentNode,e)):a&&(ae(),$(a,1,1,()=>{a=null}),ue()),c[0]!="bus_stops"?s?(s.p(c,m),m&1&&_(s,1)):(s=gt(c),s.c(),_(s,1),s.m(r.parentNode,r)):s&&(ae(),$(s,1,1,()=>{s=null}),ue()),c[0]!="crossings"?f?(f.p(c,m),m&1&&_(f,1)):(f=_t(c),f.c(),_(f,1),f.m(t.parentNode,t)):f&&(ae(),$(f,1,1,()=>{f=null}),ue()),c[0]!="jats"?u?(u.p(c,m),m&1&&_(u,1)):(u=ht(c),u.c(),_(u,1),u.m(o.parentNode,o)):u&&(ae(),$(u,1,1,()=>{u=null}),ue()),c[0]!="side_roads"?d?(d.p(c,m),m&1&&_(d,1)):(d=$t(c),d.c(),_(d,1),d.m(l.parentNode,l)):d&&(ae(),$(d,1,1,()=>{d=null}),ue())},i(c){i||(_(a),_(s),_(f),_(u),_(d),i=!0)},o(c){$(a),$(s),$(f),$(u),$(d),i=!1},d(c){c&&(v(e),v(r),v(t),v(o),v(l)),a&&a.d(c),s&&s.d(c),f&&f.d(c),u&&u.d(c),d&&d.d(c)}}}function Ar(n,e,r){let t;x(n,Q,i=>r(2,t=i));let{except:o}=e,{showLinkColor:l=!1}=e;return n.$$set=i=>{"except"in i&&r(0,o=i.except),"showLinkColor"in i&&r(1,l=i.showLinkColor)},[o,l,t]}class qe extends le{constructor(e){super(),ie(this,e,Ar,vr,re,{except:0,showLinkColor:1})}}const{window:yr}=Je;function Cr(n){let e,r,t,o,l,i,a,s,f,u,d,c,m,p;function A(b){n[8](b)}let D={k:"horiz-radio",label:"ST20: bus stops",choices:ke()};return n[1].bus_stops[n[0]].properties.st20!==void 0&&(D.value=n[1].bus_stops[n[0]].properties.st20),u=new ze({props:D}),oe.push(()=>fe(u,"value",A)),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=B(),o=k("button"),o.textContent="Delete bus stop",l=B(),i=k("label"),a=G(`Name:
      `),s=k("input"),f=B(),M(u.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(b,h){w(b,e,h),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(i,a),g(i,s),_e(s,n[1].bus_stops[n[0]].properties.name),g(e,f),T(u,e,null),c=!0,m||(p=[P(r,"click",n[6]),P(o,"click",n[4]),P(s,"input",n[7])],m=!0)},p(b,h){h&3&&s.value!==b[1].bus_stops[b[0]].properties.name&&_e(s,b[1].bus_stops[b[0]].properties.name);const U={};!d&&h&3&&(d=!0,U.value=b[1].bus_stops[b[0]].properties.st20,de(()=>d=!1)),u.$set(U)},i(b){c||(_(u.$$.fragment,b),c=!0)},o(b){$(u.$$.fragment,b),c=!1},d(b){b&&v(e),I(u),m=!1,$e(p)}}}function jr(n){let e,r;return e=new Ne({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function zr(n){let e,r;return{c(){e=k("img"),Ke(e.src,r=Ln)||F(e,"src",r)},m(t,o){w(t,e,o)},p:te,d(t){t&&v(e)}}}function Br(n){let e,r,t,o,l,i,a,s;r=new qe({props:{except:"bus_stops"}}),o=new ge({props:{data:ne(n[1].bus_stops),generateId:!0,$$slots:{default:[jr]},$$scope:{ctx:n}}});function f(d){n[5](d)}let u={color:n[1].bus_stops[n[0]].properties.color,$$slots:{default:[zr]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(u.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),i=new it({props:u}),oe.push(()=>fe(i,"lngLat",f)),{c(){e=k("div"),M(r.$$.fragment),t=B(),M(o.$$.fragment),l=B(),M(i.$$.fragment),F(e,"slot","map")},m(d,c){w(d,e,c),T(r,e,null),g(e,t),T(o,e,null),g(e,l),T(i,e,null),s=!0},p(d,c){const m={};c&2&&(m.data=ne(d[1].bus_stops)),c&513&&(m.$$scope={dirty:c,ctx:d}),o.$set(m);const p={};c&3&&(p.color=d[1].bus_stops[d[0]].properties.color),c&512&&(p.$$scope={dirty:c,ctx:d}),!a&&c&3&&(a=!0,p.lngLat=d[1].bus_stops[d[0]].geometry.coordinates,de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(o.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(o.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&v(e),I(r),I(o),I(i)}}}function Sr(n){let e,r,t,o;return e=new Se({props:{$$slots:{map:[Br],sidebar:[Cr]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=P(yr,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(_(e.$$.fragment,l),r=!0)},o(l){$(e.$$.fragment,l),r=!1},d(l){I(e,l),t=!1,o()}}}function Lr(n,e,r){let t,o;x(n,Q,c=>r(1,t=c)),x(n,R,c=>r(2,o=c));let{idx:l}=e;function i(c){c.key=="Escape"&&J(R,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this bus stop?")&&(J(R,o={kind:"neutral"},o),await Ee(),t.bus_stops.splice(l,1),Q.set(t))}function s(c){n.$$.not_equal(t.bus_stops[l].geometry.coordinates,c)&&(t.bus_stops[l].geometry.coordinates=c,Q.set(t))}const f=()=>J(R,o={kind:"neutral"},o);function u(){t.bus_stops[l].properties.name=this.value,Q.set(t)}function d(c){n.$$.not_equal(t.bus_stops[l].properties.st20,c)&&(t.bus_stops[l].properties.st20=c,Q.set(t))}return n.$$set=c=>{"idx"in c&&r(0,l=c.idx)},[l,t,o,i,a,s,f,u,d]}class Mr extends le{constructor(e){super(),ie(this,e,Lr,Sr,re,{idx:0})}}const{window:Tr}=Je;function Ir(n){let e,r,t,o,l,i,a,s,f,u,d,c,m,p;function A(b){n[8](b)}let D={k:"horiz-radio",label:"SA10: pedestrian crossing speed",choices:ke()};return n[1].crossings[n[0]].properties.sa10!==void 0&&(D.value=n[1].crossings[n[0]].properties.sa10),u=new ze({props:D}),oe.push(()=>fe(u,"value",A)),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=B(),o=k("button"),o.textContent="Delete crossing",l=B(),i=k("label"),a=G(`Name:
      `),s=k("input"),f=B(),M(u.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(b,h){w(b,e,h),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(i,a),g(i,s),_e(s,n[1].crossings[n[0]].properties.name),g(e,f),T(u,e,null),c=!0,m||(p=[P(r,"click",n[6]),P(o,"click",n[4]),P(s,"input",n[7])],m=!0)},p(b,h){h&3&&s.value!==b[1].crossings[b[0]].properties.name&&_e(s,b[1].crossings[b[0]].properties.name);const U={};!d&&h&3&&(d=!0,U.value=b[1].crossings[b[0]].properties.sa10,de(()=>d=!1)),u.$set(U)},i(b){c||(_(u.$$.fragment,b),c=!0)},o(b){$(u.$$.fragment,b),c=!1},d(b){b&&v(e),I(u),m=!1,$e(p)}}}function Dr(n){let e,r;return e=new Ne({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"crossing","icon-size":1},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Er(n){let e,r;return{c(){e=k("img"),Ke(e.src,r=Mn)||F(e,"src",r)},m(t,o){w(t,e,o)},p:te,d(t){t&&v(e)}}}function Nr(n){let e,r,t,o,l,i,a,s;r=new qe({props:{except:"crossings"}}),o=new ge({props:{data:ne(n[1].crossings),generateId:!0,$$slots:{default:[Dr]},$$scope:{ctx:n}}});function f(d){n[5](d)}let u={color:n[1].crossings[n[0]].properties.color,$$slots:{default:[Er]},$$scope:{ctx:n}};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(u.lngLat=n[1].crossings[n[0]].geometry.coordinates),i=new it({props:u}),oe.push(()=>fe(i,"lngLat",f)),{c(){e=k("div"),M(r.$$.fragment),t=B(),M(o.$$.fragment),l=B(),M(i.$$.fragment),F(e,"slot","map")},m(d,c){w(d,e,c),T(r,e,null),g(e,t),T(o,e,null),g(e,l),T(i,e,null),s=!0},p(d,c){const m={};c&2&&(m.data=ne(d[1].crossings)),c&513&&(m.$$scope={dirty:c,ctx:d}),o.$set(m);const p={};c&3&&(p.color=d[1].crossings[d[0]].properties.color),c&512&&(p.$$scope={dirty:c,ctx:d}),!a&&c&3&&(a=!0,p.lngLat=d[1].crossings[d[0]].geometry.coordinates,de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(o.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(o.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&v(e),I(r),I(o),I(i)}}}function qr(n){let e,r,t,o;return e=new Se({props:{$$slots:{map:[Nr],sidebar:[Ir]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=P(Tr,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(_(e.$$.fragment,l),r=!0)},o(l){$(e.$$.fragment,l),r=!1},d(l){I(e,l),t=!1,o()}}}function Fr(n,e,r){let t,o;x(n,Q,c=>r(1,t=c)),x(n,R,c=>r(2,o=c));let{idx:l}=e;function i(c){c.key=="Escape"&&J(R,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this crossing?")&&(J(R,o={kind:"neutral"},o),await Ee(),t.crossings.splice(l,1),Q.set(t))}function s(c){n.$$.not_equal(t.crossings[l].geometry.coordinates,c)&&(t.crossings[l].geometry.coordinates=c,Q.set(t))}const f=()=>J(R,o={kind:"neutral"},o);function u(){t.crossings[l].properties.name=this.value,Q.set(t)}function d(c){n.$$.not_equal(t.crossings[l].properties.sa10,c)&&(t.crossings[l].properties.sa10=c,Q.set(t))}return n.$$set=c=>{"idx"in c&&r(0,l=c.idx)},[l,t,o,i,a,s,f,u,d]}class Ur extends le{constructor(e){super(),ie(this,e,Fr,qr,re,{idx:0})}}let kt="MZEJTanw3WpxRvt7qDfo";async function Or(n){return n?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await Qr(n)}&key=${n}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${kt}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${kt}`}async function Qr(n){try{let r=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB"})})).json();return"session"in r?r.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(r)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}const Pr="/route-element/assets/right-arrow-d8c7892c.svg";function bt(n){let e,r;const t=n[4].default,o=Me(t,n,n[3],null);return{c(){e=k("div"),o&&o.c(),F(e,"class","section svelte-zax3q3")},m(l,i){w(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&8)&&Te(o,t,l,l[3],r?De(t,l[3],i,null):Ie(l[3]),null)},i(l){r||(_(o,l),r=!0)},o(l){$(o,l),r=!1},d(l){l&&v(e),o&&o.d(l)}}}function Gr(n){let e,r,t,o,l,i,a,s,f,u,d,c,m=n[2]&&bt(n);return{c(){e=k("button"),r=k("div"),t=k("span"),o=G(n[0]),l=B(),i=k("img"),f=B(),m&&m.c(),F(i,"class","arrow svelte-zax3q3"),Ke(i.src,a=Pr)||F(i,"src",a),F(i,"alt",s="Select "+n[0]),F(r,"class","top-section section svelte-zax3q3"),Qe(r,"bordered",n[2]),F(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m(p,A){w(p,e,A),g(e,r),g(r,t),g(t,o),g(r,l),g(r,i),g(e,f),m&&m.m(e,null),u=!0,d||(c=[P(e,"click",n[5]),P(e,"mouseenter",n[6]),P(e,"mouseleave",n[7])],d=!0)},p(p,[A]){(!u||A&1)&&se(o,p[0]),(!u||A&1&&s!==(s="Select "+p[0]))&&F(i,"alt",s),(!u||A&4)&&Qe(r,"bordered",p[2]),p[2]?m?(m.p(p,A),A&4&&_(m,1)):(m=bt(p),m.c(),_(m,1),m.m(e,null)):m&&(ae(),$(m,1,1,()=>{m=null}),ue()),(!u||A&2)&&(e.disabled=p[1])},i(p){u||(_(m),u=!0)},o(p){$(m),u=!1},d(p){p&&v(e),m&&m.d(),d=!1,$e(c)}}}function Jr(n,e,r){let{$$slots:t={},$$scope:o}=e,{name:l}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(d){be.call(this,n,d)}function f(d){be.call(this,n,d)}function u(d){be.call(this,n,d)}return n.$$set=d=>{"name"in d&&r(0,l=d.name),"disabled"in d&&r(1,i=d.disabled),"hasSlot"in d&&r(2,a=d.hasSlot),"$$scope"in d&&r(3,o=d.$$scope)},[l,i,a,o,t,s,f,u]}class Tn extends le{constructor(e){super(),ie(this,e,Jr,Gr,re,{name:0,disabled:1,hasSlot:2})}}let Be={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const Hr=n=>({dialog:n&1}),wt=n=>({dialog:n[0]});function Rr(n){let e,r,t,o,l;const i=n[4].default,a=Me(i,n,n[3],wt);return{c(){e=k("dialog"),r=k("article"),a&&a.c(),e.open=!0},m(s,f){w(s,e,f),g(e,r),a&&a.m(r,null),n[6](e),t=!0,o||(l=[P(window,"click",n[1]),P(window,"keydown",n[2]),P(e,"close",n[5])],o=!0)},p(s,[f]){a&&a.p&&(!t||f&9)&&Te(a,i,s,s[3],t?De(i,s[3],f,Hr):Ie(s[3]),wt)},i(s){t||(_(a,s),t=!0)},o(s){$(a,s),t=!1},d(s){s&&v(e),a&&a.d(s),n[6](null),o=!1,$e(l)}}}function Kr(n,e,r){let{$$slots:t={},$$scope:o}=e,l;function i(u){l.open&&u.target==l&&l.close()}function a(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),l.close())}function s(u){be.call(this,n,u)}function f(u){oe[u?"unshift":"push"](()=>{l=u,r(0,l)})}return n.$$set=u=>{"$$scope"in u&&r(3,o=u.$$scope)},[l,i,a,o,t,s,f]}class In extends le{constructor(e){super(),ie(this,e,Kr,Rr,re,{})}}function Xr(n,e){let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}const Fe={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius â‰¥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},Dn=Object.keys(Fe);function tt(n){return Object.keys(Fe[n])}const Le="All movements";function vt(n,e){let r=[],t=Fe[n][e];t&&r.push({junctionType:n,movementType:e,...t});let o=Fe[n][Le];if(o&&e!=Le&&r.push({junctionType:n,movementType:Le,...o}),n=="Crossroads"){let l=Fe["Simple priority T-junction"][Le];l&&r.push({junctionType:"Simple priority T-junction",movementType:Le,...l})}if(n!="Any type of junction"){let l=Fe["Any type of junction"][Le];l&&r.push({junctionType:"Any type of junction",movementType:Le,...l})}return r}function At(n,e,r){const t=n.slice();return t[9]=e[r],t}function yt(n,e,r){const t=n.slice();return t[12]=e[r],t}function Ct(n,e,r){const t=n.slice();return t[12]=e[r],t}function jt(n,e,r){const t=n.slice();return t[12]=e[r],t}function zt(n){let e,r;return e=new In({props:{$$slots:{default:[Zr]},$$scope:{ctx:n}}}),e.$on("close",n[8]),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&524295&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Bt(n){let e,r,t;function o(i){n[6](i)}let l={k:"vert-radio",label:"Type of movement",choices:tt(n[1])};return n[2]!==void 0&&(l.value=n[2]),e=new ze({props:l}),oe.push(()=>fe(e,"value",o)),{c(){M(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,a){const s={};a&2&&(s.choices=tt(i[1])),!r&&a&4&&(r=!0,s.value=i[2],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function St(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=G(r)},m(o,l){w(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&se(t,r)},d(o){o&&v(e)}}}function Lt(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=G(r)},m(o,l){w(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&se(t,r)},d(o){o&&v(e)}}}function Mt(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=G(r)},m(o,l){w(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&se(t,r)},d(o){o&&v(e)}}}function Tt(n){let e,r,t=n[9].junctionType+"",o,l,i,a,s,f,u=n[9].movementType+"",d,c,m,p,A,D,b,h,U,y,j,C=V(n[9].scoreZero),z=[];for(let L=0;L<C.length;L+=1)z[L]=St(jt(n,C,L));let N=V(n[9].scoreOne),O=[];for(let L=0;L<N.length;L+=1)O[L]=Lt(Ct(n,N,L));let Y=V(n[9].scoreTwo),X=[];for(let L=0;L<Y.length;L+=1)X[L]=Mt(yt(n,Y,L));return{c(){e=k("tr"),r=k("td"),o=G(t),l=B(),i=k("br"),a=B(),s=k("br"),f=B(),d=G(u),c=B(),m=k("td"),p=k("ul");for(let L=0;L<z.length;L+=1)z[L].c();A=B(),D=k("td"),b=k("ul");for(let L=0;L<O.length;L+=1)O[L].c();h=B(),U=k("td"),y=k("ul");for(let L=0;L<X.length;L+=1)X[L].c();j=B(),F(r,"class","type-row svelte-k4kgn3"),F(m,"class","score-zero svelte-k4kgn3"),F(D,"class","score-one svelte-k4kgn3"),F(U,"class","score-two svelte-k4kgn3")},m(L,H){w(L,e,H),g(e,r),g(r,o),g(r,l),g(r,i),g(r,a),g(r,s),g(r,f),g(r,d),g(e,c),g(e,m),g(m,p);for(let S=0;S<z.length;S+=1)z[S]&&z[S].m(p,null);g(e,A),g(e,D),g(D,b);for(let S=0;S<O.length;S+=1)O[S]&&O[S].m(b,null);g(e,h),g(e,U),g(U,y);for(let S=0;S<X.length;S+=1)X[S]&&X[S].m(y,null);g(e,j)},p(L,H){if(H&6&&t!==(t=L[9].junctionType+"")&&se(o,t),H&6&&u!==(u=L[9].movementType+"")&&se(d,u),H&6){C=V(L[9].scoreZero);let S;for(S=0;S<C.length;S+=1){const he=jt(L,C,S);z[S]?z[S].p(he,H):(z[S]=St(he),z[S].c(),z[S].m(p,null))}for(;S<z.length;S+=1)z[S].d(1);z.length=C.length}if(H&6){N=V(L[9].scoreOne);let S;for(S=0;S<N.length;S+=1){const he=Ct(L,N,S);O[S]?O[S].p(he,H):(O[S]=Lt(he),O[S].c(),O[S].m(b,null))}for(;S<O.length;S+=1)O[S].d(1);O.length=N.length}if(H&6){Y=V(L[9].scoreTwo);let S;for(S=0;S<Y.length;S+=1){const he=yt(L,Y,S);X[S]?X[S].p(he,H):(X[S]=Mt(he),X[S].c(),X[S].m(y,null))}for(;S<X.length;S+=1)X[S].d(1);X.length=Y.length}},d(L){L&&v(e),me(z,L),me(O,L),me(X,L)}}}function Zr(n){let e,r,t,o,l,i,a,s,f=n[1],u,d,c,m,p,A,D,b,h;function U(N){n[5](N)}let y={k:"vert-radio",label:"Type of junction",choices:Dn};n[1]!==void 0&&(y.value=n[1]),i=new ze({props:y}),oe.push(()=>fe(i,"value",U)),i.$on("change",n[3]);let j=Bt(n),C=V(vt(n[1],n[2])),z=[];for(let N=0;N<C.length;N+=1)z[N]=Tt(At(n,C,N));return{c(){e=k("h1"),e.textContent="LTN 1/20 scoring guidance",r=B(),t=k("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,o=B(),l=k("div"),M(i.$$.fragment),s=B(),j.c(),u=B(),d=k("table"),c=k("tr"),c.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,m=B();for(let N=0;N<z.length;N+=1)z[N].c();p=B(),A=k("button"),A.textContent="OK",W(l,"display","flex"),W(l,"justify-content","space-between")},m(N,O){w(N,e,O),w(N,r,O),w(N,t,O),w(N,o,O),w(N,l,O),T(i,l,null),g(l,s),j.m(l,null),w(N,u,O),w(N,d,O),g(d,c),g(d,m);for(let Y=0;Y<z.length;Y+=1)z[Y]&&z[Y].m(d,null);w(N,p,O),w(N,A,O),D=!0,b||(h=P(A,"click",n[7]),b=!0)},p(N,O){const Y={};if(!a&&O&2&&(a=!0,Y.value=N[1],de(()=>a=!1)),i.$set(Y),O&2&&re(f,f=N[1])?(ae(),$(j,1,1,te),ue(),j=Bt(N),j.c(),_(j,1),j.m(l,null)):j.p(N,O),O&6){C=V(vt(N[1],N[2]));let X;for(X=0;X<C.length;X+=1){const L=At(N,C,X);z[X]?z[X].p(L,O):(z[X]=Tt(L),z[X].c(),z[X].m(d,null))}for(;X<z.length;X+=1)z[X].d(1);z.length=C.length}},i(N){D||(_(i.$$.fragment,N),_(j),D=!0)},o(N){$(i.$$.fragment,N),$(j),D=!1},d(N){N&&(v(e),v(r),v(t),v(o),v(l),v(u),v(d),v(p),v(A)),I(i),j.d(N),me(z,N),b=!1,h()}}}function Yr(n){let e,r,t,o,l,i,a=n[0]&&zt(n);return{c(){e=k("button"),e.textContent="LTN 1/20 scoring guidance",r=B(),a&&a.c(),t=Ge(),F(e,"class","secondary")},m(s,f){w(s,e,f),w(s,r,f),a&&a.m(s,f),w(s,t,f),o=!0,l||(i=P(e,"click",n[4]),l=!0)},p(s,[f]){s[0]?a?(a.p(s,f),f&1&&_(a,1)):(a=zt(s),a.c(),_(a,1),a.m(t.parentNode,t)):a&&(ae(),$(a,1,1,()=>{a=null}),ue())},i(s){o||(_(a),o=!0)},o(s){$(a),o=!1},d(s){s&&(v(e),v(r),v(t)),a&&a.d(s),l=!1,i()}}}function Vr(n,e,r){let t=!1,o=Dn[0],l=tt(o)[0];function i(){r(2,l=tt(o)[0])}const a=()=>r(0,t=!0);function s(c){o=c,r(1,o)}function f(c){l=c,r(2,l)}return[t,o,l,i,a,s,f,()=>r(0,t=!1),()=>r(0,t=!1)]}class Wr extends le{constructor(e){super(),ie(this,e,Vr,Yr,re,{})}}function It(n){let e,r;return e=new Wr({}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function xr(n){let e,r,t,o,l,i,a,s,f,u,d,c,m,p,A,D,b;function h(z){n[6](z)}let U={k:"horiz-radio",label:"User",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind!==void 0&&(U.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind),l=new ze({props:U}),oe.push(()=>fe(l,"value",h));let y=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind=="cycling"&&It();function j(z){n[7](z)}let C={k:"horiz-radio",label:"Score",choices:n[4]};return n[3].jats[n[0]].properties[n[1]].movements[n[2]].score!==void 0&&(C.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].score),f=new ze({props:C}),oe.push(()=>fe(f,"value",j)),{c(){e=k("label"),r=G(`Name
  `),t=k("input"),o=B(),M(l.$$.fragment),a=B(),y&&y.c(),s=B(),M(f.$$.fragment),d=B(),c=k("label"),m=G(`Comments
  `),p=k("textarea"),F(t,"type","text")},m(z,N){w(z,e,N),g(e,r),g(e,t),_e(t,n[3].jats[n[0]].properties[n[1]].movements[n[2]].name),w(z,o,N),T(l,z,N),w(z,a,N),y&&y.m(z,N),w(z,s,N),T(f,z,N),w(z,d,N),w(z,c,N),g(c,m),g(c,p),_e(p,n[3].jats[n[0]].properties[n[1]].movements[n[2]].notes),A=!0,D||(b=[P(t,"input",n[5]),P(p,"input",n[8])],D=!0)},p(z,[N]){N&15&&t.value!==z[3].jats[z[0]].properties[z[1]].movements[z[2]].name&&_e(t,z[3].jats[z[0]].properties[z[1]].movements[z[2]].name);const O={};!i&&N&15&&(i=!0,O.value=z[3].jats[z[0]].properties[z[1]].movements[z[2]].kind,de(()=>i=!1)),l.$set(O),z[3].jats[z[0]].properties[z[1]].movements[z[2]].kind=="cycling"?y?N&15&&_(y,1):(y=It(),y.c(),_(y,1),y.m(s.parentNode,s)):y&&(ae(),$(y,1,1,()=>{y=null}),ue());const Y={};!u&&N&15&&(u=!0,Y.value=z[3].jats[z[0]].properties[z[1]].movements[z[2]].score,de(()=>u=!1)),f.$set(Y),N&15&&_e(p,z[3].jats[z[0]].properties[z[1]].movements[z[2]].notes)},i(z){A||(_(l.$$.fragment,z),_(y),_(f.$$.fragment,z),A=!0)},o(z){$(l.$$.fragment,z),$(y),$(f.$$.fragment,z),A=!1},d(z){z&&(v(e),v(o),v(a),v(s),v(d),v(c)),I(l,z),y&&y.d(z),I(f,z),D=!1,$e(b)}}}function eo(n,e,r){let t;x(n,Q,c=>r(3,t=c));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(){t.jats[o].properties[l].movements[i].name=this.value,Q.set(t)}function f(c){n.$$.not_equal(t.jats[o].properties[l].movements[i].kind,c)&&(t.jats[o].properties[l].movements[i].kind=c,Q.set(t))}function u(c){n.$$.not_equal(t.jats[o].properties[l].movements[i].score,c)&&(t.jats[o].properties[l].movements[i].score=c,Q.set(t))}function d(){t.jats[o].properties[l].movements[i].notes=this.value,Q.set(t)}return n.$$set=c=>{"junctionIdx"in c&&r(0,o=c.junctionIdx),"stage"in c&&r(1,l=c.stage),"idx"in c&&r(2,i=c.idx)},[o,l,i,t,a,s,f,u,d]}class to extends le{constructor(e){super(),ie(this,e,eo,xr,re,{junctionIdx:0,stage:1,idx:2})}}function no(n){return n%(2*Math.PI)*180/Math.PI}function xe(n){return n%360*Math.PI/180}function Dt(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function En(n,e,r={}){if(r.final===!0)return ro(n,e);const t=Dt(n),o=Dt(e),l=xe(t[0]),i=xe(o[0]),a=xe(t[1]),s=xe(o[1]),f=Math.sin(i-l)*Math.cos(s),u=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return no(Math.atan2(f,u))}function ro(n,e){let r=En(e,n);return r=(r+180)%360,r}var Ue=En;function oo(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function lo(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Et(n[0])||!Et(n[1]))throw new Error("coordinates must contain numbers");return oo({type:"Point",coordinates:n},e,r)}function Et(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function io(n,e={}){const r=Xn(n),t=(r[0]+r[2])/2,o=(r[1]+r[3])/2;return lo([t,o],e.properties,e)}var so=io,we=63710088e-1,ao={centimeters:we*100,centimetres:we*100,degrees:360/(2*Math.PI),feet:we*3.28084,inches:we*39.37,kilometers:we/1e3,kilometres:we/1e3,meters:we,metres:we,miles:we/1609.344,millimeters:we*1e3,millimetres:we*1e3,nauticalmiles:we/1852,radians:1,yards:we*1.0936};function uo(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function co(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!qt(n[0])||!qt(n[1]))throw new Error("coordinates must contain numbers");return uo({type:"Point",coordinates:n},e,r)}function fo(n,e="kilometers"){const r=ao[e];if(!r)throw new Error(e+" units is invalid");return n/r}function Nt(n){return n%(2*Math.PI)*180/Math.PI}function rt(n){return n%360*Math.PI/180}function qt(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function mo(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function po(n,e,r,t={}){const o=mo(n),l=rt(o[0]),i=rt(o[1]),a=rt(r),s=fo(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),u=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(f)),d=Nt(u),c=Nt(f);return co([d,c],t.properties)}var Ze=po,ve=63710088e-1,go={centimeters:ve*100,centimetres:ve*100,degrees:360/(2*Math.PI),feet:ve*3.28084,inches:ve*39.37,kilometers:ve/1e3,kilometres:ve/1e3,meters:ve,metres:ve,miles:ve/1609.344,millimeters:ve*1e3,millimetres:ve*1e3,nauticalmiles:ve/1852,radians:1,yards:ve*1.0936};function _o(n,e="kilometers"){const r=go[e];if(!r)throw new Error(e+" units is invalid");return n*r}function et(n){return n%360*Math.PI/180}function Ft(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ho(n,e,r={}){var t=Ft(n),o=Ft(e),l=et(o[1]-t[1]),i=et(o[0]-t[0]),a=et(t[1]),s=et(o[1]),f=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return _o(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),r.units)}var $o=ho;function ko(n){let e=so({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,o)=>Ut(Ue(e,o.point))-Ut(Ue(e,t.point)));let r=[];for(let t=0;t<n.length;t++){let o=n[t],l=Ue(o.point,e),i=1;for(let a of wo(t,n.length)){let s=n[a],f=Ue(e,s.point),u=bo(o.point,e,i++),d=$o(o.point,e),c=Ze(u,.5*d,l).geometry.coordinates,m=Ze(c,.2*d,f).geometry.coordinates;r.push({point1:u,point2:c,point3:m,kind:"cycling",score:"X",name:`${o.name} to ${s.name}`,notes:""})}}return r}function bo(n,e,r){let t=.003,l=Ue(n,e)-90,i=t*r;return Ze(n,i,l).geometry.coordinates}function Ut(n){return(n+360)%360}function wo(n,e){let r=[];for(let t=n+1;t<e;t++)r.push(t);for(let t=0;t<n;t++)r.push(t);return r}const vo="/route-element/assets/movement-aa45473c.svg",Ao="/route-element/assets/pan-fbcec4cd.svg";function Ot(n,e,r){const t=n.slice();return t[31]=e[r],t[32]=e,t[33]=r,t}function Qt(n,e,r){const t=n.slice();return t[34]=e[r],t[35]=e,t[33]=r,t}function Pt(n){let e,r,t,o,l,i,a,s,f,u,d,c,m,p,A,D,b,h,U;function y(H,S){return H[0].mode=="select"?Co:yo}let j=y(n),C=j(n);function z(H,S){return H[0].mode=="new-arm"?zo:jo}let N=z(n),O=N(n);function Y(H,S){return H[0].mode=="new-movement"?So:Bo}let X=Y(n),L=X(n);return{c(){e=k("div"),r=k("button"),t=k("img"),l=B(),C.c(),i=B(),a=k("button"),s=nt("svg"),f=nt("circle"),u=nt("text"),d=G("A"),c=B(),O.c(),m=B(),p=k("button"),A=k("img"),b=B(),L.c(),Ke(t.src,o=Ao)||F(t,"src",o),F(t,"alt","Move map"),W(t,"vertical-align","middle"),F(r,"class","outline"),F(f,"cx","12"),F(f,"cy","12"),F(f,"r","12"),F(f,"fill","white"),F(u,"x","6"),F(u,"y","16"),F(u,"fill","#4472c4"),F(s,"width","24"),F(s,"height","24"),F(s,"xmlns","http://www.w3.org/2000/svg"),W(s,"vertical-align","middle"),F(a,"class","outline"),Ke(A.src,D=vo)||F(A,"src",D),F(A,"alt","New movement"),W(A,"vertical-align","middle"),F(p,"class","outline"),F(e,"class","control-panel svelte-l1e6xi")},m(H,S){w(H,e,S),g(e,r),g(r,t),g(r,l),C.m(r,null),g(e,i),g(e,a),g(a,s),g(s,f),g(s,u),g(u,d),g(a,c),O.m(a,null),g(e,m),g(e,p),g(p,A),g(p,b),L.m(p,null),h||(U=[P(r,"click",function(){Zn(n[4])&&n[4].apply(this,arguments)}),P(a,"click",n[12]),P(p,"click",n[13])],h=!0)},p(H,S){n=H,j!==(j=y(n))&&(C.d(1),C=j(n),C&&(C.c(),C.m(r,null))),N!==(N=z(n))&&(O.d(1),O=N(n),O&&(O.c(),O.m(a,null))),X!==(X=Y(n))&&(L.d(1),L=X(n),L&&(L.c(),L.m(p,null)))},d(H){H&&v(e),C.d(),O.d(),L.d(),h=!1,$e(U)}}}function yo(n){let e;return{c(){e=G("Move map")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function Co(n){let e;return{c(){e=k("b"),e.textContent="Move map"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function jo(n){let e;return{c(){e=G("New arm")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function zo(n){let e;return{c(){e=k("b"),e.textContent="New arm"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function Bo(n){let e;return{c(){e=G("New movement")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function So(n){let e;return{c(){e=k("b"),e.textContent="New movement"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function Lo(n){let e;return{c(){e=k("span"),e.textContent=`${Po(n[33])}`,F(e,"class","dot svelte-l1e6xi"),W(e,"color","#4472c4"),W(e,"background-color","white")},m(r,t){w(r,e,t)},p:te,d(r){r&&v(e)}}}function Gt(n){let e,r,t;function o(s){n[14](s,n[34])}function l(){return n[15](n[33])}function i(){return n[16](n[33])}let a={draggable:!0,$$slots:{default:[Lo]},$$scope:{ctx:n}};return n[34].point!==void 0&&(a.lngLat=n[34].point),e=new Oe({props:a}),oe.push(()=>fe(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){M(e.$$.fragment)},m(s,f){T(e,s,f),t=!0},p(s,f){n=s;const u={};f[1]&32&&(u.$$scope={dirty:f,ctx:n}),!r&&f[0]&38&&(r=!0,u.lngLat=n[34].point,de(()=>r=!1)),e.$set(u)},i(s){t||(_(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){I(e,s)}}}function Mo(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-l1e6xi"),W(e,"background-color",n[7][n[31].score]),W(e,"opacity",n[31].kind=="walking & wheeling"?"0%":"100%")},m(r,t){w(r,e,t)},p(r,t){t[0]&38&&W(e,"background-color",r[7][r[31].score]),t[0]&38&&W(e,"opacity",r[31].kind=="walking & wheeling"?"0%":"100%")},d(r){r&&v(e)}}}function To(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-l1e6xi"),W(e,"background-color",n[7][n[31].score])},m(r,t){w(r,e,t)},p(r,t){t[0]&38&&W(e,"background-color",r[7][r[31].score])},d(r){r&&v(e)}}}function Io(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-l1e6xi"),W(e,"background-color",n[7][n[31].score]),W(e,"opacity","0%")},m(r,t){w(r,e,t)},p(r,t){t[0]&38&&W(e,"background-color",r[7][r[31].score])},d(r){r&&v(e)}}}function Jt(n){let e,r,t,o,l,i,a,s,f;function u(C){n[17](C,n[31])}function d(){return n[18](n[33])}function c(){return n[19](n[33])}let m={draggable:!0,$$slots:{default:[Mo]},$$scope:{ctx:n}};n[31].point1!==void 0&&(m.lngLat=n[31].point1),e=new Oe({props:m}),oe.push(()=>fe(e,"lngLat",u)),e.$on("dragend",d),e.$on("click",c);function p(C){n[20](C,n[31])}function A(){return n[21](n[33])}function D(){return n[22](n[33])}let b={draggable:!0,$$slots:{default:[To]},$$scope:{ctx:n}};n[31].point2!==void 0&&(b.lngLat=n[31].point2),o=new Oe({props:b}),oe.push(()=>fe(o,"lngLat",p)),o.$on("dragend",A),o.$on("click",D);function h(C){n[23](C,n[31])}function U(){return n[24](n[33])}function y(){return n[25](n[33])}let j={draggable:!0,$$slots:{default:[Io]},$$scope:{ctx:n}};return n[31].point3!==void 0&&(j.lngLat=n[31].point3),a=new Oe({props:j}),oe.push(()=>fe(a,"lngLat",h)),a.$on("dragend",U),a.$on("click",y),{c(){M(e.$$.fragment),t=B(),M(o.$$.fragment),i=B(),M(a.$$.fragment)},m(C,z){T(e,C,z),w(C,t,z),T(o,C,z),w(C,i,z),T(a,C,z),f=!0},p(C,z){n=C;const N={};z[0]&38|z[1]&32&&(N.$$scope={dirty:z,ctx:n}),!r&&z[0]&38&&(r=!0,N.lngLat=n[31].point1,de(()=>r=!1)),e.$set(N);const O={};z[0]&38|z[1]&32&&(O.$$scope={dirty:z,ctx:n}),!l&&z[0]&38&&(l=!0,O.lngLat=n[31].point2,de(()=>l=!1)),o.$set(O);const Y={};z[0]&38|z[1]&32&&(Y.$$scope={dirty:z,ctx:n}),!s&&z[0]&38&&(s=!0,Y.lngLat=n[31].point3,de(()=>s=!1)),a.$set(Y)},i(C){f||(_(e.$$.fragment,C),_(o.$$.fragment,C),_(a.$$.fragment,C),f=!0)},o(C){$(e.$$.fragment,C),$(o.$$.fragment,C),$(a.$$.fragment,C),f=!1},d(C){C&&(v(t),v(i)),I(e,C),I(o,C),I(a,C)}}}function Do(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=G(e)},m(t,o){w(t,r,o)},p(t,o){o[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&se(r,e)},d(t){t&&v(r)}}}function Eo(n){let e,r;return e=new Bn({props:{$$slots:{default:[Do,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o[0]&1073741824|o[1]&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function No(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=G(e)},m(t,o){w(t,r,o)},p(t,o){o[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&se(r,e)},d(t){t&&v(r)}}}function qo(n){let e,r;return e=new Bn({props:{$$slots:{default:[No,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o[0]&1073741824|o[1]&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Fo(n){let e,r,t,o,l,i;return e=new je({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Xe(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Eo]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new je({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Xe(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[qo]},$$scope:{ctx:n}}}),t.$on("click",n[9]),l=new Ne({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){M(e.$$.fragment),r=B(),M(t.$$.fragment),o=B(),M(l.$$.fragment)},m(a,s){T(e,a,s),w(a,r,s),T(t,a,s),w(a,o,s),T(l,a,s),i=!0},p(a,s){const f={};s[1]&32&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const u={};s[1]&32&&(u.$$scope={dirty:s,ctx:a}),t.$set(u)},i(a){i||(_(e.$$.fragment,a),_(t.$$.fragment,a),_(l.$$.fragment,a),i=!0)},o(a){$(e.$$.fragment,a),$(t.$$.fragment,a),$(l.$$.fragment,a),i=!1},d(a){a&&(v(r),v(o)),I(e,a),I(t,a),I(l,a)}}}function Uo(n){let e,r,t,o;return e=new je({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Ve({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){M(e.$$.fragment),r=B(),M(t.$$.fragment)},m(l,i){T(e,l,i),w(l,r,i),T(t,l,i),o=!0},p:te,i(l){o||(_(e.$$.fragment,l),_(t.$$.fragment,l),o=!0)},o(l){$(e.$$.fragment,l),$(t.$$.fragment,l),o=!1},d(l){l&&v(r),I(e,l),I(t,l)}}}function Oo(n){let e,r,t,o,l,i,a,s,f;e=new Sn({}),e.$on("click",n[8]);let u=n[0].mode!="editing"&&Pt(n),d=V(n[5].jats[n[1]].properties[n[2]].arms),c=[];for(let b=0;b<d.length;b+=1)c[b]=Gt(Qt(n,d,b));const m=b=>$(c[b],1,1,()=>{c[b]=null});let p=V(n[5].jats[n[1]].properties[n[2]].movements),A=[];for(let b=0;b<p.length;b+=1)A[b]=Jt(Ot(n,p,b));const D=b=>$(A[b],1,1,()=>{A[b]=null});return i=new ge({props:{data:n[10](n[5]),$$slots:{default:[Fo]},$$scope:{ctx:n}}}),s=new ge({props:{data:n[6],$$slots:{default:[Uo]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=B(),u&&u.c(),t=B();for(let b=0;b<c.length;b+=1)c[b].c();o=B();for(let b=0;b<A.length;b+=1)A[b].c();l=B(),M(i.$$.fragment),a=B(),M(s.$$.fragment)},m(b,h){T(e,b,h),w(b,r,h),u&&u.m(b,h),w(b,t,h);for(let U=0;U<c.length;U+=1)c[U]&&c[U].m(b,h);w(b,o,h);for(let U=0;U<A.length;U+=1)A[U]&&A[U].m(b,h);w(b,l,h),T(i,b,h),w(b,a,h),T(s,b,h),f=!0},p(b,h){if(b[0].mode!="editing"?u?u.p(b,h):(u=Pt(b),u.c(),u.m(t.parentNode,t)):u&&(u.d(1),u=null),h[0]&46){d=V(b[5].jats[b[1]].properties[b[2]].arms);let j;for(j=0;j<d.length;j+=1){const C=Qt(b,d,j);c[j]?(c[j].p(C,h),_(c[j],1)):(c[j]=Gt(C),c[j].c(),_(c[j],1),c[j].m(o.parentNode,o))}for(ae(),j=d.length;j<c.length;j+=1)m(j);ue()}if(h[0]&174){p=V(b[5].jats[b[1]].properties[b[2]].movements);let j;for(j=0;j<p.length;j+=1){const C=Ot(b,p,j);A[j]?(A[j].p(C,h),_(A[j],1)):(A[j]=Jt(C),A[j].c(),_(A[j],1),A[j].m(l.parentNode,l))}for(ae(),j=p.length;j<A.length;j+=1)D(j);ue()}const U={};h[0]&32&&(U.data=b[10](b[5])),h[1]&32&&(U.$$scope={dirty:h,ctx:b}),i.$set(U);const y={};h[0]&64&&(y.data=b[6]),h[1]&32&&(y.$$scope={dirty:h,ctx:b}),s.$set(y)},i(b){if(!f){_(e.$$.fragment,b);for(let h=0;h<d.length;h+=1)_(c[h]);for(let h=0;h<p.length;h+=1)_(A[h]);_(i.$$.fragment,b),_(s.$$.fragment,b),f=!0}},o(b){$(e.$$.fragment,b),c=c.filter(Boolean);for(let h=0;h<c.length;h+=1)$(c[h]);A=A.filter(Boolean);for(let h=0;h<A.length;h+=1)$(A[h]);$(i.$$.fragment,b),$(s.$$.fragment,b),f=!1},d(b){b&&(v(r),v(t),v(o),v(l),v(a)),I(e,b),u&&u.d(b),me(c,b),me(A,b),I(i,b),I(s,b)}}}function Qo(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function Po(n){return String.fromCharCode(n+"A".charCodeAt(0))}function Go(n,e,r){let t,o,l;x(n,Q,q=>r(5,o=q)),x(n,Pe,q=>r(26,l=q));let{junctionIdx:i}=e,{stage:a}=e,{mode:s}=e,{hoveringSidebar:f}=e,{select:u}=e,{stopEditing:d}=e,c={0:Be.red.background,1:Be.amber.background,2:Be.green.background,X:Be.critical.background};function m(q,K,ye){let ce={type:"FeatureCollection",features:[]},E=K.mode=="editing"?K.id:ye;return E!=null&&(E.kind=="arm"?ce.features.push(Qo(q.jats[i].properties[a].arms[E.idx],E.idx)):ce.features.push(b(q.jats[i].properties[a].movements[E.idx],E.idx))),ce}async function p(q){if(l){for(let K of l.queryRenderedFeatures(q.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await d();return}s.mode=="new-arm"?(J(Q,o.jats[i].properties[a].arms=[...o.jats[i].properties[a].arms,{point:q.detail.lngLat.toArray(),name:""}],o),await u({kind:"arm",idx:o.jats[i].properties[a].arms.length-1})):(J(Q,o.jats[i].properties[a].movements=[...o.jats[i].properties[a].movements,{point1:q.detail.lngLat.toArray(),point2:Ze(q.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Ze(q.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await u({kind:"movement",idx:o.jats[i].properties[a].movements.length-1}))}}}async function A(q){await u({kind:"movement",idx:q.detail.features[0].id})}function D(q){let K={type:"FeatureCollection",features:q.jats[i].properties[a].movements.map((ye,ce)=>b(ye,ce))};for(let ye of q.jats[i].properties[a].movements)if(K.features.push(h(ye,K.features.length)),ye.kind=="walking & wheeling"){let ce={...ye,point1:ye.point3,point3:ye.point1};K.features.push(h(ce,K.features.length))}return K}function b(q,K){return{type:"Feature",id:K,properties:{name:q.name,kind:q.kind,color:c[q.score]},geometry:{type:"LineString",coordinates:[q.point1,q.point2,q.point3]}}}function h(q,K){return{type:"Feature",id:K,properties:{kind:q.kind,color:c[q.score],angle:Ue(q.point2,q.point3)},geometry:{type:"Point",coordinates:q.point3}}}const U=()=>r(0,s={mode:"new-arm"}),y=()=>r(0,s={mode:"new-movement"});function j(q,K){n.$$.not_equal(K.point,q)&&(K.point=q,Q.set(o))}const C=q=>u({kind:"arm",idx:q}),z=q=>u({kind:"arm",idx:q});function N(q,K){n.$$.not_equal(K.point1,q)&&(K.point1=q,Q.set(o))}const O=q=>u({kind:"movement",idx:q}),Y=q=>u({kind:"movement",idx:q});function X(q,K){n.$$.not_equal(K.point2,q)&&(K.point2=q,Q.set(o))}const L=q=>u({kind:"movement",idx:q}),H=q=>u({kind:"movement",idx:q});function S(q,K){n.$$.not_equal(K.point3,q)&&(K.point3=q,Q.set(o))}const he=q=>u({kind:"movement",idx:q}),pe=q=>u({kind:"movement",idx:q});return n.$$set=q=>{"junctionIdx"in q&&r(1,i=q.junctionIdx),"stage"in q&&r(2,a=q.stage),"mode"in q&&r(0,s=q.mode),"hoveringSidebar"in q&&r(11,f=q.hoveringSidebar),"select"in q&&r(3,u=q.select),"stopEditing"in q&&r(4,d=q.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&2081&&r(6,t=m(o,s,f))},[s,i,a,u,d,o,t,c,p,A,D,f,U,y,j,C,z,N,O,Y,X,L,H,S,he,pe]}class Jo extends le{constructor(e){super(),ie(this,e,Go,Oo,re,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function Ht(n){if(n.movements.length==0)return"No movements added";let e=0,r=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],r+=2;let t=e/r*100;return`${Math.round(t)}%`}const{window:Ho}=Je;function Rt(n,e,r){const t=n.slice();t[27]=e[r],t[30]=r;const o=t[14][t[27].score];return t[28]=o,t}function Kt(n,e,r){const t=n.slice();return t[31]=e[r],t[30]=r,t}function Ro(n){let e,r,t,o,l,i,a,s,f;return{c(){e=k("button"),e.textContent="Done",r=B(),t=k("button"),t.textContent="Delete",o=B(),l=k("label"),i=G(`Arm name
        `),a=k("input"),F(a,"type","text")},m(u,d){w(u,e,d),w(u,r,d),w(u,t,d),w(u,o,d),w(u,l,d),g(l,i),g(l,a),_e(a,n[5].jats[n[0]].properties[n[1]].arms[n[2].id.idx].name),s||(f=[P(e,"click",n[23]),P(t,"click",n[10]),P(a,"input",n[24])],s=!0)},p(u,d){d[0]&39&&a.value!==u[5].jats[u[0]].properties[u[1]].arms[u[2].id.idx].name&&_e(a,u[5].jats[u[0]].properties[u[1]].arms[u[2].id.idx].name)},i:te,o:te,d(u){u&&(v(e),v(r),v(t),v(o),v(l)),s=!1,$e(f)}}}function Ko(n){let e,r,t,o,l,i,a,s;return e=new to({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),{c(){M(e.$$.fragment),r=B(),t=k("button"),t.textContent="Save",o=B(),l=k("button"),l.textContent="Delete"},m(f,u){T(e,f,u),w(f,r,u),w(f,t,u),w(f,o,u),w(f,l,u),i=!0,a||(s=[P(t,"click",n[9]),P(l,"click",n[10])],a=!0)},p(f,u){const d={};u[0]&1&&(d.junctionIdx=f[0]),u[0]&2&&(d.stage=f[1]),u[0]&4&&(d.idx=f[2].id.idx),e.$set(d)},i(f){i||(_(e.$$.fragment,f),i=!0)},o(f){$(e.$$.fragment,f),i=!1},d(f){f&&(v(r),v(t),v(o),v(l)),I(e,f),a=!1,$e(s)}}}function Xo(n){let e,r,t,o,l,i,a,s,f,u,d,c,m,p=n[5].jats[n[0]].properties.name+"",A,D,b=Ht(n[5].jats[n[0]].properties[n[1]])+"",h,U,y,j,C,z,N,O,Y,X,L,H=V(n[5].jats[n[0]].properties[n[1]].arms),S=[];for(let E=0;E<H.length;E+=1)S[E]=Xt(Kt(n,H,E));const he=E=>$(S[E],1,1,()=>{S[E]=null});let pe=n[5].jats[n[0]].properties[n[7]].arms.length>0&&Zt(n),q=V(n[5].jats[n[0]].properties[n[1]].movements),K=[];for(let E=0;E<q.length;E+=1)K[E]=Yt(Rt(n,q,E));const ye=E=>$(K[E],1,1,()=>{K[E]=null});let ce=n[5].jats[n[0]].properties[n[7]].movements.length>0&&Vt(n);return{c(){e=k("button"),e.textContent="Done",r=B(),t=k("h3"),t.textContent="Arms",o=B();for(let E=0;E<S.length;E+=1)S[E].c();l=B(),pe&&pe.c(),i=B(),a=k("h3"),a.textContent="Movements",s=B(),f=k("p"),u=G("Total JAT score for "),d=G(n[1]),c=G(` junction
        `),m=k("i"),A=G(p),D=G(`
        : `),h=G(b),U=B(),y=k("button"),j=G("Generate cycling movements between all arms"),z=B();for(let E=0;E<K.length;E+=1)K[E].c();N=B(),ce&&ce.c(),O=Ge(),F(y,"class","secondary"),y.disabled=C=n[5].jats[n[0]].properties[n[1]].arms.length<2},m(E,Z){w(E,e,Z),w(E,r,Z),w(E,t,Z),w(E,o,Z);for(let ee=0;ee<S.length;ee+=1)S[ee]&&S[ee].m(E,Z);w(E,l,Z),pe&&pe.m(E,Z),w(E,i,Z),w(E,a,Z),w(E,s,Z),w(E,f,Z),g(f,u),g(f,d),g(f,c),g(f,m),g(m,A),g(f,D),g(f,h),w(E,U,Z),w(E,y,Z),g(y,j),w(E,z,Z);for(let ee=0;ee<K.length;ee+=1)K[ee]&&K[ee].m(E,Z);w(E,N,Z),ce&&ce.m(E,Z),w(E,O,Z),Y=!0,X||(L=[P(e,"click",n[16]),P(y,"click",n[15])],X=!0)},p(E,Z){if(Z[0]&299){H=V(E[5].jats[E[0]].properties[E[1]].arms);let ee;for(ee=0;ee<H.length;ee+=1){const Re=Kt(E,H,ee);S[ee]?(S[ee].p(Re,Z),_(S[ee],1)):(S[ee]=Xt(Re),S[ee].c(),_(S[ee],1),S[ee].m(l.parentNode,l))}for(ae(),ee=H.length;ee<S.length;ee+=1)he(ee);ue()}if(E[5].jats[E[0]].properties[E[7]].arms.length>0?pe?pe.p(E,Z):(pe=Zt(E),pe.c(),pe.m(i.parentNode,i)):pe&&(pe.d(1),pe=null),(!Y||Z[0]&2)&&se(d,E[1]),(!Y||Z[0]&33)&&p!==(p=E[5].jats[E[0]].properties.name+"")&&se(A,p),(!Y||Z[0]&35)&&b!==(b=Ht(E[5].jats[E[0]].properties[E[1]])+"")&&se(h,b),(!Y||Z[0]&35&&C!==(C=E[5].jats[E[0]].properties[E[1]].arms.length<2))&&(y.disabled=C),Z[0]&16683){q=V(E[5].jats[E[0]].properties[E[1]].movements);let ee;for(ee=0;ee<q.length;ee+=1){const Re=Rt(E,q,ee);K[ee]?(K[ee].p(Re,Z),_(K[ee],1)):(K[ee]=Yt(Re),K[ee].c(),_(K[ee],1),K[ee].m(N.parentNode,N))}for(ae(),ee=q.length;ee<K.length;ee+=1)ye(ee);ue()}E[5].jats[E[0]].properties[E[7]].movements.length>0?ce?ce.p(E,Z):(ce=Vt(E),ce.c(),ce.m(O.parentNode,O)):ce&&(ce.d(1),ce=null)},i(E){if(!Y){for(let Z=0;Z<H.length;Z+=1)_(S[Z]);for(let Z=0;Z<q.length;Z+=1)_(K[Z]);Y=!0}},o(E){S=S.filter(Boolean);for(let Z=0;Z<S.length;Z+=1)$(S[Z]);K=K.filter(Boolean);for(let Z=0;Z<K.length;Z+=1)$(K[Z]);Y=!1},d(E){E&&(v(e),v(r),v(t),v(o),v(l),v(i),v(a),v(s),v(f),v(U),v(y),v(z),v(N),v(O)),me(S,E),pe&&pe.d(E),me(K,E),ce&&ce.d(E),X=!1,$e(L)}}}function Xt(n){let e,r;function t(){return n[17](n[30])}function o(){return n[18](n[30])}return e=new Tn({props:{name:`${Wt(n[30])} - ${n[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[19]),{c(){M(e.$$.fragment)},m(l,i){T(e,l,i),r=!0},p(l,i){n=l;const a={};i[0]&35&&(a.name=`${Wt(n[30])} - ${n[31].name||"Unnamed arm"}`),e.$set(a)},i(l){r||(_(e.$$.fragment,l),r=!0)},o(l){$(e.$$.fragment,l),r=!1},d(l){I(e,l)}}}function Zt(n){let e,r,t;return{c(){e=k("button"),e.textContent=`Copy arms from ${n[7]}`,F(e,"class","secondary")},m(o,l){w(o,e,l),r||(t=P(e,"click",n[12]),r=!0)},p:te,d(o){o&&v(e),r=!1,t()}}}function Zo(n){let e,r,t,o=n[27].score+"",l,i,a,s=xt(n[27].kind)+"",f;return{c(){e=k("div"),r=k("span"),t=G("Score: "),l=G(o),i=B(),a=k("span"),f=G(s),W(r,"padding","4px"),W(r,"color",n[28].font),W(r,"background-color",n[28].background),W(e,"width","100%"),W(e,"display","flex"),W(e,"justify-content","space-between")},m(u,d){w(u,e,d),g(e,r),g(r,t),g(r,l),g(e,i),g(e,a),g(a,f)},p(u,d){d[0]&35&&o!==(o=u[27].score+"")&&se(l,o),d[0]&35&&W(r,"color",u[28].font),d[0]&35&&W(r,"background-color",u[28].background),d[0]&35&&s!==(s=xt(u[27].kind)+"")&&se(f,s)},d(u){u&&v(e)}}}function Yt(n){let e,r;function t(){return n[20](n[30])}function o(){return n[21](n[30])}return e=new Tn({props:{name:n[27].name||"Unnamed movement",$$slots:{default:[Zo]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[22]),{c(){M(e.$$.fragment)},m(l,i){T(e,l,i),r=!0},p(l,i){n=l;const a={};i[0]&35&&(a.name=n[27].name||"Unnamed movement"),i[0]&35|i[1]&4&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(l){r||(_(e.$$.fragment,l),r=!0)},o(l){$(e.$$.fragment,l),r=!1},d(l){I(e,l)}}}function Vt(n){let e,r,t;return{c(){e=k("button"),e.textContent=`Copy movements from ${n[7]}`,F(e,"class","secondary")},m(o,l){w(o,e,l),r||(t=P(e,"click",n[13]),r=!0)},p:te,d(o){o&&v(e),r=!1,t()}}}function Yo(n){let e,r,t,o,l=n[5].jats[n[0]].properties.name+"",i,a,s,f,u;const d=[Xo,Ko,Ro],c=[];function m(p,A){return p[2].mode!="editing"?0:p[2].id.kind=="movement"?1:2}return s=m(n),f=c[s]=d[s](n),{c(){e=k("div"),r=k("h2"),t=G(n[1]),o=G(" JAT for "),i=G(l),a=B(),f.c(),F(e,"slot","sidebar")},m(p,A){w(p,e,A),g(e,r),g(r,t),g(r,o),g(r,i),g(e,a),c[s].m(e,null),n[25](e),u=!0},p(p,A){(!u||A[0]&2)&&se(t,p[1]),(!u||A[0]&33)&&l!==(l=p[5].jats[p[0]].properties.name+"")&&se(i,l);let D=s;s=m(p),s===D?c[s].p(p,A):(ae(),$(c[D],1,1,()=>{c[D]=null}),ue(),f=c[s],f?f.p(p,A):(f=c[s]=d[s](p),f.c()),_(f,1),f.m(e,null))},i(p){u||(_(f),u=!0)},o(p){$(f),u=!1},d(p){p&&v(e),c[s].d(),n[25](null)}}}function Vo(n){let e,r;return e=new Ve({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o[0]&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Wo(n){let e,r,t,o,l,i,a;return r=new qe({props:{except:"jats"}}),o=new ge({props:{data:ne(n[5].jats),generateId:!0,$$slots:{default:[Vo]},$$scope:{ctx:n}}}),i=new Jo({props:{junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],select:n[8],stopEditing:n[9]}}),{c(){e=k("div"),M(r.$$.fragment),t=B(),M(o.$$.fragment),l=B(),M(i.$$.fragment),F(e,"slot","map")},m(s,f){w(s,e,f),T(r,e,null),g(e,t),T(o,e,null),g(e,l),T(i,e,null),a=!0},p(s,f){const u={};f[0]&32&&(u.data=ne(s[5].jats)),f[0]&1|f[1]&4&&(u.$$scope={dirty:f,ctx:s}),o.$set(u);const d={};f[0]&1&&(d.junctionIdx=s[0]),f[0]&2&&(d.stage=s[1]),f[0]&4&&(d.mode=s[2]),f[0]&8&&(d.hoveringSidebar=s[3]),i.$set(d)},i(s){a||(_(r.$$.fragment,s),_(o.$$.fragment,s),_(i.$$.fragment,s),a=!0)},o(s){$(r.$$.fragment,s),$(o.$$.fragment,s),$(i.$$.fragment,s),a=!1},d(s){s&&v(e),I(r),I(o),I(i)}}}function xo(n){let e,r,t,o;return e=new Se({props:{$$slots:{map:[Wo],sidebar:[Yo]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=P(Ho,"keydown",n[11]),t=!0)},p(l,i){const a={};i[0]&127|i[1]&4&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(_(e.$$.fragment,l),r=!0)},o(l){$(e.$$.fragment,l),r=!1},d(l){I(e,l),t=!1,o()}}}function Wt(n){return String.fromCharCode(n+"A".charCodeAt(0))}function xt(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function el(n,e,r){let t,o;x(n,Q,S=>r(5,t=S)),x(n,R,S=>r(6,o=S));let{junctionIdx:l}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s={mode:"select"},f=null,u=null,d;async function c(S){f=d.scrollTop,r(2,s={mode:"editing",id:S}),r(3,u=null),await Ee(),r(4,d.scrollTop=0,d)}async function m(){r(2,s={mode:"select"}),f!=null&&(await Ee(),r(4,d.scrollTop=f,d),f=null)}function p(){s.mode=="editing"&&window.confirm(`Delete this ${s.id.kind}?`)&&(s.id.kind=="movement"?(t.jats[l].properties[i].movements.splice(s.id.idx,1),Q.set(t)):(t.jats[l].properties[i].arms.splice(s.id.idx,1),Q.set(t)),m())}function A(S){if(s.mode!="editing")return;let he=S.target.tagName,pe=he=="INPUT"||he=="TEXTAREA";S.key=="Escape"||S.key=="Enter"&&!pe?(S.stopPropagation(),m()):S.key=="Delete"&&!pe&&(S.stopPropagation(),p())}function D(){t.jats[l].properties[i].arms.length>0&&!window.confirm("Overwrite arms?")||(J(Q,t.jats[l].properties[i].arms=JSON.parse(JSON.stringify(t.jats[l].properties[a].arms)),t),Q.set(t))}function b(){t.jats[l].properties[i].movements.length>0&&!window.confirm("Overwrite movements?")||(J(Q,t.jats[l].properties[i].movements=JSON.parse(JSON.stringify(t.jats[l].properties[a].movements)),t),Q.set(t))}let h={0:Be.red,1:Be.amber,2:Be.green,X:Be.critical};function U(){if(t.jats[l].properties[i].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let S=t.jats[l].properties[i].movements.filter(he=>he.kind=="walking & wheeling");J(Q,t.jats[l].properties[i].movements=[...S,...ko(t.jats[l].properties[i].arms)],t)}const y=()=>J(R,o={kind:"edit-jat",idx:l},o),j=S=>c({kind:"arm",idx:S}),C=S=>r(3,u={kind:"arm",idx:S}),z=()=>r(3,u=null),N=S=>c({kind:"movement",idx:S}),O=S=>r(3,u={kind:"movement",idx:S}),Y=()=>r(3,u=null),X=()=>r(2,s={mode:"select"});function L(){t.jats[l].properties[i].arms[s.id.idx].name=this.value,Q.set(t)}function H(S){oe[S?"unshift":"push"](()=>{d=S,r(4,d)})}return n.$$set=S=>{"junctionIdx"in S&&r(0,l=S.junctionIdx),"stage"in S&&r(1,i=S.stage)},[l,i,s,u,d,t,o,a,c,m,p,A,D,b,h,U,y,j,C,z,N,O,Y,X,L,H]}class tl extends le{constructor(e){super(),ie(this,e,el,xo,re,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:nl}=Je;function rl(n){let e,r,t,o,l,i,a,s,f,u,d,c,m,p;return{c(){e=k("div"),r=k("button"),r.textContent="Done",t=B(),o=k("button"),o.textContent="Delete JAT",l=B(),i=k("label"),a=G(`Name:
      `),s=k("input"),f=B(),u=k("button"),u.textContent="Existing",d=B(),c=k("button"),c.textContent="Proposed",F(s,"type","text"),F(e,"slot","sidebar")},m(A,D){w(A,e,D),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(i,a),g(i,s),_e(s,n[1].jats[n[0]].properties.name),g(e,f),g(e,u),g(e,d),g(e,c),m||(p=[P(r,"click",n[6]),P(o,"click",n[4]),P(s,"input",n[7]),P(u,"click",n[8]),P(c,"click",n[9])],m=!0)},p(A,D){D&3&&s.value!==A[1].jats[A[0]].properties.name&&_e(s,A[1].jats[A[0]].properties.name)},d(A){A&&v(e),m=!1,$e(p)}}}function ol(n){let e,r;return e=new Ve({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ll(n){let e,r,t,o,l,i,a,s;r=new qe({props:{except:"jats"}}),o=new ge({props:{data:ne(n[1].jats),generateId:!0,$$slots:{default:[ol]},$$scope:{ctx:n}}});function f(d){n[5](d)}let u={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(u.lngLat=n[1].jats[n[0]].geometry.coordinates),i=new it({props:u}),oe.push(()=>fe(i,"lngLat",f)),{c(){e=k("div"),M(r.$$.fragment),t=B(),M(o.$$.fragment),l=B(),M(i.$$.fragment),F(e,"slot","map")},m(d,c){w(d,e,c),T(r,e,null),g(e,t),T(o,e,null),g(e,l),T(i,e,null),s=!0},p(d,c){const m={};c&2&&(m.data=ne(d[1].jats)),c&1025&&(m.$$scope={dirty:c,ctx:d}),o.$set(m);const p={};c&3&&(p.color=d[1].jats[d[0]].properties.color),!a&&c&3&&(a=!0,p.lngLat=d[1].jats[d[0]].geometry.coordinates,de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(o.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(o.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&v(e),I(r),I(o),I(i)}}}function il(n){let e,r,t,o;return e=new Se({props:{$$slots:{map:[ll],sidebar:[rl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=P(nl,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(_(e.$$.fragment,l),r=!0)},o(l){$(e.$$.fragment,l),r=!1},d(l){I(e,l),t=!1,o()}}}function sl(n,e,r){let t,o;x(n,Q,m=>r(1,t=m)),x(n,R,m=>r(2,o=m));let{idx:l}=e;function i(m){m.key=="Escape"&&J(R,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this JAT?")&&(J(R,o={kind:"neutral"},o),await Ee(),t.jats.splice(l,1),Q.set(t))}function s(m){n.$$.not_equal(t.jats[l].geometry.coordinates,m)&&(t.jats[l].geometry.coordinates=m,Q.set(t))}const f=()=>J(R,o={kind:"neutral"},o);function u(){t.jats[l].properties.name=this.value,Q.set(t)}const d=()=>J(R,o={kind:"edit-jat-detail",idx:l,stage:"existing"},o),c=()=>J(R,o={kind:"edit-jat-detail",idx:l,stage:"proposed"},o);return n.$$set=m=>{"idx"in m&&r(0,l=m.idx)},[l,t,o,i,a,s,f,u,d,c]}class al extends le{constructor(e){super(),ie(this,e,sl,il,re,{idx:0})}}function en(n,e,r){const t=n.slice();return t[3]=e[r],t[4]=e,t[5]=r,t}function ul(n){let e,r;return{c(){e=k("span"),r=B(),F(e,"class","dot svelte-jgyhla")},m(t,o){w(t,e,o),w(t,r,o)},p:te,d(t){t&&(v(e),v(r))}}}function tn(n){let e,r,t;function o(i){n[2](i,n[3],n[4],n[5])}let l={draggable:!0,$$slots:{default:[ul]},$$scope:{ctx:n}};return n[3]!==void 0&&(l.lngLat=n[3]),e=new Oe({props:l}),oe.push(()=>fe(e,"lngLat",o)),{c(){M(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,a){n=i;const s={};a&64&&(s.$$scope={dirty:a,ctx:n}),!r&&a&1&&(r=!0,s.lngLat=n[3],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function cl(n){let e,r,t,o;e=new Sn({}),e.$on("click",n[1]);let l=V(n[0].geometry.coordinates),i=[];for(let s=0;s<l.length;s+=1)i[s]=tn(en(n,l,s));const a=s=>$(i[s],1,1,()=>{i[s]=null});return{c(){M(e.$$.fragment),r=B();for(let s=0;s<i.length;s+=1)i[s].c();t=Ge()},m(s,f){T(e,s,f),w(s,r,f);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(s,f);w(s,t,f),o=!0},p(s,[f]){if(f&1){l=V(s[0].geometry.coordinates);let u;for(u=0;u<l.length;u+=1){const d=en(s,l,u);i[u]?(i[u].p(d,f),_(i[u],1)):(i[u]=tn(d),i[u].c(),_(i[u],1),i[u].m(t.parentNode,t))}for(ae(),u=l.length;u<i.length;u+=1)a(u);ue()}},i(s){if(!o){_(e.$$.fragment,s);for(let f=0;f<l.length;f+=1)_(i[f]);o=!0}},o(s){$(e.$$.fragment,s),i=i.filter(Boolean);for(let f=0;f<i.length;f+=1)$(i[f]);o=!1},d(s){s&&(v(r),v(t)),I(e,s),me(i,s)}}}function fl(n,e,r){let{f:t}=e;function o(i){t.geometry.coordinates.push(i.detail.lngLat.toArray()),r(0,t)}function l(i,a,s,f){s[f]=i,r(0,t)}return n.$$set=i=>{"f"in i&&r(0,t=i.f)},[t,o,l]}class Nn extends le{constructor(e){super(),ie(this,e,fl,cl,re,{f:0})}}function dl(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Ce[n%Ce.length],answers:Array(Ae.length).fill("")}}}let Ae=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:ke()},{name:"SA04",description:"trip hazards",choices:ke()},{name:"SA05",description:"kerbside activity",choices:ke()},{name:"SA08",description:"motor traffic speed",choices:ke()},{name:"SA09",description:"motor traffic volume",choices:ke()},{name:"SA11",description:"footway widths",choices:ke()},{name:"SA12",description:"effective width next to tram lines",choices:ke()},{name:"SA13",description:"crossing angle of tram/train rails",choices:ke()},{name:"SA14",description:"cycling surface and maintenance defects",choices:ke()},{name:"SA15",description:"WW surface and maintenance defects",choices:ke()},{name:"SA16",description:"guard railing",choices:ke()}];const{window:ml}=Je;function nn(n,e,r){const t=n.slice();return t[10]=e[r],t[11]=e,t[12]=r,t}function rn(n){let e;return{c(){e=k("p"),e.textContent="A link needs at least two points"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function on(n){let e,r,t;function o(i){n[9](i,n[12])}let l={k:"horiz-radio",label:`${n[10].name}: ${n[10].description}`,choices:n[10].choices};return n[1].links[n[0]].properties.answers[n[12]]!==void 0&&(l.value=n[1].links[n[0]].properties.answers[n[12]]),e=new ze({props:l}),oe.push(()=>fe(e,"value",o)),{c(){M(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,a){n=i;const s={};!r&&a&3&&(r=!0,s.value=n[1].links[n[0]].properties.answers[n[12]],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function pl(n){let e,r,t,o,l,i,a,s,f,u,d,c,m,p,A,D=!n[2]&&rn(),b=V(Ae),h=[];for(let y=0;y<b.length;y+=1)h[y]=on(nn(n,b,y));const U=y=>$(h[y],1,1,()=>{h[y]=null});return{c(){e=k("div"),r=k("button"),t=G("Done"),l=B(),i=k("button"),i.textContent="Delete link",a=B(),D&&D.c(),s=B(),f=k("label"),u=G(`Name:
      `),d=k("input"),c=B();for(let y=0;y<h.length;y+=1)h[y].c();r.disabled=o=!n[2],F(d,"type","text"),F(e,"slot","sidebar")},m(y,j){w(y,e,j),g(e,r),g(r,t),g(e,l),g(e,i),g(e,a),D&&D.m(e,null),g(e,s),g(e,f),g(f,u),g(f,d),_e(d,n[1].links[n[0]].properties.name),g(e,c);for(let C=0;C<h.length;C+=1)h[C]&&h[C].m(e,null);m=!0,p||(A=[P(r,"click",n[7]),P(i,"click",n[5]),P(d,"input",n[8])],p=!0)},p(y,j){if((!m||j&4&&o!==(o=!y[2]))&&(r.disabled=o),y[2]?D&&(D.d(1),D=null):D||(D=rn(),D.c(),D.m(e,s)),j&3&&d.value!==y[1].links[y[0]].properties.name&&_e(d,y[1].links[y[0]].properties.name),j&3){b=V(Ae);let C;for(C=0;C<b.length;C+=1){const z=nn(y,b,C);h[C]?(h[C].p(z,j),_(h[C],1)):(h[C]=on(z),h[C].c(),_(h[C],1),h[C].m(e,null))}for(ae(),C=b.length;C<h.length;C+=1)U(C);ue()}},i(y){if(!m){for(let j=0;j<b.length;j+=1)_(h[j]);m=!0}},o(y){h=h.filter(Boolean);for(let j=0;j<h.length;j+=1)$(h[j]);m=!1},d(y){y&&v(e),D&&D.d(),me(h,y),p=!1,$e(A)}}}function gl(n){let e,r;return e=new je({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function _l(n){let e,r,t,o,l,i,a,s;r=new qe({props:{except:"links"}}),o=new ge({props:{data:ne(n[1].links),generateId:!0,$$slots:{default:[gl]},$$scope:{ctx:n}}});function f(d){n[6](d)}let u={};return n[1].links[n[0]]!==void 0&&(u.f=n[1].links[n[0]]),i=new Nn({props:u}),oe.push(()=>fe(i,"f",f)),{c(){e=k("div"),M(r.$$.fragment),t=B(),M(o.$$.fragment),l=B(),M(i.$$.fragment),F(e,"slot","map")},m(d,c){w(d,e,c),T(r,e,null),g(e,t),T(o,e,null),g(e,l),T(i,e,null),s=!0},p(d,c){const m={};c&2&&(m.data=ne(d[1].links)),c&8193&&(m.$$scope={dirty:c,ctx:d}),o.$set(m);const p={};!a&&c&3&&(a=!0,p.f=d[1].links[d[0]],de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(o.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(o.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&v(e),I(r),I(o),I(i)}}}function hl(n){let e,r,t,o;return e=new Se({props:{$$slots:{map:[_l],sidebar:[pl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=P(ml,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&8207&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(_(e.$$.fragment,l),r=!0)},o(l){$(e.$$.fragment,l),r=!1},d(l){I(e,l),t=!1,o()}}}function $l(n,e,r){let t,o,l;x(n,Q,m=>r(1,o=m)),x(n,R,m=>r(3,l=m));let{idx:i}=e;function a(m){m.key=="Escape"&&t&&J(R,l={kind:"neutral"},l)}async function s(){window.confirm("Really delete this link?")&&(J(R,l={kind:"neutral"},l),await Ee(),o.links.splice(i,1),Q.set(o))}function f(m){n.$$.not_equal(o.links[i],m)&&(o.links[i]=m,Q.set(o))}const u=()=>J(R,l={kind:"neutral"},l);function d(){o.links[i].properties.name=this.value,Q.set(o)}function c(m,p){n.$$.not_equal(o.links[i].properties.answers[p],m)&&(o.links[i].properties.answers[p]=m,Q.set(o))}return n.$$set=m=>{"idx"in m&&r(0,i=m.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(2,t=o.links[i].geometry.coordinates.length>=2)},[i,o,t,l,a,s,f,u,d,c]}class kl extends le{constructor(e){super(),ie(this,e,$l,hl,re,{idx:0})}}function ln(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function sn(n){let e,r,t=n[6].properties.name+"",o,l,i,a,s,f;function u(c){n[5](c,n[6])}let d={k:"horiz-radio",label:"",choices:Ae[n[0]].choices};return n[6].properties.answers[n[0]]!==void 0&&(d.value=n[6].properties.answers[n[0]]),i=new ze({props:d}),oe.push(()=>fe(i,"value",u)),{c(){e=k("li"),r=k("span"),o=G(t),l=B(),M(i.$$.fragment),s=B(),W(r,"color",n[6].properties.color)},m(c,m){w(c,e,m),g(e,r),g(r,o),g(e,l),T(i,e,null),g(e,s),f=!0},p(c,m){n=c,(!f||m&4)&&t!==(t=n[6].properties.name+"")&&se(o,t),m&4&&W(r,"color",n[6].properties.color);const p={};m&1&&(p.choices=Ae[n[0]].choices),!a&&m&5&&(a=!0,p.value=n[6].properties.answers[n[0]],de(()=>a=!1)),i.$set(p)},i(c){f||(_(i.$$.fragment,c),f=!0)},o(c){$(i.$$.fragment,c),f=!1},d(c){c&&v(e),I(i)}}}function bl(n){let e,r,t,o,l=Ae[n[0]].name+"",i,a,s=Ae[n[0]].description+"",f,u,d,c,m,p,A=V(n[2].links),D=[];for(let h=0;h<A.length;h+=1)D[h]=sn(ln(n,A,h));const b=h=>$(D[h],1,1,()=>{D[h]=null});return{c(){e=k("div"),r=k("button"),r.textContent="Done",t=B(),o=k("h2"),i=G(l),a=G(": "),f=G(s),u=B(),d=k("ol");for(let h=0;h<D.length;h+=1)D[h].c();F(e,"slot","sidebar")},m(h,U){w(h,e,U),g(e,r),g(e,t),g(e,o),g(o,i),g(o,a),g(o,f),g(e,u),g(e,d);for(let y=0;y<D.length;y+=1)D[y]&&D[y].m(d,null);c=!0,m||(p=P(r,"click",n[4]),m=!0)},p(h,U){if((!c||U&1)&&l!==(l=Ae[h[0]].name+"")&&se(i,l),(!c||U&1)&&s!==(s=Ae[h[0]].description+"")&&se(f,s),U&5){A=V(h[2].links);let y;for(y=0;y<A.length;y+=1){const j=ln(h,A,y);D[y]?(D[y].p(j,U),_(D[y],1)):(D[y]=sn(j),D[y].c(),_(D[y],1),D[y].m(d,null))}for(ae(),y=A.length;y<D.length;y+=1)b(y);ue()}},i(h){if(!c){for(let U=0;U<A.length;U+=1)_(D[U]);c=!0}},o(h){D=D.filter(Boolean);for(let U=0;U<D.length;U+=1)$(D[U]);c=!1},d(h){h&&v(e),me(D,h),m=!1,p()}}}function wl(n){let e,r,t;return r=new qe({props:{showLinkColor:!0,except:""}}),{c(){e=k("div"),M(r.$$.fragment),F(e,"slot","map")},m(o,l){w(o,e,l),T(r,e,null),t=!0},p:te,i(o){t||(_(r.$$.fragment,o),t=!0)},o(o){$(r.$$.fragment,o),t=!1},d(o){o&&v(e),I(r)}}}function vl(n){let e,r,t,o;return e=new Se({props:{$$slots:{map:[wl],sidebar:[bl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=P(window,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(_(e.$$.fragment,l),r=!0)},o(l){$(e.$$.fragment,l),r=!1},d(l){I(e,l),t=!1,o()}}}function Al(n,e,r){let t,o;x(n,R,f=>r(1,t=f)),x(n,Q,f=>r(2,o=f));let{qIdx:l}=e;function i(f){f.key=="Escape"&&J(R,t={kind:"neutral"},t)}const a=()=>J(R,t={kind:"neutral"},t);function s(f,u){n.$$.not_equal(u.properties.answers[l],f)&&(u.properties.answers[l]=f,Q.set(o))}return n.$$set=f=>{"qIdx"in f&&r(0,l=f.qIdx)},[l,t,o,i,a,s]}class yl extends le{constructor(e){super(),ie(this,e,Al,vl,re,{qIdx:0})}}function Cl(n){let e,r,t,o;const l=n[2].default,i=Me(l,n,n[1],null);return{c(){e=k("a"),i&&i.c(),F(e,"href","#"),W(e,"color",n[0])},m(a,s){w(a,e,s),i&&i.m(e,null),r=!0,t||(o=P(e,"click",Yn(n[3])),t=!0)},p(a,[s]){i&&i.p&&(!r||s&2)&&Te(i,l,a,a[1],r?De(l,a[1],s,null):Ie(a[1]),null),s&1&&W(e,"color",a[0])},i(a){r||(_(i,a),r=!0)},o(a){$(i,a),r=!1},d(a){a&&v(e),i&&i.d(a),t=!1,o()}}}function jl(n,e,r){let{$$slots:t={},$$scope:o}=e,{color:l=void 0}=e;function i(a){be.call(this,n,a)}return n.$$set=a=>{"color"in a&&r(0,l=a.color),"$$scope"in a&&r(1,o=a.$$scope)},[l,o,t,i]}class He extends le{constructor(e){super(),ie(this,e,jl,Cl,re,{color:0})}}function zl(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Ce[n%Ce.length],st20:""}}}function an(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function Bl(n){let e=n[5].properties.name+"",r;return{c(){r=G(e)},m(t,o){w(t,r,o)},p(t,o){o&1&&e!==(e=t[5].properties.name+"")&&se(r,e)},d(t){t&&v(r)}}}function un(n){let e,r,t,o;function l(){return n[3](n[7])}return r=new He({props:{color:n[5].properties.color,$$slots:{default:[Bl]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=B()},m(i,a){w(i,e,a),T(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(_(r.$$.fragment,i),o=!0)},o(i){$(r.$$.fragment,i),o=!1},d(i){i&&v(e),I(r)}}}function Sl(n){let e,r,t,o,l,i,a,s,f=V(n[0].bus_stops),u=[];for(let c=0;c<f.length;c+=1)u[c]=un(an(n,f,c));const d=c=>$(u[c],1,1,()=>{u[c]=null});return{c(){e=G(`Bus stops:

`),r=k("div"),t=k("button"),t.textContent="New bus stop",o=B(),l=k("ol");for(let c=0;c<u.length;c+=1)u[c].c()},m(c,m){w(c,e,m),w(c,r,m),g(r,t),w(c,o,m),w(c,l,m);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(l,null);i=!0,a||(s=P(t,"click",n[2]),a=!0)},p(c,[m]){if(m&3){f=V(c[0].bus_stops);let p;for(p=0;p<f.length;p+=1){const A=an(c,f,p);u[p]?(u[p].p(A,m),_(u[p],1)):(u[p]=un(A),u[p].c(),_(u[p],1),u[p].m(l,null))}for(ae(),p=f.length;p<u.length;p+=1)d(p);ue()}},i(c){if(!i){for(let m=0;m<f.length;m+=1)_(u[m]);i=!0}},o(c){u=u.filter(Boolean);for(let m=0;m<u.length;m+=1)$(u[m]);i=!1},d(c){c&&(v(e),v(r),v(o),v(l)),me(u,c),a=!1,s()}}}function Ll(n,e,r){let t,o,l;x(n,Q,s=>r(0,t=s)),x(n,R,s=>r(1,o=s)),x(n,Pe,s=>r(4,l=s));function i(){if(!l)return;let s=zl(t.bus_stops.length,l.getCenter().toArray());J(Q,t.bus_stops=[...t.bus_stops,s],t),J(R,o={kind:"edit-bus-stop",idx:t.bus_stops.length-1},o)}return[t,o,i,s=>J(R,o={kind:"edit-bus-stop",idx:s},o)]}let Ml=class extends le{constructor(e){super(),ie(this,e,Ll,Sl,re,{})}};function Tl(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:Ce[n%Ce.length],sa10:""}}}function cn(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function Il(n){let e=n[5].properties.name+"",r;return{c(){r=G(e)},m(t,o){w(t,r,o)},p(t,o){o&1&&e!==(e=t[5].properties.name+"")&&se(r,e)},d(t){t&&v(r)}}}function fn(n){let e,r,t,o;function l(){return n[3](n[7])}return r=new He({props:{color:n[5].properties.color,$$slots:{default:[Il]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=B()},m(i,a){w(i,e,a),T(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(_(r.$$.fragment,i),o=!0)},o(i){$(r.$$.fragment,i),o=!1},d(i){i&&v(e),I(r)}}}function Dl(n){let e,r,t,o,l,i,a,s,f=V(n[0].crossings),u=[];for(let c=0;c<f.length;c+=1)u[c]=fn(cn(n,f,c));const d=c=>$(u[c],1,1,()=>{u[c]=null});return{c(){e=G(`Crossings:

`),r=k("div"),t=k("button"),t.textContent="New crossing",o=B(),l=k("ol");for(let c=0;c<u.length;c+=1)u[c].c()},m(c,m){w(c,e,m),w(c,r,m),g(r,t),w(c,o,m),w(c,l,m);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(l,null);i=!0,a||(s=P(t,"click",n[2]),a=!0)},p(c,[m]){if(m&3){f=V(c[0].crossings);let p;for(p=0;p<f.length;p+=1){const A=cn(c,f,p);u[p]?(u[p].p(A,m),_(u[p],1)):(u[p]=fn(A),u[p].c(),_(u[p],1),u[p].m(l,null))}for(ae(),p=f.length;p<u.length;p+=1)d(p);ue()}},i(c){if(!i){for(let m=0;m<f.length;m+=1)_(u[m]);i=!0}},o(c){u=u.filter(Boolean);for(let m=0;m<u.length;m+=1)$(u[m]);i=!1},d(c){c&&(v(e),v(r),v(o),v(l)),me(u,c),a=!1,s()}}}function El(n,e,r){let t,o,l;x(n,Q,s=>r(0,t=s)),x(n,R,s=>r(1,o=s)),x(n,Pe,s=>r(4,l=s));function i(){if(!l)return;let s=Tl(t.crossings.length,l.getCenter().toArray());J(Q,t.crossings=[...t.crossings,s],t),J(R,o={kind:"edit-crossing",idx:t.crossings.length-1},o)}return[t,o,i,s=>J(R,o={kind:"edit-crossing",idx:s},o)]}let Nl=class extends le{constructor(e){super(),ie(this,e,El,Dl,re,{})}};function ql(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Ce[n%Ce.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function dn(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function Fl(n){let e=n[5].properties.name+"",r;return{c(){r=G(e)},m(t,o){w(t,r,o)},p(t,o){o&1&&e!==(e=t[5].properties.name+"")&&se(r,e)},d(t){t&&v(r)}}}function mn(n){let e,r,t,o;function l(){return n[3](n[7])}return r=new He({props:{color:n[5].properties.color,$$slots:{default:[Fl]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=B()},m(i,a){w(i,e,a),T(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(_(r.$$.fragment,i),o=!0)},o(i){$(r.$$.fragment,i),o=!1},d(i){i&&v(e),I(r)}}}function Ul(n){let e,r,t,o,l,i,a,s,f=V(n[0].jats),u=[];for(let c=0;c<f.length;c+=1)u[c]=mn(dn(n,f,c));const d=c=>$(u[c],1,1,()=>{u[c]=null});return{c(){e=G(`JATs:

`),r=k("div"),t=k("button"),t.textContent="New JAT",o=B(),l=k("ol");for(let c=0;c<u.length;c+=1)u[c].c()},m(c,m){w(c,e,m),w(c,r,m),g(r,t),w(c,o,m),w(c,l,m);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(l,null);i=!0,a||(s=P(t,"click",n[2]),a=!0)},p(c,[m]){if(m&3){f=V(c[0].jats);let p;for(p=0;p<f.length;p+=1){const A=dn(c,f,p);u[p]?(u[p].p(A,m),_(u[p],1)):(u[p]=mn(A),u[p].c(),_(u[p],1),u[p].m(l,null))}for(ae(),p=f.length;p<u.length;p+=1)d(p);ue()}},i(c){if(!i){for(let m=0;m<f.length;m+=1)_(u[m]);i=!0}},o(c){u=u.filter(Boolean);for(let m=0;m<u.length;m+=1)$(u[m]);i=!1},d(c){c&&(v(e),v(r),v(o),v(l)),me(u,c),a=!1,s()}}}function Ol(n,e,r){let t,o,l;x(n,Q,s=>r(0,t=s)),x(n,R,s=>r(1,o=s)),x(n,Pe,s=>r(4,l=s));function i(){if(!l)return;let s=ql(t.jats.length,l.getCenter().toArray());J(Q,t.jats=[...t.jats,s],t),J(R,o={kind:"edit-jat",idx:t.jats.length-1},o)}return[t,o,i,s=>J(R,o={kind:"edit-jat",idx:s},o)]}let Ql=class extends le{constructor(e){super(),ie(this,e,Ol,Ul,re,{})}};function pn(n,e,r){const t=n.slice();return t[2]=e[r],t[4]=r,t}function gn(n,e,r){const t=n.slice();t[5]=e[r];const o=t[5].properties.answers[t[4]];return t[6]=o,t}function _n(n,e,r){const t=n.slice();return t[5]=e[r],t}function hn(n){let e,r=n[5].properties.name+"",t;return{c(){e=k("th"),t=G(r),W(e,"color",n[5].properties.color)},m(o,l){w(o,e,l),g(e,t)},p(o,l){l&1&&r!==(r=o[5].properties.name+"")&&se(t,r),l&1&&W(e,"color",o[5].properties.color)},d(o){o&&v(e)}}}function $n(n){let e,r=n[6]+"",t;return{c(){e=k("td"),t=G(r),W(e,"background",n[6]==""?"red":"green")},m(o,l){w(o,e,l),g(e,t)},p(o,l){l&1&&r!==(r=o[6]+"")&&se(t,r),l&1&&W(e,"background",o[6]==""?"red":"green")},d(o){o&&v(e)}}}function kn(n){let e,r,t,o,l=V(n[0].links),i=[];for(let a=0;a<l.length;a+=1)i[a]=$n(gn(n,l,a));return{c(){e=k("tr"),r=k("th"),r.textContent=`${n[2].name}`,t=B();for(let a=0;a<i.length;a+=1)i[a].c();o=B()},m(a,s){w(a,e,s),g(e,r),g(e,t);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(e,null);g(e,o)},p(a,s){if(s&1){l=V(a[0].links);let f;for(f=0;f<l.length;f+=1){const u=gn(a,l,f);i[f]?i[f].p(u,s):(i[f]=$n(u),i[f].c(),i[f].m(e,o))}for(;f<i.length;f+=1)i[f].d(1);i.length=l.length}},d(a){a&&v(e),me(i,a)}}}function Pl(n){let e,r,t,o,l,i,a,s=V(n[0].links),f=[];for(let c=0;c<s.length;c+=1)f[c]=hn(_n(n,s,c));let u=V(Ae),d=[];for(let c=0;c<u.length;c+=1)d[c]=kn(pn(n,u,c));return{c(){e=k("table"),r=k("thead"),t=k("tr"),o=k("th"),l=B();for(let c=0;c<f.length;c+=1)f[c].c();i=B(),a=k("tbody");for(let c=0;c<d.length;c+=1)d[c].c()},m(c,m){w(c,e,m),g(e,r),g(r,t),g(t,o),g(t,l);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(t,null);g(e,i),g(e,a);for(let p=0;p<d.length;p+=1)d[p]&&d[p].m(a,null)},p(c,m){if(m&1){s=V(c[0].links);let p;for(p=0;p<s.length;p+=1){const A=_n(c,s,p);f[p]?f[p].p(A,m):(f[p]=hn(A),f[p].c(),f[p].m(t,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=s.length}if(m&1){u=V(Ae);let p;for(p=0;p<u.length;p+=1){const A=pn(c,u,p);d[p]?d[p].p(A,m):(d[p]=kn(A),d[p].c(),d[p].m(a,null))}for(;p<d.length;p+=1)d[p].d(1);d.length=u.length}},d(c){c&&v(e),me(f,c),me(d,c)}}}function Gl(n){let e,r;return e=new In({props:{$$slots:{default:[Pl]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,[o]){const l={};o&2049&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Jl(n,e,r){let t;x(n,Q,l=>r(0,t=l));function o(l){be.call(this,n,l)}return[t,o]}class Hl extends le{constructor(e){super(),ie(this,e,Jl,Gl,re,{})}}function bn(n,e,r){const t=n.slice();return t[9]=e[r],t[11]=r,t}function wn(n,e,r){const t=n.slice();return t[12]=e[r],t[11]=r,t}function vn(n){let e,r;return e=new Hl({}),e.$on("close",n[4]),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Rl(n){let e=n[12].properties.name+"",r;return{c(){r=G(e)},m(t,o){w(t,r,o)},p(t,o){o&2&&e!==(e=t[12].properties.name+"")&&se(r,e)},d(t){t&&v(r)}}}function An(n){let e,r,t,o;function l(){return n[6](n[11])}return r=new He({props:{color:n[12].properties.color,$$slots:{default:[Rl]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=B()},m(i,a){w(i,e,a),T(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[12].properties.color),a&16386&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(_(r.$$.fragment,i),o=!0)},o(i){$(r.$$.fragment,i),o=!1},d(i){i&&v(e),I(r)}}}function Kl(n){let e=n[9].name+"",r,t;return{c(){r=G(e),t=B()},m(o,l){w(o,r,l),w(o,t,l)},p:te,d(o){o&&(v(r),v(t))}}}function yn(n){let e,r,t,o,l,i,a,s;function f(){return n[7](n[11])}r=new He({props:{$$slots:{default:[Kl]},$$scope:{ctx:n}}}),r.$on("click",f);function u(...d){return n[8](n[11],...d)}return{c(){e=k("li"),M(r.$$.fragment),t=G(`:
      `),o=k("progress"),a=B(),o.value=l=n[1].links.filter(u).length,F(o,"max",i=n[1].links.length),F(o,"class","svelte-zadug4")},m(d,c){w(d,e,c),T(r,e,null),g(e,t),g(e,o),g(e,a),s=!0},p(d,c){n=d;const m={};c&16384&&(m.$$scope={dirty:c,ctx:n}),r.$set(m),(!s||c&2&&l!==(l=n[1].links.filter(u).length))&&(o.value=l),(!s||c&2&&i!==(i=n[1].links.length))&&F(o,"max",i)},i(d){s||(_(r.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),s=!1},d(d){d&&v(e),I(r)}}}function Xl(n){let e,r,t,o,l,i,a,s,f,u,d,c,m=n[0]&&vn(n),p=V(n[1].links),A=[];for(let y=0;y<p.length;y+=1)A[y]=An(wn(n,p,y));const D=y=>$(A[y],1,1,()=>{A[y]=null});let b=V(Ae),h=[];for(let y=0;y<b.length;y+=1)h[y]=yn(bn(n,b,y));const U=y=>$(h[y],1,1,()=>{h[y]=null});return{c(){m&&m.c(),e=B(),r=k("div"),t=k("button"),t.textContent="New link",o=B(),l=k("button"),l.textContent="Table of questions",i=G(`

Links:
`),a=k("ol");for(let y=0;y<A.length;y+=1)A[y].c();s=G(`

Questions:
`),f=k("ol");for(let y=0;y<h.length;y+=1)h[y].c()},m(y,j){m&&m.m(y,j),w(y,e,j),w(y,r,j),g(r,t),g(r,o),g(r,l),w(y,i,j),w(y,a,j);for(let C=0;C<A.length;C+=1)A[C]&&A[C].m(a,null);w(y,s,j),w(y,f,j);for(let C=0;C<h.length;C+=1)h[C]&&h[C].m(f,null);u=!0,d||(c=[P(t,"click",n[3]),P(l,"click",n[5])],d=!0)},p(y,[j]){if(y[0]?m?(m.p(y,j),j&1&&_(m,1)):(m=vn(y),m.c(),_(m,1),m.m(e.parentNode,e)):m&&(ae(),$(m,1,1,()=>{m=null}),ue()),j&6){p=V(y[1].links);let C;for(C=0;C<p.length;C+=1){const z=wn(y,p,C);A[C]?(A[C].p(z,j),_(A[C],1)):(A[C]=An(z),A[C].c(),_(A[C],1),A[C].m(a,null))}for(ae(),C=p.length;C<A.length;C+=1)D(C);ue()}if(j&6){b=V(Ae);let C;for(C=0;C<b.length;C+=1){const z=bn(y,b,C);h[C]?(h[C].p(z,j),_(h[C],1)):(h[C]=yn(z),h[C].c(),_(h[C],1),h[C].m(f,null))}for(ae(),C=b.length;C<h.length;C+=1)U(C);ue()}},i(y){if(!u){_(m);for(let j=0;j<p.length;j+=1)_(A[j]);for(let j=0;j<b.length;j+=1)_(h[j]);u=!0}},o(y){$(m),A=A.filter(Boolean);for(let j=0;j<A.length;j+=1)$(A[j]);h=h.filter(Boolean);for(let j=0;j<h.length;j+=1)$(h[j]);u=!1},d(y){y&&(v(e),v(r),v(i),v(a),v(s),v(f)),m&&m.d(y),me(A,y),me(h,y),d=!1,$e(c)}}}function Zl(n,e,r){let t,o;x(n,Q,c=>r(1,t=c)),x(n,R,c=>r(2,o=c));let l=!1;function i(){let c=dl(t.links.length);J(Q,t.links=[...t.links,c],t),J(R,o={kind:"edit-link",idx:t.links.length-1},o)}return[l,t,o,i,()=>r(0,l=!1),()=>r(0,l=!0),c=>J(R,o={kind:"edit-link",idx:c},o),c=>J(R,o={kind:"edit-question",idx:c},o),(c,m)=>m.properties.answers[c]!=""]}let Yl=class extends le{constructor(e){super(),ie(this,e,Zl,Xl,re,{})}};function Vl(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled side road",color:Ce[n%Ce.length],sa01:""}}}function Cn(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Wl(n){let e=n[4].properties.name+"",r;return{c(){r=G(e)},m(t,o){w(t,r,o)},p(t,o){o&1&&e!==(e=t[4].properties.name+"")&&se(r,e)},d(t){t&&v(r)}}}function jn(n){let e,r,t,o;function l(){return n[3](n[6])}return r=new He({props:{color:n[4].properties.color,$$slots:{default:[Wl]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=B()},m(i,a){w(i,e,a),T(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[4].properties.color),a&129&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(_(r.$$.fragment,i),o=!0)},o(i){$(r.$$.fragment,i),o=!1},d(i){i&&v(e),I(r)}}}function xl(n){let e,r,t,o,l,i,a,s,f=V(n[0].side_roads),u=[];for(let c=0;c<f.length;c+=1)u[c]=jn(Cn(n,f,c));const d=c=>$(u[c],1,1,()=>{u[c]=null});return{c(){e=G(`Side roads:

`),r=k("div"),t=k("button"),t.textContent="New side road",o=B(),l=k("ol");for(let c=0;c<u.length;c+=1)u[c].c()},m(c,m){w(c,e,m),w(c,r,m),g(r,t),w(c,o,m),w(c,l,m);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(l,null);i=!0,a||(s=P(t,"click",n[2]),a=!0)},p(c,[m]){if(m&3){f=V(c[0].side_roads);let p;for(p=0;p<f.length;p+=1){const A=Cn(c,f,p);u[p]?(u[p].p(A,m),_(u[p],1)):(u[p]=jn(A),u[p].c(),_(u[p],1),u[p].m(l,null))}for(ae(),p=f.length;p<u.length;p+=1)d(p);ue()}},i(c){if(!i){for(let m=0;m<f.length;m+=1)_(u[m]);i=!0}},o(c){u=u.filter(Boolean);for(let m=0;m<u.length;m+=1)$(u[m]);i=!1},d(c){c&&(v(e),v(r),v(o),v(l)),me(u,c),a=!1,s()}}}function ei(n,e,r){let t,o;x(n,Q,a=>r(0,t=a)),x(n,R,a=>r(1,o=a));function l(){let a=Vl(t.side_roads.length);J(Q,t.side_roads=[...t.side_roads,a],t),J(R,o={kind:"edit-side-road",idx:t.side_roads.length-1},o)}return[t,o,l,a=>J(R,o={kind:"edit-side-road",idx:a},o)]}class ti extends le{constructor(e){super(),ie(this,e,ei,xl,re,{})}}function ni(n){let e,r,t,o,l,i,a,s,f,u,d,c,m,p,A,D,b,h,U,y,j,C,z,N,O,Y,X,L;return f=new Yl({}),m=new Ql({}),b=new Ml({}),j=new Nl({}),O=new ti({}),{c(){e=k("div"),r=k("div"),t=k("button"),t.textContent="Download",o=B(),l=k("button"),l.textContent="Clear",i=B(),a=k("hr"),s=B(),M(f.$$.fragment),u=B(),d=k("hr"),c=B(),M(m.$$.fragment),p=B(),A=k("hr"),D=B(),M(b.$$.fragment),h=B(),U=k("hr"),y=B(),M(j.$$.fragment),C=B(),z=k("hr"),N=B(),M(O.$$.fragment),F(t,"class","secondary"),F(l,"class","secondary"),F(e,"slot","sidebar")},m(H,S){w(H,e,S),g(e,r),g(r,t),g(r,o),g(r,l),g(e,i),g(e,a),g(e,s),T(f,e,null),g(e,u),g(e,d),g(e,c),T(m,e,null),g(e,p),g(e,A),g(e,D),T(b,e,null),g(e,h),g(e,U),g(e,y),T(j,e,null),g(e,C),g(e,z),g(e,N),T(O,e,null),Y=!0,X||(L=[P(t,"click",n[8]),P(l,"click",n[2])],X=!0)},p:te,i(H){Y||(_(f.$$.fragment,H),_(m.$$.fragment,H),_(b.$$.fragment,H),_(j.$$.fragment,H),_(O.$$.fragment,H),Y=!0)},o(H){$(f.$$.fragment,H),$(m.$$.fragment,H),$(b.$$.fragment,H),$(j.$$.fragment,H),$(O.$$.fragment,H),Y=!1},d(H){H&&v(e),I(f),I(m),I(b),I(j),I(O),X=!1,$e(L)}}}function ri(n){let e,r;return e=new je({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":Xe(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[3]),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function oi(n){let e,r;return e=new Ve({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":Xe(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[4]),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function li(n){let e,r;return e=new Ne({props:{manageHoverState:!0,layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[5]),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ii(n){let e,r;return e=new Ne({props:{manageHoverState:!0,layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[6]),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function si(n){let e,r;return e=new je({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":Xe(3,6)},hoverCursor:"pointer"}}),e.$on("click",n[7]),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ai(n){let e,r,t,o,l,i,a,s,f,u,d;return r=new ge({props:{data:ne(n[0].links),generateId:!0,$$slots:{default:[ri]},$$scope:{ctx:n}}}),o=new ge({props:{data:ne(n[0].jats),generateId:!0,$$slots:{default:[oi]},$$scope:{ctx:n}}}),i=new ge({props:{data:ne(n[0].bus_stops),generateId:!0,$$slots:{default:[li]},$$scope:{ctx:n}}}),s=new ge({props:{data:ne(n[0].crossings),generateId:!0,$$slots:{default:[ii]},$$scope:{ctx:n}}}),u=new ge({props:{data:ne(n[0].side_roads),generateId:!0,$$slots:{default:[si]},$$scope:{ctx:n}}}),{c(){e=k("div"),M(r.$$.fragment),t=B(),M(o.$$.fragment),l=B(),M(i.$$.fragment),a=B(),M(s.$$.fragment),f=B(),M(u.$$.fragment),F(e,"slot","map")},m(c,m){w(c,e,m),T(r,e,null),g(e,t),T(o,e,null),g(e,l),T(i,e,null),g(e,a),T(s,e,null),g(e,f),T(u,e,null),d=!0},p(c,m){const p={};m&1&&(p.data=ne(c[0].links)),m&514&&(p.$$scope={dirty:m,ctx:c}),r.$set(p);const A={};m&1&&(A.data=ne(c[0].jats)),m&514&&(A.$$scope={dirty:m,ctx:c}),o.$set(A);const D={};m&1&&(D.data=ne(c[0].bus_stops)),m&514&&(D.$$scope={dirty:m,ctx:c}),i.$set(D);const b={};m&1&&(b.data=ne(c[0].crossings)),m&514&&(b.$$scope={dirty:m,ctx:c}),s.$set(b);const h={};m&1&&(h.data=ne(c[0].side_roads)),m&514&&(h.$$scope={dirty:m,ctx:c}),u.$set(h)},i(c){d||(_(r.$$.fragment,c),_(o.$$.fragment,c),_(i.$$.fragment,c),_(s.$$.fragment,c),_(u.$$.fragment,c),d=!0)},o(c){$(r.$$.fragment,c),$(o.$$.fragment,c),$(i.$$.fragment,c),$(s.$$.fragment,c),$(u.$$.fragment,c),d=!1},d(c){c&&v(e),I(r),I(o),I(i),I(s),I(u)}}}function ui(n){let e,r;return e=new Se({props:{$$slots:{map:[ai],sidebar:[ni]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,[o]){const l={};o&515&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ci(n,e,r){let t,o;x(n,Q,c=>r(0,t=c)),x(n,R,c=>r(1,o=c));function l(){J(Q,t.links=[],t),J(Q,t.jats=[],t),J(Q,t.bus_stops=[],t),J(Q,t.crossings=[],t),J(Q,t.side_roads=[],t)}return[t,o,l,c=>J(R,o={kind:"edit-link",idx:c.detail.features[0].id},o),c=>J(R,o={kind:"edit-jat",idx:c.detail.features[0].id},o),c=>J(R,o={kind:"edit-bus-stop",idx:c.detail.features[0].id},o),c=>J(R,o={kind:"edit-crossing",idx:c.detail.features[0].id},o),c=>J(R,o={kind:"edit-side-road",idx:c.detail.features[0].id},o),()=>Xr("rcv2.geojson",JSON.stringify(t))]}class fi extends le{constructor(e){super(),ie(this,e,ci,ui,re,{})}}const{window:di}=Je;function zn(n){let e;return{c(){e=k("p"),e.textContent="A side road needs at least two points"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function mi(n){let e,r,t,o,l,i,a,s,f,u,d,c,m,p,A,D,b,h=!n[2]&&zn();function U(j){n[9](j)}let y={k:"horiz-radio",label:"SA01: conflict at side roads and priority junctions",choices:ke()};return n[1].side_roads[n[0]].properties.sa01!==void 0&&(y.value=n[1].side_roads[n[0]].properties.sa01),m=new ze({props:y}),oe.push(()=>fe(m,"value",U)),{c(){e=k("div"),r=k("button"),t=G("Done"),l=B(),i=k("button"),i.textContent="Delete side road",a=B(),h&&h.c(),s=B(),f=k("label"),u=G(`Name:
      `),d=k("input"),c=B(),M(m.$$.fragment),r.disabled=o=!n[2],F(d,"type","text"),F(e,"slot","sidebar")},m(j,C){w(j,e,C),g(e,r),g(r,t),g(e,l),g(e,i),g(e,a),h&&h.m(e,null),g(e,s),g(e,f),g(f,u),g(f,d),_e(d,n[1].side_roads[n[0]].properties.name),g(e,c),T(m,e,null),A=!0,D||(b=[P(r,"click",n[7]),P(i,"click",n[5]),P(d,"input",n[8])],D=!0)},p(j,C){(!A||C&4&&o!==(o=!j[2]))&&(r.disabled=o),j[2]?h&&(h.d(1),h=null):h||(h=zn(),h.c(),h.m(e,s)),C&3&&d.value!==j[1].side_roads[j[0]].properties.name&&_e(d,j[1].side_roads[j[0]].properties.name);const z={};!p&&C&3&&(p=!0,z.value=j[1].side_roads[j[0]].properties.sa01,de(()=>p=!1)),m.$set(z)},i(j){A||(_(m.$$.fragment,j),A=!0)},o(j){$(m.$$.fragment,j),A=!1},d(j){j&&v(e),h&&h.d(),I(m),D=!1,$e(b)}}}function pi(n){let e,r;return e=new je({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":3}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":3}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function gi(n){let e,r,t,o,l,i,a,s;r=new qe({props:{except:"side_roads"}}),o=new ge({props:{data:ne(n[1].side_roads),generateId:!0,$$slots:{default:[pi]},$$scope:{ctx:n}}});function f(d){n[6](d)}let u={};return n[1].side_roads[n[0]]!==void 0&&(u.f=n[1].side_roads[n[0]]),i=new Nn({props:u}),oe.push(()=>fe(i,"f",f)),{c(){e=k("div"),M(r.$$.fragment),t=B(),M(o.$$.fragment),l=B(),M(i.$$.fragment),F(e,"slot","map")},m(d,c){w(d,e,c),T(r,e,null),g(e,t),T(o,e,null),g(e,l),T(i,e,null),s=!0},p(d,c){const m={};c&2&&(m.data=ne(d[1].side_roads)),c&1025&&(m.$$scope={dirty:c,ctx:d}),o.$set(m);const p={};!a&&c&3&&(a=!0,p.f=d[1].side_roads[d[0]],de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(o.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(o.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&v(e),I(r),I(o),I(i)}}}function _i(n){let e,r,t,o;return e=new Se({props:{$$slots:{map:[gi],sidebar:[mi]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=P(di,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&1039&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(_(e.$$.fragment,l),r=!0)},o(l){$(e.$$.fragment,l),r=!1},d(l){I(e,l),t=!1,o()}}}function hi(n,e,r){let t,o,l;x(n,Q,m=>r(1,o=m)),x(n,R,m=>r(3,l=m));let{idx:i}=e;function a(m){m.key=="Escape"&&J(R,l={kind:"neutral"},l)}async function s(){window.confirm("Really delete this side road?")&&(J(R,l={kind:"neutral"},l),await Ee(),o.side_roads.splice(i,1),Q.set(o))}function f(m){n.$$.not_equal(o.side_roads[i],m)&&(o.side_roads[i]=m,Q.set(o))}const u=()=>J(R,l={kind:"neutral"},l);function d(){o.side_roads[i].properties.name=this.value,Q.set(o)}function c(m){n.$$.not_equal(o.side_roads[i].properties.sa01,m)&&(o.side_roads[i].properties.sa01=m,Q.set(o))}return n.$$set=m=>{"idx"in m&&r(0,i=m.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(2,t=o.side_roads[i].geometry.coordinates.length>=2)},[i,o,t,l,a,s,f,u,d,c]}class $i extends le{constructor(e){super(),ie(this,e,hi,_i,re,{idx:0})}}function ki(n){let e,r;return{c(){e=k("div"),r=k("div"),F(e,"slot","left")},m(t,o){w(t,e,o),g(e,r),n[9](r)},p:te,d(t){t&&v(e),n[9](null)}}}function bi(n){return{c:te,m:te,p:te,i:te,o:te,d:te}}function wi(n){let e,r,t;function o(i){n[8](i)}let l={style:n[10],standardControls:!0,hash:!0,images:[{id:"bus_stop",url:Ln,options:{sdf:!0}},{id:"crossing",url:Mn,options:{sdf:!0}}],$$slots:{default:[Li]},$$scope:{ctx:n}};return n[2]!==void 0&&(l.map=n[2]),e=new Wn({props:l}),oe.push(()=>fe(e,"map",o)),{c(){M(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,a){const s={};a&2058&&(s.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,s.map=i[2],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function vi(n){let e,r;return e=new yl({props:{qIdx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.qIdx=t[3].idx),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Ai(n){let e,r;return e=new $i({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function yi(n){let e,r;return e=new Ur({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Ci(n){let e,r;return e=new Mr({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ji(n){let e,r;return e=new tl({props:{junctionIdx:n[3].idx,stage:n[3].stage}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.junctionIdx=t[3].idx),o&8&&(l.stage=t[3].stage),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function zi(n){let e,r;return e=new al({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Bi(n){let e,r;return e=new kl({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Si(n){let e,r;return e=new fi({}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Li(n){let e,r,t,o,l,i;const a=[Si,Bi,zi,ji,Ci,yi,Ai,vi],s=[];function f(u,d){return u[3].kind=="neutral"?0:u[3].kind=="edit-link"?1:u[3].kind=="edit-jat"?2:u[3].kind=="edit-jat-detail"?3:u[3].kind=="edit-bus-stop"?4:u[3].kind=="edit-crossing"?5:u[3].kind=="edit-side-road"?6:u[3].kind=="edit-question"?7:-1}return~(t=f(n))&&(o=s[t]=a[t](n)),{c(){e=k("div"),r=B(),o&&o.c(),l=Ge()},m(u,d){w(u,e,d),n[7](e),w(u,r,d),~t&&s[t].m(u,d),w(u,l,d),i=!0},p(u,d){let c=t;t=f(u),t===c?~t&&s[t].p(u,d):(o&&(ae(),$(s[c],1,1,()=>{s[c]=null}),ue()),~t?(o=s[t],o?o.p(u,d):(o=s[t]=a[t](u),o.c()),_(o,1),o.m(l.parentNode,l)):o=null)},i(u){i||(_(o),i=!0)},o(u){$(o),i=!1},d(u){u&&(v(e),v(r),v(l)),n[7](null),~t&&s[t].d(u)}}}function Mi(n){return{c:te,m:te,p:te,i:te,o:te,d:te}}function Ti(n){let e,r,t={ctx:n,current:null,token:null,hasCatch:!1,pending:Mi,then:wi,catch:bi,value:10,blocks:[,,,]};return xn(Or(new URLSearchParams(window.location.search).get("google")||""),t),{c(){e=k("div"),t.block.c(),F(e,"slot","main"),W(e,"position","relative"),W(e,"width","100%"),W(e,"height","100vh")},m(o,l){w(o,e,l),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,r=!0},p(o,l){n=o,er(t,n,l)},i(o){r||(_(t.block),r=!0)},o(o){for(let l=0;l<3;l+=1){const i=t.blocks[l];$(i)}r=!1},d(o){o&&v(e),t.block.d(),t.token=null,t=null}}}function Ii(n){let e,r;return e=new Vn({props:{$$slots:{main:[Ti],left:[ki]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,[o]){const l={};o&2063&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Di(n,e,r){let t,o,l,i,a;x(n,lt,m=>r(4,t=m)),x(n,ot,m=>r(5,o=m)),x(n,Q,m=>r(6,l=m)),x(n,Pe,m=>r(2,i=m)),x(n,R,m=>r(3,a=m));let s,f;function u(m){oe[m?"unshift":"push"](()=>{f=m,r(1,f),r(4,t)})}function d(m){i=m,Pe.set(i)}function c(m){oe[m?"unshift":"push"](()=>{s=m,r(0,s),r(5,o)})}return n.$$.update=()=>{n.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(l)),n.$$.dirty&33&&s&&o&&(r(0,s.innerHTML="",s),s.appendChild(o)),n.$$.dirty&18&&f&&t&&(r(1,f.innerHTML="",f),f.appendChild(t))},[s,f,i,a,t,o,l,u,d,c]}class Ei extends le{constructor(e){super(),ie(this,e,Di,Ii,re,{})}}new Ei({target:document.getElementById("app")});
