import{V as Yn,W as xn,X as at,r as ge,e as y,v as he,t as k,Y as el,S as ke,i as be,s as ve,Z as tl,_ as nl,$ as re,a0 as ll,L as rl,b as we,a as Ne,c as q,m as P,d as Ee,f as F,g as ol,h as We,u as Ve,j as Qe,k as Ye,l as Ie,y as h,z as L,q as b,w as v,a1 as rt,p as ot,G as je,D as xe,E as De,B as le,Q as Z,a2 as it,o as Y,F as U,A as R,a3 as pt,O as p,N as ce,a4 as Oe,x as ie,R as Me,M as Fe,a5 as ee,a6 as et,a7 as dt,U as te,a8 as $t,a9 as wt,H as se,K as _t,aa as il,ab as gt,ac as sl,C as tt,P as Rn,ad as al,I as cl,T as ul}from"./Layout-4695594c.js";function fl(t,e){const l=e.token={};function n(r,o,i,a){if(e.token!==l)return;e.resolved=a;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=a);const u=r&&(e.current=r)(s);let c=!1;e.block&&(e.blocks?e.blocks.forEach((f,m)=>{m!==o&&f&&(ge(),y(f,1,1,()=>{e.blocks[m]===f&&(e.blocks[m]=null)}),he())}):e.block.d(1),u.c(),k(u,1),u.m(e.mount(),e.anchor),c=!0),e.block=u,e.blocks&&(e.blocks[o]=u),c&&el()}if(Yn(t)){const r=xn();if(t.then(o=>{at(r),n(e.then,1,e.value,o),at(null)},o=>{if(at(r),n(e.catch,2,e.error,o),at(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,t),!0;e.resolved=t}}function ml(t,e,l){const n=e.slice(),{resolved:r}=t;t.current===t.then&&(n[t.value]=r),t.current===t.catch&&(n[t.error]=r),t.block.p(n,l)}function pl(t,e,l){let n;const r=tl();let{layer:o=void 0}=e;const{map:i}=nl();re(t,i,c=>l(2,n=c));function a(c){r(c.type,{...c,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ll(()=>{if(n)if(o)for(const c of s)n.off(c,o,a);else for(const c of u)n.off(c,a)}),t.$$set=c=>{"layer"in c&&l(1,o=c.layer)},t.$$.update=()=>{if(t.$$.dirty&6&&n)if(o)for(const c of s)n.on(c,o,a);else for(const c of u)n.on(c,a)},[i,o,n]}class Hn extends ke{constructor(e){super(),be(this,e,pl,null,ve,{layer:1})}}function dl(t){let e;const l=t[16].default,n=We(l,t,t[24],null);return{c(){n&&n.c()},m(r,o){n&&n.m(r,o),e=!0},p(r,o){n&&n.p&&(!e||o&16777216)&&Ve(n,l,r,r[24],e?Ye(l,r[24],o,null):Qe(r[24]),null)},i(r){e||(k(n,r),e=!0)},o(r){y(n,r),e=!1},d(r){n&&n.d(r)}}}function _l(t){let e,l,n;function r(i){t[17](i)}let o={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[dl]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new rl({props:o}),we.push(()=>Ne(e,"hovered",r)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){q(e.$$.fragment)},m(i,a){P(e,i,a),n=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!l&&a&1&&(l=!0,s.hovered=i[0],Ee(()=>l=!1)),e.$set(s)},i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){y(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function gl(t,e,l){let{$$slots:n={},$$scope:r}=e,{id:o=ol("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:f=void 0}=e,{filter:m=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:_=void 0}=e,{maxzoom:$=void 0}=e,{hoverCursor:N=void 0}=e,{manageHoverState:g=!1}=e,{hovered:j=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:G=!0}=e;function B(w){j=w,l(0,j)}function z(w){Ie.call(this,t,w)}function H(w){Ie.call(this,t,w)}function M(w){Ie.call(this,t,w)}function T(w){Ie.call(this,t,w)}function S(w){Ie.call(this,t,w)}function I(w){Ie.call(this,t,w)}return t.$$set=w=>{"id"in w&&l(1,o=w.id),"source"in w&&l(2,i=w.source),"sourceLayer"in w&&l(3,a=w.sourceLayer),"beforeId"in w&&l(4,s=w.beforeId),"beforeLayerType"in w&&l(5,u=w.beforeLayerType),"paint"in w&&l(6,c=w.paint),"layout"in w&&l(7,f=w.layout),"filter"in w&&l(8,m=w.filter),"applyToClusters"in w&&l(9,d=w.applyToClusters),"minzoom"in w&&l(10,_=w.minzoom),"maxzoom"in w&&l(11,$=w.maxzoom),"hoverCursor"in w&&l(12,N=w.hoverCursor),"manageHoverState"in w&&l(13,g=w.manageHoverState),"hovered"in w&&l(0,j=w.hovered),"eventsIfTopMost"in w&&l(14,O=w.eventsIfTopMost),"interactive"in w&&l(15,G=w.interactive),"$$scope"in w&&l(24,r=w.$$scope)},[j,o,i,a,s,u,c,f,m,d,_,$,N,g,O,G,n,B,z,H,M,T,S,I,r]}class hl extends ke{constructor(e){super(),be(this,e,gl,_l,ve,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const $l=t=>({}),yt=t=>({}),kl=t=>({}),jt=t=>({});function bl(t){let e,l,n,r;const o=t[3].sidebar,i=We(o,t,t[2],jt),a=t[3].map,s=We(a,t,t[2],yt);return{c(){e=h("div"),i&&i.c(),l=L(),n=h("div"),s&&s.c()},m(u,c){b(u,e,c),i&&i.m(e,null),t[4](e),b(u,l,c),b(u,n,c),s&&s.m(n,null),t[5](n),r=!0},p(u,[c]){i&&i.p&&(!r||c&4)&&Ve(i,o,u,u[2],r?Ye(o,u[2],c,kl):Qe(u[2]),jt),s&&s.p&&(!r||c&4)&&Ve(s,a,u,u[2],r?Ye(a,u[2],c,$l):Qe(u[2]),yt)},i(u){r||(k(i,u),k(s,u),r=!0)},o(u){y(i,u),y(s,u),r=!1},d(u){u&&(v(e),v(l),v(n)),i&&i.d(u),t[4](null),s&&s.d(u),t[5](null)}}}function vl(t,e,l){let n,r;re(t,kt,u=>l(0,n=u)),re(t,bt,u=>l(1,r=u));let{$$slots:o={},$$scope:i}=e;function a(u){we[u?"unshift":"push"](()=>{n=u,kt.set(n)})}function s(u){we[u?"unshift":"push"](()=>{r=u,bt.set(r)})}return t.$$set=u=>{"$$scope"in u&&l(2,i=u.$$scope)},[n,r,i,o,a,s]}class Ze extends ke{constructor(e){super(),be(this,e,vl,bl,ve,{})}}let kt=rt(null),bt=rt(null),ft=rt(void 0),X=rt(Ll());function oe(t){return{type:"FeatureCollection",features:t}}let ne=rt({kind:"neutral"});function Se(){return["","2","1","0","Critical"]}let Te=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:Se()},{name:"SA04",description:"trip hazards",choices:Se()},{name:"SA05",description:"kerbside activity",choices:Se()},{name:"SA08",description:"motor traffic speed",choices:Se()},{name:"SA09",description:"motor traffic volume",choices:Se()},{name:"SA11",description:"footway widths",choices:Se()},{name:"SA12",description:"effective width next to tram lines",choices:Se()},{name:"SA13",description:"crossing angle of tram/train rails",choices:Se()},{name:"SA14",description:"cycling surface and maintenance defects",choices:Se()},{name:"SA15",description:"WW surface and maintenance defects",choices:Se()},{name:"SA16",description:"guard railing",choices:Se()}],Be=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"];function wl(t){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Be[t%Be.length],answers:Array(Te.length).fill("")}}}function yl(t,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Be[t%Be.length],st20:""}}}function jl(t,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:Be[t%Be.length],sa10:""}}}function Cl(t,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Be[t%Be.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function Ll(){try{let t=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if("links"in t&&"jats"in t&&"crossings"in t)return t}catch{}return{links:[],jats:[],bus_stops:[],crossings:[]}}function Ct(t){let e,l;return e=new je({props:{data:oe(t[2].links),$$slots:{default:[Al]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&4&&(o.data=oe(n[2].links)),r&10&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Al(t){let e,l;return e=new xe({props:{paint:{"line-color":t[1]?["get","color"]:"black","line-width":6}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&2&&(o.paint={"line-color":n[1]?["get","color"]:"black","line-width":6}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Lt(t){let e,l;return e=new je({props:{data:oe(t[2].bus_stops),$$slots:{default:[Sl]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&4&&(o.data=oe(n[2].bus_stops)),r&8&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Sl(t){let e,l;return e=new De({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p:le,i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function At(t){let e,l;return e=new je({props:{data:oe(t[2].crossings),$$slots:{default:[Tl]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&4&&(o.data=oe(n[2].crossings)),r&8&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Tl(t){let e,l;return e=new De({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p:le,i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function St(t){let e,l;return e=new je({props:{data:oe(t[2].jats),$$slots:{default:[Ml]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&4&&(o.data=oe(n[2].jats)),r&8&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ml(t){let e,l;return e=new De({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p:le,i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Il(t){let e,l,n,r,o,i=t[0]!="links"&&Ct(t),a=t[0]!="bus_stops"&&Lt(t),s=t[0]!="crossings"&&At(t),u=t[0]!="jats"&&St(t);return{c(){i&&i.c(),e=L(),a&&a.c(),l=L(),s&&s.c(),n=L(),u&&u.c(),r=ot()},m(c,f){i&&i.m(c,f),b(c,e,f),a&&a.m(c,f),b(c,l,f),s&&s.m(c,f),b(c,n,f),u&&u.m(c,f),b(c,r,f),o=!0},p(c,[f]){c[0]!="links"?i?(i.p(c,f),f&1&&k(i,1)):(i=Ct(c),i.c(),k(i,1),i.m(e.parentNode,e)):i&&(ge(),y(i,1,1,()=>{i=null}),he()),c[0]!="bus_stops"?a?(a.p(c,f),f&1&&k(a,1)):(a=Lt(c),a.c(),k(a,1),a.m(l.parentNode,l)):a&&(ge(),y(a,1,1,()=>{a=null}),he()),c[0]!="crossings"?s?(s.p(c,f),f&1&&k(s,1)):(s=At(c),s.c(),k(s,1),s.m(n.parentNode,n)):s&&(ge(),y(s,1,1,()=>{s=null}),he()),c[0]!="jats"?u?(u.p(c,f),f&1&&k(u,1)):(u=St(c),u.c(),k(u,1),u.m(r.parentNode,r)):u&&(ge(),y(u,1,1,()=>{u=null}),he())},i(c){o||(k(i),k(a),k(s),k(u),o=!0)},o(c){y(i),y(a),y(s),y(u),o=!1},d(c){c&&(v(e),v(l),v(n),v(r)),i&&i.d(c),a&&a.d(c),s&&s.d(c),u&&u.d(c)}}}function Nl(t,e,l){let n;re(t,X,i=>l(2,n=i));let{except:r}=e,{showLinkColor:o=!1}=e;return t.$$set=i=>{"except"in i&&l(0,r=i.except),"showLinkColor"in i&&l(1,o=i.showLinkColor)},[r,o,n]}class nt extends ke{constructor(e){super(),be(this,e,Nl,Il,ve,{except:0,showLinkColor:1})}}const{window:El}=it;function Dl(t,e,l){const n=t.slice();return n[9]=e[l],n}function ql(t){let e;return{c(){e=h("option"),e.textContent=`${t[9]}`,e.__value=t[9],ce(e,e.__value)},m(l,n){b(l,e,n)},p:le,d(l){l&&v(e)}}}function Pl(t){let e,l,n,r,o,i,a,s,u,c,f,m,d,_,$=Y(Se()),N=[];for(let g=0;g<$.length;g+=1)N[g]=ql(Dl(t,$,g));return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=L(),r=h("button"),r.textContent="Delete bus stop",o=L(),i=h("label"),a=U(`Name:
      `),s=h("input"),u=L(),c=h("label"),f=U(`ST20: bus stops
      `),m=h("select");for(let g=0;g<N.length;g+=1)N[g].c();R(s,"type","text"),t[1].bus_stops[t[0]].properties.st20===void 0&&pt(()=>t[8].call(m)),R(e,"slot","sidebar")},m(g,j){b(g,e,j),p(e,l),p(e,n),p(e,r),p(e,o),p(e,i),p(i,a),p(i,s),ce(s,t[1].bus_stops[t[0]].properties.name),p(e,u),p(e,c),p(c,f),p(c,m);for(let O=0;O<N.length;O+=1)N[O]&&N[O].m(m,null);Oe(m,t[1].bus_stops[t[0]].properties.st20,!0),d||(_=[Z(l,"click",t[6]),Z(r,"click",t[4]),Z(s,"input",t[7]),Z(m,"change",t[8])],d=!0)},p(g,j){j&3&&s.value!==g[1].bus_stops[g[0]].properties.name&&ce(s,g[1].bus_stops[g[0]].properties.name),j&3&&Oe(m,g[1].bus_stops[g[0]].properties.st20)},d(g){g&&v(e),ie(N,g),d=!1,Me(_)}}}function Fl(t){let e,l;return e=new De({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ol(t){let e;return{c(){e=h("span"),R(e,"class","dot svelte-1j72wc4"),te(e,"background-color",t[1].bus_stops[t[0]].properties.color)},m(l,n){b(l,e,n)},p(l,n){n&3&&te(e,"background-color",l[1].bus_stops[l[0]].properties.color)},d(l){l&&v(e)}}}function Bl(t){let e,l,n,r,o,i,a,s;l=new nt({props:{except:"bus_stops"}}),r=new je({props:{data:oe(t[1].bus_stops),generateId:!0,$$slots:{default:[Fl]},$$scope:{ctx:t}}});function u(f){t[5](f)}let c={draggable:!0,$$slots:{default:[Ol]},$$scope:{ctx:t}};return t[1].bus_stops[t[0]].geometry.coordinates!==void 0&&(c.lngLat=t[1].bus_stops[t[0]].geometry.coordinates),i=new Fe({props:c}),we.push(()=>Ne(i,"lngLat",u)),{c(){e=h("div"),q(l.$$.fragment),n=L(),q(r.$$.fragment),o=L(),q(i.$$.fragment),R(e,"slot","map")},m(f,m){b(f,e,m),P(l,e,null),p(e,n),P(r,e,null),p(e,o),P(i,e,null),s=!0},p(f,m){const d={};m&2&&(d.data=oe(f[1].bus_stops)),m&4097&&(d.$$scope={dirty:m,ctx:f}),r.$set(d);const _={};m&4099&&(_.$$scope={dirty:m,ctx:f}),!a&&m&3&&(a=!0,_.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,Ee(()=>a=!1)),i.$set(_)},i(f){s||(k(l.$$.fragment,f),k(r.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),y(r.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),F(l),F(r),F(i)}}}function Jl(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[Bl],sidebar:[Pl]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(o,i){P(e,o,i),l=!0,n||(r=Z(El,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&4103&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function zl(t,e,l){let n,r;re(t,X,m=>l(1,n=m)),re(t,ne,m=>l(2,r=m));let{idx:o}=e;function i(m){m.key=="Escape"&&ee(ne,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this bus stop?")&&(ee(ne,r={kind:"neutral"},r),await et(),n.bus_stops.splice(o,1),X.set(n))}function s(m){t.$$.not_equal(n.bus_stops[o].geometry.coordinates,m)&&(n.bus_stops[o].geometry.coordinates=m,X.set(n))}const u=()=>ee(ne,r={kind:"neutral"},r);function c(){n.bus_stops[o].properties.name=this.value,X.set(n)}function f(){n.bus_stops[o].properties.st20=dt(this),X.set(n)}return t.$$set=m=>{"idx"in m&&l(0,o=m.idx)},[o,n,r,i,a,s,u,c,f]}class Rl extends ke{constructor(e){super(),be(this,e,zl,Jl,ve,{idx:0})}}const{window:Hl}=it;function Gl(t,e,l){const n=t.slice();return n[9]=e[l],n}function Ul(t){let e;return{c(){e=h("option"),e.textContent=`${t[9]}`,e.__value=t[9],ce(e,e.__value)},m(l,n){b(l,e,n)},p:le,d(l){l&&v(e)}}}function Zl(t){let e,l,n,r,o,i,a,s,u,c,f,m,d,_,$=Y(Se()),N=[];for(let g=0;g<$.length;g+=1)N[g]=Ul(Gl(t,$,g));return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=L(),r=h("button"),r.textContent="Delete crossing",o=L(),i=h("label"),a=U(`Name:
      `),s=h("input"),u=L(),c=h("label"),f=U(`SA10: pedestrian crossing speed
      `),m=h("select");for(let g=0;g<N.length;g+=1)N[g].c();R(s,"type","text"),t[1].crossings[t[0]].properties.sa10===void 0&&pt(()=>t[8].call(m)),R(e,"slot","sidebar")},m(g,j){b(g,e,j),p(e,l),p(e,n),p(e,r),p(e,o),p(e,i),p(i,a),p(i,s),ce(s,t[1].crossings[t[0]].properties.name),p(e,u),p(e,c),p(c,f),p(c,m);for(let O=0;O<N.length;O+=1)N[O]&&N[O].m(m,null);Oe(m,t[1].crossings[t[0]].properties.sa10,!0),d||(_=[Z(l,"click",t[6]),Z(r,"click",t[4]),Z(s,"input",t[7]),Z(m,"change",t[8])],d=!0)},p(g,j){j&3&&s.value!==g[1].crossings[g[0]].properties.name&&ce(s,g[1].crossings[g[0]].properties.name),j&3&&Oe(m,g[1].crossings[g[0]].properties.sa10)},d(g){g&&v(e),ie(N,g),d=!1,Me(_)}}}function Kl(t){let e,l;return e=new De({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Xl(t){let e;return{c(){e=h("span"),R(e,"class","dot svelte-1j72wc4"),te(e,"background-color",t[1].crossings[t[0]].properties.color)},m(l,n){b(l,e,n)},p(l,n){n&3&&te(e,"background-color",l[1].crossings[l[0]].properties.color)},d(l){l&&v(e)}}}function Wl(t){let e,l,n,r,o,i,a,s;l=new nt({props:{except:"crossings"}}),r=new je({props:{data:oe(t[1].crossings),generateId:!0,$$slots:{default:[Kl]},$$scope:{ctx:t}}});function u(f){t[5](f)}let c={draggable:!0,$$slots:{default:[Xl]},$$scope:{ctx:t}};return t[1].crossings[t[0]].geometry.coordinates!==void 0&&(c.lngLat=t[1].crossings[t[0]].geometry.coordinates),i=new Fe({props:c}),we.push(()=>Ne(i,"lngLat",u)),{c(){e=h("div"),q(l.$$.fragment),n=L(),q(r.$$.fragment),o=L(),q(i.$$.fragment),R(e,"slot","map")},m(f,m){b(f,e,m),P(l,e,null),p(e,n),P(r,e,null),p(e,o),P(i,e,null),s=!0},p(f,m){const d={};m&2&&(d.data=oe(f[1].crossings)),m&4097&&(d.$$scope={dirty:m,ctx:f}),r.$set(d);const _={};m&4099&&(_.$$scope={dirty:m,ctx:f}),!a&&m&3&&(a=!0,_.lngLat=f[1].crossings[f[0]].geometry.coordinates,Ee(()=>a=!1)),i.$set(_)},i(f){s||(k(l.$$.fragment,f),k(r.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),y(r.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),F(l),F(r),F(i)}}}function Vl(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[Wl],sidebar:[Zl]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(o,i){P(e,o,i),l=!0,n||(r=Z(Hl,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&4103&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function Ql(t,e,l){let n,r;re(t,X,m=>l(1,n=m)),re(t,ne,m=>l(2,r=m));let{idx:o}=e;function i(m){m.key=="Escape"&&ee(ne,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this crossing?")&&(ee(ne,r={kind:"neutral"},r),await et(),n.crossings.splice(o,1),X.set(n))}function s(m){t.$$.not_equal(n.crossings[o].geometry.coordinates,m)&&(n.crossings[o].geometry.coordinates=m,X.set(n))}const u=()=>ee(ne,r={kind:"neutral"},r);function c(){n.crossings[o].properties.name=this.value,X.set(n)}function f(){n.crossings[o].properties.sa10=dt(this),X.set(n)}return t.$$set=m=>{"idx"in m&&l(0,o=m.idx)},[o,n,r,i,a,s,u,c,f]}class Yl extends ke{constructor(e){super(),be(this,e,Ql,Vl,ve,{idx:0})}}let Tt="MZEJTanw3WpxRvt7qDfo";async function xl(t){return t?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await er(t)}&key=${t}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${Tt}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${Tt}`}async function er(t){try{let l=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${t}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB"})})).json();return"session"in l?l.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(l)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}const tr="/route-element/assets/right-arrow-d8c7892c.svg";function Mt(t){let e,l;const n=t[4].default,r=We(n,t,t[3],null);return{c(){e=h("div"),r&&r.c(),R(e,"class","section svelte-zax3q3")},m(o,i){b(o,e,i),r&&r.m(e,null),l=!0},p(o,i){r&&r.p&&(!l||i&8)&&Ve(r,n,o,o[3],l?Ye(n,o[3],i,null):Qe(o[3]),null)},i(o){l||(k(r,o),l=!0)},o(o){y(r,o),l=!1},d(o){o&&v(e),r&&r.d(o)}}}function nr(t){let e,l,n,r,o,i,a,s,u,c,f,m,d=t[2]&&Mt(t);return{c(){e=h("button"),l=h("div"),n=h("span"),r=U(t[0]),o=L(),i=h("img"),u=L(),d&&d.c(),R(i,"class","arrow svelte-zax3q3"),$t(i.src,a=tr)||R(i,"src",a),R(i,"alt",s="Select "+t[0]),R(l,"class","top-section section svelte-zax3q3"),wt(l,"bordered",t[2]),R(e,"class","clickable-card svelte-zax3q3"),e.disabled=t[1]},m(_,$){b(_,e,$),p(e,l),p(l,n),p(n,r),p(l,o),p(l,i),p(e,u),d&&d.m(e,null),c=!0,f||(m=[Z(e,"click",t[5]),Z(e,"mouseenter",t[6]),Z(e,"mouseleave",t[7])],f=!0)},p(_,[$]){(!c||$&1)&&se(r,_[0]),(!c||$&1&&s!==(s="Select "+_[0]))&&R(i,"alt",s),(!c||$&4)&&wt(l,"bordered",_[2]),_[2]?d?(d.p(_,$),$&4&&k(d,1)):(d=Mt(_),d.c(),k(d,1),d.m(e,null)):d&&(ge(),y(d,1,1,()=>{d=null}),he()),(!c||$&2)&&(e.disabled=_[1])},i(_){c||(k(d),c=!0)},o(_){y(d),c=!1},d(_){_&&v(e),d&&d.d(),f=!1,Me(m)}}}function lr(t,e,l){let{$$slots:n={},$$scope:r}=e,{name:o}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(f){Ie.call(this,t,f)}function u(f){Ie.call(this,t,f)}function c(f){Ie.call(this,t,f)}return t.$$set=f=>{"name"in f&&l(0,o=f.name),"disabled"in f&&l(1,i=f.disabled),"hasSlot"in f&&l(2,a=f.hasSlot),"$$scope"in f&&l(3,r=f.$$scope)},[o,i,a,r,n,s,u,c]}class Gn extends ke{constructor(e){super(),be(this,e,lr,nr,ve,{name:0,disabled:1,hasSlot:2})}}let Pe={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const rr=t=>({dialog:t&1}),It=t=>({dialog:t[0]});function or(t){let e,l,n,r,o;const i=t[4].default,a=We(i,t,t[3],It);return{c(){e=h("dialog"),l=h("article"),a&&a.c(),e.open=!0},m(s,u){b(s,e,u),p(e,l),a&&a.m(l,null),t[6](e),n=!0,r||(o=[Z(window,"click",t[1]),Z(window,"keydown",t[2]),Z(e,"close",t[5])],r=!0)},p(s,[u]){a&&a.p&&(!n||u&9)&&Ve(a,i,s,s[3],n?Ye(i,s[3],u,rr):Qe(s[3]),It)},i(s){n||(k(a,s),n=!0)},o(s){y(a,s),n=!1},d(s){s&&v(e),a&&a.d(s),t[6](null),r=!1,Me(o)}}}function ir(t,e,l){let{$$slots:n={},$$scope:r}=e,o;function i(c){o.open&&c.target==o&&o.close()}function a(c){(c.key=="Escape"||c.key=="Enter")&&(c.stopPropagation(),o.close())}function s(c){Ie.call(this,t,c)}function u(c){we[c?"unshift":"push"](()=>{o=c,l(0,o)})}return t.$$set=c=>{"$$scope"in c&&l(3,r=c.$$scope)},[o,i,a,r,n,s,u]}class Un extends ke{constructor(e){super(),be(this,e,ir,or,ve,{})}}function sr(t,e){let l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),l.setAttribute("download",t),document.body.appendChild(l),l.click(),document.body.removeChild(l)}const Ke={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},vt=Object.keys(Ke);function mt(t){return Object.keys(Ke[t])}const Ue="All movements";function Nt(t,e){let l=[],n=Ke[t][e];n&&l.push({junctionType:t,movementType:e,...n});let r=Ke[t][Ue];if(r&&e!=Ue&&l.push({junctionType:t,movementType:Ue,...r}),t=="Crossroads"){let o=Ke["Simple priority T-junction"][Ue];o&&l.push({junctionType:"Simple priority T-junction",movementType:Ue,...o})}if(t!="Any type of junction"){let o=Ke["Any type of junction"][Ue];o&&l.push({junctionType:"Any type of junction",movementType:Ue,...o})}return l}function Et(t,e,l){const n=t.slice();return n[10]=e[l],n}function Dt(t,e,l){const n=t.slice();return n[13]=e[l],n}function qt(t,e,l){const n=t.slice();return n[13]=e[l],n}function Pt(t,e,l){const n=t.slice();return n[13]=e[l],n}function Ft(t,e,l){const n=t.slice();return n[20]=e[l],n}function Ot(t,e,l){const n=t.slice();return n[20]=e[l],n}function Bt(t){let e,l;return e=new Un({props:{$$slots:{default:[ar]},$$scope:{ctx:t}}}),e.$on("close",t[9]),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&33554439&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Jt(t){let e,l,n,r,o,i,a,s;return i=_t(t[6][1]),{c(){e=h("label"),l=h("input"),n=L(),r=U(t[20]),o=L(),R(l,"type","radio"),l.__value=t[20],ce(l,l.__value),i.p(l)},m(u,c){b(u,e,c),p(e,l),l.checked=l.__value===t[1],p(e,n),p(e,r),p(e,o),a||(s=[Z(l,"change",t[5]),Z(l,"change",t[3])],a=!0)},p(u,c){c&2&&(l.checked=l.__value===u[1])},d(u){u&&v(e),i.r(),a=!1,Me(s)}}}function zt(t){let e,l,n,r=!1,o,i=t[20]+"",a,s,u,c,f;return u=_t(t[6][0]),{c(){e=h("label"),l=h("input"),o=L(),a=U(i),s=L(),R(l,"type","radio"),l.__value=n=t[20],ce(l,l.__value),u.p(l)},m(m,d){b(m,e,d),p(e,l),l.checked=l.__value===t[2],p(e,o),p(e,a),p(e,s),c||(f=Z(l,"change",t[7]),c=!0)},p(m,d){d&2&&n!==(n=m[20])&&(l.__value=n,ce(l,l.__value),r=!0),(r||d&6)&&(l.checked=l.__value===m[2]),d&2&&i!==(i=m[20]+"")&&se(a,i)},d(m){m&&v(e),u.r(),c=!1,f()}}}function Rt(t){let e,l=t[13]+"",n;return{c(){e=h("li"),n=U(l)},m(r,o){b(r,e,o),p(e,n)},p(r,o){o&6&&l!==(l=r[13]+"")&&se(n,l)},d(r){r&&v(e)}}}function Ht(t){let e,l=t[13]+"",n;return{c(){e=h("li"),n=U(l)},m(r,o){b(r,e,o),p(e,n)},p(r,o){o&6&&l!==(l=r[13]+"")&&se(n,l)},d(r){r&&v(e)}}}function Gt(t){let e,l=t[13]+"",n;return{c(){e=h("li"),n=U(l)},m(r,o){b(r,e,o),p(e,n)},p(r,o){o&6&&l!==(l=r[13]+"")&&se(n,l)},d(r){r&&v(e)}}}function Ut(t){let e,l,n=t[10].junctionType+"",r,o,i,a,s,u,c=t[10].movementType+"",f,m,d,_,$,N,g,j,O,G,B,z=Y(t[10].scoreZero),H=[];for(let w=0;w<z.length;w+=1)H[w]=Rt(Pt(t,z,w));let M=Y(t[10].scoreOne),T=[];for(let w=0;w<M.length;w+=1)T[w]=Ht(qt(t,M,w));let S=Y(t[10].scoreTwo),I=[];for(let w=0;w<S.length;w+=1)I[w]=Gt(Dt(t,S,w));return{c(){e=h("tr"),l=h("td"),r=U(n),o=L(),i=h("br"),a=L(),s=h("br"),u=L(),f=U(c),m=L(),d=h("td"),_=h("ul");for(let w=0;w<H.length;w+=1)H[w].c();$=L(),N=h("td"),g=h("ul");for(let w=0;w<T.length;w+=1)T[w].c();j=L(),O=h("td"),G=h("ul");for(let w=0;w<I.length;w+=1)I[w].c();B=L(),R(l,"class","type-row svelte-k4kgn3"),R(d,"class","score-zero svelte-k4kgn3"),R(N,"class","score-one svelte-k4kgn3"),R(O,"class","score-two svelte-k4kgn3")},m(w,K){b(w,e,K),p(e,l),p(l,r),p(l,o),p(l,i),p(l,a),p(l,s),p(l,u),p(l,f),p(e,m),p(e,d),p(d,_);for(let C=0;C<H.length;C+=1)H[C]&&H[C].m(_,null);p(e,$),p(e,N),p(N,g);for(let C=0;C<T.length;C+=1)T[C]&&T[C].m(g,null);p(e,j),p(e,O),p(O,G);for(let C=0;C<I.length;C+=1)I[C]&&I[C].m(G,null);p(e,B)},p(w,K){if(K&6&&n!==(n=w[10].junctionType+"")&&se(r,n),K&6&&c!==(c=w[10].movementType+"")&&se(f,c),K&6){z=Y(w[10].scoreZero);let C;for(C=0;C<z.length;C+=1){const $e=Pt(w,z,C);H[C]?H[C].p($e,K):(H[C]=Rt($e),H[C].c(),H[C].m(_,null))}for(;C<H.length;C+=1)H[C].d(1);H.length=z.length}if(K&6){M=Y(w[10].scoreOne);let C;for(C=0;C<M.length;C+=1){const $e=qt(w,M,C);T[C]?T[C].p($e,K):(T[C]=Ht($e),T[C].c(),T[C].m(g,null))}for(;C<T.length;C+=1)T[C].d(1);T.length=M.length}if(K&6){S=Y(w[10].scoreTwo);let C;for(C=0;C<S.length;C+=1){const $e=Dt(w,S,C);I[C]?I[C].p($e,K):(I[C]=Gt($e),I[C].c(),I[C].m(G,null))}for(;C<I.length;C+=1)I[C].d(1);I.length=S.length}},d(w){w&&v(e),ie(H,w),ie(T,w),ie(I,w)}}}function ar(t){let e,l,n,r,o,i,a,s,u,c,f,m,d,_,$,N,g,j=Y(vt),O=[];for(let M=0;M<j.length;M+=1)O[M]=Jt(Ot(t,j,M));let G=Y(mt(t[1])),B=[];for(let M=0;M<G.length;M+=1)B[M]=zt(Ft(t,G,M));let z=Y(Nt(t[1],t[2])),H=[];for(let M=0;M<z.length;M+=1)H[M]=Ut(Et(t,z,M));return{c(){e=h("h1"),e.textContent="LTN 1/20 scoring guidance",l=L(),n=h("p"),n.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,r=L(),o=h("div"),i=U(`Type of junction:
      `),a=h("fieldset");for(let M=0;M<O.length;M+=1)O[M].c();s=U(`

      Type of movement:
      `),u=h("fieldset");for(let M=0;M<B.length;M+=1)B[M].c();c=L(),f=h("table"),m=h("tr"),m.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,d=L();for(let M=0;M<H.length;M+=1)H[M].c();_=L(),$=h("button"),$.textContent="OK",te(o,"display","flex"),te(o,"justify-content","space-between")},m(M,T){b(M,e,T),b(M,l,T),b(M,n,T),b(M,r,T),b(M,o,T),p(o,i),p(o,a);for(let S=0;S<O.length;S+=1)O[S]&&O[S].m(a,null);p(o,s),p(o,u);for(let S=0;S<B.length;S+=1)B[S]&&B[S].m(u,null);b(M,c,T),b(M,f,T),p(f,m),p(f,d);for(let S=0;S<H.length;S+=1)H[S]&&H[S].m(f,null);b(M,_,T),b(M,$,T),N||(g=Z($,"click",t[8]),N=!0)},p(M,T){if(T&10){j=Y(vt);let S;for(S=0;S<j.length;S+=1){const I=Ot(M,j,S);O[S]?O[S].p(I,T):(O[S]=Jt(I),O[S].c(),O[S].m(a,null))}for(;S<O.length;S+=1)O[S].d(1);O.length=j.length}if(T&6){G=Y(mt(M[1]));let S;for(S=0;S<G.length;S+=1){const I=Ft(M,G,S);B[S]?B[S].p(I,T):(B[S]=zt(I),B[S].c(),B[S].m(u,null))}for(;S<B.length;S+=1)B[S].d(1);B.length=G.length}if(T&6){z=Y(Nt(M[1],M[2]));let S;for(S=0;S<z.length;S+=1){const I=Et(M,z,S);H[S]?H[S].p(I,T):(H[S]=Ut(I),H[S].c(),H[S].m(f,null))}for(;S<H.length;S+=1)H[S].d(1);H.length=z.length}},d(M){M&&(v(e),v(l),v(n),v(r),v(o),v(c),v(f),v(_),v($)),ie(O,M),ie(B,M),ie(H,M),N=!1,g()}}}function cr(t){let e,l,n,r,o,i,a=t[0]&&Bt(t);return{c(){e=h("button"),e.textContent="LTN 1/20 scoring guidance",l=L(),a&&a.c(),n=ot(),R(e,"class","secondary")},m(s,u){b(s,e,u),b(s,l,u),a&&a.m(s,u),b(s,n,u),r=!0,o||(i=Z(e,"click",t[4]),o=!0)},p(s,[u]){s[0]?a?(a.p(s,u),u&1&&k(a,1)):(a=Bt(s),a.c(),k(a,1),a.m(n.parentNode,n)):a&&(ge(),y(a,1,1,()=>{a=null}),he())},i(s){r||(k(a),r=!0)},o(s){y(a),r=!1},d(s){s&&(v(e),v(l),v(n)),a&&a.d(s),o=!1,i()}}}function ur(t,e,l){let n=!1,r=vt[0],o=mt(r)[0];function i(){l(2,o=mt(r)[0])}const a=[[],[]],s=()=>l(0,n=!0);function u(){r=this.__value,l(1,r)}function c(){o=this.__value,l(2,o)}return[n,r,o,i,s,u,a,c,()=>l(0,n=!1),()=>l(0,n=!1)]}class fr extends ke{constructor(e){super(),be(this,e,ur,cr,ve,{})}}function Zt(t,e,l){const n=t.slice();return n[11]=e[l][0],n[12]=e[l][1],n}function Kt(t){let e,l;return e=new fr({}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Xt(t){let e,l,n,r=t[12]+"",o,i,a,s,u;return a=_t(t[7][0]),{c(){e=h("label"),l=h("input"),n=L(),o=U(r),i=L(),R(l,"type","radio"),l.__value=t[11],ce(l,l.__value),a.p(l)},m(c,f){b(c,e,f),p(e,l),l.checked=l.__value===t[3].jats[t[0]].properties[t[1]].movements[t[2]].score,p(e,n),p(e,o),p(e,i),s||(u=Z(l,"change",t[9]),s=!0)},p(c,f){f&15&&(l.checked=l.__value===c[3].jats[c[0]].properties[c[1]].movements[c[2]].score)},d(c){c&&v(e),a.r(),s=!1,u()}}}function mr(t){let e,l,n,r,o,i,a,s,u,c,f,m,d,_,$,N,g,j,O,G,B,z,H,M=t[3].jats[t[0]].properties[t[1]].movements[t[2]].kind=="cycling"&&Kt(),T=Y(t[4]),S=[];for(let I=0;I<T.length;I+=1)S[I]=Xt(Zt(t,T,I));return B=_t(t[7][1]),{c(){e=h("label"),l=U(`Name
  `),n=h("input"),r=L(),o=h("fieldset"),i=h("label"),a=h("input"),s=U(`
    Cycling`),u=L(),c=h("label"),f=h("input"),m=U(`
    Walking & Wheeling`),d=L(),M&&M.c(),_=L(),$=h("fieldset");for(let I=0;I<S.length;I+=1)S[I].c();N=L(),g=h("label"),j=U(`Comments
  `),O=h("textarea"),R(n,"type","text"),R(a,"type","radio"),a.__value="cycling",ce(a,a.__value),R(f,"type","radio"),f.__value="walking & wheeling",ce(f,f.__value),B.p(a,f)},m(I,w){b(I,e,w),p(e,l),p(e,n),ce(n,t[3].jats[t[0]].properties[t[1]].movements[t[2]].name),b(I,r,w),b(I,o,w),p(o,i),p(i,a),a.checked=a.__value===t[3].jats[t[0]].properties[t[1]].movements[t[2]].kind,p(i,s),p(o,u),p(o,c),p(c,f),f.checked=f.__value===t[3].jats[t[0]].properties[t[1]].movements[t[2]].kind,p(c,m),b(I,d,w),M&&M.m(I,w),b(I,_,w),b(I,$,w);for(let K=0;K<S.length;K+=1)S[K]&&S[K].m($,null);b(I,N,w),b(I,g,w),p(g,j),p(g,O),ce(O,t[3].jats[t[0]].properties[t[1]].movements[t[2]].notes),G=!0,z||(H=[Z(n,"input",t[5]),Z(a,"change",t[6]),Z(f,"change",t[8]),Z(O,"input",t[10])],z=!0)},p(I,[w]){if(w&15&&n.value!==I[3].jats[I[0]].properties[I[1]].movements[I[2]].name&&ce(n,I[3].jats[I[0]].properties[I[1]].movements[I[2]].name),w&15&&(a.checked=a.__value===I[3].jats[I[0]].properties[I[1]].movements[I[2]].kind),w&15&&(f.checked=f.__value===I[3].jats[I[0]].properties[I[1]].movements[I[2]].kind),I[3].jats[I[0]].properties[I[1]].movements[I[2]].kind=="cycling"?M?w&15&&k(M,1):(M=Kt(),M.c(),k(M,1),M.m(_.parentNode,_)):M&&(ge(),y(M,1,1,()=>{M=null}),he()),w&31){T=Y(I[4]);let K;for(K=0;K<T.length;K+=1){const C=Zt(I,T,K);S[K]?S[K].p(C,w):(S[K]=Xt(C),S[K].c(),S[K].m($,null))}for(;K<S.length;K+=1)S[K].d(1);S.length=T.length}w&15&&ce(O,I[3].jats[I[0]].properties[I[1]].movements[I[2]].notes)},i(I){G||(k(M),G=!0)},o(I){y(M),G=!1},d(I){I&&(v(e),v(r),v(o),v(d),v(_),v($),v(N),v(g)),M&&M.d(I),ie(S,I),B.r(),z=!1,Me(H)}}}function pr(t,e,l){let n;re(t,X,_=>l(3,n=_));let{junctionIdx:r}=e,{stage:o}=e,{idx:i}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];const s=[[],[]];function u(){n.jats[r].properties[o].movements[i].name=this.value,X.set(n)}function c(){n.jats[r].properties[o].movements[i].kind=this.__value,X.set(n)}function f(){n.jats[r].properties[o].movements[i].kind=this.__value,X.set(n)}function m(){n.jats[r].properties[o].movements[i].score=this.__value,X.set(n)}function d(){n.jats[r].properties[o].movements[i].notes=this.value,X.set(n)}return t.$$set=_=>{"junctionIdx"in _&&l(0,r=_.junctionIdx),"stage"in _&&l(1,o=_.stage),"idx"in _&&l(2,i=_.idx)},[r,o,i,n,a,u,c,s,f,m,d]}class dr extends ke{constructor(e){super(),be(this,e,pr,mr,ve,{junctionIdx:0,stage:1,idx:2})}}function _r(t){return t%(2*Math.PI)*180/Math.PI}function ct(t){return t%360*Math.PI/180}function Wt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Zn(t,e,l={}){if(l.final===!0)return gr(t,e);const n=Wt(t),r=Wt(e),o=ct(n[0]),i=ct(r[0]),a=ct(n[1]),s=ct(r[1]),u=Math.sin(i-o)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-o);return _r(Math.atan2(u,c))}function gr(t,e){let l=Zn(e,t);return l=(l+180)%360,l}var Xe=Zn;function hr(t,e,l={}){const n={type:"Feature"};return(l.id===0||l.id)&&(n.id=l.id),l.bbox&&(n.bbox=l.bbox),n.properties=e||{},n.geometry=t,n}function $r(t,e,l={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Vt(t[0])||!Vt(t[1]))throw new Error("coordinates must contain numbers");return hr({type:"Point",coordinates:t},e,l)}function Vt(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function kr(t,e={}){const l=il(t),n=(l[0]+l[2])/2,r=(l[1]+l[3])/2;return $r([n,r],e.properties,e)}var br=kr,Le=63710088e-1,vr={centimeters:Le*100,centimetres:Le*100,degrees:360/(2*Math.PI),feet:Le*3.28084,inches:Le*39.37,kilometers:Le/1e3,kilometres:Le/1e3,meters:Le,metres:Le,miles:Le/1609.344,millimeters:Le*1e3,millimetres:Le*1e3,nauticalmiles:Le/1852,radians:1,yards:Le*1.0936};function wr(t,e,l={}){const n={type:"Feature"};return(l.id===0||l.id)&&(n.id=l.id),l.bbox&&(n.bbox=l.bbox),n.properties=e||{},n.geometry=t,n}function yr(t,e,l={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Yt(t[0])||!Yt(t[1]))throw new Error("coordinates must contain numbers");return wr({type:"Point",coordinates:t},e,l)}function jr(t,e="kilometers"){const l=vr[e];if(!l)throw new Error(e+" units is invalid");return t/l}function Qt(t){return t%(2*Math.PI)*180/Math.PI}function ht(t){return t%360*Math.PI/180}function Yt(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Cr(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Lr(t,e,l,n={}){const r=Cr(t),o=ht(r[0]),i=ht(r[1]),a=ht(l),s=jr(e,n.units),u=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(u)),f=Qt(c),m=Qt(u);return yr([f,m],n.properties)}var lt=Lr,Ae=63710088e-1,Ar={centimeters:Ae*100,centimetres:Ae*100,degrees:360/(2*Math.PI),feet:Ae*3.28084,inches:Ae*39.37,kilometers:Ae/1e3,kilometres:Ae/1e3,meters:Ae,metres:Ae,miles:Ae/1609.344,millimeters:Ae*1e3,millimetres:Ae*1e3,nauticalmiles:Ae/1852,radians:1,yards:Ae*1.0936};function Sr(t,e="kilometers"){const l=Ar[e];if(!l)throw new Error(e+" units is invalid");return t*l}function ut(t){return t%360*Math.PI/180}function xt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Tr(t,e,l={}){var n=xt(t),r=xt(e),o=ut(r[1]-n[1]),i=ut(r[0]-n[0]),a=ut(n[1]),s=ut(r[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return Sr(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),l.units)}var Mr=Tr;function Ir(t){let e=br({type:"FeatureCollection",features:t.map(n=>({type:"Feature",geometry:{type:"Point",coordinates:n.point},properties:{}}))}).geometry.coordinates;t.sort((n,r)=>en(Xe(e,r.point))-en(Xe(e,n.point)));let l=[];for(let n=0;n<t.length;n++){let r=t[n],o=Xe(r.point,e),i=1;for(let a of Er(n,t.length)){let s=t[a],u=Xe(e,s.point),c=Nr(r.point,e,i++),f=Mr(r.point,e),m=lt(c,.5*f,o).geometry.coordinates,d=lt(m,.2*f,u).geometry.coordinates;l.push({point1:c,point2:m,point3:d,kind:"cycling",score:"X",name:`${r.name} to ${s.name}`,notes:""})}}return l}function Nr(t,e,l){let n=.003,o=Xe(t,e)-90,i=n*l;return lt(t,i,o).geometry.coordinates}function en(t){return(t+360)%360}function Er(t,e){let l=[];for(let n=t+1;n<e;n++)l.push(n);for(let n=0;n<t;n++)l.push(n);return l}const Dr="/route-element/assets/movement-aa45473c.svg",qr="/route-element/assets/pan-fbcec4cd.svg";function tn(t,e,l){const n=t.slice();return n[31]=e[l],n[32]=e,n[33]=l,n}function nn(t,e,l){const n=t.slice();return n[34]=e[l],n[35]=e,n[33]=l,n}function ln(t){let e,l,n,r,o,i,a,s,u,c,f,m,d,_,$,N,g,j,O;function G(K,C){return K[0].mode=="select"?Fr:Pr}let B=G(t),z=B(t);function H(K,C){return K[0].mode=="new-arm"?Br:Or}let M=H(t),T=M(t);function S(K,C){return K[0].mode=="new-movement"?zr:Jr}let I=S(t),w=I(t);return{c(){e=h("div"),l=h("button"),n=h("img"),o=L(),z.c(),i=L(),a=h("button"),s=gt("svg"),u=gt("circle"),c=gt("text"),f=U("A"),m=L(),T.c(),d=L(),_=h("button"),$=h("img"),g=L(),w.c(),$t(n.src,r=qr)||R(n,"src",r),R(n,"alt","Move map"),te(n,"vertical-align","middle"),R(l,"class","outline"),R(u,"cx","12"),R(u,"cy","12"),R(u,"r","12"),R(u,"fill","white"),R(c,"x","6"),R(c,"y","16"),R(c,"fill","#4472c4"),R(s,"width","24"),R(s,"height","24"),R(s,"xmlns","http://www.w3.org/2000/svg"),te(s,"vertical-align","middle"),R(a,"class","outline"),$t($.src,N=Dr)||R($,"src",N),R($,"alt","New movement"),te($,"vertical-align","middle"),R(_,"class","outline"),R(e,"class","control-panel svelte-l1e6xi")},m(K,C){b(K,e,C),p(e,l),p(l,n),p(l,o),z.m(l,null),p(e,i),p(e,a),p(a,s),p(s,u),p(s,c),p(c,f),p(a,m),T.m(a,null),p(e,d),p(e,_),p(_,$),p(_,g),w.m(_,null),j||(O=[Z(l,"click",function(){sl(t[4])&&t[4].apply(this,arguments)}),Z(a,"click",t[12]),Z(_,"click",t[13])],j=!0)},p(K,C){t=K,B!==(B=G(t))&&(z.d(1),z=B(t),z&&(z.c(),z.m(l,null))),M!==(M=H(t))&&(T.d(1),T=M(t),T&&(T.c(),T.m(a,null))),I!==(I=S(t))&&(w.d(1),w=I(t),w&&(w.c(),w.m(_,null)))},d(K){K&&v(e),z.d(),T.d(),w.d(),j=!1,Me(O)}}}function Pr(t){let e;return{c(){e=U("Move map")},m(l,n){b(l,e,n)},d(l){l&&v(e)}}}function Fr(t){let e;return{c(){e=h("b"),e.textContent="Move map"},m(l,n){b(l,e,n)},d(l){l&&v(e)}}}function Or(t){let e;return{c(){e=U("New arm")},m(l,n){b(l,e,n)},d(l){l&&v(e)}}}function Br(t){let e;return{c(){e=h("b"),e.textContent="New arm"},m(l,n){b(l,e,n)},d(l){l&&v(e)}}}function Jr(t){let e;return{c(){e=U("New movement")},m(l,n){b(l,e,n)},d(l){l&&v(e)}}}function zr(t){let e;return{c(){e=h("b"),e.textContent="New movement"},m(l,n){b(l,e,n)},d(l){l&&v(e)}}}function Rr(t){let e;return{c(){e=h("span"),e.textContent=`${eo(t[33])}`,R(e,"class","dot svelte-l1e6xi"),te(e,"color","#4472c4"),te(e,"background-color","white")},m(l,n){b(l,e,n)},p:le,d(l){l&&v(e)}}}function rn(t){let e,l,n;function r(s){t[14](s,t[34])}function o(){return t[15](t[33])}function i(){return t[16](t[33])}let a={draggable:!0,$$slots:{default:[Rr]},$$scope:{ctx:t}};return t[34].point!==void 0&&(a.lngLat=t[34].point),e=new Fe({props:a}),we.push(()=>Ne(e,"lngLat",r)),e.$on("dragend",o),e.$on("click",i),{c(){q(e.$$.fragment)},m(s,u){P(e,s,u),n=!0},p(s,u){t=s;const c={};u[1]&32&&(c.$$scope={dirty:u,ctx:t}),!l&&u[0]&38&&(l=!0,c.lngLat=t[34].point,Ee(()=>l=!1)),e.$set(c)},i(s){n||(k(e.$$.fragment,s),n=!0)},o(s){y(e.$$.fragment,s),n=!1},d(s){F(e,s)}}}function Hr(t){let e;return{c(){e=h("span"),R(e,"class","dot svelte-l1e6xi"),te(e,"background-color",t[7][t[31].score]),te(e,"opacity",t[31].kind=="walking & wheeling"?"0%":"100%")},m(l,n){b(l,e,n)},p(l,n){n[0]&38&&te(e,"background-color",l[7][l[31].score]),n[0]&38&&te(e,"opacity",l[31].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&v(e)}}}function Gr(t){let e;return{c(){e=h("span"),R(e,"class","dot svelte-l1e6xi"),te(e,"background-color",t[7][t[31].score])},m(l,n){b(l,e,n)},p(l,n){n[0]&38&&te(e,"background-color",l[7][l[31].score])},d(l){l&&v(e)}}}function Ur(t){let e;return{c(){e=h("span"),R(e,"class","dot svelte-l1e6xi"),te(e,"background-color",t[7][t[31].score]),te(e,"opacity","0%")},m(l,n){b(l,e,n)},p(l,n){n[0]&38&&te(e,"background-color",l[7][l[31].score])},d(l){l&&v(e)}}}function on(t){let e,l,n,r,o,i,a,s,u;function c(z){t[17](z,t[31])}function f(){return t[18](t[33])}function m(){return t[19](t[33])}let d={draggable:!0,$$slots:{default:[Hr]},$$scope:{ctx:t}};t[31].point1!==void 0&&(d.lngLat=t[31].point1),e=new Fe({props:d}),we.push(()=>Ne(e,"lngLat",c)),e.$on("dragend",f),e.$on("click",m);function _(z){t[20](z,t[31])}function $(){return t[21](t[33])}function N(){return t[22](t[33])}let g={draggable:!0,$$slots:{default:[Gr]},$$scope:{ctx:t}};t[31].point2!==void 0&&(g.lngLat=t[31].point2),r=new Fe({props:g}),we.push(()=>Ne(r,"lngLat",_)),r.$on("dragend",$),r.$on("click",N);function j(z){t[23](z,t[31])}function O(){return t[24](t[33])}function G(){return t[25](t[33])}let B={draggable:!0,$$slots:{default:[Ur]},$$scope:{ctx:t}};return t[31].point3!==void 0&&(B.lngLat=t[31].point3),a=new Fe({props:B}),we.push(()=>Ne(a,"lngLat",j)),a.$on("dragend",O),a.$on("click",G),{c(){q(e.$$.fragment),n=L(),q(r.$$.fragment),i=L(),q(a.$$.fragment)},m(z,H){P(e,z,H),b(z,n,H),P(r,z,H),b(z,i,H),P(a,z,H),u=!0},p(z,H){t=z;const M={};H[0]&38|H[1]&32&&(M.$$scope={dirty:H,ctx:t}),!l&&H[0]&38&&(l=!0,M.lngLat=t[31].point1,Ee(()=>l=!1)),e.$set(M);const T={};H[0]&38|H[1]&32&&(T.$$scope={dirty:H,ctx:t}),!o&&H[0]&38&&(o=!0,T.lngLat=t[31].point2,Ee(()=>o=!1)),r.$set(T);const S={};H[0]&38|H[1]&32&&(S.$$scope={dirty:H,ctx:t}),!s&&H[0]&38&&(s=!0,S.lngLat=t[31].point3,Ee(()=>s=!1)),a.$set(S)},i(z){u||(k(e.$$.fragment,z),k(r.$$.fragment,z),k(a.$$.fragment,z),u=!0)},o(z){y(e.$$.fragment,z),y(r.$$.fragment,z),y(a.$$.fragment,z),u=!1},d(z){z&&(v(n),v(i)),F(e,z),F(r,z),F(a,z)}}}function Zr(t){let e=(t[30].name||"Untitled movement")+"",l;return{c(){l=U(e)},m(n,r){b(n,l,r)},p(n,r){r[0]&1073741824&&e!==(e=(n[30].name||"Untitled movement")+"")&&se(l,e)},d(n){n&&v(l)}}}function Kr(t){let e,l;return e=new Rn({props:{$$slots:{default:[Zr,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Xr(t){let e=(t[30].name||"Untitled movement")+"",l;return{c(){l=U(e)},m(n,r){b(n,l,r)},p(n,r){r[0]&1073741824&&e!==(e=(n[30].name||"Untitled movement")+"")&&se(l,e)},d(n){n&&v(l)}}}function Wr(t){let e,l;return e=new Rn({props:{$$slots:{default:[Xr,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Vr(t){let e,l,n,r,o,i;return e=new xe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":tt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Kr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),n=new xe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":tt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Wr]},$$scope:{ctx:t}}}),n.$on("click",t[9]),o=new hl({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){q(e.$$.fragment),l=L(),q(n.$$.fragment),r=L(),q(o.$$.fragment)},m(a,s){P(e,a,s),b(a,l,s),P(n,a,s),b(a,r,s),P(o,a,s),i=!0},p(a,s){const u={};s[1]&32&&(u.$$scope={dirty:s,ctx:a}),e.$set(u);const c={};s[1]&32&&(c.$$scope={dirty:s,ctx:a}),n.$set(c)},i(a){i||(k(e.$$.fragment,a),k(n.$$.fragment,a),k(o.$$.fragment,a),i=!0)},o(a){y(e.$$.fragment,a),y(n.$$.fragment,a),y(o.$$.fragment,a),i=!1},d(a){a&&(v(l),v(r)),F(e,a),F(n,a),F(o,a)}}}function Qr(t){let e,l,n,r;return e=new xe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),n=new De({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){q(e.$$.fragment),l=L(),q(n.$$.fragment)},m(o,i){P(e,o,i),b(o,l,i),P(n,o,i),r=!0},p:le,i(o){r||(k(e.$$.fragment,o),k(n.$$.fragment,o),r=!0)},o(o){y(e.$$.fragment,o),y(n.$$.fragment,o),r=!1},d(o){o&&v(l),F(e,o),F(n,o)}}}function Yr(t){let e,l,n,r,o,i,a,s,u;e=new Hn({}),e.$on("click",t[8]);let c=t[0].mode!="editing"&&ln(t),f=Y(t[5].jats[t[1]].properties[t[2]].arms),m=[];for(let g=0;g<f.length;g+=1)m[g]=rn(nn(t,f,g));const d=g=>y(m[g],1,1,()=>{m[g]=null});let _=Y(t[5].jats[t[1]].properties[t[2]].movements),$=[];for(let g=0;g<_.length;g+=1)$[g]=on(tn(t,_,g));const N=g=>y($[g],1,1,()=>{$[g]=null});return i=new je({props:{data:t[10](t[5]),$$slots:{default:[Vr]},$$scope:{ctx:t}}}),s=new je({props:{data:t[6],$$slots:{default:[Qr]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment),l=L(),c&&c.c(),n=L();for(let g=0;g<m.length;g+=1)m[g].c();r=L();for(let g=0;g<$.length;g+=1)$[g].c();o=L(),q(i.$$.fragment),a=L(),q(s.$$.fragment)},m(g,j){P(e,g,j),b(g,l,j),c&&c.m(g,j),b(g,n,j);for(let O=0;O<m.length;O+=1)m[O]&&m[O].m(g,j);b(g,r,j);for(let O=0;O<$.length;O+=1)$[O]&&$[O].m(g,j);b(g,o,j),P(i,g,j),b(g,a,j),P(s,g,j),u=!0},p(g,j){if(g[0].mode!="editing"?c?c.p(g,j):(c=ln(g),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null),j[0]&46){f=Y(g[5].jats[g[1]].properties[g[2]].arms);let B;for(B=0;B<f.length;B+=1){const z=nn(g,f,B);m[B]?(m[B].p(z,j),k(m[B],1)):(m[B]=rn(z),m[B].c(),k(m[B],1),m[B].m(r.parentNode,r))}for(ge(),B=f.length;B<m.length;B+=1)d(B);he()}if(j[0]&174){_=Y(g[5].jats[g[1]].properties[g[2]].movements);let B;for(B=0;B<_.length;B+=1){const z=tn(g,_,B);$[B]?($[B].p(z,j),k($[B],1)):($[B]=on(z),$[B].c(),k($[B],1),$[B].m(o.parentNode,o))}for(ge(),B=_.length;B<$.length;B+=1)N(B);he()}const O={};j[0]&32&&(O.data=g[10](g[5])),j[1]&32&&(O.$$scope={dirty:j,ctx:g}),i.$set(O);const G={};j[0]&64&&(G.data=g[6]),j[1]&32&&(G.$$scope={dirty:j,ctx:g}),s.$set(G)},i(g){if(!u){k(e.$$.fragment,g);for(let j=0;j<f.length;j+=1)k(m[j]);for(let j=0;j<_.length;j+=1)k($[j]);k(i.$$.fragment,g),k(s.$$.fragment,g),u=!0}},o(g){y(e.$$.fragment,g),m=m.filter(Boolean);for(let j=0;j<m.length;j+=1)y(m[j]);$=$.filter(Boolean);for(let j=0;j<$.length;j+=1)y($[j]);y(i.$$.fragment,g),y(s.$$.fragment,g),u=!1},d(g){g&&(v(l),v(n),v(r),v(o),v(a)),F(e,g),c&&c.d(g),ie(m,g),ie($,g),F(i,g),F(s,g)}}}function xr(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function eo(t){return String.fromCharCode(t+"A".charCodeAt(0))}function to(t,e,l){let n,r,o;re(t,X,D=>l(5,r=D)),re(t,ft,D=>l(26,o=D));let{junctionIdx:i}=e,{stage:a}=e,{mode:s}=e,{hoveringSidebar:u}=e,{select:c}=e,{stopEditing:f}=e,m={0:Pe.red.background,1:Pe.amber.background,2:Pe.green.background,X:Pe.critical.background};function d(D,W,ye){let ae={type:"FeatureCollection",features:[]},E=W.mode=="editing"?W.id:ye;return E!=null&&(E.kind=="arm"?ae.features.push(xr(D.jats[i].properties[a].arms[E.idx],E.idx)):ae.features.push(g(D.jats[i].properties[a].movements[E.idx],E.idx))),ae}async function _(D){if(o){for(let W of o.queryRenderedFeatures(D.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await f();return}s.mode=="new-arm"?(ee(X,r.jats[i].properties[a].arms=[...r.jats[i].properties[a].arms,{point:D.detail.lngLat.toArray(),name:""}],r),await c({kind:"arm",idx:r.jats[i].properties[a].arms.length-1})):(ee(X,r.jats[i].properties[a].movements=[...r.jats[i].properties[a].movements,{point1:D.detail.lngLat.toArray(),point2:lt(D.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:lt(D.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],r),await c({kind:"movement",idx:r.jats[i].properties[a].movements.length-1}))}}}async function $(D){await c({kind:"movement",idx:D.detail.features[0].id})}function N(D){let W={type:"FeatureCollection",features:D.jats[i].properties[a].movements.map((ye,ae)=>g(ye,ae))};for(let ye of D.jats[i].properties[a].movements)if(W.features.push(j(ye,W.features.length)),ye.kind=="walking & wheeling"){let ae={...ye,point1:ye.point3,point3:ye.point1};W.features.push(j(ae,W.features.length))}return W}function g(D,W){return{type:"Feature",id:W,properties:{name:D.name,kind:D.kind,color:m[D.score]},geometry:{type:"LineString",coordinates:[D.point1,D.point2,D.point3]}}}function j(D,W){return{type:"Feature",id:W,properties:{kind:D.kind,color:m[D.score],angle:Xe(D.point2,D.point3)},geometry:{type:"Point",coordinates:D.point3}}}const O=()=>l(0,s={mode:"new-arm"}),G=()=>l(0,s={mode:"new-movement"});function B(D,W){t.$$.not_equal(W.point,D)&&(W.point=D,X.set(r))}const z=D=>c({kind:"arm",idx:D}),H=D=>c({kind:"arm",idx:D});function M(D,W){t.$$.not_equal(W.point1,D)&&(W.point1=D,X.set(r))}const T=D=>c({kind:"movement",idx:D}),S=D=>c({kind:"movement",idx:D});function I(D,W){t.$$.not_equal(W.point2,D)&&(W.point2=D,X.set(r))}const w=D=>c({kind:"movement",idx:D}),K=D=>c({kind:"movement",idx:D});function C(D,W){t.$$.not_equal(W.point3,D)&&(W.point3=D,X.set(r))}const $e=D=>c({kind:"movement",idx:D}),ue=D=>c({kind:"movement",idx:D});return t.$$set=D=>{"junctionIdx"in D&&l(1,i=D.junctionIdx),"stage"in D&&l(2,a=D.stage),"mode"in D&&l(0,s=D.mode),"hoveringSidebar"in D&&l(11,u=D.hoveringSidebar),"select"in D&&l(3,c=D.select),"stopEditing"in D&&l(4,f=D.stopEditing)},t.$$.update=()=>{t.$$.dirty[0]&2081&&l(6,n=d(r,s,u))},[s,i,a,c,f,r,n,m,_,$,N,u,O,G,B,z,H,M,T,S,I,w,K,C,$e,ue]}class no extends ke{constructor(e){super(),be(this,e,to,Yr,ve,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function sn(t){if(t.movements.length==0)return"No movements added";let e=0,l=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],l+=2;let n=e/l*100;return`${Math.round(n)}%`}const{window:lo}=it;function an(t,e,l){const n=t.slice();n[27]=e[l],n[30]=l;const r=n[14][n[27].score];return n[28]=r,n}function cn(t,e,l){const n=t.slice();return n[31]=e[l],n[30]=l,n}function ro(t){let e,l,n,r,o,i,a,s,u;return{c(){e=h("button"),e.textContent="Done",l=L(),n=h("button"),n.textContent="Delete",r=L(),o=h("label"),i=U(`Arm name
        `),a=h("input"),R(a,"type","text")},m(c,f){b(c,e,f),b(c,l,f),b(c,n,f),b(c,r,f),b(c,o,f),p(o,i),p(o,a),ce(a,t[5].jats[t[0]].properties[t[1]].arms[t[2].id.idx].name),s||(u=[Z(e,"click",t[23]),Z(n,"click",t[10]),Z(a,"input",t[24])],s=!0)},p(c,f){f[0]&39&&a.value!==c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name&&ce(a,c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name)},i:le,o:le,d(c){c&&(v(e),v(l),v(n),v(r),v(o)),s=!1,Me(u)}}}function oo(t){let e,l,n,r,o,i,a,s;return e=new dr({props:{junctionIdx:t[0],stage:t[1],idx:t[2].id.idx}}),{c(){q(e.$$.fragment),l=L(),n=h("button"),n.textContent="Save",r=L(),o=h("button"),o.textContent="Delete"},m(u,c){P(e,u,c),b(u,l,c),b(u,n,c),b(u,r,c),b(u,o,c),i=!0,a||(s=[Z(n,"click",t[9]),Z(o,"click",t[10])],a=!0)},p(u,c){const f={};c[0]&1&&(f.junctionIdx=u[0]),c[0]&2&&(f.stage=u[1]),c[0]&4&&(f.idx=u[2].id.idx),e.$set(f)},i(u){i||(k(e.$$.fragment,u),i=!0)},o(u){y(e.$$.fragment,u),i=!1},d(u){u&&(v(l),v(n),v(r),v(o)),F(e,u),a=!1,Me(s)}}}function io(t){let e,l,n,r,o,i,a,s,u,c,f,m,d,_=t[5].jats[t[0]].properties.name+"",$,N,g=sn(t[5].jats[t[0]].properties[t[1]])+"",j,O,G,B,z,H,M,T,S,I,w,K=Y(t[5].jats[t[0]].properties[t[1]].arms),C=[];for(let E=0;E<K.length;E+=1)C[E]=un(cn(t,K,E));const $e=E=>y(C[E],1,1,()=>{C[E]=null});let ue=t[5].jats[t[0]].properties[t[7]].arms.length>0&&fn(t),D=Y(t[5].jats[t[0]].properties[t[1]].movements),W=[];for(let E=0;E<D.length;E+=1)W[E]=mn(an(t,D,E));const ye=E=>y(W[E],1,1,()=>{W[E]=null});let ae=t[5].jats[t[0]].properties[t[7]].movements.length>0&&pn(t);return{c(){e=h("button"),e.textContent="Done",l=L(),n=h("h3"),n.textContent="Arms",r=L();for(let E=0;E<C.length;E+=1)C[E].c();o=L(),ue&&ue.c(),i=L(),a=h("h3"),a.textContent="Movements",s=L(),u=h("p"),c=U("Total JAT score for "),f=U(t[1]),m=U(` junction
        `),d=h("i"),$=U(_),N=U(`
        : `),j=U(g),O=L(),G=h("button"),B=U("Generate cycling movements between all arms"),H=L();for(let E=0;E<W.length;E+=1)W[E].c();M=L(),ae&&ae.c(),T=ot(),R(G,"class","secondary"),G.disabled=z=t[5].jats[t[0]].properties[t[1]].arms.length<2},m(E,Q){b(E,e,Q),b(E,l,Q),b(E,n,Q),b(E,r,Q);for(let x=0;x<C.length;x+=1)C[x]&&C[x].m(E,Q);b(E,o,Q),ue&&ue.m(E,Q),b(E,i,Q),b(E,a,Q),b(E,s,Q),b(E,u,Q),p(u,c),p(u,f),p(u,m),p(u,d),p(d,$),p(u,N),p(u,j),b(E,O,Q),b(E,G,Q),p(G,B),b(E,H,Q);for(let x=0;x<W.length;x+=1)W[x]&&W[x].m(E,Q);b(E,M,Q),ae&&ae.m(E,Q),b(E,T,Q),S=!0,I||(w=[Z(e,"click",t[16]),Z(G,"click",t[15])],I=!0)},p(E,Q){if(Q[0]&299){K=Y(E[5].jats[E[0]].properties[E[1]].arms);let x;for(x=0;x<K.length;x+=1){const qe=cn(E,K,x);C[x]?(C[x].p(qe,Q),k(C[x],1)):(C[x]=un(qe),C[x].c(),k(C[x],1),C[x].m(o.parentNode,o))}for(ge(),x=K.length;x<C.length;x+=1)$e(x);he()}if(E[5].jats[E[0]].properties[E[7]].arms.length>0?ue?ue.p(E,Q):(ue=fn(E),ue.c(),ue.m(i.parentNode,i)):ue&&(ue.d(1),ue=null),(!S||Q[0]&2)&&se(f,E[1]),(!S||Q[0]&33)&&_!==(_=E[5].jats[E[0]].properties.name+"")&&se($,_),(!S||Q[0]&35)&&g!==(g=sn(E[5].jats[E[0]].properties[E[1]])+"")&&se(j,g),(!S||Q[0]&35&&z!==(z=E[5].jats[E[0]].properties[E[1]].arms.length<2))&&(G.disabled=z),Q[0]&16683){D=Y(E[5].jats[E[0]].properties[E[1]].movements);let x;for(x=0;x<D.length;x+=1){const qe=an(E,D,x);W[x]?(W[x].p(qe,Q),k(W[x],1)):(W[x]=mn(qe),W[x].c(),k(W[x],1),W[x].m(M.parentNode,M))}for(ge(),x=D.length;x<W.length;x+=1)ye(x);he()}E[5].jats[E[0]].properties[E[7]].movements.length>0?ae?ae.p(E,Q):(ae=pn(E),ae.c(),ae.m(T.parentNode,T)):ae&&(ae.d(1),ae=null)},i(E){if(!S){for(let Q=0;Q<K.length;Q+=1)k(C[Q]);for(let Q=0;Q<D.length;Q+=1)k(W[Q]);S=!0}},o(E){C=C.filter(Boolean);for(let Q=0;Q<C.length;Q+=1)y(C[Q]);W=W.filter(Boolean);for(let Q=0;Q<W.length;Q+=1)y(W[Q]);S=!1},d(E){E&&(v(e),v(l),v(n),v(r),v(o),v(i),v(a),v(s),v(u),v(O),v(G),v(H),v(M),v(T)),ie(C,E),ue&&ue.d(E),ie(W,E),ae&&ae.d(E),I=!1,Me(w)}}}function un(t){let e,l;function n(){return t[17](t[30])}function r(){return t[18](t[30])}return e=new Gn({props:{name:`${dn(t[30])} - ${t[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",n),e.$on("mouseenter",r),e.$on("mouseleave",t[19]),{c(){q(e.$$.fragment)},m(o,i){P(e,o,i),l=!0},p(o,i){t=o;const a={};i[0]&35&&(a.name=`${dn(t[30])} - ${t[31].name||"Unnamed arm"}`),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){F(e,o)}}}function fn(t){let e,l,n;return{c(){e=h("button"),e.textContent=`Copy arms from ${t[7]}`,R(e,"class","secondary")},m(r,o){b(r,e,o),l||(n=Z(e,"click",t[12]),l=!0)},p:le,d(r){r&&v(e),l=!1,n()}}}function so(t){let e,l,n,r=t[27].score+"",o,i,a,s=_n(t[27].kind)+"",u;return{c(){e=h("div"),l=h("span"),n=U("Score: "),o=U(r),i=L(),a=h("span"),u=U(s),te(l,"padding","4px"),te(l,"color",t[28].font),te(l,"background-color",t[28].background),te(e,"width","100%"),te(e,"display","flex"),te(e,"justify-content","space-between")},m(c,f){b(c,e,f),p(e,l),p(l,n),p(l,o),p(e,i),p(e,a),p(a,u)},p(c,f){f[0]&35&&r!==(r=c[27].score+"")&&se(o,r),f[0]&35&&te(l,"color",c[28].font),f[0]&35&&te(l,"background-color",c[28].background),f[0]&35&&s!==(s=_n(c[27].kind)+"")&&se(u,s)},d(c){c&&v(e)}}}function mn(t){let e,l;function n(){return t[20](t[30])}function r(){return t[21](t[30])}return e=new Gn({props:{name:t[27].name||"Unnamed movement",$$slots:{default:[so]},$$scope:{ctx:t}}}),e.$on("click",n),e.$on("mouseenter",r),e.$on("mouseleave",t[22]),{c(){q(e.$$.fragment)},m(o,i){P(e,o,i),l=!0},p(o,i){t=o;const a={};i[0]&35&&(a.name=t[27].name||"Unnamed movement"),i[0]&35|i[1]&4&&(a.$$scope={dirty:i,ctx:t}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){F(e,o)}}}function pn(t){let e,l,n;return{c(){e=h("button"),e.textContent=`Copy movements from ${t[7]}`,R(e,"class","secondary")},m(r,o){b(r,e,o),l||(n=Z(e,"click",t[13]),l=!0)},p:le,d(r){r&&v(e),l=!1,n()}}}function ao(t){let e,l,n,r,o=t[5].jats[t[0]].properties.name+"",i,a,s,u,c;const f=[io,oo,ro],m=[];function d(_,$){return _[2].mode!="editing"?0:_[2].id.kind=="movement"?1:2}return s=d(t),u=m[s]=f[s](t),{c(){e=h("div"),l=h("h2"),n=U(t[1]),r=U(" JAT for "),i=U(o),a=L(),u.c(),R(e,"slot","sidebar")},m(_,$){b(_,e,$),p(e,l),p(l,n),p(l,r),p(l,i),p(e,a),m[s].m(e,null),t[25](e),c=!0},p(_,$){(!c||$[0]&2)&&se(n,_[1]),(!c||$[0]&33)&&o!==(o=_[5].jats[_[0]].properties.name+"")&&se(i,o);let N=s;s=d(_),s===N?m[s].p(_,$):(ge(),y(m[N],1,1,()=>{m[N]=null}),he(),u=m[s],u?u.p(_,$):(u=m[s]=f[s](_),u.c()),k(u,1),u.m(e,null))},i(_){c||(k(u),c=!0)},o(_){y(u),c=!1},d(_){_&&v(e),m[s].d(),t[25](null)}}}function co(t){let e,l;return e=new De({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r[0]&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function uo(t){let e,l,n,r,o,i,a;return l=new nt({props:{except:"jats"}}),r=new je({props:{data:oe(t[5].jats),generateId:!0,$$slots:{default:[co]},$$scope:{ctx:t}}}),i=new no({props:{junctionIdx:t[0],stage:t[1],mode:t[2],hoveringSidebar:t[3],select:t[8],stopEditing:t[9]}}),{c(){e=h("div"),q(l.$$.fragment),n=L(),q(r.$$.fragment),o=L(),q(i.$$.fragment),R(e,"slot","map")},m(s,u){b(s,e,u),P(l,e,null),p(e,n),P(r,e,null),p(e,o),P(i,e,null),a=!0},p(s,u){const c={};u[0]&32&&(c.data=oe(s[5].jats)),u[0]&1|u[1]&4&&(c.$$scope={dirty:u,ctx:s}),r.$set(c);const f={};u[0]&1&&(f.junctionIdx=s[0]),u[0]&2&&(f.stage=s[1]),u[0]&4&&(f.mode=s[2]),u[0]&8&&(f.hoveringSidebar=s[3]),i.$set(f)},i(s){a||(k(l.$$.fragment,s),k(r.$$.fragment,s),k(i.$$.fragment,s),a=!0)},o(s){y(l.$$.fragment,s),y(r.$$.fragment,s),y(i.$$.fragment,s),a=!1},d(s){s&&v(e),F(l),F(r),F(i)}}}function fo(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[uo],sidebar:[ao]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(o,i){P(e,o,i),l=!0,n||(r=Z(lo,"keydown",t[11]),n=!0)},p(o,i){const a={};i[0]&127|i[1]&4&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function dn(t){return String.fromCharCode(t+"A".charCodeAt(0))}function _n(t){return t.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function mo(t,e,l){let n,r;re(t,X,C=>l(5,n=C)),re(t,ne,C=>l(6,r=C));let{junctionIdx:o}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s={mode:"select"},u=null,c=null,f;async function m(C){u=f.scrollTop,l(2,s={mode:"editing",id:C}),l(3,c=null),await et(),l(4,f.scrollTop=0,f)}async function d(){l(2,s={mode:"select"}),u!=null&&(await et(),l(4,f.scrollTop=u,f),u=null)}function _(){s.mode=="editing"&&window.confirm(`Delete this ${s.id.kind}?`)&&(s.id.kind=="movement"?(n.jats[o].properties[i].movements.splice(s.id.idx,1),X.set(n)):(n.jats[o].properties[i].arms.splice(s.id.idx,1),X.set(n)),d())}function $(C){if(s.mode!="editing")return;let $e=C.target.tagName,ue=$e=="INPUT"||$e=="TEXTAREA";C.key=="Escape"||C.key=="Enter"&&!ue?(C.stopPropagation(),d()):C.key=="Delete"&&!ue&&(C.stopPropagation(),_())}function N(){n.jats[o].properties[i].arms.length>0&&!window.confirm("Overwrite arms?")||(ee(X,n.jats[o].properties[i].arms=JSON.parse(JSON.stringify(n.jats[o].properties[a].arms)),n),X.set(n))}function g(){n.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite movements?")||(ee(X,n.jats[o].properties[i].movements=JSON.parse(JSON.stringify(n.jats[o].properties[a].movements)),n),X.set(n))}let j={0:Pe.red,1:Pe.amber,2:Pe.green,X:Pe.critical};function O(){if(n.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let C=n.jats[o].properties[i].movements.filter($e=>$e.kind=="walking & wheeling");ee(X,n.jats[o].properties[i].movements=[...C,...Ir(n.jats[o].properties[i].arms)],n)}const G=()=>ee(ne,r={kind:"edit-jat",idx:o},r),B=C=>m({kind:"arm",idx:C}),z=C=>l(3,c={kind:"arm",idx:C}),H=()=>l(3,c=null),M=C=>m({kind:"movement",idx:C}),T=C=>l(3,c={kind:"movement",idx:C}),S=()=>l(3,c=null),I=()=>l(2,s={mode:"select"});function w(){n.jats[o].properties[i].arms[s.id.idx].name=this.value,X.set(n)}function K(C){we[C?"unshift":"push"](()=>{f=C,l(4,f)})}return t.$$set=C=>{"junctionIdx"in C&&l(0,o=C.junctionIdx),"stage"in C&&l(1,i=C.stage)},[o,i,s,c,f,n,r,a,m,d,_,$,N,g,j,O,G,B,z,H,M,T,S,I,w,K]}class po extends ke{constructor(e){super(),be(this,e,mo,fo,ve,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:_o}=it;function go(t){let e,l,n,r,o,i,a,s,u,c,f,m,d,_;return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=L(),r=h("button"),r.textContent="Delete JAT",o=L(),i=h("label"),a=U(`Name:
      `),s=h("input"),u=L(),c=h("button"),c.textContent="Existing",f=L(),m=h("button"),m.textContent="Proposed",R(s,"type","text"),R(e,"slot","sidebar")},m($,N){b($,e,N),p(e,l),p(e,n),p(e,r),p(e,o),p(e,i),p(i,a),p(i,s),ce(s,t[1].jats[t[0]].properties.name),p(e,u),p(e,c),p(e,f),p(e,m),d||(_=[Z(l,"click",t[6]),Z(r,"click",t[4]),Z(s,"input",t[7]),Z(c,"click",t[8]),Z(m,"click",t[9])],d=!0)},p($,N){N&3&&s.value!==$[1].jats[$[0]].properties.name&&ce(s,$[1].jats[$[0]].properties.name)},d($){$&&v(e),d=!1,Me(_)}}}function ho(t){let e,l;return e=new De({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function $o(t){let e;return{c(){e=h("span"),R(e,"class","dot svelte-114j1n1"),te(e,"border-color",t[1].jats[t[0]].properties.color)},m(l,n){b(l,e,n)},p(l,n){n&3&&te(e,"border-color",l[1].jats[l[0]].properties.color)},d(l){l&&v(e)}}}function ko(t){let e,l,n,r,o,i,a,s;l=new nt({props:{except:"jats"}}),r=new je({props:{data:oe(t[1].jats),generateId:!0,$$slots:{default:[ho]},$$scope:{ctx:t}}});function u(f){t[5](f)}let c={draggable:!0,$$slots:{default:[$o]},$$scope:{ctx:t}};return t[1].jats[t[0]].geometry.coordinates!==void 0&&(c.lngLat=t[1].jats[t[0]].geometry.coordinates),i=new Fe({props:c}),we.push(()=>Ne(i,"lngLat",u)),{c(){e=h("div"),q(l.$$.fragment),n=L(),q(r.$$.fragment),o=L(),q(i.$$.fragment),R(e,"slot","map")},m(f,m){b(f,e,m),P(l,e,null),p(e,n),P(r,e,null),p(e,o),P(i,e,null),s=!0},p(f,m){const d={};m&2&&(d.data=oe(f[1].jats)),m&1025&&(d.$$scope={dirty:m,ctx:f}),r.$set(d);const _={};m&1027&&(_.$$scope={dirty:m,ctx:f}),!a&&m&3&&(a=!0,_.lngLat=f[1].jats[f[0]].geometry.coordinates,Ee(()=>a=!1)),i.$set(_)},i(f){s||(k(l.$$.fragment,f),k(r.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),y(r.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),F(l),F(r),F(i)}}}function bo(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[ko],sidebar:[go]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(o,i){P(e,o,i),l=!0,n||(r=Z(_o,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function vo(t,e,l){let n,r;re(t,X,d=>l(1,n=d)),re(t,ne,d=>l(2,r=d));let{idx:o}=e;function i(d){d.key=="Escape"&&ee(ne,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this JAT?")&&(ee(ne,r={kind:"neutral"},r),await et(),n.jats.splice(o,1),X.set(n))}function s(d){t.$$.not_equal(n.jats[o].geometry.coordinates,d)&&(n.jats[o].geometry.coordinates=d,X.set(n))}const u=()=>ee(ne,r={kind:"neutral"},r);function c(){n.jats[o].properties.name=this.value,X.set(n)}const f=()=>ee(ne,r={kind:"edit-jat-detail",idx:o,stage:"existing"},r),m=()=>ee(ne,r={kind:"edit-jat-detail",idx:o,stage:"proposed"},r);return t.$$set=d=>{"idx"in d&&l(0,o=d.idx)},[o,n,r,i,a,s,u,c,f,m]}class wo extends ke{constructor(e){super(),be(this,e,vo,bo,ve,{idx:0})}}function gn(t,e,l){const n=t.slice();return n[3]=e[l],n[4]=e,n[5]=l,n}function yo(t){let e,l;return{c(){e=h("span"),l=L(),R(e,"class","dot svelte-jgyhla")},m(n,r){b(n,e,r),b(n,l,r)},p:le,d(n){n&&(v(e),v(l))}}}function hn(t){let e,l,n;function r(i){t[2](i,t[3],t[4],t[5])}let o={draggable:!0,$$slots:{default:[yo]},$$scope:{ctx:t}};return t[3]!==void 0&&(o.lngLat=t[3]),e=new Fe({props:o}),we.push(()=>Ne(e,"lngLat",r)),{c(){q(e.$$.fragment)},m(i,a){P(e,i,a),n=!0},p(i,a){t=i;const s={};a&64&&(s.$$scope={dirty:a,ctx:t}),!l&&a&1&&(l=!0,s.lngLat=t[3],Ee(()=>l=!1)),e.$set(s)},i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){y(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function jo(t){let e,l,n,r;e=new Hn({}),e.$on("click",t[1]);let o=Y(t[0].geometry.coordinates),i=[];for(let s=0;s<o.length;s+=1)i[s]=hn(gn(t,o,s));const a=s=>y(i[s],1,1,()=>{i[s]=null});return{c(){q(e.$$.fragment),l=L();for(let s=0;s<i.length;s+=1)i[s].c();n=ot()},m(s,u){P(e,s,u),b(s,l,u);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(s,u);b(s,n,u),r=!0},p(s,[u]){if(u&1){o=Y(s[0].geometry.coordinates);let c;for(c=0;c<o.length;c+=1){const f=gn(s,o,c);i[c]?(i[c].p(f,u),k(i[c],1)):(i[c]=hn(f),i[c].c(),k(i[c],1),i[c].m(n.parentNode,n))}for(ge(),c=o.length;c<i.length;c+=1)a(c);he()}},i(s){if(!r){k(e.$$.fragment,s);for(let u=0;u<o.length;u+=1)k(i[u]);r=!0}},o(s){y(e.$$.fragment,s),i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)y(i[u]);r=!1},d(s){s&&(v(l),v(n)),F(e,s),ie(i,s)}}}function Co(t,e,l){let{f:n}=e;function r(i){n.geometry.coordinates.push(i.detail.lngLat.toArray()),l(0,n)}function o(i,a,s,u){s[u]=i,l(0,n)}return t.$$set=i=>{"f"in i&&l(0,n=i.f)},[n,r,o]}class Lo extends ke{constructor(e){super(),be(this,e,Co,jo,ve,{f:0})}}const{window:Ao}=it;function $n(t,e,l){const n=t.slice();return n[10]=e[l],n[11]=e,n[12]=l,n}function So(t,e,l){const n=t.slice();return n[13]=e[l],n}function kn(t){let e;return{c(){e=h("p"),e.textContent="A link needs at least two points"},m(l,n){b(l,e,n)},d(l){l&&v(e)}}}function To(t){let e;return{c(){e=h("option"),e.textContent=`${t[13]}`,e.__value=t[13],ce(e,e.__value)},m(l,n){b(l,e,n)},p:le,d(l){l&&v(e)}}}function bn(t){let e,l=t[10].name+"",n,r,o=t[10].description+"",i,a,s,u,c,f,m=Y(t[10].choices),d=[];for(let $=0;$<m.length;$+=1)d[$]=To(So(t,m,$));function _(){t[9].call(s,t[12])}return{c(){e=h("label"),n=U(l),r=U(": "),i=U(o),a=L(),s=h("select");for(let $=0;$<d.length;$+=1)d[$].c();u=L(),t[1].links[t[0]].properties.answers[t[12]]===void 0&&pt(_)},m($,N){b($,e,N),p(e,n),p(e,r),p(e,i),p(e,a),p(e,s);for(let g=0;g<d.length;g+=1)d[g]&&d[g].m(s,null);Oe(s,t[1].links[t[0]].properties.answers[t[12]],!0),p(e,u),c||(f=Z(s,"change",_),c=!0)},p($,N){t=$,N&3&&Oe(s,t[1].links[t[0]].properties.answers[t[12]])},d($){$&&v(e),ie(d,$),c=!1,f()}}}function Mo(t){let e,l,n,r,o,i,a,s,u,c,f,m,d,_,$=!t[2]&&kn(),N=Y(Te),g=[];for(let j=0;j<N.length;j+=1)g[j]=bn($n(t,N,j));return{c(){e=h("div"),l=h("button"),n=U("Done"),o=L(),i=h("button"),i.textContent="Delete link",a=L(),$&&$.c(),s=L(),u=h("label"),c=U(`Name:
      `),f=h("input"),m=L();for(let j=0;j<g.length;j+=1)g[j].c();l.disabled=r=!t[2],R(f,"type","text"),R(e,"slot","sidebar")},m(j,O){b(j,e,O),p(e,l),p(l,n),p(e,o),p(e,i),p(e,a),$&&$.m(e,null),p(e,s),p(e,u),p(u,c),p(u,f),ce(f,t[1].links[t[0]].properties.name),p(e,m);for(let G=0;G<g.length;G+=1)g[G]&&g[G].m(e,null);d||(_=[Z(l,"click",t[7]),Z(i,"click",t[5]),Z(f,"input",t[8])],d=!0)},p(j,O){if(O&4&&r!==(r=!j[2])&&(l.disabled=r),j[2]?$&&($.d(1),$=null):$||($=kn(),$.c(),$.m(e,s)),O&3&&f.value!==j[1].links[j[0]].properties.name&&ce(f,j[1].links[j[0]].properties.name),O&3){N=Y(Te);let G;for(G=0;G<N.length;G+=1){const B=$n(j,N,G);g[G]?g[G].p(B,O):(g[G]=bn(B),g[G].c(),g[G].m(e,null))}for(;G<g.length;G+=1)g[G].d(1);g.length=N.length}},d(j){j&&v(e),$&&$.d(),ie(g,j),d=!1,Me(_)}}}function Io(t){let e,l;return e=new xe({props:{paint:{"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.paint={"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function No(t){let e,l,n,r,o,i,a,s;l=new nt({props:{except:"links"}}),r=new je({props:{data:oe(t[1].links),generateId:!0,$$slots:{default:[Io]},$$scope:{ctx:t}}});function u(f){t[6](f)}let c={};return t[1].links[t[0]]!==void 0&&(c.f=t[1].links[t[0]]),i=new Lo({props:c}),we.push(()=>Ne(i,"f",u)),{c(){e=h("div"),q(l.$$.fragment),n=L(),q(r.$$.fragment),o=L(),q(i.$$.fragment),R(e,"slot","map")},m(f,m){b(f,e,m),P(l,e,null),p(e,n),P(r,e,null),p(e,o),P(i,e,null),s=!0},p(f,m){const d={};m&2&&(d.data=oe(f[1].links)),m&65537&&(d.$$scope={dirty:m,ctx:f}),r.$set(d);const _={};!a&&m&3&&(a=!0,_.f=f[1].links[f[0]],Ee(()=>a=!1)),i.$set(_)},i(f){s||(k(l.$$.fragment,f),k(r.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),y(r.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),F(l),F(r),F(i)}}}function Eo(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[No],sidebar:[Mo]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(o,i){P(e,o,i),l=!0,n||(r=Z(Ao,"keydown",t[4]),n=!0)},p(o,[i]){const a={};i&65551&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function Do(t,e,l){let n,r,o;re(t,X,d=>l(1,r=d)),re(t,ne,d=>l(3,o=d));let{idx:i}=e;function a(d){d.key=="Escape"&&n&&ee(ne,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this link?")&&(ee(ne,o={kind:"neutral"},o),await et(),r.links.splice(i,1),X.set(r))}function u(d){t.$$.not_equal(r.links[i],d)&&(r.links[i]=d,X.set(r))}const c=()=>ee(ne,o={kind:"neutral"},o);function f(){r.links[i].properties.name=this.value,X.set(r)}function m(d){r.links[i].properties.answers[d]=dt(this),X.set(r)}return t.$$set=d=>{"idx"in d&&l(0,i=d.idx)},t.$$.update=()=>{t.$$.dirty&3&&l(2,n=r.links[i].geometry.coordinates.length>=2)},[i,r,n,o,a,s,u,c,f,m]}class qo extends ke{constructor(e){super(),be(this,e,Do,Eo,ve,{idx:0})}}function vn(t,e,l){const n=t.slice();return n[6]=e[l],n[7]=e,n[8]=l,n}function wn(t,e,l){const n=t.slice();return n[9]=e[l],n}function yn(t){let e,l=t[9]+"",n,r;return{c(){e=h("option"),n=U(l),e.__value=r=t[9],ce(e,e.__value)},m(o,i){b(o,e,i),p(e,n)},p(o,i){i&1&&l!==(l=o[9]+"")&&se(n,l),i&1&&r!==(r=o[9])&&(e.__value=r,ce(e,e.__value))},d(o){o&&v(e)}}}function jn(t){let e,l,n=t[6].properties.name+"",r,o,i,a,s,u,c=Y(Te[t[0]].choices),f=[];for(let d=0;d<c.length;d+=1)f[d]=yn(wn(t,c,d));function m(){t[5].call(i,t[7],t[8])}return{c(){e=h("li"),l=h("span"),r=U(n),o=L(),i=h("select");for(let d=0;d<f.length;d+=1)f[d].c();a=L(),te(l,"color",t[6].properties.color),t[6].properties.answers[t[0]]===void 0&&pt(m)},m(d,_){b(d,e,_),p(e,l),p(l,r),p(e,o),p(e,i);for(let $=0;$<f.length;$+=1)f[$]&&f[$].m(i,null);Oe(i,t[6].properties.answers[t[0]],!0),p(e,a),s||(u=Z(i,"change",m),s=!0)},p(d,_){if(t=d,_&4&&n!==(n=t[6].properties.name+"")&&se(r,n),_&4&&te(l,"color",t[6].properties.color),_&1){c=Y(Te[t[0]].choices);let $;for($=0;$<c.length;$+=1){const N=wn(t,c,$);f[$]?f[$].p(N,_):(f[$]=yn(N),f[$].c(),f[$].m(i,null))}for(;$<f.length;$+=1)f[$].d(1);f.length=c.length}_&5&&Oe(i,t[6].properties.answers[t[0]])},d(d){d&&v(e),ie(f,d),s=!1,u()}}}function Po(t){let e,l,n,r,o=Te[t[0]].name+"",i,a,s=Te[t[0]].description+"",u,c,f,m,d,_=Y(t[2].links),$=[];for(let N=0;N<_.length;N+=1)$[N]=jn(vn(t,_,N));return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=L(),r=h("h2"),i=U(o),a=U(": "),u=U(s),c=L(),f=h("ol");for(let N=0;N<$.length;N+=1)$[N].c();R(e,"slot","sidebar")},m(N,g){b(N,e,g),p(e,l),p(e,n),p(e,r),p(r,i),p(r,a),p(r,u),p(e,c),p(e,f);for(let j=0;j<$.length;j+=1)$[j]&&$[j].m(f,null);m||(d=Z(l,"click",t[4]),m=!0)},p(N,g){if(g&1&&o!==(o=Te[N[0]].name+"")&&se(i,o),g&1&&s!==(s=Te[N[0]].description+"")&&se(u,s),g&5){_=Y(N[2].links);let j;for(j=0;j<_.length;j+=1){const O=vn(N,_,j);$[j]?$[j].p(O,g):($[j]=jn(O),$[j].c(),$[j].m(f,null))}for(;j<$.length;j+=1)$[j].d(1);$.length=_.length}},d(N){N&&v(e),ie($,N),m=!1,d()}}}function Fo(t){let e,l,n;return l=new nt({props:{showLinkColor:!0,except:""}}),{c(){e=h("div"),q(l.$$.fragment),R(e,"slot","map")},m(r,o){b(r,e,o),P(l,e,null),n=!0},p:le,i(r){n||(k(l.$$.fragment,r),n=!0)},o(r){y(l.$$.fragment,r),n=!1},d(r){r&&v(e),F(l)}}}function Oo(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[Fo],sidebar:[Po]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(o,i){P(e,o,i),l=!0,n||(r=Z(window,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&4103&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function Bo(t,e,l){let n,r;re(t,ne,u=>l(1,n=u)),re(t,X,u=>l(2,r=u));let{qIdx:o}=e;function i(u){u.key=="Escape"&&ee(ne,n={kind:"neutral"},n)}const a=()=>ee(ne,n={kind:"neutral"},n);function s(u,c){u[c].properties.answers[o]=dt(this),X.set(r),l(0,o)}return t.$$set=u=>{"qIdx"in u&&l(0,o=u.qIdx)},[o,n,r,i,a,s]}class Jo extends ke{constructor(e){super(),be(this,e,Bo,Oo,ve,{qIdx:0})}}function zo(t){let e,l,n,r;const o=t[2].default,i=We(o,t,t[1],null);return{c(){e=h("a"),i&&i.c(),R(e,"href","#"),te(e,"color",t[0])},m(a,s){b(a,e,s),i&&i.m(e,null),l=!0,n||(r=Z(e,"click",al(t[3])),n=!0)},p(a,[s]){i&&i.p&&(!l||s&2)&&Ve(i,o,a,a[1],l?Ye(o,a[1],s,null):Qe(a[1]),null),s&1&&te(e,"color",a[0])},i(a){l||(k(i,a),l=!0)},o(a){y(i,a),l=!1},d(a){a&&v(e),i&&i.d(a),n=!1,r()}}}function Ro(t,e,l){let{$$slots:n={},$$scope:r}=e,{color:o=void 0}=e;function i(a){Ie.call(this,t,a)}return t.$$set=a=>{"color"in a&&l(0,o=a.color),"$$scope"in a&&l(1,r=a.$$scope)},[o,r,n,i]}class st extends ke{constructor(e){super(),be(this,e,Ro,zo,ve,{color:0})}}function Cn(t,e,l){const n=t.slice();return n[2]=e[l],n[4]=l,n}function Ln(t,e,l){const n=t.slice();n[5]=e[l];const r=n[5].properties.answers[n[4]];return n[6]=r,n}function An(t,e,l){const n=t.slice();return n[5]=e[l],n}function Sn(t){let e,l=t[5].properties.name+"",n;return{c(){e=h("th"),n=U(l),te(e,"color",t[5].properties.color)},m(r,o){b(r,e,o),p(e,n)},p(r,o){o&1&&l!==(l=r[5].properties.name+"")&&se(n,l),o&1&&te(e,"color",r[5].properties.color)},d(r){r&&v(e)}}}function Tn(t){let e,l=t[6]+"",n;return{c(){e=h("td"),n=U(l),te(e,"background",t[6]==""?"red":"green")},m(r,o){b(r,e,o),p(e,n)},p(r,o){o&1&&l!==(l=r[6]+"")&&se(n,l),o&1&&te(e,"background",r[6]==""?"red":"green")},d(r){r&&v(e)}}}function Mn(t){let e,l,n,r,o=Y(t[0].links),i=[];for(let a=0;a<o.length;a+=1)i[a]=Tn(Ln(t,o,a));return{c(){e=h("tr"),l=h("th"),l.textContent=`${t[2].name}`,n=L();for(let a=0;a<i.length;a+=1)i[a].c();r=L()},m(a,s){b(a,e,s),p(e,l),p(e,n);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);p(e,r)},p(a,s){if(s&1){o=Y(a[0].links);let u;for(u=0;u<o.length;u+=1){const c=Ln(a,o,u);i[u]?i[u].p(c,s):(i[u]=Tn(c),i[u].c(),i[u].m(e,r))}for(;u<i.length;u+=1)i[u].d(1);i.length=o.length}},d(a){a&&v(e),ie(i,a)}}}function Ho(t){let e,l,n,r,o,i,a,s=Y(t[0].links),u=[];for(let m=0;m<s.length;m+=1)u[m]=Sn(An(t,s,m));let c=Y(Te),f=[];for(let m=0;m<c.length;m+=1)f[m]=Mn(Cn(t,c,m));return{c(){e=h("table"),l=h("thead"),n=h("tr"),r=h("th"),o=L();for(let m=0;m<u.length;m+=1)u[m].c();i=L(),a=h("tbody");for(let m=0;m<f.length;m+=1)f[m].c()},m(m,d){b(m,e,d),p(e,l),p(l,n),p(n,r),p(n,o);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(n,null);p(e,i),p(e,a);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(a,null)},p(m,d){if(d&1){s=Y(m[0].links);let _;for(_=0;_<s.length;_+=1){const $=An(m,s,_);u[_]?u[_].p($,d):(u[_]=Sn($),u[_].c(),u[_].m(n,null))}for(;_<u.length;_+=1)u[_].d(1);u.length=s.length}if(d&1){c=Y(Te);let _;for(_=0;_<c.length;_+=1){const $=Cn(m,c,_);f[_]?f[_].p($,d):(f[_]=Mn($),f[_].c(),f[_].m(a,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=c.length}},d(m){m&&v(e),ie(u,m),ie(f,m)}}}function Go(t){let e,l;return e=new Un({props:{$$slots:{default:[Ho]},$$scope:{ctx:t}}}),e.$on("close",t[1]),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,[r]){const o={};r&2049&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Uo(t,e,l){let n;re(t,X,o=>l(0,n=o));function r(o){Ie.call(this,t,o)}return[n,r]}class Zo extends ke{constructor(e){super(),be(this,e,Uo,Go,ve,{})}}function In(t,e,l){const n=t.slice();return n[22]=e[l],n[24]=l,n}function Nn(t,e,l){const n=t.slice();return n[25]=e[l],n[24]=l,n}function En(t,e,l){const n=t.slice();return n[27]=e[l],n[24]=l,n}function Dn(t,e,l){const n=t.slice();return n[29]=e[l],n[24]=l,n}function qn(t,e,l){const n=t.slice();return n[31]=e[l],n[24]=l,n}function Pn(t){let e,l;return e=new Zo({}),e.$on("close",t[8]),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p:le,i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ko(t){let e=t[31].properties.name+"",l;return{c(){l=U(e)},m(n,r){b(n,l,r)},p(n,r){r[0]&2&&e!==(e=n[31].properties.name+"")&&se(l,e)},d(n){n&&v(l)}}}function Fn(t){let e,l,n,r;function o(){return t[15](t[24])}return l=new st({props:{color:t[31].properties.color,$$slots:{default:[Ko]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),q(l.$$.fragment),n=L()},m(i,a){b(i,e,a),P(l,e,null),p(e,n),r=!0},p(i,a){t=i;const s={};a[0]&2&&(s.color=t[31].properties.color),a[0]&2|a[1]&4&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&v(e),F(l)}}}function Xo(t){let e=t[29].name+"",l,n;return{c(){l=U(e),n=L()},m(r,o){b(r,l,o),b(r,n,o)},p:le,d(r){r&&(v(l),v(n))}}}function On(t){let e,l,n,r,o,i,a,s;function u(){return t[16](t[24])}l=new st({props:{$$slots:{default:[Xo]},$$scope:{ctx:t}}}),l.$on("click",u);function c(...f){return t[17](t[24],...f)}return{c(){e=h("li"),q(l.$$.fragment),n=U(`:
          `),r=h("progress"),a=L(),r.value=o=t[1].links.filter(c).length,R(r,"max",i=t[1].links.length),R(r,"class","svelte-zadug4")},m(f,m){b(f,e,m),P(l,e,null),p(e,n),p(e,r),p(e,a),s=!0},p(f,m){t=f;const d={};m[1]&4&&(d.$$scope={dirty:m,ctx:t}),l.$set(d),(!s||m[0]&2&&o!==(o=t[1].links.filter(c).length))&&(r.value=o),(!s||m[0]&2&&i!==(i=t[1].links.length))&&R(r,"max",i)},i(f){s||(k(l.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),s=!1},d(f){f&&v(e),F(l)}}}function Wo(t){let e=t[27].properties.name+"",l;return{c(){l=U(e)},m(n,r){b(n,l,r)},p(n,r){r[0]&2&&e!==(e=n[27].properties.name+"")&&se(l,e)},d(n){n&&v(l)}}}function Bn(t){let e,l,n,r;function o(){return t[18](t[24])}return l=new st({props:{color:t[27].properties.color,$$slots:{default:[Wo]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),q(l.$$.fragment),n=L()},m(i,a){b(i,e,a),P(l,e,null),p(e,n),r=!0},p(i,a){t=i;const s={};a[0]&2&&(s.color=t[27].properties.color),a[0]&2|a[1]&4&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&v(e),F(l)}}}function Vo(t){let e=t[25].properties.name+"",l;return{c(){l=U(e)},m(n,r){b(n,l,r)},p(n,r){r[0]&2&&e!==(e=n[25].properties.name+"")&&se(l,e)},d(n){n&&v(l)}}}function Jn(t){let e,l,n,r;function o(){return t[19](t[24])}return l=new st({props:{color:t[25].properties.color,$$slots:{default:[Vo]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),q(l.$$.fragment),n=L()},m(i,a){b(i,e,a),P(l,e,null),p(e,n),r=!0},p(i,a){t=i;const s={};a[0]&2&&(s.color=t[25].properties.color),a[0]&2|a[1]&4&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&v(e),F(l)}}}function Qo(t){let e=t[22].properties.name+"",l;return{c(){l=U(e)},m(n,r){b(n,l,r)},p(n,r){r[0]&2&&e!==(e=n[22].properties.name+"")&&se(l,e)},d(n){n&&v(l)}}}function zn(t){let e,l,n,r;function o(){return t[20](t[24])}return l=new st({props:{color:t[22].properties.color,$$slots:{default:[Qo]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),q(l.$$.fragment),n=L()},m(i,a){b(i,e,a),P(l,e,null),p(e,n),r=!0},p(i,a){t=i;const s={};a[0]&2&&(s.color=t[22].properties.color),a[0]&2|a[1]&4&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&v(e),F(l)}}}function Yo(t){let e,l,n,r,o,i,a,s,u,c,f,m,d,_,$,N,g,j,O,G,B,z,H,M,T,S,I,w,K,C,$e,ue,D,W,ye,ae,E,Q,x,qe,Je=Y(t[1].links),fe=[];for(let J=0;J<Je.length;J+=1)fe[J]=Fn(qn(t,Je,J));const Kn=J=>y(fe[J],1,1,()=>{fe[J]=null});let ze=Y(Te),me=[];for(let J=0;J<ze.length;J+=1)me[J]=On(Dn(t,ze,J));const Xn=J=>y(me[J],1,1,()=>{me[J]=null});let Re=Y(t[1].jats),pe=[];for(let J=0;J<Re.length;J+=1)pe[J]=Bn(En(t,Re,J));const Wn=J=>y(pe[J],1,1,()=>{pe[J]=null});let He=Y(t[1].bus_stops),de=[];for(let J=0;J<He.length;J+=1)de[J]=Jn(Nn(t,He,J));const Vn=J=>y(de[J],1,1,()=>{de[J]=null});let Ge=Y(t[1].crossings),_e=[];for(let J=0;J<Ge.length;J+=1)_e[J]=zn(In(t,Ge,J));const Qn=J=>y(_e[J],1,1,()=>{_e[J]=null});return{c(){e=h("div"),l=h("div"),n=h("button"),n.textContent="Download",r=L(),o=h("button"),o.textContent="Clear",i=L(),a=h("hr"),s=L(),u=h("div"),c=h("button"),c.textContent="New link",f=L(),m=h("button"),m.textContent="Table of questions",d=U(`

    Links:
    `),_=h("ol");for(let J=0;J<fe.length;J+=1)fe[J].c();$=U(`

    Questions:
    `),N=h("ol");for(let J=0;J<me.length;J+=1)me[J].c();g=L(),j=h("hr"),O=U(`

    JATs:

    `),G=h("div"),B=h("button"),B.textContent="New JAT",z=L(),H=h("ol");for(let J=0;J<pe.length;J+=1)pe[J].c();M=L(),T=h("hr"),S=U(`

    Bus stops:

    `),I=h("div"),w=h("button"),w.textContent="New bus stop",K=L(),C=h("ol");for(let J=0;J<de.length;J+=1)de[J].c();$e=L(),ue=h("hr"),D=U(`

    Crossings:

    `),W=h("div"),ye=h("button"),ye.textContent="New crossing",ae=L(),E=h("ol");for(let J=0;J<_e.length;J+=1)_e[J].c();R(n,"class","secondary"),R(o,"class","secondary"),R(e,"slot","sidebar")},m(J,V){b(J,e,V),p(e,l),p(l,n),p(l,r),p(l,o),p(e,i),p(e,a),p(e,s),p(e,u),p(u,c),p(u,f),p(u,m),p(e,d),p(e,_);for(let A=0;A<fe.length;A+=1)fe[A]&&fe[A].m(_,null);p(e,$),p(e,N);for(let A=0;A<me.length;A+=1)me[A]&&me[A].m(N,null);p(e,g),p(e,j),p(e,O),p(e,G),p(G,B),p(e,z),p(e,H);for(let A=0;A<pe.length;A+=1)pe[A]&&pe[A].m(H,null);p(e,M),p(e,T),p(e,S),p(e,I),p(I,w),p(e,K),p(e,C);for(let A=0;A<de.length;A+=1)de[A]&&de[A].m(C,null);p(e,$e),p(e,ue),p(e,D),p(e,W),p(W,ye),p(e,ae),p(e,E);for(let A=0;A<_e.length;A+=1)_e[A]&&_e[A].m(E,null);Q=!0,x||(qe=[Z(n,"click",t[13]),Z(o,"click",t[3]),Z(c,"click",t[4]),Z(m,"click",t[14]),Z(B,"click",t[5]),Z(w,"click",t[6]),Z(ye,"click",t[7])],x=!0)},p(J,V){if(V[0]&6){Je=Y(J[1].links);let A;for(A=0;A<Je.length;A+=1){const Ce=qn(J,Je,A);fe[A]?(fe[A].p(Ce,V),k(fe[A],1)):(fe[A]=Fn(Ce),fe[A].c(),k(fe[A],1),fe[A].m(_,null))}for(ge(),A=Je.length;A<fe.length;A+=1)Kn(A);he()}if(V[0]&6){ze=Y(Te);let A;for(A=0;A<ze.length;A+=1){const Ce=Dn(J,ze,A);me[A]?(me[A].p(Ce,V),k(me[A],1)):(me[A]=On(Ce),me[A].c(),k(me[A],1),me[A].m(N,null))}for(ge(),A=ze.length;A<me.length;A+=1)Xn(A);he()}if(V[0]&6){Re=Y(J[1].jats);let A;for(A=0;A<Re.length;A+=1){const Ce=En(J,Re,A);pe[A]?(pe[A].p(Ce,V),k(pe[A],1)):(pe[A]=Bn(Ce),pe[A].c(),k(pe[A],1),pe[A].m(H,null))}for(ge(),A=Re.length;A<pe.length;A+=1)Wn(A);he()}if(V[0]&6){He=Y(J[1].bus_stops);let A;for(A=0;A<He.length;A+=1){const Ce=Nn(J,He,A);de[A]?(de[A].p(Ce,V),k(de[A],1)):(de[A]=Jn(Ce),de[A].c(),k(de[A],1),de[A].m(C,null))}for(ge(),A=He.length;A<de.length;A+=1)Vn(A);he()}if(V[0]&6){Ge=Y(J[1].crossings);let A;for(A=0;A<Ge.length;A+=1){const Ce=In(J,Ge,A);_e[A]?(_e[A].p(Ce,V),k(_e[A],1)):(_e[A]=zn(Ce),_e[A].c(),k(_e[A],1),_e[A].m(E,null))}for(ge(),A=Ge.length;A<_e.length;A+=1)Qn(A);he()}},i(J){if(!Q){for(let V=0;V<Je.length;V+=1)k(fe[V]);for(let V=0;V<ze.length;V+=1)k(me[V]);for(let V=0;V<Re.length;V+=1)k(pe[V]);for(let V=0;V<He.length;V+=1)k(de[V]);for(let V=0;V<Ge.length;V+=1)k(_e[V]);Q=!0}},o(J){fe=fe.filter(Boolean);for(let V=0;V<fe.length;V+=1)y(fe[V]);me=me.filter(Boolean);for(let V=0;V<me.length;V+=1)y(me[V]);pe=pe.filter(Boolean);for(let V=0;V<pe.length;V+=1)y(pe[V]);de=de.filter(Boolean);for(let V=0;V<de.length;V+=1)y(de[V]);_e=_e.filter(Boolean);for(let V=0;V<_e.length;V+=1)y(_e[V]);Q=!1},d(J){J&&v(e),ie(fe,J),ie(me,J),ie(pe,J),ie(de,J),ie(_e,J),x=!1,Me(qe)}}}function xo(t){let e,l;return e=new xe({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":tt(6,9)},hoverCursor:"pointer"}}),e.$on("click",t[9]),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p:le,i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function ei(t){let e,l;return e=new De({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":tt(20,25)},hoverCursor:"pointer"}}),e.$on("click",t[10]),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p:le,i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function ti(t){let e,l;return e=new De({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":tt(10,15)},hoverCursor:"pointer"}}),e.$on("click",t[11]),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p:le,i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function ni(t){let e,l;return e=new De({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":tt(10,15)},hoverCursor:"pointer"}}),e.$on("click",t[12]),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p:le,i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function li(t){let e,l,n,r,o,i,a,s,u;return l=new je({props:{data:oe(t[1].links),generateId:!0,$$slots:{default:[xo]},$$scope:{ctx:t}}}),r=new je({props:{data:oe(t[1].jats),generateId:!0,$$slots:{default:[ei]},$$scope:{ctx:t}}}),i=new je({props:{data:oe(t[1].bus_stops),generateId:!0,$$slots:{default:[ti]},$$scope:{ctx:t}}}),s=new je({props:{data:oe(t[1].crossings),generateId:!0,$$slots:{default:[ni]},$$scope:{ctx:t}}}),{c(){e=h("div"),q(l.$$.fragment),n=L(),q(r.$$.fragment),o=L(),q(i.$$.fragment),a=L(),q(s.$$.fragment),R(e,"slot","map")},m(c,f){b(c,e,f),P(l,e,null),p(e,n),P(r,e,null),p(e,o),P(i,e,null),p(e,a),P(s,e,null),u=!0},p(c,f){const m={};f[0]&2&&(m.data=oe(c[1].links)),f[0]&4|f[1]&4&&(m.$$scope={dirty:f,ctx:c}),l.$set(m);const d={};f[0]&2&&(d.data=oe(c[1].jats)),f[0]&4|f[1]&4&&(d.$$scope={dirty:f,ctx:c}),r.$set(d);const _={};f[0]&2&&(_.data=oe(c[1].bus_stops)),f[0]&4|f[1]&4&&(_.$$scope={dirty:f,ctx:c}),i.$set(_);const $={};f[0]&2&&($.data=oe(c[1].crossings)),f[0]&4|f[1]&4&&($.$$scope={dirty:f,ctx:c}),s.$set($)},i(c){u||(k(l.$$.fragment,c),k(r.$$.fragment,c),k(i.$$.fragment,c),k(s.$$.fragment,c),u=!0)},o(c){y(l.$$.fragment,c),y(r.$$.fragment,c),y(i.$$.fragment,c),y(s.$$.fragment,c),u=!1},d(c){c&&v(e),F(l),F(r),F(i),F(s)}}}function ri(t){let e,l,n,r=t[0]&&Pn(t);return l=new Ze({props:{$$slots:{map:[li],sidebar:[Yo]},$$scope:{ctx:t}}}),{c(){r&&r.c(),e=L(),q(l.$$.fragment)},m(o,i){r&&r.m(o,i),b(o,e,i),P(l,o,i),n=!0},p(o,i){o[0]?r?(r.p(o,i),i[0]&1&&k(r,1)):(r=Pn(o),r.c(),k(r,1),r.m(e.parentNode,e)):r&&(ge(),y(r,1,1,()=>{r=null}),he());const a={};i[0]&7|i[1]&4&&(a.$$scope={dirty:i,ctx:o}),l.$set(a)},i(o){n||(k(r),k(l.$$.fragment,o),n=!0)},o(o){y(r),y(l.$$.fragment,o),n=!1},d(o){o&&v(e),r&&r.d(o),F(l,o)}}}function oi(t,e,l){let n,r,o;re(t,X,T=>l(1,n=T)),re(t,ne,T=>l(2,r=T)),re(t,ft,T=>l(21,o=T));let i=!1;function a(){ee(X,n.links=[],n),ee(X,n.jats=[],n),ee(X,n.bus_stops=[],n),ee(X,n.crossings=[],n)}function s(){let T=wl(n.links.length);ee(X,n.links=[...n.links,T],n),ee(ne,r={kind:"edit-link",idx:n.links.length-1},r)}function u(){if(!o)return;let T=Cl(n.jats.length,o.getCenter().toArray());ee(X,n.jats=[...n.jats,T],n),ee(ne,r={kind:"edit-jat",idx:n.jats.length-1},r)}function c(){if(!o)return;let T=yl(n.bus_stops.length,o.getCenter().toArray());ee(X,n.bus_stops=[...n.bus_stops,T],n),ee(ne,r={kind:"edit-bus-stop",idx:n.bus_stops.length-1},r)}function f(){if(!o)return;let T=jl(n.crossings.length,o.getCenter().toArray());ee(X,n.crossings=[...n.crossings,T],n),ee(ne,r={kind:"edit-crossing",idx:n.crossings.length-1},r)}return[i,n,r,a,s,u,c,f,()=>l(0,i=!1),T=>ee(ne,r={kind:"edit-link",idx:T.detail.features[0].id},r),T=>ee(ne,r={kind:"edit-jat",idx:T.detail.features[0].id},r),T=>ee(ne,r={kind:"edit-bus-stop",idx:T.detail.features[0].id},r),T=>ee(ne,r={kind:"edit-crossing",idx:T.detail.features[0].id},r),()=>sr("rcv2.geojson",JSON.stringify(n)),()=>l(0,i=!0),T=>ee(ne,r={kind:"edit-link",idx:T},r),T=>ee(ne,r={kind:"edit-question",idx:T},r),(T,S)=>S.properties.answers[T]!="",T=>ee(ne,r={kind:"edit-jat",idx:T},r),T=>ee(ne,r={kind:"edit-bus-stop",idx:T},r),T=>ee(ne,r={kind:"edit-crossing",idx:T},r)]}class ii extends ke{constructor(e){super(),be(this,e,oi,ri,ve,{},null,[-1,-1])}}function si(t){let e,l;return{c(){e=h("div"),l=h("div"),R(e,"slot","left")},m(n,r){b(n,e,r),p(e,l),t[9](l)},p:le,d(n){n&&v(e),t[9](null)}}}function ai(t){return{c:le,m:le,p:le,i:le,o:le,d:le}}function ci(t){let e,l,n;function r(i){t[8](i)}let o={style:t[10],standardControls:!0,hash:!0,$$slots:{default:[hi]},$$scope:{ctx:t}};return t[2]!==void 0&&(o.map=t[2]),e=new ul({props:o}),we.push(()=>Ne(e,"map",r)),{c(){q(e.$$.fragment)},m(i,a){P(e,i,a),n=!0},p(i,a){const s={};a&2058&&(s.$$scope={dirty:a,ctx:i}),!l&&a&4&&(l=!0,s.map=i[2],Ee(()=>l=!1)),e.$set(s)},i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){y(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function ui(t){let e,l;return e=new Jo({props:{qIdx:t[3].idx}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.qIdx=n[3].idx),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function fi(t){let e,l;return e=new Yl({props:{idx:t[3].idx}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function mi(t){let e,l;return e=new Rl({props:{idx:t[3].idx}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function pi(t){let e,l;return e=new po({props:{junctionIdx:t[3].idx,stage:t[3].stage}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.junctionIdx=n[3].idx),r&8&&(o.stage=n[3].stage),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function di(t){let e,l;return e=new wo({props:{idx:t[3].idx}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function _i(t){let e,l;return e=new qo({props:{idx:t[3].idx}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function gi(t){let e,l;return e=new ii({}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p:le,i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function hi(t){let e,l,n,r,o,i;const a=[gi,_i,di,pi,mi,fi,ui],s=[];function u(c,f){return c[3].kind=="neutral"?0:c[3].kind=="edit-link"?1:c[3].kind=="edit-jat"?2:c[3].kind=="edit-jat-detail"?3:c[3].kind=="edit-bus-stop"?4:c[3].kind=="edit-crossing"?5:c[3].kind=="edit-question"?6:-1}return~(n=u(t))&&(r=s[n]=a[n](t)),{c(){e=h("div"),l=L(),r&&r.c(),o=ot()},m(c,f){b(c,e,f),t[7](e),b(c,l,f),~n&&s[n].m(c,f),b(c,o,f),i=!0},p(c,f){let m=n;n=u(c),n===m?~n&&s[n].p(c,f):(r&&(ge(),y(s[m],1,1,()=>{s[m]=null}),he()),~n?(r=s[n],r?r.p(c,f):(r=s[n]=a[n](c),r.c()),k(r,1),r.m(o.parentNode,o)):r=null)},i(c){i||(k(r),i=!0)},o(c){y(r),i=!1},d(c){c&&(v(e),v(l),v(o)),t[7](null),~n&&s[n].d(c)}}}function $i(t){return{c:le,m:le,p:le,i:le,o:le,d:le}}function ki(t){let e,l,n={ctx:t,current:null,token:null,hasCatch:!1,pending:$i,then:ci,catch:ai,value:10,blocks:[,,,]};return fl(xl(new URLSearchParams(window.location.search).get("google")||""),n),{c(){e=h("div"),n.block.c(),R(e,"slot","main"),te(e,"position","relative"),te(e,"width","100%"),te(e,"height","100vh")},m(r,o){b(r,e,o),n.block.m(e,n.anchor=null),n.mount=()=>e,n.anchor=null,l=!0},p(r,o){t=r,ml(n,t,o)},i(r){l||(k(n.block),l=!0)},o(r){for(let o=0;o<3;o+=1){const i=n.blocks[o];y(i)}l=!1},d(r){r&&v(e),n.block.d(),n.token=null,n=null}}}function bi(t){let e,l;return e=new cl({props:{$$slots:{main:[ki],left:[si]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},m(n,r){P(e,n,r),l=!0},p(n,[r]){const o={};r&2063&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function vi(t,e,l){let n,r,o,i,a;re(t,bt,d=>l(4,n=d)),re(t,kt,d=>l(5,r=d)),re(t,X,d=>l(6,o=d)),re(t,ft,d=>l(2,i=d)),re(t,ne,d=>l(3,a=d));let s,u;function c(d){we[d?"unshift":"push"](()=>{u=d,l(1,u),l(4,n)})}function f(d){i=d,ft.set(i)}function m(d){we[d?"unshift":"push"](()=>{s=d,l(0,s),l(5,r)})}return t.$$.update=()=>{t.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(o)),t.$$.dirty&33&&s&&r&&(l(0,s.innerHTML="",s),s.appendChild(r)),t.$$.dirty&18&&u&&n&&(l(1,u.innerHTML="",u),u.appendChild(n))},[s,u,i,a,n,r,o,c,f,m]}class wi extends ke{constructor(e){super(),be(this,e,vi,bi,ve,{})}}new wi({target:document.getElementById("app")});
