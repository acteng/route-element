import{V as qn,W as Dn,X as Ve,r as ae,e as $,v as ce,t as _,Y as Pn,S as oe,i as ie,s as re,Z as zn,_ as Fn,$ as x,a0 as On,L as Bn,b as le,a as fe,c as N,m as I,d as de,f as E,g as Rn,h as Fe,u as Oe,j as Be,k as Re,l as be,y as b,z as A,q as v,w,a1 as We,M as ze,A as F,a2 as Je,U as Y,p as Ge,B as te,a3 as Jn,o as Q,F as H,a4 as Hn,O as g,a5 as it,Q as J,H as se,x as me,R as $e,N as _e,K as Gn,G as ge,D as Se,E as Ce,a6 as Ue,a7 as G,a8 as Ie,a9 as nt,aa as Un,ab as et,ac as Zn,C as Ee,P as Sn,ad as Kn,I as Xn,T as Wn}from"./Layout-d1a27f85.js";function Vn(n,e){const r=e.token={};function t(l,o,i,a){if(e.token!==r)return;e.resolved=a;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=a);const f=l&&(e.current=l)(s);let c=!1;e.block&&(e.blocks?e.blocks.forEach((d,u)=>{u!==o&&d&&(ae(),$(d,1,1,()=>{e.blocks[u]===d&&(e.blocks[u]=null)}),ce())}):e.block.d(1),f.c(),_(f,1),f.m(e.mount(),e.anchor),c=!0),e.block=f,e.blocks&&(e.blocks[o]=f),c&&Pn()}if(qn(n)){const l=Dn();if(n.then(o=>{Ve(l),t(e.then,1,e.value,o),Ve(null)},o=>{if(Ve(l),t(e.catch,2,e.error,o),Ve(null),!e.hasCatch)throw o}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function Qn(n,e,r){const t=e.slice(),{resolved:l}=n;n.current===n.then&&(t[n.value]=l),n.current===n.catch&&(t[n.error]=l),n.block.p(t,r)}function Yn(n,e,r){let t;const l=zn();let{layer:o=void 0}=e;const{map:i}=Fn();x(n,i,c=>r(2,t=c));function a(c){l(c.type,{...c,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return On(()=>{if(t)if(o)for(const c of s)t.off(c,o,a);else for(const c of f)t.off(c,a)}),n.$$set=c=>{"layer"in c&&r(1,o=c.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(o)for(const c of s)t.on(c,o,a);else for(const c of f)t.on(c,a)},[i,o,t]}class An extends oe{constructor(e){super(),ie(this,e,Yn,null,re,{layer:1})}}function xn(n){let e;const r=n[16].default,t=Fe(r,n,n[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&Oe(t,r,l,l[24],e?Re(r,l[24],o,null):Be(l[24]),null)},i(l){e||(_(t,l),e=!0)},o(l){$(t,l),e=!1},d(l){t&&t.d(l)}}}function er(n){let e,r,t;function l(i){n[17](i)}let o={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[xn]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.hovered=n[0]),e=new Bn({props:o}),le.push(()=>fe(e,"hovered",l)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){N(e.$$.fragment)},m(i,a){I(e,i,a),t=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.hovered=i[0],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function tr(n,e,r){let{$$slots:t={},$$scope:l}=e,{id:o=Rn("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:c=void 0}=e,{layout:d=void 0}=e,{filter:u=void 0}=e,{applyToClusters:m=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:y=void 0}=e,{hoverCursor:q=void 0}=e,{manageHoverState:k=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:j=!0}=e;function L(M){h=M,r(0,h)}function C(M){be.call(this,n,M)}function S(M){be.call(this,n,M)}function P(M){be.call(this,n,M)}function B(M){be.call(this,n,M)}function V(M){be.call(this,n,M)}function X(M){be.call(this,n,M)}return n.$$set=M=>{"id"in M&&r(1,o=M.id),"source"in M&&r(2,i=M.source),"sourceLayer"in M&&r(3,a=M.sourceLayer),"beforeId"in M&&r(4,s=M.beforeId),"beforeLayerType"in M&&r(5,f=M.beforeLayerType),"paint"in M&&r(6,c=M.paint),"layout"in M&&r(7,d=M.layout),"filter"in M&&r(8,u=M.filter),"applyToClusters"in M&&r(9,m=M.applyToClusters),"minzoom"in M&&r(10,p=M.minzoom),"maxzoom"in M&&r(11,y=M.maxzoom),"hoverCursor"in M&&r(12,q=M.hoverCursor),"manageHoverState"in M&&r(13,k=M.manageHoverState),"hovered"in M&&r(0,h=M.hovered),"eventsIfTopMost"in M&&r(14,O=M.eventsIfTopMost),"interactive"in M&&r(15,j=M.interactive),"$$scope"in M&&r(24,l=M.$$scope)},[h,o,i,a,s,f,c,d,u,m,p,y,q,k,O,j,t,L,C,S,P,B,V,X,l]}class nr extends oe{constructor(e){super(),ie(this,e,tr,er,re,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const rr=n=>({}),st=n=>({}),lr=n=>({}),at=n=>({});function or(n){let e,r,t,l;const o=n[3].sidebar,i=Fe(o,n,n[2],at),a=n[3].map,s=Fe(a,n,n[2],st);return{c(){e=b("div"),i&&i.c(),r=A(),t=b("div"),s&&s.c()},m(f,c){v(f,e,c),i&&i.m(e,null),n[4](e),v(f,r,c),v(f,t,c),s&&s.m(t,null),n[5](t),l=!0},p(f,[c]){i&&i.p&&(!l||c&4)&&Oe(i,o,f,f[2],l?Re(o,f[2],c,lr):Be(f[2]),at),s&&s.p&&(!l||c&4)&&Oe(s,a,f,f[2],l?Re(a,f[2],c,rr):Be(f[2]),st)},i(f){l||(_(i,f),_(s,f),l=!0)},o(f){$(i,f),$(s,f),l=!1},d(f){f&&(w(e),w(r),w(t)),i&&i.d(f),n[4](null),s&&s.d(f),n[5](null)}}}function ir(n,e,r){let t,l;x(n,rt,f=>r(0,t=f)),x(n,lt,f=>r(1,l=f));let{$$slots:o={},$$scope:i}=e;function a(f){le[f?"unshift":"push"](()=>{t=f,rt.set(t)})}function s(f){le[f?"unshift":"push"](()=>{l=f,lt.set(l)})}return n.$$set=f=>{"$$scope"in f&&r(2,i=f.$$scope)},[t,l,i,o,a,s]}class Me extends oe{constructor(e){super(),ie(this,e,ir,or,re,{})}}let rt=We(null),lt=We(null);function ke(){return["","2","1","0","Critical"]}let Le=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"];function sr(n){let e;return{c(){e=b("span"),F(e,"class","dot svelte-117v9mi"),Je(e,"outline",n[3]),Y(e,"background-color",n[3]?void 0:n[1]),Y(e,"border-color",n[3]?n[1]:void 0),Y(e,"width",n[2]),Y(e,"height",n[2])},m(r,t){v(r,e,t)},p(r,t){t&8&&Je(e,"outline",r[3]),t&10&&Y(e,"background-color",r[3]?void 0:r[1]),t&10&&Y(e,"border-color",r[3]?r[1]:void 0),t&4&&Y(e,"width",r[2]),t&4&&Y(e,"height",r[2])},d(r){r&&w(e)}}}function ar(n){let e,r,t;function l(i){n[4](i)}let o={draggable:!0,$$slots:{default:[sr]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.lngLat=n[0]),e=new ze({props:o}),le.push(()=>fe(e,"lngLat",l)),{c(){N(e.$$.fragment)},m(i,a){I(e,i,a),t=!0},p(i,[a]){const s={};a&46&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.lngLat=i[0],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function cr(n,e,r){let{lngLat:t}=e,{color:l}=e,{radius:o="30px"}=e,{outline:i=!1}=e;function a(s){t=s,r(0,t)}return n.$$set=s=>{"lngLat"in s&&r(0,t=s.lngLat),"color"in s&&r(1,l=s.color),"radius"in s&&r(2,o=s.radius),"outline"in s&&r(3,i=s.outline)},[t,l,o,i,a]}class ot extends oe{constructor(e){super(),ie(this,e,cr,ar,re,{lngLat:0,color:1,radius:2,outline:3})}}function ct(n,e,r){const t=n.slice();return t[10]=e[r][0],t[11]=e[r][1],t}function ut(n,e,r){const t=n.slice();return t[10]=e[r][0],t[11]=e[r][1],t}function ur(n){let e,r,t,l,o,i,a=Q(n[3]),s=[];for(let f=0;f<a.length;f+=1)s[f]=ft(ct(n,a,f));return{c(){e=b("label"),r=H(n[2]),t=A(),l=b("select");for(let f=0;f<s.length;f+=1)s[f].c();n[0]===void 0&&Hn(()=>n[9].call(l))},m(f,c){v(f,e,c),g(e,r),g(e,t),g(e,l);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(l,null);it(l,n[0],!0),o||(i=[J(l,"change",n[9]),J(l,"change",n[6])],o=!0)},p(f,c){if(c&4&&se(r,f[2]),c&8){a=Q(f[3]);let d;for(d=0;d<a.length;d+=1){const u=ct(f,a,d);s[d]?s[d].p(u,c):(s[d]=ft(u),s[d].c(),s[d].m(l,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=a.length}c&9&&it(l,f[0])},d(f){f&&w(e),me(s,f),o=!1,$e(i)}}}function fr(n){let e,r,t,l,o=Q(n[3]),i=[];for(let a=0;a<o.length;a+=1)i[a]=dt(ut(n,o,a));return{c(){e=b("fieldset"),r=H(n[2]),t=A(),l=b("div");for(let a=0;a<i.length;a+=1)i[a].c();F(l,"class","svelte-1vb210n"),Je(l,"horiz_radio",n[1]=="horiz-radio")},m(a,s){v(a,e,s),g(e,r),g(e,t),g(e,l);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(l,null)},p(a,s){if(s&4&&se(r,a[2]),s&9){o=Q(a[3]);let f;for(f=0;f<o.length;f+=1){const c=ut(a,o,f);i[f]?i[f].p(c,s):(i[f]=dt(c),i[f].c(),i[f].m(l,null))}for(;f<i.length;f+=1)i[f].d(1);i.length=o.length}s&2&&Je(l,"horiz_radio",a[1]=="horiz-radio")},d(a){a&&w(e),me(i,a)}}}function ft(n){let e,r=n[11]+"",t;return{c(){e=b("option"),t=H(r),e.__value=n[10],_e(e,e.__value)},m(l,o){v(l,e,o),g(e,t)},p:te,d(l){l&&w(e)}}}function dt(n){let e,r,t,l=n[11]+"",o,i,a,s,f;return a=Gn(n[8][0]),{c(){e=b("label"),r=b("input"),t=A(),o=H(l),i=A(),F(r,"type","radio"),r.__value=n[10],_e(r,r.__value),a.p(r)},m(c,d){v(c,e,d),g(e,r),r.checked=r.__value===n[0],g(e,t),g(e,o),g(e,i),s||(f=[J(r,"change",n[7]),J(r,"change",n[5])],s=!0)},p(c,d){d&9&&(r.checked=r.__value===c[0])},d(c){c&&w(e),a.r(),s=!1,$e(f)}}}function dr(n){let e;function r(o,i){if(o[1]=="horiz-radio"||o[1]=="vert-radio")return fr;if(o[1]=="dropdown")return ur}let t=r(n),l=t&&t(n);return{c(){l&&l.c(),e=Ge()},m(o,i){l&&l.m(o,i),v(o,e,i)},p(o,[i]){t===(t=r(o))&&l?l.p(o,i):(l&&l.d(1),l=t&&t(o),l&&(l.c(),l.m(e.parentNode,e)))},i:te,o:te,d(o){o&&w(e),l&&l.d(o)}}}function mr(n,e,r){let{k:t}=e,{label:l}=e,{value:o}=e,{choices:i}=e,a=i[0].length==2?i:i.map(m=>[m,m]);const s=[[]];function f(m){be.call(this,n,m)}function c(m){be.call(this,n,m)}function d(){o=this.__value,r(0,o),r(3,a)}function u(){o=Jn(this),r(0,o),r(3,a)}return n.$$set=m=>{"k"in m&&r(1,t=m.k),"label"in m&&r(2,l=m.label),"value"in m&&r(0,o=m.value),"choices"in m&&r(4,i=m.choices)},[o,t,l,a,i,f,c,d,s,u]}class Ae extends oe{constructor(e){super(),ie(this,e,mr,dr,re,{k:1,label:2,value:0,choices:4})}}let He=We(void 0),R=We(pr());function ne(n){return{type:"FeatureCollection",features:n}}let Z=We({kind:"neutral"});function pr(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if("links"in n&&"jats"in n&&"crossings"in n&&"side_roads"in n)return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[],side_roads:[]}}function mt(n){let e,r;return e=new ge({props:{data:ne(n[2].links),$$slots:{default:[gr]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&4&&(o.data=ne(t[2].links)),l&10&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function gr(n){let e,r;return e=new Se({props:{paint:{"line-color":n[1]?["get","color"]:"black","line-width":6}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&2&&(o.paint={"line-color":t[1]?["get","color"]:"black","line-width":6}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function pt(n){let e,r;return e=new ge({props:{data:ne(n[2].bus_stops),$$slots:{default:[_r]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&4&&(o.data=ne(t[2].bus_stops)),l&8&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function _r(n){let e,r;return e=new Ce({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function gt(n){let e,r;return e=new ge({props:{data:ne(n[2].crossings),$$slots:{default:[hr]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&4&&(o.data=ne(t[2].crossings)),l&8&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function hr(n){let e,r;return e=new Ce({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function _t(n){let e,r;return e=new ge({props:{data:ne(n[2].jats),$$slots:{default:[$r]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&4&&(o.data=ne(t[2].jats)),l&8&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function $r(n){let e,r;return e=new Ce({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ht(n){let e,r;return e=new ge({props:{data:ne(n[2].side_roads),$$slots:{default:[kr]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&4&&(o.data=ne(t[2].side_roads)),l&8&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function kr(n){let e,r;return e=new Se({props:{paint:{"line-color":"black","line-width":3}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function br(n){let e,r,t,l,o,i,a=n[0]!="links"&&mt(n),s=n[0]!="bus_stops"&&pt(n),f=n[0]!="crossings"&&gt(n),c=n[0]!="jats"&&_t(n),d=n[0]!="side_roads"&&ht(n);return{c(){a&&a.c(),e=A(),s&&s.c(),r=A(),f&&f.c(),t=A(),c&&c.c(),l=A(),d&&d.c(),o=Ge()},m(u,m){a&&a.m(u,m),v(u,e,m),s&&s.m(u,m),v(u,r,m),f&&f.m(u,m),v(u,t,m),c&&c.m(u,m),v(u,l,m),d&&d.m(u,m),v(u,o,m),i=!0},p(u,[m]){u[0]!="links"?a?(a.p(u,m),m&1&&_(a,1)):(a=mt(u),a.c(),_(a,1),a.m(e.parentNode,e)):a&&(ae(),$(a,1,1,()=>{a=null}),ce()),u[0]!="bus_stops"?s?(s.p(u,m),m&1&&_(s,1)):(s=pt(u),s.c(),_(s,1),s.m(r.parentNode,r)):s&&(ae(),$(s,1,1,()=>{s=null}),ce()),u[0]!="crossings"?f?(f.p(u,m),m&1&&_(f,1)):(f=gt(u),f.c(),_(f,1),f.m(t.parentNode,t)):f&&(ae(),$(f,1,1,()=>{f=null}),ce()),u[0]!="jats"?c?(c.p(u,m),m&1&&_(c,1)):(c=_t(u),c.c(),_(c,1),c.m(l.parentNode,l)):c&&(ae(),$(c,1,1,()=>{c=null}),ce()),u[0]!="side_roads"?d?(d.p(u,m),m&1&&_(d,1)):(d=ht(u),d.c(),_(d,1),d.m(o.parentNode,o)):d&&(ae(),$(d,1,1,()=>{d=null}),ce())},i(u){i||(_(a),_(s),_(f),_(c),_(d),i=!0)},o(u){$(a),$(s),$(f),$(c),$(d),i=!1},d(u){u&&(w(e),w(r),w(t),w(l),w(o)),a&&a.d(u),s&&s.d(u),f&&f.d(u),c&&c.d(u),d&&d.d(u)}}}function vr(n,e,r){let t;x(n,R,i=>r(2,t=i));let{except:l}=e,{showLinkColor:o=!1}=e;return n.$$set=i=>{"except"in i&&r(0,l=i.except),"showLinkColor"in i&&r(1,o=i.showLinkColor)},[l,o,t]}class qe extends oe{constructor(e){super(),ie(this,e,vr,br,re,{except:0,showLinkColor:1})}}const{window:wr}=Ue;function yr(n){let e,r,t,l,o,i,a,s,f,c,d,u,m,p;function y(k){n[8](k)}let q={k:"horiz-radio",label:"ST20: bus stops",choices:ke()};return n[1].bus_stops[n[0]].properties.st20!==void 0&&(q.value=n[1].bus_stops[n[0]].properties.st20),c=new Ae({props:q}),le.push(()=>fe(c,"value",y)),{c(){e=b("div"),r=b("button"),r.textContent="Done",t=A(),l=b("button"),l.textContent="Delete bus stop",o=A(),i=b("label"),a=H(`Name:
      `),s=b("input"),f=A(),N(c.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(k,h){v(k,e,h),g(e,r),g(e,t),g(e,l),g(e,o),g(e,i),g(i,a),g(i,s),_e(s,n[1].bus_stops[n[0]].properties.name),g(e,f),I(c,e,null),u=!0,m||(p=[J(r,"click",n[6]),J(l,"click",n[4]),J(s,"input",n[7])],m=!0)},p(k,h){h&3&&s.value!==k[1].bus_stops[k[0]].properties.name&&_e(s,k[1].bus_stops[k[0]].properties.name);const O={};!d&&h&3&&(d=!0,O.value=k[1].bus_stops[k[0]].properties.st20,de(()=>d=!1)),c.$set(O)},i(k){u||(_(c.$$.fragment,k),u=!0)},o(k){$(c.$$.fragment,k),u=!1},d(k){k&&w(e),E(c),m=!1,$e(p)}}}function jr(n){let e,r;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Cr(n){let e,r,t,l,o,i,a,s;r=new qe({props:{except:"bus_stops"}}),l=new ge({props:{data:ne(n[1].bus_stops),generateId:!0,$$slots:{default:[jr]},$$scope:{ctx:n}}});function f(d){n[5](d)}let c={color:n[1].bus_stops[n[0]].properties.color};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),i=new ot({props:c}),le.push(()=>fe(i,"lngLat",f)),{c(){e=b("div"),N(r.$$.fragment),t=A(),N(l.$$.fragment),o=A(),N(i.$$.fragment),F(e,"slot","map")},m(d,u){v(d,e,u),I(r,e,null),g(e,t),I(l,e,null),g(e,o),I(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].bus_stops)),u&513&&(m.$$scope={dirty:u,ctx:d}),l.$set(m);const p={};u&3&&(p.color=d[1].bus_stops[d[0]].properties.color),!a&&u&3&&(a=!0,p.lngLat=d[1].bus_stops[d[0]].geometry.coordinates,de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(l.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(l.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&w(e),E(r),E(l),E(i)}}}function Lr(n){let e,r,t,l;return e=new Me({props:{$$slots:{map:[Cr],sidebar:[yr]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){I(e,o,i),r=!0,t||(l=J(wr,"keydown",n[3]),t=!0)},p(o,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){$(e.$$.fragment,o),r=!1},d(o){E(e,o),t=!1,l()}}}function Sr(n,e,r){let t,l;x(n,R,u=>r(1,t=u)),x(n,Z,u=>r(2,l=u));let{idx:o}=e;function i(u){u.key=="Escape"&&G(Z,l={kind:"neutral"},l)}async function a(){window.confirm("Really delete this bus stop?")&&(G(Z,l={kind:"neutral"},l),await Ie(),t.bus_stops.splice(o,1),R.set(t))}function s(u){n.$$.not_equal(t.bus_stops[o].geometry.coordinates,u)&&(t.bus_stops[o].geometry.coordinates=u,R.set(t))}const f=()=>G(Z,l={kind:"neutral"},l);function c(){t.bus_stops[o].properties.name=this.value,R.set(t)}function d(u){n.$$.not_equal(t.bus_stops[o].properties.st20,u)&&(t.bus_stops[o].properties.st20=u,R.set(t))}return n.$$set=u=>{"idx"in u&&r(0,o=u.idx)},[o,t,l,i,a,s,f,c,d]}class Ar extends oe{constructor(e){super(),ie(this,e,Sr,Lr,re,{idx:0})}}const{window:Tr}=Ue;function Mr(n){let e,r,t,l,o,i,a,s,f,c,d,u,m,p;function y(k){n[8](k)}let q={k:"horiz-radio",label:"SA10: pedestrian crossing speed",choices:ke()};return n[1].crossings[n[0]].properties.sa10!==void 0&&(q.value=n[1].crossings[n[0]].properties.sa10),c=new Ae({props:q}),le.push(()=>fe(c,"value",y)),{c(){e=b("div"),r=b("button"),r.textContent="Done",t=A(),l=b("button"),l.textContent="Delete crossing",o=A(),i=b("label"),a=H(`Name:
      `),s=b("input"),f=A(),N(c.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(k,h){v(k,e,h),g(e,r),g(e,t),g(e,l),g(e,o),g(e,i),g(i,a),g(i,s),_e(s,n[1].crossings[n[0]].properties.name),g(e,f),I(c,e,null),u=!0,m||(p=[J(r,"click",n[6]),J(l,"click",n[4]),J(s,"input",n[7])],m=!0)},p(k,h){h&3&&s.value!==k[1].crossings[k[0]].properties.name&&_e(s,k[1].crossings[k[0]].properties.name);const O={};!d&&h&3&&(d=!0,O.value=k[1].crossings[k[0]].properties.sa10,de(()=>d=!1)),c.$set(O)},i(k){u||(_(c.$$.fragment,k),u=!0)},o(k){$(c.$$.fragment,k),u=!1},d(k){k&&w(e),E(c),m=!1,$e(p)}}}function Nr(n){let e,r;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ir(n){let e,r,t,l,o,i,a,s;r=new qe({props:{except:"crossings"}}),l=new ge({props:{data:ne(n[1].crossings),generateId:!0,$$slots:{default:[Nr]},$$scope:{ctx:n}}});function f(d){n[5](d)}let c={color:n[1].crossings[n[0]].properties.color};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].crossings[n[0]].geometry.coordinates),i=new ot({props:c}),le.push(()=>fe(i,"lngLat",f)),{c(){e=b("div"),N(r.$$.fragment),t=A(),N(l.$$.fragment),o=A(),N(i.$$.fragment),F(e,"slot","map")},m(d,u){v(d,e,u),I(r,e,null),g(e,t),I(l,e,null),g(e,o),I(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].crossings)),u&513&&(m.$$scope={dirty:u,ctx:d}),l.$set(m);const p={};u&3&&(p.color=d[1].crossings[d[0]].properties.color),!a&&u&3&&(a=!0,p.lngLat=d[1].crossings[d[0]].geometry.coordinates,de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(l.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(l.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&w(e),E(r),E(l),E(i)}}}function Er(n){let e,r,t,l;return e=new Me({props:{$$slots:{map:[Ir],sidebar:[Mr]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){I(e,o,i),r=!0,t||(l=J(Tr,"keydown",n[3]),t=!0)},p(o,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){$(e.$$.fragment,o),r=!1},d(o){E(e,o),t=!1,l()}}}function qr(n,e,r){let t,l;x(n,R,u=>r(1,t=u)),x(n,Z,u=>r(2,l=u));let{idx:o}=e;function i(u){u.key=="Escape"&&G(Z,l={kind:"neutral"},l)}async function a(){window.confirm("Really delete this crossing?")&&(G(Z,l={kind:"neutral"},l),await Ie(),t.crossings.splice(o,1),R.set(t))}function s(u){n.$$.not_equal(t.crossings[o].geometry.coordinates,u)&&(t.crossings[o].geometry.coordinates=u,R.set(t))}const f=()=>G(Z,l={kind:"neutral"},l);function c(){t.crossings[o].properties.name=this.value,R.set(t)}function d(u){n.$$.not_equal(t.crossings[o].properties.sa10,u)&&(t.crossings[o].properties.sa10=u,R.set(t))}return n.$$set=u=>{"idx"in u&&r(0,o=u.idx)},[o,t,l,i,a,s,f,c,d]}class Dr extends oe{constructor(e){super(),ie(this,e,qr,Er,re,{idx:0})}}let $t="MZEJTanw3WpxRvt7qDfo";async function Pr(n){return n?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await zr(n)}&key=${n}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${$t}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${$t}`}async function zr(n){try{let r=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB"})})).json();return"session"in r?r.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(r)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}const Fr="/route-element/assets/right-arrow-d8c7892c.svg";function kt(n){let e,r;const t=n[4].default,l=Fe(t,n,n[3],null);return{c(){e=b("div"),l&&l.c(),F(e,"class","section svelte-zax3q3")},m(o,i){v(o,e,i),l&&l.m(e,null),r=!0},p(o,i){l&&l.p&&(!r||i&8)&&Oe(l,t,o,o[3],r?Re(t,o[3],i,null):Be(o[3]),null)},i(o){r||(_(l,o),r=!0)},o(o){$(l,o),r=!1},d(o){o&&w(e),l&&l.d(o)}}}function Or(n){let e,r,t,l,o,i,a,s,f,c,d,u,m=n[2]&&kt(n);return{c(){e=b("button"),r=b("div"),t=b("span"),l=H(n[0]),o=A(),i=b("img"),f=A(),m&&m.c(),F(i,"class","arrow svelte-zax3q3"),nt(i.src,a=Fr)||F(i,"src",a),F(i,"alt",s="Select "+n[0]),F(r,"class","top-section section svelte-zax3q3"),Je(r,"bordered",n[2]),F(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m(p,y){v(p,e,y),g(e,r),g(r,t),g(t,l),g(r,o),g(r,i),g(e,f),m&&m.m(e,null),c=!0,d||(u=[J(e,"click",n[5]),J(e,"mouseenter",n[6]),J(e,"mouseleave",n[7])],d=!0)},p(p,[y]){(!c||y&1)&&se(l,p[0]),(!c||y&1&&s!==(s="Select "+p[0]))&&F(i,"alt",s),(!c||y&4)&&Je(r,"bordered",p[2]),p[2]?m?(m.p(p,y),y&4&&_(m,1)):(m=kt(p),m.c(),_(m,1),m.m(e,null)):m&&(ae(),$(m,1,1,()=>{m=null}),ce()),(!c||y&2)&&(e.disabled=p[1])},i(p){c||(_(m),c=!0)},o(p){$(m),c=!1},d(p){p&&w(e),m&&m.d(),d=!1,$e(u)}}}function Br(n,e,r){let{$$slots:t={},$$scope:l}=e,{name:o}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(d){be.call(this,n,d)}function f(d){be.call(this,n,d)}function c(d){be.call(this,n,d)}return n.$$set=d=>{"name"in d&&r(0,o=d.name),"disabled"in d&&r(1,i=d.disabled),"hasSlot"in d&&r(2,a=d.hasSlot),"$$scope"in d&&r(3,l=d.$$scope)},[o,i,a,l,t,s,f,c]}class Tn extends oe{constructor(e){super(),ie(this,e,Br,Or,re,{name:0,disabled:1,hasSlot:2})}}let Te={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const Rr=n=>({dialog:n&1}),bt=n=>({dialog:n[0]});function Jr(n){let e,r,t,l,o;const i=n[4].default,a=Fe(i,n,n[3],bt);return{c(){e=b("dialog"),r=b("article"),a&&a.c(),e.open=!0},m(s,f){v(s,e,f),g(e,r),a&&a.m(r,null),n[6](e),t=!0,l||(o=[J(window,"click",n[1]),J(window,"keydown",n[2]),J(e,"close",n[5])],l=!0)},p(s,[f]){a&&a.p&&(!t||f&9)&&Oe(a,i,s,s[3],t?Re(i,s[3],f,Rr):Be(s[3]),bt)},i(s){t||(_(a,s),t=!0)},o(s){$(a,s),t=!1},d(s){s&&w(e),a&&a.d(s),n[6](null),l=!1,$e(o)}}}function Hr(n,e,r){let{$$slots:t={},$$scope:l}=e,o;function i(c){o.open&&c.target==o&&o.close()}function a(c){(c.key=="Escape"||c.key=="Enter")&&(c.stopPropagation(),o.close())}function s(c){be.call(this,n,c)}function f(c){le[c?"unshift":"push"](()=>{o=c,r(0,o)})}return n.$$set=c=>{"$$scope"in c&&r(3,l=c.$$scope)},[o,i,a,l,t,s,f]}class Mn extends oe{constructor(e){super(),ie(this,e,Hr,Jr,re,{})}}function Gr(n,e){let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}const De={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},Nn=Object.keys(De);function xe(n){return Object.keys(De[n])}const Ne="All movements";function vt(n,e){let r=[],t=De[n][e];t&&r.push({junctionType:n,movementType:e,...t});let l=De[n][Ne];if(l&&e!=Ne&&r.push({junctionType:n,movementType:Ne,...l}),n=="Crossroads"){let o=De["Simple priority T-junction"][Ne];o&&r.push({junctionType:"Simple priority T-junction",movementType:Ne,...o})}if(n!="Any type of junction"){let o=De["Any type of junction"][Ne];o&&r.push({junctionType:"Any type of junction",movementType:Ne,...o})}return r}function wt(n,e,r){const t=n.slice();return t[9]=e[r],t}function yt(n,e,r){const t=n.slice();return t[12]=e[r],t}function jt(n,e,r){const t=n.slice();return t[12]=e[r],t}function Ct(n,e,r){const t=n.slice();return t[12]=e[r],t}function Lt(n){let e,r;return e=new Mn({props:{$$slots:{default:[Ur]},$$scope:{ctx:n}}}),e.$on("close",n[8]),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&524295&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function St(n){let e,r,t;function l(i){n[6](i)}let o={k:"vert-radio",label:"Type of movement",choices:xe(n[1])};return n[2]!==void 0&&(o.value=n[2]),e=new Ae({props:o}),le.push(()=>fe(e,"value",l)),{c(){N(e.$$.fragment)},m(i,a){I(e,i,a),t=!0},p(i,a){const s={};a&2&&(s.choices=xe(i[1])),!r&&a&4&&(r=!0,s.value=i[2],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function At(n){let e,r=n[12]+"",t;return{c(){e=b("li"),t=H(r)},m(l,o){v(l,e,o),g(e,t)},p(l,o){o&6&&r!==(r=l[12]+"")&&se(t,r)},d(l){l&&w(e)}}}function Tt(n){let e,r=n[12]+"",t;return{c(){e=b("li"),t=H(r)},m(l,o){v(l,e,o),g(e,t)},p(l,o){o&6&&r!==(r=l[12]+"")&&se(t,r)},d(l){l&&w(e)}}}function Mt(n){let e,r=n[12]+"",t;return{c(){e=b("li"),t=H(r)},m(l,o){v(l,e,o),g(e,t)},p(l,o){o&6&&r!==(r=l[12]+"")&&se(t,r)},d(l){l&&w(e)}}}function Nt(n){let e,r,t=n[9].junctionType+"",l,o,i,a,s,f,c=n[9].movementType+"",d,u,m,p,y,q,k,h,O,j,L,C=Q(n[9].scoreZero),S=[];for(let M=0;M<C.length;M+=1)S[M]=At(Ct(n,C,M));let P=Q(n[9].scoreOne),B=[];for(let M=0;M<P.length;M+=1)B[M]=Tt(jt(n,P,M));let V=Q(n[9].scoreTwo),X=[];for(let M=0;M<V.length;M+=1)X[M]=Mt(yt(n,V,M));return{c(){e=b("tr"),r=b("td"),l=H(t),o=A(),i=b("br"),a=A(),s=b("br"),f=A(),d=H(c),u=A(),m=b("td"),p=b("ul");for(let M=0;M<S.length;M+=1)S[M].c();y=A(),q=b("td"),k=b("ul");for(let M=0;M<B.length;M+=1)B[M].c();h=A(),O=b("td"),j=b("ul");for(let M=0;M<X.length;M+=1)X[M].c();L=A(),F(r,"class","type-row svelte-k4kgn3"),F(m,"class","score-zero svelte-k4kgn3"),F(q,"class","score-one svelte-k4kgn3"),F(O,"class","score-two svelte-k4kgn3")},m(M,U){v(M,e,U),g(e,r),g(r,l),g(r,o),g(r,i),g(r,a),g(r,s),g(r,f),g(r,d),g(e,u),g(e,m),g(m,p);for(let T=0;T<S.length;T+=1)S[T]&&S[T].m(p,null);g(e,y),g(e,q),g(q,k);for(let T=0;T<B.length;T+=1)B[T]&&B[T].m(k,null);g(e,h),g(e,O),g(O,j);for(let T=0;T<X.length;T+=1)X[T]&&X[T].m(j,null);g(e,L)},p(M,U){if(U&6&&t!==(t=M[9].junctionType+"")&&se(l,t),U&6&&c!==(c=M[9].movementType+"")&&se(d,c),U&6){C=Q(M[9].scoreZero);let T;for(T=0;T<C.length;T+=1){const he=Ct(M,C,T);S[T]?S[T].p(he,U):(S[T]=At(he),S[T].c(),S[T].m(p,null))}for(;T<S.length;T+=1)S[T].d(1);S.length=C.length}if(U&6){P=Q(M[9].scoreOne);let T;for(T=0;T<P.length;T+=1){const he=jt(M,P,T);B[T]?B[T].p(he,U):(B[T]=Tt(he),B[T].c(),B[T].m(k,null))}for(;T<B.length;T+=1)B[T].d(1);B.length=P.length}if(U&6){V=Q(M[9].scoreTwo);let T;for(T=0;T<V.length;T+=1){const he=yt(M,V,T);X[T]?X[T].p(he,U):(X[T]=Mt(he),X[T].c(),X[T].m(j,null))}for(;T<X.length;T+=1)X[T].d(1);X.length=V.length}},d(M){M&&w(e),me(S,M),me(B,M),me(X,M)}}}function Ur(n){let e,r,t,l,o,i,a,s,f=n[1],c,d,u,m,p,y,q,k,h;function O(P){n[5](P)}let j={k:"vert-radio",label:"Type of junction",choices:Nn};n[1]!==void 0&&(j.value=n[1]),i=new Ae({props:j}),le.push(()=>fe(i,"value",O)),i.$on("change",n[3]);let L=St(n),C=Q(vt(n[1],n[2])),S=[];for(let P=0;P<C.length;P+=1)S[P]=Nt(wt(n,C,P));return{c(){e=b("h1"),e.textContent="LTN 1/20 scoring guidance",r=A(),t=b("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,l=A(),o=b("div"),N(i.$$.fragment),s=A(),L.c(),c=A(),d=b("table"),u=b("tr"),u.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,m=A();for(let P=0;P<S.length;P+=1)S[P].c();p=A(),y=b("button"),y.textContent="OK",Y(o,"display","flex"),Y(o,"justify-content","space-between")},m(P,B){v(P,e,B),v(P,r,B),v(P,t,B),v(P,l,B),v(P,o,B),I(i,o,null),g(o,s),L.m(o,null),v(P,c,B),v(P,d,B),g(d,u),g(d,m);for(let V=0;V<S.length;V+=1)S[V]&&S[V].m(d,null);v(P,p,B),v(P,y,B),q=!0,k||(h=J(y,"click",n[7]),k=!0)},p(P,B){const V={};if(!a&&B&2&&(a=!0,V.value=P[1],de(()=>a=!1)),i.$set(V),B&2&&re(f,f=P[1])?(ae(),$(L,1,1,te),ce(),L=St(P),L.c(),_(L,1),L.m(o,null)):L.p(P,B),B&6){C=Q(vt(P[1],P[2]));let X;for(X=0;X<C.length;X+=1){const M=wt(P,C,X);S[X]?S[X].p(M,B):(S[X]=Nt(M),S[X].c(),S[X].m(d,null))}for(;X<S.length;X+=1)S[X].d(1);S.length=C.length}},i(P){q||(_(i.$$.fragment,P),_(L),q=!0)},o(P){$(i.$$.fragment,P),$(L),q=!1},d(P){P&&(w(e),w(r),w(t),w(l),w(o),w(c),w(d),w(p),w(y)),E(i),L.d(P),me(S,P),k=!1,h()}}}function Zr(n){let e,r,t,l,o,i,a=n[0]&&Lt(n);return{c(){e=b("button"),e.textContent="LTN 1/20 scoring guidance",r=A(),a&&a.c(),t=Ge(),F(e,"class","secondary")},m(s,f){v(s,e,f),v(s,r,f),a&&a.m(s,f),v(s,t,f),l=!0,o||(i=J(e,"click",n[4]),o=!0)},p(s,[f]){s[0]?a?(a.p(s,f),f&1&&_(a,1)):(a=Lt(s),a.c(),_(a,1),a.m(t.parentNode,t)):a&&(ae(),$(a,1,1,()=>{a=null}),ce())},i(s){l||(_(a),l=!0)},o(s){$(a),l=!1},d(s){s&&(w(e),w(r),w(t)),a&&a.d(s),o=!1,i()}}}function Kr(n,e,r){let t=!1,l=Nn[0],o=xe(l)[0];function i(){r(2,o=xe(l)[0])}const a=()=>r(0,t=!0);function s(u){l=u,r(1,l)}function f(u){o=u,r(2,o)}return[t,l,o,i,a,s,f,()=>r(0,t=!1),()=>r(0,t=!1)]}class Xr extends oe{constructor(e){super(),ie(this,e,Kr,Zr,re,{})}}function It(n){let e,r;return e=new Xr({}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Wr(n){let e,r,t,l,o,i,a,s,f,c,d,u,m,p,y,q,k;function h(S){n[6](S)}let O={k:"horiz-radio",label:"User",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind!==void 0&&(O.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind),o=new Ae({props:O}),le.push(()=>fe(o,"value",h));let j=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind=="cycling"&&It();function L(S){n[7](S)}let C={k:"horiz-radio",label:"Score",choices:n[4]};return n[3].jats[n[0]].properties[n[1]].movements[n[2]].score!==void 0&&(C.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].score),f=new Ae({props:C}),le.push(()=>fe(f,"value",L)),{c(){e=b("label"),r=H(`Name
  `),t=b("input"),l=A(),N(o.$$.fragment),a=A(),j&&j.c(),s=A(),N(f.$$.fragment),d=A(),u=b("label"),m=H(`Comments
  `),p=b("textarea"),F(t,"type","text")},m(S,P){v(S,e,P),g(e,r),g(e,t),_e(t,n[3].jats[n[0]].properties[n[1]].movements[n[2]].name),v(S,l,P),I(o,S,P),v(S,a,P),j&&j.m(S,P),v(S,s,P),I(f,S,P),v(S,d,P),v(S,u,P),g(u,m),g(u,p),_e(p,n[3].jats[n[0]].properties[n[1]].movements[n[2]].notes),y=!0,q||(k=[J(t,"input",n[5]),J(p,"input",n[8])],q=!0)},p(S,[P]){P&15&&t.value!==S[3].jats[S[0]].properties[S[1]].movements[S[2]].name&&_e(t,S[3].jats[S[0]].properties[S[1]].movements[S[2]].name);const B={};!i&&P&15&&(i=!0,B.value=S[3].jats[S[0]].properties[S[1]].movements[S[2]].kind,de(()=>i=!1)),o.$set(B),S[3].jats[S[0]].properties[S[1]].movements[S[2]].kind=="cycling"?j?P&15&&_(j,1):(j=It(),j.c(),_(j,1),j.m(s.parentNode,s)):j&&(ae(),$(j,1,1,()=>{j=null}),ce());const V={};!c&&P&15&&(c=!0,V.value=S[3].jats[S[0]].properties[S[1]].movements[S[2]].score,de(()=>c=!1)),f.$set(V),P&15&&_e(p,S[3].jats[S[0]].properties[S[1]].movements[S[2]].notes)},i(S){y||(_(o.$$.fragment,S),_(j),_(f.$$.fragment,S),y=!0)},o(S){$(o.$$.fragment,S),$(j),$(f.$$.fragment,S),y=!1},d(S){S&&(w(e),w(l),w(a),w(s),w(d),w(u)),E(o,S),j&&j.d(S),E(f,S),q=!1,$e(k)}}}function Vr(n,e,r){let t;x(n,R,u=>r(3,t=u));let{junctionIdx:l}=e,{stage:o}=e,{idx:i}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(){t.jats[l].properties[o].movements[i].name=this.value,R.set(t)}function f(u){n.$$.not_equal(t.jats[l].properties[o].movements[i].kind,u)&&(t.jats[l].properties[o].movements[i].kind=u,R.set(t))}function c(u){n.$$.not_equal(t.jats[l].properties[o].movements[i].score,u)&&(t.jats[l].properties[o].movements[i].score=u,R.set(t))}function d(){t.jats[l].properties[o].movements[i].notes=this.value,R.set(t)}return n.$$set=u=>{"junctionIdx"in u&&r(0,l=u.junctionIdx),"stage"in u&&r(1,o=u.stage),"idx"in u&&r(2,i=u.idx)},[l,o,i,t,a,s,f,c,d]}class Qr extends oe{constructor(e){super(),ie(this,e,Vr,Wr,re,{junctionIdx:0,stage:1,idx:2})}}function Yr(n){return n%(2*Math.PI)*180/Math.PI}function Qe(n){return n%360*Math.PI/180}function Et(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function In(n,e,r={}){if(r.final===!0)return xr(n,e);const t=Et(n),l=Et(e),o=Qe(t[0]),i=Qe(l[0]),a=Qe(t[1]),s=Qe(l[1]),f=Math.sin(i-o)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-o);return Yr(Math.atan2(f,c))}function xr(n,e){let r=In(e,n);return r=(r+180)%360,r}var Pe=In;function el(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function tl(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!qt(n[0])||!qt(n[1]))throw new Error("coordinates must contain numbers");return el({type:"Point",coordinates:n},e,r)}function qt(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function nl(n,e={}){const r=Un(n),t=(r[0]+r[2])/2,l=(r[1]+r[3])/2;return tl([t,l],e.properties,e)}var rl=nl,ve=63710088e-1,ll={centimeters:ve*100,centimetres:ve*100,degrees:360/(2*Math.PI),feet:ve*3.28084,inches:ve*39.37,kilometers:ve/1e3,kilometres:ve/1e3,meters:ve,metres:ve,miles:ve/1609.344,millimeters:ve*1e3,millimetres:ve*1e3,nauticalmiles:ve/1852,radians:1,yards:ve*1.0936};function ol(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function il(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pt(n[0])||!Pt(n[1]))throw new Error("coordinates must contain numbers");return ol({type:"Point",coordinates:n},e,r)}function sl(n,e="kilometers"){const r=ll[e];if(!r)throw new Error(e+" units is invalid");return n/r}function Dt(n){return n%(2*Math.PI)*180/Math.PI}function tt(n){return n%360*Math.PI/180}function Pt(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function al(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function cl(n,e,r,t={}){const l=al(n),o=tt(l[0]),i=tt(l[1]),a=tt(r),s=sl(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(f)),d=Dt(c),u=Dt(f);return il([d,u],t.properties)}var Xe=cl,we=63710088e-1,ul={centimeters:we*100,centimetres:we*100,degrees:360/(2*Math.PI),feet:we*3.28084,inches:we*39.37,kilometers:we/1e3,kilometres:we/1e3,meters:we,metres:we,miles:we/1609.344,millimeters:we*1e3,millimetres:we*1e3,nauticalmiles:we/1852,radians:1,yards:we*1.0936};function fl(n,e="kilometers"){const r=ul[e];if(!r)throw new Error(e+" units is invalid");return n*r}function Ye(n){return n%360*Math.PI/180}function zt(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function dl(n,e,r={}){var t=zt(n),l=zt(e),o=Ye(l[1]-t[1]),i=Ye(l[0]-t[0]),a=Ye(t[1]),s=Ye(l[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return fl(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),r.units)}var ml=dl;function pl(n){let e=rl({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,l)=>Ft(Pe(e,l.point))-Ft(Pe(e,t.point)));let r=[];for(let t=0;t<n.length;t++){let l=n[t],o=Pe(l.point,e),i=1;for(let a of _l(t,n.length)){let s=n[a],f=Pe(e,s.point),c=gl(l.point,e,i++),d=ml(l.point,e),u=Xe(c,.5*d,o).geometry.coordinates,m=Xe(u,.2*d,f).geometry.coordinates;r.push({point1:c,point2:u,point3:m,kind:"cycling",score:"X",name:`${l.name} to ${s.name}`,notes:""})}}return r}function gl(n,e,r){let t=.003,o=Pe(n,e)-90,i=t*r;return Xe(n,i,o).geometry.coordinates}function Ft(n){return(n+360)%360}function _l(n,e){let r=[];for(let t=n+1;t<e;t++)r.push(t);for(let t=0;t<n;t++)r.push(t);return r}const hl="/route-element/assets/movement-aa45473c.svg",$l="/route-element/assets/pan-fbcec4cd.svg";function Ot(n,e,r){const t=n.slice();return t[31]=e[r],t[32]=e,t[33]=r,t}function Bt(n,e,r){const t=n.slice();return t[34]=e[r],t[35]=e,t[33]=r,t}function Rt(n){let e,r,t,l,o,i,a,s,f,c,d,u,m,p,y,q,k,h,O;function j(U,T){return U[0].mode=="select"?bl:kl}let L=j(n),C=L(n);function S(U,T){return U[0].mode=="new-arm"?wl:vl}let P=S(n),B=P(n);function V(U,T){return U[0].mode=="new-movement"?jl:yl}let X=V(n),M=X(n);return{c(){e=b("div"),r=b("button"),t=b("img"),o=A(),C.c(),i=A(),a=b("button"),s=et("svg"),f=et("circle"),c=et("text"),d=H("A"),u=A(),B.c(),m=A(),p=b("button"),y=b("img"),k=A(),M.c(),nt(t.src,l=$l)||F(t,"src",l),F(t,"alt","Move map"),Y(t,"vertical-align","middle"),F(r,"class","outline"),F(f,"cx","12"),F(f,"cy","12"),F(f,"r","12"),F(f,"fill","white"),F(c,"x","6"),F(c,"y","16"),F(c,"fill","#4472c4"),F(s,"width","24"),F(s,"height","24"),F(s,"xmlns","http://www.w3.org/2000/svg"),Y(s,"vertical-align","middle"),F(a,"class","outline"),nt(y.src,q=hl)||F(y,"src",q),F(y,"alt","New movement"),Y(y,"vertical-align","middle"),F(p,"class","outline"),F(e,"class","control-panel svelte-l1e6xi")},m(U,T){v(U,e,T),g(e,r),g(r,t),g(r,o),C.m(r,null),g(e,i),g(e,a),g(a,s),g(s,f),g(s,c),g(c,d),g(a,u),B.m(a,null),g(e,m),g(e,p),g(p,y),g(p,k),M.m(p,null),h||(O=[J(r,"click",function(){Zn(n[4])&&n[4].apply(this,arguments)}),J(a,"click",n[12]),J(p,"click",n[13])],h=!0)},p(U,T){n=U,L!==(L=j(n))&&(C.d(1),C=L(n),C&&(C.c(),C.m(r,null))),P!==(P=S(n))&&(B.d(1),B=P(n),B&&(B.c(),B.m(a,null))),X!==(X=V(n))&&(M.d(1),M=X(n),M&&(M.c(),M.m(p,null)))},d(U){U&&w(e),C.d(),B.d(),M.d(),h=!1,$e(O)}}}function kl(n){let e;return{c(){e=H("Move map")},m(r,t){v(r,e,t)},d(r){r&&w(e)}}}function bl(n){let e;return{c(){e=b("b"),e.textContent="Move map"},m(r,t){v(r,e,t)},d(r){r&&w(e)}}}function vl(n){let e;return{c(){e=H("New arm")},m(r,t){v(r,e,t)},d(r){r&&w(e)}}}function wl(n){let e;return{c(){e=b("b"),e.textContent="New arm"},m(r,t){v(r,e,t)},d(r){r&&w(e)}}}function yl(n){let e;return{c(){e=H("New movement")},m(r,t){v(r,e,t)},d(r){r&&w(e)}}}function jl(n){let e;return{c(){e=b("b"),e.textContent="New movement"},m(r,t){v(r,e,t)},d(r){r&&w(e)}}}function Cl(n){let e;return{c(){e=b("span"),e.textContent=`${zl(n[33])}`,F(e,"class","dot svelte-l1e6xi"),Y(e,"color","#4472c4"),Y(e,"background-color","white")},m(r,t){v(r,e,t)},p:te,d(r){r&&w(e)}}}function Jt(n){let e,r,t;function l(s){n[14](s,n[34])}function o(){return n[15](n[33])}function i(){return n[16](n[33])}let a={draggable:!0,$$slots:{default:[Cl]},$$scope:{ctx:n}};return n[34].point!==void 0&&(a.lngLat=n[34].point),e=new ze({props:a}),le.push(()=>fe(e,"lngLat",l)),e.$on("dragend",o),e.$on("click",i),{c(){N(e.$$.fragment)},m(s,f){I(e,s,f),t=!0},p(s,f){n=s;const c={};f[1]&32&&(c.$$scope={dirty:f,ctx:n}),!r&&f[0]&38&&(r=!0,c.lngLat=n[34].point,de(()=>r=!1)),e.$set(c)},i(s){t||(_(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function Ll(n){let e;return{c(){e=b("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score]),Y(e,"opacity",n[31].kind=="walking & wheeling"?"0%":"100%")},m(r,t){v(r,e,t)},p(r,t){t[0]&38&&Y(e,"background-color",r[7][r[31].score]),t[0]&38&&Y(e,"opacity",r[31].kind=="walking & wheeling"?"0%":"100%")},d(r){r&&w(e)}}}function Sl(n){let e;return{c(){e=b("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score])},m(r,t){v(r,e,t)},p(r,t){t[0]&38&&Y(e,"background-color",r[7][r[31].score])},d(r){r&&w(e)}}}function Al(n){let e;return{c(){e=b("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score]),Y(e,"opacity","0%")},m(r,t){v(r,e,t)},p(r,t){t[0]&38&&Y(e,"background-color",r[7][r[31].score])},d(r){r&&w(e)}}}function Ht(n){let e,r,t,l,o,i,a,s,f;function c(C){n[17](C,n[31])}function d(){return n[18](n[33])}function u(){return n[19](n[33])}let m={draggable:!0,$$slots:{default:[Ll]},$$scope:{ctx:n}};n[31].point1!==void 0&&(m.lngLat=n[31].point1),e=new ze({props:m}),le.push(()=>fe(e,"lngLat",c)),e.$on("dragend",d),e.$on("click",u);function p(C){n[20](C,n[31])}function y(){return n[21](n[33])}function q(){return n[22](n[33])}let k={draggable:!0,$$slots:{default:[Sl]},$$scope:{ctx:n}};n[31].point2!==void 0&&(k.lngLat=n[31].point2),l=new ze({props:k}),le.push(()=>fe(l,"lngLat",p)),l.$on("dragend",y),l.$on("click",q);function h(C){n[23](C,n[31])}function O(){return n[24](n[33])}function j(){return n[25](n[33])}let L={draggable:!0,$$slots:{default:[Al]},$$scope:{ctx:n}};return n[31].point3!==void 0&&(L.lngLat=n[31].point3),a=new ze({props:L}),le.push(()=>fe(a,"lngLat",h)),a.$on("dragend",O),a.$on("click",j),{c(){N(e.$$.fragment),t=A(),N(l.$$.fragment),i=A(),N(a.$$.fragment)},m(C,S){I(e,C,S),v(C,t,S),I(l,C,S),v(C,i,S),I(a,C,S),f=!0},p(C,S){n=C;const P={};S[0]&38|S[1]&32&&(P.$$scope={dirty:S,ctx:n}),!r&&S[0]&38&&(r=!0,P.lngLat=n[31].point1,de(()=>r=!1)),e.$set(P);const B={};S[0]&38|S[1]&32&&(B.$$scope={dirty:S,ctx:n}),!o&&S[0]&38&&(o=!0,B.lngLat=n[31].point2,de(()=>o=!1)),l.$set(B);const V={};S[0]&38|S[1]&32&&(V.$$scope={dirty:S,ctx:n}),!s&&S[0]&38&&(s=!0,V.lngLat=n[31].point3,de(()=>s=!1)),a.$set(V)},i(C){f||(_(e.$$.fragment,C),_(l.$$.fragment,C),_(a.$$.fragment,C),f=!0)},o(C){$(e.$$.fragment,C),$(l.$$.fragment,C),$(a.$$.fragment,C),f=!1},d(C){C&&(w(t),w(i)),E(e,C),E(l,C),E(a,C)}}}function Tl(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=H(e)},m(t,l){v(t,r,l)},p(t,l){l[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&se(r,e)},d(t){t&&w(r)}}}function Ml(n){let e,r;return e=new Sn({props:{$$slots:{default:[Tl,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l[0]&1073741824|l[1]&32&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Nl(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=H(e)},m(t,l){v(t,r,l)},p(t,l){l[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&se(r,e)},d(t){t&&w(r)}}}function Il(n){let e,r;return e=new Sn({props:{$$slots:{default:[Nl,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l[0]&1073741824|l[1]&32&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function El(n){let e,r,t,l,o,i;return e=new Se({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Ee(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Ml]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Se({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Ee(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Il]},$$scope:{ctx:n}}}),t.$on("click",n[9]),o=new nr({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){N(e.$$.fragment),r=A(),N(t.$$.fragment),l=A(),N(o.$$.fragment)},m(a,s){I(e,a,s),v(a,r,s),I(t,a,s),v(a,l,s),I(o,a,s),i=!0},p(a,s){const f={};s[1]&32&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const c={};s[1]&32&&(c.$$scope={dirty:s,ctx:a}),t.$set(c)},i(a){i||(_(e.$$.fragment,a),_(t.$$.fragment,a),_(o.$$.fragment,a),i=!0)},o(a){$(e.$$.fragment,a),$(t.$$.fragment,a),$(o.$$.fragment,a),i=!1},d(a){a&&(w(r),w(l)),E(e,a),E(t,a),E(o,a)}}}function ql(n){let e,r,t,l;return e=new Se({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Ce({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){N(e.$$.fragment),r=A(),N(t.$$.fragment)},m(o,i){I(e,o,i),v(o,r,i),I(t,o,i),l=!0},p:te,i(o){l||(_(e.$$.fragment,o),_(t.$$.fragment,o),l=!0)},o(o){$(e.$$.fragment,o),$(t.$$.fragment,o),l=!1},d(o){o&&w(r),E(e,o),E(t,o)}}}function Dl(n){let e,r,t,l,o,i,a,s,f;e=new An({}),e.$on("click",n[8]);let c=n[0].mode!="editing"&&Rt(n),d=Q(n[5].jats[n[1]].properties[n[2]].arms),u=[];for(let k=0;k<d.length;k+=1)u[k]=Jt(Bt(n,d,k));const m=k=>$(u[k],1,1,()=>{u[k]=null});let p=Q(n[5].jats[n[1]].properties[n[2]].movements),y=[];for(let k=0;k<p.length;k+=1)y[k]=Ht(Ot(n,p,k));const q=k=>$(y[k],1,1,()=>{y[k]=null});return i=new ge({props:{data:n[10](n[5]),$$slots:{default:[El]},$$scope:{ctx:n}}}),s=new ge({props:{data:n[6],$$slots:{default:[ql]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment),r=A(),c&&c.c(),t=A();for(let k=0;k<u.length;k+=1)u[k].c();l=A();for(let k=0;k<y.length;k+=1)y[k].c();o=A(),N(i.$$.fragment),a=A(),N(s.$$.fragment)},m(k,h){I(e,k,h),v(k,r,h),c&&c.m(k,h),v(k,t,h);for(let O=0;O<u.length;O+=1)u[O]&&u[O].m(k,h);v(k,l,h);for(let O=0;O<y.length;O+=1)y[O]&&y[O].m(k,h);v(k,o,h),I(i,k,h),v(k,a,h),I(s,k,h),f=!0},p(k,h){if(k[0].mode!="editing"?c?c.p(k,h):(c=Rt(k),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),h[0]&46){d=Q(k[5].jats[k[1]].properties[k[2]].arms);let L;for(L=0;L<d.length;L+=1){const C=Bt(k,d,L);u[L]?(u[L].p(C,h),_(u[L],1)):(u[L]=Jt(C),u[L].c(),_(u[L],1),u[L].m(l.parentNode,l))}for(ae(),L=d.length;L<u.length;L+=1)m(L);ce()}if(h[0]&174){p=Q(k[5].jats[k[1]].properties[k[2]].movements);let L;for(L=0;L<p.length;L+=1){const C=Ot(k,p,L);y[L]?(y[L].p(C,h),_(y[L],1)):(y[L]=Ht(C),y[L].c(),_(y[L],1),y[L].m(o.parentNode,o))}for(ae(),L=p.length;L<y.length;L+=1)q(L);ce()}const O={};h[0]&32&&(O.data=k[10](k[5])),h[1]&32&&(O.$$scope={dirty:h,ctx:k}),i.$set(O);const j={};h[0]&64&&(j.data=k[6]),h[1]&32&&(j.$$scope={dirty:h,ctx:k}),s.$set(j)},i(k){if(!f){_(e.$$.fragment,k);for(let h=0;h<d.length;h+=1)_(u[h]);for(let h=0;h<p.length;h+=1)_(y[h]);_(i.$$.fragment,k),_(s.$$.fragment,k),f=!0}},o(k){$(e.$$.fragment,k),u=u.filter(Boolean);for(let h=0;h<u.length;h+=1)$(u[h]);y=y.filter(Boolean);for(let h=0;h<y.length;h+=1)$(y[h]);$(i.$$.fragment,k),$(s.$$.fragment,k),f=!1},d(k){k&&(w(r),w(t),w(l),w(o),w(a)),E(e,k),c&&c.d(k),me(u,k),me(y,k),E(i,k),E(s,k)}}}function Pl(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function zl(n){return String.fromCharCode(n+"A".charCodeAt(0))}function Fl(n,e,r){let t,l,o;x(n,R,z=>r(5,l=z)),x(n,He,z=>r(26,o=z));let{junctionIdx:i}=e,{stage:a}=e,{mode:s}=e,{hoveringSidebar:f}=e,{select:c}=e,{stopEditing:d}=e,u={0:Te.red.background,1:Te.amber.background,2:Te.green.background,X:Te.critical.background};function m(z,K,je){let ue={type:"FeatureCollection",features:[]},D=K.mode=="editing"?K.id:je;return D!=null&&(D.kind=="arm"?ue.features.push(Pl(z.jats[i].properties[a].arms[D.idx],D.idx)):ue.features.push(k(z.jats[i].properties[a].movements[D.idx],D.idx))),ue}async function p(z){if(o){for(let K of o.queryRenderedFeatures(z.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await d();return}s.mode=="new-arm"?(G(R,l.jats[i].properties[a].arms=[...l.jats[i].properties[a].arms,{point:z.detail.lngLat.toArray(),name:""}],l),await c({kind:"arm",idx:l.jats[i].properties[a].arms.length-1})):(G(R,l.jats[i].properties[a].movements=[...l.jats[i].properties[a].movements,{point1:z.detail.lngLat.toArray(),point2:Xe(z.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Xe(z.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await c({kind:"movement",idx:l.jats[i].properties[a].movements.length-1}))}}}async function y(z){await c({kind:"movement",idx:z.detail.features[0].id})}function q(z){let K={type:"FeatureCollection",features:z.jats[i].properties[a].movements.map((je,ue)=>k(je,ue))};for(let je of z.jats[i].properties[a].movements)if(K.features.push(h(je,K.features.length)),je.kind=="walking & wheeling"){let ue={...je,point1:je.point3,point3:je.point1};K.features.push(h(ue,K.features.length))}return K}function k(z,K){return{type:"Feature",id:K,properties:{name:z.name,kind:z.kind,color:u[z.score]},geometry:{type:"LineString",coordinates:[z.point1,z.point2,z.point3]}}}function h(z,K){return{type:"Feature",id:K,properties:{kind:z.kind,color:u[z.score],angle:Pe(z.point2,z.point3)},geometry:{type:"Point",coordinates:z.point3}}}const O=()=>r(0,s={mode:"new-arm"}),j=()=>r(0,s={mode:"new-movement"});function L(z,K){n.$$.not_equal(K.point,z)&&(K.point=z,R.set(l))}const C=z=>c({kind:"arm",idx:z}),S=z=>c({kind:"arm",idx:z});function P(z,K){n.$$.not_equal(K.point1,z)&&(K.point1=z,R.set(l))}const B=z=>c({kind:"movement",idx:z}),V=z=>c({kind:"movement",idx:z});function X(z,K){n.$$.not_equal(K.point2,z)&&(K.point2=z,R.set(l))}const M=z=>c({kind:"movement",idx:z}),U=z=>c({kind:"movement",idx:z});function T(z,K){n.$$.not_equal(K.point3,z)&&(K.point3=z,R.set(l))}const he=z=>c({kind:"movement",idx:z}),pe=z=>c({kind:"movement",idx:z});return n.$$set=z=>{"junctionIdx"in z&&r(1,i=z.junctionIdx),"stage"in z&&r(2,a=z.stage),"mode"in z&&r(0,s=z.mode),"hoveringSidebar"in z&&r(11,f=z.hoveringSidebar),"select"in z&&r(3,c=z.select),"stopEditing"in z&&r(4,d=z.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&2081&&r(6,t=m(l,s,f))},[s,i,a,c,d,l,t,u,p,y,q,f,O,j,L,C,S,P,B,V,X,M,U,T,he,pe]}class Ol extends oe{constructor(e){super(),ie(this,e,Fl,Dl,re,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function Gt(n){if(n.movements.length==0)return"No movements added";let e=0,r=0;for(let l of n.movements)e+={0:0,1:1,2:2,X:0}[l.score],r+=2;let t=e/r*100;return`${Math.round(t)}%`}const{window:Bl}=Ue;function Ut(n,e,r){const t=n.slice();t[27]=e[r],t[30]=r;const l=t[14][t[27].score];return t[28]=l,t}function Zt(n,e,r){const t=n.slice();return t[31]=e[r],t[30]=r,t}function Rl(n){let e,r,t,l,o,i,a,s,f;return{c(){e=b("button"),e.textContent="Done",r=A(),t=b("button"),t.textContent="Delete",l=A(),o=b("label"),i=H(`Arm name
        `),a=b("input"),F(a,"type","text")},m(c,d){v(c,e,d),v(c,r,d),v(c,t,d),v(c,l,d),v(c,o,d),g(o,i),g(o,a),_e(a,n[5].jats[n[0]].properties[n[1]].arms[n[2].id.idx].name),s||(f=[J(e,"click",n[23]),J(t,"click",n[10]),J(a,"input",n[24])],s=!0)},p(c,d){d[0]&39&&a.value!==c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name&&_e(a,c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name)},i:te,o:te,d(c){c&&(w(e),w(r),w(t),w(l),w(o)),s=!1,$e(f)}}}function Jl(n){let e,r,t,l,o,i,a,s;return e=new Qr({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),{c(){N(e.$$.fragment),r=A(),t=b("button"),t.textContent="Save",l=A(),o=b("button"),o.textContent="Delete"},m(f,c){I(e,f,c),v(f,r,c),v(f,t,c),v(f,l,c),v(f,o,c),i=!0,a||(s=[J(t,"click",n[9]),J(o,"click",n[10])],a=!0)},p(f,c){const d={};c[0]&1&&(d.junctionIdx=f[0]),c[0]&2&&(d.stage=f[1]),c[0]&4&&(d.idx=f[2].id.idx),e.$set(d)},i(f){i||(_(e.$$.fragment,f),i=!0)},o(f){$(e.$$.fragment,f),i=!1},d(f){f&&(w(r),w(t),w(l),w(o)),E(e,f),a=!1,$e(s)}}}function Hl(n){let e,r,t,l,o,i,a,s,f,c,d,u,m,p=n[5].jats[n[0]].properties.name+"",y,q,k=Gt(n[5].jats[n[0]].properties[n[1]])+"",h,O,j,L,C,S,P,B,V,X,M,U=Q(n[5].jats[n[0]].properties[n[1]].arms),T=[];for(let D=0;D<U.length;D+=1)T[D]=Kt(Zt(n,U,D));const he=D=>$(T[D],1,1,()=>{T[D]=null});let pe=n[5].jats[n[0]].properties[n[7]].arms.length>0&&Xt(n),z=Q(n[5].jats[n[0]].properties[n[1]].movements),K=[];for(let D=0;D<z.length;D+=1)K[D]=Wt(Ut(n,z,D));const je=D=>$(K[D],1,1,()=>{K[D]=null});let ue=n[5].jats[n[0]].properties[n[7]].movements.length>0&&Vt(n);return{c(){e=b("button"),e.textContent="Done",r=A(),t=b("h3"),t.textContent="Arms",l=A();for(let D=0;D<T.length;D+=1)T[D].c();o=A(),pe&&pe.c(),i=A(),a=b("h3"),a.textContent="Movements",s=A(),f=b("p"),c=H("Total JAT score for "),d=H(n[1]),u=H(` junction
        `),m=b("i"),y=H(p),q=H(`
        : `),h=H(k),O=A(),j=b("button"),L=H("Generate cycling movements between all arms"),S=A();for(let D=0;D<K.length;D+=1)K[D].c();P=A(),ue&&ue.c(),B=Ge(),F(j,"class","secondary"),j.disabled=C=n[5].jats[n[0]].properties[n[1]].arms.length<2},m(D,W){v(D,e,W),v(D,r,W),v(D,t,W),v(D,l,W);for(let ee=0;ee<T.length;ee+=1)T[ee]&&T[ee].m(D,W);v(D,o,W),pe&&pe.m(D,W),v(D,i,W),v(D,a,W),v(D,s,W),v(D,f,W),g(f,c),g(f,d),g(f,u),g(f,m),g(m,y),g(f,q),g(f,h),v(D,O,W),v(D,j,W),g(j,L),v(D,S,W);for(let ee=0;ee<K.length;ee+=1)K[ee]&&K[ee].m(D,W);v(D,P,W),ue&&ue.m(D,W),v(D,B,W),V=!0,X||(M=[J(e,"click",n[16]),J(j,"click",n[15])],X=!0)},p(D,W){if(W[0]&299){U=Q(D[5].jats[D[0]].properties[D[1]].arms);let ee;for(ee=0;ee<U.length;ee+=1){const Ke=Zt(D,U,ee);T[ee]?(T[ee].p(Ke,W),_(T[ee],1)):(T[ee]=Kt(Ke),T[ee].c(),_(T[ee],1),T[ee].m(o.parentNode,o))}for(ae(),ee=U.length;ee<T.length;ee+=1)he(ee);ce()}if(D[5].jats[D[0]].properties[D[7]].arms.length>0?pe?pe.p(D,W):(pe=Xt(D),pe.c(),pe.m(i.parentNode,i)):pe&&(pe.d(1),pe=null),(!V||W[0]&2)&&se(d,D[1]),(!V||W[0]&33)&&p!==(p=D[5].jats[D[0]].properties.name+"")&&se(y,p),(!V||W[0]&35)&&k!==(k=Gt(D[5].jats[D[0]].properties[D[1]])+"")&&se(h,k),(!V||W[0]&35&&C!==(C=D[5].jats[D[0]].properties[D[1]].arms.length<2))&&(j.disabled=C),W[0]&16683){z=Q(D[5].jats[D[0]].properties[D[1]].movements);let ee;for(ee=0;ee<z.length;ee+=1){const Ke=Ut(D,z,ee);K[ee]?(K[ee].p(Ke,W),_(K[ee],1)):(K[ee]=Wt(Ke),K[ee].c(),_(K[ee],1),K[ee].m(P.parentNode,P))}for(ae(),ee=z.length;ee<K.length;ee+=1)je(ee);ce()}D[5].jats[D[0]].properties[D[7]].movements.length>0?ue?ue.p(D,W):(ue=Vt(D),ue.c(),ue.m(B.parentNode,B)):ue&&(ue.d(1),ue=null)},i(D){if(!V){for(let W=0;W<U.length;W+=1)_(T[W]);for(let W=0;W<z.length;W+=1)_(K[W]);V=!0}},o(D){T=T.filter(Boolean);for(let W=0;W<T.length;W+=1)$(T[W]);K=K.filter(Boolean);for(let W=0;W<K.length;W+=1)$(K[W]);V=!1},d(D){D&&(w(e),w(r),w(t),w(l),w(o),w(i),w(a),w(s),w(f),w(O),w(j),w(S),w(P),w(B)),me(T,D),pe&&pe.d(D),me(K,D),ue&&ue.d(D),X=!1,$e(M)}}}function Kt(n){let e,r;function t(){return n[17](n[30])}function l(){return n[18](n[30])}return e=new Tn({props:{name:`${Qt(n[30])} - ${n[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[19]),{c(){N(e.$$.fragment)},m(o,i){I(e,o,i),r=!0},p(o,i){n=o;const a={};i[0]&35&&(a.name=`${Qt(n[30])} - ${n[31].name||"Unnamed arm"}`),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){$(e.$$.fragment,o),r=!1},d(o){E(e,o)}}}function Xt(n){let e,r,t;return{c(){e=b("button"),e.textContent=`Copy arms from ${n[7]}`,F(e,"class","secondary")},m(l,o){v(l,e,o),r||(t=J(e,"click",n[12]),r=!0)},p:te,d(l){l&&w(e),r=!1,t()}}}function Gl(n){let e,r,t,l=n[27].score+"",o,i,a,s=Yt(n[27].kind)+"",f;return{c(){e=b("div"),r=b("span"),t=H("Score: "),o=H(l),i=A(),a=b("span"),f=H(s),Y(r,"padding","4px"),Y(r,"color",n[28].font),Y(r,"background-color",n[28].background),Y(e,"width","100%"),Y(e,"display","flex"),Y(e,"justify-content","space-between")},m(c,d){v(c,e,d),g(e,r),g(r,t),g(r,o),g(e,i),g(e,a),g(a,f)},p(c,d){d[0]&35&&l!==(l=c[27].score+"")&&se(o,l),d[0]&35&&Y(r,"color",c[28].font),d[0]&35&&Y(r,"background-color",c[28].background),d[0]&35&&s!==(s=Yt(c[27].kind)+"")&&se(f,s)},d(c){c&&w(e)}}}function Wt(n){let e,r;function t(){return n[20](n[30])}function l(){return n[21](n[30])}return e=new Tn({props:{name:n[27].name||"Unnamed movement",$$slots:{default:[Gl]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[22]),{c(){N(e.$$.fragment)},m(o,i){I(e,o,i),r=!0},p(o,i){n=o;const a={};i[0]&35&&(a.name=n[27].name||"Unnamed movement"),i[0]&35|i[1]&4&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){$(e.$$.fragment,o),r=!1},d(o){E(e,o)}}}function Vt(n){let e,r,t;return{c(){e=b("button"),e.textContent=`Copy movements from ${n[7]}`,F(e,"class","secondary")},m(l,o){v(l,e,o),r||(t=J(e,"click",n[13]),r=!0)},p:te,d(l){l&&w(e),r=!1,t()}}}function Ul(n){let e,r,t,l,o=n[5].jats[n[0]].properties.name+"",i,a,s,f,c;const d=[Hl,Jl,Rl],u=[];function m(p,y){return p[2].mode!="editing"?0:p[2].id.kind=="movement"?1:2}return s=m(n),f=u[s]=d[s](n),{c(){e=b("div"),r=b("h2"),t=H(n[1]),l=H(" JAT for "),i=H(o),a=A(),f.c(),F(e,"slot","sidebar")},m(p,y){v(p,e,y),g(e,r),g(r,t),g(r,l),g(r,i),g(e,a),u[s].m(e,null),n[25](e),c=!0},p(p,y){(!c||y[0]&2)&&se(t,p[1]),(!c||y[0]&33)&&o!==(o=p[5].jats[p[0]].properties.name+"")&&se(i,o);let q=s;s=m(p),s===q?u[s].p(p,y):(ae(),$(u[q],1,1,()=>{u[q]=null}),ce(),f=u[s],f?f.p(p,y):(f=u[s]=d[s](p),f.c()),_(f,1),f.m(e,null))},i(p){c||(_(f),c=!0)},o(p){$(f),c=!1},d(p){p&&w(e),u[s].d(),n[25](null)}}}function Zl(n){let e,r;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l[0]&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Kl(n){let e,r,t,l,o,i,a;return r=new qe({props:{except:"jats"}}),l=new ge({props:{data:ne(n[5].jats),generateId:!0,$$slots:{default:[Zl]},$$scope:{ctx:n}}}),i=new Ol({props:{junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],select:n[8],stopEditing:n[9]}}),{c(){e=b("div"),N(r.$$.fragment),t=A(),N(l.$$.fragment),o=A(),N(i.$$.fragment),F(e,"slot","map")},m(s,f){v(s,e,f),I(r,e,null),g(e,t),I(l,e,null),g(e,o),I(i,e,null),a=!0},p(s,f){const c={};f[0]&32&&(c.data=ne(s[5].jats)),f[0]&1|f[1]&4&&(c.$$scope={dirty:f,ctx:s}),l.$set(c);const d={};f[0]&1&&(d.junctionIdx=s[0]),f[0]&2&&(d.stage=s[1]),f[0]&4&&(d.mode=s[2]),f[0]&8&&(d.hoveringSidebar=s[3]),i.$set(d)},i(s){a||(_(r.$$.fragment,s),_(l.$$.fragment,s),_(i.$$.fragment,s),a=!0)},o(s){$(r.$$.fragment,s),$(l.$$.fragment,s),$(i.$$.fragment,s),a=!1},d(s){s&&w(e),E(r),E(l),E(i)}}}function Xl(n){let e,r,t,l;return e=new Me({props:{$$slots:{map:[Kl],sidebar:[Ul]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){I(e,o,i),r=!0,t||(l=J(Bl,"keydown",n[11]),t=!0)},p(o,i){const a={};i[0]&127|i[1]&4&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){$(e.$$.fragment,o),r=!1},d(o){E(e,o),t=!1,l()}}}function Qt(n){return String.fromCharCode(n+"A".charCodeAt(0))}function Yt(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function Wl(n,e,r){let t,l;x(n,R,T=>r(5,t=T)),x(n,Z,T=>r(6,l=T));let{junctionIdx:o}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s={mode:"select"},f=null,c=null,d;async function u(T){f=d.scrollTop,r(2,s={mode:"editing",id:T}),r(3,c=null),await Ie(),r(4,d.scrollTop=0,d)}async function m(){r(2,s={mode:"select"}),f!=null&&(await Ie(),r(4,d.scrollTop=f,d),f=null)}function p(){s.mode=="editing"&&window.confirm(`Delete this ${s.id.kind}?`)&&(s.id.kind=="movement"?(t.jats[o].properties[i].movements.splice(s.id.idx,1),R.set(t)):(t.jats[o].properties[i].arms.splice(s.id.idx,1),R.set(t)),m())}function y(T){if(s.mode!="editing")return;let he=T.target.tagName,pe=he=="INPUT"||he=="TEXTAREA";T.key=="Escape"||T.key=="Enter"&&!pe?(T.stopPropagation(),m()):T.key=="Delete"&&!pe&&(T.stopPropagation(),p())}function q(){t.jats[o].properties[i].arms.length>0&&!window.confirm("Overwrite arms?")||(G(R,t.jats[o].properties[i].arms=JSON.parse(JSON.stringify(t.jats[o].properties[a].arms)),t),R.set(t))}function k(){t.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite movements?")||(G(R,t.jats[o].properties[i].movements=JSON.parse(JSON.stringify(t.jats[o].properties[a].movements)),t),R.set(t))}let h={0:Te.red,1:Te.amber,2:Te.green,X:Te.critical};function O(){if(t.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let T=t.jats[o].properties[i].movements.filter(he=>he.kind=="walking & wheeling");G(R,t.jats[o].properties[i].movements=[...T,...pl(t.jats[o].properties[i].arms)],t)}const j=()=>G(Z,l={kind:"edit-jat",idx:o},l),L=T=>u({kind:"arm",idx:T}),C=T=>r(3,c={kind:"arm",idx:T}),S=()=>r(3,c=null),P=T=>u({kind:"movement",idx:T}),B=T=>r(3,c={kind:"movement",idx:T}),V=()=>r(3,c=null),X=()=>r(2,s={mode:"select"});function M(){t.jats[o].properties[i].arms[s.id.idx].name=this.value,R.set(t)}function U(T){le[T?"unshift":"push"](()=>{d=T,r(4,d)})}return n.$$set=T=>{"junctionIdx"in T&&r(0,o=T.junctionIdx),"stage"in T&&r(1,i=T.stage)},[o,i,s,c,d,t,l,a,u,m,p,y,q,k,h,O,j,L,C,S,P,B,V,X,M,U]}class Vl extends oe{constructor(e){super(),ie(this,e,Wl,Xl,re,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:Ql}=Ue;function Yl(n){let e,r,t,l,o,i,a,s,f,c,d,u,m,p;return{c(){e=b("div"),r=b("button"),r.textContent="Done",t=A(),l=b("button"),l.textContent="Delete JAT",o=A(),i=b("label"),a=H(`Name:
      `),s=b("input"),f=A(),c=b("button"),c.textContent="Existing",d=A(),u=b("button"),u.textContent="Proposed",F(s,"type","text"),F(e,"slot","sidebar")},m(y,q){v(y,e,q),g(e,r),g(e,t),g(e,l),g(e,o),g(e,i),g(i,a),g(i,s),_e(s,n[1].jats[n[0]].properties.name),g(e,f),g(e,c),g(e,d),g(e,u),m||(p=[J(r,"click",n[6]),J(l,"click",n[4]),J(s,"input",n[7]),J(c,"click",n[8]),J(u,"click",n[9])],m=!0)},p(y,q){q&3&&s.value!==y[1].jats[y[0]].properties.name&&_e(s,y[1].jats[y[0]].properties.name)},d(y){y&&w(e),m=!1,$e(p)}}}function xl(n){let e,r;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function eo(n){let e,r,t,l,o,i,a,s;r=new qe({props:{except:"jats"}}),l=new ge({props:{data:ne(n[1].jats),generateId:!0,$$slots:{default:[xl]},$$scope:{ctx:n}}});function f(d){n[5](d)}let c={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].jats[n[0]].geometry.coordinates),i=new ot({props:c}),le.push(()=>fe(i,"lngLat",f)),{c(){e=b("div"),N(r.$$.fragment),t=A(),N(l.$$.fragment),o=A(),N(i.$$.fragment),F(e,"slot","map")},m(d,u){v(d,e,u),I(r,e,null),g(e,t),I(l,e,null),g(e,o),I(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].jats)),u&1025&&(m.$$scope={dirty:u,ctx:d}),l.$set(m);const p={};u&3&&(p.color=d[1].jats[d[0]].properties.color),!a&&u&3&&(a=!0,p.lngLat=d[1].jats[d[0]].geometry.coordinates,de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(l.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(l.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&w(e),E(r),E(l),E(i)}}}function to(n){let e,r,t,l;return e=new Me({props:{$$slots:{map:[eo],sidebar:[Yl]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){I(e,o,i),r=!0,t||(l=J(Ql,"keydown",n[3]),t=!0)},p(o,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){$(e.$$.fragment,o),r=!1},d(o){E(e,o),t=!1,l()}}}function no(n,e,r){let t,l;x(n,R,m=>r(1,t=m)),x(n,Z,m=>r(2,l=m));let{idx:o}=e;function i(m){m.key=="Escape"&&G(Z,l={kind:"neutral"},l)}async function a(){window.confirm("Really delete this JAT?")&&(G(Z,l={kind:"neutral"},l),await Ie(),t.jats.splice(o,1),R.set(t))}function s(m){n.$$.not_equal(t.jats[o].geometry.coordinates,m)&&(t.jats[o].geometry.coordinates=m,R.set(t))}const f=()=>G(Z,l={kind:"neutral"},l);function c(){t.jats[o].properties.name=this.value,R.set(t)}const d=()=>G(Z,l={kind:"edit-jat-detail",idx:o,stage:"existing"},l),u=()=>G(Z,l={kind:"edit-jat-detail",idx:o,stage:"proposed"},l);return n.$$set=m=>{"idx"in m&&r(0,o=m.idx)},[o,t,l,i,a,s,f,c,d,u]}class ro extends oe{constructor(e){super(),ie(this,e,no,to,re,{idx:0})}}function xt(n,e,r){const t=n.slice();return t[3]=e[r],t[4]=e,t[5]=r,t}function lo(n){let e,r;return{c(){e=b("span"),r=A(),F(e,"class","dot svelte-jgyhla")},m(t,l){v(t,e,l),v(t,r,l)},p:te,d(t){t&&(w(e),w(r))}}}function en(n){let e,r,t;function l(i){n[2](i,n[3],n[4],n[5])}let o={draggable:!0,$$slots:{default:[lo]},$$scope:{ctx:n}};return n[3]!==void 0&&(o.lngLat=n[3]),e=new ze({props:o}),le.push(()=>fe(e,"lngLat",l)),{c(){N(e.$$.fragment)},m(i,a){I(e,i,a),t=!0},p(i,a){n=i;const s={};a&64&&(s.$$scope={dirty:a,ctx:n}),!r&&a&1&&(r=!0,s.lngLat=n[3],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function oo(n){let e,r,t,l;e=new An({}),e.$on("click",n[1]);let o=Q(n[0].geometry.coordinates),i=[];for(let s=0;s<o.length;s+=1)i[s]=en(xt(n,o,s));const a=s=>$(i[s],1,1,()=>{i[s]=null});return{c(){N(e.$$.fragment),r=A();for(let s=0;s<i.length;s+=1)i[s].c();t=Ge()},m(s,f){I(e,s,f),v(s,r,f);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(s,f);v(s,t,f),l=!0},p(s,[f]){if(f&1){o=Q(s[0].geometry.coordinates);let c;for(c=0;c<o.length;c+=1){const d=xt(s,o,c);i[c]?(i[c].p(d,f),_(i[c],1)):(i[c]=en(d),i[c].c(),_(i[c],1),i[c].m(t.parentNode,t))}for(ae(),c=o.length;c<i.length;c+=1)a(c);ce()}},i(s){if(!l){_(e.$$.fragment,s);for(let f=0;f<o.length;f+=1)_(i[f]);l=!0}},o(s){$(e.$$.fragment,s),i=i.filter(Boolean);for(let f=0;f<i.length;f+=1)$(i[f]);l=!1},d(s){s&&(w(r),w(t)),E(e,s),me(i,s)}}}function io(n,e,r){let{f:t}=e;function l(i){t.geometry.coordinates.push(i.detail.lngLat.toArray()),r(0,t)}function o(i,a,s,f){s[f]=i,r(0,t)}return n.$$set=i=>{"f"in i&&r(0,t=i.f)},[t,l,o]}class En extends oe{constructor(e){super(),ie(this,e,io,oo,re,{f:0})}}function so(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Le[n%Le.length],answers:Array(ye.length).fill("")}}}let ye=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:ke()},{name:"SA04",description:"trip hazards",choices:ke()},{name:"SA05",description:"kerbside activity",choices:ke()},{name:"SA08",description:"motor traffic speed",choices:ke()},{name:"SA09",description:"motor traffic volume",choices:ke()},{name:"SA11",description:"footway widths",choices:ke()},{name:"SA12",description:"effective width next to tram lines",choices:ke()},{name:"SA13",description:"crossing angle of tram/train rails",choices:ke()},{name:"SA14",description:"cycling surface and maintenance defects",choices:ke()},{name:"SA15",description:"WW surface and maintenance defects",choices:ke()},{name:"SA16",description:"guard railing",choices:ke()}];const{window:ao}=Ue;function tn(n,e,r){const t=n.slice();return t[10]=e[r],t[11]=e,t[12]=r,t}function nn(n){let e;return{c(){e=b("p"),e.textContent="A link needs at least two points"},m(r,t){v(r,e,t)},d(r){r&&w(e)}}}function rn(n){let e,r,t;function l(i){n[9](i,n[12])}let o={k:"horiz-radio",label:`${n[10].name}: ${n[10].description}`,choices:n[10].choices};return n[1].links[n[0]].properties.answers[n[12]]!==void 0&&(o.value=n[1].links[n[0]].properties.answers[n[12]]),e=new Ae({props:o}),le.push(()=>fe(e,"value",l)),{c(){N(e.$$.fragment)},m(i,a){I(e,i,a),t=!0},p(i,a){n=i;const s={};!r&&a&3&&(r=!0,s.value=n[1].links[n[0]].properties.answers[n[12]],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function co(n){let e,r,t,l,o,i,a,s,f,c,d,u,m,p,y,q=!n[2]&&nn(),k=Q(ye),h=[];for(let j=0;j<k.length;j+=1)h[j]=rn(tn(n,k,j));const O=j=>$(h[j],1,1,()=>{h[j]=null});return{c(){e=b("div"),r=b("button"),t=H("Done"),o=A(),i=b("button"),i.textContent="Delete link",a=A(),q&&q.c(),s=A(),f=b("label"),c=H(`Name:
      `),d=b("input"),u=A();for(let j=0;j<h.length;j+=1)h[j].c();r.disabled=l=!n[2],F(d,"type","text"),F(e,"slot","sidebar")},m(j,L){v(j,e,L),g(e,r),g(r,t),g(e,o),g(e,i),g(e,a),q&&q.m(e,null),g(e,s),g(e,f),g(f,c),g(f,d),_e(d,n[1].links[n[0]].properties.name),g(e,u);for(let C=0;C<h.length;C+=1)h[C]&&h[C].m(e,null);m=!0,p||(y=[J(r,"click",n[7]),J(i,"click",n[5]),J(d,"input",n[8])],p=!0)},p(j,L){if((!m||L&4&&l!==(l=!j[2]))&&(r.disabled=l),j[2]?q&&(q.d(1),q=null):q||(q=nn(),q.c(),q.m(e,s)),L&3&&d.value!==j[1].links[j[0]].properties.name&&_e(d,j[1].links[j[0]].properties.name),L&3){k=Q(ye);let C;for(C=0;C<k.length;C+=1){const S=tn(j,k,C);h[C]?(h[C].p(S,L),_(h[C],1)):(h[C]=rn(S),h[C].c(),_(h[C],1),h[C].m(e,null))}for(ae(),C=k.length;C<h.length;C+=1)O(C);ce()}},i(j){if(!m){for(let L=0;L<k.length;L+=1)_(h[L]);m=!0}},o(j){h=h.filter(Boolean);for(let L=0;L<h.length;L+=1)$(h[L]);m=!1},d(j){j&&w(e),q&&q.d(),me(h,j),p=!1,$e(y)}}}function uo(n){let e,r;return e=new Se({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&1&&(o.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function fo(n){let e,r,t,l,o,i,a,s;r=new qe({props:{except:"links"}}),l=new ge({props:{data:ne(n[1].links),generateId:!0,$$slots:{default:[uo]},$$scope:{ctx:n}}});function f(d){n[6](d)}let c={};return n[1].links[n[0]]!==void 0&&(c.f=n[1].links[n[0]]),i=new En({props:c}),le.push(()=>fe(i,"f",f)),{c(){e=b("div"),N(r.$$.fragment),t=A(),N(l.$$.fragment),o=A(),N(i.$$.fragment),F(e,"slot","map")},m(d,u){v(d,e,u),I(r,e,null),g(e,t),I(l,e,null),g(e,o),I(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].links)),u&8193&&(m.$$scope={dirty:u,ctx:d}),l.$set(m);const p={};!a&&u&3&&(a=!0,p.f=d[1].links[d[0]],de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(l.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(l.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&w(e),E(r),E(l),E(i)}}}function mo(n){let e,r,t,l;return e=new Me({props:{$$slots:{map:[fo],sidebar:[co]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){I(e,o,i),r=!0,t||(l=J(ao,"keydown",n[4]),t=!0)},p(o,[i]){const a={};i&8207&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){$(e.$$.fragment,o),r=!1},d(o){E(e,o),t=!1,l()}}}function po(n,e,r){let t,l,o;x(n,R,m=>r(1,l=m)),x(n,Z,m=>r(3,o=m));let{idx:i}=e;function a(m){m.key=="Escape"&&t&&G(Z,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this link?")&&(G(Z,o={kind:"neutral"},o),await Ie(),l.links.splice(i,1),R.set(l))}function f(m){n.$$.not_equal(l.links[i],m)&&(l.links[i]=m,R.set(l))}const c=()=>G(Z,o={kind:"neutral"},o);function d(){l.links[i].properties.name=this.value,R.set(l)}function u(m,p){n.$$.not_equal(l.links[i].properties.answers[p],m)&&(l.links[i].properties.answers[p]=m,R.set(l))}return n.$$set=m=>{"idx"in m&&r(0,i=m.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(2,t=l.links[i].geometry.coordinates.length>=2)},[i,l,t,o,a,s,f,c,d,u]}class go extends oe{constructor(e){super(),ie(this,e,po,mo,re,{idx:0})}}function ln(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function on(n){let e,r,t=n[6].properties.name+"",l,o,i,a,s,f;function c(u){n[5](u,n[6])}let d={k:"horiz-radio",label:"",choices:ye[n[0]].choices};return n[6].properties.answers[n[0]]!==void 0&&(d.value=n[6].properties.answers[n[0]]),i=new Ae({props:d}),le.push(()=>fe(i,"value",c)),{c(){e=b("li"),r=b("span"),l=H(t),o=A(),N(i.$$.fragment),s=A(),Y(r,"color",n[6].properties.color)},m(u,m){v(u,e,m),g(e,r),g(r,l),g(e,o),I(i,e,null),g(e,s),f=!0},p(u,m){n=u,(!f||m&4)&&t!==(t=n[6].properties.name+"")&&se(l,t),m&4&&Y(r,"color",n[6].properties.color);const p={};m&1&&(p.choices=ye[n[0]].choices),!a&&m&5&&(a=!0,p.value=n[6].properties.answers[n[0]],de(()=>a=!1)),i.$set(p)},i(u){f||(_(i.$$.fragment,u),f=!0)},o(u){$(i.$$.fragment,u),f=!1},d(u){u&&w(e),E(i)}}}function _o(n){let e,r,t,l,o=ye[n[0]].name+"",i,a,s=ye[n[0]].description+"",f,c,d,u,m,p,y=Q(n[2].links),q=[];for(let h=0;h<y.length;h+=1)q[h]=on(ln(n,y,h));const k=h=>$(q[h],1,1,()=>{q[h]=null});return{c(){e=b("div"),r=b("button"),r.textContent="Done",t=A(),l=b("h2"),i=H(o),a=H(": "),f=H(s),c=A(),d=b("ol");for(let h=0;h<q.length;h+=1)q[h].c();F(e,"slot","sidebar")},m(h,O){v(h,e,O),g(e,r),g(e,t),g(e,l),g(l,i),g(l,a),g(l,f),g(e,c),g(e,d);for(let j=0;j<q.length;j+=1)q[j]&&q[j].m(d,null);u=!0,m||(p=J(r,"click",n[4]),m=!0)},p(h,O){if((!u||O&1)&&o!==(o=ye[h[0]].name+"")&&se(i,o),(!u||O&1)&&s!==(s=ye[h[0]].description+"")&&se(f,s),O&5){y=Q(h[2].links);let j;for(j=0;j<y.length;j+=1){const L=ln(h,y,j);q[j]?(q[j].p(L,O),_(q[j],1)):(q[j]=on(L),q[j].c(),_(q[j],1),q[j].m(d,null))}for(ae(),j=y.length;j<q.length;j+=1)k(j);ce()}},i(h){if(!u){for(let O=0;O<y.length;O+=1)_(q[O]);u=!0}},o(h){q=q.filter(Boolean);for(let O=0;O<q.length;O+=1)$(q[O]);u=!1},d(h){h&&w(e),me(q,h),m=!1,p()}}}function ho(n){let e,r,t;return r=new qe({props:{showLinkColor:!0,except:""}}),{c(){e=b("div"),N(r.$$.fragment),F(e,"slot","map")},m(l,o){v(l,e,o),I(r,e,null),t=!0},p:te,i(l){t||(_(r.$$.fragment,l),t=!0)},o(l){$(r.$$.fragment,l),t=!1},d(l){l&&w(e),E(r)}}}function $o(n){let e,r,t,l;return e=new Me({props:{$$slots:{map:[ho],sidebar:[_o]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){I(e,o,i),r=!0,t||(l=J(window,"keydown",n[3]),t=!0)},p(o,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){$(e.$$.fragment,o),r=!1},d(o){E(e,o),t=!1,l()}}}function ko(n,e,r){let t,l;x(n,Z,f=>r(1,t=f)),x(n,R,f=>r(2,l=f));let{qIdx:o}=e;function i(f){f.key=="Escape"&&G(Z,t={kind:"neutral"},t)}const a=()=>G(Z,t={kind:"neutral"},t);function s(f,c){n.$$.not_equal(c.properties.answers[o],f)&&(c.properties.answers[o]=f,R.set(l))}return n.$$set=f=>{"qIdx"in f&&r(0,o=f.qIdx)},[o,t,l,i,a,s]}class bo extends oe{constructor(e){super(),ie(this,e,ko,$o,re,{qIdx:0})}}function vo(n){let e,r,t,l;const o=n[2].default,i=Fe(o,n,n[1],null);return{c(){e=b("a"),i&&i.c(),F(e,"href","#"),Y(e,"color",n[0])},m(a,s){v(a,e,s),i&&i.m(e,null),r=!0,t||(l=J(e,"click",Kn(n[3])),t=!0)},p(a,[s]){i&&i.p&&(!r||s&2)&&Oe(i,o,a,a[1],r?Re(o,a[1],s,null):Be(a[1]),null),s&1&&Y(e,"color",a[0])},i(a){r||(_(i,a),r=!0)},o(a){$(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),t=!1,l()}}}function wo(n,e,r){let{$$slots:t={},$$scope:l}=e,{color:o=void 0}=e;function i(a){be.call(this,n,a)}return n.$$set=a=>{"color"in a&&r(0,o=a.color),"$$scope"in a&&r(1,l=a.$$scope)},[o,l,t,i]}class Ze extends oe{constructor(e){super(),ie(this,e,wo,vo,re,{color:0})}}function yo(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Le[n%Le.length],st20:""}}}function sn(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function jo(n){let e=n[5].properties.name+"",r;return{c(){r=H(e)},m(t,l){v(t,r,l)},p(t,l){l&1&&e!==(e=t[5].properties.name+"")&&se(r,e)},d(t){t&&w(r)}}}function an(n){let e,r,t,l;function o(){return n[3](n[7])}return r=new Ze({props:{color:n[5].properties.color,$$slots:{default:[jo]},$$scope:{ctx:n}}}),r.$on("click",o),{c(){e=b("li"),N(r.$$.fragment),t=A()},m(i,a){v(i,e,a),I(r,e,null),g(e,t),l=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){l||(_(r.$$.fragment,i),l=!0)},o(i){$(r.$$.fragment,i),l=!1},d(i){i&&w(e),E(r)}}}function Co(n){let e,r,t,l,o,i,a,s,f=Q(n[0].bus_stops),c=[];for(let u=0;u<f.length;u+=1)c[u]=an(sn(n,f,u));const d=u=>$(c[u],1,1,()=>{c[u]=null});return{c(){e=H(`Bus stops:

`),r=b("div"),t=b("button"),t.textContent="New bus stop",l=A(),o=b("ol");for(let u=0;u<c.length;u+=1)c[u].c()},m(u,m){v(u,e,m),v(u,r,m),g(r,t),v(u,l,m),v(u,o,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(o,null);i=!0,a||(s=J(t,"click",n[2]),a=!0)},p(u,[m]){if(m&3){f=Q(u[0].bus_stops);let p;for(p=0;p<f.length;p+=1){const y=sn(u,f,p);c[p]?(c[p].p(y,m),_(c[p],1)):(c[p]=an(y),c[p].c(),_(c[p],1),c[p].m(o,null))}for(ae(),p=f.length;p<c.length;p+=1)d(p);ce()}},i(u){if(!i){for(let m=0;m<f.length;m+=1)_(c[m]);i=!0}},o(u){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)$(c[m]);i=!1},d(u){u&&(w(e),w(r),w(l),w(o)),me(c,u),a=!1,s()}}}function Lo(n,e,r){let t,l,o;x(n,R,s=>r(0,t=s)),x(n,Z,s=>r(1,l=s)),x(n,He,s=>r(4,o=s));function i(){if(!o)return;let s=yo(t.bus_stops.length,o.getCenter().toArray());G(R,t.bus_stops=[...t.bus_stops,s],t),G(Z,l={kind:"edit-bus-stop",idx:t.bus_stops.length-1},l)}return[t,l,i,s=>G(Z,l={kind:"edit-bus-stop",idx:s},l)]}let So=class extends oe{constructor(e){super(),ie(this,e,Lo,Co,re,{})}};function Ao(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:Le[n%Le.length],sa10:""}}}function cn(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function To(n){let e=n[5].properties.name+"",r;return{c(){r=H(e)},m(t,l){v(t,r,l)},p(t,l){l&1&&e!==(e=t[5].properties.name+"")&&se(r,e)},d(t){t&&w(r)}}}function un(n){let e,r,t,l;function o(){return n[3](n[7])}return r=new Ze({props:{color:n[5].properties.color,$$slots:{default:[To]},$$scope:{ctx:n}}}),r.$on("click",o),{c(){e=b("li"),N(r.$$.fragment),t=A()},m(i,a){v(i,e,a),I(r,e,null),g(e,t),l=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){l||(_(r.$$.fragment,i),l=!0)},o(i){$(r.$$.fragment,i),l=!1},d(i){i&&w(e),E(r)}}}function Mo(n){let e,r,t,l,o,i,a,s,f=Q(n[0].crossings),c=[];for(let u=0;u<f.length;u+=1)c[u]=un(cn(n,f,u));const d=u=>$(c[u],1,1,()=>{c[u]=null});return{c(){e=H(`Crossings:

`),r=b("div"),t=b("button"),t.textContent="New crossing",l=A(),o=b("ol");for(let u=0;u<c.length;u+=1)c[u].c()},m(u,m){v(u,e,m),v(u,r,m),g(r,t),v(u,l,m),v(u,o,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(o,null);i=!0,a||(s=J(t,"click",n[2]),a=!0)},p(u,[m]){if(m&3){f=Q(u[0].crossings);let p;for(p=0;p<f.length;p+=1){const y=cn(u,f,p);c[p]?(c[p].p(y,m),_(c[p],1)):(c[p]=un(y),c[p].c(),_(c[p],1),c[p].m(o,null))}for(ae(),p=f.length;p<c.length;p+=1)d(p);ce()}},i(u){if(!i){for(let m=0;m<f.length;m+=1)_(c[m]);i=!0}},o(u){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)$(c[m]);i=!1},d(u){u&&(w(e),w(r),w(l),w(o)),me(c,u),a=!1,s()}}}function No(n,e,r){let t,l,o;x(n,R,s=>r(0,t=s)),x(n,Z,s=>r(1,l=s)),x(n,He,s=>r(4,o=s));function i(){if(!o)return;let s=Ao(t.crossings.length,o.getCenter().toArray());G(R,t.crossings=[...t.crossings,s],t),G(Z,l={kind:"edit-crossing",idx:t.crossings.length-1},l)}return[t,l,i,s=>G(Z,l={kind:"edit-crossing",idx:s},l)]}let Io=class extends oe{constructor(e){super(),ie(this,e,No,Mo,re,{})}};function Eo(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Le[n%Le.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function fn(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function qo(n){let e=n[5].properties.name+"",r;return{c(){r=H(e)},m(t,l){v(t,r,l)},p(t,l){l&1&&e!==(e=t[5].properties.name+"")&&se(r,e)},d(t){t&&w(r)}}}function dn(n){let e,r,t,l;function o(){return n[3](n[7])}return r=new Ze({props:{color:n[5].properties.color,$$slots:{default:[qo]},$$scope:{ctx:n}}}),r.$on("click",o),{c(){e=b("li"),N(r.$$.fragment),t=A()},m(i,a){v(i,e,a),I(r,e,null),g(e,t),l=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){l||(_(r.$$.fragment,i),l=!0)},o(i){$(r.$$.fragment,i),l=!1},d(i){i&&w(e),E(r)}}}function Do(n){let e,r,t,l,o,i,a,s,f=Q(n[0].jats),c=[];for(let u=0;u<f.length;u+=1)c[u]=dn(fn(n,f,u));const d=u=>$(c[u],1,1,()=>{c[u]=null});return{c(){e=H(`JATs:

`),r=b("div"),t=b("button"),t.textContent="New JAT",l=A(),o=b("ol");for(let u=0;u<c.length;u+=1)c[u].c()},m(u,m){v(u,e,m),v(u,r,m),g(r,t),v(u,l,m),v(u,o,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(o,null);i=!0,a||(s=J(t,"click",n[2]),a=!0)},p(u,[m]){if(m&3){f=Q(u[0].jats);let p;for(p=0;p<f.length;p+=1){const y=fn(u,f,p);c[p]?(c[p].p(y,m),_(c[p],1)):(c[p]=dn(y),c[p].c(),_(c[p],1),c[p].m(o,null))}for(ae(),p=f.length;p<c.length;p+=1)d(p);ce()}},i(u){if(!i){for(let m=0;m<f.length;m+=1)_(c[m]);i=!0}},o(u){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)$(c[m]);i=!1},d(u){u&&(w(e),w(r),w(l),w(o)),me(c,u),a=!1,s()}}}function Po(n,e,r){let t,l,o;x(n,R,s=>r(0,t=s)),x(n,Z,s=>r(1,l=s)),x(n,He,s=>r(4,o=s));function i(){if(!o)return;let s=Eo(t.jats.length,o.getCenter().toArray());G(R,t.jats=[...t.jats,s],t),G(Z,l={kind:"edit-jat",idx:t.jats.length-1},l)}return[t,l,i,s=>G(Z,l={kind:"edit-jat",idx:s},l)]}let zo=class extends oe{constructor(e){super(),ie(this,e,Po,Do,re,{})}};function mn(n,e,r){const t=n.slice();return t[2]=e[r],t[4]=r,t}function pn(n,e,r){const t=n.slice();t[5]=e[r];const l=t[5].properties.answers[t[4]];return t[6]=l,t}function gn(n,e,r){const t=n.slice();return t[5]=e[r],t}function _n(n){let e,r=n[5].properties.name+"",t;return{c(){e=b("th"),t=H(r),Y(e,"color",n[5].properties.color)},m(l,o){v(l,e,o),g(e,t)},p(l,o){o&1&&r!==(r=l[5].properties.name+"")&&se(t,r),o&1&&Y(e,"color",l[5].properties.color)},d(l){l&&w(e)}}}function hn(n){let e,r=n[6]+"",t;return{c(){e=b("td"),t=H(r),Y(e,"background",n[6]==""?"red":"green")},m(l,o){v(l,e,o),g(e,t)},p(l,o){o&1&&r!==(r=l[6]+"")&&se(t,r),o&1&&Y(e,"background",l[6]==""?"red":"green")},d(l){l&&w(e)}}}function $n(n){let e,r,t,l,o=Q(n[0].links),i=[];for(let a=0;a<o.length;a+=1)i[a]=hn(pn(n,o,a));return{c(){e=b("tr"),r=b("th"),r.textContent=`${n[2].name}`,t=A();for(let a=0;a<i.length;a+=1)i[a].c();l=A()},m(a,s){v(a,e,s),g(e,r),g(e,t);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(e,null);g(e,l)},p(a,s){if(s&1){o=Q(a[0].links);let f;for(f=0;f<o.length;f+=1){const c=pn(a,o,f);i[f]?i[f].p(c,s):(i[f]=hn(c),i[f].c(),i[f].m(e,l))}for(;f<i.length;f+=1)i[f].d(1);i.length=o.length}},d(a){a&&w(e),me(i,a)}}}function Fo(n){let e,r,t,l,o,i,a,s=Q(n[0].links),f=[];for(let u=0;u<s.length;u+=1)f[u]=_n(gn(n,s,u));let c=Q(ye),d=[];for(let u=0;u<c.length;u+=1)d[u]=$n(mn(n,c,u));return{c(){e=b("table"),r=b("thead"),t=b("tr"),l=b("th"),o=A();for(let u=0;u<f.length;u+=1)f[u].c();i=A(),a=b("tbody");for(let u=0;u<d.length;u+=1)d[u].c()},m(u,m){v(u,e,m),g(e,r),g(r,t),g(t,l),g(t,o);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(t,null);g(e,i),g(e,a);for(let p=0;p<d.length;p+=1)d[p]&&d[p].m(a,null)},p(u,m){if(m&1){s=Q(u[0].links);let p;for(p=0;p<s.length;p+=1){const y=gn(u,s,p);f[p]?f[p].p(y,m):(f[p]=_n(y),f[p].c(),f[p].m(t,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=s.length}if(m&1){c=Q(ye);let p;for(p=0;p<c.length;p+=1){const y=mn(u,c,p);d[p]?d[p].p(y,m):(d[p]=$n(y),d[p].c(),d[p].m(a,null))}for(;p<d.length;p+=1)d[p].d(1);d.length=c.length}},d(u){u&&w(e),me(f,u),me(d,u)}}}function Oo(n){let e,r;return e=new Mn({props:{$$slots:{default:[Fo]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,[l]){const o={};l&2049&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Bo(n,e,r){let t;x(n,R,o=>r(0,t=o));function l(o){be.call(this,n,o)}return[t,l]}class Ro extends oe{constructor(e){super(),ie(this,e,Bo,Oo,re,{})}}function kn(n,e,r){const t=n.slice();return t[9]=e[r],t[11]=r,t}function bn(n,e,r){const t=n.slice();return t[12]=e[r],t[11]=r,t}function vn(n){let e,r;return e=new Ro({}),e.$on("close",n[4]),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Jo(n){let e=n[12].properties.name+"",r;return{c(){r=H(e)},m(t,l){v(t,r,l)},p(t,l){l&2&&e!==(e=t[12].properties.name+"")&&se(r,e)},d(t){t&&w(r)}}}function wn(n){let e,r,t,l;function o(){return n[6](n[11])}return r=new Ze({props:{color:n[12].properties.color,$$slots:{default:[Jo]},$$scope:{ctx:n}}}),r.$on("click",o),{c(){e=b("li"),N(r.$$.fragment),t=A()},m(i,a){v(i,e,a),I(r,e,null),g(e,t),l=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[12].properties.color),a&16386&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){l||(_(r.$$.fragment,i),l=!0)},o(i){$(r.$$.fragment,i),l=!1},d(i){i&&w(e),E(r)}}}function Ho(n){let e=n[9].name+"",r,t;return{c(){r=H(e),t=A()},m(l,o){v(l,r,o),v(l,t,o)},p:te,d(l){l&&(w(r),w(t))}}}function yn(n){let e,r,t,l,o,i,a,s;function f(){return n[7](n[11])}r=new Ze({props:{$$slots:{default:[Ho]},$$scope:{ctx:n}}}),r.$on("click",f);function c(...d){return n[8](n[11],...d)}return{c(){e=b("li"),N(r.$$.fragment),t=H(`:
      `),l=b("progress"),a=A(),l.value=o=n[1].links.filter(c).length,F(l,"max",i=n[1].links.length),F(l,"class","svelte-zadug4")},m(d,u){v(d,e,u),I(r,e,null),g(e,t),g(e,l),g(e,a),s=!0},p(d,u){n=d;const m={};u&16384&&(m.$$scope={dirty:u,ctx:n}),r.$set(m),(!s||u&2&&o!==(o=n[1].links.filter(c).length))&&(l.value=o),(!s||u&2&&i!==(i=n[1].links.length))&&F(l,"max",i)},i(d){s||(_(r.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),s=!1},d(d){d&&w(e),E(r)}}}function Go(n){let e,r,t,l,o,i,a,s,f,c,d,u,m=n[0]&&vn(n),p=Q(n[1].links),y=[];for(let j=0;j<p.length;j+=1)y[j]=wn(bn(n,p,j));const q=j=>$(y[j],1,1,()=>{y[j]=null});let k=Q(ye),h=[];for(let j=0;j<k.length;j+=1)h[j]=yn(kn(n,k,j));const O=j=>$(h[j],1,1,()=>{h[j]=null});return{c(){m&&m.c(),e=A(),r=b("div"),t=b("button"),t.textContent="New link",l=A(),o=b("button"),o.textContent="Table of questions",i=H(`

Links:
`),a=b("ol");for(let j=0;j<y.length;j+=1)y[j].c();s=H(`

Questions:
`),f=b("ol");for(let j=0;j<h.length;j+=1)h[j].c()},m(j,L){m&&m.m(j,L),v(j,e,L),v(j,r,L),g(r,t),g(r,l),g(r,o),v(j,i,L),v(j,a,L);for(let C=0;C<y.length;C+=1)y[C]&&y[C].m(a,null);v(j,s,L),v(j,f,L);for(let C=0;C<h.length;C+=1)h[C]&&h[C].m(f,null);c=!0,d||(u=[J(t,"click",n[3]),J(o,"click",n[5])],d=!0)},p(j,[L]){if(j[0]?m?(m.p(j,L),L&1&&_(m,1)):(m=vn(j),m.c(),_(m,1),m.m(e.parentNode,e)):m&&(ae(),$(m,1,1,()=>{m=null}),ce()),L&6){p=Q(j[1].links);let C;for(C=0;C<p.length;C+=1){const S=bn(j,p,C);y[C]?(y[C].p(S,L),_(y[C],1)):(y[C]=wn(S),y[C].c(),_(y[C],1),y[C].m(a,null))}for(ae(),C=p.length;C<y.length;C+=1)q(C);ce()}if(L&6){k=Q(ye);let C;for(C=0;C<k.length;C+=1){const S=kn(j,k,C);h[C]?(h[C].p(S,L),_(h[C],1)):(h[C]=yn(S),h[C].c(),_(h[C],1),h[C].m(f,null))}for(ae(),C=k.length;C<h.length;C+=1)O(C);ce()}},i(j){if(!c){_(m);for(let L=0;L<p.length;L+=1)_(y[L]);for(let L=0;L<k.length;L+=1)_(h[L]);c=!0}},o(j){$(m),y=y.filter(Boolean);for(let L=0;L<y.length;L+=1)$(y[L]);h=h.filter(Boolean);for(let L=0;L<h.length;L+=1)$(h[L]);c=!1},d(j){j&&(w(e),w(r),w(i),w(a),w(s),w(f)),m&&m.d(j),me(y,j),me(h,j),d=!1,$e(u)}}}function Uo(n,e,r){let t,l;x(n,R,u=>r(1,t=u)),x(n,Z,u=>r(2,l=u));let o=!1;function i(){let u=so(t.links.length);G(R,t.links=[...t.links,u],t),G(Z,l={kind:"edit-link",idx:t.links.length-1},l)}return[o,t,l,i,()=>r(0,o=!1),()=>r(0,o=!0),u=>G(Z,l={kind:"edit-link",idx:u},l),u=>G(Z,l={kind:"edit-question",idx:u},l),(u,m)=>m.properties.answers[u]!=""]}let Zo=class extends oe{constructor(e){super(),ie(this,e,Uo,Go,re,{})}};function Ko(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled side road",color:Le[n%Le.length],sa01:""}}}function jn(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Xo(n){let e=n[4].properties.name+"",r;return{c(){r=H(e)},m(t,l){v(t,r,l)},p(t,l){l&1&&e!==(e=t[4].properties.name+"")&&se(r,e)},d(t){t&&w(r)}}}function Cn(n){let e,r,t,l;function o(){return n[3](n[6])}return r=new Ze({props:{color:n[4].properties.color,$$slots:{default:[Xo]},$$scope:{ctx:n}}}),r.$on("click",o),{c(){e=b("li"),N(r.$$.fragment),t=A()},m(i,a){v(i,e,a),I(r,e,null),g(e,t),l=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[4].properties.color),a&129&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){l||(_(r.$$.fragment,i),l=!0)},o(i){$(r.$$.fragment,i),l=!1},d(i){i&&w(e),E(r)}}}function Wo(n){let e,r,t,l,o,i,a,s,f=Q(n[0].side_roads),c=[];for(let u=0;u<f.length;u+=1)c[u]=Cn(jn(n,f,u));const d=u=>$(c[u],1,1,()=>{c[u]=null});return{c(){e=H(`Side roads:

`),r=b("div"),t=b("button"),t.textContent="New side road",l=A(),o=b("ol");for(let u=0;u<c.length;u+=1)c[u].c()},m(u,m){v(u,e,m),v(u,r,m),g(r,t),v(u,l,m),v(u,o,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(o,null);i=!0,a||(s=J(t,"click",n[2]),a=!0)},p(u,[m]){if(m&3){f=Q(u[0].side_roads);let p;for(p=0;p<f.length;p+=1){const y=jn(u,f,p);c[p]?(c[p].p(y,m),_(c[p],1)):(c[p]=Cn(y),c[p].c(),_(c[p],1),c[p].m(o,null))}for(ae(),p=f.length;p<c.length;p+=1)d(p);ce()}},i(u){if(!i){for(let m=0;m<f.length;m+=1)_(c[m]);i=!0}},o(u){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)$(c[m]);i=!1},d(u){u&&(w(e),w(r),w(l),w(o)),me(c,u),a=!1,s()}}}function Vo(n,e,r){let t,l;x(n,R,a=>r(0,t=a)),x(n,Z,a=>r(1,l=a));function o(){let a=Ko(t.side_roads.length);G(R,t.side_roads=[...t.side_roads,a],t),G(Z,l={kind:"edit-side-road",idx:t.side_roads.length-1},l)}return[t,l,o,a=>G(Z,l={kind:"edit-side-road",idx:a},l)]}class Qo extends oe{constructor(e){super(),ie(this,e,Vo,Wo,re,{})}}function Yo(n){let e,r,t,l,o,i,a,s,f,c,d,u,m,p,y,q,k,h,O,j,L,C,S,P,B,V,X,M;return f=new Zo({}),m=new zo({}),k=new So({}),L=new Io({}),B=new Qo({}),{c(){e=b("div"),r=b("div"),t=b("button"),t.textContent="Download",l=A(),o=b("button"),o.textContent="Clear",i=A(),a=b("hr"),s=A(),N(f.$$.fragment),c=A(),d=b("hr"),u=A(),N(m.$$.fragment),p=A(),y=b("hr"),q=A(),N(k.$$.fragment),h=A(),O=b("hr"),j=A(),N(L.$$.fragment),C=A(),S=b("hr"),P=A(),N(B.$$.fragment),F(t,"class","secondary"),F(o,"class","secondary"),F(e,"slot","sidebar")},m(U,T){v(U,e,T),g(e,r),g(r,t),g(r,l),g(r,o),g(e,i),g(e,a),g(e,s),I(f,e,null),g(e,c),g(e,d),g(e,u),I(m,e,null),g(e,p),g(e,y),g(e,q),I(k,e,null),g(e,h),g(e,O),g(e,j),I(L,e,null),g(e,C),g(e,S),g(e,P),I(B,e,null),V=!0,X||(M=[J(t,"click",n[8]),J(o,"click",n[2])],X=!0)},p:te,i(U){V||(_(f.$$.fragment,U),_(m.$$.fragment,U),_(k.$$.fragment,U),_(L.$$.fragment,U),_(B.$$.fragment,U),V=!0)},o(U){$(f.$$.fragment,U),$(m.$$.fragment,U),$(k.$$.fragment,U),$(L.$$.fragment,U),$(B.$$.fragment,U),V=!1},d(U){U&&w(e),E(f),E(m),E(k),E(L),E(B),X=!1,$e(M)}}}function xo(n){let e,r;return e=new Se({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":Ee(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[3]),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ei(n){let e,r;return e=new Ce({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":Ee(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[4]),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ti(n){let e,r;return e=new Ce({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":Ee(10,15)},hoverCursor:"pointer"}}),e.$on("click",n[5]),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ni(n){let e,r;return e=new Ce({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":Ee(10,15)},hoverCursor:"pointer"}}),e.$on("click",n[6]),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ri(n){let e,r;return e=new Se({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":Ee(3,6)},hoverCursor:"pointer"}}),e.$on("click",n[7]),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function li(n){let e,r,t,l,o,i,a,s,f,c,d;return r=new ge({props:{data:ne(n[0].links),generateId:!0,$$slots:{default:[xo]},$$scope:{ctx:n}}}),l=new ge({props:{data:ne(n[0].jats),generateId:!0,$$slots:{default:[ei]},$$scope:{ctx:n}}}),i=new ge({props:{data:ne(n[0].bus_stops),generateId:!0,$$slots:{default:[ti]},$$scope:{ctx:n}}}),s=new ge({props:{data:ne(n[0].crossings),generateId:!0,$$slots:{default:[ni]},$$scope:{ctx:n}}}),c=new ge({props:{data:ne(n[0].side_roads),generateId:!0,$$slots:{default:[ri]},$$scope:{ctx:n}}}),{c(){e=b("div"),N(r.$$.fragment),t=A(),N(l.$$.fragment),o=A(),N(i.$$.fragment),a=A(),N(s.$$.fragment),f=A(),N(c.$$.fragment),F(e,"slot","map")},m(u,m){v(u,e,m),I(r,e,null),g(e,t),I(l,e,null),g(e,o),I(i,e,null),g(e,a),I(s,e,null),g(e,f),I(c,e,null),d=!0},p(u,m){const p={};m&1&&(p.data=ne(u[0].links)),m&514&&(p.$$scope={dirty:m,ctx:u}),r.$set(p);const y={};m&1&&(y.data=ne(u[0].jats)),m&514&&(y.$$scope={dirty:m,ctx:u}),l.$set(y);const q={};m&1&&(q.data=ne(u[0].bus_stops)),m&514&&(q.$$scope={dirty:m,ctx:u}),i.$set(q);const k={};m&1&&(k.data=ne(u[0].crossings)),m&514&&(k.$$scope={dirty:m,ctx:u}),s.$set(k);const h={};m&1&&(h.data=ne(u[0].side_roads)),m&514&&(h.$$scope={dirty:m,ctx:u}),c.$set(h)},i(u){d||(_(r.$$.fragment,u),_(l.$$.fragment,u),_(i.$$.fragment,u),_(s.$$.fragment,u),_(c.$$.fragment,u),d=!0)},o(u){$(r.$$.fragment,u),$(l.$$.fragment,u),$(i.$$.fragment,u),$(s.$$.fragment,u),$(c.$$.fragment,u),d=!1},d(u){u&&w(e),E(r),E(l),E(i),E(s),E(c)}}}function oi(n){let e,r;return e=new Me({props:{$$slots:{map:[li],sidebar:[Yo]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,[l]){const o={};l&515&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ii(n,e,r){let t,l;x(n,R,u=>r(0,t=u)),x(n,Z,u=>r(1,l=u));function o(){G(R,t.links=[],t),G(R,t.jats=[],t),G(R,t.bus_stops=[],t),G(R,t.crossings=[],t),G(R,t.side_roads=[],t)}return[t,l,o,u=>G(Z,l={kind:"edit-link",idx:u.detail.features[0].id},l),u=>G(Z,l={kind:"edit-jat",idx:u.detail.features[0].id},l),u=>G(Z,l={kind:"edit-bus-stop",idx:u.detail.features[0].id},l),u=>G(Z,l={kind:"edit-crossing",idx:u.detail.features[0].id},l),u=>G(Z,l={kind:"edit-side-road",idx:u.detail.features[0].id},l),()=>Gr("rcv2.geojson",JSON.stringify(t))]}class si extends oe{constructor(e){super(),ie(this,e,ii,oi,re,{})}}const{window:ai}=Ue;function Ln(n){let e;return{c(){e=b("p"),e.textContent="A side road needs at least two points"},m(r,t){v(r,e,t)},d(r){r&&w(e)}}}function ci(n){let e,r,t,l,o,i,a,s,f,c,d,u,m,p,y,q,k,h=!n[2]&&Ln();function O(L){n[9](L)}let j={k:"horiz-radio",label:"SA01: conflict at side roads and priority junctions",choices:ke()};return n[1].side_roads[n[0]].properties.sa01!==void 0&&(j.value=n[1].side_roads[n[0]].properties.sa01),m=new Ae({props:j}),le.push(()=>fe(m,"value",O)),{c(){e=b("div"),r=b("button"),t=H("Done"),o=A(),i=b("button"),i.textContent="Delete side road",a=A(),h&&h.c(),s=A(),f=b("label"),c=H(`Name:
      `),d=b("input"),u=A(),N(m.$$.fragment),r.disabled=l=!n[2],F(d,"type","text"),F(e,"slot","sidebar")},m(L,C){v(L,e,C),g(e,r),g(r,t),g(e,o),g(e,i),g(e,a),h&&h.m(e,null),g(e,s),g(e,f),g(f,c),g(f,d),_e(d,n[1].side_roads[n[0]].properties.name),g(e,u),I(m,e,null),y=!0,q||(k=[J(r,"click",n[7]),J(i,"click",n[5]),J(d,"input",n[8])],q=!0)},p(L,C){(!y||C&4&&l!==(l=!L[2]))&&(r.disabled=l),L[2]?h&&(h.d(1),h=null):h||(h=Ln(),h.c(),h.m(e,s)),C&3&&d.value!==L[1].side_roads[L[0]].properties.name&&_e(d,L[1].side_roads[L[0]].properties.name);const S={};!p&&C&3&&(p=!0,S.value=L[1].side_roads[L[0]].properties.sa01,de(()=>p=!1)),m.$set(S)},i(L){y||(_(m.$$.fragment,L),y=!0)},o(L){$(m.$$.fragment,L),y=!1},d(L){L&&w(e),h&&h.d(),E(m),q=!1,$e(k)}}}function ui(n){let e,r;return e=new Se({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":3}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&1&&(o.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":3}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function fi(n){let e,r,t,l,o,i,a,s;r=new qe({props:{except:"side_roads"}}),l=new ge({props:{data:ne(n[1].side_roads),generateId:!0,$$slots:{default:[ui]},$$scope:{ctx:n}}});function f(d){n[6](d)}let c={};return n[1].side_roads[n[0]]!==void 0&&(c.f=n[1].side_roads[n[0]]),i=new En({props:c}),le.push(()=>fe(i,"f",f)),{c(){e=b("div"),N(r.$$.fragment),t=A(),N(l.$$.fragment),o=A(),N(i.$$.fragment),F(e,"slot","map")},m(d,u){v(d,e,u),I(r,e,null),g(e,t),I(l,e,null),g(e,o),I(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].side_roads)),u&1025&&(m.$$scope={dirty:u,ctx:d}),l.$set(m);const p={};!a&&u&3&&(a=!0,p.f=d[1].side_roads[d[0]],de(()=>a=!1)),i.$set(p)},i(d){s||(_(r.$$.fragment,d),_(l.$$.fragment,d),_(i.$$.fragment,d),s=!0)},o(d){$(r.$$.fragment,d),$(l.$$.fragment,d),$(i.$$.fragment,d),s=!1},d(d){d&&w(e),E(r),E(l),E(i)}}}function di(n){let e,r,t,l;return e=new Me({props:{$$slots:{map:[fi],sidebar:[ci]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){I(e,o,i),r=!0,t||(l=J(ai,"keydown",n[4]),t=!0)},p(o,[i]){const a={};i&1039&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){$(e.$$.fragment,o),r=!1},d(o){E(e,o),t=!1,l()}}}function mi(n,e,r){let t,l,o;x(n,R,m=>r(1,l=m)),x(n,Z,m=>r(3,o=m));let{idx:i}=e;function a(m){m.key=="Escape"&&G(Z,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this side road?")&&(G(Z,o={kind:"neutral"},o),await Ie(),l.side_roads.splice(i,1),R.set(l))}function f(m){n.$$.not_equal(l.side_roads[i],m)&&(l.side_roads[i]=m,R.set(l))}const c=()=>G(Z,o={kind:"neutral"},o);function d(){l.side_roads[i].properties.name=this.value,R.set(l)}function u(m){n.$$.not_equal(l.side_roads[i].properties.sa01,m)&&(l.side_roads[i].properties.sa01=m,R.set(l))}return n.$$set=m=>{"idx"in m&&r(0,i=m.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(2,t=l.side_roads[i].geometry.coordinates.length>=2)},[i,l,t,o,a,s,f,c,d,u]}class pi extends oe{constructor(e){super(),ie(this,e,mi,di,re,{idx:0})}}function gi(n){let e,r;return{c(){e=b("div"),r=b("div"),F(e,"slot","left")},m(t,l){v(t,e,l),g(e,r),n[9](r)},p:te,d(t){t&&w(e),n[9](null)}}}function _i(n){return{c:te,m:te,p:te,i:te,o:te,d:te}}function hi(n){let e,r,t;function l(i){n[8](i)}let o={style:n[10],standardControls:!0,hash:!0,$$slots:{default:[Li]},$$scope:{ctx:n}};return n[2]!==void 0&&(o.map=n[2]),e=new Wn({props:o}),le.push(()=>fe(e,"map",l)),{c(){N(e.$$.fragment)},m(i,a){I(e,i,a),t=!0},p(i,a){const s={};a&2058&&(s.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,s.map=i[2],de(()=>r=!1)),e.$set(s)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function $i(n){let e,r;return e=new bo({props:{qIdx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&8&&(o.qIdx=t[3].idx),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ki(n){let e,r;return e=new pi({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&8&&(o.idx=t[3].idx),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function bi(n){let e,r;return e=new Dr({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&8&&(o.idx=t[3].idx),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function vi(n){let e,r;return e=new Ar({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&8&&(o.idx=t[3].idx),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function wi(n){let e,r;return e=new Vl({props:{junctionIdx:n[3].idx,stage:n[3].stage}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&8&&(o.junctionIdx=t[3].idx),l&8&&(o.stage=t[3].stage),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function yi(n){let e,r;return e=new ro({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&8&&(o.idx=t[3].idx),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ji(n){let e,r;return e=new go({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,l){const o={};l&8&&(o.idx=t[3].idx),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ci(n){let e,r;return e=new si({}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p:te,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Li(n){let e,r,t,l,o,i;const a=[Ci,ji,yi,wi,vi,bi,ki,$i],s=[];function f(c,d){return c[3].kind=="neutral"?0:c[3].kind=="edit-link"?1:c[3].kind=="edit-jat"?2:c[3].kind=="edit-jat-detail"?3:c[3].kind=="edit-bus-stop"?4:c[3].kind=="edit-crossing"?5:c[3].kind=="edit-side-road"?6:c[3].kind=="edit-question"?7:-1}return~(t=f(n))&&(l=s[t]=a[t](n)),{c(){e=b("div"),r=A(),l&&l.c(),o=Ge()},m(c,d){v(c,e,d),n[7](e),v(c,r,d),~t&&s[t].m(c,d),v(c,o,d),i=!0},p(c,d){let u=t;t=f(c),t===u?~t&&s[t].p(c,d):(l&&(ae(),$(s[u],1,1,()=>{s[u]=null}),ce()),~t?(l=s[t],l?l.p(c,d):(l=s[t]=a[t](c),l.c()),_(l,1),l.m(o.parentNode,o)):l=null)},i(c){i||(_(l),i=!0)},o(c){$(l),i=!1},d(c){c&&(w(e),w(r),w(o)),n[7](null),~t&&s[t].d(c)}}}function Si(n){return{c:te,m:te,p:te,i:te,o:te,d:te}}function Ai(n){let e,r,t={ctx:n,current:null,token:null,hasCatch:!1,pending:Si,then:hi,catch:_i,value:10,blocks:[,,,]};return Vn(Pr(new URLSearchParams(window.location.search).get("google")||""),t),{c(){e=b("div"),t.block.c(),F(e,"slot","main"),Y(e,"position","relative"),Y(e,"width","100%"),Y(e,"height","100vh")},m(l,o){v(l,e,o),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,r=!0},p(l,o){n=l,Qn(t,n,o)},i(l){r||(_(t.block),r=!0)},o(l){for(let o=0;o<3;o+=1){const i=t.blocks[o];$(i)}r=!1},d(l){l&&w(e),t.block.d(),t.token=null,t=null}}}function Ti(n){let e,r;return e=new Xn({props:{$$slots:{main:[Ai],left:[gi]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,l){I(e,t,l),r=!0},p(t,[l]){const o={};l&2063&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Mi(n,e,r){let t,l,o,i,a;x(n,lt,m=>r(4,t=m)),x(n,rt,m=>r(5,l=m)),x(n,R,m=>r(6,o=m)),x(n,He,m=>r(2,i=m)),x(n,Z,m=>r(3,a=m));let s,f;function c(m){le[m?"unshift":"push"](()=>{f=m,r(1,f),r(4,t)})}function d(m){i=m,He.set(i)}function u(m){le[m?"unshift":"push"](()=>{s=m,r(0,s),r(5,l)})}return n.$$.update=()=>{n.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(o)),n.$$.dirty&33&&s&&l&&(r(0,s.innerHTML="",s),s.appendChild(l)),n.$$.dirty&18&&f&&t&&(r(1,f.innerHTML="",f),f.appendChild(t))},[s,f,i,a,t,l,o,c,d,u]}class Ni extends oe{constructor(e){super(),ie(this,e,Mi,Ti,re,{})}}new Ni({target:document.getElementById("app")});
