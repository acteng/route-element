import{X as _o,Y as ho,Z as Mt,v as ue,e as A,w as fe,t as h,$ as bo,S as se,i as ae,s as ie,h as Oe,z as k,B as F,a0 as je,r as v,u as Fe,j as qe,k as Pe,x as y,a1 as Zr,a2 as te,a3 as Pt,b as pe,a4 as tn,Q as g,R,l as Me,a5 as $o,L as ko,a as ke,c as B,m as E,d as we,f as D,g as Xr,q as Ge,a6 as nn,a7 as wo,a8 as vo,a9 as K,aa as yo,ab as Ao,C as ee,ac as Co,A as L,ad as He,H as O,I as le,ae as jo,p as x,af as So,ag as rn,y as ge,T as ze,O as ve,N as Wt,G as Ae,E as Te,F as tt,V as Y,M as xe,ah as ut,ai as ot,aj as wt,ak as zo,P as ft,al as Lo,am as on,an as Mo,ao as Bo,ap as Bt,aq as Eo,ar as Do,_ as To,as as No,n as Nt,at as Zt,au as Io,av as Gt,D as vt,aw as Oo,J as Fo,U as qo}from"./Layout-47b04193.js";function Po(n,e){const r=e.token={};function t(o,l,i,a){if(e.token!==r)return;e.resolved=a;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=a);const u=o&&(e.current=o)(s);let c=!1;e.block&&(e.blocks?e.blocks.forEach((f,d)=>{d!==l&&f&&(ue(),A(f,1,1,()=>{e.blocks[d]===f&&(e.blocks[d]=null)}),fe())}):e.block.d(1),u.c(),h(u,1),u.m(e.mount(),e.anchor),c=!0),e.block=u,e.blocks&&(e.blocks[l]=u),c&&bo()}if(_o(n)){const o=ho();if(n.then(l=>{Mt(o),t(e.then,1,e.value,l),Mt(null)},l=>{if(Mt(o),t(e.catch,2,e.error,l),Mt(null),!e.hasCatch)throw l}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function Uo(n,e,r){const t=e.slice(),{resolved:o}=n;n.current===n.then&&(t[n.value]=o),n.current===n.catch&&(t[n.error]=o),n.block.p(t,r)}function Ro(n){let e,r;const t=n[7].default,o=Oe(t,n,n[6],null);return{c(){e=k("div"),o&&o.c(),F(e,"class",n[1]),je(e,"maplibregl-ctrl",n[0])},m(l,i){v(l,e,i),o&&o.m(e,null),n[8](e),r=!0},p(l,[i]){o&&o.p&&(!r||i&64)&&Fe(o,t,l,l[6],r?Pe(t,l[6],i,null):qe(l[6]),null),(!r||i&2)&&F(e,"class",l[1]),(!r||i&3)&&je(e,"maplibregl-ctrl",l[0])},i(l){r||(h(o,l),r=!0)},o(l){A(o,l),r=!1},d(l){l&&y(e),o&&o.d(l),n[8](null)}}}function Jo(n,e,r){let t,{$$slots:o={},$$scope:l}=e,{defaultStyling:i=!0}=e,{position:a="top-right"}=e,{class:s=void 0}=e;const{map:u}=Zr();te(n,u,p=>r(5,t=p));let c,f={onAdd(){return c},onRemove(){var p;(p=c==null?void 0:c.parentNode)==null||p.removeChild(c)}};Pt(()=>{t==null||t.removeControl(f)});function d(p){pe[p?"unshift":"push"](()=>{c=p,r(2,c)})}return n.$$set=p=>{"defaultStyling"in p&&r(0,i=p.defaultStyling),"position"in p&&r(4,a=p.position),"class"in p&&r(1,s=p.class),"$$scope"in p&&r(6,l=p.$$scope)},n.$$.update=()=>{n.$$.dirty&52&&t&&c&&t.addControl(f,a)},[i,s,c,u,a,t,l,o,d]}class Go extends se{constructor(e){super(),ae(this,e,Jo,Ro,ie,{defaultStyling:0,position:4,class:1})}}function Qo(n){let e,r,t,o,l,i;const a=n[4].default,s=Oe(a,n,n[3],null);return{c(){e=k("button"),r=k("div"),s&&s.c(),F(r,"class",t=tn(n[2])+" svelte-1s83zbq"),je(r,"maplibregl-ctrl-icon",n[0]),je(r,"ctrl-btn-center",n[1]),F(e,"type","button")},m(u,c){v(u,e,c),g(e,r),s&&s.m(r,null),o=!0,l||(i=R(e,"click",n[5]),l=!0)},p(u,[c]){s&&s.p&&(!o||c&8)&&Fe(s,a,u,u[3],o?Pe(a,u[3],c,null):qe(u[3]),null),(!o||c&4&&t!==(t=tn(u[2])+" svelte-1s83zbq"))&&F(r,"class",t),(!o||c&5)&&je(r,"maplibregl-ctrl-icon",u[0]),(!o||c&6)&&je(r,"ctrl-btn-center",u[1])},i(u){o||(h(s,u),o=!0)},o(u){A(s,u),o=!1},d(u){u&&y(e),s&&s.d(u),l=!1,i()}}}function Ho(n,e,r){let{$$slots:t={},$$scope:o}=e,{icon:l=!0}=e,{center:i=!0}=e,{class:a=void 0}=e;function s(u){Me.call(this,n,u)}return n.$$set=u=>{"icon"in u&&r(0,l=u.icon),"center"in u&&r(1,i=u.center),"class"in u&&r(2,a=u.class),"$$scope"in u&&r(3,o=u.$$scope)},[l,i,a,o,t,s]}class Vr extends se{constructor(e){super(),ae(this,e,Ho,Qo,ie,{icon:0,center:1,class:2})}}function Ko(n,e,r){let t;const o=$o();let{layer:l=void 0}=e;const{map:i}=Zr();te(n,i,c=>r(2,t=c));function a(c){o(c.type,{...c,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Pt(()=>{if(t)if(l)for(const c of s)t.off(c,l,a);else for(const c of u)t.off(c,a)}),n.$$set=c=>{"layer"in c&&r(1,l=c.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(l)for(const c of s)t.on(c,l,a);else for(const c of u)t.on(c,a)},[i,l,t]}class Ut extends se{constructor(e){super(),ae(this,e,Ko,null,ie,{layer:1})}}function Wo(n){let e;const r=n[16].default,t=Oe(r,n,n[24],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16777216)&&Fe(t,r,o,o[24],e?Pe(r,o[24],l,null):qe(o[24]),null)},i(o){e||(h(t,o),e=!0)},o(o){A(t,o),e=!1},d(o){t&&t.d(o)}}}function Zo(n){let e,r,t;function o(i){n[17](i)}let l={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Wo]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.hovered=n[0]),e=new ko({props:l}),pe.push(()=>ke(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.hovered=i[0],we(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function Xo(n,e,r){let{$$slots:t={},$$scope:o}=e,{id:l=Xr("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:f=void 0}=e,{filter:d=void 0}=e,{applyToClusters:p=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:j=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:_=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:C=!1}=e,{interactive:b=!0}=e;function S(T){$=T,r(0,$)}function w(T){Me.call(this,n,T)}function z(T){Me.call(this,n,T)}function N(T){Me.call(this,n,T)}function q(T){Me.call(this,n,T)}function Z(T){Me.call(this,n,T)}function V(T){Me.call(this,n,T)}return n.$$set=T=>{"id"in T&&r(1,l=T.id),"source"in T&&r(2,i=T.source),"sourceLayer"in T&&r(3,a=T.sourceLayer),"beforeId"in T&&r(4,s=T.beforeId),"beforeLayerType"in T&&r(5,u=T.beforeLayerType),"paint"in T&&r(6,c=T.paint),"layout"in T&&r(7,f=T.layout),"filter"in T&&r(8,d=T.filter),"applyToClusters"in T&&r(9,p=T.applyToClusters),"minzoom"in T&&r(10,m=T.minzoom),"maxzoom"in T&&r(11,j=T.maxzoom),"hoverCursor"in T&&r(12,M=T.hoverCursor),"manageHoverState"in T&&r(13,_=T.manageHoverState),"hovered"in T&&r(0,$=T.hovered),"eventsIfTopMost"in T&&r(14,C=T.eventsIfTopMost),"interactive"in T&&r(15,b=T.interactive),"$$scope"in T&&r(24,o=T.$$scope)},[$,l,i,a,s,u,c,f,d,p,m,j,M,_,C,b,t,S,w,z,N,q,Z,V,o]}class lt extends se{constructor(e){super(),ae(this,e,Xo,Zo,ie,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function ln(n){let e=n[0],r,t,o=sn(n);return{c(){o.c(),r=Ge()},m(l,i){o.m(l,i),v(l,r,i),t=!0},p(l,i){i&1&&ie(e,e=l[0])?(ue(),A(o,1,1,ee),fe(),o=sn(l),o.c(),h(o,1),o.m(r.parentNode,r)):o.p(l,i)},i(l){t||(h(o),t=!0)},o(l){A(o),t=!1},d(l){l&&y(r),o.d(l)}}}function sn(n){let e;const r=n[15].default,t=Oe(r,n,n[14],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16384)&&Fe(t,r,o,o[14],e?Pe(r,o[14],l,null):qe(o[14]),null)},i(o){e||(h(t,o),e=!0)},o(o){A(t,o),e=!1},d(o){t&&t.d(o)}}}function Vo(n){let e,r,t=n[0]&&ln(n);return{c(){t&&t.c(),e=Ge()},m(o,l){t&&t.m(o,l),v(o,e,l),r=!0},p(o,[l]){o[0]?t?(t.p(o,l),l&1&&h(t,1)):(t=ln(o),t.c(),h(t,1),t.m(e.parentNode,e)):t&&(ue(),A(t,1,1,()=>{t=null}),fe())},i(o){r||(h(t),r=!0)},o(o){A(t),r=!1},d(o){o&&y(e),t&&t.d(o)}}}function Yo(n,e,r){let t,o,{$$slots:l={},$$scope:i}=e,{id:a=Xr("vector")}=e,{url:s=null}=e,{tiles:u=null}=e,{promoteId:c=null}=e,{bounds:f=null}=e,{scheme:d=null}=e,{attribution:p=null}=e,{minzoom:m=null}=e,{maxzoom:j=null}=e,{volatile:M=null}=e;if(s&&s.includes("pmtiles://")&&!nn.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let b=new Co;nn.addProtocol("pmtiles",b.tile)}const{map:_,self:$}=wo();te(n,_,b=>r(13,o=b)),te(n,$,b=>r(0,t=b));let C;return Pt(()=>{t&&o&&(vo(_,t,C),K($,t=null,t),C=void 0)}),n.$$set=b=>{"id"in b&&r(3,a=b.id),"url"in b&&r(4,s=b.url),"tiles"in b&&r(5,u=b.tiles),"promoteId"in b&&r(6,c=b.promoteId),"bounds"in b&&r(7,f=b.bounds),"scheme"in b&&r(8,d=b.scheme),"attribution"in b&&r(9,p=b.attribution),"minzoom"in b&&r(10,m=b.minzoom),"maxzoom"in b&&r(11,j=b.maxzoom),"volatile"in b&&r(12,M=b.volatile),"$$scope"in b&&r(14,i=b.$$scope)},n.$$.update=()=>{n.$$.dirty&16377&&o&&t!==a&&(K($,t=a,t),yo(o,t,Ao({type:"vector",url:s,tiles:u,promoteId:c,bounds:f,scheme:d,attribution:p,minzoom:m,maxzoom:j,volatile:M}),b=>o&&b===t,()=>{t&&(C=o==null?void 0:o.getSource(t))})),n.$$.dirty&8200&&(o==null||o.on("style.load",()=>{C=o==null?void 0:o.getSource(a)}))},[t,_,$,a,s,u,c,f,d,p,m,j,M,o,i,l]}class Yr extends se{constructor(e){super(),ae(this,e,Yo,Vo,ie,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const xo=n=>({}),an=n=>({}),el=n=>({}),cn=n=>({});function tl(n){let e,r,t,o;const l=n[3].sidebar,i=Oe(l,n,n[2],cn),a=n[3].map,s=Oe(a,n,n[2],an);return{c(){e=k("div"),i&&i.c(),r=L(),t=k("div"),s&&s.c()},m(u,c){v(u,e,c),i&&i.m(e,null),n[4](e),v(u,r,c),v(u,t,c),s&&s.m(t,null),n[5](t),o=!0},p(u,[c]){i&&i.p&&(!o||c&4)&&Fe(i,l,u,u[2],o?Pe(l,u[2],c,el):qe(u[2]),cn),s&&s.p&&(!o||c&4)&&Fe(s,a,u,u[2],o?Pe(a,u[2],c,xo):qe(u[2]),an)},i(u){o||(h(i,u),h(s,u),o=!0)},o(u){A(i,u),A(s,u),o=!1},d(u){u&&(y(e),y(r),y(t)),i&&i.d(u),n[4](null),s&&s.d(u),n[5](null)}}}function nl(n,e,r){let t,o;te(n,Xt,u=>r(0,t=u)),te(n,Vt,u=>r(1,o=u));let{$$slots:l={},$$scope:i}=e;function a(u){pe[u?"unshift":"push"](()=>{t=u,Xt.set(t)})}function s(u){pe[u?"unshift":"push"](()=>{o=u,Vt.set(o)})}return n.$$set=u=>{"$$scope"in u&&r(2,i=u.$$scope)},[t,o,i,l,a,s]}class Ue extends se{constructor(e){super(),ae(this,e,nl,tl,ie,{})}}let Xt=He(null),Vt=He(null);const xr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAACmlBMVEXo6uzn6e3o6u7n6ezn6uzm6Ozn6evo6ezm6evo6e3p6u7p6+3p6u3o6u3n6u3n6evn6evn6ezo6uzo6u3n6evn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezo6uzo6uzo6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezo6+3n6ezn6ezn6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6ezn6e3n6e3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6e3o6u3o6uzo6uzo6u3o6u3o6u3n6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6uzn6ezn6e3o6u3o6u3o6u3o6u3o6u3n6u3n6ezo6u3o6u3o6uzn6uzn6ezo6ezo6uzn6ezo6u3o6u3o6u3n6u3n6Ozm6ezn6ezo6u3o6u3o6uzo6u3n6u3o6e3o6u3o6u3o6u3n6u3n6ezo6uzo6u3o6u3n6+3o6uzo6u3o6u3o6uzo6uzn6uzn6uzn6ezn6ezn6ezn6ezo6u3n6ezo6ezn6ezn6ezn6ezn6ezn6e3o6u3o6e3n6ezn6ezo6uzn6evo6uzo6uzn6evn6ezo6u3n6ezn6uzo6u3n6ezn6ezo6u3n6u3n6ezo6u3o6u3n6ezn6u3o6u3o6u3n6ezo6u3n6u3n6ezn6ezo6u3n6ezo6u3n6e3n6uzn6ezn6ezn6ezn6ezn6ezn6ezo6u3o6u3n6ezn6ezo6u3o6e3o6u3n6e3o6u3n6u3n6uzo6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6evo6u3o6u3o6u3n6uvn6ezo6u3n6uzn6ezn6ezn6ezo6u3n6uzn6uzo6u3n6u3n6uzo6+zm6uzjK5F0AAAA3nRSTlMAAAAAAAAAAAAAAAAAAAAIDxIUFBMDKEVdbn2IjpOWlpCJb15HKgUACXqjwtrt/P/u3MSmSg0gc7vz4dnSz83U5fT3vnciCnPV8MCdg2JYUk5LU1pmdoyoy/rYdApBt31IIyMjIyyI0LY/AABh366lq19s6GnraXg8PHsAAwOEeF0MKiEiCymqnFmeqXsncN6sOTuuDYzPTlCJCHhyOjyxcGfmkhotgqFcrYIrHONkymEKEC8mLg9jzMhNmr1XVVi/mCSz79ddrI6v3FooDSsAQ6OCFReFoi48GTwtAAD3GpCFAAADBklEQVR4nKWUh1IUQRCGZ+nx8JRZMcspoiKekfbMomDABAaSCbNwxhPMgmLOCTFnxZxzzlkxY86+i927BxzeUmWVf+1O1c5+09Pd09NCaJoWAFJCOQAb0GuzQSAPAOXppVlhD6hQMUgIJpUECUxpviCAxoOuKlRUShikMmYMk5WCK1epWi24UgloDwhSBOqKSTtNVa9Rs1aIo3ad0LphofXqOxqEN4xoxLDBKaGcTiU0pRo3bNK0WfMWkehVZEtXq9aONm1Ne0oXQHuT0XbtO3Sk3y2jOnWOjomJ7tK8azf67B7boydTJMFeBIpevftgXHzffiH9ByQkJiUlJqcMHDR4yNBUHDZ8hG5IlCMBjByF0aPHjE1Loyfd7U5Lc7vd6eOSx0/AiZN0jSUmTyaTnikZmDnVQtPQNZ0ou10JMy8zWmAZmjmLIyeLdkMExloKZ8/x+lgEpmZlz/XXvMjZc3IM+YA2ofxkDVqQ/wn+69bzF/jLClxoqUi/9JSVcD+LGGUpfzB10WILzfPfmqKGJUuXcXkaguURK0BYgysdq1avCTRQCSlr163PVdbghjzEjZvoflJJbd6C6ArRLcGt2yjI7TvMq7qzM33s2u0DFtVj6h7YG4WYuY8sKoD9+YgZB2A9gdKQFzx4CA8fOXos8/gJ8+g0CD9+8tTpM2F49hyAAZotYedQPH/h4qXLV6D4mHOvXltx/QbevMX/PR4vmHsb8U7W3XuldD/rAeLDR5wrqixza0h+jPjk6V+KQ8xPgKLUeslneVYn7Uqhm2UD7lFgNizFYMHzUnqB+PIVJ4uyYGdQY98ZXPX6jY/eFpggo+yjt64NsIZPceuni0GW6WehzfbufXzsh48l2ZGeT59j47+MNHowg4WFheahff327Ts5UwQScCT7x0/JfYdbrDA8oBauSUkhUUP1ngx4aJEOimbNJsVBM6dLyUFpmtcesHFdCiWVMkGbzNFB1xWBupPnDFzzcDJotXJKJ22kCeJyqFupXyaoVCAw+JuzrGi5cOqSurf2B4tMU69Bi01ZAAAAAElFTkSuQmCC",eo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMA/1uRIrUAAAjuSURBVHic7dxLlqM2FAZgCOdEGUUZZtCntZPWlrKCiKwgW2IpZAdkxoBAbJCEHle27r3UoxNr0KdMoc9Y/HoArm6aV3mVV/m/lHYbeIDaFh6wbVvPqd/dgJEDyBswcwB9A1YOYG7AxgHu9Tmt2O3ASAfEDkx0QO4A4zSwAbUDjDDrHWAEYY8BJwhs4KhPT1JrgeHDgM4C4/cLCAuQe9PHA9IC5O74Al7AC/hswHc8IrGBj58XPn5ydUBPBdgLjE+wRtJ7fcYyT+0AY6HJXuqyV+vs64WWF8SGf8nDv+hSvLN4wYUn+9KXffHNv/xvmAfwKq/yKq/yKv+p0rImxua+TBt4B8Ccm++LLNZN4X15wAI0c4nVMBd5xzKRscw8Vrqc06CYS+1jlcg4jy33ckNwr5gUF9DMq0Z30UcG2FfOkgso7t0DwwTclTcZEFzANQG5O2ousDGBjgtILqC5gGECPkZUQHABFQK/EAATAr8SgC0EvuDrdxHwFQ/ICFB4QMdAjwa2GBiw9dsEGLGASAD0oKQSAB1GkwDoNcLGBLoUwC4yRApgFxk50OMAmQEDDlAZMOIAnQHIJOUAMkkmA5BByAFkEHIAGYQtB3ouMHCBkQvgggAAqCC4EfGfAEAFwQF/BwAqCA74KwBQQXDAHyHQ44G1DYEBD8wRMCIAO6aOEYAJggX6CMAE4QDWJgIwQehsvQjABME9mokATBCOaaFPgB4JrE0CDEhgSYERCcwpgAgCDCCCAAOIIEgQQAQBBhBBkLbNEqDnAgMXGLlAfRDUGwH1SXLRT4D6JBWA+iQVgPok6QLQc4GBC4woYAgAu/StDkIGCPcDFbBTVXUQTAq46ZoMuEUTHTC4IBi78wloXBByAJmkHJC4JG0ZILhAh4uiO2Un0HKBBpdlADBcQGOAFgAUF0B9KWevt8aA4AIdF2gxQAcADRswXEBjgSUBFBdwiw4yIBCAgIBdHRlAiwXO9Nimu/80cADDBe5B6DnAPQh19c/HlBEg6yfXFFjccdVO7z500aze1o/qKWA/ev3ElAH9vllXz+4ZMOybu+olkoKB+uIBt7IZKcAYANj72jIFsPe1T8CESWIA2NvSJ6CjJOGA4f6TipJUXUQGDFSA+OC480ctuIB7TIBMUmsb/iffGbBJsqf+i48iNkm2yhdyksxx0N/ISdJHs2lykuRx4kzvgzDgAHHUuP1DTFJ7fOgbQP0DBnNMKyM1Se44JnKS9tIFF4yk7+OIezVikiywkpO0F3mvRkySA8hJ2ovagiCMBEBvzCDsXYoTBLO/LyMIW3jngAiwktQe1ehJsmMzPUl2dqAnyU5w9CSJoxo9SXaxR0+SWzGTk6Q2ZhD0FgWBCARBQANmi4PQ04AzCAMWcNWo39BrXTVqkvy9K2qSOn/gxCR1vumISRIe0LQgSH/2iUk6AWKSlH9bYpK0bzlikk7ABQGZJHOefA5w3sRCRzGopClRDG/jqg8Bzr7kk4TrDGdf8knCASIAXJJQwNkV0jshBAD7gGQvKqxjCN1Rhe2mCYAOAUUAgr7kG2QgA4IARB0wjCUOsENAiweSZyp4IDloE3HvAiTtrqlAb1+q8JxUFRkD+D97jvqSOyDMmBb1JdemGEBzARPXaGPvPYCoL9GBKXldXz97PokFsgEgzhUBMEggG8OIwFlBJ+CzIrlA0pcuAFTSqM9K0peoQND7VBKsZ8WkgEQCSV+6AEA9NYae9dOAMQWqx7R8NkYOivl6gAb0KVA9pmV9CTsoZl2BDyAHxawv0YCozbNWeViyvoQdFLOucBkw1NWHvjejCcBIBqCVrco3lQu0tr4IqBzT8r6EHBQlkFsUAPQl3KAI9KV3BoC+hBsUDfBuKADoS6hRFfwOGmZQBK/RMAB8lQhko1Tg69T3BKC+hBoUob6EAqC+hBpVoa6AGhTZANSXUIMi1JdQANSXMEDh+5zlQbENT7BeQkAFvcIB7q813d95JIBZwr6UA3MjZxiwh2Pm8EZgCIgE6IqAYAG3Dxn0pRBwg6JYQMDl7rZzJdAWAVurIQH3/9b7qLWmgBsUuxUElhPQdUBTBMzmNxzWET+br6dAH/alEGgeA/7k9sBN9RjwkXkMTBlwHNlt98dA1BkBoC8AvotFExsM9Me+ugCEN9UjQL8tMB4b5er/qq4MDMe+qgCIEqBwQIMEhgRYc0AmgIQA9RTYv6FTASxFoIOB/jkgEkBAgF794FkGphpgygE7ihaABgTMFhxOCnQQYFwSxwJwG1TDZwY5sJWB9hGwpsCQA83xowfah0BfAO4T1yNgcwMKBBgLLACwpEADAHpvGxXsDAH9OVyngNrb5iHQPgTk/tF08HlPYA4Ac4IxIOx3Os4Wh4BjbpwhoLXfKnkAdJudnUHg9nLatwHAGe9jfTCBwP4fOZyx1QVA+iRnT6x/O/YuA+L+U+eTDD3y7rYtmBg8MAZA8B6PAQUCc9jOR/1o4S5gYPC/Xe6/mMqAPAGZA3LfWfjLCgDQ0d4AANyBiwADA+dBAfcAI2CLPnAKqC2+sMuBcCItAMNDQBSA5gTGh4AKgC4H9BnKArBHa3oIzI+AY8TNgTUA0iaPNqkQaGFgKwPdn9sTwARnGQLs6zkDlhAYa4GmAMxFIP12Vg4cv38KLBkwRxV8ElyFtQCYApBVqAZKFUqvT2CiAboEpI3mB5m3A8ZjQ1cJnL3/8wDDsUHUAv3xUpaAuQSYNwP8hkrAv+HnAZoYmEqAjoEuBVQC+P9uKwXGq4GVCLQpoGuB6WpgSX4/loD0M6aAqQXmq4GZCpirAbf/8AxYEmCqBWQC6IuBthpYE2CkAupiwO/f29+LFEg3OGB4BpRE+WmA/tn+pQ3irYCmBKQf0gHuE9UDrtU+C5BOCxXAeLxuYWAtAu0bAQsZaGJA1wPTtcBMB36PAGN/66/yfDAGt8VtmK8FJjrwLQK2emC5FhjpwFcQmMtA2kwR0CKANQIGOvDzpUCHALYI6BNgKgM6AX68FBAYoA+Bhg78cCkgM0C5LeNDIHu/sQz4LUPzKq/yKq9yefkXR6tlrDrSxQ4AAAAASUVORK5CYII=";function Le(){return["","2","1","0","Critical"]}let Ke=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],et={SA01:{description:"Pedestrian and cyclist conflict with motor traffic at side roads/priority junctions",green:"Side roads/priority junctions have entry treatments that offer greater protection for  pedestrian and cycle movements (e.g. exit only, continuous footways, zebra/parallel crossings as appropriate to context).",amber:"<2,500vpd cut across main walking, wheeling or cycling streams and side roads and priority junctions have entry treatments. ",red:"<2,500vpd cut across main walking, wheeling or cycling streams, but side roads and priority junctions are untreated.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA02:{description:"Pedestrian and cyclist conflict with motor traffic at roundabouts and signal-controlled junctions",green:"All pedestrian and cyclist movements are separated from all motor traffic movements at roundabouts and/or signal controlled junctions.",amber:"The principal pedestrian and cyclist movements are separated from motor traffic movements at roundabouts and/or signal controlled junctions.",red:"The principal pedestrian and/or cyclist movements are in conflict with motor traffic movements at roundabouts and/or signal controlled junctions.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA03:{description:"Effect of lane widths on conflict between cyclists and motor traffic",green:"Cyclists are protected from motor traffic or off-road entirely.",amber:`Cyclists are in cycle lanes with light protection or stepped cycle tracks under 1.8m wide (single direction).

Or, cyclists are in a protected bidirectional cycle facility under 2.5m wide.

Or, cyclists are mixed with traffic on quiet urban streets with no centre line.`,red:`Cyclists are mixed with traffic in lanes less than 3.25m wide or over 3.9m wide.

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is under 3.25m or over 3.9m. 

Or cyclists are mixed with traffic on busy urban streets with no centre line.

Or, there are speed cushions present.`,critical:`Cyclists are mixed with traffic in lanes between 3.25m and 3.9m wide. 

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is between 3.25m and 3.9m.`},SA04:{description:"Risk of pedestrians tripping due to hazards",green:"No trip hazards, level clear surface.",amber:"Few trip hazards.",red:"Many trip hazards.",critical:"There are level differences of greater than 13mm with no tactile information and colour contrast to help identify them."},SA05:{description:"Cyclist conflict with kerbside activity, including risk of 'dooring' ",green:"Kerbside activity is well-managed with no or minimal conflict with cyclists. ",amber:"Less frequent kerbside activity, and conflict with cyclists is well-managed.",red:"Frequent kerbside activity for cyclists to contend with. Conflict with cyclists is not well-managed.",critical:`Cycle facility next to parking/loading facility, without a buffer of at least 0.5m.

Or, an unprotected cycle lane is next to a frequently-used bus layby.`},SA06:{description:"Ability of pedestrians to cross the street safely on desire lines",green:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 50-100m. 

On quieter streets (<8,000vpd), there are controlled crossings or only one lane of traffic to cross.`,amber:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 100-200m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross on desire lines.`,red:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 200-400m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross.`,critical:`On very busy streets (>8,000vpd) controlled crossings (including zebra crossings) are not present or more than 400m apart.

On quieter streets (<8,000vpd), desire lines are blocked by parking and loading. `},SA07:{description:"Suitability of pedestrian crossings in context",green:`On very busy streets (>8,000vpd), signal crossings rest on green for pedestrians or have rapid response.

On quieter streets (<8,000vpd), crossing points are controlled crossings.`,amber:`On very busy streets (>8,000vpd), signal crossings are provided for pedestrians.

On quieter streets (<8,000vpd), crossing points have effective implied priority for pedestrians.`,red:`On very busy streets (>8,000vpd), there are uncontrolled crossings or zebra/parallel crossings.

On quieter streets (<8,000vpd), crossing points have no implied priority or there are no crossing points.`,critical:`On very busy streets (>8,000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic.

At signal junctions there are arms with dropped kerbs and tactile paving but no green pedestrian symbol.`},SA08:{description:"85th percentile speed of motor traffic (where cyclists are not protected or pedestrians are crossing uncontrolled)",green:`85th percentile speed is under 20mph.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:"85th percentile speed is between 20mph and 25mph.",red:"85th percentile speed is over 25mph.",critical:"85th percentile speed is over 30mph."},SA09:{description:"Volume of motor traffic at the busiest hour (where cyclists are not protected or pedestrians cross uncontrolled)",green:`<200 vehicles in the busiest hour.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:`200-499 vehicles in the busiest hour.

And, less than 2% of traffic is HGVs.`,red:`500-1,000 vehicles in the busiest hour.

Or, 2-5% of traffic is HGVs where there are 200-499 vehicles in the busiest hour.`,critical:`>1,000 vehicles in the busiest hour.

Or, over 5% of traffic is HGVs where there are over 500 vehicles in the busiest hour.`},SA10:{description:"Required crossing speed at signal crossings (risk of pedestrians coming into conflict with traffic).",green:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1m/s.",amber:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1.2m/s.",red:"There are no detectors to extend crossing times, but pedestrians who start crossing at the end of the 'invitation to cross' can cross at a speed of 1.2m/s and get across the whole crossing in time.",critical:"Pedestrians who start crossing at the end of the 'invitation to cross' must cross at a speed of over 1.2m/s to get across the whole crossing in time."},SA11:{description:"Clear walking and wheeling spaces free of permanent obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",green:">3m clear footway width and pedestrian comfort is good (PCL of A-C).",amber:`Where the footway is next to the carriageway, there is:
• 2m-3m clear footway width and pedestrian comfort is good (PCL of A-C).
• >3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is 1.5m-3m.`,red:`Where the footway is next to the carriageway, there is:
• <2m clear footway width but pedestrian comfort is good (PCL of A-C)
• 2m-3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is <1.5m.`,critical:`Where the footway is next to the carriageway, there is:
• <1m clear footway width on any footway
• <1.5m clear footway width for over 6m
• 1m-2m clear footway width with a Pedestrian Comfort Level of D-E

Or there is no footway.`},SA12:{description:"Effective width next to tram line on a straight run or a curve",green:"Physical protection is provided for cyclists.",amber:">2.4m from tramline edge to kerb.",red:"2.4m from tramline edge to kerb.",critical:`<2.4m from tramline edge to kerb on a straight run.

Insufficient clearance on a curve.`},SA13:{description:"Crossing angle (between cyclist desire line and tram or train rails).",green:"Crossing angle between 80 and 90 degrees with track filler creating a smooth crossing for cyclists.",amber:"Crossing angle between 80 and 90 degrees (or between 60 and 80 degrees with track filler creating a smooth crossing for cyclists).",red:"Crossing angle between 60 and 80 degrees.",critical:"Crossing angle less than 60 degrees."},SA14:{description:`Cycling surface and maintenance defects:
• sharp gradients (≥12.5%)
• non cycle friendly ironworks
• raised/sunken covers or gullies
• potholes
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA15:{description:`Walking/wheeling surface and maintenance defects:
• steep camber (horizontal gradient >2.5% )
• steep longitudinal gradients (≥8% if under 1m, ≥5% if 1m or over) 
• missing dropped kerbs
• non flush tables
• misleading tactile information
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation
`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA16:{description:"Presence of guard railing",green:"No guard railing anywhere on the route.",amber:"Minimal guard railing, used to address a clear safety issue such as a level difference.",red:"Guard railing used to control behaviour in complex environments.",critical:"Guard railing used as standard without consideration of inherent safety risks."},ST20:{description:"Interactions at bus stops.",green:"At bus stops, cyclists are protected from buses and traffic and interactions between pedestrians and cyclists are likely to be low-level.",amber:"At bus stops, cyclists are protected from buses and traffic, but there are likely to be medium-level interactions between pedestrians and cyclists.",red:"At bus stops, cyclists regularly have to wait behind buses or overtake them in general traffic lanes. Or, there are likely to be high-level interactions between pedestrians and cyclists.",critical:""}};function un(n){let e,r,t,o=n[0].critical+"",l;return{c(){e=k("p"),r=k("b"),r.textContent="Critical",t=O(`
    : `),l=O(o)},m(i,a){v(i,e,a),g(e,r),g(e,t),g(e,l)},p(i,a){a&1&&o!==(o=i[0].critical+"")&&le(l,o)},d(i){i&&y(e)}}}function rl(n){let e,r,t,o=n[0].green+"",l,i,a,s,u,c=n[0].amber+"",f,d,p,m,j,M=n[0].red+"",_,$,C,b=n[0].critical&&un(n);return{c(){e=k("p"),r=k("b"),r.textContent="2",t=O(`
  : `),l=O(o),i=L(),a=k("p"),s=k("b"),s.textContent="1",u=O(`
  : `),f=O(c),d=L(),p=k("p"),m=k("b"),m.textContent="0",j=O(`
  : `),_=O(M),$=L(),b&&b.c(),C=Ge()},m(S,w){v(S,e,w),g(e,r),g(e,t),g(e,l),v(S,i,w),v(S,a,w),g(a,s),g(a,u),g(a,f),v(S,d,w),v(S,p,w),g(p,m),g(p,j),g(p,_),v(S,$,w),b&&b.m(S,w),v(S,C,w)},p(S,[w]){w&1&&o!==(o=S[0].green+"")&&le(l,o),w&1&&c!==(c=S[0].amber+"")&&le(f,c),w&1&&M!==(M=S[0].red+"")&&le(_,M),S[0].critical?b?b.p(S,w):(b=un(S),b.c(),b.m(C.parentNode,C)):b&&(b.d(1),b=null)},i:ee,o:ee,d(S){S&&(y(e),y(i),y(a),y(d),y(p),y($),y(C)),b&&b.d(S)}}}function ol(n,e,r){let{metric:t}=e;return n.$$set=o=>{"metric"in o&&r(0,t=o.metric)},[t]}class dt extends se{constructor(e){super(),ae(this,e,ol,rl,ie,{metric:0})}}function fn(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function dn(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function ll(n){let e,r,t,o,l,i;const a=n[5].default,s=Oe(a,n,n[4],null);let u=x(n[2]),c=[];for(let f=0;f<u.length;f+=1)c[f]=pn(fn(n,u,f));return{c(){e=k("label"),s&&s.c(),r=L(),t=k("select");for(let f=0;f<c.length;f+=1)c[f].c();n[0]===void 0&&So(()=>n[10].call(t))},m(f,d){v(f,e,d),s&&s.m(e,null),g(e,r),g(e,t);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(t,null);rn(t,n[0],!0),o=!0,l||(i=[R(t,"change",n[10]),R(t,"change",n[7])],l=!0)},p(f,d){if(s&&s.p&&(!o||d&16)&&Fe(s,a,f,f[4],o?Pe(a,f[4],d,null):qe(f[4]),null),d&4){u=x(f[2]);let p;for(p=0;p<u.length;p+=1){const m=fn(f,u,p);c[p]?c[p].p(m,d):(c[p]=pn(m),c[p].c(),c[p].m(t,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=u.length}d&5&&rn(t,f[0])},i(f){o||(h(s,f),o=!0)},o(f){A(s,f),o=!1},d(f){f&&y(e),s&&s.d(f),ge(c,f),l=!1,ze(i)}}}function il(n){let e,r,t,o;const l=n[5].default,i=Oe(l,n,n[4],null);let a=x(n[2]),s=[];for(let u=0;u<a.length;u+=1)s[u]=mn(dn(n,a,u));return{c(){e=k("fieldset"),i&&i.c(),r=L(),t=k("div");for(let u=0;u<s.length;u+=1)s[u].c();F(t,"class","svelte-1vb210n"),je(t,"horiz_radio",n[1]=="horiz-radio")},m(u,c){v(u,e,c),i&&i.m(e,null),g(e,r),g(e,t);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(t,null);o=!0},p(u,c){if(i&&i.p&&(!o||c&16)&&Fe(i,l,u,u[4],o?Pe(l,u[4],c,null):qe(u[4]),null),c&5){a=x(u[2]);let f;for(f=0;f<a.length;f+=1){const d=dn(u,a,f);s[f]?s[f].p(d,c):(s[f]=mn(d),s[f].c(),s[f].m(t,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=a.length}(!o||c&2)&&je(t,"horiz_radio",u[1]=="horiz-radio")},i(u){o||(h(i,u),o=!0)},o(u){A(i,u),o=!1},d(u){u&&y(e),i&&i.d(u),ge(s,u)}}}function pn(n){let e,r=n[12]+"",t;return{c(){e=k("option"),t=O(r),e.__value=n[11],ve(e,e.__value)},m(o,l){v(o,e,l),g(e,t)},p:ee,d(o){o&&y(e)}}}function mn(n){let e,r,t,o=n[12]+"",l,i,a,s,u;return a=Wt(n[9][0]),{c(){e=k("label"),r=k("input"),t=L(),l=O(o),i=L(),F(r,"type","radio"),r.__value=n[11],ve(r,r.__value),a.p(r)},m(c,f){v(c,e,f),g(e,r),r.checked=r.__value===n[0],g(e,t),g(e,l),g(e,i),s||(u=[R(r,"change",n[8]),R(r,"change",n[6])],s=!0)},p(c,f){f&5&&(r.checked=r.__value===c[0])},d(c){c&&y(e),a.r(),s=!1,ze(u)}}}function sl(n){let e,r,t,o;const l=[il,ll],i=[];function a(s,u){return s[1]=="horiz-radio"||s[1]=="vert-radio"?0:s[1]=="dropdown"?1:-1}return~(e=a(n))&&(r=i[e]=l[e](n)),{c(){r&&r.c(),t=Ge()},m(s,u){~e&&i[e].m(s,u),v(s,t,u),o=!0},p(s,[u]){let c=e;e=a(s),e===c?~e&&i[e].p(s,u):(r&&(ue(),A(i[c],1,1,()=>{i[c]=null}),fe()),~e?(r=i[e],r?r.p(s,u):(r=i[e]=l[e](s),r.c()),h(r,1),r.m(t.parentNode,t)):r=null)},i(s){o||(h(r),o=!0)},o(s){A(r),o=!1},d(s){s&&y(t),~e&&i[e].d(s)}}}function al(n,e,r){let{$$slots:t={},$$scope:o}=e,{k:l}=e,{value:i}=e,{choices:a}=e,s=a[0].length==2?a:a.map(m=>[m,m]);const u=[[]];function c(m){Me.call(this,n,m)}function f(m){Me.call(this,n,m)}function d(){i=this.__value,r(0,i),r(2,s)}function p(){i=jo(this),r(0,i),r(2,s)}return n.$$set=m=>{"k"in m&&r(1,l=m.k),"value"in m&&r(0,i=m.value),"choices"in m&&r(3,a=m.choices),"$$scope"in m&&r(4,o=m.$$scope)},[i,l,s,a,o,t,c,f,d,u,p]}class Je extends se{constructor(e){super(),ae(this,e,al,sl,ie,{k:1,value:0,choices:3})}}let Ot=He(void 0),G=He(cl());function me(n){return{type:"FeatureCollection",features:n}}let W=He({kind:"neutral"});function to(n){return"links"in n&&"jats"in n&&"bus_stops"&&"crossings"in n&&"side_roads"in n}function cl(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if(to(n))return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[],side_roads:[]}}function gn(n){let e,r;return e=new Ae({props:{data:me(n[2].links),$$slots:{default:[ul]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].links)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function ul(n){let e,r;return e=new Te({props:{paint:{"line-color":n[1]=="links"?["get","color"]:"black","line-width":6}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"line-color":t[1]=="links"?["get","color"]:"black","line-width":6}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function _n(n){let e,r;return e=new Ae({props:{data:me(n[2].bus_stops),$$slots:{default:[fl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].bus_stops)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function fl(n){let e,r;return e=new lt({props:{layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":n[1]=="bus_stops"?["get","color"]:"black"}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"icon-color":t[1]=="bus_stops"?["get","color"]:"black"}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function hn(n){let e,r;return e=new Ae({props:{data:me(n[2].crossings),$$slots:{default:[dl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].crossings)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function dl(n){let e,r;return e=new lt({props:{layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":n[1]=="crossings"?["get","color"]:"black"}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"icon-color":t[1]=="crossings"?["get","color"]:"black"}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function bn(n){let e,r;return e=new Ae({props:{data:me(n[2].jats),$$slots:{default:[pl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].jats)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function pl(n){let e,r;return e=new tt({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":n[1]=="jats"?["get","color"]:"black","circle-radius":20}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":t[1]=="jats"?["get","color"]:"black","circle-radius":20}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function $n(n){let e,r;return e=new Ae({props:{data:me(n[2].side_roads),$$slots:{default:[ml]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].side_roads)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function ml(n){let e,r;return e=new Te({props:{paint:{"line-color":n[1]=="side_roads"?["get","color"]:"black","line-width":3}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"line-color":t[1]=="side_roads"?["get","color"]:"black","line-width":3}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function gl(n){let e,r,t,o,l,i,a=n[0]!="links"&&gn(n),s=n[0]!="bus_stops"&&_n(n),u=n[0]!="crossings"&&hn(n),c=n[0]!="jats"&&bn(n),f=n[0]!="side_roads"&&$n(n);return{c(){a&&a.c(),e=L(),s&&s.c(),r=L(),u&&u.c(),t=L(),c&&c.c(),o=L(),f&&f.c(),l=Ge()},m(d,p){a&&a.m(d,p),v(d,e,p),s&&s.m(d,p),v(d,r,p),u&&u.m(d,p),v(d,t,p),c&&c.m(d,p),v(d,o,p),f&&f.m(d,p),v(d,l,p),i=!0},p(d,[p]){d[0]!="links"?a?(a.p(d,p),p&1&&h(a,1)):(a=gn(d),a.c(),h(a,1),a.m(e.parentNode,e)):a&&(ue(),A(a,1,1,()=>{a=null}),fe()),d[0]!="bus_stops"?s?(s.p(d,p),p&1&&h(s,1)):(s=_n(d),s.c(),h(s,1),s.m(r.parentNode,r)):s&&(ue(),A(s,1,1,()=>{s=null}),fe()),d[0]!="crossings"?u?(u.p(d,p),p&1&&h(u,1)):(u=hn(d),u.c(),h(u,1),u.m(t.parentNode,t)):u&&(ue(),A(u,1,1,()=>{u=null}),fe()),d[0]!="jats"?c?(c.p(d,p),p&1&&h(c,1)):(c=bn(d),c.c(),h(c,1),c.m(o.parentNode,o)):c&&(ue(),A(c,1,1,()=>{c=null}),fe()),d[0]!="side_roads"?f?(f.p(d,p),p&1&&h(f,1)):(f=$n(d),f.c(),h(f,1),f.m(l.parentNode,l)):f&&(ue(),A(f,1,1,()=>{f=null}),fe())},i(d){i||(h(a),h(s),h(u),h(c),h(f),i=!0)},o(d){A(a),A(s),A(u),A(c),A(f),i=!1},d(d){d&&(y(e),y(r),y(t),y(o),y(l)),a&&a.d(d),s&&s.d(d),u&&u.d(d),c&&c.d(d),f&&f.d(d)}}}function _l(n,e,r){let t;te(n,G,i=>r(2,t=i));let{except:o}=e,{showColor:l=""}=e;return n.$$set=i=>{"except"in i&&r(0,o=i.except),"showColor"in i&&r(1,l=i.showColor)},[o,l,t]}class We extends se{constructor(e){super(),ae(this,e,_l,gl,ie,{except:0,showColor:1})}}function kn(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function wn(n){let e,r,t=n[6].properties.name+"",o,l,i,a,s,u;function c(d){n[5](d,n[6])}let f={k:"horiz-radio",choices:Le()};return n[6].properties.st20!==void 0&&(f.value=n[6].properties.st20),i=new Je({props:f}),pe.push(()=>ke(i,"value",c)),{c(){e=k("li"),r=k("span"),o=O(t),l=L(),B(i.$$.fragment),s=L(),Y(r,"color",n[6].properties.color)},m(d,p){v(d,e,p),g(e,r),g(r,o),g(e,l),E(i,e,null),g(e,s),u=!0},p(d,p){n=d,(!u||p&2)&&t!==(t=n[6].properties.name+"")&&le(o,t),p&2&&Y(r,"color",n[6].properties.color);const m={};!a&&p&2&&(a=!0,m.value=n[6].properties.st20,we(()=>a=!1)),i.$set(m)},i(d){u||(h(i.$$.fragment,d),u=!0)},o(d){A(i.$$.fragment,d),u=!1},d(d){d&&y(e),D(i)}}}function hl(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m=x(n[1].bus_stops),j=[];for(let _=0;_<m.length;_+=1)j[_]=wn(kn(n,m,_));const M=_=>A(j[_],1,1,()=>{j[_]=null});return c=new dt({props:{metric:n[2]}}),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("h2"),o.textContent="ST20: bus stops",l=L(),i=k("p"),i.textContent=`${n[2].description}`,a=L(),s=k("ol");for(let _=0;_<j.length;_+=1)j[_].c();u=L(),B(c.$$.fragment),F(e,"slot","sidebar")},m(_,$){v(_,e,$),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(e,a),g(e,s);for(let C=0;C<j.length;C+=1)j[C]&&j[C].m(s,null);g(e,u),E(c,e,null),f=!0,d||(p=R(r,"click",n[4]),d=!0)},p(_,$){if($&2){m=x(_[1].bus_stops);let C;for(C=0;C<m.length;C+=1){const b=kn(_,m,C);j[C]?(j[C].p(b,$),h(j[C],1)):(j[C]=wn(b),j[C].c(),h(j[C],1),j[C].m(s,null))}for(ue(),C=m.length;C<j.length;C+=1)M(C);fe()}},i(_){if(!f){for(let $=0;$<m.length;$+=1)h(j[$]);h(c.$$.fragment,_),f=!0}},o(_){j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)A(j[$]);A(c.$$.fragment,_),f=!1},d(_){_&&y(e),ge(j,_),D(c),d=!1,p()}}}function bl(n){let e,r,t;return r=new We({props:{showColor:"bus_stops",except:""}}),{c(){e=k("div"),B(r.$$.fragment),F(e,"slot","map")},m(o,l){v(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){A(r.$$.fragment,o),t=!1},d(o){o&&y(e),D(r)}}}function $l(n){let e,r,t,o;return e=new Ue({props:{$$slots:{map:[bl],sidebar:[hl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=R(window,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l),t=!1,o()}}}function kl(n,e,r){let t,o;te(n,W,u=>r(0,t=u)),te(n,G,u=>r(1,o=u));let l=et.ST20;function i(u){u.key=="Escape"&&K(W,t={kind:"neutral"},t)}const a=()=>K(W,t={kind:"neutral"},t);function s(u,c){n.$$.not_equal(c.properties.st20,u)&&(c.properties.st20=u,G.set(o))}return[t,o,l,i,a,s]}class wl extends se{constructor(e){super(),ae(this,e,kl,$l,ie,{})}}function vl(n){let e,r;const t=n[4].default,o=Oe(t,n,n[6],null);return{c(){e=k("span"),o&&o.c(),F(e,"class","dot svelte-117v9mi"),je(e,"outline",n[3]),Y(e,"background-color",n[3]?void 0:n[1]),Y(e,"border-color",n[3]?n[1]:void 0),Y(e,"width",n[2]),Y(e,"height",n[2])},m(l,i){v(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&64)&&Fe(o,t,l,l[6],r?Pe(t,l[6],i,null):qe(l[6]),null),(!r||i&8)&&je(e,"outline",l[3]),i&10&&Y(e,"background-color",l[3]?void 0:l[1]),i&10&&Y(e,"border-color",l[3]?l[1]:void 0),i&4&&Y(e,"width",l[2]),i&4&&Y(e,"height",l[2])},i(l){r||(h(o,l),r=!0)},o(l){A(o,l),r=!1},d(l){l&&y(e),o&&o.d(l)}}}function yl(n){let e,r,t;function o(i){n[5](i)}let l={draggable:!0,$$slots:{default:[vl]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.lngLat=n[0]),e=new xe({props:l}),pe.push(()=>ke(e,"lngLat",o)),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,[a]){const s={};a&78&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.lngLat=i[0],we(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function Al(n,e,r){let{$$slots:t={},$$scope:o}=e,{lngLat:l}=e,{color:i}=e,{radius:a="30px"}=e,{outline:s=!1}=e;function u(c){l=c,r(0,l)}return n.$$set=c=>{"lngLat"in c&&r(0,l=c.lngLat),"color"in c&&r(1,i=c.color),"radius"in c&&r(2,a=c.radius),"outline"in c&&r(3,s=c.outline),"$$scope"in c&&r(6,o=c.$$scope)},[l,i,a,s,t,u,o]}class xt extends se{constructor(e){super(),ae(this,e,Al,yl,ie,{lngLat:0,color:1,radius:2,outline:3})}}const{window:Cl}=ut;function jl(n){let e;return{c(){e=O("ST20: bus stops")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Sl(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m;function j(_){n[8](_)}let M={k:"horiz-radio",choices:Le(),$$slots:{default:[jl]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].properties.st20!==void 0&&(M.value=n[1].bus_stops[n[0]].properties.st20),c=new Je({props:M}),pe.push(()=>ke(c,"value",j)),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("button"),o.textContent="Delete bus stop",l=L(),i=k("label"),a=O(`Name:
      `),s=k("input"),u=L(),B(c.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(_,$){v(_,e,$),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(i,a),g(i,s),ve(s,n[1].bus_stops[n[0]].properties.name),g(e,u),E(c,e,null),d=!0,p||(m=[R(r,"click",n[6]),R(o,"click",n[4]),R(s,"input",n[7])],p=!0)},p(_,$){$&3&&s.value!==_[1].bus_stops[_[0]].properties.name&&ve(s,_[1].bus_stops[_[0]].properties.name);const C={};$&512&&(C.$$scope={dirty:$,ctx:_}),!f&&$&3&&(f=!0,C.value=_[1].bus_stops[_[0]].properties.st20,we(()=>f=!1)),c.$set(C)},i(_){d||(h(c.$$.fragment,_),d=!0)},o(_){A(c.$$.fragment,_),d=!1},d(_){_&&y(e),D(c),p=!1,ze(m)}}}function zl(n){let e,r;return e=new lt({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Ll(n){let e,r;return{c(){e=k("img"),wt(e.src,r=xr)||F(e,"src",r),F(e,"alt","")},m(t,o){v(t,e,o)},p:ee,d(t){t&&y(e)}}}function Ml(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"bus_stops"}}),o=new Ae({props:{data:me(n[1].bus_stops),generateId:!0,$$slots:{default:[zl]},$$scope:{ctx:n}}});function u(f){n[5](f)}let c={color:n[1].bus_stops[n[0]].properties.color,$$slots:{default:[Ll]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),i=new xt({props:c}),pe.push(()=>ke(i,"lngLat",u)),{c(){e=k("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){v(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].bus_stops)),d&513&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};d&3&&(m.color=f[1].bus_stops[f[0]].properties.color),d&512&&(m.$$scope={dirty:d,ctx:f}),!a&&d&3&&(a=!0,m.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,we(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){A(r.$$.fragment,f),A(o.$$.fragment,f),A(i.$$.fragment,f),s=!1},d(f){f&&y(e),D(r),D(o),D(i)}}}function Bl(n){let e,r,t,o;return e=new Ue({props:{$$slots:{map:[Ml],sidebar:[Sl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=R(Cl,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l),t=!1,o()}}}function El(n,e,r){let t,o;te(n,G,d=>r(1,t=d)),te(n,W,d=>r(2,o=d));let{idx:l}=e;function i(d){d.key=="Escape"&&K(W,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this bus stop?")&&(K(W,o={kind:"neutral"},o),await ot(),t.bus_stops.splice(l,1),G.set(t))}function s(d){n.$$.not_equal(t.bus_stops[l].geometry.coordinates,d)&&(t.bus_stops[l].geometry.coordinates=d,G.set(t))}const u=()=>K(W,o={kind:"neutral"},o);function c(){t.bus_stops[l].properties.name=this.value,G.set(t)}function f(d){n.$$.not_equal(t.bus_stops[l].properties.st20,d)&&(t.bus_stops[l].properties.st20=d,G.set(t))}return n.$$set=d=>{"idx"in d&&r(0,l=d.idx)},[l,t,o,i,a,s,u,c,f]}class Dl extends se{constructor(e){super(),ae(this,e,El,Bl,ie,{idx:0})}}function vn(n,e,r){const t=n.slice();return t[1]=e[r][0],t[2]=e[r][1],t}function yn(n){let e,r,t,o=n[1]+"",l,i;return{c(){e=k("li"),r=k("span"),t=L(),l=O(o),i=L(),F(r,"class","svelte-kzgqtg"),Y(r,"background",n[2])},m(a,s){v(a,e,s),g(e,r),g(e,t),g(e,l),g(e,i)},p(a,s){s&1&&Y(r,"background",a[2]),s&1&&o!==(o=a[1]+"")&&le(l,o)},d(a){a&&y(e)}}}function Tl(n){let e,r=x(n[0]),t=[];for(let o=0;o<r.length;o+=1)t[o]=yn(vn(n,r,o));return{c(){e=k("ul");for(let o=0;o<t.length;o+=1)t[o].c()},m(o,l){v(o,e,l);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(o,[l]){if(l&1){r=x(o[0]);let i;for(i=0;i<r.length;i+=1){const a=vn(o,r,i);t[i]?t[i].p(a,l):(t[i]=yn(a),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=r.length}},i:ee,o:ee,d(o){o&&y(e),ge(t,o)}}}function Nl(n,e,r){let{rows:t}=e;return n.$$set=o=>{"rows"in o&&r(0,t=o.rows)},[t]}class Il extends se{constructor(e){super(),ae(this,e,Nl,Tl,ie,{rows:0})}}const Ol=n=>({dialog:n&1}),An=n=>({dialog:n[0]});function Fl(n){let e,r,t,o,l;const i=n[4].default,a=Oe(i,n,n[3],An);return{c(){e=k("dialog"),r=k("article"),a&&a.c(),e.open=!0},m(s,u){v(s,e,u),g(e,r),a&&a.m(r,null),n[6](e),t=!0,o||(l=[R(window,"click",n[1]),R(window,"keydown",n[2]),R(e,"close",n[5])],o=!0)},p(s,[u]){a&&a.p&&(!t||u&9)&&Fe(a,i,s,s[3],t?Pe(i,s[3],u,Ol):qe(s[3]),An)},i(s){t||(h(a,s),t=!0)},o(s){A(a,s),t=!1},d(s){s&&y(e),a&&a.d(s),n[6](null),o=!1,ze(l)}}}function ql(n,e,r){let{$$slots:t={},$$scope:o}=e,l;function i(c){l.open&&c.target==l&&l.close()}function a(c){(c.key=="Escape"||c.key=="Enter")&&(c.stopPropagation(),l.close())}function s(c){Me.call(this,n,c)}function u(c){pe[c?"unshift":"push"](()=>{l=c,r(0,l)})}return n.$$set=c=>{"$$scope"in c&&r(3,o=c.$$scope)},[l,i,a,o,t,s,u]}class Rt extends se{constructor(e){super(),ae(this,e,ql,Fl,ie,{})}}function Cn(n,e,r){const t=n.slice();return t[3]=e[r],t}function jn(n,e,r){const t=n.slice();return t[6]=e[r],t}function Sn(n){let e,r;return{c(){e=k("span"),r=O(` 
    `),Y(e,"background",n[6]),Y(e,"width","100%"),Y(e,"border","1px solid black")},m(t,o){v(t,e,o),g(e,r)},p(t,o){o&1&&Y(e,"background",t[6])},d(t){t&&y(e)}}}function Pl(n){let e,r=n[3]+"",t;return{c(){e=k("span"),t=O(r)},m(o,l){v(o,e,l),g(e,t)},p(o,l){l&2&&r!==(r=o[3]+"")&&le(t,r)},d(o){o&&y(e)}}}function Ul(n){let e,r=n[3].toFixed(n[2])+"",t;return{c(){e=k("span"),t=O(r)},m(o,l){v(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[3].toFixed(o[2])+"")&&le(t,r)},d(o){o&&y(e)}}}function zn(n){let e;function r(l,i){return l[2]>0?Ul:Pl}let t=r(n),o=t(n);return{c(){o.c(),e=Ge()},m(l,i){o.m(l,i),v(l,e,i)},p(l,i){t===(t=r(l))&&o?o.p(l,i):(o.d(1),o=t(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&y(e),o.d(l)}}}function Rl(n){let e,r,t,o=x(n[0]),l=[];for(let s=0;s<o.length;s+=1)l[s]=Sn(jn(n,o,s));let i=x(n[1]),a=[];for(let s=0;s<i.length;s+=1)a[s]=zn(Cn(n,i,s));return{c(){e=k("div");for(let s=0;s<l.length;s+=1)l[s].c();r=L(),t=k("div");for(let s=0;s<a.length;s+=1)a[s].c();Y(e,"display","flex"),Y(t,"display","flex"),Y(t,"justify-content","space-between")},m(s,u){v(s,e,u);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(e,null);v(s,r,u),v(s,t,u);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(t,null)},p(s,[u]){if(u&1){o=x(s[0]);let c;for(c=0;c<o.length;c+=1){const f=jn(s,o,c);l[c]?l[c].p(f,u):(l[c]=Sn(f),l[c].c(),l[c].m(e,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=o.length}if(u&6){i=x(s[1]);let c;for(c=0;c<i.length;c+=1){const f=Cn(s,i,c);a[c]?a[c].p(f,u):(a[c]=zn(f),a[c].c(),a[c].m(t,null))}for(;c<a.length;c+=1)a[c].d(1);a.length=i.length}},i:ee,o:ee,d(s){s&&(y(e),y(r),y(t)),ge(l,s),ge(a,s)}}}function Jl(n,e,r){let{colorScale:t}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return n.$$set=i=>{"colorScale"in i&&r(0,t=i.colorScale),"limits"in i&&r(1,o=i.limits),"decimalPlaces"in i&&r(2,l=i.decimalPlaces)},[t,o,l]}class Gl extends se{constructor(e){super(),ae(this,e,Jl,Rl,ie,{colorScale:0,limits:1,decimalPlaces:2})}}function Ql(n,e){let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function Hl(n){let e;return{c(){e=O("Bus stops")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Ln(n){let e,r,t,o,l;return o=new Gl({props:{colorScale:n[1],limits:n[2]}}),{c(){e=k("div"),r=k("p"),r.textContent="Peak hourly frequency:",t=L(),B(o.$$.fragment),F(e,"class","svelte-yxmabo")},m(i,a){v(i,e,a),g(e,r),g(e,t),E(o,e,null),l=!0},p:ee,i(i){l||(h(o.$$.fragment,i),l=!0)},o(i){A(o.$$.fragment,i),l=!1},d(i){i&&y(e),D(o)}}}function Kl(n){let e,r,t,o=n[4].stop_name+"",l,i,a,s,u,c=n[4].peak+"",f,d,p,m,j,M=n[4].peak_description+"",_,$,C,b,S,w=n[4].total+"",z,N,q=n[4].total_description+"",Z,V;return{c(){e=k("p"),r=O("Stop name: "),t=k("b"),l=O(o),i=L(),a=k("p"),s=O("Peak: "),u=k("b"),f=O(c),d=O(`
        buses during the busiest hour of any day`),p=L(),m=k("p"),j=O("The peak hour is "),_=O(M),$=L(),C=k("p"),b=O("Total buses per day: "),S=k("b"),z=O(w),N=O(`
        (for `),Z=O(q),V=O(", the busiest day of the week)")},m(T,Q){v(T,e,Q),g(e,r),g(e,t),g(t,l),v(T,i,Q),v(T,a,Q),g(a,s),g(a,u),g(u,f),g(a,d),v(T,p,Q),v(T,m,Q),g(m,j),g(m,_),v(T,$,Q),v(T,C,Q),g(C,b),g(C,S),g(S,z),g(C,N),g(C,Z),g(C,V)},p(T,Q){Q&16&&o!==(o=T[4].stop_name+"")&&le(l,o),Q&16&&c!==(c=T[4].peak+"")&&le(f,c),Q&16&&M!==(M=T[4].peak_description+"")&&le(_,M),Q&16&&w!==(w=T[4].total+"")&&le(z,w),Q&16&&q!==(q=T[4].total_description+"")&&le(Z,q)},d(T){T&&(y(e),y(i),y(a),y(p),y(m),y($),y(C))}}}function Wl(n){let e,r;return e=new ft({props:{$$slots:{default:[Kl,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&48&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Zl(n){let e,r;return e=new tt({props:{sourceLayer:"bus_stops",paint:{"circle-color":zo(["get","peak"],n[2],n[1]),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},manageHoverState:!0,$$slots:{default:[Wl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),o&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Xl(n){let e,r,t,o,l;e=new Vr({props:{$$slots:{default:[Hl]},$$scope:{ctx:n}}}),e.$on("click",n[3]);let i=n[0]&&Ln(n);return o=new Yr({props:{url:"pmtiles://https://atip.uk/layers/v1/bus_stops.pmtiles",$$slots:{default:[Zl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=L(),i&&i.c(),t=L(),B(o.$$.fragment)},m(a,s){E(e,a,s),v(a,r,s),i&&i.m(a,s),v(a,t,s),E(o,a,s),l=!0},p(a,[s]){const u={};s&32&&(u.$$scope={dirty:s,ctx:a}),e.$set(u),a[0]?i?(i.p(a,s),s&1&&h(i,1)):(i=Ln(a),i.c(),h(i,1),i.m(t.parentNode,t)):i&&(ue(),A(i,1,1,()=>{i=null}),fe());const c={};s&33&&(c.$$scope={dirty:s,ctx:a}),o.$set(c)},i(a){l||(h(e.$$.fragment,a),h(i),h(o.$$.fragment,a),l=!0)},o(a){A(e.$$.fragment,a),A(i),A(o.$$.fragment,a),l=!1},d(a){a&&(y(r),y(t)),D(e,a),i&&i.d(a),D(o,a)}}}function Vl(n,e,r){let t=!1;return[t,["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],[0,3,10,20,30,100],()=>r(0,t=!t)]}class Yl extends se{constructor(e){super(),ae(this,e,Vl,Xl,ie,{})}}function xl(n){let e;return{c(){e=O("Crossings")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Mn(n){let e,r,t;return r=new Il({props:{rows:n[1]}}),{c(){e=k("div"),B(r.$$.fragment),F(e,"class","svelte-yxmabo")},m(o,l){v(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){A(r.$$.fragment,o),t=!1},d(o){o&&y(e),D(r)}}}function ei(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=k("p"),t=O(r),o=O(" crossing")},m(l,i){v(l,e,i),g(e,t),g(e,o)},p(l,i){i&8&&r!==(r=(l[3].class||"Unknown")+"")&&le(t,r)},d(l){l&&y(e)}}}function ti(n){let e,r;return e=new ft({props:{$$slots:{default:[ei,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function ni(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=k("p"),t=O(r),o=O(" crossing")},m(l,i){v(l,e,i),g(e,t),g(e,o)},p(l,i){i&8&&r!==(r=(l[3].class||"Unknown")+"")&&le(t,r)},d(l){l&&y(e)}}}function ri(n){let e,r;return e=new ft({props:{$$slots:{default:[ni,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function oi(n){let e,r,t,o;return e=new Te({props:{sourceLayer:"crossings",filter:Lo,paint:{"line-color":on(["get","class"],Object.fromEntries(n[1]),"red"),"line-width":3},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[ti]},$$scope:{ctx:n}}}),e.$on("click",Bn),t=new tt({props:{sourceLayer:"crossings",filter:Mo,paint:{"circle-color":on(["get","class"],Object.fromEntries(n[1]),"red"),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[ri]},$$scope:{ctx:n}}}),t.$on("click",Bn),{c(){B(e.$$.fragment),r=L(),B(t.$$.fragment)},m(l,i){E(e,l,i),v(l,r,i),E(t,l,i),o=!0},p(l,i){const a={};i&1&&(a.layout={visibility:l[0]?"visible":"none"}),i&16&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&1&&(s.layout={visibility:l[0]?"visible":"none"}),i&16&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(h(e.$$.fragment,l),h(t.$$.fragment,l),o=!0)},o(l){A(e.$$.fragment,l),A(t.$$.fragment,l),o=!1},d(l){l&&y(r),D(e,l),D(t,l)}}}function li(n){let e,r,t,o,l;e=new Vr({props:{$$slots:{default:[xl]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let i=n[0]&&Mn(n);return o=new Yr({props:{url:"pmtiles://https://atip.uk/layers/v1/crossings.pmtiles",$$slots:{default:[oi]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=L(),i&&i.c(),t=L(),B(o.$$.fragment)},m(a,s){E(e,a,s),v(a,r,s),i&&i.m(a,s),v(a,t,s),E(o,a,s),l=!0},p(a,[s]){const u={};s&16&&(u.$$scope={dirty:s,ctx:a}),e.$set(u),a[0]?i?(i.p(a,s),s&1&&h(i,1)):(i=Mn(a),i.c(),h(i,1),i.m(t.parentNode,t)):i&&(ue(),A(i,1,1,()=>{i=null}),fe());const c={};s&17&&(c.$$scope={dirty:s,ctx:a}),o.$set(c)},i(a){l||(h(e.$$.fragment,a),h(i),h(o.$$.fragment,a),l=!0)},o(a){A(e.$$.fragment,a),A(i),A(o.$$.fragment,a),l=!1},d(a){a&&(y(r),y(t)),D(e,a),i&&i.d(a),D(o,a)}}}function Bn(n){window.open(`https://www.openstreetmap.org/${n.detail.features[0].properties.osm}`,"_blank")}function ii(n,e,r){let t=!1;return[t,[["Zebra","#66C5CC"],["Parallel","#F6CF71"],["Pelican","#F89C74"],["Puffin","#DCB0F2"],["Toucan","#87C55F"],["Pegasus","#9EB9F3"],["Uncontrolled","#FE88B1"],["Signalised","#C9DB74"],["Unknown","red"]],()=>r(0,t=!t)]}class si extends se{constructor(e){super(),ae(this,e,ii,li,ie,{})}}function ai(n){let e,r,t,o,l;return r=new Yl({}),o=new si({}),{c(){e=k("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),Y(e,"display","flex"),Y(e,"flex-direction","column")},m(i,a){v(i,e,a),E(r,e,null),g(e,t),E(o,e,null),l=!0},p:ee,i(i){l||(h(r.$$.fragment,i),h(o.$$.fragment,i),l=!0)},o(i){A(r.$$.fragment,i),A(o.$$.fragment,i),l=!1},d(i){i&&y(e),D(r),D(o)}}}function ci(n){let e,r;return e=new Go({props:{$$slots:{default:[ai]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,[o]){const l={};o&1&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}class ui extends se{constructor(e){super(),ae(this,e,null,ci,ie,{})}}const{window:fi}=ut;function di(n){let e;return{c(){e=O("SA10: pedestrian crossing speed")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function pi(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,j,M,_,$;function C(S){n[9](S)}let b={k:"horiz-radio",choices:Le(),$$slots:{default:[di]},$$scope:{ctx:n}};return n[1].crossings[n[0]].properties.sa10!==void 0&&(b.value=n[1].crossings[n[0]].properties.sa10),c=new Je({props:b}),pe.push(()=>ke(c,"value",C)),j=new dt({props:{metric:n[3]}}),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("button"),o.textContent="Delete crossing",l=L(),i=k("label"),a=O(`Name:
      `),s=k("input"),u=L(),B(c.$$.fragment),d=L(),p=k("p"),p.textContent=`${n[3].description}`,m=L(),B(j.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(S,w){v(S,e,w),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(i,a),g(i,s),ve(s,n[1].crossings[n[0]].properties.name),g(e,u),E(c,e,null),g(e,d),g(e,p),g(e,m),E(j,e,null),M=!0,_||($=[R(r,"click",n[7]),R(o,"click",n[5]),R(s,"input",n[8])],_=!0)},p(S,w){w&3&&s.value!==S[1].crossings[S[0]].properties.name&&ve(s,S[1].crossings[S[0]].properties.name);const z={};w&1024&&(z.$$scope={dirty:w,ctx:S}),!f&&w&3&&(f=!0,z.value=S[1].crossings[S[0]].properties.sa10,we(()=>f=!1)),c.$set(z)},i(S){M||(h(c.$$.fragment,S),h(j.$$.fragment,S),M=!0)},o(S){A(c.$$.fragment,S),A(j.$$.fragment,S),M=!1},d(S){S&&y(e),D(c),D(j),_=!1,ze($)}}}function mi(n){let e,r;return e=new lt({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":"black"}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function gi(n){let e,r;return{c(){e=k("img"),wt(e.src,r=eo)||F(e,"src",r),F(e,"alt","")},m(t,o){v(t,e,o)},p:ee,d(t){t&&y(e)}}}function _i(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"crossings"}}),o=new Ae({props:{data:me(n[1].crossings),generateId:!0,$$slots:{default:[mi]},$$scope:{ctx:n}}});function u(f){n[6](f)}let c={color:n[1].crossings[n[0]].properties.color,$$slots:{default:[gi]},$$scope:{ctx:n}};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].crossings[n[0]].geometry.coordinates),i=new xt({props:c}),pe.push(()=>ke(i,"lngLat",u)),{c(){e=k("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){v(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].crossings)),d&1025&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};d&3&&(m.color=f[1].crossings[f[0]].properties.color),d&1024&&(m.$$scope={dirty:d,ctx:f}),!a&&d&3&&(a=!0,m.lngLat=f[1].crossings[f[0]].geometry.coordinates,we(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){A(r.$$.fragment,f),A(o.$$.fragment,f),A(i.$$.fragment,f),s=!1},d(f){f&&y(e),D(r),D(o),D(i)}}}function hi(n){let e,r,t,o;return e=new Ue({props:{$$slots:{map:[_i],sidebar:[pi]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=R(fi,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l),t=!1,o()}}}function bi(n,e,r){let t,o;te(n,G,p=>r(1,t=p)),te(n,W,p=>r(2,o=p));let{idx:l}=e,i=et.SA10;function a(p){p.key=="Escape"&&K(W,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this crossing?")&&(K(W,o={kind:"neutral"},o),await ot(),t.crossings.splice(l,1),G.set(t))}function u(p){n.$$.not_equal(t.crossings[l].geometry.coordinates,p)&&(t.crossings[l].geometry.coordinates=p,G.set(t))}const c=()=>K(W,o={kind:"neutral"},o);function f(){t.crossings[l].properties.name=this.value,G.set(t)}function d(p){n.$$.not_equal(t.crossings[l].properties.sa10,p)&&(t.crossings[l].properties.sa10=p,G.set(t))}return n.$$set=p=>{"idx"in p&&r(0,l=p.idx)},[l,t,o,i,a,s,u,c,f,d]}class $i extends se{constructor(e){super(),ae(this,e,bi,hi,ie,{idx:0})}}let H;const no=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&no.decode();let _t=null;function $t(){return(_t===null||_t.byteLength===0)&&(_t=new Uint8Array(H.memory.buffer)),_t}function Ie(n,e){return n=n>>>0,no.decode($t().subarray(n,n+e))}const Ze=new Array(128).fill(void 0);Ze.push(void 0,null,!0,!1);let kt=Ze.length;function ye(n){kt===Ze.length&&Ze.push(Ze.length+1);const e=kt;return kt=Ze[e],Ze[e]=n,e}function ce(n){return Ze[n]}function ki(n){n<132||(Ze[n]=kt,kt=n)}function st(n){const e=ce(n);return ki(n),e}function Qt(n){return n==null}let ht=null;function wi(){return(ht===null||ht.byteLength===0)&&(ht=new Float64Array(H.memory.buffer)),ht}let bt=null;function de(){return(bt===null||bt.byteLength===0)&&(bt=new Int32Array(H.memory.buffer)),bt}let Ve=0;const It=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},vi=typeof It.encodeInto=="function"?function(n,e){return It.encodeInto(n,e)}:function(n,e){const r=It.encode(n);return e.set(r),{read:n.length,written:r.length}};function Et(n,e,r){if(r===void 0){const a=It.encode(n),s=e(a.length,1)>>>0;return $t().subarray(s,s+a.length).set(a),Ve=a.length,s}let t=n.length,o=e(t,1)>>>0;const l=$t();let i=0;for(;i<t;i++){const a=n.charCodeAt(i);if(a>127)break;l[o+i]=a}if(i!==t){i!==0&&(n=n.slice(i)),o=r(o,t,t=i+n.length*3,1)>>>0;const a=$t().subarray(o+i,o+t),s=vi(n,a);i+=s.written}return Ve=i,o}function Yt(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let l="[";o>0&&(l+=Yt(n[0]));for(let i=1;i<o;i++)l+=", "+Yt(n[i]);return l+="]",l}const r=/\[object ([^\]]+)\]/.exec(toString.call(n));let t;if(r.length>1)t=r[1];else return toString.call(n);if(t=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:t}function yi(n,e){const r=e(n.length*1,1)>>>0;return $t().set(n,r/1),Ve=n.length,r}function Ht(n,e){try{return n.apply(this,e)}catch(r){H.__wbindgen_exn_store(ye(r))}}class Ft{static __wrap(e){e=e>>>0;const r=Object.create(Ft.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();H.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=H.__wbindgen_add_to_stack_pointer(-16),i=yi(e,H.__wbindgen_malloc),a=Ve;H.jsroutesnapper_new(l,i,a);var r=de()[l/4+0],t=de()[l/4+1],o=de()[l/4+2];if(o)throw st(t);return Ft.__wrap(r)}finally{H.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){H.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ye(e))}setAreaMode(){H.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,r;try{const l=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_getConfig(l,this.__wbg_ptr);var t=de()[l/4+0],o=de()[l/4+1];return e=t,r=o,Ie(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}toFinalFeature(){try{const t=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=de()[t/4+0],r=de()[t/4+1];let o;return e!==0&&(o=Ie(e,r).slice(),H.__wbindgen_free(e,r*1)),o}finally{H.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,r;try{const l=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var t=de()[l/4+0],o=de()[l/4+1];return e=t,r=o,Ie(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}toggleSnapMode(){H.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,r,t){return H.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,r,t)!==0}onClick(){H.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return H.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return H.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){H.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_editExisting(o,this.__wbg_ptr,ye(e));var r=de()[o/4+0],t=de()[o/4+1];if(t)throw st(r)}finally{H.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,r;try{const l=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var t=de()[l/4+0],o=de()[l/4+1];return e=t,r=o,Ie(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}debugSnappableNodes(){let e,r;try{const l=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var t=de()[l/4+0],o=de()[l/4+1];return e=t,r=o,Ie(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}routeNameForWaypoints(e){let r,t;try{const c=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_routeNameForWaypoints(c,this.__wbg_ptr,ye(e));var o=de()[c/4+0],l=de()[c/4+1],i=de()[c/4+2],a=de()[c/4+3],s=o,u=l;if(a)throw s=0,u=0,st(i);return r=s,t=u,Ie(s,u)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(r,t,1)}}addSnappedWaypoint(e,r){H.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,r)}undo(){H.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let r,t;try{const c=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_calculateRoute(c,this.__wbg_ptr,ye(e));var o=de()[c/4+0],l=de()[c/4+1],i=de()[c/4+2],a=de()[c/4+3],s=o,u=l;if(a)throw s=0,u=0,st(i);return r=s,t=u,Ie(s,u)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(r,t,1)}}getExtraNodes(e,r){let t,o;try{const f=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_getExtraNodes(f,this.__wbg_ptr,ye(e),ye(r));var l=de()[f/4+0],i=de()[f/4+1],a=de()[f/4+2],s=de()[f/4+3],u=l,c=i;if(s)throw u=0,c=0,st(a);return t=u,o=c,Ie(u,c)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(t,o,1)}}}async function Ai(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(t){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function Ci(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,r){const t=Ie(e,r);return ye(t)},n.wbg.__wbindgen_object_drop_ref=function(e){st(e)},n.wbg.__wbindgen_error_new=function(e,r){const t=new Error(Ie(e,r));return ye(t)},n.wbg.__wbindgen_number_get=function(e,r){const t=ce(r),o=typeof t=="number"?t:void 0;wi()[e/8+1]=Qt(o)?0:o,de()[e/4+0]=!Qt(o)},n.wbg.__wbindgen_is_object=function(e){const r=ce(e);return typeof r=="object"&&r!==null},n.wbg.__wbindgen_is_undefined=function(e){return ce(e)===void 0},n.wbg.__wbindgen_in=function(e,r){return ce(e)in ce(r)},n.wbg.__wbindgen_boolean_get=function(e){const r=ce(e);return typeof r=="boolean"?r?1:0:2},n.wbg.__wbindgen_jsval_loose_eq=function(e,r){return ce(e)==ce(r)},n.wbg.__wbindgen_string_get=function(e,r){const t=ce(r),o=typeof t=="string"?t:void 0;var l=Qt(o)?0:Et(o,H.__wbindgen_malloc,H.__wbindgen_realloc),i=Ve;de()[e/4+1]=i,de()[e/4+0]=l},n.wbg.__wbg_String_4370c5505c674d30=function(e,r){const t=String(ce(r)),o=Et(t,H.__wbindgen_malloc,H.__wbindgen_realloc),l=Ve;de()[e/4+1]=l,de()[e/4+0]=o},n.wbg.__wbindgen_object_clone_ref=function(e){const r=ce(e);return ye(r)},n.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,r){const t=ce(e)[ce(r)];return ye(t)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ye(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,r){const t=ce(r).stack,o=Et(t,H.__wbindgen_malloc,H.__wbindgen_realloc),l=Ve;de()[e/4+1]=l,de()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,r){let t,o;try{t=e,o=r,console.error(Ie(e,r))}finally{H.__wbindgen_free(t,o,1)}},n.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(ce(e))},n.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(ce(e))},n.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(ce(e))},n.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(ce(e))},n.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(ce(e))},n.wbg.__wbg_get_44be0491f933a435=function(e,r){const t=ce(e)[r>>>0];return ye(t)},n.wbg.__wbg_length_fff51ee6522a1a18=function(e){return ce(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof ce(e)=="function"},n.wbg.__wbg_next_526fc47e980da008=function(e){const r=ce(e).next;return ye(r)},n.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Ht(function(e){const r=ce(e).next();return ye(r)},arguments)},n.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return ce(e).done},n.wbg.__wbg_value_1695675138684bd5=function(e){const r=ce(e).value;return ye(r)},n.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ye(Symbol.iterator)},n.wbg.__wbg_get_97b561fb56f034b5=function(){return Ht(function(e,r){const t=Reflect.get(ce(e),ce(r));return ye(t)},arguments)},n.wbg.__wbg_call_cb65541d95d71282=function(){return Ht(function(e,r){const t=ce(e).call(ce(r));return ye(t)},arguments)},n.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(ce(e))},n.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let r;try{r=ce(e)instanceof ArrayBuffer}catch{r=!1}return r},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const r=ce(e).buffer;return ye(r)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const r=new Uint8Array(ce(e));return ye(r)},n.wbg.__wbg_set_5cf90238115182c3=function(e,r,t){ce(e).set(ce(r),t>>>0)},n.wbg.__wbg_length_72e2208bbc0efc61=function(e){return ce(e).length},n.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let r;try{r=ce(e)instanceof Uint8Array}catch{r=!1}return r},n.wbg.__wbindgen_debug_string=function(e,r){const t=Yt(ce(r)),o=Et(t,H.__wbindgen_malloc,H.__wbindgen_realloc),l=Ve;de()[e/4+1]=l,de()[e/4+0]=o},n.wbg.__wbindgen_throw=function(e,r){throw new Error(Ie(e,r))},n.wbg.__wbindgen_memory=function(){const e=H.memory;return ye(e)},n}function ji(n,e){return H=n.exports,ro.__wbindgen_wasm_module=e,ht=null,bt=null,_t=null,H}async function ro(n){if(H!==void 0)return H;typeof n>"u"&&(n="/route-element/assets/route_snapper_bg.wasm");const e=Ci();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:t}=await Ai(await n,e);return ji(r,t)}const Si=30;class zi{constructor(e,r,t,o,l){this.onMouseMove=i=>{if(!this.active)return;const a=[i.point.x-Si,i.point.y],s=this.map.unproject(i.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,s)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Ft(r),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersSuccess)r(JSON.parse(e));else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersUpdated)r(JSON.parse(e))}}function Li(n){let e=n[3].road_classification+"",r;return{c(){r=O(e)},m(t,o){v(t,r,o)},p(t,o){o&8&&e!==(e=t[3].road_classification+"")&&le(r,e)},d(t){t&&y(r)}}}function Mi(n){let e,r;return e=new ft({props:{openOn:"hover",$$slots:{default:[Li,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Bi(n){let e,r;return e=new Te({props:{layout:{visibility:n[0]?"visible":"none"},paint:{"line-width":3,"line-color":"black"},$$slots:{default:[Mi]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),o&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Ei(n){let e,r;return e=new tt({props:{manageHoverState:!0,layout:{visibility:n[0]?"visible":"none"},paint:{"circle-color":["case",["get","traffic_signals"],"green","black"],"circle-radius":5}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Di(n){let e,r,t,o;return e=new Ae({props:{data:n[1].os_links,$$slots:{default:[Bi]},$$scope:{ctx:n}}}),t=new Ae({props:{data:n[1].os_nodes,$$slots:{default:[Ei]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=L(),B(t.$$.fragment)},m(l,i){E(e,l,i),v(l,r,i),E(t,l,i),o=!0},p(l,[i]){const a={};i&17&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&17&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(h(e.$$.fragment,l),h(t.$$.fragment,l),o=!0)},o(l){A(e.$$.fragment,l),A(t.$$.fragment,l),o=!1},d(l){l&&y(r),D(e,l),D(t,l)}}}function Ti(n,e,r){let{showDebug:t}=e;function o(){let i=JSON.parse(Bo());return{os_nodes:JSON.parse(i.os_nodes),os_links:JSON.parse(i.os_links)}}let l=o();return n.$$set=i=>{"showDebug"in i&&r(0,t=i.showDebug)},[t,l]}class Ni extends se{constructor(e){super(),ae(this,e,Ti,Di,ie,{showDebug:0})}}function oo(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Ke[n%Ke.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function lo(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Ke[n%Ke.length],answers:Array(Be.length).fill("")}}}let Be=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:Le()},{name:"SA04",description:"trip hazards",choices:Le()},{name:"SA05",description:"kerbside activity",choices:Le()},{name:"SA08",description:"motor traffic speed",choices:Le()},{name:"SA09",description:"motor traffic volume",choices:Le()},{name:"SA11",description:"footway widths",choices:Le()},{name:"SA12",description:"effective width next to tram lines",choices:Le()},{name:"SA13",description:"crossing angle of tram/train rails",choices:Le()},{name:"SA14",description:"cycling surface and maintenance defects",choices:Le()},{name:"SA15",description:"WW surface and maintenance defects",choices:Le()},{name:"SA16",description:"guard railing",choices:Le()}];function io(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled side road",color:Ke[n%Ke.length],sa01:""}}}let en=He(null);const Re=He([]);async function Ii(n){await To(),await ro();let e="https://assets.od2net.org/route-element",r=n.getBounds();try{let t=await No(e,r.getEast(),r.getNorth(),r.getWest(),r.getSouth());en.set(new zi(n,t,He(Nt()),He(!0),He(0))),W.set({kind:"draw-route"})}catch(t){window.alert(t)}}function Oi(){try{let n=JSON.parse(Bt(en).inner.calculateRoute(Bt(Re)));if(!n){window.alert("No route drawn");return}Fi(n.properties.full_path);let e=lo(Bt(G).links.length);e.geometry=n.geometry,e.properties.name=n.properties.route_name,G.update(r=>(r.links.push(e),r)),W.set({kind:"edit-link",idx:Bt(G).links.length-1})}catch(n){window.alert(`Bug: ${n}`)}Re.set([]),W.set({kind:"neutral"})}function Fi(n){G.update(e=>{for(let r of JSON.parse(Eo(n)).features)r.properties=io(e.side_roads.length).properties,e.side_roads.push(r);for(let r of JSON.parse(Do(n)).features)e.jats.push(oo(e.jats.length,r.geometry.coordinates));return e})}function En(n,e,r){const t=n.slice();return t[48]=e[r],t[49]=e,t[50]=r,t}function Dn(n,e,r){const t=n.slice();return t[51]=e[r],t[52]=e,t[53]=r,t}function qi(n){let e;return{c(){e=k("h2"),e.textContent="Drawing a new route"},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Pi(n){let e;return{c(){e=k("h2"),e.textContent="Editing a route"},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Ui(n){let e,r=n[11].length+"",t,o;return{c(){e=O("Undo ("),t=O(r),o=O(")")},m(l,i){v(l,e,i),v(l,t,i),v(l,o,i)},p(l,i){i[0]&2048&&r!==(r=l[11].length+"")&&le(t,r)},d(l){l&&(y(e),y(t),y(o))}}}function Ri(n){let e;return{c(){e=O("Undo")},m(r,t){v(r,e,t)},p:ee,d(r){r&&y(e)}}}function Ji(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,j,M,_,$,C,b,S,w,z,N,q,Z,V,T,Q,I,_e,he,P,X,$e,be,U,ne,oe,Ne,Xe,At,pt,mt,gt,Ct;function jt(Ce,Se){return Ce[2]?Pi:qi}let it=jt(n),Qe=it(n);function St(Ce,Se){return Ce[11].length==0?Ri:Ui}let J=St(n),re=J(n);return pt=Wt(n[38][0]),mt=Wt(n[38][1]),{c(){e=k("div"),Qe.c(),r=L(),t=k("button"),o=O("Finish"),i=L(),a=k("button"),re.c(),u=L(),c=k("button"),c.textContent="Cancel",f=L(),d=k("fieldset"),p=k("label"),m=k("input"),j=O(`
        Snap to roads`),M=L(),_=k("label"),$=k("input"),C=O(`
        Draw anywhere`),b=L(),S=k("fieldset"),w=k("label"),z=k("input"),N=O(`
        Extend from start (
        `),q=k("b"),q.textContent="1",Z=O(`
        )`),V=L(),T=k("label"),Q=k("input"),I=O(`
        Extend from end (
        `),_e=k("b"),_e.textContent="2",he=O(`
        )`),P=L(),X=k("label"),$e=k("input"),be=O(`
        Adjust middle points (
        `),U=k("b"),U.textContent="3",ne=O(`
        )`),oe=L(),Ne=k("label"),Xe=k("input"),At=O(`
      Debug the network`),t.disabled=l=n[7].length<2,F(a,"class","secondary"),a.disabled=s=n[11].length==0,F(c,"class","secondary"),F(m,"type","radio"),m.__value="snap",ve(m,m.__value),F($,"type","radio"),$.__value="free",ve($,$.__value),F(z,"type","radio"),z.__value="append-start",ve(z,z.__value),F(Q,"type","radio"),Q.__value="append-end",ve(Q,Q.__value),F($e,"type","radio"),$e.__value="adjust",ve($e,$e.__value),F(Xe,"type","checkbox"),F(e,"slot","sidebar"),pt.p(z,Q,$e),mt.p(m,$)},m(Ce,Se){v(Ce,e,Se),Qe.m(e,null),g(e,r),g(e,t),g(t,o),g(e,i),g(e,a),re.m(a,null),g(e,u),g(e,c),g(e,f),g(e,d),g(d,p),g(p,m),m.checked=m.__value===n[10],g(p,j),g(d,M),g(d,_),g(_,$),$.checked=$.__value===n[10],g(_,C),g(e,b),g(e,S),g(S,w),g(w,z),z.checked=z.__value===n[3],g(w,N),g(w,q),g(w,Z),g(S,V),g(S,T),g(T,Q),Q.checked=Q.__value===n[3],g(T,I),g(T,_e),g(T,he),g(S,P),g(S,X),g(X,$e),$e.checked=$e.__value===n[3],g(X,be),g(X,U),g(X,ne),g(e,oe),g(e,Ne),g(Ne,Xe),Xe.checked=n[9],g(Ne,At),gt||(Ct=[R(t,"click",function(){Zt(n[0])&&n[0].apply(this,arguments)}),R(a,"click",n[14]),R(c,"click",function(){Zt(n[1])&&n[1].apply(this,arguments)}),R(m,"change",n[37]),R(m,"change",n[15]),R($,"change",n[39]),R($,"change",n[15]),R(z,"change",n[40]),R(Q,"change",n[41]),R($e,"change",n[42]),R(Xe,"change",n[43])],gt=!0)},p(Ce,Se){n=Ce,it!==(it=jt(n))&&(Qe.d(1),Qe=it(n),Qe&&(Qe.c(),Qe.m(e,r))),Se[0]&128&&l!==(l=n[7].length<2)&&(t.disabled=l),J===(J=St(n))&&re?re.p(n,Se):(re.d(1),re=J(n),re&&(re.c(),re.m(a,null))),Se[0]&2048&&s!==(s=n[11].length==0)&&(a.disabled=s),Se[0]&1024&&(m.checked=m.__value===n[10]),Se[0]&1024&&($.checked=$.__value===n[10]),Se[0]&8&&(z.checked=z.__value===n[3]),Se[0]&8&&(Q.checked=Q.__value===n[3]),Se[0]&8&&($e.checked=$e.__value===n[3]),Se[0]&512&&(Xe.checked=n[9])},d(Ce){Ce&&y(e),Qe.d(),re.d(),pt.r(),mt.r(),gt=!1,ze(Ct)}}}function Gi(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-1cj4rwq"),je(e,"snapped-node",n[51].snapped),je(e,"free-node",!n[51].snapped),je(e,"hide",n[6])},m(r,t){v(r,e,t)},p(r,t){t[0]&4096&&je(e,"snapped-node",r[51].snapped),t[0]&4096&&je(e,"free-node",!r[51].snapped),t[0]&64&&je(e,"hide",r[6])},d(r){r&&y(e)}}}function Tn(n){let e,r,t;function o(s){n[28](s,n[51])}function l(){return n[29](n[51])}function i(){return n[30](n[51])}let a={draggable:!0,zIndex:0,$$slots:{default:[Gi]},$$scope:{ctx:n}};return n[51].point!==void 0&&(a.lngLat=n[51].point),e=new xe({props:a}),pe.push(()=>ke(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",n[23]),{c(){B(e.$$.fragment)},m(s,u){E(e,s,u),t=!0},p(s,u){n=s;const c={};u[0]&4160|u[1]&8388608&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&4096&&(r=!0,c.lngLat=n[51].point,we(()=>r=!1)),e.$set(c)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){A(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function Qi(n){let e;return{c(){e=k("span"),e.textContent=`${n[50]+1}`,F(e,"class","dot svelte-1cj4rwq"),je(e,"snapped",n[48].snapped)},m(r,t){v(r,e,t)},p(r,t){t[0]&128&&je(e,"snapped",r[48].snapped)},d(r){r&&y(e)}}}function Nn(n){let e,r,t;function o(s){n[31](s,n[48])}function l(){return n[32](n[50])}function i(){return n[33](n[50])}let a={draggable:!0,zIndex:1,$$slots:{default:[Qi]},$$scope:{ctx:n}};return n[48].point!==void 0&&(a.lngLat=n[48].point),e=new xe({props:a}),pe.push(()=>ke(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",n[34]),e.$on("mouseleave",n[35]),e.$on("dragstart",n[25]),e.$on("dragend",n[36]),{c(){B(e.$$.fragment)},m(s,u){E(e,s,u),t=!0},p(s,u){n=s;const c={};u[0]&128|u[1]&8388608&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&128&&(r=!0,c.lngLat=n[48].point,we(()=>r=!1)),e.$set(c)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){A(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function Hi(n){let e,r;return e=new Te({props:{paint:{"line-color":"black","line-width":10}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Ki(n){let e,r;return e=new Te({props:{paint:{"line-color":"black","line-width":3}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Wi(n){let e,r,t,o,l,i,a,s,u,c,f;r=new Ut({}),r.$on("click",n[16]),r.$on("mousemove",n[17]),o=new Ni({props:{showDebug:n[9]}});let d=x(n[12]),p=[];for(let $=0;$<d.length;$+=1)p[$]=Tn(Dn(n,d,$));const m=$=>A(p[$],1,1,()=>{p[$]=null});let j=x(n[7]),M=[];for(let $=0;$<j.length;$+=1)M[$]=Nn(En(n,j,$));const _=$=>A(M[$],1,1,()=>{M[$]=null});return s=new Ae({props:{data:n[20](n[8],n[7]),generateId:!0,$$slots:{default:[Hi]},$$scope:{ctx:n}}}),c=new Ae({props:{data:n[13],$$slots:{default:[Ki]},$$scope:{ctx:n}}}),{c(){e=k("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L();for(let $=0;$<p.length;$+=1)p[$].c();i=L();for(let $=0;$<M.length;$+=1)M[$].c();a=L(),B(s.$$.fragment),u=L(),B(c.$$.fragment),F(e,"slot","map")},m($,C){v($,e,C),E(r,e,null),g(e,t),E(o,e,null),g(e,l);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(e,null);g(e,i);for(let b=0;b<M.length;b+=1)M[b]&&M[b].m(e,null);g(e,a),E(s,e,null),g(e,u),E(c,e,null),f=!0},p($,C){const b={};if(C[0]&512&&(b.showDebug=$[9]),o.$set(b),C[0]&14684224){d=x($[12]);let z;for(z=0;z<d.length;z+=1){const N=Dn($,d,z);p[z]?(p[z].p(N,C),h(p[z],1)):(p[z]=Tn(N),p[z].c(),h(p[z],1),p[z].m(e,i))}for(ue(),z=d.length;z<p.length;z+=1)m(z);fe()}if(C[0]&34341040){j=x($[7]);let z;for(z=0;z<j.length;z+=1){const N=En($,j,z);M[z]?(M[z].p(N,C),h(M[z],1)):(M[z]=Nn(N),M[z].c(),h(M[z],1),M[z].m(e,a))}for(ue(),z=j.length;z<M.length;z+=1)_(z);fe()}const S={};C[0]&384&&(S.data=$[20]($[8],$[7])),C[1]&8388608&&(S.$$scope={dirty:C,ctx:$}),s.$set(S);const w={};C[0]&8192&&(w.data=$[13]),C[1]&8388608&&(w.$$scope={dirty:C,ctx:$}),c.$set(w)},i($){if(!f){h(r.$$.fragment,$),h(o.$$.fragment,$);for(let C=0;C<d.length;C+=1)h(p[C]);for(let C=0;C<j.length;C+=1)h(M[C]);h(s.$$.fragment,$),h(c.$$.fragment,$),f=!0}},o($){A(r.$$.fragment,$),A(o.$$.fragment,$),p=p.filter(Boolean);for(let C=0;C<p.length;C+=1)A(p[C]);M=M.filter(Boolean);for(let C=0;C<M.length;C+=1)A(M[C]);A(s.$$.fragment,$),A(c.$$.fragment,$),f=!1},d($){$&&y(e),D(r),D(o),ge(p,$),ge(M,$),D(s),D(c)}}}function Zi(n){let e,r,t,o;return e=new Ue({props:{$$slots:{map:[Wi],sidebar:[Ji]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=R(window,"keydown",n[24]),t=!0)},p(l,i){const a={};i[0]&16383|i[1]&8388608&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l),t=!1,o()}}}function Xi(n,e,r){let t,o,l;te(n,Re,J=>r(7,o=J)),te(n,en,J=>r(8,l=J));let{map:i}=e,{finish:a}=e,{cancel:s}=e,{editingExisting:u}=e;Pt(()=>{K(Re,o=[],o),l==null||l.stop(),i.getCanvas().style.cursor="inherit"});let c=!0,f=u?"adjust":"append-end",d="snap",p=[],m=[],j=null,M=!1,_=!1,$=!1;function C(J){let re=J.length==0?"crosshair":"inherit";i.getCanvas().style.cursor=re}function b(){let J=p.pop();r(11,p),J&&K(Re,o=J,o)}function S(){p.length==100&&p.shift(),r(11,p=[...p,JSON.parse(JSON.stringify(o))])}function w(){r(10,d=d=="snap"?"free":"snap"),j&&r(27,j.snapped=d=="snap",j)}function z(J){S(),Re.update(re=>(f=="append-start"?re.splice(0,0,{point:J.detail.lngLat.toArray(),snapped:d=="snap"}):f=="append-end"&&re.push({point:J.detail.lngLat.toArray(),snapped:d=="snap"}),re))}function N(J){r(27,j={point:J.detail.lngLat.toArray(),snapped:d=="snap"})}function q(J){S(),Re.update(re=>(re[J].snapped=!re[J].snapped,re))}function Z(J){S(),Re.update(re=>(re.splice(J,1),re)),r(4,M=!1)}function V(J,re){try{if(J)return JSON.parse(J.inner.calculateRoute(re))}catch{}return Nt()}function T(J,re,Ce,Se,zt){if(zt)return Nt();try{if(J&&re.length>0&&Se){if(Ce=="append-start")return JSON.parse(J.inner.calculateRoute([Se,re[0]]));if(Ce=="append-end")return JSON.parse(J.inner.calculateRoute([re[re.length-1],Se]))}}catch{}return Nt()}function Q(J,re,Ce,Se){if(Se)return;if(!J||Ce!="adjust"){r(12,m=[]);return}let zt=[],Jt=1;for(let Lt=0;Lt<re.length-1;Lt++){let fo=JSON.parse(J.inner.getExtraNodes(re[Lt],re[Lt+1]));for(let[po,mo,go]of fo)zt.push({point:[po,mo],snapped:go,insertIdx:Jt});Jt++}r(12,m=zt)}function I(J){S(),Re.update(re=>(re.splice(J.insertIdx,0,{point:J.point,snapped:J.snapped}),re)),r(6,$=!0)}function _e(J){Re.update(re=>(re[J.insertIdx].point=J.point,re))}function he(){r(6,$=!1)}function P(J){let re=J.target.tagName,Ce=re=="INPUT"||re=="TEXTAREA";J.key==="Enter"&&!Ce?(J.stopPropagation(),o.length>=2&&a()):J.key==="Escape"?(J.stopPropagation(),s()):J.key=="s"&&!Ce?w():J.key=="1"&&!Ce?r(3,f="append-start"):J.key=="2"&&!Ce?r(3,f="append-end"):J.key=="3"&&!Ce?r(3,f="adjust"):J.key=="z"&&J.ctrlKey&&(J.stopPropagation(),b())}function X(){S(),r(5,_=!0)}const $e=[[],[]];function be(J,re){n.$$.not_equal(re.point,J)&&(re.point=J,r(12,m))}const U=J=>I(J),ne=J=>_e(J);function oe(J,re){n.$$.not_equal(re.point,J)&&(re.point=J,Re.set(o))}const Ne=J=>q(J),Xe=J=>Z(J),At=()=>r(4,M=!0),pt=()=>r(4,M=!1),mt=()=>r(5,_=!1);function gt(){d=this.__value,r(10,d)}function Ct(){d=this.__value,r(10,d)}function jt(){f=this.__value,r(3,f)}function it(){f=this.__value,r(3,f)}function Qe(){f=this.__value,r(3,f)}function St(){c=this.checked,r(9,c)}return n.$$set=J=>{"map"in J&&r(26,i=J.map),"finish"in J&&r(0,a=J.finish),"cancel"in J&&r(1,s=J.cancel),"editingExisting"in J&&r(2,u=J.editingExisting)},n.$$.update=()=>{n.$$.dirty[0]&456&&Q(l,o,f,$),n.$$.dirty[0]&134218168&&r(13,t=T(l,o,f,j,M||_)),n.$$.dirty[0]&128&&C(o)},[a,s,u,f,M,_,$,o,l,c,d,p,m,t,b,w,z,N,q,Z,V,I,_e,he,P,X,i,j,be,U,ne,oe,Ne,Xe,At,pt,mt,gt,$e,Ct,jt,it,Qe,St]}class Vi extends se{constructor(e){super(),ae(this,e,Xi,Zi,ie,{map:26,finish:0,cancel:1,editingExisting:2},null,[-1,-1])}}let In="MZEJTanw3WpxRvt7qDfo";async function Yi(n){return n?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await xi(n)}&key=${n}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${In}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${In}`}async function xi(n){try{let r=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB",layerTypes:["layerRoadmap"],overlay:!1})})).json();return"session"in r?r.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(r)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}const es="/route-element/assets/right-arrow-d8c7892c.svg";function On(n){let e,r;const t=n[4].default,o=Oe(t,n,n[3],null);return{c(){e=k("div"),o&&o.c(),F(e,"class","section svelte-zax3q3")},m(l,i){v(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&8)&&Fe(o,t,l,l[3],r?Pe(t,l[3],i,null):qe(l[3]),null)},i(l){r||(h(o,l),r=!0)},o(l){A(o,l),r=!1},d(l){l&&y(e),o&&o.d(l)}}}function ts(n){let e,r,t,o,l,i,a,s,u,c,f,d,p=n[2]&&On(n);return{c(){e=k("button"),r=k("div"),t=k("span"),o=O(n[0]),l=L(),i=k("img"),u=L(),p&&p.c(),F(i,"class","arrow svelte-zax3q3"),wt(i.src,a=es)||F(i,"src",a),F(i,"alt",s="Select "+n[0]),F(r,"class","top-section section svelte-zax3q3"),je(r,"bordered",n[2]),F(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m(m,j){v(m,e,j),g(e,r),g(r,t),g(t,o),g(r,l),g(r,i),g(e,u),p&&p.m(e,null),c=!0,f||(d=[R(e,"click",n[5]),R(e,"mouseenter",n[6]),R(e,"mouseleave",n[7])],f=!0)},p(m,[j]){(!c||j&1)&&le(o,m[0]),(!c||j&1&&s!==(s="Select "+m[0]))&&F(i,"alt",s),(!c||j&4)&&je(r,"bordered",m[2]),m[2]?p?(p.p(m,j),j&4&&h(p,1)):(p=On(m),p.c(),h(p,1),p.m(e,null)):p&&(ue(),A(p,1,1,()=>{p=null}),fe()),(!c||j&2)&&(e.disabled=m[1])},i(m){c||(h(p),c=!0)},o(m){A(p),c=!1},d(m){m&&y(e),p&&p.d(),f=!1,ze(d)}}}function ns(n,e,r){let{$$slots:t={},$$scope:o}=e,{name:l}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(f){Me.call(this,n,f)}function u(f){Me.call(this,n,f)}function c(f){Me.call(this,n,f)}return n.$$set=f=>{"name"in f&&r(0,l=f.name),"disabled"in f&&r(1,i=f.disabled),"hasSlot"in f&&r(2,a=f.hasSlot),"$$scope"in f&&r(3,o=f.$$scope)},[l,i,a,o,t,s,u,c]}class so extends se{constructor(e){super(),ae(this,e,ns,ts,ie,{name:0,disabled:1,hasSlot:2})}}let Ye={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const at={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},ao=Object.keys(at);function qt(n){return Object.keys(at[n])}const rt="All movements";function Fn(n,e){let r=[],t=at[n][e];t&&r.push({junctionType:n,movementType:e,...t});let o=at[n][rt];if(o&&e!=rt&&r.push({junctionType:n,movementType:rt,...o}),n=="Crossroads"){let l=at["Simple priority T-junction"][rt];l&&r.push({junctionType:"Simple priority T-junction",movementType:rt,...l})}if(n!="Any type of junction"){let l=at["Any type of junction"][rt];l&&r.push({junctionType:"Any type of junction",movementType:rt,...l})}return r}function qn(n,e,r){const t=n.slice();return t[9]=e[r],t}function Pn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Un(n,e,r){const t=n.slice();return t[12]=e[r],t}function Rn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Jn(n){let e,r;return e=new Rt({props:{$$slots:{default:[ls]},$$scope:{ctx:n}}}),e.$on("close",n[8]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&524295&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function rs(n){let e;return{c(){e=O("Type of junction")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function os(n){let e;return{c(){e=O("Type of movement")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Gn(n){let e,r,t;function o(i){n[6](i)}let l={k:"vert-radio",choices:qt(n[1]),$$slots:{default:[os]},$$scope:{ctx:n}};return n[2]!==void 0&&(l.value=n[2]),e=new Je({props:l}),pe.push(()=>ke(e,"value",o)),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,a){const s={};a&2&&(s.choices=qt(i[1])),a&524288&&(s.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,s.value=i[2],we(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function Qn(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=O(r)},m(o,l){v(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&le(t,r)},d(o){o&&y(e)}}}function Hn(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=O(r)},m(o,l){v(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&le(t,r)},d(o){o&&y(e)}}}function Kn(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=O(r)},m(o,l){v(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&le(t,r)},d(o){o&&y(e)}}}function Wn(n){let e,r,t=n[9].junctionType+"",o,l,i,a,s,u,c=n[9].movementType+"",f,d,p,m,j,M,_,$,C,b,S,w=x(n[9].scoreZero),z=[];for(let T=0;T<w.length;T+=1)z[T]=Qn(Rn(n,w,T));let N=x(n[9].scoreOne),q=[];for(let T=0;T<N.length;T+=1)q[T]=Hn(Un(n,N,T));let Z=x(n[9].scoreTwo),V=[];for(let T=0;T<Z.length;T+=1)V[T]=Kn(Pn(n,Z,T));return{c(){e=k("tr"),r=k("td"),o=O(t),l=L(),i=k("br"),a=L(),s=k("br"),u=L(),f=O(c),d=L(),p=k("td"),m=k("ul");for(let T=0;T<z.length;T+=1)z[T].c();j=L(),M=k("td"),_=k("ul");for(let T=0;T<q.length;T+=1)q[T].c();$=L(),C=k("td"),b=k("ul");for(let T=0;T<V.length;T+=1)V[T].c();S=L(),F(r,"class","type-row svelte-k4kgn3"),F(p,"class","score-zero svelte-k4kgn3"),F(M,"class","score-one svelte-k4kgn3"),F(C,"class","score-two svelte-k4kgn3")},m(T,Q){v(T,e,Q),g(e,r),g(r,o),g(r,l),g(r,i),g(r,a),g(r,s),g(r,u),g(r,f),g(e,d),g(e,p),g(p,m);for(let I=0;I<z.length;I+=1)z[I]&&z[I].m(m,null);g(e,j),g(e,M),g(M,_);for(let I=0;I<q.length;I+=1)q[I]&&q[I].m(_,null);g(e,$),g(e,C),g(C,b);for(let I=0;I<V.length;I+=1)V[I]&&V[I].m(b,null);g(e,S)},p(T,Q){if(Q&6&&t!==(t=T[9].junctionType+"")&&le(o,t),Q&6&&c!==(c=T[9].movementType+"")&&le(f,c),Q&6){w=x(T[9].scoreZero);let I;for(I=0;I<w.length;I+=1){const _e=Rn(T,w,I);z[I]?z[I].p(_e,Q):(z[I]=Qn(_e),z[I].c(),z[I].m(m,null))}for(;I<z.length;I+=1)z[I].d(1);z.length=w.length}if(Q&6){N=x(T[9].scoreOne);let I;for(I=0;I<N.length;I+=1){const _e=Un(T,N,I);q[I]?q[I].p(_e,Q):(q[I]=Hn(_e),q[I].c(),q[I].m(_,null))}for(;I<q.length;I+=1)q[I].d(1);q.length=N.length}if(Q&6){Z=x(T[9].scoreTwo);let I;for(I=0;I<Z.length;I+=1){const _e=Pn(T,Z,I);V[I]?V[I].p(_e,Q):(V[I]=Kn(_e),V[I].c(),V[I].m(b,null))}for(;I<V.length;I+=1)V[I].d(1);V.length=Z.length}},d(T){T&&y(e),ge(z,T),ge(q,T),ge(V,T)}}}function ls(n){let e,r,t,o,l,i,a,s,u=n[1],c,f,d,p,m,j,M,_,$;function C(N){n[5](N)}let b={k:"vert-radio",choices:ao,$$slots:{default:[rs]},$$scope:{ctx:n}};n[1]!==void 0&&(b.value=n[1]),i=new Je({props:b}),pe.push(()=>ke(i,"value",C)),i.$on("change",n[3]);let S=Gn(n),w=x(Fn(n[1],n[2])),z=[];for(let N=0;N<w.length;N+=1)z[N]=Wn(qn(n,w,N));return{c(){e=k("h1"),e.textContent="LTN 1/20 scoring guidance",r=L(),t=k("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,o=L(),l=k("div"),B(i.$$.fragment),s=L(),S.c(),c=L(),f=k("table"),d=k("tr"),d.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,p=L();for(let N=0;N<z.length;N+=1)z[N].c();m=L(),j=k("button"),j.textContent="OK",Y(l,"display","flex"),Y(l,"justify-content","space-between")},m(N,q){v(N,e,q),v(N,r,q),v(N,t,q),v(N,o,q),v(N,l,q),E(i,l,null),g(l,s),S.m(l,null),v(N,c,q),v(N,f,q),g(f,d),g(f,p);for(let Z=0;Z<z.length;Z+=1)z[Z]&&z[Z].m(f,null);v(N,m,q),v(N,j,q),M=!0,_||($=R(j,"click",n[7]),_=!0)},p(N,q){const Z={};if(q&524288&&(Z.$$scope={dirty:q,ctx:N}),!a&&q&2&&(a=!0,Z.value=N[1],we(()=>a=!1)),i.$set(Z),q&2&&ie(u,u=N[1])?(ue(),A(S,1,1,ee),fe(),S=Gn(N),S.c(),h(S,1),S.m(l,null)):S.p(N,q),q&6){w=x(Fn(N[1],N[2]));let V;for(V=0;V<w.length;V+=1){const T=qn(N,w,V);z[V]?z[V].p(T,q):(z[V]=Wn(T),z[V].c(),z[V].m(f,null))}for(;V<z.length;V+=1)z[V].d(1);z.length=w.length}},i(N){M||(h(i.$$.fragment,N),h(S),M=!0)},o(N){A(i.$$.fragment,N),A(S),M=!1},d(N){N&&(y(e),y(r),y(t),y(o),y(l),y(c),y(f),y(m),y(j)),D(i),S.d(N),ge(z,N),_=!1,$()}}}function is(n){let e,r,t,o,l,i,a=n[0]&&Jn(n);return{c(){e=k("button"),e.textContent="LTN 1/20 scoring guidance",r=L(),a&&a.c(),t=Ge(),F(e,"class","secondary")},m(s,u){v(s,e,u),v(s,r,u),a&&a.m(s,u),v(s,t,u),o=!0,l||(i=R(e,"click",n[4]),l=!0)},p(s,[u]){s[0]?a?(a.p(s,u),u&1&&h(a,1)):(a=Jn(s),a.c(),h(a,1),a.m(t.parentNode,t)):a&&(ue(),A(a,1,1,()=>{a=null}),fe())},i(s){o||(h(a),o=!0)},o(s){A(a),o=!1},d(s){s&&(y(e),y(r),y(t)),a&&a.d(s),l=!1,i()}}}function ss(n,e,r){let t=!1,o=ao[0],l=qt(o)[0];function i(){r(2,l=qt(o)[0])}const a=()=>r(0,t=!0);function s(d){o=d,r(1,o)}function u(d){l=d,r(2,l)}return[t,o,l,i,a,s,u,()=>r(0,t=!1),()=>r(0,t=!1)]}class as extends se{constructor(e){super(),ae(this,e,ss,is,ie,{})}}function cs(n){let e;return{c(){e=O("User")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Zn(n){let e,r;return e=new as({}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function us(n){let e;return{c(){e=O("Score")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function fs(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,j,M,_;function $(z){n[6](z)}let C={k:"horiz-radio",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]],$$slots:{default:[cs]},$$scope:{ctx:n}};n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind!==void 0&&(C.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind),l=new Je({props:C}),pe.push(()=>ke(l,"value",$));let b=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind=="cycling"&&Zn();function S(z){n[7](z)}let w={k:"horiz-radio",choices:n[4],$$slots:{default:[us]},$$scope:{ctx:n}};return n[3].jats[n[0]].properties[n[1]].movements[n[2]].score!==void 0&&(w.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].score),u=new Je({props:w}),pe.push(()=>ke(u,"value",S)),{c(){e=k("label"),r=O(`Name
  `),t=k("input"),o=L(),B(l.$$.fragment),a=L(),b&&b.c(),s=L(),B(u.$$.fragment),f=L(),d=k("label"),p=O(`Comments
  `),m=k("textarea"),F(t,"type","text")},m(z,N){v(z,e,N),g(e,r),g(e,t),ve(t,n[3].jats[n[0]].properties[n[1]].movements[n[2]].name),v(z,o,N),E(l,z,N),v(z,a,N),b&&b.m(z,N),v(z,s,N),E(u,z,N),v(z,f,N),v(z,d,N),g(d,p),g(d,m),ve(m,n[3].jats[n[0]].properties[n[1]].movements[n[2]].notes),j=!0,M||(_=[R(t,"input",n[5]),R(m,"input",n[8])],M=!0)},p(z,[N]){N&15&&t.value!==z[3].jats[z[0]].properties[z[1]].movements[z[2]].name&&ve(t,z[3].jats[z[0]].properties[z[1]].movements[z[2]].name);const q={};N&512&&(q.$$scope={dirty:N,ctx:z}),!i&&N&15&&(i=!0,q.value=z[3].jats[z[0]].properties[z[1]].movements[z[2]].kind,we(()=>i=!1)),l.$set(q),z[3].jats[z[0]].properties[z[1]].movements[z[2]].kind=="cycling"?b?N&15&&h(b,1):(b=Zn(),b.c(),h(b,1),b.m(s.parentNode,s)):b&&(ue(),A(b,1,1,()=>{b=null}),fe());const Z={};N&512&&(Z.$$scope={dirty:N,ctx:z}),!c&&N&15&&(c=!0,Z.value=z[3].jats[z[0]].properties[z[1]].movements[z[2]].score,we(()=>c=!1)),u.$set(Z),N&15&&ve(m,z[3].jats[z[0]].properties[z[1]].movements[z[2]].notes)},i(z){j||(h(l.$$.fragment,z),h(b),h(u.$$.fragment,z),j=!0)},o(z){A(l.$$.fragment,z),A(b),A(u.$$.fragment,z),j=!1},d(z){z&&(y(e),y(o),y(a),y(s),y(f),y(d)),D(l,z),b&&b.d(z),D(u,z),M=!1,ze(_)}}}function ds(n,e,r){let t;te(n,G,d=>r(3,t=d));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(){t.jats[o].properties[l].movements[i].name=this.value,G.set(t)}function u(d){n.$$.not_equal(t.jats[o].properties[l].movements[i].kind,d)&&(t.jats[o].properties[l].movements[i].kind=d,G.set(t))}function c(d){n.$$.not_equal(t.jats[o].properties[l].movements[i].score,d)&&(t.jats[o].properties[l].movements[i].score=d,G.set(t))}function f(){t.jats[o].properties[l].movements[i].notes=this.value,G.set(t)}return n.$$set=d=>{"junctionIdx"in d&&r(0,o=d.junctionIdx),"stage"in d&&r(1,l=d.stage),"idx"in d&&r(2,i=d.idx)},[o,l,i,t,a,s,u,c,f]}class ps extends se{constructor(e){super(),ae(this,e,ds,fs,ie,{junctionIdx:0,stage:1,idx:2})}}function ms(n){return n%(2*Math.PI)*180/Math.PI}function Dt(n){return n%360*Math.PI/180}function Xn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function co(n,e,r={}){if(r.final===!0)return gs(n,e);const t=Xn(n),o=Xn(e),l=Dt(t[0]),i=Dt(o[0]),a=Dt(t[1]),s=Dt(o[1]),u=Math.sin(i-l)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return ms(Math.atan2(u,c))}function gs(n,e){let r=co(e,n);return r=(r+180)%360,r}var ct=co;function _s(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function hs(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Vn(n[0])||!Vn(n[1]))throw new Error("coordinates must contain numbers");return _s({type:"Point",coordinates:n},e,r)}function Vn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function bs(n,e={}){const r=Io(n),t=(r[0]+r[2])/2,o=(r[1]+r[3])/2;return hs([t,o],e.properties,e)}var $s=bs,Ee=63710088e-1,ks={centimeters:Ee*100,centimetres:Ee*100,degrees:360/(2*Math.PI),feet:Ee*3.28084,inches:Ee*39.37,kilometers:Ee/1e3,kilometres:Ee/1e3,meters:Ee,metres:Ee,miles:Ee/1609.344,millimeters:Ee*1e3,millimetres:Ee*1e3,nauticalmiles:Ee/1852,radians:1,yards:Ee*1.0936};function ws(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function vs(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!xn(n[0])||!xn(n[1]))throw new Error("coordinates must contain numbers");return ws({type:"Point",coordinates:n},e,r)}function ys(n,e="kilometers"){const r=ks[e];if(!r)throw new Error(e+" units is invalid");return n/r}function Yn(n){return n%(2*Math.PI)*180/Math.PI}function Kt(n){return n%360*Math.PI/180}function xn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function As(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Cs(n,e,r,t={}){const o=As(n),l=Kt(o[0]),i=Kt(o[1]),a=Kt(r),s=ys(e,t.units),u=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),c=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(u)),f=Yn(c),d=Yn(u);return vs([f,d],t.properties)}var yt=Cs,De=63710088e-1,js={centimeters:De*100,centimetres:De*100,degrees:360/(2*Math.PI),feet:De*3.28084,inches:De*39.37,kilometers:De/1e3,kilometres:De/1e3,meters:De,metres:De,miles:De/1609.344,millimeters:De*1e3,millimetres:De*1e3,nauticalmiles:De/1852,radians:1,yards:De*1.0936};function Ss(n,e="kilometers"){const r=js[e];if(!r)throw new Error(e+" units is invalid");return n*r}function Tt(n){return n%360*Math.PI/180}function er(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function zs(n,e,r={}){var t=er(n),o=er(e),l=Tt(o[1]-t[1]),i=Tt(o[0]-t[0]),a=Tt(t[1]),s=Tt(o[1]),u=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return Ss(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)}var Ls=zs;function Ms(n){let e=$s({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,o)=>tr(ct(e,o.point))-tr(ct(e,t.point)));let r=[];for(let t=0;t<n.length;t++){let o=n[t],l=ct(o.point,e),i=1;for(let a of Es(t,n.length)){let s=n[a],u=ct(e,s.point),c=Bs(o.point,e,i++),f=Ls(o.point,e),d=yt(c,.5*f,l).geometry.coordinates,p=yt(d,.2*f,u).geometry.coordinates;r.push({point1:c,point2:d,point3:p,kind:"cycling",score:"X",name:`${o.name} to ${s.name}`,notes:""})}}return r}function Bs(n,e,r){let t=.003,l=ct(n,e)-90,i=t*r;return yt(n,i,l).geometry.coordinates}function tr(n){return(n+360)%360}function Es(n,e){let r=[];for(let t=n+1;t<e;t++)r.push(t);for(let t=0;t<n;t++)r.push(t);return r}const Ds="/route-element/assets/movement-aa45473c.svg",Ts="/route-element/assets/pan-fbcec4cd.svg";function nr(n,e,r){const t=n.slice();return t[31]=e[r],t[32]=e,t[33]=r,t}function rr(n,e,r){const t=n.slice();return t[34]=e[r],t[35]=e,t[33]=r,t}function or(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,j,M,_,$,C;function b(Q,I){return Q[0].mode=="select"?Is:Ns}let S=b(n),w=S(n);function z(Q,I){return Q[0].mode=="new-arm"?Fs:Os}let N=z(n),q=N(n);function Z(Q,I){return Q[0].mode=="new-movement"?Ps:qs}let V=Z(n),T=V(n);return{c(){e=k("div"),r=k("button"),t=k("img"),l=L(),w.c(),i=L(),a=k("button"),s=Gt("svg"),u=Gt("circle"),c=Gt("text"),f=O("A"),d=L(),q.c(),p=L(),m=k("button"),j=k("img"),_=L(),T.c(),wt(t.src,o=Ts)||F(t,"src",o),F(t,"alt","Move map"),Y(t,"vertical-align","middle"),F(r,"class","outline"),F(u,"cx","12"),F(u,"cy","12"),F(u,"r","12"),F(u,"fill","white"),F(c,"x","6"),F(c,"y","16"),F(c,"fill","#4472c4"),F(s,"width","24"),F(s,"height","24"),F(s,"xmlns","http://www.w3.org/2000/svg"),Y(s,"vertical-align","middle"),F(a,"class","outline"),wt(j.src,M=Ds)||F(j,"src",M),F(j,"alt","New movement"),Y(j,"vertical-align","middle"),F(m,"class","outline"),F(e,"class","control-panel svelte-l1e6xi")},m(Q,I){v(Q,e,I),g(e,r),g(r,t),g(r,l),w.m(r,null),g(e,i),g(e,a),g(a,s),g(s,u),g(s,c),g(c,f),g(a,d),q.m(a,null),g(e,p),g(e,m),g(m,j),g(m,_),T.m(m,null),$||(C=[R(r,"click",function(){Zt(n[4])&&n[4].apply(this,arguments)}),R(a,"click",n[12]),R(m,"click",n[13])],$=!0)},p(Q,I){n=Q,S!==(S=b(n))&&(w.d(1),w=S(n),w&&(w.c(),w.m(r,null))),N!==(N=z(n))&&(q.d(1),q=N(n),q&&(q.c(),q.m(a,null))),V!==(V=Z(n))&&(T.d(1),T=V(n),T&&(T.c(),T.m(m,null)))},d(Q){Q&&y(e),w.d(),q.d(),T.d(),$=!1,ze(C)}}}function Ns(n){let e;return{c(){e=O("Move map")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Is(n){let e;return{c(){e=k("b"),e.textContent="Move map"},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Os(n){let e;return{c(){e=O("New arm")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Fs(n){let e;return{c(){e=k("b"),e.textContent="New arm"},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function qs(n){let e;return{c(){e=O("New movement")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Ps(n){let e;return{c(){e=k("b"),e.textContent="New movement"},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Us(n){let e;return{c(){e=k("span"),e.textContent=`${xs(n[33])}`,F(e,"class","dot svelte-l1e6xi"),Y(e,"color","#4472c4"),Y(e,"background-color","white")},m(r,t){v(r,e,t)},p:ee,d(r){r&&y(e)}}}function lr(n){let e,r,t;function o(s){n[14](s,n[34])}function l(){return n[15](n[33])}function i(){return n[16](n[33])}let a={draggable:!0,$$slots:{default:[Us]},$$scope:{ctx:n}};return n[34].point!==void 0&&(a.lngLat=n[34].point),e=new xe({props:a}),pe.push(()=>ke(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){B(e.$$.fragment)},m(s,u){E(e,s,u),t=!0},p(s,u){n=s;const c={};u[1]&32&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&38&&(r=!0,c.lngLat=n[34].point,we(()=>r=!1)),e.$set(c)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){A(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function Rs(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score]),Y(e,"opacity",n[31].kind=="walking & wheeling"?"0%":"100%")},m(r,t){v(r,e,t)},p(r,t){t[0]&38&&Y(e,"background-color",r[7][r[31].score]),t[0]&38&&Y(e,"opacity",r[31].kind=="walking & wheeling"?"0%":"100%")},d(r){r&&y(e)}}}function Js(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score])},m(r,t){v(r,e,t)},p(r,t){t[0]&38&&Y(e,"background-color",r[7][r[31].score])},d(r){r&&y(e)}}}function Gs(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score]),Y(e,"opacity","0%")},m(r,t){v(r,e,t)},p(r,t){t[0]&38&&Y(e,"background-color",r[7][r[31].score])},d(r){r&&y(e)}}}function ir(n){let e,r,t,o,l,i,a,s,u;function c(w){n[17](w,n[31])}function f(){return n[18](n[33])}function d(){return n[19](n[33])}let p={draggable:!0,$$slots:{default:[Rs]},$$scope:{ctx:n}};n[31].point1!==void 0&&(p.lngLat=n[31].point1),e=new xe({props:p}),pe.push(()=>ke(e,"lngLat",c)),e.$on("dragend",f),e.$on("click",d);function m(w){n[20](w,n[31])}function j(){return n[21](n[33])}function M(){return n[22](n[33])}let _={draggable:!0,$$slots:{default:[Js]},$$scope:{ctx:n}};n[31].point2!==void 0&&(_.lngLat=n[31].point2),o=new xe({props:_}),pe.push(()=>ke(o,"lngLat",m)),o.$on("dragend",j),o.$on("click",M);function $(w){n[23](w,n[31])}function C(){return n[24](n[33])}function b(){return n[25](n[33])}let S={draggable:!0,$$slots:{default:[Gs]},$$scope:{ctx:n}};return n[31].point3!==void 0&&(S.lngLat=n[31].point3),a=new xe({props:S}),pe.push(()=>ke(a,"lngLat",$)),a.$on("dragend",C),a.$on("click",b),{c(){B(e.$$.fragment),t=L(),B(o.$$.fragment),i=L(),B(a.$$.fragment)},m(w,z){E(e,w,z),v(w,t,z),E(o,w,z),v(w,i,z),E(a,w,z),u=!0},p(w,z){n=w;const N={};z[0]&38|z[1]&32&&(N.$$scope={dirty:z,ctx:n}),!r&&z[0]&38&&(r=!0,N.lngLat=n[31].point1,we(()=>r=!1)),e.$set(N);const q={};z[0]&38|z[1]&32&&(q.$$scope={dirty:z,ctx:n}),!l&&z[0]&38&&(l=!0,q.lngLat=n[31].point2,we(()=>l=!1)),o.$set(q);const Z={};z[0]&38|z[1]&32&&(Z.$$scope={dirty:z,ctx:n}),!s&&z[0]&38&&(s=!0,Z.lngLat=n[31].point3,we(()=>s=!1)),a.$set(Z)},i(w){u||(h(e.$$.fragment,w),h(o.$$.fragment,w),h(a.$$.fragment,w),u=!0)},o(w){A(e.$$.fragment,w),A(o.$$.fragment,w),A(a.$$.fragment,w),u=!1},d(w){w&&(y(t),y(i)),D(e,w),D(o,w),D(a,w)}}}function Qs(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=O(e)},m(t,o){v(t,r,o)},p(t,o){o[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&le(r,e)},d(t){t&&y(r)}}}function Hs(n){let e,r;return e=new ft({props:{$$slots:{default:[Qs,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o[0]&1073741824|o[1]&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Ks(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=O(e)},m(t,o){v(t,r,o)},p(t,o){o[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&le(r,e)},d(t){t&&y(r)}}}function Ws(n){let e,r;return e=new ft({props:{$$slots:{default:[Ks,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o[0]&1073741824|o[1]&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Zs(n){let e,r,t,o,l,i;return e=new Te({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":vt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Hs]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Te({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":vt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Ws]},$$scope:{ctx:n}}}),t.$on("click",n[9]),l=new lt({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){B(e.$$.fragment),r=L(),B(t.$$.fragment),o=L(),B(l.$$.fragment)},m(a,s){E(e,a,s),v(a,r,s),E(t,a,s),v(a,o,s),E(l,a,s),i=!0},p(a,s){const u={};s[1]&32&&(u.$$scope={dirty:s,ctx:a}),e.$set(u);const c={};s[1]&32&&(c.$$scope={dirty:s,ctx:a}),t.$set(c)},i(a){i||(h(e.$$.fragment,a),h(t.$$.fragment,a),h(l.$$.fragment,a),i=!0)},o(a){A(e.$$.fragment,a),A(t.$$.fragment,a),A(l.$$.fragment,a),i=!1},d(a){a&&(y(r),y(o)),D(e,a),D(t,a),D(l,a)}}}function Xs(n){let e,r,t,o;return e=new Te({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new tt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){B(e.$$.fragment),r=L(),B(t.$$.fragment)},m(l,i){E(e,l,i),v(l,r,i),E(t,l,i),o=!0},p:ee,i(l){o||(h(e.$$.fragment,l),h(t.$$.fragment,l),o=!0)},o(l){A(e.$$.fragment,l),A(t.$$.fragment,l),o=!1},d(l){l&&y(r),D(e,l),D(t,l)}}}function Vs(n){let e,r,t,o,l,i,a,s,u;e=new Ut({}),e.$on("click",n[8]);let c=n[0].mode!="editing"&&or(n),f=x(n[5].jats[n[1]].properties[n[2]].arms),d=[];for(let _=0;_<f.length;_+=1)d[_]=lr(rr(n,f,_));const p=_=>A(d[_],1,1,()=>{d[_]=null});let m=x(n[5].jats[n[1]].properties[n[2]].movements),j=[];for(let _=0;_<m.length;_+=1)j[_]=ir(nr(n,m,_));const M=_=>A(j[_],1,1,()=>{j[_]=null});return i=new Ae({props:{data:n[10](n[5]),$$slots:{default:[Zs]},$$scope:{ctx:n}}}),s=new Ae({props:{data:n[6],$$slots:{default:[Xs]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=L(),c&&c.c(),t=L();for(let _=0;_<d.length;_+=1)d[_].c();o=L();for(let _=0;_<j.length;_+=1)j[_].c();l=L(),B(i.$$.fragment),a=L(),B(s.$$.fragment)},m(_,$){E(e,_,$),v(_,r,$),c&&c.m(_,$),v(_,t,$);for(let C=0;C<d.length;C+=1)d[C]&&d[C].m(_,$);v(_,o,$);for(let C=0;C<j.length;C+=1)j[C]&&j[C].m(_,$);v(_,l,$),E(i,_,$),v(_,a,$),E(s,_,$),u=!0},p(_,$){if(_[0].mode!="editing"?c?c.p(_,$):(c=or(_),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),$[0]&46){f=x(_[5].jats[_[1]].properties[_[2]].arms);let S;for(S=0;S<f.length;S+=1){const w=rr(_,f,S);d[S]?(d[S].p(w,$),h(d[S],1)):(d[S]=lr(w),d[S].c(),h(d[S],1),d[S].m(o.parentNode,o))}for(ue(),S=f.length;S<d.length;S+=1)p(S);fe()}if($[0]&174){m=x(_[5].jats[_[1]].properties[_[2]].movements);let S;for(S=0;S<m.length;S+=1){const w=nr(_,m,S);j[S]?(j[S].p(w,$),h(j[S],1)):(j[S]=ir(w),j[S].c(),h(j[S],1),j[S].m(l.parentNode,l))}for(ue(),S=m.length;S<j.length;S+=1)M(S);fe()}const C={};$[0]&32&&(C.data=_[10](_[5])),$[1]&32&&(C.$$scope={dirty:$,ctx:_}),i.$set(C);const b={};$[0]&64&&(b.data=_[6]),$[1]&32&&(b.$$scope={dirty:$,ctx:_}),s.$set(b)},i(_){if(!u){h(e.$$.fragment,_);for(let $=0;$<f.length;$+=1)h(d[$]);for(let $=0;$<m.length;$+=1)h(j[$]);h(i.$$.fragment,_),h(s.$$.fragment,_),u=!0}},o(_){A(e.$$.fragment,_),d=d.filter(Boolean);for(let $=0;$<d.length;$+=1)A(d[$]);j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)A(j[$]);A(i.$$.fragment,_),A(s.$$.fragment,_),u=!1},d(_){_&&(y(r),y(t),y(o),y(l),y(a)),D(e,_),c&&c.d(_),ge(d,_),ge(j,_),D(i,_),D(s,_)}}}function Ys(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function xs(n){return String.fromCharCode(n+"A".charCodeAt(0))}function ea(n,e,r){let t,o,l;te(n,G,P=>r(5,o=P)),te(n,Ot,P=>r(26,l=P));let{junctionIdx:i}=e,{stage:a}=e,{mode:s}=e,{hoveringSidebar:u}=e,{select:c}=e,{stopEditing:f}=e,d={0:Ye.red.background,1:Ye.amber.background,2:Ye.green.background,X:Ye.critical.background};function p(P,X,$e){let be={type:"FeatureCollection",features:[]},U=X.mode=="editing"?X.id:$e;return U!=null&&(U.kind=="arm"?be.features.push(Ys(P.jats[i].properties[a].arms[U.idx],U.idx)):be.features.push(_(P.jats[i].properties[a].movements[U.idx],U.idx))),be}async function m(P){if(l){for(let X of l.queryRenderedFeatures(P.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await f();return}s.mode=="new-arm"?(K(G,o.jats[i].properties[a].arms=[...o.jats[i].properties[a].arms,{point:P.detail.lngLat.toArray(),name:""}],o),await c({kind:"arm",idx:o.jats[i].properties[a].arms.length-1})):(K(G,o.jats[i].properties[a].movements=[...o.jats[i].properties[a].movements,{point1:P.detail.lngLat.toArray(),point2:yt(P.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:yt(P.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await c({kind:"movement",idx:o.jats[i].properties[a].movements.length-1}))}}}async function j(P){await c({kind:"movement",idx:P.detail.features[0].id})}function M(P){let X={type:"FeatureCollection",features:P.jats[i].properties[a].movements.map(($e,be)=>_($e,be))};for(let $e of P.jats[i].properties[a].movements)if(X.features.push($($e,X.features.length)),$e.kind=="walking & wheeling"){let be={...$e,point1:$e.point3,point3:$e.point1};X.features.push($(be,X.features.length))}return X}function _(P,X){return{type:"Feature",id:X,properties:{name:P.name,kind:P.kind,color:d[P.score]},geometry:{type:"LineString",coordinates:[P.point1,P.point2,P.point3]}}}function $(P,X){return{type:"Feature",id:X,properties:{kind:P.kind,color:d[P.score],angle:ct(P.point2,P.point3)},geometry:{type:"Point",coordinates:P.point3}}}const C=()=>r(0,s={mode:"new-arm"}),b=()=>r(0,s={mode:"new-movement"});function S(P,X){n.$$.not_equal(X.point,P)&&(X.point=P,G.set(o))}const w=P=>c({kind:"arm",idx:P}),z=P=>c({kind:"arm",idx:P});function N(P,X){n.$$.not_equal(X.point1,P)&&(X.point1=P,G.set(o))}const q=P=>c({kind:"movement",idx:P}),Z=P=>c({kind:"movement",idx:P});function V(P,X){n.$$.not_equal(X.point2,P)&&(X.point2=P,G.set(o))}const T=P=>c({kind:"movement",idx:P}),Q=P=>c({kind:"movement",idx:P});function I(P,X){n.$$.not_equal(X.point3,P)&&(X.point3=P,G.set(o))}const _e=P=>c({kind:"movement",idx:P}),he=P=>c({kind:"movement",idx:P});return n.$$set=P=>{"junctionIdx"in P&&r(1,i=P.junctionIdx),"stage"in P&&r(2,a=P.stage),"mode"in P&&r(0,s=P.mode),"hoveringSidebar"in P&&r(11,u=P.hoveringSidebar),"select"in P&&r(3,c=P.select),"stopEditing"in P&&r(4,f=P.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&2081&&r(6,t=p(o,s,u))},[s,i,a,c,f,o,t,d,m,j,M,u,C,b,S,w,z,N,q,Z,V,T,Q,I,_e,he]}class ta extends se{constructor(e){super(),ae(this,e,ea,Vs,ie,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function sr(n){if(n.movements.length==0)return"No movements added";let e=0,r=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],r+=2;let t=e/r*100;return`${Math.round(t)}%`}const{window:na}=ut;function ar(n,e,r){const t=n.slice();t[27]=e[r],t[30]=r;const o=t[14][t[27].score];return t[28]=o,t}function cr(n,e,r){const t=n.slice();return t[31]=e[r],t[30]=r,t}function ra(n){let e,r,t,o,l,i,a,s,u;return{c(){e=k("button"),e.textContent="Done",r=L(),t=k("button"),t.textContent="Delete",o=L(),l=k("label"),i=O(`Arm name
        `),a=k("input"),F(a,"type","text")},m(c,f){v(c,e,f),v(c,r,f),v(c,t,f),v(c,o,f),v(c,l,f),g(l,i),g(l,a),ve(a,n[5].jats[n[0]].properties[n[1]].arms[n[2].id.idx].name),s||(u=[R(e,"click",n[23]),R(t,"click",n[10]),R(a,"input",n[24])],s=!0)},p(c,f){f[0]&39&&a.value!==c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name&&ve(a,c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name)},i:ee,o:ee,d(c){c&&(y(e),y(r),y(t),y(o),y(l)),s=!1,ze(u)}}}function oa(n){let e,r,t,o,l,i,a,s;return e=new ps({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),{c(){B(e.$$.fragment),r=L(),t=k("button"),t.textContent="Save",o=L(),l=k("button"),l.textContent="Delete"},m(u,c){E(e,u,c),v(u,r,c),v(u,t,c),v(u,o,c),v(u,l,c),i=!0,a||(s=[R(t,"click",n[9]),R(l,"click",n[10])],a=!0)},p(u,c){const f={};c[0]&1&&(f.junctionIdx=u[0]),c[0]&2&&(f.stage=u[1]),c[0]&4&&(f.idx=u[2].id.idx),e.$set(f)},i(u){i||(h(e.$$.fragment,u),i=!0)},o(u){A(e.$$.fragment,u),i=!1},d(u){u&&(y(r),y(t),y(o),y(l)),D(e,u),a=!1,ze(s)}}}function la(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m=n[5].jats[n[0]].properties.name+"",j,M,_=sr(n[5].jats[n[0]].properties[n[1]])+"",$,C,b,S,w,z,N,q,Z,V,T,Q=x(n[5].jats[n[0]].properties[n[1]].arms),I=[];for(let U=0;U<Q.length;U+=1)I[U]=ur(cr(n,Q,U));const _e=U=>A(I[U],1,1,()=>{I[U]=null});let he=n[5].jats[n[0]].properties[n[7]].arms.length>0&&fr(n),P=x(n[5].jats[n[0]].properties[n[1]].movements),X=[];for(let U=0;U<P.length;U+=1)X[U]=dr(ar(n,P,U));const $e=U=>A(X[U],1,1,()=>{X[U]=null});let be=n[5].jats[n[0]].properties[n[7]].movements.length>0&&pr(n);return{c(){e=k("button"),e.textContent="Done",r=L(),t=k("h3"),t.textContent="Arms",o=L();for(let U=0;U<I.length;U+=1)I[U].c();l=L(),he&&he.c(),i=L(),a=k("h3"),a.textContent="Movements",s=L(),u=k("p"),c=O("Total JAT score for "),f=O(n[1]),d=O(` junction
        `),p=k("i"),j=O(m),M=O(`
        : `),$=O(_),C=L(),b=k("button"),S=O("Generate cycling movements between all arms"),z=L();for(let U=0;U<X.length;U+=1)X[U].c();N=L(),be&&be.c(),q=Ge(),F(b,"class","secondary"),b.disabled=w=n[5].jats[n[0]].properties[n[1]].arms.length<2},m(U,ne){v(U,e,ne),v(U,r,ne),v(U,t,ne),v(U,o,ne);for(let oe=0;oe<I.length;oe+=1)I[oe]&&I[oe].m(U,ne);v(U,l,ne),he&&he.m(U,ne),v(U,i,ne),v(U,a,ne),v(U,s,ne),v(U,u,ne),g(u,c),g(u,f),g(u,d),g(u,p),g(p,j),g(u,M),g(u,$),v(U,C,ne),v(U,b,ne),g(b,S),v(U,z,ne);for(let oe=0;oe<X.length;oe+=1)X[oe]&&X[oe].m(U,ne);v(U,N,ne),be&&be.m(U,ne),v(U,q,ne),Z=!0,V||(T=[R(e,"click",n[16]),R(b,"click",n[15])],V=!0)},p(U,ne){if(ne[0]&299){Q=x(U[5].jats[U[0]].properties[U[1]].arms);let oe;for(oe=0;oe<Q.length;oe+=1){const Ne=cr(U,Q,oe);I[oe]?(I[oe].p(Ne,ne),h(I[oe],1)):(I[oe]=ur(Ne),I[oe].c(),h(I[oe],1),I[oe].m(l.parentNode,l))}for(ue(),oe=Q.length;oe<I.length;oe+=1)_e(oe);fe()}if(U[5].jats[U[0]].properties[U[7]].arms.length>0?he?he.p(U,ne):(he=fr(U),he.c(),he.m(i.parentNode,i)):he&&(he.d(1),he=null),(!Z||ne[0]&2)&&le(f,U[1]),(!Z||ne[0]&33)&&m!==(m=U[5].jats[U[0]].properties.name+"")&&le(j,m),(!Z||ne[0]&35)&&_!==(_=sr(U[5].jats[U[0]].properties[U[1]])+"")&&le($,_),(!Z||ne[0]&35&&w!==(w=U[5].jats[U[0]].properties[U[1]].arms.length<2))&&(b.disabled=w),ne[0]&16683){P=x(U[5].jats[U[0]].properties[U[1]].movements);let oe;for(oe=0;oe<P.length;oe+=1){const Ne=ar(U,P,oe);X[oe]?(X[oe].p(Ne,ne),h(X[oe],1)):(X[oe]=dr(Ne),X[oe].c(),h(X[oe],1),X[oe].m(N.parentNode,N))}for(ue(),oe=P.length;oe<X.length;oe+=1)$e(oe);fe()}U[5].jats[U[0]].properties[U[7]].movements.length>0?be?be.p(U,ne):(be=pr(U),be.c(),be.m(q.parentNode,q)):be&&(be.d(1),be=null)},i(U){if(!Z){for(let ne=0;ne<Q.length;ne+=1)h(I[ne]);for(let ne=0;ne<P.length;ne+=1)h(X[ne]);Z=!0}},o(U){I=I.filter(Boolean);for(let ne=0;ne<I.length;ne+=1)A(I[ne]);X=X.filter(Boolean);for(let ne=0;ne<X.length;ne+=1)A(X[ne]);Z=!1},d(U){U&&(y(e),y(r),y(t),y(o),y(l),y(i),y(a),y(s),y(u),y(C),y(b),y(z),y(N),y(q)),ge(I,U),he&&he.d(U),ge(X,U),be&&be.d(U),V=!1,ze(T)}}}function ur(n){let e,r;function t(){return n[17](n[30])}function o(){return n[18](n[30])}return e=new so({props:{name:`${mr(n[30])} - ${n[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[19]),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0},p(l,i){n=l;const a={};i[0]&35&&(a.name=`${mr(n[30])} - ${n[31].name||"Unnamed arm"}`),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l)}}}function fr(n){let e,r,t;return{c(){e=k("button"),e.textContent=`Copy arms from ${n[7]}`,F(e,"class","secondary")},m(o,l){v(o,e,l),r||(t=R(e,"click",n[12]),r=!0)},p:ee,d(o){o&&y(e),r=!1,t()}}}function ia(n){let e,r,t,o=n[27].score+"",l,i,a,s=gr(n[27].kind)+"",u;return{c(){e=k("div"),r=k("span"),t=O("Score: "),l=O(o),i=L(),a=k("span"),u=O(s),Y(r,"padding","4px"),Y(r,"color",n[28].font),Y(r,"background-color",n[28].background),Y(e,"width","100%"),Y(e,"display","flex"),Y(e,"justify-content","space-between")},m(c,f){v(c,e,f),g(e,r),g(r,t),g(r,l),g(e,i),g(e,a),g(a,u)},p(c,f){f[0]&35&&o!==(o=c[27].score+"")&&le(l,o),f[0]&35&&Y(r,"color",c[28].font),f[0]&35&&Y(r,"background-color",c[28].background),f[0]&35&&s!==(s=gr(c[27].kind)+"")&&le(u,s)},d(c){c&&y(e)}}}function dr(n){let e,r;function t(){return n[20](n[30])}function o(){return n[21](n[30])}return e=new so({props:{name:n[27].name||"Unnamed movement",$$slots:{default:[ia]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[22]),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0},p(l,i){n=l;const a={};i[0]&35&&(a.name=n[27].name||"Unnamed movement"),i[0]&35|i[1]&4&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l)}}}function pr(n){let e,r,t;return{c(){e=k("button"),e.textContent=`Copy movements from ${n[7]}`,F(e,"class","secondary")},m(o,l){v(o,e,l),r||(t=R(e,"click",n[13]),r=!0)},p:ee,d(o){o&&y(e),r=!1,t()}}}function sa(n){let e,r,t,o,l=n[5].jats[n[0]].properties.name+"",i,a,s,u,c;const f=[la,oa,ra],d=[];function p(m,j){return m[2].mode!="editing"?0:m[2].id.kind=="movement"?1:2}return s=p(n),u=d[s]=f[s](n),{c(){e=k("div"),r=k("h2"),t=O(n[1]),o=O(" JAT for "),i=O(l),a=L(),u.c(),F(e,"slot","sidebar")},m(m,j){v(m,e,j),g(e,r),g(r,t),g(r,o),g(r,i),g(e,a),d[s].m(e,null),n[25](e),c=!0},p(m,j){(!c||j[0]&2)&&le(t,m[1]),(!c||j[0]&33)&&l!==(l=m[5].jats[m[0]].properties.name+"")&&le(i,l);let M=s;s=p(m),s===M?d[s].p(m,j):(ue(),A(d[M],1,1,()=>{d[M]=null}),fe(),u=d[s],u?u.p(m,j):(u=d[s]=f[s](m),u.c()),h(u,1),u.m(e,null))},i(m){c||(h(u),c=!0)},o(m){A(u),c=!1},d(m){m&&y(e),d[s].d(),n[25](null)}}}function aa(n){let e,r;return e=new tt({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o[0]&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function ca(n){let e,r,t,o,l,i,a;return r=new We({props:{except:"jats"}}),o=new Ae({props:{data:me(n[5].jats),generateId:!0,$$slots:{default:[aa]},$$scope:{ctx:n}}}),i=new ta({props:{junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],select:n[8],stopEditing:n[9]}}),{c(){e=k("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(s,u){v(s,e,u),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),a=!0},p(s,u){const c={};u[0]&32&&(c.data=me(s[5].jats)),u[0]&1|u[1]&4&&(c.$$scope={dirty:u,ctx:s}),o.$set(c);const f={};u[0]&1&&(f.junctionIdx=s[0]),u[0]&2&&(f.stage=s[1]),u[0]&4&&(f.mode=s[2]),u[0]&8&&(f.hoveringSidebar=s[3]),i.$set(f)},i(s){a||(h(r.$$.fragment,s),h(o.$$.fragment,s),h(i.$$.fragment,s),a=!0)},o(s){A(r.$$.fragment,s),A(o.$$.fragment,s),A(i.$$.fragment,s),a=!1},d(s){s&&y(e),D(r),D(o),D(i)}}}function ua(n){let e,r,t,o;return e=new Ue({props:{$$slots:{map:[ca],sidebar:[sa]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=R(na,"keydown",n[11]),t=!0)},p(l,i){const a={};i[0]&127|i[1]&4&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l),t=!1,o()}}}function mr(n){return String.fromCharCode(n+"A".charCodeAt(0))}function gr(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function fa(n,e,r){let t,o;te(n,G,I=>r(5,t=I)),te(n,W,I=>r(6,o=I));let{junctionIdx:l}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s={mode:"select"},u=null,c=null,f;async function d(I){u=f.scrollTop,r(2,s={mode:"editing",id:I}),r(3,c=null),await ot(),r(4,f.scrollTop=0,f)}async function p(){r(2,s={mode:"select"}),u!=null&&(await ot(),r(4,f.scrollTop=u,f),u=null)}function m(){s.mode=="editing"&&window.confirm(`Delete this ${s.id.kind}?`)&&(s.id.kind=="movement"?(t.jats[l].properties[i].movements.splice(s.id.idx,1),G.set(t)):(t.jats[l].properties[i].arms.splice(s.id.idx,1),G.set(t)),p())}function j(I){if(s.mode!="editing")return;let _e=I.target.tagName,he=_e=="INPUT"||_e=="TEXTAREA";I.key=="Escape"||I.key=="Enter"&&!he?(I.stopPropagation(),p()):I.key=="Delete"&&!he&&(I.stopPropagation(),m())}function M(){t.jats[l].properties[i].arms.length>0&&!window.confirm("Overwrite arms?")||(K(G,t.jats[l].properties[i].arms=JSON.parse(JSON.stringify(t.jats[l].properties[a].arms)),t),G.set(t))}function _(){t.jats[l].properties[i].movements.length>0&&!window.confirm("Overwrite movements?")||(K(G,t.jats[l].properties[i].movements=JSON.parse(JSON.stringify(t.jats[l].properties[a].movements)),t),G.set(t))}let $={0:Ye.red,1:Ye.amber,2:Ye.green,X:Ye.critical};function C(){if(t.jats[l].properties[i].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let I=t.jats[l].properties[i].movements.filter(_e=>_e.kind=="walking & wheeling");K(G,t.jats[l].properties[i].movements=[...I,...Ms(t.jats[l].properties[i].arms)],t)}const b=()=>K(W,o={kind:"edit-jat",idx:l},o),S=I=>d({kind:"arm",idx:I}),w=I=>r(3,c={kind:"arm",idx:I}),z=()=>r(3,c=null),N=I=>d({kind:"movement",idx:I}),q=I=>r(3,c={kind:"movement",idx:I}),Z=()=>r(3,c=null),V=()=>r(2,s={mode:"select"});function T(){t.jats[l].properties[i].arms[s.id.idx].name=this.value,G.set(t)}function Q(I){pe[I?"unshift":"push"](()=>{f=I,r(4,f)})}return n.$$set=I=>{"junctionIdx"in I&&r(0,l=I.junctionIdx),"stage"in I&&r(1,i=I.stage)},[l,i,s,c,f,t,o,a,d,p,m,j,M,_,$,C,b,S,w,z,N,q,Z,V,T,Q]}class da extends se{constructor(e){super(),ae(this,e,fa,ua,ie,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:pa}=ut;function ma(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m;return{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("button"),o.textContent="Delete JAT",l=L(),i=k("label"),a=O(`Name:
      `),s=k("input"),u=L(),c=k("button"),c.textContent="Existing",f=L(),d=k("button"),d.textContent="Proposed",F(s,"type","text"),F(e,"slot","sidebar")},m(j,M){v(j,e,M),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(i,a),g(i,s),ve(s,n[1].jats[n[0]].properties.name),g(e,u),g(e,c),g(e,f),g(e,d),p||(m=[R(r,"click",n[6]),R(o,"click",n[4]),R(s,"input",n[7]),R(c,"click",n[8]),R(d,"click",n[9])],p=!0)},p(j,M){M&3&&s.value!==j[1].jats[j[0]].properties.name&&ve(s,j[1].jats[j[0]].properties.name)},d(j){j&&y(e),p=!1,ze(m)}}}function ga(n){let e,r;return e=new tt({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function _a(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"jats"}}),o=new Ae({props:{data:me(n[1].jats),generateId:!0,$$slots:{default:[ga]},$$scope:{ctx:n}}});function u(f){n[5](f)}let c={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].jats[n[0]].geometry.coordinates),i=new xt({props:c}),pe.push(()=>ke(i,"lngLat",u)),{c(){e=k("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){v(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].jats)),d&1025&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};d&3&&(m.color=f[1].jats[f[0]].properties.color),!a&&d&3&&(a=!0,m.lngLat=f[1].jats[f[0]].geometry.coordinates,we(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){A(r.$$.fragment,f),A(o.$$.fragment,f),A(i.$$.fragment,f),s=!1},d(f){f&&y(e),D(r),D(o),D(i)}}}function ha(n){let e,r,t,o;return e=new Ue({props:{$$slots:{map:[_a],sidebar:[ma]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=R(pa,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l),t=!1,o()}}}function ba(n,e,r){let t,o;te(n,G,p=>r(1,t=p)),te(n,W,p=>r(2,o=p));let{idx:l}=e;function i(p){p.key=="Escape"&&K(W,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this JAT?")&&(K(W,o={kind:"neutral"},o),await ot(),t.jats.splice(l,1),G.set(t))}function s(p){n.$$.not_equal(t.jats[l].geometry.coordinates,p)&&(t.jats[l].geometry.coordinates=p,G.set(t))}const u=()=>K(W,o={kind:"neutral"},o);function c(){t.jats[l].properties.name=this.value,G.set(t)}const f=()=>K(W,o={kind:"edit-jat-detail",idx:l,stage:"existing"},o),d=()=>K(W,o={kind:"edit-jat-detail",idx:l,stage:"proposed"},o);return n.$$set=p=>{"idx"in p&&r(0,l=p.idx)},[l,t,o,i,a,s,u,c,f,d]}class $a extends se{constructor(e){super(),ae(this,e,ba,ha,ie,{idx:0})}}function _r(n,e,r){const t=n.slice();return t[5]=e[r],t[6]=e,t[7]=r,t}function ka(n){let e,r;return{c(){e=k("span"),r=L(),F(e,"class","dot svelte-jgyhla")},m(t,o){v(t,e,o),v(t,r,o)},p:ee,d(t){t&&(y(e),y(r))}}}function hr(n){let e,r,t;function o(a){n[3](a,n[5],n[6],n[7])}function l(){return n[4](n[7])}let i={draggable:!0,$$slots:{default:[ka]},$$scope:{ctx:n}};return n[5]!==void 0&&(i.lngLat=n[5]),e=new xe({props:i}),pe.push(()=>ke(e,"lngLat",o)),e.$on("contextmenu",l),{c(){B(e.$$.fragment)},m(a,s){E(e,a,s),t=!0},p(a,s){n=a;const u={};s&256&&(u.$$scope={dirty:s,ctx:n}),!r&&s&1&&(r=!0,u.lngLat=n[5],we(()=>r=!1)),e.$set(u)},i(a){t||(h(e.$$.fragment,a),t=!0)},o(a){A(e.$$.fragment,a),t=!1},d(a){D(e,a)}}}function wa(n){let e,r,t,o;e=new Ut({}),e.$on("click",n[1]);let l=x(n[0].geometry.coordinates),i=[];for(let s=0;s<l.length;s+=1)i[s]=hr(_r(n,l,s));const a=s=>A(i[s],1,1,()=>{i[s]=null});return{c(){B(e.$$.fragment),r=L();for(let s=0;s<i.length;s+=1)i[s].c();t=Ge()},m(s,u){E(e,s,u),v(s,r,u);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(s,u);v(s,t,u),o=!0},p(s,[u]){if(u&5){l=x(s[0].geometry.coordinates);let c;for(c=0;c<l.length;c+=1){const f=_r(s,l,c);i[c]?(i[c].p(f,u),h(i[c],1)):(i[c]=hr(f),i[c].c(),h(i[c],1),i[c].m(t.parentNode,t))}for(ue(),c=l.length;c<i.length;c+=1)a(c);fe()}},i(s){if(!o){h(e.$$.fragment,s);for(let u=0;u<l.length;u+=1)h(i[u]);o=!0}},o(s){A(e.$$.fragment,s),i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)A(i[u]);o=!1},d(s){s&&(y(r),y(t)),D(e,s),ge(i,s)}}}function va(n,e,r){let{f:t}=e;function o(s){t.geometry.coordinates.push(s.detail.lngLat.toArray()),r(0,t)}function l(s){t.geometry.coordinates.splice(s,1),r(0,t)}function i(s,u,c,f){c[f]=s,r(0,t)}const a=s=>l(s);return n.$$set=s=>{"f"in s&&r(0,t=s.f)},[t,o,l,i,a]}class uo extends se{constructor(e){super(),ae(this,e,va,wa,ie,{f:0})}}const{window:ya}=ut;function br(n,e,r){const t=n.slice();return t[13]=e[r],t[14]=e,t[15]=r,t}function $r(n){let e;return{c(){e=k("p"),e.textContent="A link needs at least two points"},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Aa(n){let e,r,t;function o(){return n[10](n[13])}return{c(){e=k("button"),e.textContent="?",F(e,"class","outline")},m(l,i){v(l,e,i),r||(t=R(e,"click",o),r=!0)},p(l,i){n=l},d(l){l&&y(e),r=!1,t()}}}function Ca(n){let e=n[13].name+"",r,t,o=n[13].description+"",l,i,a,s=et[n[13].name]&&Aa(n);return{c(){r=O(e),t=O(": "),l=O(o),i=L(),s&&s.c(),a=L()},m(u,c){v(u,r,c),v(u,t,c),v(u,l,c),v(u,i,c),s&&s.m(u,c),v(u,a,c)},p(u,c){et[u[13].name]&&s.p(u,c)},d(u){u&&(y(r),y(t),y(l),y(i),y(a)),s&&s.d(u)}}}function kr(n){let e,r,t;function o(i){n[11](i,n[15])}let l={k:"horiz-radio",choices:n[13].choices,$$slots:{default:[Ca]},$$scope:{ctx:n}};return n[1].links[n[0]].properties.answers[n[15]]!==void 0&&(l.value=n[1].links[n[0]].properties.answers[n[15]]),e=new Je({props:l}),pe.push(()=>ke(e,"value",o)),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,a){n=i;const s={};a&65540&&(s.$$scope={dirty:a,ctx:n}),!r&&a&3&&(r=!0,s.value=n[1].links[n[0]].properties.answers[n[15]],we(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function ja(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,j,M=!n[3]&&$r(),_=x(Be),$=[];for(let b=0;b<_.length;b+=1)$[b]=kr(br(n,_,b));const C=b=>A($[b],1,1,()=>{$[b]=null});return{c(){e=k("div"),r=k("button"),t=O("Done"),l=L(),i=k("button"),i.textContent="Delete link",a=L(),M&&M.c(),s=L(),u=k("label"),c=O(`Name:
      `),f=k("input"),d=L();for(let b=0;b<$.length;b+=1)$[b].c();r.disabled=o=!n[3],F(f,"type","text"),F(e,"slot","sidebar")},m(b,S){v(b,e,S),g(e,r),g(r,t),g(e,l),g(e,i),g(e,a),M&&M.m(e,null),g(e,s),g(e,u),g(u,c),g(u,f),ve(f,n[1].links[n[0]].properties.name),g(e,d);for(let w=0;w<$.length;w+=1)$[w]&&$[w].m(e,null);p=!0,m||(j=[R(r,"click",n[8]),R(i,"click",n[6]),R(f,"input",n[9])],m=!0)},p(b,S){if((!p||S&8&&o!==(o=!b[3]))&&(r.disabled=o),b[3]?M&&(M.d(1),M=null):M||(M=$r(),M.c(),M.m(e,s)),S&3&&f.value!==b[1].links[b[0]].properties.name&&ve(f,b[1].links[b[0]].properties.name),S&7){_=x(Be);let w;for(w=0;w<_.length;w+=1){const z=br(b,_,w);$[w]?($[w].p(z,S),h($[w],1)):($[w]=kr(z),$[w].c(),h($[w],1),$[w].m(e,null))}for(ue(),w=_.length;w<$.length;w+=1)C(w);fe()}},i(b){if(!p){for(let S=0;S<_.length;S+=1)h($[S]);p=!0}},o(b){$=$.filter(Boolean);for(let S=0;S<$.length;S+=1)A($[S]);p=!1},d(b){b&&y(e),M&&M.d(),ge($,b),m=!1,ze(j)}}}function Sa(n){let e,r;return e=new Te({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function za(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"links"}}),o=new Ae({props:{data:me(n[1].links),generateId:!0,$$slots:{default:[Sa]},$$scope:{ctx:n}}});function u(f){n[7](f)}let c={};return n[1].links[n[0]]!==void 0&&(c.f=n[1].links[n[0]]),i=new uo({props:c}),pe.push(()=>ke(i,"f",u)),{c(){e=k("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){v(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].links)),d&65537&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};!a&&d&3&&(a=!0,m.f=f[1].links[f[0]],we(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){A(r.$$.fragment,f),A(o.$$.fragment,f),A(i.$$.fragment,f),s=!1},d(f){f&&y(e),D(r),D(o),D(i)}}}function wr(n){let e,r;return e=new Rt({props:{$$slots:{default:[La]},$$scope:{ctx:n}}}),e.$on("close",n[12]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&65540&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function La(n){let e,r=n[2].description+"",t,o,l,i;return l=new dt({props:{metric:n[2]}}),{c(){e=k("p"),t=O(r),o=L(),B(l.$$.fragment)},m(a,s){v(a,e,s),g(e,t),v(a,o,s),E(l,a,s),i=!0},p(a,s){(!i||s&4)&&r!==(r=a[2].description+"")&&le(t,r);const u={};s&4&&(u.metric=a[2]),l.$set(u)},i(a){i||(h(l.$$.fragment,a),i=!0)},o(a){A(l.$$.fragment,a),i=!1},d(a){a&&(y(e),y(o)),D(l,a)}}}function Ma(n){let e,r,t,o,l,i;e=new Ue({props:{$$slots:{map:[za],sidebar:[ja]},$$scope:{ctx:n}}});let a=n[2]&&wr(n);return{c(){B(e.$$.fragment),r=L(),a&&a.c(),t=Ge()},m(s,u){E(e,s,u),v(s,r,u),a&&a.m(s,u),v(s,t,u),o=!0,l||(i=R(ya,"keydown",n[5]),l=!0)},p(s,[u]){const c={};u&65567&&(c.$$scope={dirty:u,ctx:s}),e.$set(c),s[2]?a?(a.p(s,u),u&4&&h(a,1)):(a=wr(s),a.c(),h(a,1),a.m(t.parentNode,t)):a&&(ue(),A(a,1,1,()=>{a=null}),fe())},i(s){o||(h(e.$$.fragment,s),h(a),o=!0)},o(s){A(e.$$.fragment,s),A(a),o=!1},d(s){s&&(y(r),y(t)),D(e,s),a&&a.d(s),l=!1,i()}}}function Ba(n,e,r){let t,o,l;te(n,G,M=>r(1,o=M)),te(n,W,M=>r(4,l=M));let{idx:i}=e,a=null;function s(M){M.key=="Escape"&&t&&K(W,l={kind:"neutral"},l)}async function u(){window.confirm("Really delete this link?")&&(K(W,l={kind:"neutral"},l),await ot(),o.links.splice(i,1),G.set(o))}function c(M){n.$$.not_equal(o.links[i],M)&&(o.links[i]=M,G.set(o))}const f=()=>K(W,l={kind:"neutral"},l);function d(){o.links[i].properties.name=this.value,G.set(o)}const p=M=>r(2,a=et[M.name]);function m(M,_){n.$$.not_equal(o.links[i].properties.answers[_],M)&&(o.links[i].properties.answers[_]=M,G.set(o))}const j=()=>r(2,a=null);return n.$$set=M=>{"idx"in M&&r(0,i=M.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(3,t=o.links[i].geometry.coordinates.length>=2)},[i,o,a,t,l,s,u,c,f,d,p,m,j]}class Ea extends se{constructor(e){super(),ae(this,e,Ba,Ma,ie,{idx:0})}}function vr(n,e,r){const t=n.slice();return t[7]=e[r],t[8]=e,t[9]=r,t}function Da(n){let e;return{c(){e=k("p"),e.textContent=`${n[3].description}`},m(r,t){v(r,e,t)},p:ee,d(r){r&&y(e)}}}function yr(n){let e,r,t=n[7].properties.name+"",o,l,i,a,s,u;function c(d){n[6](d,n[7])}let f={k:"horiz-radio",choices:Be[n[0]].choices};return n[7].properties.answers[n[0]]!==void 0&&(f.value=n[7].properties.answers[n[0]]),i=new Je({props:f}),pe.push(()=>ke(i,"value",c)),{c(){e=k("li"),r=k("span"),o=O(t),l=L(),B(i.$$.fragment),s=L(),Y(r,"color",n[7].properties.color)},m(d,p){v(d,e,p),g(e,r),g(r,o),g(e,l),E(i,e,null),g(e,s),u=!0},p(d,p){n=d,(!u||p&4)&&t!==(t=n[7].properties.name+"")&&le(o,t),p&4&&Y(r,"color",n[7].properties.color);const m={};p&1&&(m.choices=Be[n[0]].choices),!a&&p&5&&(a=!0,m.value=n[7].properties.answers[n[0]],we(()=>a=!1)),i.$set(m)},i(d){u||(h(i.$$.fragment,d),u=!0)},o(d){A(i.$$.fragment,d),u=!1},d(d){d&&y(e),D(i)}}}function Ta(n){let e,r;return e=new dt({props:{metric:n[3]}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Na(n){let e,r,t,o,l=Be[n[0]].name+"",i,a,s=Be[n[0]].description+"",u,c,f,d,p,m,j,M,_=n[3]&&Da(n),$=x(n[2].links),C=[];for(let w=0;w<$.length;w+=1)C[w]=yr(vr(n,$,w));const b=w=>A(C[w],1,1,()=>{C[w]=null});let S=n[3]&&Ta(n);return{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("h2"),i=O(l),a=O(": "),u=O(s),c=L(),_&&_.c(),f=L(),d=k("ol");for(let w=0;w<C.length;w+=1)C[w].c();p=L(),S&&S.c(),F(e,"slot","sidebar")},m(w,z){v(w,e,z),g(e,r),g(e,t),g(e,o),g(o,i),g(o,a),g(o,u),g(e,c),_&&_.m(e,null),g(e,f),g(e,d);for(let N=0;N<C.length;N+=1)C[N]&&C[N].m(d,null);g(e,p),S&&S.m(e,null),m=!0,j||(M=R(r,"click",n[5]),j=!0)},p(w,z){if((!m||z&1)&&l!==(l=Be[w[0]].name+"")&&le(i,l),(!m||z&1)&&s!==(s=Be[w[0]].description+"")&&le(u,s),w[3]&&_.p(w,z),z&5){$=x(w[2].links);let N;for(N=0;N<$.length;N+=1){const q=vr(w,$,N);C[N]?(C[N].p(q,z),h(C[N],1)):(C[N]=yr(q),C[N].c(),h(C[N],1),C[N].m(d,null))}for(ue(),N=$.length;N<C.length;N+=1)b(N);fe()}w[3]&&S.p(w,z)},i(w){if(!m){for(let z=0;z<$.length;z+=1)h(C[z]);h(S),m=!0}},o(w){C=C.filter(Boolean);for(let z=0;z<C.length;z+=1)A(C[z]);A(S),m=!1},d(w){w&&y(e),_&&_.d(),ge(C,w),S&&S.d(),j=!1,M()}}}function Ia(n){let e,r,t;return r=new We({props:{showColor:"links",except:""}}),{c(){e=k("div"),B(r.$$.fragment),F(e,"slot","map")},m(o,l){v(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){A(r.$$.fragment,o),t=!1},d(o){o&&y(e),D(r)}}}function Oa(n){let e,r,t,o;return e=new Ue({props:{$$slots:{map:[Ia],sidebar:[Na]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=R(window,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l),t=!1,o()}}}function Fa(n,e,r){let t,o;te(n,W,c=>r(1,t=c)),te(n,G,c=>r(2,o=c));let{qIdx:l}=e,i=et[Be[l].name];function a(c){c.key=="Escape"&&K(W,t={kind:"neutral"},t)}const s=()=>K(W,t={kind:"neutral"},t);function u(c,f){n.$$.not_equal(f.properties.answers[l],c)&&(f.properties.answers[l]=c,G.set(o))}return n.$$set=c=>{"qIdx"in c&&r(0,l=c.qIdx)},[l,t,o,i,a,s,u]}class qa extends se{constructor(e){super(),ae(this,e,Fa,Oa,ie,{qIdx:0})}}function Pa(n){let e,r,t,o;const l=n[2].default,i=Oe(l,n,n[1],null);return{c(){e=k("a"),i&&i.c(),F(e,"href","#"),Y(e,"color",n[0])},m(a,s){v(a,e,s),i&&i.m(e,null),r=!0,t||(o=R(e,"click",Oo(n[3])),t=!0)},p(a,[s]){i&&i.p&&(!r||s&2)&&Fe(i,l,a,a[1],r?Pe(l,a[1],s,null):qe(a[1]),null),s&1&&Y(e,"color",a[0])},i(a){r||(h(i,a),r=!0)},o(a){A(i,a),r=!1},d(a){a&&y(e),i&&i.d(a),t=!1,o()}}}function Ua(n,e,r){let{$$slots:t={},$$scope:o}=e,{color:l=void 0}=e;function i(a){Me.call(this,n,a)}return n.$$set=a=>{"color"in a&&r(0,l=a.color),"$$scope"in a&&r(1,o=a.$$scope)},[l,o,t,i]}class nt extends se{constructor(e){super(),ae(this,e,Ua,Pa,ie,{color:0})}}function Ar(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function Ra(n){let e;return{c(){e=O(`ST20
  `)},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Ja(n){let e=n[5].properties.name+"",r;return{c(){r=O(e)},m(t,o){v(t,r,o)},p(t,o){o&2&&e!==(e=t[5].properties.name+"")&&le(r,e)},d(t){t&&y(r)}}}function Cr(n){let e,r,t,o;function l(){return n[4](n[7])}return r=new nt({props:{color:n[5].properties.color,$$slots:{default:[Ja]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),B(r.$$.fragment),t=L()},m(i,a){v(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[5].properties.color),a&258&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){A(r.$$.fragment,i),o=!1},d(i){i&&y(e),D(r)}}}function Ga(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,j;i=new nt({props:{$$slots:{default:[Ra]},$$scope:{ctx:n}}}),i.$on("click",n[3]);let M=x(n[1].bus_stops),_=[];for(let C=0;C<M.length;C+=1)_[C]=Cr(Ar(n,M,C));const $=C=>A(_[C],1,1,()=>{_[C]=null});return{c(){e=O(`Bus stops:

`),r=k("div"),t=k("button"),t.textContent="New bus stop",o=L(),l=k("div"),B(i.$$.fragment),a=O(`:
  `),s=k("progress"),f=L(),d=k("ol");for(let C=0;C<_.length;C+=1)_[C].c();s.value=u=n[1].bus_stops.filter(jr).length,F(s,"max",c=n[1].bus_stops.length),F(s,"class","svelte-zadug4")},m(C,b){v(C,e,b),v(C,r,b),g(r,t),v(C,o,b),v(C,l,b),E(i,l,null),g(l,a),g(l,s),v(C,f,b),v(C,d,b);for(let S=0;S<_.length;S+=1)_[S]&&_[S].m(d,null);p=!0,m||(j=R(t,"click",n[2]),m=!0)},p(C,[b]){const S={};if(b&256&&(S.$$scope={dirty:b,ctx:C}),i.$set(S),(!p||b&2&&u!==(u=C[1].bus_stops.filter(jr).length))&&(s.value=u),(!p||b&2&&c!==(c=C[1].bus_stops.length))&&F(s,"max",c),b&3){M=x(C[1].bus_stops);let w;for(w=0;w<M.length;w+=1){const z=Ar(C,M,w);_[w]?(_[w].p(z,b),h(_[w],1)):(_[w]=Cr(z),_[w].c(),h(_[w],1),_[w].m(d,null))}for(ue(),w=M.length;w<_.length;w+=1)$(w);fe()}},i(C){if(!p){h(i.$$.fragment,C);for(let b=0;b<M.length;b+=1)h(_[b]);p=!0}},o(C){A(i.$$.fragment,C),_=_.filter(Boolean);for(let b=0;b<_.length;b+=1)A(_[b]);p=!1},d(C){C&&(y(e),y(r),y(o),y(l),y(f),y(d)),D(i),ge(_,C),m=!1,j()}}}const jr=n=>n.properties.st20!="";function Qa(n,e,r){let t,o;return te(n,W,s=>r(0,t=s)),te(n,G,s=>r(1,o=s)),[t,o,()=>K(W,t={kind:"new-point",obj:"bus stop"},t),()=>K(W,t={kind:"bus-stop-questions"},t),s=>K(W,t={kind:"edit-bus-stop",idx:s},t)]}let Ha=class extends se{constructor(e){super(),ae(this,e,Qa,Ga,ie,{})}};function Sr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Ka(n){let e=n[4].properties.name+"",r;return{c(){r=O(e)},m(t,o){v(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&le(r,e)},d(t){t&&y(r)}}}function zr(n){let e,r,t,o;function l(){return n[3](n[6])}return r=new nt({props:{color:n[4].properties.color,$$slots:{default:[Ka]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),B(r.$$.fragment),t=L()},m(i,a){v(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[4].properties.color),a&130&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){A(r.$$.fragment,i),o=!1},d(i){i&&y(e),D(r)}}}function Wa(n){let e,r,t,o,l,i,a,s,u=x(n[1].crossings),c=[];for(let d=0;d<u.length;d+=1)c[d]=zr(Sr(n,u,d));const f=d=>A(c[d],1,1,()=>{c[d]=null});return{c(){e=O(`Crossings:

`),r=k("div"),t=k("button"),t.textContent="New crossing",o=L(),l=k("ol");for(let d=0;d<c.length;d+=1)c[d].c()},m(d,p){v(d,e,p),v(d,r,p),g(r,t),v(d,o,p),v(d,l,p);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(l,null);i=!0,a||(s=R(t,"click",n[2]),a=!0)},p(d,[p]){if(p&3){u=x(d[1].crossings);let m;for(m=0;m<u.length;m+=1){const j=Sr(d,u,m);c[m]?(c[m].p(j,p),h(c[m],1)):(c[m]=zr(j),c[m].c(),h(c[m],1),c[m].m(l,null))}for(ue(),m=u.length;m<c.length;m+=1)f(m);fe()}},i(d){if(!i){for(let p=0;p<u.length;p+=1)h(c[p]);i=!0}},o(d){c=c.filter(Boolean);for(let p=0;p<c.length;p+=1)A(c[p]);i=!1},d(d){d&&(y(e),y(r),y(o),y(l)),ge(c,d),a=!1,s()}}}function Za(n,e,r){let t,o;return te(n,W,a=>r(0,t=a)),te(n,G,a=>r(1,o=a)),[t,o,()=>K(W,t={kind:"new-point",obj:"crossing"},t),a=>K(W,t={kind:"edit-crossing",idx:a},t)]}let Xa=class extends se{constructor(e){super(),ae(this,e,Za,Wa,ie,{})}};function Lr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Va(n){let e=n[4].properties.name+"",r;return{c(){r=O(e)},m(t,o){v(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&le(r,e)},d(t){t&&y(r)}}}function Mr(n){let e,r,t,o;function l(){return n[3](n[6])}return r=new nt({props:{color:n[4].properties.color,$$slots:{default:[Va]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),B(r.$$.fragment),t=L()},m(i,a){v(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[4].properties.color),a&130&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){A(r.$$.fragment,i),o=!1},d(i){i&&y(e),D(r)}}}function Ya(n){let e,r,t,o,l,i,a,s,u=x(n[1].jats),c=[];for(let d=0;d<u.length;d+=1)c[d]=Mr(Lr(n,u,d));const f=d=>A(c[d],1,1,()=>{c[d]=null});return{c(){e=O(`JATs:

`),r=k("div"),t=k("button"),t.textContent="New JAT",o=L(),l=k("ol");for(let d=0;d<c.length;d+=1)c[d].c()},m(d,p){v(d,e,p),v(d,r,p),g(r,t),v(d,o,p),v(d,l,p);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(l,null);i=!0,a||(s=R(t,"click",n[2]),a=!0)},p(d,[p]){if(p&3){u=x(d[1].jats);let m;for(m=0;m<u.length;m+=1){const j=Lr(d,u,m);c[m]?(c[m].p(j,p),h(c[m],1)):(c[m]=Mr(j),c[m].c(),h(c[m],1),c[m].m(l,null))}for(ue(),m=u.length;m<c.length;m+=1)f(m);fe()}},i(d){if(!i){for(let p=0;p<u.length;p+=1)h(c[p]);i=!0}},o(d){c=c.filter(Boolean);for(let p=0;p<c.length;p+=1)A(c[p]);i=!1},d(d){d&&(y(e),y(r),y(o),y(l)),ge(c,d),a=!1,s()}}}function xa(n,e,r){let t,o;return te(n,W,a=>r(0,t=a)),te(n,G,a=>r(1,o=a)),[t,o,()=>K(W,t={kind:"new-point",obj:"jat"},t),a=>K(W,t={kind:"edit-jat",idx:a},t)]}let ec=class extends se{constructor(e){super(),ae(this,e,xa,Ya,ie,{})}};function Br(n,e,r){const t=n.slice();return t[2]=e[r],t[4]=r,t}function Er(n,e,r){const t=n.slice();t[5]=e[r];const o=t[5].properties.answers[t[4]];return t[6]=o,t}function Dr(n,e,r){const t=n.slice();return t[5]=e[r],t}function Tr(n){let e,r=n[5].properties.name+"",t;return{c(){e=k("th"),t=O(r),Y(e,"color",n[5].properties.color)},m(o,l){v(o,e,l),g(e,t)},p(o,l){l&1&&r!==(r=o[5].properties.name+"")&&le(t,r),l&1&&Y(e,"color",o[5].properties.color)},d(o){o&&y(e)}}}function Nr(n){let e,r=n[6]+"",t;return{c(){e=k("td"),t=O(r),Y(e,"background",n[6]==""?"red":"green")},m(o,l){v(o,e,l),g(e,t)},p(o,l){l&1&&r!==(r=o[6]+"")&&le(t,r),l&1&&Y(e,"background",o[6]==""?"red":"green")},d(o){o&&y(e)}}}function Ir(n){let e,r,t,o,l=x(n[0].links),i=[];for(let a=0;a<l.length;a+=1)i[a]=Nr(Er(n,l,a));return{c(){e=k("tr"),r=k("th"),r.textContent=`${n[2].name}`,t=L();for(let a=0;a<i.length;a+=1)i[a].c();o=L()},m(a,s){v(a,e,s),g(e,r),g(e,t);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);g(e,o)},p(a,s){if(s&1){l=x(a[0].links);let u;for(u=0;u<l.length;u+=1){const c=Er(a,l,u);i[u]?i[u].p(c,s):(i[u]=Nr(c),i[u].c(),i[u].m(e,o))}for(;u<i.length;u+=1)i[u].d(1);i.length=l.length}},d(a){a&&y(e),ge(i,a)}}}function tc(n){let e,r,t,o,l,i,a,s=x(n[0].links),u=[];for(let d=0;d<s.length;d+=1)u[d]=Tr(Dr(n,s,d));let c=x(Be),f=[];for(let d=0;d<c.length;d+=1)f[d]=Ir(Br(n,c,d));return{c(){e=k("table"),r=k("thead"),t=k("tr"),o=k("th"),l=L();for(let d=0;d<u.length;d+=1)u[d].c();i=L(),a=k("tbody");for(let d=0;d<f.length;d+=1)f[d].c()},m(d,p){v(d,e,p),g(e,r),g(r,t),g(t,o),g(t,l);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(t,null);g(e,i),g(e,a);for(let m=0;m<f.length;m+=1)f[m]&&f[m].m(a,null)},p(d,p){if(p&1){s=x(d[0].links);let m;for(m=0;m<s.length;m+=1){const j=Dr(d,s,m);u[m]?u[m].p(j,p):(u[m]=Tr(j),u[m].c(),u[m].m(t,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=s.length}if(p&1){c=x(Be);let m;for(m=0;m<c.length;m+=1){const j=Br(d,c,m);f[m]?f[m].p(j,p):(f[m]=Ir(j),f[m].c(),f[m].m(a,null))}for(;m<f.length;m+=1)f[m].d(1);f.length=c.length}},d(d){d&&y(e),ge(u,d),ge(f,d)}}}function nc(n){let e,r;return e=new Rt({props:{$$slots:{default:[tc]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,[o]){const l={};o&2049&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function rc(n,e,r){let t;te(n,G,l=>r(0,t=l));function o(l){Me.call(this,n,l)}return[t,o]}class oc extends se{constructor(e){super(),ae(this,e,rc,nc,ie,{})}}function Or(n,e,r){const t=n.slice();return t[9]=e[r],t[11]=r,t}function Fr(n,e,r){const t=n.slice();return t[12]=e[r],t[11]=r,t}function qr(n){let e,r;return e=new oc({}),e.$on("close",n[4]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function lc(n){let e=n[12].properties.name+"",r;return{c(){r=O(e)},m(t,o){v(t,r,o)},p(t,o){o&2&&e!==(e=t[12].properties.name+"")&&le(r,e)},d(t){t&&y(r)}}}function Pr(n){let e,r,t,o;function l(){return n[6](n[11])}return r=new nt({props:{color:n[12].properties.color,$$slots:{default:[lc]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),B(r.$$.fragment),t=L()},m(i,a){v(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[12].properties.color),a&16386&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){A(r.$$.fragment,i),o=!1},d(i){i&&y(e),D(r)}}}function ic(n){let e=n[9].name+"",r,t;return{c(){r=O(e),t=L()},m(o,l){v(o,r,l),v(o,t,l)},p:ee,d(o){o&&(y(r),y(t))}}}function Ur(n){let e,r,t,o,l,i,a,s;function u(){return n[7](n[11])}r=new nt({props:{$$slots:{default:[ic]},$$scope:{ctx:n}}}),r.$on("click",u);function c(...f){return n[8](n[11],...f)}return{c(){e=k("li"),B(r.$$.fragment),t=O(`:
      `),o=k("progress"),a=L(),o.value=l=n[1].links.filter(c).length,F(o,"max",i=n[1].links.length),F(o,"class","svelte-zadug4")},m(f,d){v(f,e,d),E(r,e,null),g(e,t),g(e,o),g(e,a),s=!0},p(f,d){n=f;const p={};d&16384&&(p.$$scope={dirty:d,ctx:n}),r.$set(p),(!s||d&2&&l!==(l=n[1].links.filter(c).length))&&(o.value=l),(!s||d&2&&i!==(i=n[1].links.length))&&F(o,"max",i)},i(f){s||(h(r.$$.fragment,f),s=!0)},o(f){A(r.$$.fragment,f),s=!1},d(f){f&&y(e),D(r)}}}function sc(n){let e,r,t,o,l,i,a,s,u,c,f,d,p=n[0]&&qr(n),m=x(n[1].links),j=[];for(let b=0;b<m.length;b+=1)j[b]=Pr(Fr(n,m,b));const M=b=>A(j[b],1,1,()=>{j[b]=null});let _=x(Be),$=[];for(let b=0;b<_.length;b+=1)$[b]=Ur(Or(n,_,b));const C=b=>A($[b],1,1,()=>{$[b]=null});return{c(){p&&p.c(),e=L(),r=k("div"),t=k("button"),t.textContent="New link",o=L(),l=k("button"),l.textContent="Table of questions",i=O(`

Links:
`),a=k("ol");for(let b=0;b<j.length;b+=1)j[b].c();s=O(`

Questions:
`),u=k("ol");for(let b=0;b<$.length;b+=1)$[b].c()},m(b,S){p&&p.m(b,S),v(b,e,S),v(b,r,S),g(r,t),g(r,o),g(r,l),v(b,i,S),v(b,a,S);for(let w=0;w<j.length;w+=1)j[w]&&j[w].m(a,null);v(b,s,S),v(b,u,S);for(let w=0;w<$.length;w+=1)$[w]&&$[w].m(u,null);c=!0,f||(d=[R(t,"click",n[3]),R(l,"click",n[5])],f=!0)},p(b,[S]){if(b[0]?p?(p.p(b,S),S&1&&h(p,1)):(p=qr(b),p.c(),h(p,1),p.m(e.parentNode,e)):p&&(ue(),A(p,1,1,()=>{p=null}),fe()),S&6){m=x(b[1].links);let w;for(w=0;w<m.length;w+=1){const z=Fr(b,m,w);j[w]?(j[w].p(z,S),h(j[w],1)):(j[w]=Pr(z),j[w].c(),h(j[w],1),j[w].m(a,null))}for(ue(),w=m.length;w<j.length;w+=1)M(w);fe()}if(S&6){_=x(Be);let w;for(w=0;w<_.length;w+=1){const z=Or(b,_,w);$[w]?($[w].p(z,S),h($[w],1)):($[w]=Ur(z),$[w].c(),h($[w],1),$[w].m(u,null))}for(ue(),w=_.length;w<$.length;w+=1)C(w);fe()}},i(b){if(!c){h(p);for(let S=0;S<m.length;S+=1)h(j[S]);for(let S=0;S<_.length;S+=1)h($[S]);c=!0}},o(b){A(p),j=j.filter(Boolean);for(let S=0;S<j.length;S+=1)A(j[S]);$=$.filter(Boolean);for(let S=0;S<$.length;S+=1)A($[S]);c=!1},d(b){b&&(y(e),y(r),y(i),y(a),y(s),y(u)),p&&p.d(b),ge(j,b),ge($,b),f=!1,ze(d)}}}function ac(n,e,r){let t,o;te(n,G,d=>r(1,t=d)),te(n,W,d=>r(2,o=d));let l=!1;function i(){let d=lo(t.links.length);K(G,t.links=[...t.links,d],t),K(W,o={kind:"edit-link",idx:t.links.length-1},o)}return[l,t,o,i,()=>r(0,l=!1),()=>r(0,l=!0),d=>K(W,o={kind:"edit-link",idx:d},o),d=>K(W,o={kind:"link-questions",idx:d},o),(d,p)=>p.properties.answers[d]!=""]}let cc=class extends se{constructor(e){super(),ae(this,e,ac,sc,ie,{})}};function Rr(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function uc(n){let e;return{c(){e=O(`SA01
  `)},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function fc(n){let e=n[5].properties.name+"",r;return{c(){r=O(e)},m(t,o){v(t,r,o)},p(t,o){o&1&&e!==(e=t[5].properties.name+"")&&le(r,e)},d(t){t&&y(r)}}}function Jr(n){let e,r,t,o;function l(){return n[4](n[7])}return r=new nt({props:{color:n[5].properties.color,$$slots:{default:[fc]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),B(r.$$.fragment),t=L()},m(i,a){v(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){A(r.$$.fragment,i),o=!1},d(i){i&&y(e),D(r)}}}function dc(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,j;i=new nt({props:{$$slots:{default:[uc]},$$scope:{ctx:n}}}),i.$on("click",n[3]);let M=x(n[0].side_roads),_=[];for(let C=0;C<M.length;C+=1)_[C]=Jr(Rr(n,M,C));const $=C=>A(_[C],1,1,()=>{_[C]=null});return{c(){e=O(`Side roads:

`),r=k("div"),t=k("button"),t.textContent="New side road",o=L(),l=k("div"),B(i.$$.fragment),a=O(`:
  `),s=k("progress"),f=L(),d=k("ol");for(let C=0;C<_.length;C+=1)_[C].c();s.value=u=n[0].side_roads.filter(Gr).length,F(s,"max",c=n[0].side_roads.length),F(s,"class","svelte-zadug4")},m(C,b){v(C,e,b),v(C,r,b),g(r,t),v(C,o,b),v(C,l,b),E(i,l,null),g(l,a),g(l,s),v(C,f,b),v(C,d,b);for(let S=0;S<_.length;S+=1)_[S]&&_[S].m(d,null);p=!0,m||(j=R(t,"click",n[2]),m=!0)},p(C,[b]){const S={};if(b&256&&(S.$$scope={dirty:b,ctx:C}),i.$set(S),(!p||b&1&&u!==(u=C[0].side_roads.filter(Gr).length))&&(s.value=u),(!p||b&1&&c!==(c=C[0].side_roads.length))&&F(s,"max",c),b&3){M=x(C[0].side_roads);let w;for(w=0;w<M.length;w+=1){const z=Rr(C,M,w);_[w]?(_[w].p(z,b),h(_[w],1)):(_[w]=Jr(z),_[w].c(),h(_[w],1),_[w].m(d,null))}for(ue(),w=M.length;w<_.length;w+=1)$(w);fe()}},i(C){if(!p){h(i.$$.fragment,C);for(let b=0;b<M.length;b+=1)h(_[b]);p=!0}},o(C){A(i.$$.fragment,C),_=_.filter(Boolean);for(let b=0;b<_.length;b+=1)A(_[b]);p=!1},d(C){C&&(y(e),y(r),y(o),y(l),y(f),y(d)),D(i),ge(_,C),m=!1,j()}}}const Gr=n=>n.properties.sa01!="";function pc(n,e,r){let t,o;te(n,G,s=>r(0,t=s)),te(n,W,s=>r(1,o=s));function l(){let s=io(t.side_roads.length);K(G,t.side_roads=[...t.side_roads,s],t),K(W,o={kind:"edit-side-road",idx:t.side_roads.length-1},o)}return[t,o,l,()=>K(W,o={kind:"side-road-questions"},o),s=>K(W,o={kind:"edit-side-road",idx:s},o)]}class mc extends se{constructor(e){super(),ae(this,e,pc,dc,ie,{})}}function gc(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,j,M,_,$,C,b,S,w,z,N,q,Z,V,T,Q,I,_e,he;return p=new cc({}),_=new ec({}),S=new Ha({}),q=new Xa({}),Q=new mc({}),{c(){e=k("div"),r=k("div"),t=k("button"),t.textContent="Load file",o=L(),l=k("button"),l.textContent="Download",i=L(),a=k("button"),a.textContent="Clear",s=L(),u=k("button"),u.textContent="Draw an entire route",c=L(),f=k("hr"),d=L(),B(p.$$.fragment),m=L(),j=k("hr"),M=L(),B(_.$$.fragment),$=L(),C=k("hr"),b=L(),B(S.$$.fragment),w=L(),z=k("hr"),N=L(),B(q.$$.fragment),Z=L(),V=k("hr"),T=L(),B(Q.$$.fragment),F(t,"class","secondary"),F(l,"class","secondary"),F(a,"class","secondary"),F(e,"slot","sidebar")},m(P,X){v(P,e,X),g(e,r),g(r,t),g(r,o),g(r,l),g(r,i),g(r,a),g(e,s),g(e,u),g(e,c),g(e,f),g(e,d),E(p,e,null),g(e,m),g(e,j),g(e,M),E(_,e,null),g(e,$),g(e,C),g(e,b),E(S,e,null),g(e,w),g(e,z),g(e,N),E(q,e,null),g(e,Z),g(e,V),g(e,T),E(Q,e,null),I=!0,_e||(he=[R(t,"click",n[12]),R(l,"click",n[13]),R(a,"click",n[5]),R(u,"click",n[6])],_e=!0)},p:ee,i(P){I||(h(p.$$.fragment,P),h(_.$$.fragment,P),h(S.$$.fragment,P),h(q.$$.fragment,P),h(Q.$$.fragment,P),I=!0)},o(P){A(p.$$.fragment,P),A(_.$$.fragment,P),A(S.$$.fragment,P),A(q.$$.fragment,P),A(Q.$$.fragment,P),I=!1},d(P){P&&y(e),D(p),D(_),D(S),D(q),D(Q),_e=!1,ze(he)}}}function _c(n){let e,r;return e=new Te({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":vt(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[7]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function hc(n){let e,r;return e=new tt({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":vt(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[8]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function bc(n){let e,r;return e=new lt({props:{manageHoverState:!0,layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[9]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function $c(n){let e,r;return e=new lt({props:{manageHoverState:!0,layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[10]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function kc(n){let e,r;return e=new Te({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":vt(3,6)},hoverCursor:"pointer"}}),e.$on("click",n[11]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function wc(n){let e,r,t,o,l,i,a,s,u,c,f;return r=new Ae({props:{data:me(n[2].links),generateId:!0,$$slots:{default:[_c]},$$scope:{ctx:n}}}),o=new Ae({props:{data:me(n[2].jats),generateId:!0,$$slots:{default:[hc]},$$scope:{ctx:n}}}),i=new Ae({props:{data:me(n[2].bus_stops),generateId:!0,$$slots:{default:[bc]},$$scope:{ctx:n}}}),s=new Ae({props:{data:me(n[2].crossings),generateId:!0,$$slots:{default:[$c]},$$scope:{ctx:n}}}),c=new Ae({props:{data:me(n[2].side_roads),generateId:!0,$$slots:{default:[kc]},$$scope:{ctx:n}}}),{c(){e=k("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),a=L(),B(s.$$.fragment),u=L(),B(c.$$.fragment),F(e,"slot","map")},m(d,p){v(d,e,p),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),g(e,a),E(s,e,null),g(e,u),E(c,e,null),f=!0},p(d,p){const m={};p&4&&(m.data=me(d[2].links)),p&131080&&(m.$$scope={dirty:p,ctx:d}),r.$set(m);const j={};p&4&&(j.data=me(d[2].jats)),p&131080&&(j.$$scope={dirty:p,ctx:d}),o.$set(j);const M={};p&4&&(M.data=me(d[2].bus_stops)),p&131080&&(M.$$scope={dirty:p,ctx:d}),i.$set(M);const _={};p&4&&(_.data=me(d[2].crossings)),p&131080&&(_.$$scope={dirty:p,ctx:d}),s.$set(_);const $={};p&4&&($.data=me(d[2].side_roads)),p&131080&&($.$$scope={dirty:p,ctx:d}),c.$set($)},i(d){f||(h(r.$$.fragment,d),h(o.$$.fragment,d),h(i.$$.fragment,d),h(s.$$.fragment,d),h(c.$$.fragment,d),f=!0)},o(d){A(r.$$.fragment,d),A(o.$$.fragment,d),A(i.$$.fragment,d),A(s.$$.fragment,d),A(c.$$.fragment,d),f=!1},d(d){d&&y(e),D(r),D(o),D(i),D(s),D(c)}}}function Qr(n){let e,r;return e=new Rt({props:{$$slots:{default:[vc]},$$scope:{ctx:n}}}),e.$on("close",n[15]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&131074&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function vc(n){let e,r,t,o,l;return{c(){e=k("h1"),e.textContent="Load a file previously downloaded from this tool",r=L(),t=k("input"),F(t,"type","file")},m(i,a){v(i,e,a),v(i,r,a),v(i,t,a),n[14](t),o||(l=R(t,"change",n[4]),o=!0)},p:ee,d(i){i&&(y(e),y(r),y(t)),n[14](null),o=!1,l()}}}function yc(n){let e,r,t,o;e=new Ue({props:{$$slots:{map:[wc],sidebar:[gc]},$$scope:{ctx:n}}});let l=n[0]&&Qr(n);return{c(){B(e.$$.fragment),r=L(),l&&l.c(),t=Ge()},m(i,a){E(e,i,a),v(i,r,a),l&&l.m(i,a),v(i,t,a),o=!0},p(i,[a]){const s={};a&131085&&(s.$$scope={dirty:a,ctx:i}),e.$set(s),i[0]?l?(l.p(i,a),a&1&&h(l,1)):(l=Qr(i),l.c(),h(l,1),l.m(t.parentNode,t)):l&&(ue(),A(l,1,1,()=>{l=null}),fe())},i(i){o||(h(e.$$.fragment,i),h(l),o=!0)},o(i){A(e.$$.fragment,i),A(l),o=!1},d(i){i&&(y(r),y(t)),D(e,i),l&&l.d(i)}}}function Ac(n,e,r){let t,o,l;te(n,Ot,b=>r(16,t=b)),te(n,G,b=>r(2,o=b)),te(n,W,b=>r(3,l=b));let i=!1,a;async function s(b){try{let S=JSON.parse(await a.files[0].text());if(to(S)){K(G,o=S,o),r(0,i=!1);return}}catch{}window.alert("Something's wrong with that file")}function u(){K(G,o.links=[],o),K(G,o.jats=[],o),K(G,o.bus_stops=[],o),K(G,o.crossings=[],o),K(G,o.side_roads=[],o)}async function c(){await Ii(t)}const f=b=>K(W,l={kind:"edit-link",idx:b.detail.features[0].id},l),d=b=>K(W,l={kind:"edit-jat",idx:b.detail.features[0].id},l),p=b=>K(W,l={kind:"edit-bus-stop",idx:b.detail.features[0].id},l),m=b=>K(W,l={kind:"edit-crossing",idx:b.detail.features[0].id},l),j=b=>K(W,l={kind:"edit-side-road",idx:b.detail.features[0].id},l),M=()=>r(0,i=!0),_=()=>Ql("rcv2.geojson",JSON.stringify(o));function $(b){pe[b?"unshift":"push"](()=>{a=b,r(1,a)})}return[i,a,o,l,s,u,c,f,d,p,m,j,M,_,$,()=>r(0,i=!1)]}class Cc extends se{constructor(e){super(),ae(this,e,Ac,yc,ie,{})}}function jc(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Ke[n%Ke.length],st20:""}}}function Sc(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:Ke[n%Ke.length],sa10:""}}}function zc(n){let e,r,t,o,l,i,a,s;return{c(){e=k("div"),r=k("h1"),t=O("Click map to create new "),o=O(n[0]),l=L(),i=k("button"),i.textContent="Cancel",F(e,"slot","sidebar")},m(u,c){v(u,e,c),g(e,r),g(r,t),g(r,o),g(e,l),g(e,i),a||(s=R(i,"click",n[3]),a=!0)},p(u,c){c&1&&le(o,u[0])},d(u){u&&y(e),a=!1,s()}}}function Lc(n){let e,r,t;return r=new We({props:{except:""}}),{c(){e=k("div"),B(r.$$.fragment),F(e,"slot","map")},m(o,l){v(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){A(r.$$.fragment,o),t=!1},d(o){o&&y(e),D(r)}}}function Mc(n){let e,r,t,o;return e=new Ut({}),e.$on("click",n[2]),t=new Ue({props:{$$slots:{map:[Lc],sidebar:[zc]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=L(),B(t.$$.fragment)},m(l,i){E(e,l,i),v(l,r,i),E(t,l,i),o=!0},p(l,[i]){const a={};i&35&&(a.$$scope={dirty:i,ctx:l}),t.$set(a)},i(l){o||(h(e.$$.fragment,l),h(t.$$.fragment,l),o=!0)},o(l){A(e.$$.fragment,l),A(t.$$.fragment,l),o=!1},d(l){l&&y(r),D(e,l),D(t,l)}}}function Bc(n,e,r){let t,o;te(n,G,s=>r(4,t=s)),te(n,W,s=>r(1,o=s));let{obj:l}=e;function i(s){let u=s.detail.lngLat.toArray();if(l=="jat"){let c=oo(t.jats.length,u);K(G,t.jats=[...t.jats,c],t),K(W,o={kind:"edit-jat",idx:t.jats.length-1},o)}else if(l=="crossing"){let c=Sc(t.crossings.length,u);K(G,t.crossings=[...t.crossings,c],t),K(W,o={kind:"edit-crossing",idx:t.crossings.length-1},o)}else if(l=="bus stop"){let c=jc(t.bus_stops.length,u);K(G,t.bus_stops=[...t.bus_stops,c],t),K(W,o={kind:"edit-bus-stop",idx:t.bus_stops.length-1},o)}}const a=()=>K(W,o={kind:"neutral"},o);return n.$$set=s=>{"obj"in s&&r(0,l=s.obj)},[l,o,i,a]}class Ec extends se{constructor(e){super(),ae(this,e,Bc,Mc,ie,{obj:0})}}const{window:Dc}=ut;function Hr(n){let e;return{c(){e=k("p"),e.textContent="A side road needs at least two points"},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Tc(n){let e;return{c(){e=O("SA01: conflict at side roads and priority junctions")},m(r,t){v(r,e,t)},d(r){r&&y(e)}}}function Nc(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,j,M,_,$,C,b,S,w=!n[2]&&Hr();function z(q){n[10](q)}let N={k:"horiz-radio",choices:Le(),$$slots:{default:[Tc]},$$scope:{ctx:n}};return n[1].side_roads[n[0]].properties.sa01!==void 0&&(N.value=n[1].side_roads[n[0]].properties.sa01),p=new Je({props:N}),pe.push(()=>ke(p,"value",z)),$=new dt({props:{metric:n[4]}}),{c(){e=k("div"),r=k("button"),t=O("Done"),l=L(),i=k("button"),i.textContent="Delete side road",a=L(),w&&w.c(),s=L(),u=k("label"),c=O(`Name:
      `),f=k("input"),d=L(),B(p.$$.fragment),j=L(),M=k("p"),M.textContent=`${n[4].description}`,_=L(),B($.$$.fragment),r.disabled=o=!n[2],F(f,"type","text"),F(e,"slot","sidebar")},m(q,Z){v(q,e,Z),g(e,r),g(r,t),g(e,l),g(e,i),g(e,a),w&&w.m(e,null),g(e,s),g(e,u),g(u,c),g(u,f),ve(f,n[1].side_roads[n[0]].properties.name),g(e,d),E(p,e,null),g(e,j),g(e,M),g(e,_),E($,e,null),C=!0,b||(S=[R(r,"click",n[8]),R(i,"click",n[6]),R(f,"input",n[9])],b=!0)},p(q,Z){(!C||Z&4&&o!==(o=!q[2]))&&(r.disabled=o),q[2]?w&&(w.d(1),w=null):w||(w=Hr(),w.c(),w.m(e,s)),Z&3&&f.value!==q[1].side_roads[q[0]].properties.name&&ve(f,q[1].side_roads[q[0]].properties.name);const V={};Z&2048&&(V.$$scope={dirty:Z,ctx:q}),!m&&Z&3&&(m=!0,V.value=q[1].side_roads[q[0]].properties.sa01,we(()=>m=!1)),p.$set(V)},i(q){C||(h(p.$$.fragment,q),h($.$$.fragment,q),C=!0)},o(q){A(p.$$.fragment,q),A($.$$.fragment,q),C=!1},d(q){q&&y(e),w&&w.d(),D(p),D($),b=!1,ze(S)}}}function Ic(n){let e,r;return e=new Te({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":3}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":3}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Oc(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"side_roads"}}),o=new Ae({props:{data:me(n[1].side_roads),generateId:!0,$$slots:{default:[Ic]},$$scope:{ctx:n}}});function u(f){n[7](f)}let c={};return n[1].side_roads[n[0]]!==void 0&&(c.f=n[1].side_roads[n[0]]),i=new uo({props:c}),pe.push(()=>ke(i,"f",u)),{c(){e=k("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){v(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].side_roads)),d&2049&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};!a&&d&3&&(a=!0,m.f=f[1].side_roads[f[0]],we(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){A(r.$$.fragment,f),A(o.$$.fragment,f),A(i.$$.fragment,f),s=!1},d(f){f&&y(e),D(r),D(o),D(i)}}}function Fc(n){let e,r,t,o;return e=new Ue({props:{$$slots:{map:[Oc],sidebar:[Nc]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=R(Dc,"keydown",n[5]),t=!0)},p(l,[i]){const a={};i&2063&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l),t=!1,o()}}}function qc(n,e,r){let t,o,l;te(n,G,m=>r(1,o=m)),te(n,W,m=>r(3,l=m));let{idx:i}=e,a=et.SA01;function s(m){m.key=="Escape"&&K(W,l={kind:"neutral"},l)}async function u(){window.confirm("Really delete this side road?")&&(K(W,l={kind:"neutral"},l),await ot(),o.side_roads.splice(i,1),G.set(o))}function c(m){n.$$.not_equal(o.side_roads[i],m)&&(o.side_roads[i]=m,G.set(o))}const f=()=>K(W,l={kind:"neutral"},l);function d(){o.side_roads[i].properties.name=this.value,G.set(o)}function p(m){n.$$.not_equal(o.side_roads[i].properties.sa01,m)&&(o.side_roads[i].properties.sa01=m,G.set(o))}return n.$$set=m=>{"idx"in m&&r(0,i=m.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(2,t=o.side_roads[i].geometry.coordinates.length>=2)},[i,o,t,l,a,s,u,c,f,d,p]}class Pc extends se{constructor(e){super(),ae(this,e,qc,Fc,ie,{idx:0})}}function Kr(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function Wr(n){let e,r,t=n[6].properties.name+"",o,l,i,a,s,u;function c(d){n[5](d,n[6])}let f={k:"horiz-radio",choices:Le()};return n[6].properties.sa01!==void 0&&(f.value=n[6].properties.sa01),i=new Je({props:f}),pe.push(()=>ke(i,"value",c)),{c(){e=k("li"),r=k("span"),o=O(t),l=L(),B(i.$$.fragment),s=L(),Y(r,"color",n[6].properties.color)},m(d,p){v(d,e,p),g(e,r),g(r,o),g(e,l),E(i,e,null),g(e,s),u=!0},p(d,p){n=d,(!u||p&2)&&t!==(t=n[6].properties.name+"")&&le(o,t),p&2&&Y(r,"color",n[6].properties.color);const m={};!a&&p&2&&(a=!0,m.value=n[6].properties.sa01,we(()=>a=!1)),i.$set(m)},i(d){u||(h(i.$$.fragment,d),u=!0)},o(d){A(i.$$.fragment,d),u=!1},d(d){d&&y(e),D(i)}}}function Uc(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m=x(n[1].side_roads),j=[];for(let _=0;_<m.length;_+=1)j[_]=Wr(Kr(n,m,_));const M=_=>A(j[_],1,1,()=>{j[_]=null});return c=new dt({props:{metric:n[2]}}),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("h2"),o.textContent="SA01: Conflict at Side ROads and Priority Junctions",l=L(),i=k("p"),i.textContent=`${n[2].description}`,a=L(),s=k("ol");for(let _=0;_<j.length;_+=1)j[_].c();u=L(),B(c.$$.fragment),F(e,"slot","sidebar")},m(_,$){v(_,e,$),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(e,a),g(e,s);for(let C=0;C<j.length;C+=1)j[C]&&j[C].m(s,null);g(e,u),E(c,e,null),f=!0,d||(p=R(r,"click",n[4]),d=!0)},p(_,$){if($&2){m=x(_[1].side_roads);let C;for(C=0;C<m.length;C+=1){const b=Kr(_,m,C);j[C]?(j[C].p(b,$),h(j[C],1)):(j[C]=Wr(b),j[C].c(),h(j[C],1),j[C].m(s,null))}for(ue(),C=m.length;C<j.length;C+=1)M(C);fe()}},i(_){if(!f){for(let $=0;$<m.length;$+=1)h(j[$]);h(c.$$.fragment,_),f=!0}},o(_){j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)A(j[$]);A(c.$$.fragment,_),f=!1},d(_){_&&y(e),ge(j,_),D(c),d=!1,p()}}}function Rc(n){let e,r,t;return r=new We({props:{showColor:"side_roads",except:""}}),{c(){e=k("div"),B(r.$$.fragment),F(e,"slot","map")},m(o,l){v(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){A(r.$$.fragment,o),t=!1},d(o){o&&y(e),D(r)}}}function Jc(n){let e,r,t,o;return e=new Ue({props:{$$slots:{map:[Rc],sidebar:[Uc]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=R(window,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){A(e.$$.fragment,l),r=!1},d(l){D(e,l),t=!1,o()}}}function Gc(n,e,r){let t,o;te(n,W,u=>r(0,t=u)),te(n,G,u=>r(1,o=u));let l=et.SA01;function i(u){u.key=="Escape"&&K(W,t={kind:"neutral"},t)}const a=()=>K(W,t={kind:"neutral"},t);function s(u,c){n.$$.not_equal(c.properties.sa01,u)&&(c.properties.sa01=u,G.set(o))}return[t,o,l,i,a,s]}class Qc extends se{constructor(e){super(),ae(this,e,Gc,Jc,ie,{})}}function Hc(n){let e,r;return{c(){e=k("div"),r=k("div"),F(e,"slot","left")},m(t,o){v(t,e,o),g(e,r),n[10](r)},p:ee,d(t){t&&y(e),n[10](null)}}}function Kc(n){return{c:ee,m:ee,p:ee,i:ee,o:ee,d:ee}}function Wc(n){let e,r,t;function o(i){n[9](i)}let l={style:n[11],standardControls:!0,hash:!0,images:[{id:"bus_stop",url:xr,options:{sdf:!0}},{id:"crossing",url:eo,options:{sdf:!0}}],$$slots:{default:[su]},$$scope:{ctx:n}};return n[2]!==void 0&&(l.map=n[2]),e=new qo({props:l}),pe.push(()=>ke(e,"map",o)),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,a){const s={};a&4110&&(s.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,s.map=i[2],we(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function Zc(n){let e,r;return e=new Vi({props:{map:n[2],editingExisting:!1,finish:Oi,cancel:n[8]}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.map=t[2]),o&8&&(l.cancel=t[8]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Xc(n){let e,r;return e=new wl({}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Vc(n){let e,r;return e=new Qc({}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function Yc(n){let e,r;return e=new qa({props:{qIdx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.qIdx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function xc(n){let e,r;return e=new Pc({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function eu(n){let e,r;return e=new $i({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function tu(n){let e,r;return e=new Dl({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function nu(n){let e,r;return e=new da({props:{junctionIdx:n[3].idx,stage:n[3].stage}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.junctionIdx=t[3].idx),o&8&&(l.stage=t[3].stage),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function ru(n){let e,r;return e=new $a({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function ou(n){let e,r;return e=new Ea({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function lu(n){let e,r;return e=new Ec({props:{obj:n[3].obj}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.obj=t[3].obj),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function iu(n){let e,r;return e=new Cc({}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function su(n){let e,r,t,o,l,i,a;const s=[iu,lu,ou,ru,nu,tu,eu,xc,Yc,Vc,Xc,Zc],u=[];function c(f,d){return f[3].kind=="neutral"?0:f[3].kind=="new-point"?1:f[3].kind=="edit-link"?2:f[3].kind=="edit-jat"?3:f[3].kind=="edit-jat-detail"?4:f[3].kind=="edit-bus-stop"?5:f[3].kind=="edit-crossing"?6:f[3].kind=="edit-side-road"?7:f[3].kind=="link-questions"?8:f[3].kind=="side-road-questions"?9:f[3].kind=="bus-stop-questions"?10:f[3].kind=="draw-route"&&f[2]?11:-1}return~(t=c(n))&&(o=u[t]=s[t](n)),i=new ui({}),{c(){e=k("div"),r=L(),o&&o.c(),l=L(),B(i.$$.fragment)},m(f,d){v(f,e,d),n[7](e),v(f,r,d),~t&&u[t].m(f,d),v(f,l,d),E(i,f,d),a=!0},p(f,d){let p=t;t=c(f),t===p?~t&&u[t].p(f,d):(o&&(ue(),A(u[p],1,1,()=>{u[p]=null}),fe()),~t?(o=u[t],o?o.p(f,d):(o=u[t]=s[t](f),o.c()),h(o,1),o.m(l.parentNode,l)):o=null)},i(f){a||(h(o),h(i.$$.fragment,f),a=!0)},o(f){A(o),A(i.$$.fragment,f),a=!1},d(f){f&&(y(e),y(r),y(l)),n[7](null),~t&&u[t].d(f),D(i,f)}}}function au(n){return{c:ee,m:ee,p:ee,i:ee,o:ee,d:ee}}function cu(n){let e,r,t={ctx:n,current:null,token:null,hasCatch:!1,pending:au,then:Wc,catch:Kc,value:11,blocks:[,,,]};return Po(Yi(new URLSearchParams(window.location.search).get("google")||""),t),{c(){e=k("div"),t.block.c(),F(e,"slot","main"),Y(e,"position","relative"),Y(e,"width","100%"),Y(e,"height","100vh")},m(o,l){v(o,e,l),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,r=!0},p(o,l){n=o,Uo(t,n,l)},i(o){r||(h(t.block),r=!0)},o(o){for(let l=0;l<3;l+=1){const i=t.blocks[l];A(i)}r=!1},d(o){o&&y(e),t.block.d(),t.token=null,t=null}}}function uu(n){let e,r;return e=new Fo({props:{$$slots:{main:[cu],left:[Hc]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,[o]){const l={};o&4111&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){A(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function fu(n,e,r){let t,o,l,i,a;te(n,Vt,m=>r(4,t=m)),te(n,Xt,m=>r(5,o=m)),te(n,G,m=>r(6,l=m)),te(n,Ot,m=>r(2,i=m)),te(n,W,m=>r(3,a=m));let s,u;function c(m){pe[m?"unshift":"push"](()=>{u=m,r(1,u),r(4,t)})}const f=()=>K(W,a={kind:"neutral"},a);function d(m){i=m,Ot.set(i)}function p(m){pe[m?"unshift":"push"](()=>{s=m,r(0,s),r(5,o)})}return n.$$.update=()=>{n.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(l)),n.$$.dirty&33&&s&&o&&(r(0,s.innerHTML="",s),s.appendChild(o)),n.$$.dirty&18&&u&&t&&(r(1,u.innerHTML="",u),u.appendChild(t))},[s,u,i,a,t,o,l,c,f,d,p]}class du extends se{constructor(e){super(),ae(this,e,fu,uu,ie,{})}}new du({target:document.getElementById("app")});
