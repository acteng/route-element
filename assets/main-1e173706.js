import{S as oe,i as ie,s as ne,c as Ie,e as v,a as P,t as ve,b as y,u as Oe,g as Pe,d as Fe,f as h,h as C,j as A,k as ee,o as qt,l as fe,n as tn,m,p as H,q as ze,r as so,v as ge,w as M,x as B,y as _e,z as E,A as Ue,B as ce,C as ue,D as Y,E as se,F as L,G as O,H as re,I as x,J as pe,K as Z,L as ke,M as Ce,N as lt,O as bt,P as Gt,Q as nn,R as Wt,T as Jt,U as ao,V as co}from"./pico.jade.min-529c3f30.js";import{m as Rr,L as uo,g as Gr,a as rn,u as fo,r as po,b as mo,c as go,P as _o,w as Ee,G as we,d as qe,C as Ze,M as Ke,e as kt,f as ho,h as st,i as bo,j as on,k as $o,_ as ko,O as wo,l as Dt,n as vo,o as It,p as yo,q as Ao}from"./index-7fda598e.js";import{P as Te}from"./Picker-db998d1a.js";function Co(n){let e,r;const t=n[7].default,o=Ie(t,n,n[6],null);return{c(){e=v("div"),o&&o.c(),P(e,"class",n[1]),ve(e,"maplibregl-ctrl",n[0])},m(i,l){y(i,e,l),o&&o.m(e,null),n[8](e),r=!0},p(i,[l]){o&&o.p&&(!r||l&64)&&Oe(o,t,i,i[6],r?Fe(t,i[6],l,null):Pe(i[6]),null),(!r||l&2)&&P(e,"class",i[1]),(!r||l&3)&&ve(e,"maplibregl-ctrl",i[0])},i(i){r||(h(o,i),r=!0)},o(i){C(o,i),r=!1},d(i){i&&A(e),o&&o.d(i),n[8](null)}}}function jo(n,e,r){let t,{$$slots:o={},$$scope:i}=e,{defaultStyling:l=!0}=e,{position:s="top-right"}=e,{class:a=void 0}=e;const{map:u}=Rr();ee(n,u,p=>r(5,t=p));let c,f={onAdd(){return c},onRemove(){var p;(p=c==null?void 0:c.parentNode)==null||p.removeChild(c)}};qt(()=>{t==null||t.removeControl(f)});function d(p){fe[p?"unshift":"push"](()=>{c=p,r(2,c)})}return n.$$set=p=>{"defaultStyling"in p&&r(0,l=p.defaultStyling),"position"in p&&r(4,s=p.position),"class"in p&&r(1,a=p.class),"$$scope"in p&&r(6,i=p.$$scope)},n.$$.update=()=>{n.$$.dirty&52&&t&&c&&t.addControl(f,s)},[l,a,c,u,s,t,i,o,d]}class So extends oe{constructor(e){super(),ie(this,e,jo,Co,ne,{defaultStyling:0,position:4,class:1})}}function zo(n){let e,r,t,o,i,l;const s=n[4].default,a=Ie(s,n,n[3],null);return{c(){e=v("button"),r=v("div"),a&&a.c(),P(r,"class",t=tn(n[2])+" svelte-1s83zbq"),ve(r,"maplibregl-ctrl-icon",n[0]),ve(r,"ctrl-btn-center",n[1]),P(e,"type","button")},m(u,c){y(u,e,c),m(e,r),a&&a.m(r,null),o=!0,i||(l=H(e,"click",n[5]),i=!0)},p(u,[c]){a&&a.p&&(!o||c&8)&&Oe(a,s,u,u[3],o?Fe(s,u[3],c,null):Pe(u[3]),null),(!o||c&4&&t!==(t=tn(u[2])+" svelte-1s83zbq"))&&P(r,"class",t),(!o||c&5)&&ve(r,"maplibregl-ctrl-icon",u[0]),(!o||c&6)&&ve(r,"ctrl-btn-center",u[1])},i(u){o||(h(a,u),o=!0)},o(u){C(a,u),o=!1},d(u){u&&A(e),a&&a.d(u),i=!1,l()}}}function Lo(n,e,r){let{$$slots:t={},$$scope:o}=e,{icon:i=!0}=e,{center:l=!0}=e,{class:s=void 0}=e;function a(u){ze.call(this,n,u)}return n.$$set=u=>{"icon"in u&&r(0,i=u.icon),"center"in u&&r(1,l=u.center),"class"in u&&r(2,s=u.class),"$$scope"in u&&r(3,o=u.$$scope)},[i,l,s,o,t,a]}class Jr extends oe{constructor(e){super(),ie(this,e,Lo,zo,ne,{icon:0,center:1,class:2})}}function Mo(n,e,r){let t;const o=so();let{layer:i=void 0}=e;const{map:l}=Rr();ee(n,l,c=>r(2,t=c));function s(c){o(c.type,{...c,map:l})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return qt(()=>{if(t)if(i)for(const c of a)t.off(c,i,s);else for(const c of u)t.off(c,s)}),n.$$set=c=>{"layer"in c&&r(1,i=c.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(i)for(const c of a)t.on(c,i,s);else for(const c of u)t.on(c,s)},[l,i,t]}class wt extends oe{constructor(e){super(),ie(this,e,Mo,null,ne,{layer:1})}}function Bo(n){let e;const r=n[16].default,t=Ie(r,n,n[24],null);return{c(){t&&t.c()},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&16777216)&&Oe(t,r,o,o[24],e?Fe(r,o[24],i,null):Pe(o[24]),null)},i(o){e||(h(t,o),e=!0)},o(o){C(t,o),e=!1},d(o){t&&t.d(o)}}}function Eo(n){let e,r,t;function o(l){n[17](l)}let i={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Bo]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.hovered=n[0]),e=new uo({props:i}),fe.push(()=>ge(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,[s]){const a={};s&2&&(a.id=l[1]),s&4&&(a.source=l[2]),s&8&&(a.sourceLayer=l[3]),s&16&&(a.beforeId=l[4]),s&32&&(a.beforeLayerType=l[5]),s&64&&(a.paint=l[6]),s&128&&(a.layout=l[7]),s&256&&(a.filter=l[8]),s&512&&(a.applyToClusters=l[9]),s&1024&&(a.minzoom=l[10]),s&2048&&(a.maxzoom=l[11]),s&4096&&(a.hoverCursor=l[12]),s&8192&&(a.manageHoverState=l[13]),s&16384&&(a.eventsIfTopMost=l[14]),s&32768&&(a.interactive=l[15]),s&16777216&&(a.$$scope={dirty:s,ctx:l}),!r&&s&1&&(r=!0,a.hovered=l[0],_e(()=>r=!1)),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function To(n,e,r){let{$$slots:t={},$$scope:o}=e,{id:i=Gr("symbol")}=e,{source:l=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:f=void 0}=e,{filter:d=void 0}=e,{applyToClusters:p=void 0}=e,{minzoom:$=void 0}=e,{maxzoom:j=void 0}=e,{hoverCursor:T=void 0}=e,{manageHoverState:g=!1}=e,{hovered:_=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:k=!0}=e;function S(D){_=D,r(0,_)}function w(D){ze.call(this,n,D)}function z(D){ze.call(this,n,D)}function N(D){ze.call(this,n,D)}function U(D){ze.call(this,n,D)}function F(D){ze.call(this,n,D)}function V(D){ze.call(this,n,D)}return n.$$set=D=>{"id"in D&&r(1,i=D.id),"source"in D&&r(2,l=D.source),"sourceLayer"in D&&r(3,s=D.sourceLayer),"beforeId"in D&&r(4,a=D.beforeId),"beforeLayerType"in D&&r(5,u=D.beforeLayerType),"paint"in D&&r(6,c=D.paint),"layout"in D&&r(7,f=D.layout),"filter"in D&&r(8,d=D.filter),"applyToClusters"in D&&r(9,p=D.applyToClusters),"minzoom"in D&&r(10,$=D.minzoom),"maxzoom"in D&&r(11,j=D.maxzoom),"hoverCursor"in D&&r(12,T=D.hoverCursor),"manageHoverState"in D&&r(13,g=D.manageHoverState),"hovered"in D&&r(0,_=D.hovered),"eventsIfTopMost"in D&&r(14,b=D.eventsIfTopMost),"interactive"in D&&r(15,k=D.interactive),"$$scope"in D&&r(24,o=D.$$scope)},[_,i,l,s,a,u,c,f,d,p,$,j,T,g,b,k,t,S,w,z,N,U,F,V,o]}class Ye extends oe{constructor(e){super(),ie(this,e,To,Eo,ne,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function ln(n){let e=n[0],r,t,o=sn(n);return{c(){o.c(),r=Ue()},m(i,l){o.m(i,l),y(i,r,l),t=!0},p(i,l){l&1&&ne(e,e=i[0])?(ce(),C(o,1,1,se),ue(),o=sn(i),o.c(),h(o,1),o.m(r.parentNode,r)):o.p(i,l)},i(i){t||(h(o),t=!0)},o(i){C(o),t=!1},d(i){i&&A(r),o.d(i)}}}function sn(n){let e;const r=n[15].default,t=Ie(r,n,n[14],null);return{c(){t&&t.c()},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&16384)&&Oe(t,r,o,o[14],e?Fe(r,o[14],i,null):Pe(o[14]),null)},i(o){e||(h(t,o),e=!0)},o(o){C(t,o),e=!1},d(o){t&&t.d(o)}}}function Do(n){let e,r,t=n[0]&&ln(n);return{c(){t&&t.c(),e=Ue()},m(o,i){t&&t.m(o,i),y(o,e,i),r=!0},p(o,[i]){o[0]?t?(t.p(o,i),i&1&&h(t,1)):(t=ln(o),t.c(),h(t,1),t.m(e.parentNode,e)):t&&(ce(),C(t,1,1,()=>{t=null}),ue())},i(o){r||(h(t),r=!0)},o(o){C(t),r=!1},d(o){o&&A(e),t&&t.d(o)}}}function No(n,e,r){let t,o,{$$slots:i={},$$scope:l}=e,{id:s=Gr("vector")}=e,{url:a=null}=e,{tiles:u=null}=e,{promoteId:c=null}=e,{bounds:f=null}=e,{scheme:d=null}=e,{attribution:p=null}=e,{minzoom:$=null}=e,{maxzoom:j=null}=e,{volatile:T=null}=e;if(a&&a.includes("pmtiles://")&&!rn.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let k=new _o;rn.addProtocol("pmtiles",k.tile)}const{map:g,self:_}=fo();ee(n,g,k=>r(13,o=k)),ee(n,_,k=>r(0,t=k));let b;return qt(()=>{t&&o&&(po(g,t,b),Y(_,t=null,t),b=void 0)}),n.$$set=k=>{"id"in k&&r(3,s=k.id),"url"in k&&r(4,a=k.url),"tiles"in k&&r(5,u=k.tiles),"promoteId"in k&&r(6,c=k.promoteId),"bounds"in k&&r(7,f=k.bounds),"scheme"in k&&r(8,d=k.scheme),"attribution"in k&&r(9,p=k.attribution),"minzoom"in k&&r(10,$=k.minzoom),"maxzoom"in k&&r(11,j=k.maxzoom),"volatile"in k&&r(12,T=k.volatile),"$$scope"in k&&r(14,l=k.$$scope)},n.$$.update=()=>{n.$$.dirty&16377&&o&&t!==s&&(Y(_,t=s,t),mo(o,t,go({type:"vector",url:a,tiles:u,promoteId:c,bounds:f,scheme:d,attribution:p,minzoom:$,maxzoom:j,volatile:T}),k=>o&&k===t,()=>{t&&(b=o==null?void 0:o.getSource(t))})),n.$$.dirty&8200&&(o==null||o.on("style.load",()=>{b=o==null?void 0:o.getSource(s)}))},[t,g,_,s,a,u,c,f,d,p,$,j,T,o,l,i]}class Qr extends oe{constructor(e){super(),ie(this,e,No,Do,ne,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const Io=n=>({}),an=n=>({}),Oo=n=>({}),cn=n=>({});function Po(n){let e,r,t,o;const i=n[3].sidebar,l=Ie(i,n,n[2],cn),s=n[3].map,a=Ie(s,n,n[2],an);return{c(){e=v("div"),l&&l.c(),r=L(),t=v("div"),a&&a.c()},m(u,c){y(u,e,c),l&&l.m(e,null),n[4](e),y(u,r,c),y(u,t,c),a&&a.m(t,null),n[5](t),o=!0},p(u,[c]){l&&l.p&&(!o||c&4)&&Oe(l,i,u,u[2],o?Fe(i,u[2],c,Oo):Pe(u[2]),cn),a&&a.p&&(!o||c&4)&&Oe(a,s,u,u[2],o?Fe(s,u[2],c,Io):Pe(u[2]),an)},i(u){o||(h(l,u),h(a,u),o=!0)},o(u){C(l,u),C(a,u),o=!1},d(u){u&&(A(e),A(r),A(t)),l&&l.d(u),n[4](null),a&&a.d(u),n[5](null)}}}function Fo(n,e,r){let t,o;ee(n,Zt,u=>r(0,t=u)),ee(n,Xt,u=>r(1,o=u));let{$$slots:i={},$$scope:l}=e;function s(u){fe[u?"unshift":"push"](()=>{t=u,Zt.set(t)})}function a(u){fe[u?"unshift":"push"](()=>{o=u,Xt.set(o)})}return n.$$set=u=>{"$$scope"in u&&r(2,l=u.$$scope)},[t,o,l,i,s,a]}class De extends oe{constructor(e){super(),ie(this,e,Fo,Po,ne,{})}}let Zt=Ee(null),Xt=Ee(null);const Hr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAACmlBMVEXo6uzn6e3o6u7n6ezn6uzm6Ozn6evo6ezm6evo6e3p6u7p6+3p6u3o6u3n6u3n6evn6evn6ezo6uzo6u3n6evn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezo6uzo6uzo6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezo6+3n6ezn6ezn6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6ezn6e3n6e3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6e3o6u3o6uzo6uzo6u3o6u3o6u3n6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6uzn6ezn6e3o6u3o6u3o6u3o6u3o6u3n6u3n6ezo6u3o6u3o6uzn6uzn6ezo6ezo6uzn6ezo6u3o6u3o6u3n6u3n6Ozm6ezn6ezo6u3o6u3o6uzo6u3n6u3o6e3o6u3o6u3o6u3n6u3n6ezo6uzo6u3o6u3n6+3o6uzo6u3o6u3o6uzo6uzn6uzn6uzn6ezn6ezn6ezn6ezo6u3n6ezo6ezn6ezn6ezn6ezn6ezn6e3o6u3o6e3n6ezn6ezo6uzn6evo6uzo6uzn6evn6ezo6u3n6ezn6uzo6u3n6ezn6ezo6u3n6u3n6ezo6u3o6u3n6ezn6u3o6u3o6u3n6ezo6u3n6u3n6ezn6ezo6u3n6ezo6u3n6e3n6uzn6ezn6ezn6ezn6ezn6ezn6ezo6u3o6u3n6ezn6ezo6u3o6e3o6u3n6e3o6u3n6u3n6uzo6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6evo6u3o6u3o6u3n6uvn6ezo6u3n6uzn6ezn6ezn6ezo6u3n6uzn6uzo6u3n6u3n6uzo6+zm6uzjK5F0AAAA3nRSTlMAAAAAAAAAAAAAAAAAAAAIDxIUFBMDKEVdbn2IjpOWlpCJb15HKgUACXqjwtrt/P/u3MSmSg0gc7vz4dnSz83U5fT3vnciCnPV8MCdg2JYUk5LU1pmdoyoy/rYdApBt31IIyMjIyyI0LY/AABh366lq19s6GnraXg8PHsAAwOEeF0MKiEiCymqnFmeqXsncN6sOTuuDYzPTlCJCHhyOjyxcGfmkhotgqFcrYIrHONkymEKEC8mLg9jzMhNmr1XVVi/mCSz79ddrI6v3FooDSsAQ6OCFReFoi48GTwtAAD3GpCFAAADBklEQVR4nKWUh1IUQRCGZ+nx8JRZMcspoiKekfbMomDABAaSCbNwxhPMgmLOCTFnxZxzzlkxY86+i927BxzeUmWVf+1O1c5+09Pd09NCaJoWAFJCOQAb0GuzQSAPAOXppVlhD6hQMUgIJpUECUxpviCAxoOuKlRUShikMmYMk5WCK1epWi24UgloDwhSBOqKSTtNVa9Rs1aIo3ad0LphofXqOxqEN4xoxLDBKaGcTiU0pRo3bNK0WfMWkehVZEtXq9aONm1Ne0oXQHuT0XbtO3Sk3y2jOnWOjomJ7tK8azf67B7boydTJMFeBIpevftgXHzffiH9ByQkJiUlJqcMHDR4yNBUHDZ8hG5IlCMBjByF0aPHjE1Loyfd7U5Lc7vd6eOSx0/AiZN0jSUmTyaTnikZmDnVQtPQNZ0ou10JMy8zWmAZmjmLIyeLdkMExloKZ8/x+lgEpmZlz/XXvMjZc3IM+YA2ofxkDVqQ/wn+69bzF/jLClxoqUi/9JSVcD+LGGUpfzB10WILzfPfmqKGJUuXcXkaguURK0BYgysdq1avCTRQCSlr163PVdbghjzEjZvoflJJbd6C6ArRLcGt2yjI7TvMq7qzM33s2u0DFtVj6h7YG4WYuY8sKoD9+YgZB2A9gdKQFzx4CA8fOXos8/gJ8+g0CD9+8tTpM2F49hyAAZotYedQPH/h4qXLV6D4mHOvXltx/QbevMX/PR4vmHsb8U7W3XuldD/rAeLDR5wrqixza0h+jPjk6V+KQ8xPgKLUeslneVYn7Uqhm2UD7lFgNizFYMHzUnqB+PIVJ4uyYGdQY98ZXPX6jY/eFpggo+yjt64NsIZPceuni0GW6WehzfbufXzsh48l2ZGeT59j47+MNHowg4WFheahff327Ts5UwQScCT7x0/JfYdbrDA8oBauSUkhUUP1ngx4aJEOimbNJsVBM6dLyUFpmtcesHFdCiWVMkGbzNFB1xWBupPnDFzzcDJotXJKJ22kCeJyqFupXyaoVCAw+JuzrGi5cOqSurf2B4tMU69Bi01ZAAAAAElFTkSuQmCC",Kr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMA/1uRIrUAAAjuSURBVHic7dxLlqM2FAZgCOdEGUUZZtCntZPWlrKCiKwgW2IpZAdkxoBAbJCEHle27r3UoxNr0KdMoc9Y/HoArm6aV3mVV/m/lHYbeIDaFh6wbVvPqd/dgJEDyBswcwB9A1YOYG7AxgHu9Tmt2O3ASAfEDkx0QO4A4zSwAbUDjDDrHWAEYY8BJwhs4KhPT1JrgeHDgM4C4/cLCAuQe9PHA9IC5O74Al7AC/hswHc8IrGBj58XPn5ydUBPBdgLjE+wRtJ7fcYyT+0AY6HJXuqyV+vs64WWF8SGf8nDv+hSvLN4wYUn+9KXffHNv/xvmAfwKq/yKq/yKv+p0rImxua+TBt4B8Ccm++LLNZN4X15wAI0c4nVMBd5xzKRscw8Vrqc06CYS+1jlcg4jy33ckNwr5gUF9DMq0Z30UcG2FfOkgso7t0DwwTclTcZEFzANQG5O2ousDGBjgtILqC5gGECPkZUQHABFQK/EAATAr8SgC0EvuDrdxHwFQ/ICFB4QMdAjwa2GBiw9dsEGLGASAD0oKQSAB1GkwDoNcLGBLoUwC4yRApgFxk50OMAmQEDDlAZMOIAnQHIJOUAMkkmA5BByAFkEHIAGYQtB3ouMHCBkQvgggAAqCC4EfGfAEAFwQF/BwAqCA74KwBQQXDAHyHQ44G1DYEBD8wRMCIAO6aOEYAJggX6CMAE4QDWJgIwQehsvQjABME9mokATBCOaaFPgB4JrE0CDEhgSYERCcwpgAgCDCCCAAOIIEgQQAQBBhBBkLbNEqDnAgMXGLlAfRDUGwH1SXLRT4D6JBWA+iQVgPok6QLQc4GBC4woYAgAu/StDkIGCPcDFbBTVXUQTAq46ZoMuEUTHTC4IBi78wloXBByAJmkHJC4JG0ZILhAh4uiO2Un0HKBBpdlADBcQGOAFgAUF0B9KWevt8aA4AIdF2gxQAcADRswXEBjgSUBFBdwiw4yIBCAgIBdHRlAiwXO9Nimu/80cADDBe5B6DnAPQh19c/HlBEg6yfXFFjccdVO7z500aze1o/qKWA/ev3ElAH9vllXz+4ZMOybu+olkoKB+uIBt7IZKcAYANj72jIFsPe1T8CESWIA2NvSJ6CjJOGA4f6TipJUXUQGDFSA+OC480ctuIB7TIBMUmsb/iffGbBJsqf+i48iNkm2yhdyksxx0N/ISdJHs2lykuRx4kzvgzDgAHHUuP1DTFJ7fOgbQP0DBnNMKyM1Se44JnKS9tIFF4yk7+OIezVikiywkpO0F3mvRkySA8hJ2ovagiCMBEBvzCDsXYoTBLO/LyMIW3jngAiwktQe1ehJsmMzPUl2dqAnyU5w9CSJoxo9SXaxR0+SWzGTk6Q2ZhD0FgWBCARBQANmi4PQ04AzCAMWcNWo39BrXTVqkvy9K2qSOn/gxCR1vumISRIe0LQgSH/2iUk6AWKSlH9bYpK0bzlikk7ABQGZJHOefA5w3sRCRzGopClRDG/jqg8Bzr7kk4TrDGdf8knCASIAXJJQwNkV0jshBAD7gGQvKqxjCN1Rhe2mCYAOAUUAgr7kG2QgA4IARB0wjCUOsENAiweSZyp4IDloE3HvAiTtrqlAb1+q8JxUFRkD+D97jvqSOyDMmBb1JdemGEBzARPXaGPvPYCoL9GBKXldXz97PokFsgEgzhUBMEggG8OIwFlBJ+CzIrlA0pcuAFTSqM9K0peoQND7VBKsZ8WkgEQCSV+6AEA9NYae9dOAMQWqx7R8NkYOivl6gAb0KVA9pmV9CTsoZl2BDyAHxawv0YCozbNWeViyvoQdFLOucBkw1NWHvjejCcBIBqCVrco3lQu0tr4IqBzT8r6EHBQlkFsUAPQl3KAI9KV3BoC+hBsUDfBuKADoS6hRFfwOGmZQBK/RMAB8lQhko1Tg69T3BKC+hBoUob6EAqC+hBpVoa6AGhTZANSXUIMi1JdQANSXMEDh+5zlQbENT7BeQkAFvcIB7q813d95JIBZwr6UA3MjZxiwh2Pm8EZgCIgE6IqAYAG3Dxn0pRBwg6JYQMDl7rZzJdAWAVurIQH3/9b7qLWmgBsUuxUElhPQdUBTBMzmNxzWET+br6dAH/alEGgeA/7k9sBN9RjwkXkMTBlwHNlt98dA1BkBoC8AvotFExsM9Me+ugCEN9UjQL8tMB4b5er/qq4MDMe+qgCIEqBwQIMEhgRYc0AmgIQA9RTYv6FTASxFoIOB/jkgEkBAgF794FkGphpgygE7ihaABgTMFhxOCnQQYFwSxwJwG1TDZwY5sJWB9hGwpsCQA83xowfah0BfAO4T1yNgcwMKBBgLLACwpEADAHpvGxXsDAH9OVyngNrb5iHQPgTk/tF08HlPYA4Ac4IxIOx3Os4Wh4BjbpwhoLXfKnkAdJudnUHg9nLatwHAGe9jfTCBwP4fOZyx1QVA+iRnT6x/O/YuA+L+U+eTDD3y7rYtmBg8MAZA8B6PAQUCc9jOR/1o4S5gYPC/Xe6/mMqAPAGZA3LfWfjLCgDQ0d4AANyBiwADA+dBAfcAI2CLPnAKqC2+sMuBcCItAMNDQBSA5gTGh4AKgC4H9BnKArBHa3oIzI+AY8TNgTUA0iaPNqkQaGFgKwPdn9sTwARnGQLs6zkDlhAYa4GmAMxFIP12Vg4cv38KLBkwRxV8ElyFtQCYApBVqAZKFUqvT2CiAboEpI3mB5m3A8ZjQ1cJnL3/8wDDsUHUAv3xUpaAuQSYNwP8hkrAv+HnAZoYmEqAjoEuBVQC+P9uKwXGq4GVCLQpoGuB6WpgSX4/loD0M6aAqQXmq4GZCpirAbf/8AxYEmCqBWQC6IuBthpYE2CkAupiwO/f29+LFEg3OGB4BpRE+WmA/tn+pQ3irYCmBKQf0gHuE9UDrtU+C5BOCxXAeLxuYWAtAu0bAQsZaGJA1wPTtcBMB36PAGN/66/yfDAGt8VtmK8FJjrwLQK2emC5FhjpwFcQmMtA2kwR0CKANQIGOvDzpUCHALYI6BNgKgM6AX68FBAYoA+Bhg78cCkgM0C5LeNDIHu/sQz4LUPzKq/yKq9yefkXR6tlrDrSxQ4AAAAASUVORK5CYII=";let un="MZEJTanw3WpxRvt7qDfo";async function fn(n){if(n!="google")return`https://api.maptiler.com/maps/${n}/style.json?key=${un}`;let e=new URLSearchParams(window.location.search).get("google")||"";return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await qo(e)}&key=${e}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${un}`}}async function qo(n){try{let r=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB",layerTypes:["layerRoadmap"],overlay:!1})})).json();return"session"in r?r.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(r)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}function ye(){return["","2","1","0","Critical"]}let We=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],Ve={SA01:{description:"Pedestrian and cyclist conflict with motor traffic at side roads/priority junctions",green:"Side roads/priority junctions have entry treatments that offer greater protection for  pedestrian and cycle movements (e.g. exit only, continuous footways, zebra/parallel crossings as appropriate to context).",amber:"<2,500vpd cut across main walking, wheeling or cycling streams and side roads and priority junctions have entry treatments. ",red:"<2,500vpd cut across main walking, wheeling or cycling streams, but side roads and priority junctions are untreated.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA02:{description:"Pedestrian and cyclist conflict with motor traffic at roundabouts and signal-controlled junctions",green:"All pedestrian and cyclist movements are separated from all motor traffic movements at roundabouts and/or signal controlled junctions.",amber:"The principal pedestrian and cyclist movements are separated from motor traffic movements at roundabouts and/or signal controlled junctions.",red:"The principal pedestrian and/or cyclist movements are in conflict with motor traffic movements at roundabouts and/or signal controlled junctions.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA03:{description:"Effect of lane widths on conflict between cyclists and motor traffic",green:"Cyclists are protected from motor traffic or off-road entirely.",amber:`Cyclists are in cycle lanes with light protection or stepped cycle tracks under 1.8m wide (single direction).

Or, cyclists are in a protected bidirectional cycle facility under 2.5m wide.

Or, cyclists are mixed with traffic on quiet urban streets with no centre line.`,red:`Cyclists are mixed with traffic in lanes less than 3.25m wide or over 3.9m wide.

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is under 3.25m or over 3.9m. 

Or cyclists are mixed with traffic on busy urban streets with no centre line.

Or, there are speed cushions present.`,critical:`Cyclists are mixed with traffic in lanes between 3.25m and 3.9m wide. 

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is between 3.25m and 3.9m.`},SA04:{description:"Risk of pedestrians tripping due to hazards",green:"No trip hazards, level clear surface.",amber:"Few trip hazards.",red:"Many trip hazards.",critical:"There are level differences of greater than 13mm with no tactile information and colour contrast to help identify them."},SA05:{description:"Cyclist conflict with kerbside activity, including risk of 'dooring' ",green:"Kerbside activity is well-managed with no or minimal conflict with cyclists. ",amber:"Less frequent kerbside activity, and conflict with cyclists is well-managed.",red:"Frequent kerbside activity for cyclists to contend with. Conflict with cyclists is not well-managed.",critical:`Cycle facility next to parking/loading facility, without a buffer of at least 0.5m.

Or, an unprotected cycle lane is next to a frequently-used bus layby.`},SA06:{description:"Ability of pedestrians to cross the street safely on desire lines",green:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 50-100m. 

On quieter streets (<8,000vpd), there are controlled crossings or only one lane of traffic to cross.`,amber:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 100-200m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross on desire lines.`,red:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 200-400m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross.`,critical:`On very busy streets (>8,000vpd) controlled crossings (including zebra crossings) are not present or more than 400m apart.

On quieter streets (<8,000vpd), desire lines are blocked by parking and loading. `},SA07:{description:"Suitability of pedestrian crossings in context",green:`On very busy streets (>8,000vpd), signal crossings rest on green for pedestrians or have rapid response.

On quieter streets (<8,000vpd), crossing points are controlled crossings.`,amber:`On very busy streets (>8,000vpd), signal crossings are provided for pedestrians.

On quieter streets (<8,000vpd), crossing points have effective implied priority for pedestrians.`,red:`On very busy streets (>8,000vpd), there are uncontrolled crossings or zebra/parallel crossings.

On quieter streets (<8,000vpd), crossing points have no implied priority or there are no crossing points.`,critical:`On very busy streets (>8,000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic.

At signal junctions there are arms with dropped kerbs and tactile paving but no green pedestrian symbol.`},SA08:{description:"85th percentile speed of motor traffic (where cyclists are not protected or pedestrians are crossing uncontrolled)",green:`85th percentile speed is under 20mph.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:"85th percentile speed is between 20mph and 25mph.",red:"85th percentile speed is over 25mph.",critical:"85th percentile speed is over 30mph."},SA09:{description:"Volume of motor traffic at the busiest hour (where cyclists are not protected or pedestrians cross uncontrolled)",green:`<200 vehicles in the busiest hour.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:`200-499 vehicles in the busiest hour.

And, less than 2% of traffic is HGVs.`,red:`500-1,000 vehicles in the busiest hour.

Or, 2-5% of traffic is HGVs where there are 200-499 vehicles in the busiest hour.`,critical:`>1,000 vehicles in the busiest hour.

Or, over 5% of traffic is HGVs where there are over 500 vehicles in the busiest hour.`},SA10:{description:"Required crossing speed at signal crossings (risk of pedestrians coming into conflict with traffic).",green:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1m/s.",amber:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1.2m/s.",red:"There are no detectors to extend crossing times, but pedestrians who start crossing at the end of the 'invitation to cross' can cross at a speed of 1.2m/s and get across the whole crossing in time.",critical:"Pedestrians who start crossing at the end of the 'invitation to cross' must cross at a speed of over 1.2m/s to get across the whole crossing in time."},SA11:{description:"Clear walking and wheeling spaces free of permanent obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",green:">3m clear footway width and pedestrian comfort is good (PCL of A-C).",amber:`Where the footway is next to the carriageway, there is:
• 2m-3m clear footway width and pedestrian comfort is good (PCL of A-C).
• >3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is 1.5m-3m.`,red:`Where the footway is next to the carriageway, there is:
• <2m clear footway width but pedestrian comfort is good (PCL of A-C)
• 2m-3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is <1.5m.`,critical:`Where the footway is next to the carriageway, there is:
• <1m clear footway width on any footway
• <1.5m clear footway width for over 6m
• 1m-2m clear footway width with a Pedestrian Comfort Level of D-E

Or there is no footway.`},SA12:{description:"Effective width next to tram line on a straight run or a curve",green:"Physical protection is provided for cyclists.",amber:">2.4m from tramline edge to kerb.",red:"2.4m from tramline edge to kerb.",critical:`<2.4m from tramline edge to kerb on a straight run.

Insufficient clearance on a curve.`},SA13:{description:"Crossing angle (between cyclist desire line and tram or train rails).",green:"Crossing angle between 80 and 90 degrees with track filler creating a smooth crossing for cyclists.",amber:"Crossing angle between 80 and 90 degrees (or between 60 and 80 degrees with track filler creating a smooth crossing for cyclists).",red:"Crossing angle between 60 and 80 degrees.",critical:"Crossing angle less than 60 degrees."},SA14:{description:`Cycling surface and maintenance defects:
• sharp gradients (≥12.5%)
• non cycle friendly ironworks
• raised/sunken covers or gullies
• potholes
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA15:{description:`Walking/wheeling surface and maintenance defects:
• steep camber (horizontal gradient >2.5% )
• steep longitudinal gradients (≥8% if under 1m, ≥5% if 1m or over) 
• missing dropped kerbs
• non flush tables
• misleading tactile information
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation
`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA16:{description:"Presence of guard railing",green:"No guard railing anywhere on the route.",amber:"Minimal guard railing, used to address a clear safety issue such as a level difference.",red:"Guard railing used to control behaviour in complex environments.",critical:"Guard railing used as standard without consideration of inherent safety risks."},ST20:{description:"Interactions at bus stops.",green:"At bus stops, cyclists are protected from buses and traffic and interactions between pedestrians and cyclists are likely to be low-level.",amber:"At bus stops, cyclists are protected from buses and traffic, but there are likely to be medium-level interactions between pedestrians and cyclists.",red:"At bus stops, cyclists regularly have to wait behind buses or overtake them in general traffic lanes. Or, there are likely to be high-level interactions between pedestrians and cyclists.",critical:""}};function dn(n){let e,r,t,o=n[0].critical+"",i;return{c(){e=v("p"),r=v("b"),r.textContent="Critical",t=O(`
    : `),i=O(o)},m(l,s){y(l,e,s),m(e,r),m(e,t),m(e,i)},p(l,s){s&1&&o!==(o=l[0].critical+"")&&re(i,o)},d(l){l&&A(e)}}}function Uo(n){let e,r,t,o=n[0].green+"",i,l,s,a,u,c=n[0].amber+"",f,d,p,$,j,T=n[0].red+"",g,_,b,k=n[0].critical&&dn(n);return{c(){e=v("p"),r=v("b"),r.textContent="2",t=O(`
  : `),i=O(o),l=L(),s=v("p"),a=v("b"),a.textContent="1",u=O(`
  : `),f=O(c),d=L(),p=v("p"),$=v("b"),$.textContent="0",j=O(`
  : `),g=O(T),_=L(),k&&k.c(),b=Ue()},m(S,w){y(S,e,w),m(e,r),m(e,t),m(e,i),y(S,l,w),y(S,s,w),m(s,a),m(s,u),m(s,f),y(S,d,w),y(S,p,w),m(p,$),m(p,j),m(p,g),y(S,_,w),k&&k.m(S,w),y(S,b,w)},p(S,[w]){w&1&&o!==(o=S[0].green+"")&&re(i,o),w&1&&c!==(c=S[0].amber+"")&&re(f,c),w&1&&T!==(T=S[0].red+"")&&re(g,T),S[0].critical?k?k.p(S,w):(k=dn(S),k.c(),k.m(b.parentNode,b)):k&&(k.d(1),k=null)},i:se,o:se,d(S){S&&(A(e),A(l),A(s),A(d),A(p),A(_),A(b)),k&&k.d(S)}}}function Ro(n,e,r){let{metric:t}=e;return n.$$set=o=>{"metric"in o&&r(0,t=o.metric)},[t]}class vt extends oe{constructor(e){super(),ie(this,e,Ro,Uo,ne,{metric:0})}}let Ot=Ee(void 0),W=Ee(Go());function de(n){return{type:"FeatureCollection",features:n}}let X=Ee({kind:"neutral"}),Vt=Ee(new URLSearchParams(window.location.search).has("google")?"google":"dataviz");function Wr(n){return"links"in n&&"jats"in n&&"bus_stops"&&"crossings"in n}function Go(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if(Wr(n))return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[]}}function pn(n){let e,r;return e=new we({props:{data:de(n[3].links),$$slots:{default:[Jo]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.data=de(t[3].links)),o&22&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Jo(n){let e,r;return e=new qe({props:{paint:{"line-color":n[1]=="links"?["get","color"]:"black","line-width":n[1]=="links"&&n[2]?["case",["to-boolean",n[2]],6,15]:6}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&6&&(i.paint={"line-color":t[1]=="links"?["get","color"]:"black","line-width":t[1]=="links"&&t[2]?["case",["to-boolean",t[2]],6,15]:6}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function mn(n){let e,r;return e=new we({props:{data:de(n[3].bus_stops),$$slots:{default:[Qo]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.data=de(t[3].bus_stops)),o&22&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Qo(n){let e,r;return e=new Ye({props:{layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":n[1]=="bus_stops"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":n[1]=="bus_stops"&&n[2]?["case",["to-boolean",n[2]],0,5]:0}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&6&&(i.paint={"icon-color":t[1]=="bus_stops"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":t[1]=="bus_stops"&&t[2]?["case",["to-boolean",t[2]],0,5]:0}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function gn(n){let e,r;return e=new we({props:{data:de(n[3].crossings),$$slots:{default:[Ho]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.data=de(t[3].crossings)),o&22&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ho(n){let e,r;return e=new Ye({props:{layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":n[1]=="crossings"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":n[1]=="crossings"&&n[2]?["case",["to-boolean",n[2]],0,5]:0}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&6&&(i.paint={"icon-color":t[1]=="crossings"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":t[1]=="crossings"&&t[2]?["case",["to-boolean",t[2]],0,5]:0}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function _n(n){let e,r;return e=new we({props:{data:de(n[3].jats),$$slots:{default:[Ko]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.data=de(t[3].jats)),o&18&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ko(n){let e,r;return e=new Ze({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-color":n[1]=="jats"?["get","color"]:"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&2&&(i.paint={"circle-color":"rgba(0,0,0,0)","circle-stroke-color":t[1]=="jats"?["get","color"]:"black","circle-radius":20}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Wo(n){let e,r,t,o,i,l=n[0]!="links"&&pn(n),s=n[0]!="bus_stops"&&mn(n),a=n[0]!="crossings"&&gn(n),u=n[0]!="jats"&&_n(n);return{c(){l&&l.c(),e=L(),s&&s.c(),r=L(),a&&a.c(),t=L(),u&&u.c(),o=Ue()},m(c,f){l&&l.m(c,f),y(c,e,f),s&&s.m(c,f),y(c,r,f),a&&a.m(c,f),y(c,t,f),u&&u.m(c,f),y(c,o,f),i=!0},p(c,[f]){c[0]!="links"?l?(l.p(c,f),f&1&&h(l,1)):(l=pn(c),l.c(),h(l,1),l.m(e.parentNode,e)):l&&(ce(),C(l,1,1,()=>{l=null}),ue()),c[0]!="bus_stops"?s?(s.p(c,f),f&1&&h(s,1)):(s=mn(c),s.c(),h(s,1),s.m(r.parentNode,r)):s&&(ce(),C(s,1,1,()=>{s=null}),ue()),c[0]!="crossings"?a?(a.p(c,f),f&1&&h(a,1)):(a=gn(c),a.c(),h(a,1),a.m(t.parentNode,t)):a&&(ce(),C(a,1,1,()=>{a=null}),ue()),c[0]!="jats"?u?(u.p(c,f),f&1&&h(u,1)):(u=_n(c),u.c(),h(u,1),u.m(o.parentNode,o)):u&&(ce(),C(u,1,1,()=>{u=null}),ue())},i(c){i||(h(l),h(s),h(a),h(u),i=!0)},o(c){C(l),C(s),C(a),C(u),i=!1},d(c){c&&(A(e),A(r),A(t),A(o)),l&&l.d(c),s&&s.d(c),a&&a.d(c),u&&u.d(c)}}}function Zo(n,e,r){let t;ee(n,W,s=>r(3,t=s));let{except:o}=e,{showColor:i=""}=e,{showMissingProperty:l=null}=e;return n.$$set=s=>{"except"in s&&r(0,o=s.except),"showColor"in s&&r(1,i=s.showColor),"showMissingProperty"in s&&r(2,l=s.showMissingProperty)},[o,i,l,t]}class Ge extends oe{constructor(e){super(),ie(this,e,Zo,Wo,ne,{except:0,showColor:1,showMissingProperty:2})}}function hn(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function bn(n){let e,r,t=n[6].properties.name+"",o,i,l,s,a,u;function c(d){n[5](d,n[6])}let f={k:"horiz-radio",choices:ye()};return n[6].properties.st20!==void 0&&(f.value=n[6].properties.st20),l=new Te({props:f}),fe.push(()=>ge(l,"value",c)),{c(){e=v("li"),r=v("span"),o=O(t),i=L(),M(l.$$.fragment),a=L(),Z(r,"color",n[6].properties.color)},m(d,p){y(d,e,p),m(e,r),m(r,o),m(e,i),B(l,e,null),m(e,a),u=!0},p(d,p){n=d,(!u||p&2)&&t!==(t=n[6].properties.name+"")&&re(o,t),p&2&&Z(r,"color",n[6].properties.color);const $={};!s&&p&2&&(s=!0,$.value=n[6].properties.st20,_e(()=>s=!1)),l.$set($)},i(d){u||(h(l.$$.fragment,d),u=!0)},o(d){C(l.$$.fragment,d),u=!1},d(d){d&&A(e),E(l)}}}function Xo(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$=x(n[1].bus_stops),j=[];for(let g=0;g<$.length;g+=1)j[g]=bn(hn(n,$,g));const T=g=>C(j[g],1,1,()=>{j[g]=null});return c=new vt({props:{metric:n[2]}}),{c(){e=v("div"),r=v("button"),r.textContent="Done",t=L(),o=v("h2"),o.textContent="ST20: bus stops",i=L(),l=v("p"),l.textContent=`${n[2].description}`,s=L(),a=v("ol");for(let g=0;g<j.length;g+=1)j[g].c();u=L(),M(c.$$.fragment),P(e,"slot","sidebar")},m(g,_){y(g,e,_),m(e,r),m(e,t),m(e,o),m(e,i),m(e,l),m(e,s),m(e,a);for(let b=0;b<j.length;b+=1)j[b]&&j[b].m(a,null);m(e,u),B(c,e,null),f=!0,d||(p=H(r,"click",n[4]),d=!0)},p(g,_){if(_&2){$=x(g[1].bus_stops);let b;for(b=0;b<$.length;b+=1){const k=hn(g,$,b);j[b]?(j[b].p(k,_),h(j[b],1)):(j[b]=bn(k),j[b].c(),h(j[b],1),j[b].m(a,null))}for(ce(),b=$.length;b<j.length;b+=1)T(b);ue()}},i(g){if(!f){for(let _=0;_<$.length;_+=1)h(j[_]);h(c.$$.fragment,g),f=!0}},o(g){j=j.filter(Boolean);for(let _=0;_<j.length;_+=1)C(j[_]);C(c.$$.fragment,g),f=!1},d(g){g&&A(e),pe(j,g),E(c),d=!1,p()}}}function Vo(n){let e,r,t;return r=new Ge({props:{showColor:"bus_stops",except:"",showMissingProperty:["get","st20"]}}),{c(){e=v("div"),M(r.$$.fragment),P(e,"slot","map")},m(o,i){y(o,e,i),B(r,e,null),t=!0},p:se,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){C(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function Yo(n){let e,r,t,o;return e=new De({props:{$$slots:{map:[Vo],sidebar:[Xo]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=H(window,"keydown",n[3]),t=!0)},p(i,[l]){const s={};l&515&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function xo(n,e,r){let t,o;ee(n,X,u=>r(0,t=u)),ee(n,W,u=>r(1,o=u));let i=Ve.ST20;function l(u){u.key=="Escape"&&Y(X,t={kind:"neutral"},t)}const s=()=>Y(X,t={kind:"neutral"},t);function a(u,c){n.$$.not_equal(c.properties.st20,u)&&(c.properties.st20=u,W.set(o))}return[t,o,i,l,s,a]}class ei extends oe{constructor(e){super(),ie(this,e,xo,Yo,ne,{})}}function ti(n){let e,r;const t=n[4].default,o=Ie(t,n,n[6],null);return{c(){e=v("span"),o&&o.c(),P(e,"class","dot svelte-117v9mi"),ve(e,"outline",n[3]),Z(e,"background-color",n[3]?void 0:n[1]),Z(e,"border-color",n[3]?n[1]:void 0),Z(e,"width",n[2]),Z(e,"height",n[2])},m(i,l){y(i,e,l),o&&o.m(e,null),r=!0},p(i,l){o&&o.p&&(!r||l&64)&&Oe(o,t,i,i[6],r?Fe(t,i[6],l,null):Pe(i[6]),null),(!r||l&8)&&ve(e,"outline",i[3]),l&10&&Z(e,"background-color",i[3]?void 0:i[1]),l&10&&Z(e,"border-color",i[3]?i[1]:void 0),l&4&&Z(e,"width",i[2]),l&4&&Z(e,"height",i[2])},i(i){r||(h(o,i),r=!0)},o(i){C(o,i),r=!1},d(i){i&&A(e),o&&o.d(i)}}}function ni(n){let e,r,t;function o(l){n[5](l)}let i={draggable:!0,$$slots:{default:[ti]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.lngLat=n[0]),e=new Ke({props:i}),fe.push(()=>ge(e,"lngLat",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,[s]){const a={};s&78&&(a.$$scope={dirty:s,ctx:l}),!r&&s&1&&(r=!0,a.lngLat=l[0],_e(()=>r=!1)),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function ri(n,e,r){let{$$slots:t={},$$scope:o}=e,{lngLat:i}=e,{color:l}=e,{radius:s="30px"}=e,{outline:a=!1}=e;function u(c){i=c,r(0,i)}return n.$$set=c=>{"lngLat"in c&&r(0,i=c.lngLat),"color"in c&&r(1,l=c.color),"radius"in c&&r(2,s=c.radius),"outline"in c&&r(3,a=c.outline),"$$scope"in c&&r(6,o=c.$$scope)},[i,l,s,a,t,u,o]}class xt extends oe{constructor(e){super(),ie(this,e,ri,ni,ne,{lngLat:0,color:1,radius:2,outline:3})}}const{window:oi}=kt;function ii(n){let e;return{c(){e=O("ST20: bus stops")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function li(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$;function j(g){n[8](g)}let T={k:"horiz-radio",choices:ye(),$$slots:{default:[ii]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].properties.st20!==void 0&&(T.value=n[1].bus_stops[n[0]].properties.st20),c=new Te({props:T}),fe.push(()=>ge(c,"value",j)),{c(){e=v("div"),r=v("button"),r.textContent="Done",t=L(),o=v("button"),o.textContent="Delete bus stop",i=L(),l=v("label"),s=O(`Name:
      `),a=v("input"),u=L(),M(c.$$.fragment),P(a,"type","text"),P(e,"slot","sidebar")},m(g,_){y(g,e,_),m(e,r),m(e,t),m(e,o),m(e,i),m(e,l),m(l,s),m(l,a),ke(a,n[1].bus_stops[n[0]].properties.name),m(e,u),B(c,e,null),d=!0,p||($=[H(r,"click",n[6]),H(o,"click",n[4]),H(a,"input",n[7])],p=!0)},p(g,_){_&3&&a.value!==g[1].bus_stops[g[0]].properties.name&&ke(a,g[1].bus_stops[g[0]].properties.name);const b={};_&512&&(b.$$scope={dirty:_,ctx:g}),!f&&_&3&&(f=!0,b.value=g[1].bus_stops[g[0]].properties.st20,_e(()=>f=!1)),c.$set(b)},i(g){d||(h(c.$$.fragment,g),d=!0)},o(g){C(c.$$.fragment,g),d=!1},d(g){g&&A(e),E(c),p=!1,Ce($)}}}function si(n){let e,r;return e=new Ye({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.filter=["!=",["id"],t[0]]),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ai(n){let e,r;return{c(){e=v("img"),bt(e.src,r=Hr)||P(e,"src",r),P(e,"alt","")},m(t,o){y(t,e,o)},p:se,d(t){t&&A(e)}}}function ci(n){let e,r,t,o,i,l,s,a;r=new Ge({props:{except:"bus_stops"}}),o=new we({props:{data:de(n[1].bus_stops),generateId:!0,$$slots:{default:[si]},$$scope:{ctx:n}}});function u(f){n[5](f)}let c={color:n[1].bus_stops[n[0]].properties.color,$$slots:{default:[ai]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),l=new xt({props:c}),fe.push(()=>ge(l,"lngLat",u)),{c(){e=v("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),i=L(),M(l.$$.fragment),P(e,"slot","map")},m(f,d){y(f,e,d),B(r,e,null),m(e,t),B(o,e,null),m(e,i),B(l,e,null),a=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].bus_stops)),d&513&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const $={};d&3&&($.color=f[1].bus_stops[f[0]].properties.color),d&512&&($.$$scope={dirty:d,ctx:f}),!s&&d&3&&(s=!0,$.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,_e(()=>s=!1)),l.$set($)},i(f){a||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(l.$$.fragment,f),a=!0)},o(f){C(r.$$.fragment,f),C(o.$$.fragment,f),C(l.$$.fragment,f),a=!1},d(f){f&&A(e),E(r),E(o),E(l)}}}function ui(n){let e,r,t,o;return e=new De({props:{$$slots:{map:[ci],sidebar:[li]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=H(oi,"keydown",n[3]),t=!0)},p(i,[l]){const s={};l&519&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function fi(n,e,r){let t,o;ee(n,W,d=>r(1,t=d)),ee(n,X,d=>r(2,o=d));let{idx:i}=e;function l(d){d.key=="Escape"&&Y(X,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this bus stop?")&&(Y(X,o={kind:"neutral"},o),await lt(),t.bus_stops.splice(i,1),W.set(t))}function a(d){n.$$.not_equal(t.bus_stops[i].geometry.coordinates,d)&&(t.bus_stops[i].geometry.coordinates=d,W.set(t))}const u=()=>Y(X,o={kind:"neutral"},o);function c(){t.bus_stops[i].properties.name=this.value,W.set(t)}function f(d){n.$$.not_equal(t.bus_stops[i].properties.st20,d)&&(t.bus_stops[i].properties.st20=d,W.set(t))}return n.$$set=d=>{"idx"in d&&r(0,i=d.idx)},[i,t,o,l,s,a,u,c,f]}class di extends oe{constructor(e){super(),ie(this,e,fi,ui,ne,{idx:0})}}function pi(n){let e,r,t;function o(l){n[1](l)}let i={k:"dropdown",choices:mi()};return n[0]!==void 0&&(i.value=n[0]),e=new Te({props:i}),fe.push(()=>ge(e,"value",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,[s]){const a={};!r&&s&1&&(r=!0,a.value=l[0],_e(()=>r=!1)),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function mi(){let n=[["streets","MapTiler Streets"],["dataviz","MapTiler Dataviz"],["uk-openzoomstack-light","OS Open Zoomstack"],["openstreetmap","OpenStreetMap"]];return new URLSearchParams(window.location.search).has("google")&&n.splice(0,1,["google","Google satellite"]),n}function gi(n,e,r){let t;ee(n,Vt,i=>r(0,t=i));function o(i){t=i,Vt.set(t)}return[t,o]}class _i extends oe{constructor(e){super(),ie(this,e,gi,pi,ne,{})}}function $n(n,e,r){const t=n.slice();return t[1]=e[r][0],t[2]=e[r][1],t}function kn(n){let e,r,t,o=n[1]+"",i,l;return{c(){e=v("li"),r=v("span"),t=L(),i=O(o),l=L(),P(r,"class","svelte-kzgqtg"),Z(r,"background",n[2])},m(s,a){y(s,e,a),m(e,r),m(e,t),m(e,i),m(e,l)},p(s,a){a&1&&Z(r,"background",s[2]),a&1&&o!==(o=s[1]+"")&&re(i,o)},d(s){s&&A(e)}}}function hi(n){let e,r=x(n[0]),t=[];for(let o=0;o<r.length;o+=1)t[o]=kn($n(n,r,o));return{c(){e=v("ul");for(let o=0;o<t.length;o+=1)t[o].c()},m(o,i){y(o,e,i);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(o,[i]){if(i&1){r=x(o[0]);let l;for(l=0;l<r.length;l+=1){const s=$n(o,r,l);t[l]?t[l].p(s,i):(t[l]=kn(s),t[l].c(),t[l].m(e,null))}for(;l<t.length;l+=1)t[l].d(1);t.length=r.length}},i:se,o:se,d(o){o&&A(e),pe(t,o)}}}function bi(n,e,r){let{rows:t}=e;return n.$$set=o=>{"rows"in o&&r(0,t=o.rows)},[t]}class $i extends oe{constructor(e){super(),ie(this,e,bi,hi,ne,{rows:0})}}const ki=n=>({dialog:n&1}),wn=n=>({dialog:n[0]});function wi(n){let e,r,t,o,i;const l=n[4].default,s=Ie(l,n,n[3],wn);return{c(){e=v("dialog"),r=v("article"),s&&s.c(),e.open=!0},m(a,u){y(a,e,u),m(e,r),s&&s.m(r,null),n[6](e),t=!0,o||(i=[H(window,"click",n[1]),H(window,"keydown",n[2]),H(e,"close",n[5])],o=!0)},p(a,[u]){s&&s.p&&(!t||u&9)&&Oe(s,l,a,a[3],t?Fe(l,a[3],u,ki):Pe(a[3]),wn)},i(a){t||(h(s,a),t=!0)},o(a){C(s,a),t=!1},d(a){a&&A(e),s&&s.d(a),n[6](null),o=!1,Ce(i)}}}function vi(n,e,r){let{$$slots:t={},$$scope:o}=e,i;function l(c){i.open&&c.target==i&&i.close()}function s(c){(c.key=="Escape"||c.key=="Enter")&&(c.stopPropagation(),i.close())}function a(c){ze.call(this,n,c)}function u(c){fe[c?"unshift":"push"](()=>{i=c,r(0,i)})}return n.$$set=c=>{"$$scope"in c&&r(3,o=c.$$scope)},[i,l,s,o,t,a,u]}class Ut extends oe{constructor(e){super(),ie(this,e,vi,wi,ne,{})}}function vn(n,e,r){const t=n.slice();return t[3]=e[r],t}function yn(n,e,r){const t=n.slice();return t[6]=e[r],t}function An(n){let e,r;return{c(){e=v("span"),r=O(` 
    `),Z(e,"background",n[6]),Z(e,"width","100%"),Z(e,"border","1px solid black")},m(t,o){y(t,e,o),m(e,r)},p(t,o){o&1&&Z(e,"background",t[6])},d(t){t&&A(e)}}}function yi(n){let e,r=n[3]+"",t;return{c(){e=v("span"),t=O(r)},m(o,i){y(o,e,i),m(e,t)},p(o,i){i&2&&r!==(r=o[3]+"")&&re(t,r)},d(o){o&&A(e)}}}function Ai(n){let e,r=n[3].toFixed(n[2])+"",t;return{c(){e=v("span"),t=O(r)},m(o,i){y(o,e,i),m(e,t)},p(o,i){i&6&&r!==(r=o[3].toFixed(o[2])+"")&&re(t,r)},d(o){o&&A(e)}}}function Cn(n){let e;function r(i,l){return i[2]>0?Ai:yi}let t=r(n),o=t(n);return{c(){o.c(),e=Ue()},m(i,l){o.m(i,l),y(i,e,l)},p(i,l){t===(t=r(i))&&o?o.p(i,l):(o.d(1),o=t(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){i&&A(e),o.d(i)}}}function Ci(n){let e,r,t,o=x(n[0]),i=[];for(let a=0;a<o.length;a+=1)i[a]=An(yn(n,o,a));let l=x(n[1]),s=[];for(let a=0;a<l.length;a+=1)s[a]=Cn(vn(n,l,a));return{c(){e=v("div");for(let a=0;a<i.length;a+=1)i[a].c();r=L(),t=v("div");for(let a=0;a<s.length;a+=1)s[a].c();Z(e,"display","flex"),Z(t,"display","flex"),Z(t,"justify-content","space-between")},m(a,u){y(a,e,u);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);y(a,r,u),y(a,t,u);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(t,null)},p(a,[u]){if(u&1){o=x(a[0]);let c;for(c=0;c<o.length;c+=1){const f=yn(a,o,c);i[c]?i[c].p(f,u):(i[c]=An(f),i[c].c(),i[c].m(e,null))}for(;c<i.length;c+=1)i[c].d(1);i.length=o.length}if(u&6){l=x(a[1]);let c;for(c=0;c<l.length;c+=1){const f=vn(a,l,c);s[c]?s[c].p(f,u):(s[c]=Cn(f),s[c].c(),s[c].m(t,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=l.length}},i:se,o:se,d(a){a&&(A(e),A(r),A(t)),pe(i,a),pe(s,a)}}}function ji(n,e,r){let{colorScale:t}=e,{limits:o}=e,{decimalPlaces:i=0}=e;return n.$$set=l=>{"colorScale"in l&&r(0,t=l.colorScale),"limits"in l&&r(1,o=l.limits),"decimalPlaces"in l&&r(2,i=l.decimalPlaces)},[t,o,i]}class Si extends oe{constructor(e){super(),ie(this,e,ji,Ci,ne,{colorScale:0,limits:1,decimalPlaces:2})}}function zi(n,e){let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function Li(n){let e;return{c(){e=O("Bus stops")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function jn(n){let e,r,t,o,i;return o=new Si({props:{colorScale:n[1],limits:n[2]}}),{c(){e=v("div"),r=v("p"),r.textContent="Peak hourly frequency:",t=L(),M(o.$$.fragment),P(e,"class","svelte-yxmabo")},m(l,s){y(l,e,s),m(e,r),m(e,t),B(o,e,null),i=!0},p:se,i(l){i||(h(o.$$.fragment,l),i=!0)},o(l){C(o.$$.fragment,l),i=!1},d(l){l&&A(e),E(o)}}}function Mi(n){let e,r,t,o=n[4].stop_name+"",i,l,s,a,u,c=n[4].peak+"",f,d,p,$,j,T=n[4].peak_description+"",g,_,b,k,S,w=n[4].total+"",z,N,U=n[4].total_description+"",F,V;return{c(){e=v("p"),r=O("Stop name: "),t=v("b"),i=O(o),l=L(),s=v("p"),a=O("Peak: "),u=v("b"),f=O(c),d=O(`
        buses during the busiest hour of any day`),p=L(),$=v("p"),j=O("The peak hour is "),g=O(T),_=L(),b=v("p"),k=O("Total buses per day: "),S=v("b"),z=O(w),N=O(`
        (for `),F=O(U),V=O(", the busiest day of the week)")},m(D,q){y(D,e,q),m(e,r),m(e,t),m(t,i),y(D,l,q),y(D,s,q),m(s,a),m(s,u),m(u,f),m(s,d),y(D,p,q),y(D,$,q),m($,j),m($,g),y(D,_,q),y(D,b,q),m(b,k),m(b,S),m(S,z),m(b,N),m(b,F),m(b,V)},p(D,q){q&16&&o!==(o=D[4].stop_name+"")&&re(i,o),q&16&&c!==(c=D[4].peak+"")&&re(f,c),q&16&&T!==(T=D[4].peak_description+"")&&re(g,T),q&16&&w!==(w=D[4].total+"")&&re(z,w),q&16&&U!==(U=D[4].total_description+"")&&re(F,U)},d(D){D&&(A(e),A(l),A(s),A(p),A($),A(_),A(b))}}}function Bi(n){let e,r;return e=new st({props:{$$slots:{default:[Mi,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&48&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ei(n){let e,r;return e=new Ze({props:{sourceLayer:"bus_stops",paint:{"circle-color":ho(["get","peak"],n[2],n[1]),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},manageHoverState:!0,$$slots:{default:[Bi]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.layout={visibility:t[0]?"visible":"none"}),o&32&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ti(n){let e,r,t,o,i;e=new Jr({props:{$$slots:{default:[Li]},$$scope:{ctx:n}}}),e.$on("click",n[3]);let l=n[0]&&jn(n);return o=new Qr({props:{url:"pmtiles://https://atip.uk/layers/v1/bus_stops.pmtiles",$$slots:{default:[Ei]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),l&&l.c(),t=L(),M(o.$$.fragment)},m(s,a){B(e,s,a),y(s,r,a),l&&l.m(s,a),y(s,t,a),B(o,s,a),i=!0},p(s,[a]){const u={};a&32&&(u.$$scope={dirty:a,ctx:s}),e.$set(u),s[0]?l?(l.p(s,a),a&1&&h(l,1)):(l=jn(s),l.c(),h(l,1),l.m(t.parentNode,t)):l&&(ce(),C(l,1,1,()=>{l=null}),ue());const c={};a&33&&(c.$$scope={dirty:a,ctx:s}),o.$set(c)},i(s){i||(h(e.$$.fragment,s),h(l),h(o.$$.fragment,s),i=!0)},o(s){C(e.$$.fragment,s),C(l),C(o.$$.fragment,s),i=!1},d(s){s&&(A(r),A(t)),E(e,s),l&&l.d(s),E(o,s)}}}function Di(n,e,r){let t=!1;return[t,["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],[0,3,10,20,30,100],()=>r(0,t=!t)]}class Ni extends oe{constructor(e){super(),ie(this,e,Di,Ti,ne,{})}}function Ii(n){let e;return{c(){e=O("Crossings")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Sn(n){let e,r,t;return r=new $i({props:{rows:n[1]}}),{c(){e=v("div"),M(r.$$.fragment),P(e,"class","svelte-yxmabo")},m(o,i){y(o,e,i),B(r,e,null),t=!0},p:se,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){C(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function Oi(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=v("p"),t=O(r),o=O(" crossing")},m(i,l){y(i,e,l),m(e,t),m(e,o)},p(i,l){l&8&&r!==(r=(i[3].class||"Unknown")+"")&&re(t,r)},d(i){i&&A(e)}}}function Pi(n){let e,r;return e=new st({props:{$$slots:{default:[Oi,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&24&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Fi(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=v("p"),t=O(r),o=O(" crossing")},m(i,l){y(i,e,l),m(e,t),m(e,o)},p(i,l){l&8&&r!==(r=(i[3].class||"Unknown")+"")&&re(t,r)},d(i){i&&A(e)}}}function qi(n){let e,r;return e=new st({props:{$$slots:{default:[Fi,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&24&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ui(n){let e,r,t,o;return e=new qe({props:{sourceLayer:"crossings",filter:bo,paint:{"line-color":on(["get","class"],Object.fromEntries(n[1]),"red"),"line-width":3},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[Pi]},$$scope:{ctx:n}}}),e.$on("click",zn),t=new Ze({props:{sourceLayer:"crossings",filter:$o,paint:{"circle-color":on(["get","class"],Object.fromEntries(n[1]),"red"),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[qi]},$$scope:{ctx:n}}}),t.$on("click",zn),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment)},m(i,l){B(e,i,l),y(i,r,l),B(t,i,l),o=!0},p(i,l){const s={};l&1&&(s.layout={visibility:i[0]?"visible":"none"}),l&16&&(s.$$scope={dirty:l,ctx:i}),e.$set(s);const a={};l&1&&(a.layout={visibility:i[0]?"visible":"none"}),l&16&&(a.$$scope={dirty:l,ctx:i}),t.$set(a)},i(i){o||(h(e.$$.fragment,i),h(t.$$.fragment,i),o=!0)},o(i){C(e.$$.fragment,i),C(t.$$.fragment,i),o=!1},d(i){i&&A(r),E(e,i),E(t,i)}}}function Ri(n){let e,r,t,o,i;e=new Jr({props:{$$slots:{default:[Ii]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let l=n[0]&&Sn(n);return o=new Qr({props:{url:"pmtiles://https://atip.uk/layers/v1/crossings.pmtiles",$$slots:{default:[Ui]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),l&&l.c(),t=L(),M(o.$$.fragment)},m(s,a){B(e,s,a),y(s,r,a),l&&l.m(s,a),y(s,t,a),B(o,s,a),i=!0},p(s,[a]){const u={};a&16&&(u.$$scope={dirty:a,ctx:s}),e.$set(u),s[0]?l?(l.p(s,a),a&1&&h(l,1)):(l=Sn(s),l.c(),h(l,1),l.m(t.parentNode,t)):l&&(ce(),C(l,1,1,()=>{l=null}),ue());const c={};a&17&&(c.$$scope={dirty:a,ctx:s}),o.$set(c)},i(s){i||(h(e.$$.fragment,s),h(l),h(o.$$.fragment,s),i=!0)},o(s){C(e.$$.fragment,s),C(l),C(o.$$.fragment,s),i=!1},d(s){s&&(A(r),A(t)),E(e,s),l&&l.d(s),E(o,s)}}}function zn(n){window.open(`https://www.openstreetmap.org/${n.detail.features[0].properties.osm}`,"_blank")}function Gi(n,e,r){let t=!1;return[t,[["Zebra","#66C5CC"],["Parallel","#F6CF71"],["Pelican","#F89C74"],["Puffin","#DCB0F2"],["Toucan","#87C55F"],["Pegasus","#9EB9F3"],["Uncontrolled","#FE88B1"],["Signalised","#C9DB74"],["Unknown","red"]],()=>r(0,t=!t)]}class Ji extends oe{constructor(e){super(),ie(this,e,Gi,Ri,ne,{})}}function Qi(n){let e,r;return e=new wt({}),e.$on("contextmenu",Hi),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Hi(n){let e=n.detail.lngLat.lng,r=n.detail.lngLat.lat;window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${r},${e}&cbp=11,0,0,0,0`,"_blank")}class Ki extends oe{constructor(e){super(),ie(this,e,null,Qi,ne,{})}}function Wi(n){let e,r,t,o,i,l,s;return r=new Ni({}),o=new Ji({}),l=new _i({}),{c(){e=v("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),i=L(),M(l.$$.fragment),Z(e,"display","flex"),Z(e,"flex-direction","column")},m(a,u){y(a,e,u),B(r,e,null),m(e,t),B(o,e,null),m(e,i),B(l,e,null),s=!0},p:se,i(a){s||(h(r.$$.fragment,a),h(o.$$.fragment,a),h(l.$$.fragment,a),s=!0)},o(a){C(r.$$.fragment,a),C(o.$$.fragment,a),C(l.$$.fragment,a),s=!1},d(a){a&&A(e),E(r),E(o),E(l)}}}function Zi(n){let e,r,t,o;return e=new Ki({}),t=new So({props:{$$slots:{default:[Wi]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment)},m(i,l){B(e,i,l),y(i,r,l),B(t,i,l),o=!0},p(i,[l]){const s={};l&1&&(s.$$scope={dirty:l,ctx:i}),t.$set(s)},i(i){o||(h(e.$$.fragment,i),h(t.$$.fragment,i),o=!0)},o(i){C(e.$$.fragment,i),C(t.$$.fragment,i),o=!1},d(i){i&&A(r),E(e,i),E(t,i)}}}class Xi extends oe{constructor(e){super(),ie(this,e,null,Zi,ne,{})}}function Ln(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function Mn(n){let e,r,t=n[6].properties.name+"",o,i,l,s,a,u;function c(d){n[5](d,n[6])}let f={k:"horiz-radio",choices:ye()};return n[6].properties.sa10!==void 0&&(f.value=n[6].properties.sa10),l=new Te({props:f}),fe.push(()=>ge(l,"value",c)),{c(){e=v("li"),r=v("span"),o=O(t),i=L(),M(l.$$.fragment),a=L(),Z(r,"color",n[6].properties.color)},m(d,p){y(d,e,p),m(e,r),m(r,o),m(e,i),B(l,e,null),m(e,a),u=!0},p(d,p){n=d,(!u||p&2)&&t!==(t=n[6].properties.name+"")&&re(o,t),p&2&&Z(r,"color",n[6].properties.color);const $={};!s&&p&2&&(s=!0,$.value=n[6].properties.sa10,_e(()=>s=!1)),l.$set($)},i(d){u||(h(l.$$.fragment,d),u=!0)},o(d){C(l.$$.fragment,d),u=!1},d(d){d&&A(e),E(l)}}}function Vi(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$=x(n[1].crossings),j=[];for(let g=0;g<$.length;g+=1)j[g]=Mn(Ln(n,$,g));const T=g=>C(j[g],1,1,()=>{j[g]=null});return c=new vt({props:{metric:n[2]}}),{c(){e=v("div"),r=v("button"),r.textContent="Done",t=L(),o=v("h2"),o.textContent="SA10: pedestrian crossing speed",i=L(),l=v("p"),l.textContent=`${n[2].description}`,s=L(),a=v("ol");for(let g=0;g<j.length;g+=1)j[g].c();u=L(),M(c.$$.fragment),P(e,"slot","sidebar")},m(g,_){y(g,e,_),m(e,r),m(e,t),m(e,o),m(e,i),m(e,l),m(e,s),m(e,a);for(let b=0;b<j.length;b+=1)j[b]&&j[b].m(a,null);m(e,u),B(c,e,null),f=!0,d||(p=H(r,"click",n[4]),d=!0)},p(g,_){if(_&2){$=x(g[1].crossings);let b;for(b=0;b<$.length;b+=1){const k=Ln(g,$,b);j[b]?(j[b].p(k,_),h(j[b],1)):(j[b]=Mn(k),j[b].c(),h(j[b],1),j[b].m(a,null))}for(ce(),b=$.length;b<j.length;b+=1)T(b);ue()}},i(g){if(!f){for(let _=0;_<$.length;_+=1)h(j[_]);h(c.$$.fragment,g),f=!0}},o(g){j=j.filter(Boolean);for(let _=0;_<j.length;_+=1)C(j[_]);C(c.$$.fragment,g),f=!1},d(g){g&&A(e),pe(j,g),E(c),d=!1,p()}}}function Yi(n){let e,r,t;return r=new Ge({props:{showColor:"crossings",except:"",showMissingProperty:["get","sa10"]}}),{c(){e=v("div"),M(r.$$.fragment),P(e,"slot","map")},m(o,i){y(o,e,i),B(r,e,null),t=!0},p:se,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){C(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function xi(n){let e,r,t,o;return e=new De({props:{$$slots:{map:[Yi],sidebar:[Vi]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=H(window,"keydown",n[3]),t=!0)},p(i,[l]){const s={};l&515&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function el(n,e,r){let t,o;ee(n,X,u=>r(0,t=u)),ee(n,W,u=>r(1,o=u));let i=Ve.SA10;function l(u){u.key=="Escape"&&Y(X,t={kind:"neutral"},t)}const s=()=>Y(X,t={kind:"neutral"},t);function a(u,c){n.$$.not_equal(c.properties.sa10,u)&&(c.properties.sa10=u,W.set(o))}return[t,o,i,l,s,a]}class tl extends oe{constructor(e){super(),ie(this,e,el,xi,ne,{})}}const{window:nl}=kt;function rl(n){let e;return{c(){e=O("SA10: pedestrian crossing speed")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function ol(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$,j,T,g,_;function b(S){n[9](S)}let k={k:"horiz-radio",choices:ye(),$$slots:{default:[rl]},$$scope:{ctx:n}};return n[1].crossings[n[0]].properties.sa10!==void 0&&(k.value=n[1].crossings[n[0]].properties.sa10),c=new Te({props:k}),fe.push(()=>ge(c,"value",b)),j=new vt({props:{metric:n[3]}}),{c(){e=v("div"),r=v("button"),r.textContent="Done",t=L(),o=v("button"),o.textContent="Delete crossing",i=L(),l=v("label"),s=O(`Name:
      `),a=v("input"),u=L(),M(c.$$.fragment),d=L(),p=v("p"),p.textContent=`${n[3].description}`,$=L(),M(j.$$.fragment),P(a,"type","text"),P(e,"slot","sidebar")},m(S,w){y(S,e,w),m(e,r),m(e,t),m(e,o),m(e,i),m(e,l),m(l,s),m(l,a),ke(a,n[1].crossings[n[0]].properties.name),m(e,u),B(c,e,null),m(e,d),m(e,p),m(e,$),B(j,e,null),T=!0,g||(_=[H(r,"click",n[7]),H(o,"click",n[5]),H(a,"input",n[8])],g=!0)},p(S,w){w&3&&a.value!==S[1].crossings[S[0]].properties.name&&ke(a,S[1].crossings[S[0]].properties.name);const z={};w&1024&&(z.$$scope={dirty:w,ctx:S}),!f&&w&3&&(f=!0,z.value=S[1].crossings[S[0]].properties.sa10,_e(()=>f=!1)),c.$set(z)},i(S){T||(h(c.$$.fragment,S),h(j.$$.fragment,S),T=!0)},o(S){C(c.$$.fragment,S),C(j.$$.fragment,S),T=!1},d(S){S&&A(e),E(c),E(j),g=!1,Ce(_)}}}function il(n){let e,r;return e=new Ye({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.filter=["!=",["id"],t[0]]),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ll(n){let e,r;return{c(){e=v("img"),bt(e.src,r=Kr)||P(e,"src",r),P(e,"alt","")},m(t,o){y(t,e,o)},p:se,d(t){t&&A(e)}}}function sl(n){let e,r,t,o,i,l,s,a;r=new Ge({props:{except:"crossings",showMissingProperty:["get","sa10"]}}),o=new we({props:{data:de(n[1].crossings),generateId:!0,$$slots:{default:[il]},$$scope:{ctx:n}}});function u(f){n[6](f)}let c={color:n[1].crossings[n[0]].properties.color,$$slots:{default:[ll]},$$scope:{ctx:n}};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].crossings[n[0]].geometry.coordinates),l=new xt({props:c}),fe.push(()=>ge(l,"lngLat",u)),{c(){e=v("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),i=L(),M(l.$$.fragment),P(e,"slot","map")},m(f,d){y(f,e,d),B(r,e,null),m(e,t),B(o,e,null),m(e,i),B(l,e,null),a=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].crossings)),d&1025&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const $={};d&3&&($.color=f[1].crossings[f[0]].properties.color),d&1024&&($.$$scope={dirty:d,ctx:f}),!s&&d&3&&(s=!0,$.lngLat=f[1].crossings[f[0]].geometry.coordinates,_e(()=>s=!1)),l.$set($)},i(f){a||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(l.$$.fragment,f),a=!0)},o(f){C(r.$$.fragment,f),C(o.$$.fragment,f),C(l.$$.fragment,f),a=!1},d(f){f&&A(e),E(r),E(o),E(l)}}}function al(n){let e,r,t,o;return e=new De({props:{$$slots:{map:[sl],sidebar:[ol]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=H(nl,"keydown",n[4]),t=!0)},p(i,[l]){const s={};l&1031&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function cl(n,e,r){let t,o;ee(n,W,p=>r(1,t=p)),ee(n,X,p=>r(2,o=p));let{idx:i}=e,l=Ve.SA10;function s(p){p.key=="Escape"&&Y(X,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this crossing?")&&(Y(X,o={kind:"neutral"},o),await lt(),t.crossings.splice(i,1),W.set(t))}function u(p){n.$$.not_equal(t.crossings[i].geometry.coordinates,p)&&(t.crossings[i].geometry.coordinates=p,W.set(t))}const c=()=>Y(X,o={kind:"neutral"},o);function f(){t.crossings[i].properties.name=this.value,W.set(t)}function d(p){n.$$.not_equal(t.crossings[i].properties.sa10,p)&&(t.crossings[i].properties.sa10=p,W.set(t))}return n.$$set=p=>{"idx"in p&&r(0,i=p.idx)},[i,t,o,l,s,a,u,c,f,d]}class ul extends oe{constructor(e){super(),ie(this,e,cl,al,ne,{idx:0})}}let K;const Zr=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Zr.decode();let pt=null;function _t(){return(pt===null||pt.byteLength===0)&&(pt=new Uint8Array(K.memory.buffer)),pt}function Le(n,e){return n=n>>>0,Zr.decode(_t().subarray(n,n+e))}const Re=new Array(128).fill(void 0);Re.push(void 0,null,!0,!1);let ht=Re.length;function $e(n){ht===Re.length&&Re.push(Re.length+1);const e=ht;return ht=Re[e],Re[e]=n,e}function le(n){return Re[n]}function fl(n){n<132||(Re[n]=ht,ht=n)}function rt(n){const e=le(n);return fl(n),e}function Qt(n){return n==null}let mt=null;function dl(){return(mt===null||mt.byteLength===0)&&(mt=new Float64Array(K.memory.buffer)),mt}let gt=null;function ae(){return(gt===null||gt.byteLength===0)&&(gt=new Int32Array(K.memory.buffer)),gt}let Qe=0;const Nt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},pl=typeof Nt.encodeInto=="function"?function(n,e){return Nt.encodeInto(n,e)}:function(n,e){const r=Nt.encode(n);return e.set(r),{read:n.length,written:r.length}};function Bt(n,e,r){if(r===void 0){const s=Nt.encode(n),a=e(s.length,1)>>>0;return _t().subarray(a,a+s.length).set(s),Qe=s.length,a}let t=n.length,o=e(t,1)>>>0;const i=_t();let l=0;for(;l<t;l++){const s=n.charCodeAt(l);if(s>127)break;i[o+l]=s}if(l!==t){l!==0&&(n=n.slice(l)),o=r(o,t,t=l+n.length*3,1)>>>0;const s=_t().subarray(o+l,o+t),a=pl(n,s);l+=a.written}return Qe=l,o}function Yt(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let i="[";o>0&&(i+=Yt(n[0]));for(let l=1;l<o;l++)i+=", "+Yt(n[l]);return i+="]",i}const r=/\[object ([^\]]+)\]/.exec(toString.call(n));let t;if(r.length>1)t=r[1];else return toString.call(n);if(t=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:t}function ml(n,e){const r=e(n.length*1,1)>>>0;return _t().set(n,r/1),Qe=n.length,r}function Ht(n,e){try{return n.apply(this,e)}catch(r){K.__wbindgen_exn_store($e(r))}}class Pt{static __wrap(e){e=e>>>0;const r=Object.create(Pt.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();K.__wbg_jsroutesnapper_free(e)}constructor(e){try{const i=K.__wbindgen_add_to_stack_pointer(-16),l=ml(e,K.__wbindgen_malloc),s=Qe;K.jsroutesnapper_new(i,l,s);var r=ae()[i/4+0],t=ae()[i/4+1],o=ae()[i/4+2];if(o)throw rt(t);return Pt.__wrap(r)}finally{K.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){K.jsroutesnapper_setRouteConfig(this.__wbg_ptr,$e(e))}setAreaMode(){K.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,r;try{const i=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_getConfig(i,this.__wbg_ptr);var t=ae()[i/4+0],o=ae()[i/4+1];return e=t,r=o,Le(t,o)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(e,r,1)}}toFinalFeature(){try{const t=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=ae()[t/4+0],r=ae()[t/4+1];let o;return e!==0&&(o=Le(e,r).slice(),K.__wbindgen_free(e,r*1)),o}finally{K.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,r;try{const i=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_renderGeojson(i,this.__wbg_ptr);var t=ae()[i/4+0],o=ae()[i/4+1];return e=t,r=o,Le(t,o)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(e,r,1)}}toggleSnapMode(){K.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,r,t){return K.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,r,t)!==0}onClick(){K.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return K.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return K.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){K.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_editExisting(o,this.__wbg_ptr,$e(e));var r=ae()[o/4+0],t=ae()[o/4+1];if(t)throw rt(r)}finally{K.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,r;try{const i=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_debugRenderGraph(i,this.__wbg_ptr);var t=ae()[i/4+0],o=ae()[i/4+1];return e=t,r=o,Le(t,o)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(e,r,1)}}debugSnappableNodes(){let e,r;try{const i=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_debugSnappableNodes(i,this.__wbg_ptr);var t=ae()[i/4+0],o=ae()[i/4+1];return e=t,r=o,Le(t,o)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(e,r,1)}}routeNameForWaypoints(e){let r,t;try{const c=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_routeNameForWaypoints(c,this.__wbg_ptr,$e(e));var o=ae()[c/4+0],i=ae()[c/4+1],l=ae()[c/4+2],s=ae()[c/4+3],a=o,u=i;if(s)throw a=0,u=0,rt(l);return r=a,t=u,Le(a,u)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(r,t,1)}}addSnappedWaypoint(e,r){K.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,r)}undo(){K.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let r,t;try{const c=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_calculateRoute(c,this.__wbg_ptr,$e(e));var o=ae()[c/4+0],i=ae()[c/4+1],l=ae()[c/4+2],s=ae()[c/4+3],a=o,u=i;if(s)throw a=0,u=0,rt(l);return r=a,t=u,Le(a,u)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(r,t,1)}}getExtraNodes(e,r){let t,o;try{const f=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_getExtraNodes(f,this.__wbg_ptr,$e(e),$e(r));var i=ae()[f/4+0],l=ae()[f/4+1],s=ae()[f/4+2],a=ae()[f/4+3],u=i,c=l;if(a)throw u=0,c=0,rt(s);return t=u,o=c,Le(u,c)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,o,1)}}}async function gl(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(t){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function _l(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,r){const t=Le(e,r);return $e(t)},n.wbg.__wbindgen_object_drop_ref=function(e){rt(e)},n.wbg.__wbindgen_error_new=function(e,r){const t=new Error(Le(e,r));return $e(t)},n.wbg.__wbindgen_number_get=function(e,r){const t=le(r),o=typeof t=="number"?t:void 0;dl()[e/8+1]=Qt(o)?0:o,ae()[e/4+0]=!Qt(o)},n.wbg.__wbindgen_is_object=function(e){const r=le(e);return typeof r=="object"&&r!==null},n.wbg.__wbindgen_is_undefined=function(e){return le(e)===void 0},n.wbg.__wbindgen_in=function(e,r){return le(e)in le(r)},n.wbg.__wbindgen_boolean_get=function(e){const r=le(e);return typeof r=="boolean"?r?1:0:2},n.wbg.__wbindgen_jsval_loose_eq=function(e,r){return le(e)==le(r)},n.wbg.__wbindgen_string_get=function(e,r){const t=le(r),o=typeof t=="string"?t:void 0;var i=Qt(o)?0:Bt(o,K.__wbindgen_malloc,K.__wbindgen_realloc),l=Qe;ae()[e/4+1]=l,ae()[e/4+0]=i},n.wbg.__wbg_String_4370c5505c674d30=function(e,r){const t=String(le(r)),o=Bt(t,K.__wbindgen_malloc,K.__wbindgen_realloc),i=Qe;ae()[e/4+1]=i,ae()[e/4+0]=o},n.wbg.__wbindgen_object_clone_ref=function(e){const r=le(e);return $e(r)},n.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,r){const t=le(e)[le(r)];return $e(t)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return $e(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,r){const t=le(r).stack,o=Bt(t,K.__wbindgen_malloc,K.__wbindgen_realloc),i=Qe;ae()[e/4+1]=i,ae()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,r){let t,o;try{t=e,o=r,console.error(Le(e,r))}finally{K.__wbindgen_free(t,o,1)}},n.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(le(e))},n.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(le(e))},n.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(le(e))},n.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(le(e))},n.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(le(e))},n.wbg.__wbg_get_44be0491f933a435=function(e,r){const t=le(e)[r>>>0];return $e(t)},n.wbg.__wbg_length_fff51ee6522a1a18=function(e){return le(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof le(e)=="function"},n.wbg.__wbg_next_526fc47e980da008=function(e){const r=le(e).next;return $e(r)},n.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Ht(function(e){const r=le(e).next();return $e(r)},arguments)},n.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return le(e).done},n.wbg.__wbg_value_1695675138684bd5=function(e){const r=le(e).value;return $e(r)},n.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return $e(Symbol.iterator)},n.wbg.__wbg_get_97b561fb56f034b5=function(){return Ht(function(e,r){const t=Reflect.get(le(e),le(r));return $e(t)},arguments)},n.wbg.__wbg_call_cb65541d95d71282=function(){return Ht(function(e,r){const t=le(e).call(le(r));return $e(t)},arguments)},n.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(le(e))},n.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let r;try{r=le(e)instanceof ArrayBuffer}catch{r=!1}return r},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const r=le(e).buffer;return $e(r)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const r=new Uint8Array(le(e));return $e(r)},n.wbg.__wbg_set_5cf90238115182c3=function(e,r,t){le(e).set(le(r),t>>>0)},n.wbg.__wbg_length_72e2208bbc0efc61=function(e){return le(e).length},n.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let r;try{r=le(e)instanceof Uint8Array}catch{r=!1}return r},n.wbg.__wbindgen_debug_string=function(e,r){const t=Yt(le(r)),o=Bt(t,K.__wbindgen_malloc,K.__wbindgen_realloc),i=Qe;ae()[e/4+1]=i,ae()[e/4+0]=o},n.wbg.__wbindgen_throw=function(e,r){throw new Error(Le(e,r))},n.wbg.__wbindgen_memory=function(){const e=K.memory;return $e(e)},n}function hl(n,e){return K=n.exports,Xr.__wbindgen_wasm_module=e,mt=null,gt=null,pt=null,K}async function Xr(n){if(K!==void 0)return K;typeof n>"u"&&(n="/route-element/assets/route_snapper_bg.wasm");const e=_l();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:t}=await gl(await n,e);return hl(r,t)}const bl=30;class $l{constructor(e,r,t,o,i){this.onMouseMove=l=>{if(!this.active)return;const s=[l.point.x-bl,l.point.y],a=this.map.unproject(l.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(l.lngLat.lng,l.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=l=>{this.active&&(l.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=l=>{if(!this.active)return;let s=l.target.tagName;s=="INPUT"||s=="TEXTAREA"||l.key=="Escape"&&(l.stopPropagation(),this.cancel())},this.onKeyPress=l=>{if(!this.active)return;let s=l.target.tagName;s=="INPUT"||s=="TEXTAREA"||(l.key=="Enter"?(l.stopPropagation(),this.finish()):l.key=="s"||l.key=="S"?(l.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):l.key=="z"&&l.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Pt(r),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=i,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersSuccess)r(JSON.parse(e));else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersUpdated)r(JSON.parse(e))}}function kl(n){let e=n[4].road_classification+"",r;return{c(){r=O(e)},m(t,o){y(t,r,o)},p(t,o){o&16&&e!==(e=t[4].road_classification+"")&&re(r,e)},d(t){t&&A(r)}}}function wl(n){let e,r;return e=new st({props:{openOn:"hover",$$slots:{default:[kl,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&48&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function vl(n){let e,r;return e=new qe({props:{layout:{visibility:n[0]?"visible":"none"},paint:{"line-width":3,"line-color":"black"},$$slots:{default:[wl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.layout={visibility:t[0]?"visible":"none"}),o&32&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function yl(n){let e,r;return e=new Ze({props:{manageHoverState:!0,layout:{visibility:n[0]?"visible":"none"},paint:{"circle-color":["case",["get","traffic_signals"],"green","black"],"circle-radius":5}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.layout={visibility:t[0]?"visible":"none"}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Al(n){let e,r,t,o;return e=new we({props:{data:n[1].os_links,$$slots:{default:[vl]},$$scope:{ctx:n}}}),t=new we({props:{data:n[1].os_nodes,$$slots:{default:[yl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment)},m(i,l){B(e,i,l),y(i,r,l),B(t,i,l),o=!0},p(i,[l]){const s={};l&33&&(s.$$scope={dirty:l,ctx:i}),e.$set(s);const a={};l&33&&(a.$$scope={dirty:l,ctx:i}),t.$set(a)},i(i){o||(h(e.$$.fragment,i),h(t.$$.fragment,i),o=!0)},o(i){C(e.$$.fragment,i),C(t.$$.fragment,i),o=!1},d(i){i&&A(r),E(e,i),E(t,i)}}}function Cl(n,e,r){let{graph:t}=e,{showDebug:o}=e;function i(){let s=JSON.parse(t.debugNetwork());return{os_nodes:JSON.parse(s.os_nodes),os_links:JSON.parse(s.os_links)}}let l=i();return n.$$set=s=>{"graph"in s&&r(2,t=s.graph),"showDebug"in s&&r(0,o=s.showDebug)},[o,l,t]}class jl extends oe{constructor(e){super(),ie(this,e,Cl,Al,ne,{graph:2,showDebug:0})}}function Vr(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:We[n%We.length],sa10:""}}}function Yr(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:We[n%We.length],details:{arms:[],movements:[],notes:""}}}}function xr(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:We[n%We.length],answers:Array(Ae.length).fill("")}}}let Ae=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:ye()},{name:"SA04",description:"trip hazards",choices:ye()},{name:"SA05",description:"kerbside activity",choices:ye()},{name:"SA08",description:"motor traffic speed",choices:ye()},{name:"SA09",description:"motor traffic volume",choices:ye()},{name:"SA11",description:"footway widths",choices:ye()},{name:"SA12",description:"effective width next to tram lines",choices:ye()},{name:"SA13",description:"crossing angle of tram/train rails",choices:ye()},{name:"SA14",description:"cycling surface and maintenance defects",choices:ye()},{name:"SA15",description:"WW surface and maintenance defects",choices:ye()},{name:"SA16",description:"guard railing",choices:ye()}],en=Ee(null);const Be=Ee([]);async function Sl(n){await ko(),await Xr();let e="https://assets.od2net.org/route-element",r=n.getBounds();try{let t=await new wo(e,r.getEast(),r.getNorth(),r.getWest(),r.getSouth());en.set(new $l(n,t.getRouteSnapper(),Ee(Dt()),Ee(!0),Ee(0))),X.set({kind:"draw-route",graph:t})}catch(t){window.alert(t)}}function zl(n){try{let e=JSON.parse(Gt(en).inner.calculateRoute(Gt(Be)));if(!e){window.alert("No route drawn");return}W.update(r=>{for(let t of JSON.parse(n.splitLinks(e,e.properties.full_path)).features){let o=xr(r.links.length);o.geometry=t.geometry,o.properties.name=e.properties.route_name,r.links.push(o)}for(let t of JSON.parse(n.getSideRoadCrossings(e.properties.full_path)).features)r.crossings.push(Vr(r.crossings.length,t.geometry.coordinates));for(let t of JSON.parse(n.getSignalizedJunctions(e.properties.full_path))){let o=Yr(r.jats.length,Bn(t.pt));o.properties.details.arms=t.arms.map(([i,l])=>({point:Bn(l),name:i})),r.jats.push(o)}return r}),X.set({kind:"edit-link",idx:Gt(W).links.length-1})}catch(e){window.alert(`Bug: ${e}`)}Be.set([]),X.set({kind:"neutral"})}function Bn(n){return[n.x,n.y]}function En(n,e,r){const t=n.slice();return t[49]=e[r],t[50]=e,t[51]=r,t}function Tn(n,e,r){const t=n.slice();return t[52]=e[r],t[53]=e,t[54]=r,t}function Ll(n){let e;return{c(){e=v("h2"),e.textContent="Drawing a new route"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Ml(n){let e;return{c(){e=v("h2"),e.textContent="Editing a route"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Bl(n){let e,r=n[12].length+"",t,o;return{c(){e=O("Undo ("),t=O(r),o=O(")")},m(i,l){y(i,e,l),y(i,t,l),y(i,o,l)},p(i,l){l[0]&4096&&r!==(r=i[12].length+"")&&re(t,r)},d(i){i&&(A(e),A(t),A(o))}}}function El(n){let e;return{c(){e=O("Undo")},m(r,t){y(r,e,t)},p:se,d(r){r&&A(e)}}}function Tl(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$,j,T,g,_,b,k,S,w,z,N,U,F,V,D,q,Q,G,I,J,he,be,Me,at,yt,At,et,Je,Ct,ct,ut,ft,jt;function St(te,me){return te[3]?Ml:Ll}let tt=St(n),Ne=tt(n);function zt(te,me){return te[12].length==0?El:Bl}let nt=zt(n),R=nt(n);return ct=nn(n[39][0]),ut=nn(n[39][1]),{c(){e=v("div"),Ne.c(),r=L(),t=v("button"),o=O("Finish"),l=L(),s=v("button"),R.c(),u=L(),c=v("button"),c.textContent="Cancel",f=L(),d=v("fieldset"),p=v("label"),$=v("input"),j=O(`
        Snap to roads`),T=L(),g=v("label"),_=v("input"),b=O(`
        Draw anywhere`),k=L(),S=v("fieldset"),w=v("label"),z=v("input"),N=O(`
        Extend from start (
        `),U=v("b"),U.textContent="1",F=O(`
        )`),V=L(),D=v("label"),q=v("input"),Q=O(`
        Extend from end (
        `),G=v("b"),G.textContent="2",I=O(`
        )`),J=L(),he=v("label"),be=v("input"),Me=O(`
        Adjust middle points (
        `),at=v("b"),at.textContent="3",yt=O(`
        )`),At=L(),et=v("label"),Je=v("input"),Ct=O(`
      Debug the network`),t.disabled=i=n[8].length<2,P(s,"class","secondary"),s.disabled=a=n[12].length==0,P(c,"class","secondary"),P($,"type","radio"),$.__value="snap",ke($,$.__value),P(_,"type","radio"),_.__value="free",ke(_,_.__value),P(z,"type","radio"),z.__value="append-start",ke(z,z.__value),P(q,"type","radio"),q.__value="append-end",ke(q,q.__value),P(be,"type","radio"),be.__value="adjust",ke(be,be.__value),P(Je,"type","checkbox"),P(e,"slot","sidebar"),ct.p(z,q,be),ut.p($,_)},m(te,me){y(te,e,me),Ne.m(e,null),m(e,r),m(e,t),m(t,o),m(e,l),m(e,s),R.m(s,null),m(e,u),m(e,c),m(e,f),m(e,d),m(d,p),m(p,$),$.checked=$.__value===n[11],m(p,j),m(d,T),m(d,g),m(g,_),_.checked=_.__value===n[11],m(g,b),m(e,k),m(e,S),m(S,w),m(w,z),z.checked=z.__value===n[4],m(w,N),m(w,U),m(w,F),m(S,V),m(S,D),m(D,q),q.checked=q.__value===n[4],m(D,Q),m(D,G),m(D,I),m(S,J),m(S,he),m(he,be),be.checked=be.__value===n[4],m(he,Me),m(he,at),m(he,yt),m(e,At),m(e,et),m(et,Je),Je.checked=n[10],m(et,Ct),ft||(jt=[H(t,"click",function(){Wt(n[1])&&n[1].apply(this,arguments)}),H(s,"click",n[15]),H(c,"click",function(){Wt(n[2])&&n[2].apply(this,arguments)}),H($,"change",n[38]),H($,"change",n[16]),H(_,"change",n[40]),H(_,"change",n[16]),H(z,"change",n[41]),H(q,"change",n[42]),H(be,"change",n[43]),H(Je,"change",n[44])],ft=!0)},p(te,me){n=te,tt!==(tt=St(n))&&(Ne.d(1),Ne=tt(n),Ne&&(Ne.c(),Ne.m(e,r))),me[0]&256&&i!==(i=n[8].length<2)&&(t.disabled=i),nt===(nt=zt(n))&&R?R.p(n,me):(R.d(1),R=nt(n),R&&(R.c(),R.m(s,null))),me[0]&4096&&a!==(a=n[12].length==0)&&(s.disabled=a),me[0]&2048&&($.checked=$.__value===n[11]),me[0]&2048&&(_.checked=_.__value===n[11]),me[0]&16&&(z.checked=z.__value===n[4]),me[0]&16&&(q.checked=q.__value===n[4]),me[0]&16&&(be.checked=be.__value===n[4]),me[0]&1024&&(Je.checked=n[10])},d(te){te&&A(e),Ne.d(),R.d(),ct.r(),ut.r(),ft=!1,Ce(jt)}}}function Dl(n){let e;return{c(){e=v("span"),P(e,"class","dot svelte-1cj4rwq"),ve(e,"snapped-node",n[52].snapped),ve(e,"free-node",!n[52].snapped),ve(e,"hide",n[7])},m(r,t){y(r,e,t)},p(r,t){t[0]&8192&&ve(e,"snapped-node",r[52].snapped),t[0]&8192&&ve(e,"free-node",!r[52].snapped),t[0]&128&&ve(e,"hide",r[7])},d(r){r&&A(e)}}}function Dn(n){let e,r,t;function o(a){n[29](a,n[52])}function i(){return n[30](n[52])}function l(){return n[31](n[52])}let s={draggable:!0,zIndex:0,$$slots:{default:[Dl]},$$scope:{ctx:n}};return n[52].point!==void 0&&(s.lngLat=n[52].point),e=new Ke({props:s}),fe.push(()=>ge(e,"lngLat",o)),e.$on("dragstart",i),e.$on("drag",l),e.$on("dragend",n[24]),{c(){M(e.$$.fragment)},m(a,u){B(e,a,u),t=!0},p(a,u){n=a;const c={};u[0]&8320|u[1]&16777216&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&8192&&(r=!0,c.lngLat=n[52].point,_e(()=>r=!1)),e.$set(c)},i(a){t||(h(e.$$.fragment,a),t=!0)},o(a){C(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function Nl(n){let e;return{c(){e=v("span"),e.textContent=`${n[51]+1}`,P(e,"class","dot svelte-1cj4rwq"),ve(e,"snapped",n[49].snapped)},m(r,t){y(r,e,t)},p(r,t){t[0]&256&&ve(e,"snapped",r[49].snapped)},d(r){r&&A(e)}}}function Nn(n){let e,r,t;function o(a){n[32](a,n[49])}function i(){return n[33](n[51])}function l(){return n[34](n[51])}let s={draggable:!0,zIndex:1,$$slots:{default:[Nl]},$$scope:{ctx:n}};return n[49].point!==void 0&&(s.lngLat=n[49].point),e=new Ke({props:s}),fe.push(()=>ge(e,"lngLat",o)),e.$on("click",i),e.$on("contextmenu",l),e.$on("mouseenter",n[35]),e.$on("mouseleave",n[36]),e.$on("dragstart",n[26]),e.$on("dragend",n[37]),{c(){M(e.$$.fragment)},m(a,u){B(e,a,u),t=!0},p(a,u){n=a;const c={};u[0]&256|u[1]&16777216&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&256&&(r=!0,c.lngLat=n[49].point,_e(()=>r=!1)),e.$set(c)},i(a){t||(h(e.$$.fragment,a),t=!0)},o(a){C(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function Il(n){let e,r;return e=new qe({props:{paint:{"line-color":"black","line-width":10}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ol(n){let e,r;return e=new qe({props:{paint:{"line-color":"black","line-width":3}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Pl(n){let e,r,t,o,i,l,s,a,u,c,f;r=new wt({}),r.$on("click",n[17]),r.$on("mousemove",n[18]),o=new jl({props:{showDebug:n[10],graph:n[0]}});let d=x(n[13]),p=[];for(let _=0;_<d.length;_+=1)p[_]=Dn(Tn(n,d,_));const $=_=>C(p[_],1,1,()=>{p[_]=null});let j=x(n[8]),T=[];for(let _=0;_<j.length;_+=1)T[_]=Nn(En(n,j,_));const g=_=>C(T[_],1,1,()=>{T[_]=null});return a=new we({props:{data:n[21](n[9],n[8]),generateId:!0,$$slots:{default:[Il]},$$scope:{ctx:n}}}),c=new we({props:{data:n[14],$$slots:{default:[Ol]},$$scope:{ctx:n}}}),{c(){e=v("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),i=L();for(let _=0;_<p.length;_+=1)p[_].c();l=L();for(let _=0;_<T.length;_+=1)T[_].c();s=L(),M(a.$$.fragment),u=L(),M(c.$$.fragment),P(e,"slot","map")},m(_,b){y(_,e,b),B(r,e,null),m(e,t),B(o,e,null),m(e,i);for(let k=0;k<p.length;k+=1)p[k]&&p[k].m(e,null);m(e,l);for(let k=0;k<T.length;k+=1)T[k]&&T[k].m(e,null);m(e,s),B(a,e,null),m(e,u),B(c,e,null),f=!0},p(_,b){const k={};if(b[0]&1024&&(k.showDebug=_[10]),b[0]&1&&(k.graph=_[0]),o.$set(k),b[0]&29368448){d=x(_[13]);let z;for(z=0;z<d.length;z+=1){const N=Tn(_,d,z);p[z]?(p[z].p(N,b),h(p[z],1)):(p[z]=Dn(N),p[z].c(),h(p[z],1),p[z].m(e,l))}for(ce(),z=d.length;z<p.length;z+=1)$(z);ue()}if(b[0]&68682080){j=x(_[8]);let z;for(z=0;z<j.length;z+=1){const N=En(_,j,z);T[z]?(T[z].p(N,b),h(T[z],1)):(T[z]=Nn(N),T[z].c(),h(T[z],1),T[z].m(e,s))}for(ce(),z=j.length;z<T.length;z+=1)g(z);ue()}const S={};b[0]&768&&(S.data=_[21](_[9],_[8])),b[1]&16777216&&(S.$$scope={dirty:b,ctx:_}),a.$set(S);const w={};b[0]&16384&&(w.data=_[14]),b[1]&16777216&&(w.$$scope={dirty:b,ctx:_}),c.$set(w)},i(_){if(!f){h(r.$$.fragment,_),h(o.$$.fragment,_);for(let b=0;b<d.length;b+=1)h(p[b]);for(let b=0;b<j.length;b+=1)h(T[b]);h(a.$$.fragment,_),h(c.$$.fragment,_),f=!0}},o(_){C(r.$$.fragment,_),C(o.$$.fragment,_),p=p.filter(Boolean);for(let b=0;b<p.length;b+=1)C(p[b]);T=T.filter(Boolean);for(let b=0;b<T.length;b+=1)C(T[b]);C(a.$$.fragment,_),C(c.$$.fragment,_),f=!1},d(_){_&&A(e),E(r),E(o),pe(p,_),pe(T,_),E(a),E(c)}}}function Fl(n){let e,r,t,o;return e=new De({props:{$$slots:{map:[Pl],sidebar:[Tl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=H(window,"keydown",n[25]),t=!0)},p(i,l){const s={};l[0]&32767|l[1]&16777216&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function ql(n,e,r){let t,o,i;ee(n,Be,R=>r(8,o=R)),ee(n,en,R=>r(9,i=R));let{graph:l}=e,{map:s}=e,{finish:a}=e,{cancel:u}=e,{editingExisting:c}=e;qt(()=>{Y(Be,o=[],o),i==null||i.stop(),s.getCanvas().style.cursor="inherit"});let f=!0,d=c?"adjust":"append-end",p="snap",$=[],j=[],T=null,g=!1,_=!1,b=!1;function k(R){let te=R.length==0?"crosshair":"inherit";s.getCanvas().style.cursor=te}function S(){let R=$.pop();r(12,$),R&&Y(Be,o=R,o)}function w(){$.length==100&&$.shift(),r(12,$=[...$,JSON.parse(JSON.stringify(o))])}function z(){r(11,p=p=="snap"?"free":"snap"),T&&r(28,T.snapped=p=="snap",T)}function N(R){w(),Be.update(te=>(d=="append-start"?te.splice(0,0,{point:R.detail.lngLat.toArray(),snapped:p=="snap"}):d=="append-end"&&te.push({point:R.detail.lngLat.toArray(),snapped:p=="snap"}),te))}function U(R){r(28,T={point:R.detail.lngLat.toArray(),snapped:p=="snap"})}function F(R){w(),Be.update(te=>(te[R].snapped=!te[R].snapped,te))}function V(R){w(),Be.update(te=>(te.splice(R,1),te)),r(5,g=!1)}function D(R,te){try{if(R)return JSON.parse(R.inner.calculateRoute(te))}catch{}return Dt()}function q(R,te,me,dt,Lt){if(Lt)return Dt();try{if(R&&te.length>0&&dt){if(me=="append-start")return JSON.parse(R.inner.calculateRoute([dt,te[0]]));if(me=="append-end")return JSON.parse(R.inner.calculateRoute([te[te.length-1],dt]))}}catch{}return Dt()}function Q(R,te,me,dt){if(dt)return;if(!R||me!="adjust"){r(13,j=[]);return}let Lt=[],Rt=1;for(let Mt=0;Mt<te.length-1;Mt++){let ro=JSON.parse(R.inner.getExtraNodes(te[Mt],te[Mt+1]));for(let[oo,io,lo]of ro)Lt.push({point:[oo,io],snapped:lo,insertIdx:Rt});Rt++}r(13,j=Lt)}function G(R){w(),Be.update(te=>(te.splice(R.insertIdx,0,{point:R.point,snapped:R.snapped}),te)),r(7,b=!0)}function I(R){Be.update(te=>(te[R.insertIdx].point=R.point,te))}function J(){r(7,b=!1)}function he(R){let te=R.target.tagName,me=te=="INPUT"||te=="TEXTAREA";R.key==="Enter"&&!me?(R.stopPropagation(),o.length>=2&&a()):R.key==="Escape"?(R.stopPropagation(),u()):R.key=="s"&&!me?z():R.key=="1"&&!me?r(4,d="append-start"):R.key=="2"&&!me?r(4,d="append-end"):R.key=="3"&&!me?r(4,d="adjust"):R.key=="z"&&R.ctrlKey&&(R.stopPropagation(),S())}function be(){w(),r(6,_=!0)}const Me=[[],[]];function at(R,te){n.$$.not_equal(te.point,R)&&(te.point=R,r(13,j))}const yt=R=>G(R),At=R=>I(R);function et(R,te){n.$$.not_equal(te.point,R)&&(te.point=R,Be.set(o))}const Je=R=>F(R),Ct=R=>V(R),ct=()=>r(5,g=!0),ut=()=>r(5,g=!1),ft=()=>r(6,_=!1);function jt(){p=this.__value,r(11,p)}function St(){p=this.__value,r(11,p)}function tt(){d=this.__value,r(4,d)}function Ne(){d=this.__value,r(4,d)}function zt(){d=this.__value,r(4,d)}function nt(){f=this.checked,r(10,f)}return n.$$set=R=>{"graph"in R&&r(0,l=R.graph),"map"in R&&r(27,s=R.map),"finish"in R&&r(1,a=R.finish),"cancel"in R&&r(2,u=R.cancel),"editingExisting"in R&&r(3,c=R.editingExisting)},n.$$.update=()=>{n.$$.dirty[0]&912&&Q(i,o,d,b),n.$$.dirty[0]&268436336&&r(14,t=q(i,o,d,T,g||_)),n.$$.dirty[0]&256&&k(o)},[l,a,u,c,d,g,_,b,o,i,f,p,$,j,t,S,z,N,U,F,V,D,G,I,J,he,be,s,T,at,yt,At,et,Je,Ct,ct,ut,ft,jt,Me,St,tt,Ne,zt,nt]}class Ul extends oe{constructor(e){super(),ie(this,e,ql,Fl,ne,{graph:0,map:27,finish:1,cancel:2,editingExisting:3},null,[-1,-1])}}const Rl="/route-element/assets/right-arrow-d8c7892c.svg";function In(n){let e,r;const t=n[4].default,o=Ie(t,n,n[3],null);return{c(){e=v("div"),o&&o.c(),P(e,"class","section svelte-zax3q3")},m(i,l){y(i,e,l),o&&o.m(e,null),r=!0},p(i,l){o&&o.p&&(!r||l&8)&&Oe(o,t,i,i[3],r?Fe(t,i[3],l,null):Pe(i[3]),null)},i(i){r||(h(o,i),r=!0)},o(i){C(o,i),r=!1},d(i){i&&A(e),o&&o.d(i)}}}function Gl(n){let e,r,t,o,i,l,s,a,u,c,f,d,p=n[2]&&In(n);return{c(){e=v("button"),r=v("div"),t=v("span"),o=O(n[0]),i=L(),l=v("img"),u=L(),p&&p.c(),P(l,"class","arrow svelte-zax3q3"),bt(l.src,s=Rl)||P(l,"src",s),P(l,"alt",a="Select "+n[0]),P(r,"class","top-section section svelte-zax3q3"),ve(r,"bordered",n[2]),P(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m($,j){y($,e,j),m(e,r),m(r,t),m(t,o),m(r,i),m(r,l),m(e,u),p&&p.m(e,null),c=!0,f||(d=[H(e,"click",n[5]),H(e,"mouseenter",n[6]),H(e,"mouseleave",n[7])],f=!0)},p($,[j]){(!c||j&1)&&re(o,$[0]),(!c||j&1&&a!==(a="Select "+$[0]))&&P(l,"alt",a),(!c||j&4)&&ve(r,"bordered",$[2]),$[2]?p?(p.p($,j),j&4&&h(p,1)):(p=In($),p.c(),h(p,1),p.m(e,null)):p&&(ce(),C(p,1,1,()=>{p=null}),ue()),(!c||j&2)&&(e.disabled=$[1])},i($){c||(h(p),c=!0)},o($){C(p),c=!1},d($){$&&A(e),p&&p.d(),f=!1,Ce(d)}}}function Jl(n,e,r){let{$$slots:t={},$$scope:o}=e,{name:i}=e,{disabled:l=!1}=e,{hasSlot:s=!0}=e;function a(f){ze.call(this,n,f)}function u(f){ze.call(this,n,f)}function c(f){ze.call(this,n,f)}return n.$$set=f=>{"name"in f&&r(0,i=f.name),"disabled"in f&&r(1,l=f.disabled),"hasSlot"in f&&r(2,s=f.hasSlot),"$$scope"in f&&r(3,o=f.$$scope)},[i,l,s,o,t,a,u,c]}class eo extends oe{constructor(e){super(),ie(this,e,Jl,Gl,ne,{name:0,disabled:1,hasSlot:2})}}let He={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const ot={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},to=Object.keys(ot);function Ft(n){return Object.keys(ot[n])}const Xe="All movements";function On(n,e){let r=[],t=ot[n][e];t&&r.push({junctionType:n,movementType:e,...t});let o=ot[n][Xe];if(o&&e!=Xe&&r.push({junctionType:n,movementType:Xe,...o}),n=="Crossroads"){let i=ot["Simple priority T-junction"][Xe];i&&r.push({junctionType:"Simple priority T-junction",movementType:Xe,...i})}if(n!="Any type of junction"){let i=ot["Any type of junction"][Xe];i&&r.push({junctionType:"Any type of junction",movementType:Xe,...i})}return r}function Pn(n,e,r){const t=n.slice();return t[9]=e[r],t}function Fn(n,e,r){const t=n.slice();return t[12]=e[r],t}function qn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Un(n,e,r){const t=n.slice();return t[12]=e[r],t}function Rn(n){let e,r;return e=new Ut({props:{$$slots:{default:[Kl]},$$scope:{ctx:n}}}),e.$on("close",n[8]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&524295&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ql(n){let e;return{c(){e=O("Type of junction")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Hl(n){let e;return{c(){e=O("Type of movement")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Gn(n){let e,r,t;function o(l){n[6](l)}let i={k:"vert-radio",choices:Ft(n[1]),$$slots:{default:[Hl]},$$scope:{ctx:n}};return n[2]!==void 0&&(i.value=n[2]),e=new Te({props:i}),fe.push(()=>ge(e,"value",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,s){const a={};s&2&&(a.choices=Ft(l[1])),s&524288&&(a.$$scope={dirty:s,ctx:l}),!r&&s&4&&(r=!0,a.value=l[2],_e(()=>r=!1)),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Jn(n){let e,r=n[12]+"",t;return{c(){e=v("li"),t=O(r)},m(o,i){y(o,e,i),m(e,t)},p(o,i){i&6&&r!==(r=o[12]+"")&&re(t,r)},d(o){o&&A(e)}}}function Qn(n){let e,r=n[12]+"",t;return{c(){e=v("li"),t=O(r)},m(o,i){y(o,e,i),m(e,t)},p(o,i){i&6&&r!==(r=o[12]+"")&&re(t,r)},d(o){o&&A(e)}}}function Hn(n){let e,r=n[12]+"",t;return{c(){e=v("li"),t=O(r)},m(o,i){y(o,e,i),m(e,t)},p(o,i){i&6&&r!==(r=o[12]+"")&&re(t,r)},d(o){o&&A(e)}}}function Kn(n){let e,r,t=n[9].junctionType+"",o,i,l,s,a,u,c=n[9].movementType+"",f,d,p,$,j,T,g,_,b,k,S,w=x(n[9].scoreZero),z=[];for(let D=0;D<w.length;D+=1)z[D]=Jn(Un(n,w,D));let N=x(n[9].scoreOne),U=[];for(let D=0;D<N.length;D+=1)U[D]=Qn(qn(n,N,D));let F=x(n[9].scoreTwo),V=[];for(let D=0;D<F.length;D+=1)V[D]=Hn(Fn(n,F,D));return{c(){e=v("tr"),r=v("td"),o=O(t),i=L(),l=v("br"),s=L(),a=v("br"),u=L(),f=O(c),d=L(),p=v("td"),$=v("ul");for(let D=0;D<z.length;D+=1)z[D].c();j=L(),T=v("td"),g=v("ul");for(let D=0;D<U.length;D+=1)U[D].c();_=L(),b=v("td"),k=v("ul");for(let D=0;D<V.length;D+=1)V[D].c();S=L(),P(r,"class","type-row svelte-k4kgn3"),P(p,"class","score-zero svelte-k4kgn3"),P(T,"class","score-one svelte-k4kgn3"),P(b,"class","score-two svelte-k4kgn3")},m(D,q){y(D,e,q),m(e,r),m(r,o),m(r,i),m(r,l),m(r,s),m(r,a),m(r,u),m(r,f),m(e,d),m(e,p),m(p,$);for(let Q=0;Q<z.length;Q+=1)z[Q]&&z[Q].m($,null);m(e,j),m(e,T),m(T,g);for(let Q=0;Q<U.length;Q+=1)U[Q]&&U[Q].m(g,null);m(e,_),m(e,b),m(b,k);for(let Q=0;Q<V.length;Q+=1)V[Q]&&V[Q].m(k,null);m(e,S)},p(D,q){if(q&6&&t!==(t=D[9].junctionType+"")&&re(o,t),q&6&&c!==(c=D[9].movementType+"")&&re(f,c),q&6){w=x(D[9].scoreZero);let Q;for(Q=0;Q<w.length;Q+=1){const G=Un(D,w,Q);z[Q]?z[Q].p(G,q):(z[Q]=Jn(G),z[Q].c(),z[Q].m($,null))}for(;Q<z.length;Q+=1)z[Q].d(1);z.length=w.length}if(q&6){N=x(D[9].scoreOne);let Q;for(Q=0;Q<N.length;Q+=1){const G=qn(D,N,Q);U[Q]?U[Q].p(G,q):(U[Q]=Qn(G),U[Q].c(),U[Q].m(g,null))}for(;Q<U.length;Q+=1)U[Q].d(1);U.length=N.length}if(q&6){F=x(D[9].scoreTwo);let Q;for(Q=0;Q<F.length;Q+=1){const G=Fn(D,F,Q);V[Q]?V[Q].p(G,q):(V[Q]=Hn(G),V[Q].c(),V[Q].m(k,null))}for(;Q<V.length;Q+=1)V[Q].d(1);V.length=F.length}},d(D){D&&A(e),pe(z,D),pe(U,D),pe(V,D)}}}function Kl(n){let e,r,t,o,i,l,s,a,u=n[1],c,f,d,p,$,j,T,g,_;function b(N){n[5](N)}let k={k:"vert-radio",choices:to,$$slots:{default:[Ql]},$$scope:{ctx:n}};n[1]!==void 0&&(k.value=n[1]),l=new Te({props:k}),fe.push(()=>ge(l,"value",b)),l.$on("change",n[3]);let S=Gn(n),w=x(On(n[1],n[2])),z=[];for(let N=0;N<w.length;N+=1)z[N]=Kn(Pn(n,w,N));return{c(){e=v("h1"),e.textContent="LTN 1/20 scoring guidance",r=L(),t=v("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,o=L(),i=v("div"),M(l.$$.fragment),a=L(),S.c(),c=L(),f=v("table"),d=v("tr"),d.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,p=L();for(let N=0;N<z.length;N+=1)z[N].c();$=L(),j=v("button"),j.textContent="OK",Z(i,"display","flex"),Z(i,"justify-content","space-between")},m(N,U){y(N,e,U),y(N,r,U),y(N,t,U),y(N,o,U),y(N,i,U),B(l,i,null),m(i,a),S.m(i,null),y(N,c,U),y(N,f,U),m(f,d),m(f,p);for(let F=0;F<z.length;F+=1)z[F]&&z[F].m(f,null);y(N,$,U),y(N,j,U),T=!0,g||(_=H(j,"click",n[7]),g=!0)},p(N,U){const F={};if(U&524288&&(F.$$scope={dirty:U,ctx:N}),!s&&U&2&&(s=!0,F.value=N[1],_e(()=>s=!1)),l.$set(F),U&2&&ne(u,u=N[1])?(ce(),C(S,1,1,se),ue(),S=Gn(N),S.c(),h(S,1),S.m(i,null)):S.p(N,U),U&6){w=x(On(N[1],N[2]));let V;for(V=0;V<w.length;V+=1){const D=Pn(N,w,V);z[V]?z[V].p(D,U):(z[V]=Kn(D),z[V].c(),z[V].m(f,null))}for(;V<z.length;V+=1)z[V].d(1);z.length=w.length}},i(N){T||(h(l.$$.fragment,N),h(S),T=!0)},o(N){C(l.$$.fragment,N),C(S),T=!1},d(N){N&&(A(e),A(r),A(t),A(o),A(i),A(c),A(f),A($),A(j)),E(l),S.d(N),pe(z,N),g=!1,_()}}}function Wl(n){let e,r,t,o,i,l,s=n[0]&&Rn(n);return{c(){e=v("button"),e.textContent="LTN 1/20 scoring guidance",r=L(),s&&s.c(),t=Ue(),P(e,"class","secondary")},m(a,u){y(a,e,u),y(a,r,u),s&&s.m(a,u),y(a,t,u),o=!0,i||(l=H(e,"click",n[4]),i=!0)},p(a,[u]){a[0]?s?(s.p(a,u),u&1&&h(s,1)):(s=Rn(a),s.c(),h(s,1),s.m(t.parentNode,t)):s&&(ce(),C(s,1,1,()=>{s=null}),ue())},i(a){o||(h(s),o=!0)},o(a){C(s),o=!1},d(a){a&&(A(e),A(r),A(t)),s&&s.d(a),i=!1,l()}}}function Zl(n,e,r){let t=!1,o=to[0],i=Ft(o)[0];function l(){r(2,i=Ft(o)[0])}const s=()=>r(0,t=!0);function a(d){o=d,r(1,o)}function u(d){i=d,r(2,i)}return[t,o,i,l,s,a,u,()=>r(0,t=!1),()=>r(0,t=!1)]}class Xl extends oe{constructor(e){super(),ie(this,e,Zl,Wl,ne,{})}}function Vl(n){let e;return{c(){e=O("User")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Wn(n){let e,r;return e=new Xl({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Yl(n){let e;return{c(){e=O("Score")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function xl(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$,j,T,g;function _(z){n[5](z)}let b={k:"horiz-radio",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]],$$slots:{default:[Vl]},$$scope:{ctx:n}};n[2].jats[n[0]].properties.details.movements[n[1]].kind!==void 0&&(b.value=n[2].jats[n[0]].properties.details.movements[n[1]].kind),i=new Te({props:b}),fe.push(()=>ge(i,"value",_));let k=n[2].jats[n[0]].properties.details.movements[n[1]].kind=="cycling"&&Wn();function S(z){n[6](z)}let w={k:"horiz-radio",choices:n[3],$$slots:{default:[Yl]},$$scope:{ctx:n}};return n[2].jats[n[0]].properties.details.movements[n[1]].score!==void 0&&(w.value=n[2].jats[n[0]].properties.details.movements[n[1]].score),u=new Te({props:w}),fe.push(()=>ge(u,"value",S)),{c(){e=v("label"),r=O(`Name
  `),t=v("input"),o=L(),M(i.$$.fragment),s=L(),k&&k.c(),a=L(),M(u.$$.fragment),f=L(),d=v("label"),p=O(`Comments
  `),$=v("textarea"),P(t,"type","text")},m(z,N){y(z,e,N),m(e,r),m(e,t),ke(t,n[2].jats[n[0]].properties.details.movements[n[1]].name),y(z,o,N),B(i,z,N),y(z,s,N),k&&k.m(z,N),y(z,a,N),B(u,z,N),y(z,f,N),y(z,d,N),m(d,p),m(d,$),ke($,n[2].jats[n[0]].properties.details.movements[n[1]].notes),j=!0,T||(g=[H(t,"input",n[4]),H($,"input",n[7])],T=!0)},p(z,[N]){N&7&&t.value!==z[2].jats[z[0]].properties.details.movements[z[1]].name&&ke(t,z[2].jats[z[0]].properties.details.movements[z[1]].name);const U={};N&256&&(U.$$scope={dirty:N,ctx:z}),!l&&N&7&&(l=!0,U.value=z[2].jats[z[0]].properties.details.movements[z[1]].kind,_e(()=>l=!1)),i.$set(U),z[2].jats[z[0]].properties.details.movements[z[1]].kind=="cycling"?k?N&7&&h(k,1):(k=Wn(),k.c(),h(k,1),k.m(a.parentNode,a)):k&&(ce(),C(k,1,1,()=>{k=null}),ue());const F={};N&256&&(F.$$scope={dirty:N,ctx:z}),!c&&N&7&&(c=!0,F.value=z[2].jats[z[0]].properties.details.movements[z[1]].score,_e(()=>c=!1)),u.$set(F),N&7&&ke($,z[2].jats[z[0]].properties.details.movements[z[1]].notes)},i(z){j||(h(i.$$.fragment,z),h(k),h(u.$$.fragment,z),j=!0)},o(z){C(i.$$.fragment,z),C(k),C(u.$$.fragment,z),j=!1},d(z){z&&(A(e),A(o),A(s),A(a),A(f),A(d)),E(i,z),k&&k.d(z),E(u,z),T=!1,Ce(g)}}}function es(n,e,r){let t;ee(n,W,f=>r(2,t=f));let{junctionIdx:o}=e,{idx:i}=e,l=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(){t.jats[o].properties.details.movements[i].name=this.value,W.set(t)}function a(f){n.$$.not_equal(t.jats[o].properties.details.movements[i].kind,f)&&(t.jats[o].properties.details.movements[i].kind=f,W.set(t))}function u(f){n.$$.not_equal(t.jats[o].properties.details.movements[i].score,f)&&(t.jats[o].properties.details.movements[i].score=f,W.set(t))}function c(){t.jats[o].properties.details.movements[i].notes=this.value,W.set(t)}return n.$$set=f=>{"junctionIdx"in f&&r(0,o=f.junctionIdx),"idx"in f&&r(1,i=f.idx)},[o,i,t,l,s,a,u,c]}class ts extends oe{constructor(e){super(),ie(this,e,es,xl,ne,{junctionIdx:0,idx:1})}}function ns(n){return n%(2*Math.PI)*180/Math.PI}function Et(n){return n%360*Math.PI/180}function Zn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function no(n,e,r={}){if(r.final===!0)return rs(n,e);const t=Zn(n),o=Zn(e),i=Et(t[0]),l=Et(o[0]),s=Et(t[1]),a=Et(o[1]),u=Math.sin(l-i)*Math.cos(a),c=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(l-i);return ns(Math.atan2(u,c))}function rs(n,e){let r=no(e,n);return r=(r+180)%360,r}var it=no;function os(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function is(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xn(n[0])||!Xn(n[1]))throw new Error("coordinates must contain numbers");return os({type:"Point",coordinates:n},e,r)}function Xn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function ls(n,e={}){const r=vo(n),t=(r[0]+r[2])/2,o=(r[1]+r[3])/2;return is([t,o],e.properties,e)}var ss=ls,je=63710088e-1,as={centimeters:je*100,centimetres:je*100,degrees:360/(2*Math.PI),feet:je*3.28084,inches:je*39.37,kilometers:je/1e3,kilometres:je/1e3,meters:je,metres:je,miles:je/1609.344,millimeters:je*1e3,millimetres:je*1e3,nauticalmiles:je/1852,radians:1,yards:je*1.0936};function cs(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function us(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Yn(n[0])||!Yn(n[1]))throw new Error("coordinates must contain numbers");return cs({type:"Point",coordinates:n},e,r)}function fs(n,e="kilometers"){const r=as[e];if(!r)throw new Error(e+" units is invalid");return n/r}function Vn(n){return n%(2*Math.PI)*180/Math.PI}function Kt(n){return n%360*Math.PI/180}function Yn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function ds(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ps(n,e,r,t={}){const o=ds(n),i=Kt(o[0]),l=Kt(o[1]),s=Kt(r),a=fs(e,t.units),u=Math.asin(Math.sin(l)*Math.cos(a)+Math.cos(l)*Math.sin(a)*Math.cos(s)),c=i+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(l),Math.cos(a)-Math.sin(l)*Math.sin(u)),f=Vn(c),d=Vn(u);return us([f,d],t.properties)}var $t=ps,Se=63710088e-1,ms={centimeters:Se*100,centimetres:Se*100,degrees:360/(2*Math.PI),feet:Se*3.28084,inches:Se*39.37,kilometers:Se/1e3,kilometres:Se/1e3,meters:Se,metres:Se,miles:Se/1609.344,millimeters:Se*1e3,millimetres:Se*1e3,nauticalmiles:Se/1852,radians:1,yards:Se*1.0936};function gs(n,e="kilometers"){const r=ms[e];if(!r)throw new Error(e+" units is invalid");return n*r}function Tt(n){return n%360*Math.PI/180}function xn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function _s(n,e,r={}){var t=xn(n),o=xn(e),i=Tt(o[1]-t[1]),l=Tt(o[0]-t[0]),s=Tt(t[1]),a=Tt(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(s)*Math.cos(a);return gs(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)}var hs=_s;function bs(n){let e=ss({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,o)=>er(it(e,o.point))-er(it(e,t.point)));let r=[];for(let t=0;t<n.length;t++){let o=n[t],i=it(o.point,e),l=1;for(let s of ks(t,n.length)){let a=n[s],u=it(e,a.point),c=$s(o.point,e,l++),f=hs(o.point,e),d=$t(c,.5*f,i).geometry.coordinates,p=$t(d,.2*f,u).geometry.coordinates;r.push({point1:c,point2:d,point3:p,kind:"cycling",score:"X",name:`${o.name} to ${a.name}`,notes:""})}}return r}function $s(n,e,r){let t=.003,i=it(n,e)-90,l=t*r;return $t(n,l,i).geometry.coordinates}function er(n){return(n+360)%360}function ks(n,e){let r=[];for(let t=n+1;t<e;t++)r.push(t);for(let t=0;t<n;t++)r.push(t);return r}const ws="/route-element/assets/movement-aa45473c.svg",vs="/route-element/assets/pan-fbcec4cd.svg";function tr(n,e,r){const t=n.slice();return t[30]=e[r],t[31]=e,t[32]=r,t}function nr(n,e,r){const t=n.slice();return t[33]=e[r],t[34]=e,t[32]=r,t}function rr(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$,j,T,g,_,b;function k(q,Q){return q[0].mode=="select"?As:ys}let S=k(n),w=S(n);function z(q,Q){return q[0].mode=="new-arm"?js:Cs}let N=z(n),U=N(n);function F(q,Q){return q[0].mode=="new-movement"?zs:Ss}let V=F(n),D=V(n);return{c(){e=v("div"),r=v("button"),t=v("img"),i=L(),w.c(),l=L(),s=v("button"),a=Jt("svg"),u=Jt("circle"),c=Jt("text"),f=O("A"),d=L(),U.c(),p=L(),$=v("button"),j=v("img"),g=L(),D.c(),bt(t.src,o=vs)||P(t,"src",o),P(t,"alt","Move map"),Z(t,"vertical-align","middle"),P(r,"class","outline"),P(u,"cx","12"),P(u,"cy","12"),P(u,"r","12"),P(u,"fill","white"),P(c,"x","6"),P(c,"y","16"),P(c,"fill","#4472c4"),P(a,"width","24"),P(a,"height","24"),P(a,"xmlns","http://www.w3.org/2000/svg"),Z(a,"vertical-align","middle"),P(s,"class","outline"),bt(j.src,T=ws)||P(j,"src",T),P(j,"alt","New movement"),Z(j,"vertical-align","middle"),P($,"class","outline"),P(e,"class","control-panel svelte-l1e6xi")},m(q,Q){y(q,e,Q),m(e,r),m(r,t),m(r,i),w.m(r,null),m(e,l),m(e,s),m(s,a),m(a,u),m(a,c),m(c,f),m(s,d),U.m(s,null),m(e,p),m(e,$),m($,j),m($,g),D.m($,null),_||(b=[H(r,"click",function(){Wt(n[3])&&n[3].apply(this,arguments)}),H(s,"click",n[11]),H($,"click",n[12])],_=!0)},p(q,Q){n=q,S!==(S=k(n))&&(w.d(1),w=S(n),w&&(w.c(),w.m(r,null))),N!==(N=z(n))&&(U.d(1),U=N(n),U&&(U.c(),U.m(s,null))),V!==(V=F(n))&&(D.d(1),D=V(n),D&&(D.c(),D.m($,null)))},d(q){q&&A(e),w.d(),U.d(),D.d(),_=!1,Ce(b)}}}function ys(n){let e;return{c(){e=O("Move map")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function As(n){let e;return{c(){e=v("b"),e.textContent="Move map"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Cs(n){let e;return{c(){e=O("New arm")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function js(n){let e;return{c(){e=v("b"),e.textContent="New arm"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Ss(n){let e;return{c(){e=O("New movement")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function zs(n){let e;return{c(){e=v("b"),e.textContent="New movement"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Ls(n){let e;return{c(){e=v("span"),e.textContent=`${Us(n[32])}`,P(e,"class","dot svelte-l1e6xi"),Z(e,"color","#4472c4"),Z(e,"background-color","white")},m(r,t){y(r,e,t)},p:se,d(r){r&&A(e)}}}function or(n){let e,r,t;function o(a){n[13](a,n[33])}function i(){return n[14](n[32])}function l(){return n[15](n[32])}let s={draggable:!0,$$slots:{default:[Ls]},$$scope:{ctx:n}};return n[33].point!==void 0&&(s.lngLat=n[33].point),e=new Ke({props:s}),fe.push(()=>ge(e,"lngLat",o)),e.$on("dragend",i),e.$on("click",l),{c(){M(e.$$.fragment)},m(a,u){B(e,a,u),t=!0},p(a,u){n=a;const c={};u[1]&16&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&18&&(r=!0,c.lngLat=n[33].point,_e(()=>r=!1)),e.$set(c)},i(a){t||(h(e.$$.fragment,a),t=!0)},o(a){C(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function Ms(n){let e;return{c(){e=v("span"),P(e,"class","dot svelte-l1e6xi"),Z(e,"background-color",n[6][n[30].score]),Z(e,"opacity",n[30].kind=="walking & wheeling"?"0%":"100%")},m(r,t){y(r,e,t)},p(r,t){t[0]&18&&Z(e,"background-color",r[6][r[30].score]),t[0]&18&&Z(e,"opacity",r[30].kind=="walking & wheeling"?"0%":"100%")},d(r){r&&A(e)}}}function Bs(n){let e;return{c(){e=v("span"),P(e,"class","dot svelte-l1e6xi"),Z(e,"background-color",n[6][n[30].score])},m(r,t){y(r,e,t)},p(r,t){t[0]&18&&Z(e,"background-color",r[6][r[30].score])},d(r){r&&A(e)}}}function Es(n){let e;return{c(){e=v("span"),P(e,"class","dot svelte-l1e6xi"),Z(e,"background-color",n[6][n[30].score]),Z(e,"opacity","0%")},m(r,t){y(r,e,t)},p(r,t){t[0]&18&&Z(e,"background-color",r[6][r[30].score])},d(r){r&&A(e)}}}function ir(n){let e,r,t,o,i,l,s,a,u;function c(w){n[16](w,n[30])}function f(){return n[17](n[32])}function d(){return n[18](n[32])}let p={draggable:!0,$$slots:{default:[Ms]},$$scope:{ctx:n}};n[30].point1!==void 0&&(p.lngLat=n[30].point1),e=new Ke({props:p}),fe.push(()=>ge(e,"lngLat",c)),e.$on("dragend",f),e.$on("click",d);function $(w){n[19](w,n[30])}function j(){return n[20](n[32])}function T(){return n[21](n[32])}let g={draggable:!0,$$slots:{default:[Bs]},$$scope:{ctx:n}};n[30].point2!==void 0&&(g.lngLat=n[30].point2),o=new Ke({props:g}),fe.push(()=>ge(o,"lngLat",$)),o.$on("dragend",j),o.$on("click",T);function _(w){n[22](w,n[30])}function b(){return n[23](n[32])}function k(){return n[24](n[32])}let S={draggable:!0,$$slots:{default:[Es]},$$scope:{ctx:n}};return n[30].point3!==void 0&&(S.lngLat=n[30].point3),s=new Ke({props:S}),fe.push(()=>ge(s,"lngLat",_)),s.$on("dragend",b),s.$on("click",k),{c(){M(e.$$.fragment),t=L(),M(o.$$.fragment),l=L(),M(s.$$.fragment)},m(w,z){B(e,w,z),y(w,t,z),B(o,w,z),y(w,l,z),B(s,w,z),u=!0},p(w,z){n=w;const N={};z[0]&18|z[1]&16&&(N.$$scope={dirty:z,ctx:n}),!r&&z[0]&18&&(r=!0,N.lngLat=n[30].point1,_e(()=>r=!1)),e.$set(N);const U={};z[0]&18|z[1]&16&&(U.$$scope={dirty:z,ctx:n}),!i&&z[0]&18&&(i=!0,U.lngLat=n[30].point2,_e(()=>i=!1)),o.$set(U);const F={};z[0]&18|z[1]&16&&(F.$$scope={dirty:z,ctx:n}),!a&&z[0]&18&&(a=!0,F.lngLat=n[30].point3,_e(()=>a=!1)),s.$set(F)},i(w){u||(h(e.$$.fragment,w),h(o.$$.fragment,w),h(s.$$.fragment,w),u=!0)},o(w){C(e.$$.fragment,w),C(o.$$.fragment,w),C(s.$$.fragment,w),u=!1},d(w){w&&(A(t),A(l)),E(e,w),E(o,w),E(s,w)}}}function Ts(n){let e=(n[29].name||"Untitled movement")+"",r;return{c(){r=O(e)},m(t,o){y(t,r,o)},p(t,o){o[0]&536870912&&e!==(e=(t[29].name||"Untitled movement")+"")&&re(r,e)},d(t){t&&A(r)}}}function Ds(n){let e,r;return e=new st({props:{$$slots:{default:[Ts,({props:t})=>({29:t}),({props:t})=>[t?536870912:0]]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o[0]&536870912|o[1]&16&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ns(n){let e=(n[29].name||"Untitled movement")+"",r;return{c(){r=O(e)},m(t,o){y(t,r,o)},p(t,o){o[0]&536870912&&e!==(e=(t[29].name||"Untitled movement")+"")&&re(r,e)},d(t){t&&A(r)}}}function Is(n){let e,r;return e=new st({props:{$$slots:{default:[Ns,({props:t})=>({29:t}),({props:t})=>[t?536870912:0]]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o[0]&536870912|o[1]&16&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Os(n){let e,r,t,o,i,l;return e=new qe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":It(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Ds]},$$scope:{ctx:n}}}),e.$on("click",n[8]),t=new qe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":It(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Is]},$$scope:{ctx:n}}}),t.$on("click",n[8]),i=new Ye({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment),o=L(),M(i.$$.fragment)},m(s,a){B(e,s,a),y(s,r,a),B(t,s,a),y(s,o,a),B(i,s,a),l=!0},p(s,a){const u={};a[1]&16&&(u.$$scope={dirty:a,ctx:s}),e.$set(u);const c={};a[1]&16&&(c.$$scope={dirty:a,ctx:s}),t.$set(c)},i(s){l||(h(e.$$.fragment,s),h(t.$$.fragment,s),h(i.$$.fragment,s),l=!0)},o(s){C(e.$$.fragment,s),C(t.$$.fragment,s),C(i.$$.fragment,s),l=!1},d(s){s&&(A(r),A(o)),E(e,s),E(t,s),E(i,s)}}}function Ps(n){let e,r,t,o;return e=new qe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Ze({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment)},m(i,l){B(e,i,l),y(i,r,l),B(t,i,l),o=!0},p:se,i(i){o||(h(e.$$.fragment,i),h(t.$$.fragment,i),o=!0)},o(i){C(e.$$.fragment,i),C(t.$$.fragment,i),o=!1},d(i){i&&A(r),E(e,i),E(t,i)}}}function Fs(n){let e,r,t,o,i,l,s,a,u;e=new wt({}),e.$on("click",n[7]);let c=n[0].mode!="editing"&&rr(n),f=x(n[4].jats[n[1]].properties.details.arms),d=[];for(let g=0;g<f.length;g+=1)d[g]=or(nr(n,f,g));const p=g=>C(d[g],1,1,()=>{d[g]=null});let $=x(n[4].jats[n[1]].properties.details.movements),j=[];for(let g=0;g<$.length;g+=1)j[g]=ir(tr(n,$,g));const T=g=>C(j[g],1,1,()=>{j[g]=null});return l=new we({props:{data:n[9](n[4]),$$slots:{default:[Os]},$$scope:{ctx:n}}}),a=new we({props:{data:n[5],$$slots:{default:[Ps]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),c&&c.c(),t=L();for(let g=0;g<d.length;g+=1)d[g].c();o=L();for(let g=0;g<j.length;g+=1)j[g].c();i=L(),M(l.$$.fragment),s=L(),M(a.$$.fragment)},m(g,_){B(e,g,_),y(g,r,_),c&&c.m(g,_),y(g,t,_);for(let b=0;b<d.length;b+=1)d[b]&&d[b].m(g,_);y(g,o,_);for(let b=0;b<j.length;b+=1)j[b]&&j[b].m(g,_);y(g,i,_),B(l,g,_),y(g,s,_),B(a,g,_),u=!0},p(g,_){if(g[0].mode!="editing"?c?c.p(g,_):(c=rr(g),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),_[0]&22){f=x(g[4].jats[g[1]].properties.details.arms);let S;for(S=0;S<f.length;S+=1){const w=nr(g,f,S);d[S]?(d[S].p(w,_),h(d[S],1)):(d[S]=or(w),d[S].c(),h(d[S],1),d[S].m(o.parentNode,o))}for(ce(),S=f.length;S<d.length;S+=1)p(S);ue()}if(_[0]&86){$=x(g[4].jats[g[1]].properties.details.movements);let S;for(S=0;S<$.length;S+=1){const w=tr(g,$,S);j[S]?(j[S].p(w,_),h(j[S],1)):(j[S]=ir(w),j[S].c(),h(j[S],1),j[S].m(i.parentNode,i))}for(ce(),S=$.length;S<j.length;S+=1)T(S);ue()}const b={};_[0]&16&&(b.data=g[9](g[4])),_[1]&16&&(b.$$scope={dirty:_,ctx:g}),l.$set(b);const k={};_[0]&32&&(k.data=g[5]),_[1]&16&&(k.$$scope={dirty:_,ctx:g}),a.$set(k)},i(g){if(!u){h(e.$$.fragment,g);for(let _=0;_<f.length;_+=1)h(d[_]);for(let _=0;_<$.length;_+=1)h(j[_]);h(l.$$.fragment,g),h(a.$$.fragment,g),u=!0}},o(g){C(e.$$.fragment,g),d=d.filter(Boolean);for(let _=0;_<d.length;_+=1)C(d[_]);j=j.filter(Boolean);for(let _=0;_<j.length;_+=1)C(j[_]);C(l.$$.fragment,g),C(a.$$.fragment,g),u=!1},d(g){g&&(A(r),A(t),A(o),A(i),A(s)),E(e,g),c&&c.d(g),pe(d,g),pe(j,g),E(l,g),E(a,g)}}}function qs(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function Us(n){return String.fromCharCode(n+"A".charCodeAt(0))}function Rs(n,e,r){let t,o,i;ee(n,W,I=>r(4,o=I)),ee(n,Ot,I=>r(25,i=I));let{junctionIdx:l}=e,{mode:s}=e,{hoveringSidebar:a}=e,{select:u}=e,{stopEditing:c}=e,f={0:He.red.background,1:He.amber.background,2:He.green.background,X:He.critical.background};function d(I,J,he){let be={type:"FeatureCollection",features:[]},Me=J.mode=="editing"?J.id:he;return Me!=null&&(Me.kind=="arm"?be.features.push(qs(I.jats[l].properties.details.arms[Me.idx],Me.idx)):be.features.push(T(I.jats[l].properties.details.movements[Me.idx],Me.idx))),be}async function p(I){if(i){for(let J of i.queryRenderedFeatures(I.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await c();return}s.mode=="new-arm"?(Y(W,o.jats[l].properties.details.arms=[...o.jats[l].properties.details.arms,{point:I.detail.lngLat.toArray(),name:""}],o),await u({kind:"arm",idx:o.jats[l].properties.details.arms.length-1})):(Y(W,o.jats[l].properties.details.movements=[...o.jats[l].properties.details.movements,{point1:I.detail.lngLat.toArray(),point2:$t(I.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:$t(I.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await u({kind:"movement",idx:o.jats[l].properties.details.movements.length-1}))}}}async function $(I){await u({kind:"movement",idx:I.detail.features[0].id})}function j(I){let J={type:"FeatureCollection",features:I.jats[l].properties.details.movements.map((he,be)=>T(he,be))};for(let he of I.jats[l].properties.details.movements)if(J.features.push(g(he,J.features.length)),he.kind=="walking & wheeling"){let be={...he,point1:he.point3,point3:he.point1};J.features.push(g(be,J.features.length))}return J}function T(I,J){return{type:"Feature",id:J,properties:{name:I.name,kind:I.kind,color:f[I.score]},geometry:{type:"LineString",coordinates:[I.point1,I.point2,I.point3]}}}function g(I,J){return{type:"Feature",id:J,properties:{kind:I.kind,color:f[I.score],angle:it(I.point2,I.point3)},geometry:{type:"Point",coordinates:I.point3}}}const _=()=>r(0,s={mode:"new-arm"}),b=()=>r(0,s={mode:"new-movement"});function k(I,J){n.$$.not_equal(J.point,I)&&(J.point=I,W.set(o))}const S=I=>u({kind:"arm",idx:I}),w=I=>u({kind:"arm",idx:I});function z(I,J){n.$$.not_equal(J.point1,I)&&(J.point1=I,W.set(o))}const N=I=>u({kind:"movement",idx:I}),U=I=>u({kind:"movement",idx:I});function F(I,J){n.$$.not_equal(J.point2,I)&&(J.point2=I,W.set(o))}const V=I=>u({kind:"movement",idx:I}),D=I=>u({kind:"movement",idx:I});function q(I,J){n.$$.not_equal(J.point3,I)&&(J.point3=I,W.set(o))}const Q=I=>u({kind:"movement",idx:I}),G=I=>u({kind:"movement",idx:I});return n.$$set=I=>{"junctionIdx"in I&&r(1,l=I.junctionIdx),"mode"in I&&r(0,s=I.mode),"hoveringSidebar"in I&&r(10,a=I.hoveringSidebar),"select"in I&&r(2,u=I.select),"stopEditing"in I&&r(3,c=I.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&1041&&r(5,t=d(o,s,a))},[s,l,u,c,o,t,f,p,$,j,a,_,b,k,S,w,z,N,U,F,V,D,q,Q,G]}class Gs extends oe{constructor(e){super(),ie(this,e,Rs,Fs,ne,{junctionIdx:1,mode:0,hoveringSidebar:10,select:2,stopEditing:3},null,[-1,-1])}}function lr(n){if(n.movements.length==0)return"No movements added";let e=0,r=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],r+=2;let t=e/r*100;return`${Math.round(t)}%`}const{window:Js}=kt;function sr(n,e,r){const t=n.slice();t[23]=e[r],t[26]=r;const o=t[10][t[23].score];return t[24]=o,t}function ar(n,e,r){const t=n.slice();return t[27]=e[r],t[26]=r,t}function Qs(n){let e,r,t,o,i,l,s,a,u;return{c(){e=v("button"),e.textContent="Done",r=L(),t=v("button"),t.textContent="Delete",o=L(),i=v("label"),l=O(`Arm name
        `),s=v("input"),P(s,"type","text")},m(c,f){y(c,e,f),y(c,r,f),y(c,t,f),y(c,o,f),y(c,i,f),m(i,l),m(i,s),ke(s,n[4].jats[n[0]].properties.details.arms[n[1].id.idx].name),a||(u=[H(e,"click",n[19]),H(t,"click",n[8]),H(s,"input",n[20])],a=!0)},p(c,f){f&19&&s.value!==c[4].jats[c[0]].properties.details.arms[c[1].id.idx].name&&ke(s,c[4].jats[c[0]].properties.details.arms[c[1].id.idx].name)},i:se,o:se,d(c){c&&(A(e),A(r),A(t),A(o),A(i)),a=!1,Ce(u)}}}function Hs(n){let e,r,t,o,i,l,s,a;return e=new ts({props:{junctionIdx:n[0],idx:n[1].id.idx}}),{c(){M(e.$$.fragment),r=L(),t=v("button"),t.textContent="Save",o=L(),i=v("button"),i.textContent="Delete"},m(u,c){B(e,u,c),y(u,r,c),y(u,t,c),y(u,o,c),y(u,i,c),l=!0,s||(a=[H(t,"click",n[7]),H(i,"click",n[8])],s=!0)},p(u,c){const f={};c&1&&(f.junctionIdx=u[0]),c&2&&(f.idx=u[1].id.idx),e.$set(f)},i(u){l||(h(e.$$.fragment,u),l=!0)},o(u){C(e.$$.fragment,u),l=!1},d(u){u&&(A(r),A(t),A(o),A(i)),E(e,u),s=!1,Ce(a)}}}function Ks(n){let e,r,t,o,i,l,s,a,u,c,f=n[4].jats[n[0]].properties.name+"",d,p,$=lr(n[4].jats[n[0]].properties.details)+"",j,T,g,_,b,k,S,w,z,N,U=x(n[4].jats[n[0]].properties.details.arms),F=[];for(let G=0;G<U.length;G+=1)F[G]=cr(ar(n,U,G));const V=G=>C(F[G],1,1,()=>{F[G]=null});let D=x(n[4].jats[n[0]].properties.details.movements),q=[];for(let G=0;G<D.length;G+=1)q[G]=ur(sr(n,D,G));const Q=G=>C(q[G],1,1,()=>{q[G]=null});return{c(){e=v("button"),e.textContent="Done",r=L(),t=v("h3"),t.textContent="Arms",o=L();for(let G=0;G<F.length;G+=1)F[G].c();i=L(),l=v("h3"),l.textContent="Movements",s=L(),a=v("p"),u=O(`Total JAT score
        `),c=v("i"),d=O(f),p=O(`
        : `),j=O($),T=L(),g=v("button"),_=O("Generate cycling movements between all arms"),k=L();for(let G=0;G<q.length;G+=1)q[G].c();S=Ue(),P(g,"class","secondary"),g.disabled=b=n[4].jats[n[0]].properties.details.arms.length<2},m(G,I){y(G,e,I),y(G,r,I),y(G,t,I),y(G,o,I);for(let J=0;J<F.length;J+=1)F[J]&&F[J].m(G,I);y(G,i,I),y(G,l,I),y(G,s,I),y(G,a,I),m(a,u),m(a,c),m(c,d),m(a,p),m(a,j),y(G,T,I),y(G,g,I),m(g,_),y(G,k,I);for(let J=0;J<q.length;J+=1)q[J]&&q[J].m(G,I);y(G,S,I),w=!0,z||(N=[H(e,"click",n[12]),H(g,"click",n[11])],z=!0)},p(G,I){if(I&85){U=x(G[4].jats[G[0]].properties.details.arms);let J;for(J=0;J<U.length;J+=1){const he=ar(G,U,J);F[J]?(F[J].p(he,I),h(F[J],1)):(F[J]=cr(he),F[J].c(),h(F[J],1),F[J].m(i.parentNode,i))}for(ce(),J=U.length;J<F.length;J+=1)V(J);ue()}if((!w||I&17)&&f!==(f=G[4].jats[G[0]].properties.name+"")&&re(d,f),(!w||I&17)&&$!==($=lr(G[4].jats[G[0]].properties.details)+"")&&re(j,$),(!w||I&17&&b!==(b=G[4].jats[G[0]].properties.details.arms.length<2))&&(g.disabled=b),I&1109){D=x(G[4].jats[G[0]].properties.details.movements);let J;for(J=0;J<D.length;J+=1){const he=sr(G,D,J);q[J]?(q[J].p(he,I),h(q[J],1)):(q[J]=ur(he),q[J].c(),h(q[J],1),q[J].m(S.parentNode,S))}for(ce(),J=D.length;J<q.length;J+=1)Q(J);ue()}},i(G){if(!w){for(let I=0;I<U.length;I+=1)h(F[I]);for(let I=0;I<D.length;I+=1)h(q[I]);w=!0}},o(G){F=F.filter(Boolean);for(let I=0;I<F.length;I+=1)C(F[I]);q=q.filter(Boolean);for(let I=0;I<q.length;I+=1)C(q[I]);w=!1},d(G){G&&(A(e),A(r),A(t),A(o),A(i),A(l),A(s),A(a),A(T),A(g),A(k),A(S)),pe(F,G),pe(q,G),z=!1,Ce(N)}}}function cr(n){let e,r;function t(){return n[13](n[26])}function o(){return n[14](n[26])}return e=new eo({props:{name:`${fr(n[26])} - ${n[27].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[15]),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0},p(i,l){n=i;const s={};l&17&&(s.name=`${fr(n[26])} - ${n[27].name||"Unnamed arm"}`),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i)}}}function Ws(n){let e,r,t,o=n[23].score+"",i,l,s,a=dr(n[23].kind)+"",u,c;return{c(){e=v("div"),r=v("span"),t=O("Score: "),i=O(o),l=L(),s=v("span"),u=O(a),c=L(),Z(r,"padding","4px"),Z(r,"color",n[24].font),Z(r,"background-color",n[24].background),Z(e,"width","100%"),Z(e,"display","flex"),Z(e,"justify-content","space-between")},m(f,d){y(f,e,d),m(e,r),m(r,t),m(r,i),m(e,l),m(e,s),m(s,u),y(f,c,d)},p(f,d){d&17&&o!==(o=f[23].score+"")&&re(i,o),d&17&&Z(r,"color",f[24].font),d&17&&Z(r,"background-color",f[24].background),d&17&&a!==(a=dr(f[23].kind)+"")&&re(u,a)},d(f){f&&(A(e),A(c))}}}function ur(n){let e,r;function t(){return n[16](n[26])}function o(){return n[17](n[26])}return e=new eo({props:{name:n[23].name||"Unnamed movement",$$slots:{default:[Ws]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[18]),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0},p(i,l){n=i;const s={};l&17&&(s.name=n[23].name||"Unnamed movement"),l&536870929&&(s.$$scope={dirty:l,ctx:n}),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i)}}}function Zs(n){let e,r,t,o=n[4].jats[n[0]].properties.name+"",i,l,s,a,u;const c=[Ks,Hs,Qs],f=[];function d(p,$){return p[1].mode!="editing"?0:p[1].id.kind=="movement"?1:2}return s=d(n),a=f[s]=c[s](n),{c(){e=v("div"),r=v("h2"),t=O("JAT for "),i=O(o),l=L(),a.c(),P(e,"slot","sidebar")},m(p,$){y(p,e,$),m(e,r),m(r,t),m(r,i),m(e,l),f[s].m(e,null),n[21](e),u=!0},p(p,$){(!u||$&17)&&o!==(o=p[4].jats[p[0]].properties.name+"")&&re(i,o);let j=s;s=d(p),s===j?f[s].p(p,$):(ce(),C(f[j],1,1,()=>{f[j]=null}),ue(),a=f[s],a?a.p(p,$):(a=f[s]=c[s](p),a.c()),h(a,1),a.m(e,null))},i(p){u||(h(a),u=!0)},o(p){C(a),u=!1},d(p){p&&A(e),f[s].d(),n[21](null)}}}function Xs(n){let e,r;return e=new Ze({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.filter=["!=",["id"],t[0]]),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Vs(n){let e,r,t,o,i,l,s;return r=new Ge({props:{except:"jats"}}),o=new we({props:{data:de(n[4].jats),generateId:!0,$$slots:{default:[Xs]},$$scope:{ctx:n}}}),l=new Gs({props:{junctionIdx:n[0],mode:n[1],hoveringSidebar:n[2],select:n[6],stopEditing:n[7]}}),{c(){e=v("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),i=L(),M(l.$$.fragment),P(e,"slot","map")},m(a,u){y(a,e,u),B(r,e,null),m(e,t),B(o,e,null),m(e,i),B(l,e,null),s=!0},p(a,u){const c={};u&16&&(c.data=de(a[4].jats)),u&536870913&&(c.$$scope={dirty:u,ctx:a}),o.$set(c);const f={};u&1&&(f.junctionIdx=a[0]),u&2&&(f.mode=a[1]),u&4&&(f.hoveringSidebar=a[2]),l.$set(f)},i(a){s||(h(r.$$.fragment,a),h(o.$$.fragment,a),h(l.$$.fragment,a),s=!0)},o(a){C(r.$$.fragment,a),C(o.$$.fragment,a),C(l.$$.fragment,a),s=!1},d(a){a&&A(e),E(r),E(o),E(l)}}}function Ys(n){let e,r,t,o;return e=new De({props:{$$slots:{map:[Vs],sidebar:[Zs]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=H(Js,"keydown",n[9]),t=!0)},p(i,[l]){const s={};l&536870975&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function fr(n){return String.fromCharCode(n+"A".charCodeAt(0))}function dr(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function xs(n,e,r){let t,o;ee(n,W,F=>r(4,t=F)),ee(n,X,F=>r(5,o=F));let{junctionIdx:i}=e,l={mode:"select"},s=null,a=null,u;async function c(F){s=u.scrollTop,r(1,l={mode:"editing",id:F}),r(2,a=null),await lt(),r(3,u.scrollTop=0,u)}async function f(){r(1,l={mode:"select"}),s!=null&&(await lt(),r(3,u.scrollTop=s,u),s=null)}function d(){l.mode=="editing"&&window.confirm(`Delete this ${l.id.kind}?`)&&(l.id.kind=="movement"?(t.jats[i].properties.details.movements.splice(l.id.idx,1),W.set(t)):(t.jats[i].properties.details.arms.splice(l.id.idx,1),W.set(t)),f())}function p(F){if(l.mode!="editing")return;let V=F.target.tagName,D=V=="INPUT"||V=="TEXTAREA";F.key=="Escape"||F.key=="Enter"&&!D?(F.stopPropagation(),f()):F.key=="Delete"&&!D&&(F.stopPropagation(),d())}let $={0:He.red,1:He.amber,2:He.green,X:He.critical};function j(){if(t.jats[i].properties.details.movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let F=t.jats[i].properties.details.movements.filter(V=>V.kind=="walking & wheeling");Y(W,t.jats[i].properties.details.movements=[...F,...bs(t.jats[i].properties.details.arms)],t)}const T=()=>Y(X,o={kind:"edit-jat",idx:i},o),g=F=>c({kind:"arm",idx:F}),_=F=>r(2,a={kind:"arm",idx:F}),b=()=>r(2,a=null),k=F=>c({kind:"movement",idx:F}),S=F=>r(2,a={kind:"movement",idx:F}),w=()=>r(2,a=null),z=()=>r(1,l={mode:"select"});function N(){t.jats[i].properties.details.arms[l.id.idx].name=this.value,W.set(t)}function U(F){fe[F?"unshift":"push"](()=>{u=F,r(3,u)})}return n.$$set=F=>{"junctionIdx"in F&&r(0,i=F.junctionIdx)},[i,l,a,u,t,o,c,f,d,p,$,j,T,g,_,b,k,S,w,z,N,U]}class ea extends oe{constructor(e){super(),ie(this,e,xs,Ys,ne,{junctionIdx:0})}}const{window:ta}=kt;function na(n){let e,r,t,o,i,l,s,a,u,c,f,d;return{c(){e=v("div"),r=v("button"),r.textContent="Done",t=L(),o=v("button"),o.textContent="Delete JAT",i=L(),l=v("label"),s=O(`Name:
      `),a=v("input"),u=L(),c=v("button"),c.textContent="Fill out JAT",P(a,"type","text"),P(e,"slot","sidebar")},m(p,$){y(p,e,$),m(e,r),m(e,t),m(e,o),m(e,i),m(e,l),m(l,s),m(l,a),ke(a,n[1].jats[n[0]].properties.name),m(e,u),m(e,c),f||(d=[H(r,"click",n[6]),H(o,"click",n[4]),H(a,"input",n[7]),H(c,"click",n[8])],f=!0)},p(p,$){$&3&&a.value!==p[1].jats[p[0]].properties.name&&ke(a,p[1].jats[p[0]].properties.name)},d(p){p&&A(e),f=!1,Ce(d)}}}function ra(n){let e,r;return e=new Ze({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.filter=["!=",["id"],t[0]]),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function oa(n){let e,r,t,o,i,l,s,a;r=new Ge({props:{except:"jats"}}),o=new we({props:{data:de(n[1].jats),generateId:!0,$$slots:{default:[ra]},$$scope:{ctx:n}}});function u(f){n[5](f)}let c={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].jats[n[0]].geometry.coordinates),l=new xt({props:c}),fe.push(()=>ge(l,"lngLat",u)),{c(){e=v("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),i=L(),M(l.$$.fragment),P(e,"slot","map")},m(f,d){y(f,e,d),B(r,e,null),m(e,t),B(o,e,null),m(e,i),B(l,e,null),a=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].jats)),d&513&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const $={};d&3&&($.color=f[1].jats[f[0]].properties.color),!s&&d&3&&(s=!0,$.lngLat=f[1].jats[f[0]].geometry.coordinates,_e(()=>s=!1)),l.$set($)},i(f){a||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(l.$$.fragment,f),a=!0)},o(f){C(r.$$.fragment,f),C(o.$$.fragment,f),C(l.$$.fragment,f),a=!1},d(f){f&&A(e),E(r),E(o),E(l)}}}function ia(n){let e,r,t,o;return e=new De({props:{$$slots:{map:[oa],sidebar:[na]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=H(ta,"keydown",n[3]),t=!0)},p(i,[l]){const s={};l&519&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function la(n,e,r){let t,o;ee(n,W,d=>r(1,t=d)),ee(n,X,d=>r(2,o=d));let{idx:i}=e;function l(d){d.key=="Escape"&&Y(X,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this JAT?")&&(Y(X,o={kind:"neutral"},o),await lt(),t.jats.splice(i,1),W.set(t))}function a(d){n.$$.not_equal(t.jats[i].geometry.coordinates,d)&&(t.jats[i].geometry.coordinates=d,W.set(t))}const u=()=>Y(X,o={kind:"neutral"},o);function c(){t.jats[i].properties.name=this.value,W.set(t)}const f=()=>Y(X,o={kind:"edit-jat-detail",idx:i},o);return n.$$set=d=>{"idx"in d&&r(0,i=d.idx)},[i,t,o,l,s,a,u,c,f]}class sa extends oe{constructor(e){super(),ie(this,e,la,ia,ne,{idx:0})}}function pr(n,e,r){const t=n.slice();return t[5]=e[r],t[6]=e,t[7]=r,t}function aa(n){let e,r;return{c(){e=v("span"),r=L(),P(e,"class","dot svelte-jgyhla")},m(t,o){y(t,e,o),y(t,r,o)},p:se,d(t){t&&(A(e),A(r))}}}function mr(n){let e,r,t;function o(s){n[3](s,n[5],n[6],n[7])}function i(){return n[4](n[7])}let l={draggable:!0,$$slots:{default:[aa]},$$scope:{ctx:n}};return n[5]!==void 0&&(l.lngLat=n[5]),e=new Ke({props:l}),fe.push(()=>ge(e,"lngLat",o)),e.$on("contextmenu",i),{c(){M(e.$$.fragment)},m(s,a){B(e,s,a),t=!0},p(s,a){n=s;const u={};a&256&&(u.$$scope={dirty:a,ctx:n}),!r&&a&1&&(r=!0,u.lngLat=n[5],_e(()=>r=!1)),e.$set(u)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function ca(n){let e,r,t,o;e=new wt({}),e.$on("click",n[1]);let i=x(n[0].geometry.coordinates),l=[];for(let a=0;a<i.length;a+=1)l[a]=mr(pr(n,i,a));const s=a=>C(l[a],1,1,()=>{l[a]=null});return{c(){M(e.$$.fragment),r=L();for(let a=0;a<l.length;a+=1)l[a].c();t=Ue()},m(a,u){B(e,a,u),y(a,r,u);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(a,u);y(a,t,u),o=!0},p(a,[u]){if(u&5){i=x(a[0].geometry.coordinates);let c;for(c=0;c<i.length;c+=1){const f=pr(a,i,c);l[c]?(l[c].p(f,u),h(l[c],1)):(l[c]=mr(f),l[c].c(),h(l[c],1),l[c].m(t.parentNode,t))}for(ce(),c=i.length;c<l.length;c+=1)s(c);ue()}},i(a){if(!o){h(e.$$.fragment,a);for(let u=0;u<i.length;u+=1)h(l[u]);o=!0}},o(a){C(e.$$.fragment,a),l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)C(l[u]);o=!1},d(a){a&&(A(r),A(t)),E(e,a),pe(l,a)}}}function ua(n,e,r){let{f:t}=e;function o(a){t.geometry.coordinates.push(a.detail.lngLat.toArray()),r(0,t)}function i(a){t.geometry.coordinates.splice(a,1),r(0,t)}function l(a,u,c,f){c[f]=a,r(0,t)}const s=a=>i(a);return n.$$set=a=>{"f"in a&&r(0,t=a.f)},[t,o,i,l,s]}class fa extends oe{constructor(e){super(),ie(this,e,ua,ca,ne,{f:0})}}const{window:da}=kt;function gr(n,e,r){const t=n.slice();return t[13]=e[r],t[14]=e,t[15]=r,t}function _r(n){let e;return{c(){e=v("p"),e.textContent="A link needs at least two points"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function pa(n){let e,r,t;function o(){return n[10](n[13])}return{c(){e=v("button"),e.textContent="?",P(e,"class","outline")},m(i,l){y(i,e,l),r||(t=H(e,"click",o),r=!0)},p(i,l){n=i},d(i){i&&A(e),r=!1,t()}}}function ma(n){let e=n[13].name+"",r,t,o=n[13].description+"",i,l,s,a=Ve[n[13].name]&&pa(n);return{c(){r=O(e),t=O(": "),i=O(o),l=L(),a&&a.c(),s=L()},m(u,c){y(u,r,c),y(u,t,c),y(u,i,c),y(u,l,c),a&&a.m(u,c),y(u,s,c)},p(u,c){Ve[u[13].name]&&a.p(u,c)},d(u){u&&(A(r),A(t),A(i),A(l),A(s)),a&&a.d(u)}}}function hr(n){let e,r,t;function o(l){n[11](l,n[15])}let i={k:"horiz-radio",choices:n[13].choices,$$slots:{default:[ma]},$$scope:{ctx:n}};return n[1].links[n[0]].properties.answers[n[15]]!==void 0&&(i.value=n[1].links[n[0]].properties.answers[n[15]]),e=new Te({props:i}),fe.push(()=>ge(e,"value",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,s){n=l;const a={};s&65540&&(a.$$scope={dirty:s,ctx:n}),!r&&s&3&&(r=!0,a.value=n[1].links[n[0]].properties.answers[n[15]],_e(()=>r=!1)),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function ga(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$,j,T=!n[3]&&_r(),g=x(Ae),_=[];for(let k=0;k<g.length;k+=1)_[k]=hr(gr(n,g,k));const b=k=>C(_[k],1,1,()=>{_[k]=null});return{c(){e=v("div"),r=v("button"),t=O("Done"),i=L(),l=v("button"),l.textContent="Delete link",s=L(),T&&T.c(),a=L(),u=v("label"),c=O(`Name:
      `),f=v("input"),d=L();for(let k=0;k<_.length;k+=1)_[k].c();r.disabled=o=!n[3],P(f,"type","text"),P(e,"slot","sidebar")},m(k,S){y(k,e,S),m(e,r),m(r,t),m(e,i),m(e,l),m(e,s),T&&T.m(e,null),m(e,a),m(e,u),m(u,c),m(u,f),ke(f,n[1].links[n[0]].properties.name),m(e,d);for(let w=0;w<_.length;w+=1)_[w]&&_[w].m(e,null);p=!0,$||(j=[H(r,"click",n[8]),H(l,"click",n[6]),H(f,"input",n[9])],$=!0)},p(k,S){if((!p||S&8&&o!==(o=!k[3]))&&(r.disabled=o),k[3]?T&&(T.d(1),T=null):T||(T=_r(),T.c(),T.m(e,a)),S&3&&f.value!==k[1].links[k[0]].properties.name&&ke(f,k[1].links[k[0]].properties.name),S&7){g=x(Ae);let w;for(w=0;w<g.length;w+=1){const z=gr(k,g,w);_[w]?(_[w].p(z,S),h(_[w],1)):(_[w]=hr(z),_[w].c(),h(_[w],1),_[w].m(e,null))}for(ce(),w=g.length;w<_.length;w+=1)b(w);ue()}},i(k){if(!p){for(let S=0;S<g.length;S+=1)h(_[S]);p=!0}},o(k){_=_.filter(Boolean);for(let S=0;S<_.length;S+=1)C(_[S]);p=!1},d(k){k&&A(e),T&&T.d(),pe(_,k),$=!1,Ce(j)}}}function _a(n){let e,r;return e=new qe({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ha(n){let e,r,t,o,i,l,s,a;r=new Ge({props:{except:"links"}}),o=new we({props:{data:de(n[1].links),generateId:!0,$$slots:{default:[_a]},$$scope:{ctx:n}}});function u(f){n[7](f)}let c={};return n[1].links[n[0]]!==void 0&&(c.f=n[1].links[n[0]]),l=new fa({props:c}),fe.push(()=>ge(l,"f",u)),{c(){e=v("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),i=L(),M(l.$$.fragment),P(e,"slot","map")},m(f,d){y(f,e,d),B(r,e,null),m(e,t),B(o,e,null),m(e,i),B(l,e,null),a=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].links)),d&65537&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const $={};!s&&d&3&&(s=!0,$.f=f[1].links[f[0]],_e(()=>s=!1)),l.$set($)},i(f){a||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(l.$$.fragment,f),a=!0)},o(f){C(r.$$.fragment,f),C(o.$$.fragment,f),C(l.$$.fragment,f),a=!1},d(f){f&&A(e),E(r),E(o),E(l)}}}function br(n){let e,r;return e=new Ut({props:{$$slots:{default:[ba]},$$scope:{ctx:n}}}),e.$on("close",n[12]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&65540&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ba(n){let e,r=n[2].description+"",t,o,i,l;return i=new vt({props:{metric:n[2]}}),{c(){e=v("p"),t=O(r),o=L(),M(i.$$.fragment)},m(s,a){y(s,e,a),m(e,t),y(s,o,a),B(i,s,a),l=!0},p(s,a){(!l||a&4)&&r!==(r=s[2].description+"")&&re(t,r);const u={};a&4&&(u.metric=s[2]),i.$set(u)},i(s){l||(h(i.$$.fragment,s),l=!0)},o(s){C(i.$$.fragment,s),l=!1},d(s){s&&(A(e),A(o)),E(i,s)}}}function $a(n){let e,r,t,o,i,l;e=new De({props:{$$slots:{map:[ha],sidebar:[ga]},$$scope:{ctx:n}}});let s=n[2]&&br(n);return{c(){M(e.$$.fragment),r=L(),s&&s.c(),t=Ue()},m(a,u){B(e,a,u),y(a,r,u),s&&s.m(a,u),y(a,t,u),o=!0,i||(l=H(da,"keydown",n[5]),i=!0)},p(a,[u]){const c={};u&65567&&(c.$$scope={dirty:u,ctx:a}),e.$set(c),a[2]?s?(s.p(a,u),u&4&&h(s,1)):(s=br(a),s.c(),h(s,1),s.m(t.parentNode,t)):s&&(ce(),C(s,1,1,()=>{s=null}),ue())},i(a){o||(h(e.$$.fragment,a),h(s),o=!0)},o(a){C(e.$$.fragment,a),C(s),o=!1},d(a){a&&(A(r),A(t)),E(e,a),s&&s.d(a),i=!1,l()}}}function ka(n,e,r){let t,o,i;ee(n,W,T=>r(1,o=T)),ee(n,X,T=>r(4,i=T));let{idx:l}=e,s=null;function a(T){T.key=="Escape"&&t&&Y(X,i={kind:"neutral"},i)}async function u(){window.confirm("Really delete this link?")&&(Y(X,i={kind:"neutral"},i),await lt(),o.links.splice(l,1),W.set(o))}function c(T){n.$$.not_equal(o.links[l],T)&&(o.links[l]=T,W.set(o))}const f=()=>Y(X,i={kind:"neutral"},i);function d(){o.links[l].properties.name=this.value,W.set(o)}const p=T=>r(2,s=Ve[T.name]);function $(T,g){n.$$.not_equal(o.links[l].properties.answers[g],T)&&(o.links[l].properties.answers[g]=T,W.set(o))}const j=()=>r(2,s=null);return n.$$set=T=>{"idx"in T&&r(0,l=T.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(3,t=o.links[l].geometry.coordinates.length>=2)},[l,o,s,t,i,a,u,c,f,d,p,$,j]}class wa extends oe{constructor(e){super(),ie(this,e,ka,$a,ne,{idx:0})}}function $r(n,e,r){const t=n.slice();return t[7]=e[r],t[8]=e,t[9]=r,t}function va(n){let e;return{c(){e=v("p"),e.textContent=`${n[3].description}`},m(r,t){y(r,e,t)},p:se,d(r){r&&A(e)}}}function kr(n){let e,r,t=n[7].properties.name+"",o,i,l,s,a,u;function c(d){n[6](d,n[7])}let f={k:"horiz-radio",choices:Ae[n[0]].choices};return n[7].properties.answers[n[0]]!==void 0&&(f.value=n[7].properties.answers[n[0]]),l=new Te({props:f}),fe.push(()=>ge(l,"value",c)),{c(){e=v("li"),r=v("span"),o=O(t),i=L(),M(l.$$.fragment),a=L(),Z(r,"color",n[7].properties.color)},m(d,p){y(d,e,p),m(e,r),m(r,o),m(e,i),B(l,e,null),m(e,a),u=!0},p(d,p){n=d,(!u||p&4)&&t!==(t=n[7].properties.name+"")&&re(o,t),p&4&&Z(r,"color",n[7].properties.color);const $={};p&1&&($.choices=Ae[n[0]].choices),!s&&p&5&&(s=!0,$.value=n[7].properties.answers[n[0]],_e(()=>s=!1)),l.$set($)},i(d){u||(h(l.$$.fragment,d),u=!0)},o(d){C(l.$$.fragment,d),u=!1},d(d){d&&A(e),E(l)}}}function ya(n){let e,r;return e=new vt({props:{metric:n[3]}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Aa(n){let e,r,t,o,i=Ae[n[0]].name+"",l,s,a=Ae[n[0]].description+"",u,c,f,d,p,$,j,T,g=n[3]&&va(n),_=x(n[2].links),b=[];for(let w=0;w<_.length;w+=1)b[w]=kr($r(n,_,w));const k=w=>C(b[w],1,1,()=>{b[w]=null});let S=n[3]&&ya(n);return{c(){e=v("div"),r=v("button"),r.textContent="Done",t=L(),o=v("h2"),l=O(i),s=O(": "),u=O(a),c=L(),g&&g.c(),f=L(),d=v("ol");for(let w=0;w<b.length;w+=1)b[w].c();p=L(),S&&S.c(),P(e,"slot","sidebar")},m(w,z){y(w,e,z),m(e,r),m(e,t),m(e,o),m(o,l),m(o,s),m(o,u),m(e,c),g&&g.m(e,null),m(e,f),m(e,d);for(let N=0;N<b.length;N+=1)b[N]&&b[N].m(d,null);m(e,p),S&&S.m(e,null),$=!0,j||(T=H(r,"click",n[5]),j=!0)},p(w,z){if((!$||z&1)&&i!==(i=Ae[w[0]].name+"")&&re(l,i),(!$||z&1)&&a!==(a=Ae[w[0]].description+"")&&re(u,a),w[3]&&g.p(w,z),z&5){_=x(w[2].links);let N;for(N=0;N<_.length;N+=1){const U=$r(w,_,N);b[N]?(b[N].p(U,z),h(b[N],1)):(b[N]=kr(U),b[N].c(),h(b[N],1),b[N].m(d,null))}for(ce(),N=_.length;N<b.length;N+=1)k(N);ue()}w[3]&&S.p(w,z)},i(w){if(!$){for(let z=0;z<_.length;z+=1)h(b[z]);h(S),$=!0}},o(w){b=b.filter(Boolean);for(let z=0;z<b.length;z+=1)C(b[z]);C(S),$=!1},d(w){w&&A(e),g&&g.d(),pe(b,w),S&&S.d(),j=!1,T()}}}function Ca(n){let e,r,t;return r=new Ge({props:{showColor:"links",except:"",showMissingProperty:["at",n[0],["get","answers"]]}}),{c(){e=v("div"),M(r.$$.fragment),P(e,"slot","map")},m(o,i){y(o,e,i),B(r,e,null),t=!0},p(o,i){const l={};i&1&&(l.showMissingProperty=["at",o[0],["get","answers"]]),r.$set(l)},i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){C(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function ja(n){let e,r,t,o;return e=new De({props:{$$slots:{map:[Ca],sidebar:[Aa]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=H(window,"keydown",n[4]),t=!0)},p(i,[l]){const s={};l&1031&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(h(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function Sa(n,e,r){let t,o;ee(n,X,c=>r(1,t=c)),ee(n,W,c=>r(2,o=c));let{qIdx:i}=e,l=Ve[Ae[i].name];function s(c){c.key=="Escape"&&Y(X,t={kind:"neutral"},t)}const a=()=>Y(X,t={kind:"neutral"},t);function u(c,f){n.$$.not_equal(f.properties.answers[i],c)&&(f.properties.answers[i]=c,W.set(o))}return n.$$set=c=>{"qIdx"in c&&r(0,i=c.qIdx)},[i,t,o,l,s,a,u]}class za extends oe{constructor(e){super(),ie(this,e,Sa,ja,ne,{qIdx:0})}}function La(n){let e,r,t,o;const i=n[2].default,l=Ie(i,n,n[1],null);return{c(){e=v("a"),l&&l.c(),P(e,"href","#"),Z(e,"color",n[0])},m(s,a){y(s,e,a),l&&l.m(e,null),r=!0,t||(o=H(e,"click",ao(n[3])),t=!0)},p(s,[a]){l&&l.p&&(!r||a&2)&&Oe(l,i,s,s[1],r?Fe(i,s[1],a,null):Pe(s[1]),null),a&1&&Z(e,"color",s[0])},i(s){r||(h(l,s),r=!0)},o(s){C(l,s),r=!1},d(s){s&&A(e),l&&l.d(s),t=!1,o()}}}function Ma(n,e,r){let{$$slots:t={},$$scope:o}=e,{color:i=void 0}=e;function l(s){ze.call(this,n,s)}return n.$$set=s=>{"color"in s&&r(0,i=s.color),"$$scope"in s&&r(1,o=s.$$scope)},[i,o,t,l]}class xe extends oe{constructor(e){super(),ie(this,e,Ma,La,ne,{color:0})}}function wr(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function Ba(n){let e;return{c(){e=O(`ST20
  `)},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Ea(n){let e=n[5].properties.name+"",r;return{c(){r=O(e)},m(t,o){y(t,r,o)},p(t,o){o&2&&e!==(e=t[5].properties.name+"")&&re(r,e)},d(t){t&&A(r)}}}function vr(n){let e,r,t,o;function i(){return n[4](n[7])}return r=new xe({props:{color:n[5].properties.color,$$slots:{default:[Ea]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){e=v("li"),M(r.$$.fragment),t=L()},m(l,s){y(l,e,s),B(r,e,null),m(e,t),o=!0},p(l,s){n=l;const a={};s&2&&(a.color=n[5].properties.color),s&258&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(l){o||(h(r.$$.fragment,l),o=!0)},o(l){C(r.$$.fragment,l),o=!1},d(l){l&&A(e),E(r)}}}function Ta(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$,j;l=new xe({props:{$$slots:{default:[Ba]},$$scope:{ctx:n}}}),l.$on("click",n[3]);let T=x(n[1].bus_stops),g=[];for(let b=0;b<T.length;b+=1)g[b]=vr(wr(n,T,b));const _=b=>C(g[b],1,1,()=>{g[b]=null});return{c(){e=O(`Bus stops:

`),r=v("div"),t=v("button"),t.textContent="New bus stop",o=L(),i=v("div"),M(l.$$.fragment),s=O(`:
  `),a=v("progress"),f=L(),d=v("ol");for(let b=0;b<g.length;b+=1)g[b].c();a.value=u=n[1].bus_stops.filter(yr).length,P(a,"max",c=n[1].bus_stops.length),P(a,"class","svelte-zadug4")},m(b,k){y(b,e,k),y(b,r,k),m(r,t),y(b,o,k),y(b,i,k),B(l,i,null),m(i,s),m(i,a),y(b,f,k),y(b,d,k);for(let S=0;S<g.length;S+=1)g[S]&&g[S].m(d,null);p=!0,$||(j=H(t,"click",n[2]),$=!0)},p(b,[k]){const S={};if(k&256&&(S.$$scope={dirty:k,ctx:b}),l.$set(S),(!p||k&2&&u!==(u=b[1].bus_stops.filter(yr).length))&&(a.value=u),(!p||k&2&&c!==(c=b[1].bus_stops.length))&&P(a,"max",c),k&3){T=x(b[1].bus_stops);let w;for(w=0;w<T.length;w+=1){const z=wr(b,T,w);g[w]?(g[w].p(z,k),h(g[w],1)):(g[w]=vr(z),g[w].c(),h(g[w],1),g[w].m(d,null))}for(ce(),w=T.length;w<g.length;w+=1)_(w);ue()}},i(b){if(!p){h(l.$$.fragment,b);for(let k=0;k<T.length;k+=1)h(g[k]);p=!0}},o(b){C(l.$$.fragment,b),g=g.filter(Boolean);for(let k=0;k<g.length;k+=1)C(g[k]);p=!1},d(b){b&&(A(e),A(r),A(o),A(i),A(f),A(d)),E(l),pe(g,b),$=!1,j()}}}const yr=n=>n.properties.st20!="";function Da(n,e,r){let t,o;return ee(n,X,a=>r(0,t=a)),ee(n,W,a=>r(1,o=a)),[t,o,()=>Y(X,t={kind:"new-point",obj:"bus stop"},t),()=>Y(X,t={kind:"bus-stop-questions"},t),a=>Y(X,t={kind:"edit-bus-stop",idx:a},t)]}let Na=class extends oe{constructor(e){super(),ie(this,e,Da,Ta,ne,{})}};function Ar(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function Ia(n){let e;return{c(){e=O(`SA10
  `)},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Oa(n){let e=n[5].properties.name+"",r;return{c(){r=O(e)},m(t,o){y(t,r,o)},p(t,o){o&2&&e!==(e=t[5].properties.name+"")&&re(r,e)},d(t){t&&A(r)}}}function Cr(n){let e,r,t,o;function i(){return n[4](n[7])}return r=new xe({props:{color:n[5].properties.color,$$slots:{default:[Oa]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){e=v("li"),M(r.$$.fragment),t=L()},m(l,s){y(l,e,s),B(r,e,null),m(e,t),o=!0},p(l,s){n=l;const a={};s&2&&(a.color=n[5].properties.color),s&258&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(l){o||(h(r.$$.fragment,l),o=!0)},o(l){C(r.$$.fragment,l),o=!1},d(l){l&&A(e),E(r)}}}function Pa(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$,j;l=new xe({props:{$$slots:{default:[Ia]},$$scope:{ctx:n}}}),l.$on("click",n[3]);let T=x(n[1].crossings),g=[];for(let b=0;b<T.length;b+=1)g[b]=Cr(Ar(n,T,b));const _=b=>C(g[b],1,1,()=>{g[b]=null});return{c(){e=O(`Crossings:

`),r=v("div"),t=v("button"),t.textContent="New crossing",o=L(),i=v("div"),M(l.$$.fragment),s=O(`:
  `),a=v("progress"),f=L(),d=v("ol");for(let b=0;b<g.length;b+=1)g[b].c();a.value=u=n[1].crossings.filter(jr).length,P(a,"max",c=n[1].crossings.length)},m(b,k){y(b,e,k),y(b,r,k),m(r,t),y(b,o,k),y(b,i,k),B(l,i,null),m(i,s),m(i,a),y(b,f,k),y(b,d,k);for(let S=0;S<g.length;S+=1)g[S]&&g[S].m(d,null);p=!0,$||(j=H(t,"click",n[2]),$=!0)},p(b,[k]){const S={};if(k&256&&(S.$$scope={dirty:k,ctx:b}),l.$set(S),(!p||k&2&&u!==(u=b[1].crossings.filter(jr).length))&&(a.value=u),(!p||k&2&&c!==(c=b[1].crossings.length))&&P(a,"max",c),k&3){T=x(b[1].crossings);let w;for(w=0;w<T.length;w+=1){const z=Ar(b,T,w);g[w]?(g[w].p(z,k),h(g[w],1)):(g[w]=Cr(z),g[w].c(),h(g[w],1),g[w].m(d,null))}for(ce(),w=T.length;w<g.length;w+=1)_(w);ue()}},i(b){if(!p){h(l.$$.fragment,b);for(let k=0;k<T.length;k+=1)h(g[k]);p=!0}},o(b){C(l.$$.fragment,b),g=g.filter(Boolean);for(let k=0;k<g.length;k+=1)C(g[k]);p=!1},d(b){b&&(A(e),A(r),A(o),A(i),A(f),A(d)),E(l),pe(g,b),$=!1,j()}}}const jr=n=>n.properties.sa10!="";function Fa(n,e,r){let t,o;return ee(n,X,a=>r(0,t=a)),ee(n,W,a=>r(1,o=a)),[t,o,()=>Y(X,t={kind:"new-point",obj:"crossing"},t),()=>Y(X,t={kind:"crossing-questions"},t),a=>Y(X,t={kind:"edit-crossing",idx:a},t)]}let qa=class extends oe{constructor(e){super(),ie(this,e,Fa,Pa,ne,{})}};function Sr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Ua(n){let e=n[4].properties.name+"",r;return{c(){r=O(e)},m(t,o){y(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&re(r,e)},d(t){t&&A(r)}}}function zr(n){let e,r,t,o;function i(){return n[3](n[6])}return r=new xe({props:{color:n[4].properties.color,$$slots:{default:[Ua]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){e=v("li"),M(r.$$.fragment),t=L()},m(l,s){y(l,e,s),B(r,e,null),m(e,t),o=!0},p(l,s){n=l;const a={};s&2&&(a.color=n[4].properties.color),s&130&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(l){o||(h(r.$$.fragment,l),o=!0)},o(l){C(r.$$.fragment,l),o=!1},d(l){l&&A(e),E(r)}}}function Ra(n){let e,r,t,o,i,l,s,a,u=x(n[1].jats),c=[];for(let d=0;d<u.length;d+=1)c[d]=zr(Sr(n,u,d));const f=d=>C(c[d],1,1,()=>{c[d]=null});return{c(){e=O(`JATs:

`),r=v("div"),t=v("button"),t.textContent="New JAT",o=L(),i=v("ol");for(let d=0;d<c.length;d+=1)c[d].c()},m(d,p){y(d,e,p),y(d,r,p),m(r,t),y(d,o,p),y(d,i,p);for(let $=0;$<c.length;$+=1)c[$]&&c[$].m(i,null);l=!0,s||(a=H(t,"click",n[2]),s=!0)},p(d,[p]){if(p&3){u=x(d[1].jats);let $;for($=0;$<u.length;$+=1){const j=Sr(d,u,$);c[$]?(c[$].p(j,p),h(c[$],1)):(c[$]=zr(j),c[$].c(),h(c[$],1),c[$].m(i,null))}for(ce(),$=u.length;$<c.length;$+=1)f($);ue()}},i(d){if(!l){for(let p=0;p<u.length;p+=1)h(c[p]);l=!0}},o(d){c=c.filter(Boolean);for(let p=0;p<c.length;p+=1)C(c[p]);l=!1},d(d){d&&(A(e),A(r),A(o),A(i)),pe(c,d),s=!1,a()}}}function Ga(n,e,r){let t,o;return ee(n,X,s=>r(0,t=s)),ee(n,W,s=>r(1,o=s)),[t,o,()=>Y(X,t={kind:"new-point",obj:"jat"},t),s=>Y(X,t={kind:"edit-jat",idx:s},t)]}let Ja=class extends oe{constructor(e){super(),ie(this,e,Ga,Ra,ne,{})}};function Lr(n,e,r){const t=n.slice();return t[2]=e[r],t[4]=r,t}function Mr(n,e,r){const t=n.slice();t[5]=e[r];const o=t[5].properties.answers[t[4]];return t[6]=o,t}function Br(n,e,r){const t=n.slice();return t[5]=e[r],t}function Er(n){let e,r=n[5].properties.name+"",t;return{c(){e=v("th"),t=O(r),Z(e,"color",n[5].properties.color)},m(o,i){y(o,e,i),m(e,t)},p(o,i){i&1&&r!==(r=o[5].properties.name+"")&&re(t,r),i&1&&Z(e,"color",o[5].properties.color)},d(o){o&&A(e)}}}function Tr(n){let e,r=n[6]+"",t;return{c(){e=v("td"),t=O(r),Z(e,"background",n[6]==""?"red":"green")},m(o,i){y(o,e,i),m(e,t)},p(o,i){i&1&&r!==(r=o[6]+"")&&re(t,r),i&1&&Z(e,"background",o[6]==""?"red":"green")},d(o){o&&A(e)}}}function Dr(n){let e,r,t,o,i=x(n[0].links),l=[];for(let s=0;s<i.length;s+=1)l[s]=Tr(Mr(n,i,s));return{c(){e=v("tr"),r=v("th"),r.textContent=`${n[2].name}`,t=L();for(let s=0;s<l.length;s+=1)l[s].c();o=L()},m(s,a){y(s,e,a),m(e,r),m(e,t);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);m(e,o)},p(s,a){if(a&1){i=x(s[0].links);let u;for(u=0;u<i.length;u+=1){const c=Mr(s,i,u);l[u]?l[u].p(c,a):(l[u]=Tr(c),l[u].c(),l[u].m(e,o))}for(;u<l.length;u+=1)l[u].d(1);l.length=i.length}},d(s){s&&A(e),pe(l,s)}}}function Qa(n){let e,r,t,o,i,l,s,a=x(n[0].links),u=[];for(let d=0;d<a.length;d+=1)u[d]=Er(Br(n,a,d));let c=x(Ae),f=[];for(let d=0;d<c.length;d+=1)f[d]=Dr(Lr(n,c,d));return{c(){e=v("table"),r=v("thead"),t=v("tr"),o=v("th"),i=L();for(let d=0;d<u.length;d+=1)u[d].c();l=L(),s=v("tbody");for(let d=0;d<f.length;d+=1)f[d].c()},m(d,p){y(d,e,p),m(e,r),m(r,t),m(t,o),m(t,i);for(let $=0;$<u.length;$+=1)u[$]&&u[$].m(t,null);m(e,l),m(e,s);for(let $=0;$<f.length;$+=1)f[$]&&f[$].m(s,null)},p(d,p){if(p&1){a=x(d[0].links);let $;for($=0;$<a.length;$+=1){const j=Br(d,a,$);u[$]?u[$].p(j,p):(u[$]=Er(j),u[$].c(),u[$].m(t,null))}for(;$<u.length;$+=1)u[$].d(1);u.length=a.length}if(p&1){c=x(Ae);let $;for($=0;$<c.length;$+=1){const j=Lr(d,c,$);f[$]?f[$].p(j,p):(f[$]=Dr(j),f[$].c(),f[$].m(s,null))}for(;$<f.length;$+=1)f[$].d(1);f.length=c.length}},d(d){d&&A(e),pe(u,d),pe(f,d)}}}function Ha(n){let e,r;return e=new Ut({props:{$$slots:{default:[Qa]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,[o]){const i={};o&2049&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ka(n,e,r){let t;ee(n,W,i=>r(0,t=i));function o(i){ze.call(this,n,i)}return[t,o]}class Wa extends oe{constructor(e){super(),ie(this,e,Ka,Ha,ne,{})}}function Nr(n,e,r){const t=n.slice();return t[9]=e[r],t[11]=r,t}function Ir(n,e,r){const t=n.slice();return t[12]=e[r],t[11]=r,t}function Or(n){let e,r;return e=new Wa({}),e.$on("close",n[4]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Za(n){let e=n[12].properties.name+"",r;return{c(){r=O(e)},m(t,o){y(t,r,o)},p(t,o){o&2&&e!==(e=t[12].properties.name+"")&&re(r,e)},d(t){t&&A(r)}}}function Pr(n){let e,r,t,o;function i(){return n[6](n[11])}return r=new xe({props:{color:n[12].properties.color,$$slots:{default:[Za]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){e=v("li"),M(r.$$.fragment),t=L()},m(l,s){y(l,e,s),B(r,e,null),m(e,t),o=!0},p(l,s){n=l;const a={};s&2&&(a.color=n[12].properties.color),s&16386&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(l){o||(h(r.$$.fragment,l),o=!0)},o(l){C(r.$$.fragment,l),o=!1},d(l){l&&A(e),E(r)}}}function Xa(n){let e=n[9].name+"",r,t;return{c(){r=O(e),t=L()},m(o,i){y(o,r,i),y(o,t,i)},p:se,d(o){o&&(A(r),A(t))}}}function Fr(n){let e,r,t,o,i,l,s,a;function u(){return n[7](n[11])}r=new xe({props:{$$slots:{default:[Xa]},$$scope:{ctx:n}}}),r.$on("click",u);function c(...f){return n[8](n[11],...f)}return{c(){e=v("li"),M(r.$$.fragment),t=O(`:
      `),o=v("progress"),s=L(),o.value=i=n[1].links.filter(c).length,P(o,"max",l=n[1].links.length),P(o,"class","svelte-zadug4")},m(f,d){y(f,e,d),B(r,e,null),m(e,t),m(e,o),m(e,s),a=!0},p(f,d){n=f;const p={};d&16384&&(p.$$scope={dirty:d,ctx:n}),r.$set(p),(!a||d&2&&i!==(i=n[1].links.filter(c).length))&&(o.value=i),(!a||d&2&&l!==(l=n[1].links.length))&&P(o,"max",l)},i(f){a||(h(r.$$.fragment,f),a=!0)},o(f){C(r.$$.fragment,f),a=!1},d(f){f&&A(e),E(r)}}}function Va(n){let e,r,t,o,i,l,s,a,u,c,f,d,p=n[0]&&Or(n),$=x(n[1].links),j=[];for(let k=0;k<$.length;k+=1)j[k]=Pr(Ir(n,$,k));const T=k=>C(j[k],1,1,()=>{j[k]=null});let g=x(Ae),_=[];for(let k=0;k<g.length;k+=1)_[k]=Fr(Nr(n,g,k));const b=k=>C(_[k],1,1,()=>{_[k]=null});return{c(){p&&p.c(),e=L(),r=v("div"),t=v("button"),t.textContent="New link",o=L(),i=v("button"),i.textContent="Table of questions",l=O(`

Links:
`),s=v("ol");for(let k=0;k<j.length;k+=1)j[k].c();a=O(`

Questions:
`),u=v("ol");for(let k=0;k<_.length;k+=1)_[k].c()},m(k,S){p&&p.m(k,S),y(k,e,S),y(k,r,S),m(r,t),m(r,o),m(r,i),y(k,l,S),y(k,s,S);for(let w=0;w<j.length;w+=1)j[w]&&j[w].m(s,null);y(k,a,S),y(k,u,S);for(let w=0;w<_.length;w+=1)_[w]&&_[w].m(u,null);c=!0,f||(d=[H(t,"click",n[3]),H(i,"click",n[5])],f=!0)},p(k,[S]){if(k[0]?p?(p.p(k,S),S&1&&h(p,1)):(p=Or(k),p.c(),h(p,1),p.m(e.parentNode,e)):p&&(ce(),C(p,1,1,()=>{p=null}),ue()),S&6){$=x(k[1].links);let w;for(w=0;w<$.length;w+=1){const z=Ir(k,$,w);j[w]?(j[w].p(z,S),h(j[w],1)):(j[w]=Pr(z),j[w].c(),h(j[w],1),j[w].m(s,null))}for(ce(),w=$.length;w<j.length;w+=1)T(w);ue()}if(S&6){g=x(Ae);let w;for(w=0;w<g.length;w+=1){const z=Nr(k,g,w);_[w]?(_[w].p(z,S),h(_[w],1)):(_[w]=Fr(z),_[w].c(),h(_[w],1),_[w].m(u,null))}for(ce(),w=g.length;w<_.length;w+=1)b(w);ue()}},i(k){if(!c){h(p);for(let S=0;S<$.length;S+=1)h(j[S]);for(let S=0;S<g.length;S+=1)h(_[S]);c=!0}},o(k){C(p),j=j.filter(Boolean);for(let S=0;S<j.length;S+=1)C(j[S]);_=_.filter(Boolean);for(let S=0;S<_.length;S+=1)C(_[S]);c=!1},d(k){k&&(A(e),A(r),A(l),A(s),A(a),A(u)),p&&p.d(k),pe(j,k),pe(_,k),f=!1,Ce(d)}}}function Ya(n,e,r){let t,o;ee(n,W,d=>r(1,t=d)),ee(n,X,d=>r(2,o=d));let i=!1;function l(){let d=xr(t.links.length);Y(W,t.links=[...t.links,d],t),Y(X,o={kind:"edit-link",idx:t.links.length-1},o)}return[i,t,o,l,()=>r(0,i=!1),()=>r(0,i=!0),d=>Y(X,o={kind:"edit-link",idx:d},o),d=>Y(X,o={kind:"link-questions",idx:d},o),(d,p)=>p.properties.answers[d]!=""]}class xa extends oe{constructor(e){super(),ie(this,e,Ya,Va,ne,{})}}function ec(n){let e,r,t,o,i,l,s,a,u,c,f,d,p,$,j,T,g,_,b,k,S,w,z,N,U,F,V,D;return p=new xa({}),g=new Ja({}),S=new Na({}),U=new qa({}),{c(){e=v("div"),r=v("div"),t=v("button"),t.textContent="Load file",o=L(),i=v("button"),i.textContent="Download",l=L(),s=v("button"),s.textContent="Clear",a=L(),u=v("button"),u.textContent="Draw an entire route",c=L(),f=v("hr"),d=L(),M(p.$$.fragment),$=L(),j=v("hr"),T=L(),M(g.$$.fragment),_=L(),b=v("hr"),k=L(),M(S.$$.fragment),w=L(),z=v("hr"),N=L(),M(U.$$.fragment),P(t,"class","secondary"),P(i,"class","secondary"),P(s,"class","secondary"),P(e,"slot","sidebar")},m(q,Q){y(q,e,Q),m(e,r),m(r,t),m(r,o),m(r,i),m(r,l),m(r,s),m(e,a),m(e,u),m(e,c),m(e,f),m(e,d),B(p,e,null),m(e,$),m(e,j),m(e,T),B(g,e,null),m(e,_),m(e,b),m(e,k),B(S,e,null),m(e,w),m(e,z),m(e,N),B(U,e,null),F=!0,V||(D=[H(t,"click",n[11]),H(i,"click",n[12]),H(s,"click",n[5]),H(u,"click",n[6])],V=!0)},p:se,i(q){F||(h(p.$$.fragment,q),h(g.$$.fragment,q),h(S.$$.fragment,q),h(U.$$.fragment,q),F=!0)},o(q){C(p.$$.fragment,q),C(g.$$.fragment,q),C(S.$$.fragment,q),C(U.$$.fragment,q),F=!1},d(q){q&&A(e),E(p),E(g),E(S),E(U),V=!1,Ce(D)}}}function tc(n){let e,r;return e=new qe({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":It(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[7]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function nc(n){let e,r;return e=new Ze({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":It(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[8]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function rc(n){let e,r;return e=new Ye({props:{manageHoverState:!0,layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[9]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function oc(n){let e,r;return e=new Ye({props:{manageHoverState:!0,layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[10]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ic(n){let e,r,t,o,i,l,s,a,u;return r=new we({props:{data:de(n[2].links),generateId:!0,$$slots:{default:[tc]},$$scope:{ctx:n}}}),o=new we({props:{data:de(n[2].jats),generateId:!0,$$slots:{default:[nc]},$$scope:{ctx:n}}}),l=new we({props:{data:de(n[2].bus_stops),generateId:!0,$$slots:{default:[rc]},$$scope:{ctx:n}}}),a=new we({props:{data:de(n[2].crossings),generateId:!0,$$slots:{default:[oc]},$$scope:{ctx:n}}}),{c(){e=v("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),i=L(),M(l.$$.fragment),s=L(),M(a.$$.fragment),P(e,"slot","map")},m(c,f){y(c,e,f),B(r,e,null),m(e,t),B(o,e,null),m(e,i),B(l,e,null),m(e,s),B(a,e,null),u=!0},p(c,f){const d={};f&4&&(d.data=de(c[2].links)),f&65544&&(d.$$scope={dirty:f,ctx:c}),r.$set(d);const p={};f&4&&(p.data=de(c[2].jats)),f&65544&&(p.$$scope={dirty:f,ctx:c}),o.$set(p);const $={};f&4&&($.data=de(c[2].bus_stops)),f&65544&&($.$$scope={dirty:f,ctx:c}),l.$set($);const j={};f&4&&(j.data=de(c[2].crossings)),f&65544&&(j.$$scope={dirty:f,ctx:c}),a.$set(j)},i(c){u||(h(r.$$.fragment,c),h(o.$$.fragment,c),h(l.$$.fragment,c),h(a.$$.fragment,c),u=!0)},o(c){C(r.$$.fragment,c),C(o.$$.fragment,c),C(l.$$.fragment,c),C(a.$$.fragment,c),u=!1},d(c){c&&A(e),E(r),E(o),E(l),E(a)}}}function qr(n){let e,r;return e=new Ut({props:{$$slots:{default:[lc]},$$scope:{ctx:n}}}),e.$on("close",n[14]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&65538&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function lc(n){let e,r,t,o,i;return{c(){e=v("h1"),e.textContent="Load a file previously downloaded from this tool",r=L(),t=v("input"),P(t,"type","file")},m(l,s){y(l,e,s),y(l,r,s),y(l,t,s),n[13](t),o||(i=H(t,"change",n[4]),o=!0)},p:se,d(l){l&&(A(e),A(r),A(t)),n[13](null),o=!1,i()}}}function sc(n){let e,r,t,o;e=new De({props:{$$slots:{map:[ic],sidebar:[ec]},$$scope:{ctx:n}}});let i=n[0]&&qr(n);return{c(){M(e.$$.fragment),r=L(),i&&i.c(),t=Ue()},m(l,s){B(e,l,s),y(l,r,s),i&&i.m(l,s),y(l,t,s),o=!0},p(l,[s]){const a={};s&65549&&(a.$$scope={dirty:s,ctx:l}),e.$set(a),l[0]?i?(i.p(l,s),s&1&&h(i,1)):(i=qr(l),i.c(),h(i,1),i.m(t.parentNode,t)):i&&(ce(),C(i,1,1,()=>{i=null}),ue())},i(l){o||(h(e.$$.fragment,l),h(i),o=!0)},o(l){C(e.$$.fragment,l),C(i),o=!1},d(l){l&&(A(r),A(t)),E(e,l),i&&i.d(l)}}}function ac(n,e,r){let t,o,i;ee(n,Ot,b=>r(15,t=b)),ee(n,W,b=>r(2,o=b)),ee(n,X,b=>r(3,i=b));let l=!1,s;async function a(b){try{let k=JSON.parse(await s.files[0].text());if(Wr(k)){Y(W,o=k,o),r(0,l=!1);return}}catch{}window.alert("Something's wrong with that file")}function u(){Y(W,o.links=[],o),Y(W,o.jats=[],o),Y(W,o.bus_stops=[],o),Y(W,o.crossings=[],o)}async function c(){await Sl(t)}const f=b=>Y(X,i={kind:"edit-link",idx:b.detail.features[0].id},i),d=b=>Y(X,i={kind:"edit-jat",idx:b.detail.features[0].id},i),p=b=>Y(X,i={kind:"edit-bus-stop",idx:b.detail.features[0].id},i),$=b=>Y(X,i={kind:"edit-crossing",idx:b.detail.features[0].id},i),j=()=>r(0,l=!0),T=()=>zi("rcv2.geojson",JSON.stringify(o));function g(b){fe[b?"unshift":"push"](()=>{s=b,r(1,s)})}return[l,s,o,i,a,u,c,f,d,p,$,j,T,g,()=>r(0,l=!1)]}class cc extends oe{constructor(e){super(),ie(this,e,ac,sc,ne,{})}}function uc(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:We[n%We.length],st20:""}}}function fc(n){let e,r,t,o,i,l,s,a;return{c(){e=v("div"),r=v("h1"),t=O("Click map to create new "),o=O(n[0]),i=L(),l=v("button"),l.textContent="Cancel",P(e,"slot","sidebar")},m(u,c){y(u,e,c),m(e,r),m(r,t),m(r,o),m(e,i),m(e,l),s||(a=H(l,"click",n[3]),s=!0)},p(u,c){c&1&&re(o,u[0])},d(u){u&&A(e),s=!1,a()}}}function dc(n){let e,r,t;return r=new Ge({props:{except:""}}),{c(){e=v("div"),M(r.$$.fragment),P(e,"slot","map")},m(o,i){y(o,e,i),B(r,e,null),t=!0},p:se,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){C(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function pc(n){let e,r,t,o;return e=new wt({}),e.$on("click",n[2]),t=new De({props:{$$slots:{map:[dc],sidebar:[fc]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment)},m(i,l){B(e,i,l),y(i,r,l),B(t,i,l),o=!0},p(i,[l]){const s={};l&35&&(s.$$scope={dirty:l,ctx:i}),t.$set(s)},i(i){o||(h(e.$$.fragment,i),h(t.$$.fragment,i),o=!0)},o(i){C(e.$$.fragment,i),C(t.$$.fragment,i),o=!1},d(i){i&&A(r),E(e,i),E(t,i)}}}function mc(n,e,r){let t,o;ee(n,W,a=>r(4,t=a)),ee(n,X,a=>r(1,o=a));let{obj:i}=e;function l(a){let u=a.detail.lngLat.toArray();if(i=="jat"){let c=Yr(t.jats.length,u);Y(W,t.jats=[...t.jats,c],t),Y(X,o={kind:"edit-jat",idx:t.jats.length-1},o)}else if(i=="crossing"){let c=Vr(t.crossings.length,u);Y(W,t.crossings=[...t.crossings,c],t),Y(X,o={kind:"edit-crossing",idx:t.crossings.length-1},o)}else if(i=="bus stop"){let c=uc(t.bus_stops.length,u);Y(W,t.bus_stops=[...t.bus_stops,c],t),Y(X,o={kind:"edit-bus-stop",idx:t.bus_stops.length-1},o)}}const s=()=>Y(X,o={kind:"neutral"},o);return n.$$set=a=>{"obj"in a&&r(0,i=a.obj)},[i,o,l,s]}class gc extends oe{constructor(e){super(),ie(this,e,mc,pc,ne,{obj:0})}}function _c(n){let e,r;return{c(){e=v("div"),r=v("div"),P(e,"slot","left")},m(t,o){y(t,e,o),m(e,r),n[13](r)},p:se,d(t){t&&A(e),n[13](null)}}}function Ur(n){let e,r,t;function o(l){n[12](l)}let i={style:n[2],standardControls:!0,hash:!0,images:[{id:"bus_stop",url:Hr,options:{sdf:!0}},{id:"crossing",url:Kr,options:{sdf:!0}}],$$slots:{default:[zc]},$$scope:{ctx:n}};return n[3]!==void 0&&(i.map=n[3]),e=new Ao({props:i}),fe.push(()=>ge(e,"map",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,s){const a={};s&4&&(a.style=l[2]),s&32794&&(a.$$scope={dirty:s,ctx:l}),!r&&s&8&&(r=!0,a.map=l[3],_e(()=>r=!1)),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function hc(n){let e,r;return e=new Ul({props:{graph:n[4].graph,map:n[3],editingExisting:!1,finish:n[10],cancel:n[11]}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&16&&(i.graph=t[4].graph),o&8&&(i.map=t[3]),o&16&&(i.finish=t[10]),o&16&&(i.cancel=t[11]),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function bc(n){let e,r;return e=new ei({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function $c(n){let e,r;return e=new za({props:{qIdx:n[4].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&16&&(i.qIdx=t[4].idx),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function kc(n){let e,r;return e=new tl({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function wc(n){let e,r;return e=new ul({props:{idx:n[4].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&16&&(i.idx=t[4].idx),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function vc(n){let e,r;return e=new di({props:{idx:n[4].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&16&&(i.idx=t[4].idx),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function yc(n){let e,r;return e=new ea({props:{junctionIdx:n[4].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&16&&(i.junctionIdx=t[4].idx),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ac(n){let e,r;return e=new sa({props:{idx:n[4].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&16&&(i.idx=t[4].idx),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Cc(n){let e,r;return e=new wa({props:{idx:n[4].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&16&&(i.idx=t[4].idx),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function jc(n){let e,r;return e=new gc({props:{obj:n[4].obj}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&16&&(i.obj=t[4].obj),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Sc(n){let e,r;return e=new cc({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:se,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function zc(n){let e,r,t,o,i,l,s;const a=[Sc,jc,Cc,Ac,yc,vc,wc,kc,$c,bc,hc],u=[];function c(f,d){return f[4].kind=="neutral"?0:f[4].kind=="new-point"?1:f[4].kind=="edit-link"?2:f[4].kind=="edit-jat"?3:f[4].kind=="edit-jat-detail"?4:f[4].kind=="edit-bus-stop"?5:f[4].kind=="edit-crossing"?6:f[4].kind=="crossing-questions"?7:f[4].kind=="link-questions"?8:f[4].kind=="bus-stop-questions"?9:f[4].kind=="draw-route"&&f[3]?10:-1}return~(t=c(n))&&(o=u[t]=a[t](n)),l=new Xi({}),{c(){e=v("div"),r=L(),o&&o.c(),i=L(),M(l.$$.fragment)},m(f,d){y(f,e,d),n[9](e),y(f,r,d),~t&&u[t].m(f,d),y(f,i,d),B(l,f,d),s=!0},p(f,d){let p=t;t=c(f),t===p?~t&&u[t].p(f,d):(o&&(ce(),C(u[p],1,1,()=>{u[p]=null}),ue()),~t?(o=u[t],o?o.p(f,d):(o=u[t]=a[t](f),o.c()),h(o,1),o.m(i.parentNode,i)):o=null)},i(f){s||(h(o),h(l.$$.fragment,f),s=!0)},o(f){C(o),C(l.$$.fragment,f),s=!1},d(f){f&&(A(e),A(r),A(i)),n[9](null),~t&&u[t].d(f),E(l,f)}}}function Lc(n){let e,r,t=n[2]&&Ur(n);return{c(){e=v("div"),t&&t.c(),P(e,"slot","main"),Z(e,"position","relative"),Z(e,"width","100%"),Z(e,"height","100vh")},m(o,i){y(o,e,i),t&&t.m(e,null),r=!0},p(o,i){o[2]?t?(t.p(o,i),i&4&&h(t,1)):(t=Ur(o),t.c(),h(t,1),t.m(e,null)):t&&(ce(),C(t,1,1,()=>{t=null}),ue())},i(o){r||(h(t),r=!0)},o(o){C(t),r=!1},d(o){o&&A(e),t&&t.d()}}}function Mc(n){let e,r;return e=new yo({props:{$$slots:{main:[Lc],left:[_c]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,[o]){const i={};o&32799&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Bc(n,e,r){let t,o,i,l,s,a;ee(n,Vt,_=>r(5,t=_)),ee(n,Xt,_=>r(6,o=_)),ee(n,Zt,_=>r(7,i=_)),ee(n,W,_=>r(8,l=_)),ee(n,Ot,_=>r(3,s=_)),ee(n,X,_=>r(4,a=_));let u,c,f=null;co(async()=>{r(2,f=await fn(t))});async function d(_){r(2,f=await fn(_))}function p(_){fe[_?"unshift":"push"](()=>{c=_,r(1,c),r(6,o)})}const $=()=>zl(a.graph),j=()=>Y(X,a={kind:"neutral"},a);function T(_){s=_,Ot.set(s)}function g(_){fe[_?"unshift":"push"](()=>{u=_,r(0,u),r(7,i)})}return n.$$.update=()=>{n.$$.dirty&256&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(l)),n.$$.dirty&129&&u&&i&&(r(0,u.innerHTML="",u),u.appendChild(i)),n.$$.dirty&66&&c&&o&&(r(1,c.innerHTML="",c),c.appendChild(o)),n.$$.dirty&32&&d(t)},[u,c,f,s,a,t,o,i,l,p,$,j,T,g]}class Ec extends oe{constructor(e){super(),ie(this,e,Bc,Mc,ne,{})}}new Ec({target:document.getElementById("app")});
