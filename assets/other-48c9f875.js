import{X as fo,Y as po,Z as zt,v as ue,e as y,w as fe,t as b,$ as mo,S as se,i as ae,s as ie,h as De,z as $,B as F,a0 as Ae,r as k,u as Ne,j as Ie,k as Oe,x as w,a1 as Kr,a2 as ne,a3 as Ft,b as pe,a4 as xt,Q as g,R as G,l as ze,a5 as go,L as _o,a as ke,c as B,m as E,d as we,f as T,g as Wr,q as Qe,a6 as en,a7 as ho,a8 as bo,a9 as K,aa as $o,ab as ko,C as ee,ac as wo,A as L,ad as Ke,H as O,I as le,ae as vo,p as x,af as yo,ag as tn,y as ge,T as je,O as ve,N as Ht,G as Ce,E as Fe,F as rt,V as Y,M as Ye,ah as ut,ai as nt,aj as $t,ak as Ao,P as vt,al as Co,am as nn,an as jo,ao as Lt,ap as So,_ as zo,aq as Lo,n as Tt,ar as Kt,as as Mo,at as Rt,D as kt,au as Bo,J as Eo,U as To}from"./Layout-af018016.js";function Do(n,e){const r=e.token={};function t(o,l,i,a){if(e.token!==r)return;e.resolved=a;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=a);const u=o&&(e.current=o)(s);let c=!1;e.block&&(e.blocks?e.blocks.forEach((f,d)=>{d!==l&&f&&(ue(),y(f,1,1,()=>{e.blocks[d]===f&&(e.blocks[d]=null)}),fe())}):e.block.d(1),u.c(),b(u,1),u.m(e.mount(),e.anchor),c=!0),e.block=u,e.blocks&&(e.blocks[l]=u),c&&mo()}if(fo(n)){const o=po();if(n.then(l=>{zt(o),t(e.then,1,e.value,l),zt(null)},l=>{if(zt(o),t(e.catch,2,e.error,l),zt(null),!e.hasCatch)throw l}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function No(n,e,r){const t=e.slice(),{resolved:o}=n;n.current===n.then&&(t[n.value]=o),n.current===n.catch&&(t[n.error]=o),n.block.p(t,r)}function Io(n){let e,r;const t=n[7].default,o=De(t,n,n[6],null);return{c(){e=$("div"),o&&o.c(),F(e,"class",n[1]),Ae(e,"maplibregl-ctrl",n[0])},m(l,i){k(l,e,i),o&&o.m(e,null),n[8](e),r=!0},p(l,[i]){o&&o.p&&(!r||i&64)&&Ne(o,t,l,l[6],r?Oe(t,l[6],i,null):Ie(l[6]),null),(!r||i&2)&&F(e,"class",l[1]),(!r||i&3)&&Ae(e,"maplibregl-ctrl",l[0])},i(l){r||(b(o,l),r=!0)},o(l){y(o,l),r=!1},d(l){l&&w(e),o&&o.d(l),n[8](null)}}}function Oo(n,e,r){let t,{$$slots:o={},$$scope:l}=e,{defaultStyling:i=!0}=e,{position:a="top-right"}=e,{class:s=void 0}=e;const{map:u}=Kr();ne(n,u,p=>r(5,t=p));let c,f={onAdd(){return c},onRemove(){var p;(p=c==null?void 0:c.parentNode)==null||p.removeChild(c)}};Ft(()=>{t==null||t.removeControl(f)});function d(p){pe[p?"unshift":"push"](()=>{c=p,r(2,c)})}return n.$$set=p=>{"defaultStyling"in p&&r(0,i=p.defaultStyling),"position"in p&&r(4,a=p.position),"class"in p&&r(1,s=p.class),"$$scope"in p&&r(6,l=p.$$scope)},n.$$.update=()=>{n.$$.dirty&52&&t&&c&&t.addControl(f,a)},[i,s,c,u,a,t,l,o,d]}class Fo extends se{constructor(e){super(),ae(this,e,Oo,Io,ie,{defaultStyling:0,position:4,class:1})}}function qo(n){let e,r,t,o,l,i;const a=n[4].default,s=De(a,n,n[3],null);return{c(){e=$("button"),r=$("div"),s&&s.c(),F(r,"class",t=xt(n[2])+" svelte-1s83zbq"),Ae(r,"maplibregl-ctrl-icon",n[0]),Ae(r,"ctrl-btn-center",n[1]),F(e,"type","button")},m(u,c){k(u,e,c),g(e,r),s&&s.m(r,null),o=!0,l||(i=G(e,"click",n[5]),l=!0)},p(u,[c]){s&&s.p&&(!o||c&8)&&Ne(s,a,u,u[3],o?Oe(a,u[3],c,null):Ie(u[3]),null),(!o||c&4&&t!==(t=xt(u[2])+" svelte-1s83zbq"))&&F(r,"class",t),(!o||c&5)&&Ae(r,"maplibregl-ctrl-icon",u[0]),(!o||c&6)&&Ae(r,"ctrl-btn-center",u[1])},i(u){o||(b(s,u),o=!0)},o(u){y(s,u),o=!1},d(u){u&&w(e),s&&s.d(u),l=!1,i()}}}function Po(n,e,r){let{$$slots:t={},$$scope:o}=e,{icon:l=!0}=e,{center:i=!0}=e,{class:a=void 0}=e;function s(u){ze.call(this,n,u)}return n.$$set=u=>{"icon"in u&&r(0,l=u.icon),"center"in u&&r(1,i=u.center),"class"in u&&r(2,a=u.class),"$$scope"in u&&r(3,o=u.$$scope)},[l,i,a,o,t,s]}class Zr extends se{constructor(e){super(),ae(this,e,Po,qo,ie,{icon:0,center:1,class:2})}}function Uo(n,e,r){let t;const o=go();let{layer:l=void 0}=e;const{map:i}=Kr();ne(n,i,c=>r(2,t=c));function a(c){o(c.type,{...c,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Ft(()=>{if(t)if(l)for(const c of s)t.off(c,l,a);else for(const c of u)t.off(c,a)}),n.$$set=c=>{"layer"in c&&r(1,l=c.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(l)for(const c of s)t.on(c,l,a);else for(const c of u)t.on(c,a)},[i,l,t]}class qt extends se{constructor(e){super(),ae(this,e,Uo,null,ie,{layer:1})}}function Ro(n){let e;const r=n[16].default,t=De(r,n,n[24],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16777216)&&Ne(t,r,o,o[24],e?Oe(r,o[24],l,null):Ie(o[24]),null)},i(o){e||(b(t,o),e=!0)},o(o){y(t,o),e=!1},d(o){t&&t.d(o)}}}function Go(n){let e,r,t;function o(i){n[17](i)}let l={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Ro]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.hovered=n[0]),e=new _o({props:l}),pe.push(()=>ke(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.hovered=i[0],we(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){T(e,i)}}}function Jo(n,e,r){let{$$slots:t={},$$scope:o}=e,{id:l=Wr("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:f=void 0}=e,{filter:d=void 0}=e,{applyToClusters:p=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:A=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:_=!1}=e,{hovered:C=null}=e,{eventsIfTopMost:j=!1}=e,{interactive:h=!0}=e;function S(D){C=D,r(0,C)}function v(D){ze.call(this,n,D)}function M(D){ze.call(this,n,D)}function I(D){ze.call(this,n,D)}function q(D){ze.call(this,n,D)}function Z(D){ze.call(this,n,D)}function V(D){ze.call(this,n,D)}return n.$$set=D=>{"id"in D&&r(1,l=D.id),"source"in D&&r(2,i=D.source),"sourceLayer"in D&&r(3,a=D.sourceLayer),"beforeId"in D&&r(4,s=D.beforeId),"beforeLayerType"in D&&r(5,u=D.beforeLayerType),"paint"in D&&r(6,c=D.paint),"layout"in D&&r(7,f=D.layout),"filter"in D&&r(8,d=D.filter),"applyToClusters"in D&&r(9,p=D.applyToClusters),"minzoom"in D&&r(10,m=D.minzoom),"maxzoom"in D&&r(11,A=D.maxzoom),"hoverCursor"in D&&r(12,z=D.hoverCursor),"manageHoverState"in D&&r(13,_=D.manageHoverState),"hovered"in D&&r(0,C=D.hovered),"eventsIfTopMost"in D&&r(14,j=D.eventsIfTopMost),"interactive"in D&&r(15,h=D.interactive),"$$scope"in D&&r(24,o=D.$$scope)},[C,l,i,a,s,u,c,f,d,p,m,A,z,_,j,h,t,S,v,M,I,q,Z,V,o]}class ot extends se{constructor(e){super(),ae(this,e,Jo,Go,ie,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function rn(n){let e=n[0],r,t,o=on(n);return{c(){o.c(),r=Qe()},m(l,i){o.m(l,i),k(l,r,i),t=!0},p(l,i){i&1&&ie(e,e=l[0])?(ue(),y(o,1,1,ee),fe(),o=on(l),o.c(),b(o,1),o.m(r.parentNode,r)):o.p(l,i)},i(l){t||(b(o),t=!0)},o(l){y(o),t=!1},d(l){l&&w(r),o.d(l)}}}function on(n){let e;const r=n[15].default,t=De(r,n,n[14],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16384)&&Ne(t,r,o,o[14],e?Oe(r,o[14],l,null):Ie(o[14]),null)},i(o){e||(b(t,o),e=!0)},o(o){y(t,o),e=!1},d(o){t&&t.d(o)}}}function Qo(n){let e,r,t=n[0]&&rn(n);return{c(){t&&t.c(),e=Qe()},m(o,l){t&&t.m(o,l),k(o,e,l),r=!0},p(o,[l]){o[0]?t?(t.p(o,l),l&1&&b(t,1)):(t=rn(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(ue(),y(t,1,1,()=>{t=null}),fe())},i(o){r||(b(t),r=!0)},o(o){y(t),r=!1},d(o){o&&w(e),t&&t.d(o)}}}function Ho(n,e,r){let t,o,{$$slots:l={},$$scope:i}=e,{id:a=Wr("vector")}=e,{url:s=null}=e,{tiles:u=null}=e,{promoteId:c=null}=e,{bounds:f=null}=e,{scheme:d=null}=e,{attribution:p=null}=e,{minzoom:m=null}=e,{maxzoom:A=null}=e,{volatile:z=null}=e;if(s&&s.includes("pmtiles://")&&!en.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let h=new wo;en.addProtocol("pmtiles",h.tile)}const{map:_,self:C}=ho();ne(n,_,h=>r(13,o=h)),ne(n,C,h=>r(0,t=h));let j;return Ft(()=>{t&&o&&(bo(_,t,j),K(C,t=null,t),j=void 0)}),n.$$set=h=>{"id"in h&&r(3,a=h.id),"url"in h&&r(4,s=h.url),"tiles"in h&&r(5,u=h.tiles),"promoteId"in h&&r(6,c=h.promoteId),"bounds"in h&&r(7,f=h.bounds),"scheme"in h&&r(8,d=h.scheme),"attribution"in h&&r(9,p=h.attribution),"minzoom"in h&&r(10,m=h.minzoom),"maxzoom"in h&&r(11,A=h.maxzoom),"volatile"in h&&r(12,z=h.volatile),"$$scope"in h&&r(14,i=h.$$scope)},n.$$.update=()=>{n.$$.dirty&16377&&o&&t!==a&&(K(C,t=a,t),$o(o,t,ko({type:"vector",url:s,tiles:u,promoteId:c,bounds:f,scheme:d,attribution:p,minzoom:m,maxzoom:A,volatile:z}),h=>o&&h===t,()=>{t&&(j=o==null?void 0:o.getSource(t))})),n.$$.dirty&8200&&(o==null||o.on("style.load",()=>{j=o==null?void 0:o.getSource(a)}))},[t,_,C,a,s,u,c,f,d,p,m,A,z,o,i,l]}class Xr extends se{constructor(e){super(),ae(this,e,Ho,Qo,ie,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const Ko=n=>({}),ln=n=>({}),Wo=n=>({}),sn=n=>({});function Zo(n){let e,r,t,o;const l=n[3].sidebar,i=De(l,n,n[2],sn),a=n[3].map,s=De(a,n,n[2],ln);return{c(){e=$("div"),i&&i.c(),r=L(),t=$("div"),s&&s.c()},m(u,c){k(u,e,c),i&&i.m(e,null),n[4](e),k(u,r,c),k(u,t,c),s&&s.m(t,null),n[5](t),o=!0},p(u,[c]){i&&i.p&&(!o||c&4)&&Ne(i,l,u,u[2],o?Oe(l,u[2],c,Wo):Ie(u[2]),sn),s&&s.p&&(!o||c&4)&&Ne(s,a,u,u[2],o?Oe(a,u[2],c,Ko):Ie(u[2]),ln)},i(u){o||(b(i,u),b(s,u),o=!0)},o(u){y(i,u),y(s,u),o=!1},d(u){u&&(w(e),w(r),w(t)),i&&i.d(u),n[4](null),s&&s.d(u),n[5](null)}}}function Xo(n,e,r){let t,o;ne(n,Wt,u=>r(0,t=u)),ne(n,Zt,u=>r(1,o=u));let{$$slots:l={},$$scope:i}=e;function a(u){pe[u?"unshift":"push"](()=>{t=u,Wt.set(t)})}function s(u){pe[u?"unshift":"push"](()=>{o=u,Zt.set(o)})}return n.$$set=u=>{"$$scope"in u&&r(2,i=u.$$scope)},[t,o,i,l,a,s]}class Pe extends se{constructor(e){super(),ae(this,e,Xo,Zo,ie,{})}}let Wt=Ke(null),Zt=Ke(null);const Vr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAACmlBMVEXo6uzn6e3o6u7n6ezn6uzm6Ozn6evo6ezm6evo6e3p6u7p6+3p6u3o6u3n6u3n6evn6evn6ezo6uzo6u3n6evn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezo6uzo6uzo6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezo6+3n6ezn6ezn6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6ezn6e3n6e3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6e3o6u3o6uzo6uzo6u3o6u3o6u3n6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6uzn6ezn6e3o6u3o6u3o6u3o6u3o6u3n6u3n6ezo6u3o6u3o6uzn6uzn6ezo6ezo6uzn6ezo6u3o6u3o6u3n6u3n6Ozm6ezn6ezo6u3o6u3o6uzo6u3n6u3o6e3o6u3o6u3o6u3n6u3n6ezo6uzo6u3o6u3n6+3o6uzo6u3o6u3o6uzo6uzn6uzn6uzn6ezn6ezn6ezn6ezo6u3n6ezo6ezn6ezn6ezn6ezn6ezn6e3o6u3o6e3n6ezn6ezo6uzn6evo6uzo6uzn6evn6ezo6u3n6ezn6uzo6u3n6ezn6ezo6u3n6u3n6ezo6u3o6u3n6ezn6u3o6u3o6u3n6ezo6u3n6u3n6ezn6ezo6u3n6ezo6u3n6e3n6uzn6ezn6ezn6ezn6ezn6ezn6ezo6u3o6u3n6ezn6ezo6u3o6e3o6u3n6e3o6u3n6u3n6uzo6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6evo6u3o6u3o6u3n6uvn6ezo6u3n6uzn6ezn6ezn6ezo6u3n6uzn6uzo6u3n6u3n6uzo6+zm6uzjK5F0AAAA3nRSTlMAAAAAAAAAAAAAAAAAAAAIDxIUFBMDKEVdbn2IjpOWlpCJb15HKgUACXqjwtrt/P/u3MSmSg0gc7vz4dnSz83U5fT3vnciCnPV8MCdg2JYUk5LU1pmdoyoy/rYdApBt31IIyMjIyyI0LY/AABh366lq19s6GnraXg8PHsAAwOEeF0MKiEiCymqnFmeqXsncN6sOTuuDYzPTlCJCHhyOjyxcGfmkhotgqFcrYIrHONkymEKEC8mLg9jzMhNmr1XVVi/mCSz79ddrI6v3FooDSsAQ6OCFReFoi48GTwtAAD3GpCFAAADBklEQVR4nKWUh1IUQRCGZ+nx8JRZMcspoiKekfbMomDABAaSCbNwxhPMgmLOCTFnxZxzzlkxY86+i927BxzeUmWVf+1O1c5+09Pd09NCaJoWAFJCOQAb0GuzQSAPAOXppVlhD6hQMUgIJpUECUxpviCAxoOuKlRUShikMmYMk5WCK1epWi24UgloDwhSBOqKSTtNVa9Rs1aIo3ad0LphofXqOxqEN4xoxLDBKaGcTiU0pRo3bNK0WfMWkehVZEtXq9aONm1Ne0oXQHuT0XbtO3Sk3y2jOnWOjomJ7tK8azf67B7boydTJMFeBIpevftgXHzffiH9ByQkJiUlJqcMHDR4yNBUHDZ8hG5IlCMBjByF0aPHjE1Loyfd7U5Lc7vd6eOSx0/AiZN0jSUmTyaTnikZmDnVQtPQNZ0ou10JMy8zWmAZmjmLIyeLdkMExloKZ8/x+lgEpmZlz/XXvMjZc3IM+YA2ofxkDVqQ/wn+69bzF/jLClxoqUi/9JSVcD+LGGUpfzB10WILzfPfmqKGJUuXcXkaguURK0BYgysdq1avCTRQCSlr163PVdbghjzEjZvoflJJbd6C6ArRLcGt2yjI7TvMq7qzM33s2u0DFtVj6h7YG4WYuY8sKoD9+YgZB2A9gdKQFzx4CA8fOXos8/gJ8+g0CD9+8tTpM2F49hyAAZotYedQPH/h4qXLV6D4mHOvXltx/QbevMX/PR4vmHsb8U7W3XuldD/rAeLDR5wrqixza0h+jPjk6V+KQ8xPgKLUeslneVYn7Uqhm2UD7lFgNizFYMHzUnqB+PIVJ4uyYGdQY98ZXPX6jY/eFpggo+yjt64NsIZPceuni0GW6WehzfbufXzsh48l2ZGeT59j47+MNHowg4WFheahff327Ts5UwQScCT7x0/JfYdbrDA8oBauSUkhUUP1ngx4aJEOimbNJsVBM6dLyUFpmtcesHFdCiWVMkGbzNFB1xWBupPnDFzzcDJotXJKJ22kCeJyqFupXyaoVCAw+JuzrGi5cOqSurf2B4tMU69Bi01ZAAAAAElFTkSuQmCC",Yr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMA/1uRIrUAAAjuSURBVHic7dxLlqM2FAZgCOdEGUUZZtCntZPWlrKCiKwgW2IpZAdkxoBAbJCEHle27r3UoxNr0KdMoc9Y/HoArm6aV3mVV/m/lHYbeIDaFh6wbVvPqd/dgJEDyBswcwB9A1YOYG7AxgHu9Tmt2O3ASAfEDkx0QO4A4zSwAbUDjDDrHWAEYY8BJwhs4KhPT1JrgeHDgM4C4/cLCAuQe9PHA9IC5O74Al7AC/hswHc8IrGBj58XPn5ydUBPBdgLjE+wRtJ7fcYyT+0AY6HJXuqyV+vs64WWF8SGf8nDv+hSvLN4wYUn+9KXffHNv/xvmAfwKq/yKq/yKv+p0rImxua+TBt4B8Ccm++LLNZN4X15wAI0c4nVMBd5xzKRscw8Vrqc06CYS+1jlcg4jy33ckNwr5gUF9DMq0Z30UcG2FfOkgso7t0DwwTclTcZEFzANQG5O2ousDGBjgtILqC5gGECPkZUQHABFQK/EAATAr8SgC0EvuDrdxHwFQ/ICFB4QMdAjwa2GBiw9dsEGLGASAD0oKQSAB1GkwDoNcLGBLoUwC4yRApgFxk50OMAmQEDDlAZMOIAnQHIJOUAMkkmA5BByAFkEHIAGYQtB3ouMHCBkQvgggAAqCC4EfGfAEAFwQF/BwAqCA74KwBQQXDAHyHQ44G1DYEBD8wRMCIAO6aOEYAJggX6CMAE4QDWJgIwQehsvQjABME9mokATBCOaaFPgB4JrE0CDEhgSYERCcwpgAgCDCCCAAOIIEgQQAQBBhBBkLbNEqDnAgMXGLlAfRDUGwH1SXLRT4D6JBWA+iQVgPok6QLQc4GBC4woYAgAu/StDkIGCPcDFbBTVXUQTAq46ZoMuEUTHTC4IBi78wloXBByAJmkHJC4JG0ZILhAh4uiO2Un0HKBBpdlADBcQGOAFgAUF0B9KWevt8aA4AIdF2gxQAcADRswXEBjgSUBFBdwiw4yIBCAgIBdHRlAiwXO9Nimu/80cADDBe5B6DnAPQh19c/HlBEg6yfXFFjccdVO7z500aze1o/qKWA/ev3ElAH9vllXz+4ZMOybu+olkoKB+uIBt7IZKcAYANj72jIFsPe1T8CESWIA2NvSJ6CjJOGA4f6TipJUXUQGDFSA+OC480ctuIB7TIBMUmsb/iffGbBJsqf+i48iNkm2yhdyksxx0N/ISdJHs2lykuRx4kzvgzDgAHHUuP1DTFJ7fOgbQP0DBnNMKyM1Se44JnKS9tIFF4yk7+OIezVikiywkpO0F3mvRkySA8hJ2ovagiCMBEBvzCDsXYoTBLO/LyMIW3jngAiwktQe1ehJsmMzPUl2dqAnyU5w9CSJoxo9SXaxR0+SWzGTk6Q2ZhD0FgWBCARBQANmi4PQ04AzCAMWcNWo39BrXTVqkvy9K2qSOn/gxCR1vumISRIe0LQgSH/2iUk6AWKSlH9bYpK0bzlikk7ABQGZJHOefA5w3sRCRzGopClRDG/jqg8Bzr7kk4TrDGdf8knCASIAXJJQwNkV0jshBAD7gGQvKqxjCN1Rhe2mCYAOAUUAgr7kG2QgA4IARB0wjCUOsENAiweSZyp4IDloE3HvAiTtrqlAb1+q8JxUFRkD+D97jvqSOyDMmBb1JdemGEBzARPXaGPvPYCoL9GBKXldXz97PokFsgEgzhUBMEggG8OIwFlBJ+CzIrlA0pcuAFTSqM9K0peoQND7VBKsZ8WkgEQCSV+6AEA9NYae9dOAMQWqx7R8NkYOivl6gAb0KVA9pmV9CTsoZl2BDyAHxawv0YCozbNWeViyvoQdFLOucBkw1NWHvjejCcBIBqCVrco3lQu0tr4IqBzT8r6EHBQlkFsUAPQl3KAI9KV3BoC+hBsUDfBuKADoS6hRFfwOGmZQBK/RMAB8lQhko1Tg69T3BKC+hBoUob6EAqC+hBpVoa6AGhTZANSXUIMi1JdQANSXMEDh+5zlQbENT7BeQkAFvcIB7q813d95JIBZwr6UA3MjZxiwh2Pm8EZgCIgE6IqAYAG3Dxn0pRBwg6JYQMDl7rZzJdAWAVurIQH3/9b7qLWmgBsUuxUElhPQdUBTBMzmNxzWET+br6dAH/alEGgeA/7k9sBN9RjwkXkMTBlwHNlt98dA1BkBoC8AvotFExsM9Me+ugCEN9UjQL8tMB4b5er/qq4MDMe+qgCIEqBwQIMEhgRYc0AmgIQA9RTYv6FTASxFoIOB/jkgEkBAgF794FkGphpgygE7ihaABgTMFhxOCnQQYFwSxwJwG1TDZwY5sJWB9hGwpsCQA83xowfah0BfAO4T1yNgcwMKBBgLLACwpEADAHpvGxXsDAH9OVyngNrb5iHQPgTk/tF08HlPYA4Ac4IxIOx3Os4Wh4BjbpwhoLXfKnkAdJudnUHg9nLatwHAGe9jfTCBwP4fOZyx1QVA+iRnT6x/O/YuA+L+U+eTDD3y7rYtmBg8MAZA8B6PAQUCc9jOR/1o4S5gYPC/Xe6/mMqAPAGZA3LfWfjLCgDQ0d4AANyBiwADA+dBAfcAI2CLPnAKqC2+sMuBcCItAMNDQBSA5gTGh4AKgC4H9BnKArBHa3oIzI+AY8TNgTUA0iaPNqkQaGFgKwPdn9sTwARnGQLs6zkDlhAYa4GmAMxFIP12Vg4cv38KLBkwRxV8ElyFtQCYApBVqAZKFUqvT2CiAboEpI3mB5m3A8ZjQ1cJnL3/8wDDsUHUAv3xUpaAuQSYNwP8hkrAv+HnAZoYmEqAjoEuBVQC+P9uKwXGq4GVCLQpoGuB6WpgSX4/loD0M6aAqQXmq4GZCpirAbf/8AxYEmCqBWQC6IuBthpYE2CkAupiwO/f29+LFEg3OGB4BpRE+WmA/tn+pQ3irYCmBKQf0gHuE9UDrtU+C5BOCxXAeLxuYWAtAu0bAQsZaGJA1wPTtcBMB36PAGN/66/yfDAGt8VtmK8FJjrwLQK2emC5FhjpwFcQmMtA2kwR0CKANQIGOvDzpUCHALYI6BNgKgM6AX68FBAYoA+Bhg78cCkgM0C5LeNDIHu/sQz4LUPzKq/yKq9yefkXR6tlrDrSxQ4AAAAASUVORK5CYII=";function Se(){return["","2","1","0","Critical"]}let qe=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],xe={SA01:{description:"Pedestrian and cyclist conflict with motor traffic at side roads/priority junctions",green:"Side roads/priority junctions have entry treatments that offer greater protection for  pedestrian and cycle movements (e.g. exit only, continuous footways, zebra/parallel crossings as appropriate to context).",amber:"<2,500vpd cut across main walking, wheeling or cycling streams and side roads and priority junctions have entry treatments. ",red:"<2,500vpd cut across main walking, wheeling or cycling streams, but side roads and priority junctions are untreated.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA02:{description:"Pedestrian and cyclist conflict with motor traffic at roundabouts and signal-controlled junctions",green:"All pedestrian and cyclist movements are separated from all motor traffic movements at roundabouts and/or signal controlled junctions.",amber:"The principal pedestrian and cyclist movements are separated from motor traffic movements at roundabouts and/or signal controlled junctions.",red:"The principal pedestrian and/or cyclist movements are in conflict with motor traffic movements at roundabouts and/or signal controlled junctions.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA03:{description:"Effect of lane widths on conflict between cyclists and motor traffic",green:"Cyclists are protected from motor traffic or off-road entirely.",amber:`Cyclists are in cycle lanes with light protection or stepped cycle tracks under 1.8m wide (single direction).

Or, cyclists are in a protected bidirectional cycle facility under 2.5m wide.

Or, cyclists are mixed with traffic on quiet urban streets with no centre line.`,red:`Cyclists are mixed with traffic in lanes less than 3.25m wide or over 3.9m wide.

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is under 3.25m or over 3.9m. 

Or cyclists are mixed with traffic on busy urban streets with no centre line.

Or, there are speed cushions present.`,critical:`Cyclists are mixed with traffic in lanes between 3.25m and 3.9m wide. 

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is between 3.25m and 3.9m.`},SA04:{description:"Risk of pedestrians tripping due to hazards",green:"No trip hazards, level clear surface.",amber:"Few trip hazards.",red:"Many trip hazards.",critical:"There are level differences of greater than 13mm with no tactile information and colour contrast to help identify them."},SA05:{description:"Cyclist conflict with kerbside activity, including risk of 'dooring' ",green:"Kerbside activity is well-managed with no or minimal conflict with cyclists. ",amber:"Less frequent kerbside activity, and conflict with cyclists is well-managed.",red:"Frequent kerbside activity for cyclists to contend with. Conflict with cyclists is not well-managed.",critical:`Cycle facility next to parking/loading facility, without a buffer of at least 0.5m.

Or, an unprotected cycle lane is next to a frequently-used bus layby.`},SA06:{description:"Ability of pedestrians to cross the street safely on desire lines",green:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 50-100m. 

On quieter streets (<8,000vpd), there are controlled crossings or only one lane of traffic to cross.`,amber:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 100-200m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross on desire lines.`,red:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 200-400m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross.`,critical:`On very busy streets (>8,000vpd) controlled crossings (including zebra crossings) are not present or more than 400m apart.

On quieter streets (<8,000vpd), desire lines are blocked by parking and loading. `},SA07:{description:"Suitability of pedestrian crossings in context",green:`On very busy streets (>8,000vpd), signal crossings rest on green for pedestrians or have rapid response.

On quieter streets (<8,000vpd), crossing points are controlled crossings.`,amber:`On very busy streets (>8,000vpd), signal crossings are provided for pedestrians.

On quieter streets (<8,000vpd), crossing points have effective implied priority for pedestrians.`,red:`On very busy streets (>8,000vpd), there are uncontrolled crossings or zebra/parallel crossings.

On quieter streets (<8,000vpd), crossing points have no implied priority or there are no crossing points.`,critical:`On very busy streets (>8,000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic.

At signal junctions there are arms with dropped kerbs and tactile paving but no green pedestrian symbol.`},SA08:{description:"85th percentile speed of motor traffic (where cyclists are not protected or pedestrians are crossing uncontrolled)",green:`85th percentile speed is under 20mph.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:"85th percentile speed is between 20mph and 25mph.",red:"85th percentile speed is over 25mph.",critical:"85th percentile speed is over 30mph."},SA09:{description:"Volume of motor traffic at the busiest hour (where cyclists are not protected or pedestrians cross uncontrolled)",green:`<200 vehicles in the busiest hour.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:`200-499 vehicles in the busiest hour.

And, less than 2% of traffic is HGVs.`,red:`500-1,000 vehicles in the busiest hour.

Or, 2-5% of traffic is HGVs where there are 200-499 vehicles in the busiest hour.`,critical:`>1,000 vehicles in the busiest hour.

Or, over 5% of traffic is HGVs where there are over 500 vehicles in the busiest hour.`},SA10:{description:"Required crossing speed at signal crossings (risk of pedestrians coming into conflict with traffic).",green:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1m/s.",amber:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1.2m/s.",red:"There are no detectors to extend crossing times, but pedestrians who start crossing at the end of the 'invitation to cross' can cross at a speed of 1.2m/s and get across the whole crossing in time.",critical:"Pedestrians who start crossing at the end of the 'invitation to cross' must cross at a speed of over 1.2m/s to get across the whole crossing in time."},SA11:{description:"Clear walking and wheeling spaces free of permanent obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",green:">3m clear footway width and pedestrian comfort is good (PCL of A-C).",amber:`Where the footway is next to the carriageway, there is:
• 2m-3m clear footway width and pedestrian comfort is good (PCL of A-C).
• >3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is 1.5m-3m.`,red:`Where the footway is next to the carriageway, there is:
• <2m clear footway width but pedestrian comfort is good (PCL of A-C)
• 2m-3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is <1.5m.`,critical:`Where the footway is next to the carriageway, there is:
• <1m clear footway width on any footway
• <1.5m clear footway width for over 6m
• 1m-2m clear footway width with a Pedestrian Comfort Level of D-E

Or there is no footway.`},SA12:{description:"Effective width next to tram line on a straight run or a curve",green:"Physical protection is provided for cyclists.",amber:">2.4m from tramline edge to kerb.",red:"2.4m from tramline edge to kerb.",critical:`<2.4m from tramline edge to kerb on a straight run.

Insufficient clearance on a curve.`},SA13:{description:"Crossing angle (between cyclist desire line and tram or train rails).",green:"Crossing angle between 80 and 90 degrees with track filler creating a smooth crossing for cyclists.",amber:"Crossing angle between 80 and 90 degrees (or between 60 and 80 degrees with track filler creating a smooth crossing for cyclists).",red:"Crossing angle between 60 and 80 degrees.",critical:"Crossing angle less than 60 degrees."},SA14:{description:`Cycling surface and maintenance defects:
• sharp gradients (≥12.5%)
• non cycle friendly ironworks
• raised/sunken covers or gullies
• potholes
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA15:{description:`Walking/wheeling surface and maintenance defects:
• steep camber (horizontal gradient >2.5% )
• steep longitudinal gradients (≥8% if under 1m, ≥5% if 1m or over) 
• missing dropped kerbs
• non flush tables
• misleading tactile information
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation
`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA16:{description:"Presence of guard railing",green:"No guard railing anywhere on the route.",amber:"Minimal guard railing, used to address a clear safety issue such as a level difference.",red:"Guard railing used to control behaviour in complex environments.",critical:"Guard railing used as standard without consideration of inherent safety risks."},ST20:{description:"Interactions at bus stops.",green:"At bus stops, cyclists are protected from buses and traffic and interactions between pedestrians and cyclists are likely to be low-level.",amber:"At bus stops, cyclists are protected from buses and traffic, but there are likely to be medium-level interactions between pedestrians and cyclists.",red:"At bus stops, cyclists regularly have to wait behind buses or overtake them in general traffic lanes. Or, there are likely to be high-level interactions between pedestrians and cyclists.",critical:""}};function an(n){let e,r,t,o=n[0].critical+"",l;return{c(){e=$("p"),r=$("b"),r.textContent="Critical",t=O(`
    : `),l=O(o)},m(i,a){k(i,e,a),g(e,r),g(e,t),g(e,l)},p(i,a){a&1&&o!==(o=i[0].critical+"")&&le(l,o)},d(i){i&&w(e)}}}function Vo(n){let e,r,t,o=n[0].green+"",l,i,a,s,u,c=n[0].amber+"",f,d,p,m,A,z=n[0].red+"",_,C,j,h=n[0].critical&&an(n);return{c(){e=$("p"),r=$("b"),r.textContent="2",t=O(`
  : `),l=O(o),i=L(),a=$("p"),s=$("b"),s.textContent="1",u=O(`
  : `),f=O(c),d=L(),p=$("p"),m=$("b"),m.textContent="0",A=O(`
  : `),_=O(z),C=L(),h&&h.c(),j=Qe()},m(S,v){k(S,e,v),g(e,r),g(e,t),g(e,l),k(S,i,v),k(S,a,v),g(a,s),g(a,u),g(a,f),k(S,d,v),k(S,p,v),g(p,m),g(p,A),g(p,_),k(S,C,v),h&&h.m(S,v),k(S,j,v)},p(S,[v]){v&1&&o!==(o=S[0].green+"")&&le(l,o),v&1&&c!==(c=S[0].amber+"")&&le(f,c),v&1&&z!==(z=S[0].red+"")&&le(_,z),S[0].critical?h?h.p(S,v):(h=an(S),h.c(),h.m(j.parentNode,j)):h&&(h.d(1),h=null)},i:ee,o:ee,d(S){S&&(w(e),w(i),w(a),w(d),w(p),w(C),w(j)),h&&h.d(S)}}}function Yo(n,e,r){let{metric:t}=e;return n.$$set=o=>{"metric"in o&&r(0,t=o.metric)},[t]}class ft extends se{constructor(e){super(),ae(this,e,Yo,Vo,ie,{metric:0})}}function cn(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function un(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function xo(n){let e,r,t,o,l,i;const a=n[5].default,s=De(a,n,n[4],null);let u=x(n[2]),c=[];for(let f=0;f<u.length;f+=1)c[f]=fn(cn(n,u,f));return{c(){e=$("label"),s&&s.c(),r=L(),t=$("select");for(let f=0;f<c.length;f+=1)c[f].c();n[0]===void 0&&yo(()=>n[10].call(t))},m(f,d){k(f,e,d),s&&s.m(e,null),g(e,r),g(e,t);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(t,null);tn(t,n[0],!0),o=!0,l||(i=[G(t,"change",n[10]),G(t,"change",n[7])],l=!0)},p(f,d){if(s&&s.p&&(!o||d&16)&&Ne(s,a,f,f[4],o?Oe(a,f[4],d,null):Ie(f[4]),null),d&4){u=x(f[2]);let p;for(p=0;p<u.length;p+=1){const m=cn(f,u,p);c[p]?c[p].p(m,d):(c[p]=fn(m),c[p].c(),c[p].m(t,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=u.length}d&5&&tn(t,f[0])},i(f){o||(b(s,f),o=!0)},o(f){y(s,f),o=!1},d(f){f&&w(e),s&&s.d(f),ge(c,f),l=!1,je(i)}}}function el(n){let e,r,t,o;const l=n[5].default,i=De(l,n,n[4],null);let a=x(n[2]),s=[];for(let u=0;u<a.length;u+=1)s[u]=dn(un(n,a,u));return{c(){e=$("fieldset"),i&&i.c(),r=L(),t=$("div");for(let u=0;u<s.length;u+=1)s[u].c();F(t,"class","svelte-1vb210n"),Ae(t,"horiz_radio",n[1]=="horiz-radio")},m(u,c){k(u,e,c),i&&i.m(e,null),g(e,r),g(e,t);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(t,null);o=!0},p(u,c){if(i&&i.p&&(!o||c&16)&&Ne(i,l,u,u[4],o?Oe(l,u[4],c,null):Ie(u[4]),null),c&5){a=x(u[2]);let f;for(f=0;f<a.length;f+=1){const d=un(u,a,f);s[f]?s[f].p(d,c):(s[f]=dn(d),s[f].c(),s[f].m(t,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=a.length}(!o||c&2)&&Ae(t,"horiz_radio",u[1]=="horiz-radio")},i(u){o||(b(i,u),o=!0)},o(u){y(i,u),o=!1},d(u){u&&w(e),i&&i.d(u),ge(s,u)}}}function fn(n){let e,r=n[12]+"",t;return{c(){e=$("option"),t=O(r),e.__value=n[11],ve(e,e.__value)},m(o,l){k(o,e,l),g(e,t)},p:ee,d(o){o&&w(e)}}}function dn(n){let e,r,t,o=n[12]+"",l,i,a,s,u;return a=Ht(n[9][0]),{c(){e=$("label"),r=$("input"),t=L(),l=O(o),i=L(),F(r,"type","radio"),r.__value=n[11],ve(r,r.__value),a.p(r)},m(c,f){k(c,e,f),g(e,r),r.checked=r.__value===n[0],g(e,t),g(e,l),g(e,i),s||(u=[G(r,"change",n[8]),G(r,"change",n[6])],s=!0)},p(c,f){f&5&&(r.checked=r.__value===c[0])},d(c){c&&w(e),a.r(),s=!1,je(u)}}}function tl(n){let e,r,t,o;const l=[el,xo],i=[];function a(s,u){return s[1]=="horiz-radio"||s[1]=="vert-radio"?0:s[1]=="dropdown"?1:-1}return~(e=a(n))&&(r=i[e]=l[e](n)),{c(){r&&r.c(),t=Qe()},m(s,u){~e&&i[e].m(s,u),k(s,t,u),o=!0},p(s,[u]){let c=e;e=a(s),e===c?~e&&i[e].p(s,u):(r&&(ue(),y(i[c],1,1,()=>{i[c]=null}),fe()),~e?(r=i[e],r?r.p(s,u):(r=i[e]=l[e](s),r.c()),b(r,1),r.m(t.parentNode,t)):r=null)},i(s){o||(b(r),o=!0)},o(s){y(r),o=!1},d(s){s&&w(t),~e&&i[e].d(s)}}}function nl(n,e,r){let{$$slots:t={},$$scope:o}=e,{k:l}=e,{value:i}=e,{choices:a}=e,s=a[0].length==2?a:a.map(m=>[m,m]);const u=[[]];function c(m){ze.call(this,n,m)}function f(m){ze.call(this,n,m)}function d(){i=this.__value,r(0,i),r(2,s)}function p(){i=vo(this),r(0,i),r(2,s)}return n.$$set=m=>{"k"in m&&r(1,l=m.k),"value"in m&&r(0,i=m.value),"choices"in m&&r(3,a=m.choices),"$$scope"in m&&r(4,o=m.$$scope)},[i,l,s,a,o,t,c,f,d,u,p]}class Je extends se{constructor(e){super(),ae(this,e,nl,tl,ie,{k:1,value:0,choices:3})}}let Nt=Ke(void 0),J=Ke(rl());function me(n){return{type:"FeatureCollection",features:n}}let W=Ke({kind:"neutral"});function xr(n){return"links"in n&&"jats"in n&&"bus_stops"&&"crossings"in n&&"side_roads"in n}function rl(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if(xr(n))return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[],side_roads:[]}}function pn(n){let e,r;return e=new Ce({props:{data:me(n[2].links),$$slots:{default:[ol]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].links)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function ol(n){let e,r;return e=new Fe({props:{paint:{"line-color":n[1]=="links"?["get","color"]:"black","line-width":6}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"line-color":t[1]=="links"?["get","color"]:"black","line-width":6}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function mn(n){let e,r;return e=new Ce({props:{data:me(n[2].bus_stops),$$slots:{default:[ll]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].bus_stops)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function ll(n){let e,r;return e=new ot({props:{layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":n[1]=="bus_stops"?["get","color"]:"black"}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"icon-color":t[1]=="bus_stops"?["get","color"]:"black"}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function gn(n){let e,r;return e=new Ce({props:{data:me(n[2].crossings),$$slots:{default:[il]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].crossings)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function il(n){let e,r;return e=new ot({props:{layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":n[1]=="crossings"?["get","color"]:"black"}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"icon-color":t[1]=="crossings"?["get","color"]:"black"}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function _n(n){let e,r;return e=new Ce({props:{data:me(n[2].jats),$$slots:{default:[sl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].jats)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function sl(n){let e,r;return e=new rt({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":n[1]=="jats"?["get","color"]:"black","circle-radius":20}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":t[1]=="jats"?["get","color"]:"black","circle-radius":20}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function hn(n){let e,r;return e=new Ce({props:{data:me(n[2].side_roads),$$slots:{default:[al]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=me(t[2].side_roads)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function al(n){let e,r;return e=new Fe({props:{paint:{"line-color":n[1]=="side_roads"?["get","color"]:"black","line-width":3}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"line-color":t[1]=="side_roads"?["get","color"]:"black","line-width":3}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function cl(n){let e,r,t,o,l,i,a=n[0]!="links"&&pn(n),s=n[0]!="bus_stops"&&mn(n),u=n[0]!="crossings"&&gn(n),c=n[0]!="jats"&&_n(n),f=n[0]!="side_roads"&&hn(n);return{c(){a&&a.c(),e=L(),s&&s.c(),r=L(),u&&u.c(),t=L(),c&&c.c(),o=L(),f&&f.c(),l=Qe()},m(d,p){a&&a.m(d,p),k(d,e,p),s&&s.m(d,p),k(d,r,p),u&&u.m(d,p),k(d,t,p),c&&c.m(d,p),k(d,o,p),f&&f.m(d,p),k(d,l,p),i=!0},p(d,[p]){d[0]!="links"?a?(a.p(d,p),p&1&&b(a,1)):(a=pn(d),a.c(),b(a,1),a.m(e.parentNode,e)):a&&(ue(),y(a,1,1,()=>{a=null}),fe()),d[0]!="bus_stops"?s?(s.p(d,p),p&1&&b(s,1)):(s=mn(d),s.c(),b(s,1),s.m(r.parentNode,r)):s&&(ue(),y(s,1,1,()=>{s=null}),fe()),d[0]!="crossings"?u?(u.p(d,p),p&1&&b(u,1)):(u=gn(d),u.c(),b(u,1),u.m(t.parentNode,t)):u&&(ue(),y(u,1,1,()=>{u=null}),fe()),d[0]!="jats"?c?(c.p(d,p),p&1&&b(c,1)):(c=_n(d),c.c(),b(c,1),c.m(o.parentNode,o)):c&&(ue(),y(c,1,1,()=>{c=null}),fe()),d[0]!="side_roads"?f?(f.p(d,p),p&1&&b(f,1)):(f=hn(d),f.c(),b(f,1),f.m(l.parentNode,l)):f&&(ue(),y(f,1,1,()=>{f=null}),fe())},i(d){i||(b(a),b(s),b(u),b(c),b(f),i=!0)},o(d){y(a),y(s),y(u),y(c),y(f),i=!1},d(d){d&&(w(e),w(r),w(t),w(o),w(l)),a&&a.d(d),s&&s.d(d),u&&u.d(d),c&&c.d(d),f&&f.d(d)}}}function ul(n,e,r){let t;ne(n,J,i=>r(2,t=i));let{except:o}=e,{showColor:l=""}=e;return n.$$set=i=>{"except"in i&&r(0,o=i.except),"showColor"in i&&r(1,l=i.showColor)},[o,l,t]}class We extends se{constructor(e){super(),ae(this,e,ul,cl,ie,{except:0,showColor:1})}}function bn(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function $n(n){let e,r,t=n[6].properties.name+"",o,l,i,a,s,u;function c(d){n[5](d,n[6])}let f={k:"horiz-radio",choices:Se()};return n[6].properties.st20!==void 0&&(f.value=n[6].properties.st20),i=new Je({props:f}),pe.push(()=>ke(i,"value",c)),{c(){e=$("li"),r=$("span"),o=O(t),l=L(),B(i.$$.fragment),s=L(),Y(r,"color",n[6].properties.color)},m(d,p){k(d,e,p),g(e,r),g(r,o),g(e,l),E(i,e,null),g(e,s),u=!0},p(d,p){n=d,(!u||p&2)&&t!==(t=n[6].properties.name+"")&&le(o,t),p&2&&Y(r,"color",n[6].properties.color);const m={};!a&&p&2&&(a=!0,m.value=n[6].properties.st20,we(()=>a=!1)),i.$set(m)},i(d){u||(b(i.$$.fragment,d),u=!0)},o(d){y(i.$$.fragment,d),u=!1},d(d){d&&w(e),T(i)}}}function fl(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m=x(n[1].bus_stops),A=[];for(let _=0;_<m.length;_+=1)A[_]=$n(bn(n,m,_));const z=_=>y(A[_],1,1,()=>{A[_]=null});return c=new ft({props:{metric:n[2]}}),{c(){e=$("div"),r=$("button"),r.textContent="Done",t=L(),o=$("h2"),o.textContent="ST20: bus stops",l=L(),i=$("p"),i.textContent=`${n[2].description}`,a=L(),s=$("ol");for(let _=0;_<A.length;_+=1)A[_].c();u=L(),B(c.$$.fragment),F(e,"slot","sidebar")},m(_,C){k(_,e,C),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(e,a),g(e,s);for(let j=0;j<A.length;j+=1)A[j]&&A[j].m(s,null);g(e,u),E(c,e,null),f=!0,d||(p=G(r,"click",n[4]),d=!0)},p(_,C){if(C&2){m=x(_[1].bus_stops);let j;for(j=0;j<m.length;j+=1){const h=bn(_,m,j);A[j]?(A[j].p(h,C),b(A[j],1)):(A[j]=$n(h),A[j].c(),b(A[j],1),A[j].m(s,null))}for(ue(),j=m.length;j<A.length;j+=1)z(j);fe()}},i(_){if(!f){for(let C=0;C<m.length;C+=1)b(A[C]);b(c.$$.fragment,_),f=!0}},o(_){A=A.filter(Boolean);for(let C=0;C<A.length;C+=1)y(A[C]);y(c.$$.fragment,_),f=!1},d(_){_&&w(e),ge(A,_),T(c),d=!1,p()}}}function dl(n){let e,r,t;return r=new We({props:{showColor:"bus_stops",except:""}}),{c(){e=$("div"),B(r.$$.fragment),F(e,"slot","map")},m(o,l){k(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&w(e),T(r)}}}function pl(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[dl],sidebar:[fl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=G(window,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l),t=!1,o()}}}function ml(n,e,r){let t,o;ne(n,W,u=>r(0,t=u)),ne(n,J,u=>r(1,o=u));let l=xe.ST20;function i(u){u.key=="Escape"&&K(W,t={kind:"neutral"},t)}const a=()=>K(W,t={kind:"neutral"},t);function s(u,c){n.$$.not_equal(c.properties.st20,u)&&(c.properties.st20=u,J.set(o))}return[t,o,l,i,a,s]}class gl extends se{constructor(e){super(),ae(this,e,ml,pl,ie,{})}}function _l(n){let e,r;const t=n[4].default,o=De(t,n,n[6],null);return{c(){e=$("span"),o&&o.c(),F(e,"class","dot svelte-117v9mi"),Ae(e,"outline",n[3]),Y(e,"background-color",n[3]?void 0:n[1]),Y(e,"border-color",n[3]?n[1]:void 0),Y(e,"width",n[2]),Y(e,"height",n[2])},m(l,i){k(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&64)&&Ne(o,t,l,l[6],r?Oe(t,l[6],i,null):Ie(l[6]),null),(!r||i&8)&&Ae(e,"outline",l[3]),i&10&&Y(e,"background-color",l[3]?void 0:l[1]),i&10&&Y(e,"border-color",l[3]?l[1]:void 0),i&4&&Y(e,"width",l[2]),i&4&&Y(e,"height",l[2])},i(l){r||(b(o,l),r=!0)},o(l){y(o,l),r=!1},d(l){l&&w(e),o&&o.d(l)}}}function hl(n){let e,r,t;function o(i){n[5](i)}let l={draggable:!0,$$slots:{default:[_l]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.lngLat=n[0]),e=new Ye({props:l}),pe.push(()=>ke(e,"lngLat",o)),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,[a]){const s={};a&78&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.lngLat=i[0],we(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){T(e,i)}}}function bl(n,e,r){let{$$slots:t={},$$scope:o}=e,{lngLat:l}=e,{color:i}=e,{radius:a="30px"}=e,{outline:s=!1}=e;function u(c){l=c,r(0,l)}return n.$$set=c=>{"lngLat"in c&&r(0,l=c.lngLat),"color"in c&&r(1,i=c.color),"radius"in c&&r(2,a=c.radius),"outline"in c&&r(3,s=c.outline),"$$scope"in c&&r(6,o=c.$$scope)},[l,i,a,s,t,u,o]}class Vt extends se{constructor(e){super(),ae(this,e,bl,hl,ie,{lngLat:0,color:1,radius:2,outline:3})}}const{window:$l}=ut;function kl(n){let e;return{c(){e=O("ST20: bus stops")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function wl(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m;function A(_){n[8](_)}let z={k:"horiz-radio",choices:Se(),$$slots:{default:[kl]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].properties.st20!==void 0&&(z.value=n[1].bus_stops[n[0]].properties.st20),c=new Je({props:z}),pe.push(()=>ke(c,"value",A)),{c(){e=$("div"),r=$("button"),r.textContent="Done",t=L(),o=$("button"),o.textContent="Delete bus stop",l=L(),i=$("label"),a=O(`Name:
      `),s=$("input"),u=L(),B(c.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(_,C){k(_,e,C),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(i,a),g(i,s),ve(s,n[1].bus_stops[n[0]].properties.name),g(e,u),E(c,e,null),d=!0,p||(m=[G(r,"click",n[6]),G(o,"click",n[4]),G(s,"input",n[7])],p=!0)},p(_,C){C&3&&s.value!==_[1].bus_stops[_[0]].properties.name&&ve(s,_[1].bus_stops[_[0]].properties.name);const j={};C&512&&(j.$$scope={dirty:C,ctx:_}),!f&&C&3&&(f=!0,j.value=_[1].bus_stops[_[0]].properties.st20,we(()=>f=!1)),c.$set(j)},i(_){d||(b(c.$$.fragment,_),d=!0)},o(_){y(c.$$.fragment,_),d=!1},d(_){_&&w(e),T(c),p=!1,je(m)}}}function vl(n){let e,r;return e=new ot({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function yl(n){let e,r;return{c(){e=$("img"),$t(e.src,r=Vr)||F(e,"src",r)},m(t,o){k(t,e,o)},p:ee,d(t){t&&w(e)}}}function Al(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"bus_stops"}}),o=new Ce({props:{data:me(n[1].bus_stops),generateId:!0,$$slots:{default:[vl]},$$scope:{ctx:n}}});function u(f){n[5](f)}let c={color:n[1].bus_stops[n[0]].properties.color,$$slots:{default:[yl]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),i=new Vt({props:c}),pe.push(()=>ke(i,"lngLat",u)),{c(){e=$("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){k(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].bus_stops)),d&513&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};d&3&&(m.color=f[1].bus_stops[f[0]].properties.color),d&512&&(m.$$scope={dirty:d,ctx:f}),!a&&d&3&&(a=!0,m.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,we(()=>a=!1)),i.$set(m)},i(f){s||(b(r.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&w(e),T(r),T(o),T(i)}}}function Cl(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Al],sidebar:[wl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=G($l,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l),t=!1,o()}}}function jl(n,e,r){let t,o;ne(n,J,d=>r(1,t=d)),ne(n,W,d=>r(2,o=d));let{idx:l}=e;function i(d){d.key=="Escape"&&K(W,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this bus stop?")&&(K(W,o={kind:"neutral"},o),await nt(),t.bus_stops.splice(l,1),J.set(t))}function s(d){n.$$.not_equal(t.bus_stops[l].geometry.coordinates,d)&&(t.bus_stops[l].geometry.coordinates=d,J.set(t))}const u=()=>K(W,o={kind:"neutral"},o);function c(){t.bus_stops[l].properties.name=this.value,J.set(t)}function f(d){n.$$.not_equal(t.bus_stops[l].properties.st20,d)&&(t.bus_stops[l].properties.st20=d,J.set(t))}return n.$$set=d=>{"idx"in d&&r(0,l=d.idx)},[l,t,o,i,a,s,u,c,f]}class Sl extends se{constructor(e){super(),ae(this,e,jl,Cl,ie,{idx:0})}}function kn(n,e,r){const t=n.slice();return t[1]=e[r][0],t[2]=e[r][1],t}function wn(n){let e,r,t,o=n[1]+"",l,i;return{c(){e=$("li"),r=$("span"),t=L(),l=O(o),i=L(),F(r,"class","svelte-kzgqtg"),Y(r,"background",n[2])},m(a,s){k(a,e,s),g(e,r),g(e,t),g(e,l),g(e,i)},p(a,s){s&1&&Y(r,"background",a[2]),s&1&&o!==(o=a[1]+"")&&le(l,o)},d(a){a&&w(e)}}}function zl(n){let e,r=x(n[0]),t=[];for(let o=0;o<r.length;o+=1)t[o]=wn(kn(n,r,o));return{c(){e=$("ul");for(let o=0;o<t.length;o+=1)t[o].c()},m(o,l){k(o,e,l);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(o,[l]){if(l&1){r=x(o[0]);let i;for(i=0;i<r.length;i+=1){const a=kn(o,r,i);t[i]?t[i].p(a,l):(t[i]=wn(a),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=r.length}},i:ee,o:ee,d(o){o&&w(e),ge(t,o)}}}function Ll(n,e,r){let{rows:t}=e;return n.$$set=o=>{"rows"in o&&r(0,t=o.rows)},[t]}class Ml extends se{constructor(e){super(),ae(this,e,Ll,zl,ie,{rows:0})}}const Bl=n=>({dialog:n&1}),vn=n=>({dialog:n[0]});function El(n){let e,r,t,o,l;const i=n[4].default,a=De(i,n,n[3],vn);return{c(){e=$("dialog"),r=$("article"),a&&a.c(),e.open=!0},m(s,u){k(s,e,u),g(e,r),a&&a.m(r,null),n[6](e),t=!0,o||(l=[G(window,"click",n[1]),G(window,"keydown",n[2]),G(e,"close",n[5])],o=!0)},p(s,[u]){a&&a.p&&(!t||u&9)&&Ne(a,i,s,s[3],t?Oe(i,s[3],u,Bl):Ie(s[3]),vn)},i(s){t||(b(a,s),t=!0)},o(s){y(a,s),t=!1},d(s){s&&w(e),a&&a.d(s),n[6](null),o=!1,je(l)}}}function Tl(n,e,r){let{$$slots:t={},$$scope:o}=e,l;function i(c){l.open&&c.target==l&&l.close()}function a(c){(c.key=="Escape"||c.key=="Enter")&&(c.stopPropagation(),l.close())}function s(c){ze.call(this,n,c)}function u(c){pe[c?"unshift":"push"](()=>{l=c,r(0,l)})}return n.$$set=c=>{"$$scope"in c&&r(3,o=c.$$scope)},[l,i,a,o,t,s,u]}class Pt extends se{constructor(e){super(),ae(this,e,Tl,El,ie,{})}}function yn(n,e,r){const t=n.slice();return t[3]=e[r],t}function An(n,e,r){const t=n.slice();return t[6]=e[r],t}function Cn(n){let e,r;return{c(){e=$("span"),r=O(` 
    `),Y(e,"background",n[6]),Y(e,"width","100%"),Y(e,"border","1px solid black")},m(t,o){k(t,e,o),g(e,r)},p(t,o){o&1&&Y(e,"background",t[6])},d(t){t&&w(e)}}}function Dl(n){let e,r=n[3]+"",t;return{c(){e=$("span"),t=O(r)},m(o,l){k(o,e,l),g(e,t)},p(o,l){l&2&&r!==(r=o[3]+"")&&le(t,r)},d(o){o&&w(e)}}}function Nl(n){let e,r=n[3].toFixed(n[2])+"",t;return{c(){e=$("span"),t=O(r)},m(o,l){k(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[3].toFixed(o[2])+"")&&le(t,r)},d(o){o&&w(e)}}}function jn(n){let e;function r(l,i){return l[2]>0?Nl:Dl}let t=r(n),o=t(n);return{c(){o.c(),e=Qe()},m(l,i){o.m(l,i),k(l,e,i)},p(l,i){t===(t=r(l))&&o?o.p(l,i):(o.d(1),o=t(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&w(e),o.d(l)}}}function Il(n){let e,r,t,o=x(n[0]),l=[];for(let s=0;s<o.length;s+=1)l[s]=Cn(An(n,o,s));let i=x(n[1]),a=[];for(let s=0;s<i.length;s+=1)a[s]=jn(yn(n,i,s));return{c(){e=$("div");for(let s=0;s<l.length;s+=1)l[s].c();r=L(),t=$("div");for(let s=0;s<a.length;s+=1)a[s].c();Y(e,"display","flex"),Y(t,"display","flex"),Y(t,"justify-content","space-between")},m(s,u){k(s,e,u);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(e,null);k(s,r,u),k(s,t,u);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(t,null)},p(s,[u]){if(u&1){o=x(s[0]);let c;for(c=0;c<o.length;c+=1){const f=An(s,o,c);l[c]?l[c].p(f,u):(l[c]=Cn(f),l[c].c(),l[c].m(e,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=o.length}if(u&6){i=x(s[1]);let c;for(c=0;c<i.length;c+=1){const f=yn(s,i,c);a[c]?a[c].p(f,u):(a[c]=jn(f),a[c].c(),a[c].m(t,null))}for(;c<a.length;c+=1)a[c].d(1);a.length=i.length}},i:ee,o:ee,d(s){s&&(w(e),w(r),w(t)),ge(l,s),ge(a,s)}}}function Ol(n,e,r){let{colorScale:t}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return n.$$set=i=>{"colorScale"in i&&r(0,t=i.colorScale),"limits"in i&&r(1,o=i.limits),"decimalPlaces"in i&&r(2,l=i.decimalPlaces)},[t,o,l]}class Fl extends se{constructor(e){super(),ae(this,e,Ol,Il,ie,{colorScale:0,limits:1,decimalPlaces:2})}}function ql(n,e){let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function Pl(n){let e;return{c(){e=O("Bus stops")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Sn(n){let e,r,t,o,l;return o=new Fl({props:{colorScale:n[1],limits:n[2]}}),{c(){e=$("div"),r=$("p"),r.textContent="Peak hourly frequency:",t=L(),B(o.$$.fragment),F(e,"class","svelte-yxmabo")},m(i,a){k(i,e,a),g(e,r),g(e,t),E(o,e,null),l=!0},p:ee,i(i){l||(b(o.$$.fragment,i),l=!0)},o(i){y(o.$$.fragment,i),l=!1},d(i){i&&w(e),T(o)}}}function Ul(n){let e,r,t,o=n[4].stop_name+"",l,i,a,s,u,c=n[4].peak+"",f,d,p,m,A,z=n[4].peak_description+"",_,C,j,h,S,v=n[4].total+"",M,I,q=n[4].total_description+"",Z,V;return{c(){e=$("p"),r=O("Stop name: "),t=$("b"),l=O(o),i=L(),a=$("p"),s=O("Peak: "),u=$("b"),f=O(c),d=O(`
        buses during the busiest hour of any day`),p=L(),m=$("p"),A=O("The peak hour is "),_=O(z),C=L(),j=$("p"),h=O("Total buses per day: "),S=$("b"),M=O(v),I=O(`
        (for `),Z=O(q),V=O(", the busiest day of the week)")},m(D,Q){k(D,e,Q),g(e,r),g(e,t),g(t,l),k(D,i,Q),k(D,a,Q),g(a,s),g(a,u),g(u,f),g(a,d),k(D,p,Q),k(D,m,Q),g(m,A),g(m,_),k(D,C,Q),k(D,j,Q),g(j,h),g(j,S),g(S,M),g(j,I),g(j,Z),g(j,V)},p(D,Q){Q&16&&o!==(o=D[4].stop_name+"")&&le(l,o),Q&16&&c!==(c=D[4].peak+"")&&le(f,c),Q&16&&z!==(z=D[4].peak_description+"")&&le(_,z),Q&16&&v!==(v=D[4].total+"")&&le(M,v),Q&16&&q!==(q=D[4].total_description+"")&&le(Z,q)},d(D){D&&(w(e),w(i),w(a),w(p),w(m),w(C),w(j))}}}function Rl(n){let e,r;return e=new vt({props:{$$slots:{default:[Ul,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&48&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Gl(n){let e,r;return e=new rt({props:{sourceLayer:"bus_stops",paint:{"circle-color":Ao(["get","peak"],n[2],n[1]),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},manageHoverState:!0,$$slots:{default:[Rl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),o&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Jl(n){let e,r,t,o,l;e=new Zr({props:{$$slots:{default:[Pl]},$$scope:{ctx:n}}}),e.$on("click",n[3]);let i=n[0]&&Sn(n);return o=new Xr({props:{url:"pmtiles://https://atip.uk/layers/v1/bus_stops.pmtiles",$$slots:{default:[Gl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=L(),i&&i.c(),t=L(),B(o.$$.fragment)},m(a,s){E(e,a,s),k(a,r,s),i&&i.m(a,s),k(a,t,s),E(o,a,s),l=!0},p(a,[s]){const u={};s&32&&(u.$$scope={dirty:s,ctx:a}),e.$set(u),a[0]?i?(i.p(a,s),s&1&&b(i,1)):(i=Sn(a),i.c(),b(i,1),i.m(t.parentNode,t)):i&&(ue(),y(i,1,1,()=>{i=null}),fe());const c={};s&33&&(c.$$scope={dirty:s,ctx:a}),o.$set(c)},i(a){l||(b(e.$$.fragment,a),b(i),b(o.$$.fragment,a),l=!0)},o(a){y(e.$$.fragment,a),y(i),y(o.$$.fragment,a),l=!1},d(a){a&&(w(r),w(t)),T(e,a),i&&i.d(a),T(o,a)}}}function Ql(n,e,r){let t=!1;return[t,["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],[0,3,10,20,30,100],()=>r(0,t=!t)]}class Hl extends se{constructor(e){super(),ae(this,e,Ql,Jl,ie,{})}}function Kl(n){let e;return{c(){e=O("Crossings")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function zn(n){let e,r,t;return r=new Ml({props:{rows:n[1]}}),{c(){e=$("div"),B(r.$$.fragment),F(e,"class","svelte-yxmabo")},m(o,l){k(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&w(e),T(r)}}}function Wl(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=$("p"),t=O(r),o=O(" crossing")},m(l,i){k(l,e,i),g(e,t),g(e,o)},p(l,i){i&8&&r!==(r=(l[3].class||"Unknown")+"")&&le(t,r)},d(l){l&&w(e)}}}function Zl(n){let e,r;return e=new vt({props:{$$slots:{default:[Wl,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Xl(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=$("p"),t=O(r),o=O(" crossing")},m(l,i){k(l,e,i),g(e,t),g(e,o)},p(l,i){i&8&&r!==(r=(l[3].class||"Unknown")+"")&&le(t,r)},d(l){l&&w(e)}}}function Vl(n){let e,r;return e=new vt({props:{$$slots:{default:[Xl,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Yl(n){let e,r,t,o;return e=new Fe({props:{sourceLayer:"crossings",filter:Co,paint:{"line-color":nn(["get","class"],Object.fromEntries(n[1]),"red"),"line-width":3},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[Zl]},$$scope:{ctx:n}}}),e.$on("click",Ln),t=new rt({props:{sourceLayer:"crossings",filter:jo,paint:{"circle-color":nn(["get","class"],Object.fromEntries(n[1]),"red"),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[Vl]},$$scope:{ctx:n}}}),t.$on("click",Ln),{c(){B(e.$$.fragment),r=L(),B(t.$$.fragment)},m(l,i){E(e,l,i),k(l,r,i),E(t,l,i),o=!0},p(l,i){const a={};i&1&&(a.layout={visibility:l[0]?"visible":"none"}),i&16&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&1&&(s.layout={visibility:l[0]?"visible":"none"}),i&16&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&w(r),T(e,l),T(t,l)}}}function xl(n){let e,r,t,o,l;e=new Zr({props:{$$slots:{default:[Kl]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let i=n[0]&&zn(n);return o=new Xr({props:{url:"pmtiles://https://atip.uk/layers/v1/crossings.pmtiles",$$slots:{default:[Yl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=L(),i&&i.c(),t=L(),B(o.$$.fragment)},m(a,s){E(e,a,s),k(a,r,s),i&&i.m(a,s),k(a,t,s),E(o,a,s),l=!0},p(a,[s]){const u={};s&16&&(u.$$scope={dirty:s,ctx:a}),e.$set(u),a[0]?i?(i.p(a,s),s&1&&b(i,1)):(i=zn(a),i.c(),b(i,1),i.m(t.parentNode,t)):i&&(ue(),y(i,1,1,()=>{i=null}),fe());const c={};s&17&&(c.$$scope={dirty:s,ctx:a}),o.$set(c)},i(a){l||(b(e.$$.fragment,a),b(i),b(o.$$.fragment,a),l=!0)},o(a){y(e.$$.fragment,a),y(i),y(o.$$.fragment,a),l=!1},d(a){a&&(w(r),w(t)),T(e,a),i&&i.d(a),T(o,a)}}}function Ln(n){window.open(`https://www.openstreetmap.org/${n.detail.features[0].properties.osm}`,"_blank")}function ei(n,e,r){let t=!1;return[t,[["Zebra","#66C5CC"],["Parallel","#F6CF71"],["Pelican","#F89C74"],["Puffin","#DCB0F2"],["Toucan","#87C55F"],["Pegasus","#9EB9F3"],["Uncontrolled","#FE88B1"],["Signalised","#C9DB74"],["Unknown","red"]],()=>r(0,t=!t)]}class ti extends se{constructor(e){super(),ae(this,e,ei,xl,ie,{})}}function ni(n){let e,r,t,o,l;return r=new Hl({}),o=new ti({}),{c(){e=$("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),Y(e,"display","flex"),Y(e,"flex-direction","column")},m(i,a){k(i,e,a),E(r,e,null),g(e,t),E(o,e,null),l=!0},p:ee,i(i){l||(b(r.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){y(r.$$.fragment,i),y(o.$$.fragment,i),l=!1},d(i){i&&w(e),T(r),T(o)}}}function ri(n){let e,r;return e=new Fo({props:{$$slots:{default:[ni]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,[o]){const l={};o&1&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}class oi extends se{constructor(e){super(),ae(this,e,null,ri,ie,{})}}const{window:li}=ut;function ii(n){let e;return{c(){e=O("SA10: pedestrian crossing speed")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function si(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,A,z,_,C;function j(S){n[9](S)}let h={k:"horiz-radio",choices:Se(),$$slots:{default:[ii]},$$scope:{ctx:n}};return n[1].crossings[n[0]].properties.sa10!==void 0&&(h.value=n[1].crossings[n[0]].properties.sa10),c=new Je({props:h}),pe.push(()=>ke(c,"value",j)),A=new ft({props:{metric:n[3]}}),{c(){e=$("div"),r=$("button"),r.textContent="Done",t=L(),o=$("button"),o.textContent="Delete crossing",l=L(),i=$("label"),a=O(`Name:
      `),s=$("input"),u=L(),B(c.$$.fragment),d=L(),p=$("p"),p.textContent=`${n[3].description}`,m=L(),B(A.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(S,v){k(S,e,v),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(i,a),g(i,s),ve(s,n[1].crossings[n[0]].properties.name),g(e,u),E(c,e,null),g(e,d),g(e,p),g(e,m),E(A,e,null),z=!0,_||(C=[G(r,"click",n[7]),G(o,"click",n[5]),G(s,"input",n[8])],_=!0)},p(S,v){v&3&&s.value!==S[1].crossings[S[0]].properties.name&&ve(s,S[1].crossings[S[0]].properties.name);const M={};v&1024&&(M.$$scope={dirty:v,ctx:S}),!f&&v&3&&(f=!0,M.value=S[1].crossings[S[0]].properties.sa10,we(()=>f=!1)),c.$set(M)},i(S){z||(b(c.$$.fragment,S),b(A.$$.fragment,S),z=!0)},o(S){y(c.$$.fragment,S),y(A.$$.fragment,S),z=!1},d(S){S&&w(e),T(c),T(A),_=!1,je(C)}}}function ai(n){let e,r;return e=new ot({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":"black"}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function ci(n){let e,r;return{c(){e=$("img"),$t(e.src,r=Yr)||F(e,"src",r)},m(t,o){k(t,e,o)},p:ee,d(t){t&&w(e)}}}function ui(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"crossings"}}),o=new Ce({props:{data:me(n[1].crossings),generateId:!0,$$slots:{default:[ai]},$$scope:{ctx:n}}});function u(f){n[6](f)}let c={color:n[1].crossings[n[0]].properties.color,$$slots:{default:[ci]},$$scope:{ctx:n}};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].crossings[n[0]].geometry.coordinates),i=new Vt({props:c}),pe.push(()=>ke(i,"lngLat",u)),{c(){e=$("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){k(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].crossings)),d&1025&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};d&3&&(m.color=f[1].crossings[f[0]].properties.color),d&1024&&(m.$$scope={dirty:d,ctx:f}),!a&&d&3&&(a=!0,m.lngLat=f[1].crossings[f[0]].geometry.coordinates,we(()=>a=!1)),i.$set(m)},i(f){s||(b(r.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&w(e),T(r),T(o),T(i)}}}function fi(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[ui],sidebar:[si]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=G(li,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l),t=!1,o()}}}function di(n,e,r){let t,o;ne(n,J,p=>r(1,t=p)),ne(n,W,p=>r(2,o=p));let{idx:l}=e,i=xe.SA10;function a(p){p.key=="Escape"&&K(W,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this crossing?")&&(K(W,o={kind:"neutral"},o),await nt(),t.crossings.splice(l,1),J.set(t))}function u(p){n.$$.not_equal(t.crossings[l].geometry.coordinates,p)&&(t.crossings[l].geometry.coordinates=p,J.set(t))}const c=()=>K(W,o={kind:"neutral"},o);function f(){t.crossings[l].properties.name=this.value,J.set(t)}function d(p){n.$$.not_equal(t.crossings[l].properties.sa10,p)&&(t.crossings[l].properties.sa10=p,J.set(t))}return n.$$set=p=>{"idx"in p&&r(0,l=p.idx)},[l,t,o,i,a,s,u,c,f,d]}class pi extends se{constructor(e){super(),ae(this,e,di,fi,ie,{idx:0})}}let H;const eo=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&eo.decode();let mt=null;function ht(){return(mt===null||mt.byteLength===0)&&(mt=new Uint8Array(H.memory.buffer)),mt}function Te(n,e){return n=n>>>0,eo.decode(ht().subarray(n,n+e))}const Ze=new Array(128).fill(void 0);Ze.push(void 0,null,!0,!1);let bt=Ze.length;function ye(n){bt===Ze.length&&Ze.push(Ze.length+1);const e=bt;return bt=Ze[e],Ze[e]=n,e}function ce(n){return Ze[n]}function mi(n){n<132||(Ze[n]=bt,bt=n)}function st(n){const e=ce(n);return mi(n),e}function Gt(n){return n==null}let gt=null;function gi(){return(gt===null||gt.byteLength===0)&&(gt=new Float64Array(H.memory.buffer)),gt}let _t=null;function de(){return(_t===null||_t.byteLength===0)&&(_t=new Int32Array(H.memory.buffer)),_t}let Xe=0;const Dt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},_i=typeof Dt.encodeInto=="function"?function(n,e){return Dt.encodeInto(n,e)}:function(n,e){const r=Dt.encode(n);return e.set(r),{read:n.length,written:r.length}};function Mt(n,e,r){if(r===void 0){const a=Dt.encode(n),s=e(a.length,1)>>>0;return ht().subarray(s,s+a.length).set(a),Xe=a.length,s}let t=n.length,o=e(t,1)>>>0;const l=ht();let i=0;for(;i<t;i++){const a=n.charCodeAt(i);if(a>127)break;l[o+i]=a}if(i!==t){i!==0&&(n=n.slice(i)),o=r(o,t,t=i+n.length*3,1)>>>0;const a=ht().subarray(o+i,o+t),s=_i(n,a);i+=s.written}return Xe=i,o}function Xt(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let l="[";o>0&&(l+=Xt(n[0]));for(let i=1;i<o;i++)l+=", "+Xt(n[i]);return l+="]",l}const r=/\[object ([^\]]+)\]/.exec(toString.call(n));let t;if(r.length>1)t=r[1];else return toString.call(n);if(t=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:t}function hi(n,e){const r=e(n.length*1,1)>>>0;return ht().set(n,r/1),Xe=n.length,r}function Jt(n,e){try{return n.apply(this,e)}catch(r){H.__wbindgen_exn_store(ye(r))}}class It{static __wrap(e){e=e>>>0;const r=Object.create(It.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();H.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=H.__wbindgen_add_to_stack_pointer(-16),i=hi(e,H.__wbindgen_malloc),a=Xe;H.jsroutesnapper_new(l,i,a);var r=de()[l/4+0],t=de()[l/4+1],o=de()[l/4+2];if(o)throw st(t);return It.__wrap(r)}finally{H.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){H.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ye(e))}setAreaMode(){H.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,r;try{const l=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_getConfig(l,this.__wbg_ptr);var t=de()[l/4+0],o=de()[l/4+1];return e=t,r=o,Te(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}toFinalFeature(){try{const t=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=de()[t/4+0],r=de()[t/4+1];let o;return e!==0&&(o=Te(e,r).slice(),H.__wbindgen_free(e,r*1)),o}finally{H.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,r;try{const l=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var t=de()[l/4+0],o=de()[l/4+1];return e=t,r=o,Te(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}toggleSnapMode(){H.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,r,t){return H.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,r,t)!==0}onClick(){H.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return H.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return H.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){H.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_editExisting(o,this.__wbg_ptr,ye(e));var r=de()[o/4+0],t=de()[o/4+1];if(t)throw st(r)}finally{H.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,r;try{const l=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var t=de()[l/4+0],o=de()[l/4+1];return e=t,r=o,Te(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}debugSnappableNodes(){let e,r;try{const l=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var t=de()[l/4+0],o=de()[l/4+1];return e=t,r=o,Te(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}routeNameForWaypoints(e){let r,t;try{const c=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_routeNameForWaypoints(c,this.__wbg_ptr,ye(e));var o=de()[c/4+0],l=de()[c/4+1],i=de()[c/4+2],a=de()[c/4+3],s=o,u=l;if(a)throw s=0,u=0,st(i);return r=s,t=u,Te(s,u)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(r,t,1)}}addSnappedWaypoint(e,r){H.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,r)}undo(){H.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let r,t;try{const c=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_calculateRoute(c,this.__wbg_ptr,ye(e));var o=de()[c/4+0],l=de()[c/4+1],i=de()[c/4+2],a=de()[c/4+3],s=o,u=l;if(a)throw s=0,u=0,st(i);return r=s,t=u,Te(s,u)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(r,t,1)}}getExtraNodes(e,r){let t,o;try{const f=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_getExtraNodes(f,this.__wbg_ptr,ye(e),ye(r));var l=de()[f/4+0],i=de()[f/4+1],a=de()[f/4+2],s=de()[f/4+3],u=l,c=i;if(s)throw u=0,c=0,st(a);return t=u,o=c,Te(u,c)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(t,o,1)}}}async function bi(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(t){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function $i(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,r){const t=Te(e,r);return ye(t)},n.wbg.__wbindgen_object_drop_ref=function(e){st(e)},n.wbg.__wbindgen_error_new=function(e,r){const t=new Error(Te(e,r));return ye(t)},n.wbg.__wbindgen_number_get=function(e,r){const t=ce(r),o=typeof t=="number"?t:void 0;gi()[e/8+1]=Gt(o)?0:o,de()[e/4+0]=!Gt(o)},n.wbg.__wbindgen_is_object=function(e){const r=ce(e);return typeof r=="object"&&r!==null},n.wbg.__wbindgen_is_undefined=function(e){return ce(e)===void 0},n.wbg.__wbindgen_in=function(e,r){return ce(e)in ce(r)},n.wbg.__wbindgen_boolean_get=function(e){const r=ce(e);return typeof r=="boolean"?r?1:0:2},n.wbg.__wbindgen_jsval_loose_eq=function(e,r){return ce(e)==ce(r)},n.wbg.__wbindgen_string_get=function(e,r){const t=ce(r),o=typeof t=="string"?t:void 0;var l=Gt(o)?0:Mt(o,H.__wbindgen_malloc,H.__wbindgen_realloc),i=Xe;de()[e/4+1]=i,de()[e/4+0]=l},n.wbg.__wbg_String_4370c5505c674d30=function(e,r){const t=String(ce(r)),o=Mt(t,H.__wbindgen_malloc,H.__wbindgen_realloc),l=Xe;de()[e/4+1]=l,de()[e/4+0]=o},n.wbg.__wbindgen_object_clone_ref=function(e){const r=ce(e);return ye(r)},n.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,r){const t=ce(e)[ce(r)];return ye(t)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ye(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,r){const t=ce(r).stack,o=Mt(t,H.__wbindgen_malloc,H.__wbindgen_realloc),l=Xe;de()[e/4+1]=l,de()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,r){let t,o;try{t=e,o=r,console.error(Te(e,r))}finally{H.__wbindgen_free(t,o,1)}},n.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(ce(e))},n.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(ce(e))},n.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(ce(e))},n.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(ce(e))},n.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(ce(e))},n.wbg.__wbg_get_44be0491f933a435=function(e,r){const t=ce(e)[r>>>0];return ye(t)},n.wbg.__wbg_length_fff51ee6522a1a18=function(e){return ce(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof ce(e)=="function"},n.wbg.__wbg_next_526fc47e980da008=function(e){const r=ce(e).next;return ye(r)},n.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Jt(function(e){const r=ce(e).next();return ye(r)},arguments)},n.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return ce(e).done},n.wbg.__wbg_value_1695675138684bd5=function(e){const r=ce(e).value;return ye(r)},n.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ye(Symbol.iterator)},n.wbg.__wbg_get_97b561fb56f034b5=function(){return Jt(function(e,r){const t=Reflect.get(ce(e),ce(r));return ye(t)},arguments)},n.wbg.__wbg_call_cb65541d95d71282=function(){return Jt(function(e,r){const t=ce(e).call(ce(r));return ye(t)},arguments)},n.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(ce(e))},n.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let r;try{r=ce(e)instanceof ArrayBuffer}catch{r=!1}return r},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const r=ce(e).buffer;return ye(r)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const r=new Uint8Array(ce(e));return ye(r)},n.wbg.__wbg_set_5cf90238115182c3=function(e,r,t){ce(e).set(ce(r),t>>>0)},n.wbg.__wbg_length_72e2208bbc0efc61=function(e){return ce(e).length},n.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let r;try{r=ce(e)instanceof Uint8Array}catch{r=!1}return r},n.wbg.__wbindgen_debug_string=function(e,r){const t=Xt(ce(r)),o=Mt(t,H.__wbindgen_malloc,H.__wbindgen_realloc),l=Xe;de()[e/4+1]=l,de()[e/4+0]=o},n.wbg.__wbindgen_throw=function(e,r){throw new Error(Te(e,r))},n.wbg.__wbindgen_memory=function(){const e=H.memory;return ye(e)},n}function ki(n,e){return H=n.exports,to.__wbindgen_wasm_module=e,gt=null,_t=null,mt=null,H}async function to(n){if(H!==void 0)return H;typeof n>"u"&&(n="/route-element/assets/route_snapper_bg.wasm");const e=$i();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:t}=await bi(await n,e);return ki(r,t)}const wi=30;class vi{constructor(e,r,t,o,l){this.onMouseMove=i=>{if(!this.active)return;const a=[i.point.x-wi,i.point.y],s=this.map.unproject(i.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,s)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new It(r),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersSuccess)r(JSON.parse(e));else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersUpdated)r(JSON.parse(e))}}function no(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:qe[n%qe.length],answers:Array(Le.length).fill("")}}}let Le=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:Se()},{name:"SA04",description:"trip hazards",choices:Se()},{name:"SA05",description:"kerbside activity",choices:Se()},{name:"SA08",description:"motor traffic speed",choices:Se()},{name:"SA09",description:"motor traffic volume",choices:Se()},{name:"SA11",description:"footway widths",choices:Se()},{name:"SA12",description:"effective width next to tram lines",choices:Se()},{name:"SA13",description:"crossing angle of tram/train rails",choices:Se()},{name:"SA14",description:"cycling surface and maintenance defects",choices:Se()},{name:"SA15",description:"WW surface and maintenance defects",choices:Se()},{name:"SA16",description:"guard railing",choices:Se()}],Yt=Ke(null);const Ge=Ke([]);async function yi(n){await zo(),await to();let e="https://assets.od2net.org/route-element",r=n.getBounds();try{let t=await Lo(e,r.getEast(),r.getNorth(),r.getWest(),r.getSouth());Yt.set(new vi(n,t,Ke(Tt()),Ke(!0),Ke(0))),W.set({kind:"draw-route"})}catch(t){window.alert(t)}}function Ai(){try{let n=JSON.parse(Lt(Yt).inner.calculateRoute(Lt(Ge)));if(!n){window.alert("No route drawn");return}Ci(n.properties.full_path);let e=no(Lt(J).links.length);e.geometry=n.geometry,e.properties.name=n.properties.route_name,J.update(r=>(r.links.push(e),r)),W.set({kind:"edit-link",idx:Lt(J).links.length-1})}catch(n){window.alert(`Bug: ${n}`)}Ge.set([]),W.set({kind:"neutral"})}function Ci(n){J.update(e=>{for(let r of JSON.parse(So(n)).features)r.properties={name:"Untitled side road",sa01:"",color:qe[e.side_roads.length%qe.length]},e.side_roads.push(r);return e})}function Mn(n,e,r){const t=n.slice();return t[46]=e[r],t[47]=e,t[48]=r,t}function Bn(n,e,r){const t=n.slice();return t[49]=e[r],t[50]=e,t[51]=r,t}function ji(n){let e;return{c(){e=$("h2"),e.textContent="Drawing a new route"},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Si(n){let e;return{c(){e=$("h2"),e.textContent="Editing a route"},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function zi(n){let e,r=n[10].length+"",t,o;return{c(){e=O("Undo ("),t=O(r),o=O(")")},m(l,i){k(l,e,i),k(l,t,i),k(l,o,i)},p(l,i){i[0]&1024&&r!==(r=l[10].length+"")&&le(t,r)},d(l){l&&(w(e),w(t),w(o))}}}function Li(n){let e;return{c(){e=O("Undo")},m(r,t){k(r,e,t)},p:ee,d(r){r&&w(e)}}}function Mi(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,A,z,_,C,j,h,S,v,M,I,q,Z,V,D,Q,N,_e,he,P,X,$e,be,U,re,oe,Ue,dt,yt;function At(R,te){return R[2]?Si:ji}let lt=At(n),He=lt(n);function Ct(R,te){return R[10].length==0?Li:zi}let it=Ct(n),Ee=it(n);return oe=Ht(n[37][0]),Ue=Ht(n[37][1]),{c(){e=$("div"),He.c(),r=L(),t=$("button"),o=O("Finish"),i=L(),a=$("button"),Ee.c(),u=L(),c=$("button"),c.textContent="Cancel",f=L(),d=$("fieldset"),p=$("label"),m=$("input"),A=O(`
        Snap to roads`),z=L(),_=$("label"),C=$("input"),j=O(`
        Draw anywhere`),h=L(),S=$("fieldset"),v=$("label"),M=$("input"),I=O(`
        Extend from start (
        `),q=$("b"),q.textContent="1",Z=O(`
        )`),V=L(),D=$("label"),Q=$("input"),N=O(`
        Extend from end (
        `),_e=$("b"),_e.textContent="2",he=O(`
        )`),P=L(),X=$("label"),$e=$("input"),be=O(`
        Adjust middle points (
        `),U=$("b"),U.textContent="3",re=O(`
        )`),t.disabled=l=n[7].length<2,F(a,"class","secondary"),a.disabled=s=n[10].length==0,F(c,"class","secondary"),F(m,"type","radio"),m.__value="snap",ve(m,m.__value),F(C,"type","radio"),C.__value="free",ve(C,C.__value),F(M,"type","radio"),M.__value="append-start",ve(M,M.__value),F(Q,"type","radio"),Q.__value="append-end",ve(Q,Q.__value),F($e,"type","radio"),$e.__value="adjust",ve($e,$e.__value),F(e,"slot","sidebar"),oe.p(M,Q,$e),Ue.p(m,C)},m(R,te){k(R,e,te),He.m(e,null),g(e,r),g(e,t),g(t,o),g(e,i),g(e,a),Ee.m(a,null),g(e,u),g(e,c),g(e,f),g(e,d),g(d,p),g(p,m),m.checked=m.__value===n[9],g(p,A),g(d,z),g(d,_),g(_,C),C.checked=C.__value===n[9],g(_,j),g(e,h),g(e,S),g(S,v),g(v,M),M.checked=M.__value===n[3],g(v,I),g(v,q),g(v,Z),g(S,V),g(S,D),g(D,Q),Q.checked=Q.__value===n[3],g(D,N),g(D,_e),g(D,he),g(S,P),g(S,X),g(X,$e),$e.checked=$e.__value===n[3],g(X,be),g(X,U),g(X,re),dt||(yt=[G(t,"click",function(){Kt(n[0])&&n[0].apply(this,arguments)}),G(a,"click",n[13]),G(c,"click",function(){Kt(n[1])&&n[1].apply(this,arguments)}),G(m,"change",n[36]),G(m,"change",n[14]),G(C,"change",n[38]),G(C,"change",n[14]),G(M,"change",n[39]),G(Q,"change",n[40]),G($e,"change",n[41])],dt=!0)},p(R,te){n=R,lt!==(lt=At(n))&&(He.d(1),He=lt(n),He&&(He.c(),He.m(e,r))),te[0]&128&&l!==(l=n[7].length<2)&&(t.disabled=l),it===(it=Ct(n))&&Ee?Ee.p(n,te):(Ee.d(1),Ee=it(n),Ee&&(Ee.c(),Ee.m(a,null))),te[0]&1024&&s!==(s=n[10].length==0)&&(a.disabled=s),te[0]&512&&(m.checked=m.__value===n[9]),te[0]&512&&(C.checked=C.__value===n[9]),te[0]&8&&(M.checked=M.__value===n[3]),te[0]&8&&(Q.checked=Q.__value===n[3]),te[0]&8&&($e.checked=$e.__value===n[3])},d(R){R&&w(e),He.d(),Ee.d(),oe.r(),Ue.r(),dt=!1,je(yt)}}}function Bi(n){let e;return{c(){e=$("span"),F(e,"class","dot svelte-1cj4rwq"),Ae(e,"snapped-node",n[49].snapped),Ae(e,"free-node",!n[49].snapped),Ae(e,"hide",n[6])},m(r,t){k(r,e,t)},p(r,t){t[0]&2048&&Ae(e,"snapped-node",r[49].snapped),t[0]&2048&&Ae(e,"free-node",!r[49].snapped),t[0]&64&&Ae(e,"hide",r[6])},d(r){r&&w(e)}}}function En(n){let e,r,t;function o(s){n[27](s,n[49])}function l(){return n[28](n[49])}function i(){return n[29](n[49])}let a={draggable:!0,zIndex:0,$$slots:{default:[Bi]},$$scope:{ctx:n}};return n[49].point!==void 0&&(a.lngLat=n[49].point),e=new Ye({props:a}),pe.push(()=>ke(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",n[22]),{c(){B(e.$$.fragment)},m(s,u){E(e,s,u),t=!0},p(s,u){n=s;const c={};u[0]&2112|u[1]&2097152&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&2048&&(r=!0,c.lngLat=n[49].point,we(()=>r=!1)),e.$set(c)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){T(e,s)}}}function Ei(n){let e;return{c(){e=$("span"),e.textContent=`${n[48]+1}`,F(e,"class","dot svelte-1cj4rwq"),Ae(e,"snapped",n[46].snapped)},m(r,t){k(r,e,t)},p(r,t){t[0]&128&&Ae(e,"snapped",r[46].snapped)},d(r){r&&w(e)}}}function Tn(n){let e,r,t;function o(s){n[30](s,n[46])}function l(){return n[31](n[48])}function i(){return n[32](n[48])}let a={draggable:!0,zIndex:1,$$slots:{default:[Ei]},$$scope:{ctx:n}};return n[46].point!==void 0&&(a.lngLat=n[46].point),e=new Ye({props:a}),pe.push(()=>ke(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",n[33]),e.$on("mouseleave",n[34]),e.$on("dragstart",n[24]),e.$on("dragend",n[35]),{c(){B(e.$$.fragment)},m(s,u){E(e,s,u),t=!0},p(s,u){n=s;const c={};u[0]&128|u[1]&2097152&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&128&&(r=!0,c.lngLat=n[46].point,we(()=>r=!1)),e.$set(c)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){T(e,s)}}}function Ti(n){let e,r;return e=new Fe({props:{paint:{"line-color":"black","line-width":10}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Di(n){let e,r;return e=new Fe({props:{paint:{"line-color":"black","line-width":3}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Ni(n){let e,r,t,o,l,i,a,s,u;r=new qt({}),r.$on("click",n[15]),r.$on("mousemove",n[16]);let c=x(n[11]),f=[];for(let z=0;z<c.length;z+=1)f[z]=En(Bn(n,c,z));const d=z=>y(f[z],1,1,()=>{f[z]=null});let p=x(n[7]),m=[];for(let z=0;z<p.length;z+=1)m[z]=Tn(Mn(n,p,z));const A=z=>y(m[z],1,1,()=>{m[z]=null});return i=new Ce({props:{data:n[19](n[8],n[7]),generateId:!0,$$slots:{default:[Ti]},$$scope:{ctx:n}}}),s=new Ce({props:{data:n[12],$$slots:{default:[Di]},$$scope:{ctx:n}}}),{c(){e=$("div"),B(r.$$.fragment),t=L();for(let z=0;z<f.length;z+=1)f[z].c();o=L();for(let z=0;z<m.length;z+=1)m[z].c();l=L(),B(i.$$.fragment),a=L(),B(s.$$.fragment),F(e,"slot","map")},m(z,_){k(z,e,_),E(r,e,null),g(e,t);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(e,null);g(e,o);for(let C=0;C<m.length;C+=1)m[C]&&m[C].m(e,null);g(e,l),E(i,e,null),g(e,a),E(s,e,null),u=!0},p(z,_){if(_[0]&7342144){c=x(z[11]);let h;for(h=0;h<c.length;h+=1){const S=Bn(z,c,h);f[h]?(f[h].p(S,_),b(f[h],1)):(f[h]=En(S),f[h].c(),b(f[h],1),f[h].m(e,o))}for(ue(),h=c.length;h<f.length;h+=1)d(h);fe()}if(_[0]&17170608){p=x(z[7]);let h;for(h=0;h<p.length;h+=1){const S=Mn(z,p,h);m[h]?(m[h].p(S,_),b(m[h],1)):(m[h]=Tn(S),m[h].c(),b(m[h],1),m[h].m(e,l))}for(ue(),h=p.length;h<m.length;h+=1)A(h);fe()}const C={};_[0]&384&&(C.data=z[19](z[8],z[7])),_[1]&2097152&&(C.$$scope={dirty:_,ctx:z}),i.$set(C);const j={};_[0]&4096&&(j.data=z[12]),_[1]&2097152&&(j.$$scope={dirty:_,ctx:z}),s.$set(j)},i(z){if(!u){b(r.$$.fragment,z);for(let _=0;_<c.length;_+=1)b(f[_]);for(let _=0;_<p.length;_+=1)b(m[_]);b(i.$$.fragment,z),b(s.$$.fragment,z),u=!0}},o(z){y(r.$$.fragment,z),f=f.filter(Boolean);for(let _=0;_<f.length;_+=1)y(f[_]);m=m.filter(Boolean);for(let _=0;_<m.length;_+=1)y(m[_]);y(i.$$.fragment,z),y(s.$$.fragment,z),u=!1},d(z){z&&w(e),T(r),ge(f,z),ge(m,z),T(i),T(s)}}}function Ii(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Ni],sidebar:[Mi]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=G(window,"keydown",n[23]),t=!0)},p(l,i){const a={};i[0]&8191|i[1]&2097152&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l),t=!1,o()}}}function Oi(n,e,r){let t,o,l;ne(n,Ge,R=>r(7,o=R)),ne(n,Yt,R=>r(8,l=R));let{map:i}=e,{finish:a}=e,{cancel:s}=e,{editingExisting:u}=e;Ft(()=>{K(Ge,o=[],o),l==null||l.stop(),i.getCanvas().style.cursor="inherit"});let c=u?"adjust":"append-end",f="snap",d=[],p=[],m=null,A=!1,z=!1,_=!1;function C(R){let te=R.length==0?"crosshair":"inherit";i.getCanvas().style.cursor=te}function j(){let R=d.pop();r(10,d),R&&K(Ge,o=R,o)}function h(){d.length==100&&d.shift(),r(10,d=[...d,JSON.parse(JSON.stringify(o))])}function S(){r(9,f=f=="snap"?"free":"snap"),m&&r(26,m.snapped=f=="snap",m)}function v(R){h(),Ge.update(te=>(c=="append-start"?te.splice(0,0,{point:R.detail.lngLat.toArray(),snapped:f=="snap"}):c=="append-end"&&te.push({point:R.detail.lngLat.toArray(),snapped:f=="snap"}),te))}function M(R){r(26,m={point:R.detail.lngLat.toArray(),snapped:f=="snap"})}function I(R){h(),Ge.update(te=>(te[R].snapped=!te[R].snapped,te))}function q(R){h(),Ge.update(te=>(te.splice(R,1),te)),r(4,A=!1)}function Z(R,te){try{if(R)return JSON.parse(R.inner.calculateRoute(te))}catch{}return Tt()}function V(R,te,Re,pt,jt){if(jt)return Tt();try{if(R&&te.length>0&&pt){if(Re=="append-start")return JSON.parse(R.inner.calculateRoute([pt,te[0]]));if(Re=="append-end")return JSON.parse(R.inner.calculateRoute([te[te.length-1],pt]))}}catch{}return Tt()}function D(R,te,Re,pt){if(pt)return;if(!R||Re!="adjust"){r(11,p=[]);return}let jt=[],Ut=1;for(let St=0;St<te.length-1;St++){let so=JSON.parse(R.inner.getExtraNodes(te[St],te[St+1]));for(let[ao,co,uo]of so)jt.push({point:[ao,co],snapped:uo,insertIdx:Ut});Ut++}r(11,p=jt)}function Q(R){h(),Ge.update(te=>(te.splice(R.insertIdx,0,{point:R.point,snapped:R.snapped}),te)),r(6,_=!0)}function N(R){Ge.update(te=>(te[R.insertIdx].point=R.point,te))}function _e(){r(6,_=!1)}function he(R){let te=R.target.tagName,Re=te=="INPUT"||te=="TEXTAREA";R.key==="Enter"&&!Re?(R.stopPropagation(),o.length>=2&&a()):R.key==="Escape"?(R.stopPropagation(),s()):R.key=="s"&&!Re?S():R.key=="1"&&!Re?r(3,c="append-start"):R.key=="2"&&!Re?r(3,c="append-end"):R.key=="3"&&!Re?r(3,c="adjust"):R.key=="z"&&R.ctrlKey&&(R.stopPropagation(),j())}function P(){h(),r(5,z=!0)}const X=[[],[]];function $e(R,te){n.$$.not_equal(te.point,R)&&(te.point=R,r(11,p))}const be=R=>Q(R),U=R=>N(R);function re(R,te){n.$$.not_equal(te.point,R)&&(te.point=R,Ge.set(o))}const oe=R=>I(R),Ue=R=>q(R),dt=()=>r(4,A=!0),yt=()=>r(4,A=!1),At=()=>r(5,z=!1);function lt(){f=this.__value,r(9,f)}function He(){f=this.__value,r(9,f)}function Ct(){c=this.__value,r(3,c)}function it(){c=this.__value,r(3,c)}function Ee(){c=this.__value,r(3,c)}return n.$$set=R=>{"map"in R&&r(25,i=R.map),"finish"in R&&r(0,a=R.finish),"cancel"in R&&r(1,s=R.cancel),"editingExisting"in R&&r(2,u=R.editingExisting)},n.$$.update=()=>{n.$$.dirty[0]&456&&D(l,o,c,_),n.$$.dirty[0]&67109304&&r(12,t=V(l,o,c,m,A||z)),n.$$.dirty[0]&128&&C(o)},[a,s,u,c,A,z,_,o,l,f,d,p,t,j,S,v,M,I,q,Z,Q,N,_e,he,P,i,m,$e,be,U,re,oe,Ue,dt,yt,At,lt,X,He,Ct,it,Ee]}class Fi extends se{constructor(e){super(),ae(this,e,Oi,Ii,ie,{map:25,finish:0,cancel:1,editingExisting:2},null,[-1,-1])}}let Dn="MZEJTanw3WpxRvt7qDfo";async function qi(n){return n?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await Pi(n)}&key=${n}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${Dn}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${Dn}`}async function Pi(n){try{let r=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB",layerTypes:["layerRoadmap"],overlay:!1})})).json();return"session"in r?r.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(r)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}const Ui="/route-element/assets/right-arrow-d8c7892c.svg";function Nn(n){let e,r;const t=n[4].default,o=De(t,n,n[3],null);return{c(){e=$("div"),o&&o.c(),F(e,"class","section svelte-zax3q3")},m(l,i){k(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&8)&&Ne(o,t,l,l[3],r?Oe(t,l[3],i,null):Ie(l[3]),null)},i(l){r||(b(o,l),r=!0)},o(l){y(o,l),r=!1},d(l){l&&w(e),o&&o.d(l)}}}function Ri(n){let e,r,t,o,l,i,a,s,u,c,f,d,p=n[2]&&Nn(n);return{c(){e=$("button"),r=$("div"),t=$("span"),o=O(n[0]),l=L(),i=$("img"),u=L(),p&&p.c(),F(i,"class","arrow svelte-zax3q3"),$t(i.src,a=Ui)||F(i,"src",a),F(i,"alt",s="Select "+n[0]),F(r,"class","top-section section svelte-zax3q3"),Ae(r,"bordered",n[2]),F(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m(m,A){k(m,e,A),g(e,r),g(r,t),g(t,o),g(r,l),g(r,i),g(e,u),p&&p.m(e,null),c=!0,f||(d=[G(e,"click",n[5]),G(e,"mouseenter",n[6]),G(e,"mouseleave",n[7])],f=!0)},p(m,[A]){(!c||A&1)&&le(o,m[0]),(!c||A&1&&s!==(s="Select "+m[0]))&&F(i,"alt",s),(!c||A&4)&&Ae(r,"bordered",m[2]),m[2]?p?(p.p(m,A),A&4&&b(p,1)):(p=Nn(m),p.c(),b(p,1),p.m(e,null)):p&&(ue(),y(p,1,1,()=>{p=null}),fe()),(!c||A&2)&&(e.disabled=m[1])},i(m){c||(b(p),c=!0)},o(m){y(p),c=!1},d(m){m&&w(e),p&&p.d(),f=!1,je(d)}}}function Gi(n,e,r){let{$$slots:t={},$$scope:o}=e,{name:l}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(f){ze.call(this,n,f)}function u(f){ze.call(this,n,f)}function c(f){ze.call(this,n,f)}return n.$$set=f=>{"name"in f&&r(0,l=f.name),"disabled"in f&&r(1,i=f.disabled),"hasSlot"in f&&r(2,a=f.hasSlot),"$$scope"in f&&r(3,o=f.$$scope)},[l,i,a,o,t,s,u,c]}class ro extends se{constructor(e){super(),ae(this,e,Gi,Ri,ie,{name:0,disabled:1,hasSlot:2})}}let Ve={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const at={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},oo=Object.keys(at);function Ot(n){return Object.keys(at[n])}const tt="All movements";function In(n,e){let r=[],t=at[n][e];t&&r.push({junctionType:n,movementType:e,...t});let o=at[n][tt];if(o&&e!=tt&&r.push({junctionType:n,movementType:tt,...o}),n=="Crossroads"){let l=at["Simple priority T-junction"][tt];l&&r.push({junctionType:"Simple priority T-junction",movementType:tt,...l})}if(n!="Any type of junction"){let l=at["Any type of junction"][tt];l&&r.push({junctionType:"Any type of junction",movementType:tt,...l})}return r}function On(n,e,r){const t=n.slice();return t[9]=e[r],t}function Fn(n,e,r){const t=n.slice();return t[12]=e[r],t}function qn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Pn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Un(n){let e,r;return e=new Pt({props:{$$slots:{default:[Hi]},$$scope:{ctx:n}}}),e.$on("close",n[8]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&524295&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Ji(n){let e;return{c(){e=O("Type of junction")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Qi(n){let e;return{c(){e=O("Type of movement")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Rn(n){let e,r,t;function o(i){n[6](i)}let l={k:"vert-radio",choices:Ot(n[1]),$$slots:{default:[Qi]},$$scope:{ctx:n}};return n[2]!==void 0&&(l.value=n[2]),e=new Je({props:l}),pe.push(()=>ke(e,"value",o)),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,a){const s={};a&2&&(s.choices=Ot(i[1])),a&524288&&(s.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,s.value=i[2],we(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){T(e,i)}}}function Gn(n){let e,r=n[12]+"",t;return{c(){e=$("li"),t=O(r)},m(o,l){k(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&le(t,r)},d(o){o&&w(e)}}}function Jn(n){let e,r=n[12]+"",t;return{c(){e=$("li"),t=O(r)},m(o,l){k(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&le(t,r)},d(o){o&&w(e)}}}function Qn(n){let e,r=n[12]+"",t;return{c(){e=$("li"),t=O(r)},m(o,l){k(o,e,l),g(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&le(t,r)},d(o){o&&w(e)}}}function Hn(n){let e,r,t=n[9].junctionType+"",o,l,i,a,s,u,c=n[9].movementType+"",f,d,p,m,A,z,_,C,j,h,S,v=x(n[9].scoreZero),M=[];for(let D=0;D<v.length;D+=1)M[D]=Gn(Pn(n,v,D));let I=x(n[9].scoreOne),q=[];for(let D=0;D<I.length;D+=1)q[D]=Jn(qn(n,I,D));let Z=x(n[9].scoreTwo),V=[];for(let D=0;D<Z.length;D+=1)V[D]=Qn(Fn(n,Z,D));return{c(){e=$("tr"),r=$("td"),o=O(t),l=L(),i=$("br"),a=L(),s=$("br"),u=L(),f=O(c),d=L(),p=$("td"),m=$("ul");for(let D=0;D<M.length;D+=1)M[D].c();A=L(),z=$("td"),_=$("ul");for(let D=0;D<q.length;D+=1)q[D].c();C=L(),j=$("td"),h=$("ul");for(let D=0;D<V.length;D+=1)V[D].c();S=L(),F(r,"class","type-row svelte-k4kgn3"),F(p,"class","score-zero svelte-k4kgn3"),F(z,"class","score-one svelte-k4kgn3"),F(j,"class","score-two svelte-k4kgn3")},m(D,Q){k(D,e,Q),g(e,r),g(r,o),g(r,l),g(r,i),g(r,a),g(r,s),g(r,u),g(r,f),g(e,d),g(e,p),g(p,m);for(let N=0;N<M.length;N+=1)M[N]&&M[N].m(m,null);g(e,A),g(e,z),g(z,_);for(let N=0;N<q.length;N+=1)q[N]&&q[N].m(_,null);g(e,C),g(e,j),g(j,h);for(let N=0;N<V.length;N+=1)V[N]&&V[N].m(h,null);g(e,S)},p(D,Q){if(Q&6&&t!==(t=D[9].junctionType+"")&&le(o,t),Q&6&&c!==(c=D[9].movementType+"")&&le(f,c),Q&6){v=x(D[9].scoreZero);let N;for(N=0;N<v.length;N+=1){const _e=Pn(D,v,N);M[N]?M[N].p(_e,Q):(M[N]=Gn(_e),M[N].c(),M[N].m(m,null))}for(;N<M.length;N+=1)M[N].d(1);M.length=v.length}if(Q&6){I=x(D[9].scoreOne);let N;for(N=0;N<I.length;N+=1){const _e=qn(D,I,N);q[N]?q[N].p(_e,Q):(q[N]=Jn(_e),q[N].c(),q[N].m(_,null))}for(;N<q.length;N+=1)q[N].d(1);q.length=I.length}if(Q&6){Z=x(D[9].scoreTwo);let N;for(N=0;N<Z.length;N+=1){const _e=Fn(D,Z,N);V[N]?V[N].p(_e,Q):(V[N]=Qn(_e),V[N].c(),V[N].m(h,null))}for(;N<V.length;N+=1)V[N].d(1);V.length=Z.length}},d(D){D&&w(e),ge(M,D),ge(q,D),ge(V,D)}}}function Hi(n){let e,r,t,o,l,i,a,s,u=n[1],c,f,d,p,m,A,z,_,C;function j(I){n[5](I)}let h={k:"vert-radio",choices:oo,$$slots:{default:[Ji]},$$scope:{ctx:n}};n[1]!==void 0&&(h.value=n[1]),i=new Je({props:h}),pe.push(()=>ke(i,"value",j)),i.$on("change",n[3]);let S=Rn(n),v=x(In(n[1],n[2])),M=[];for(let I=0;I<v.length;I+=1)M[I]=Hn(On(n,v,I));return{c(){e=$("h1"),e.textContent="LTN 1/20 scoring guidance",r=L(),t=$("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,o=L(),l=$("div"),B(i.$$.fragment),s=L(),S.c(),c=L(),f=$("table"),d=$("tr"),d.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,p=L();for(let I=0;I<M.length;I+=1)M[I].c();m=L(),A=$("button"),A.textContent="OK",Y(l,"display","flex"),Y(l,"justify-content","space-between")},m(I,q){k(I,e,q),k(I,r,q),k(I,t,q),k(I,o,q),k(I,l,q),E(i,l,null),g(l,s),S.m(l,null),k(I,c,q),k(I,f,q),g(f,d),g(f,p);for(let Z=0;Z<M.length;Z+=1)M[Z]&&M[Z].m(f,null);k(I,m,q),k(I,A,q),z=!0,_||(C=G(A,"click",n[7]),_=!0)},p(I,q){const Z={};if(q&524288&&(Z.$$scope={dirty:q,ctx:I}),!a&&q&2&&(a=!0,Z.value=I[1],we(()=>a=!1)),i.$set(Z),q&2&&ie(u,u=I[1])?(ue(),y(S,1,1,ee),fe(),S=Rn(I),S.c(),b(S,1),S.m(l,null)):S.p(I,q),q&6){v=x(In(I[1],I[2]));let V;for(V=0;V<v.length;V+=1){const D=On(I,v,V);M[V]?M[V].p(D,q):(M[V]=Hn(D),M[V].c(),M[V].m(f,null))}for(;V<M.length;V+=1)M[V].d(1);M.length=v.length}},i(I){z||(b(i.$$.fragment,I),b(S),z=!0)},o(I){y(i.$$.fragment,I),y(S),z=!1},d(I){I&&(w(e),w(r),w(t),w(o),w(l),w(c),w(f),w(m),w(A)),T(i),S.d(I),ge(M,I),_=!1,C()}}}function Ki(n){let e,r,t,o,l,i,a=n[0]&&Un(n);return{c(){e=$("button"),e.textContent="LTN 1/20 scoring guidance",r=L(),a&&a.c(),t=Qe(),F(e,"class","secondary")},m(s,u){k(s,e,u),k(s,r,u),a&&a.m(s,u),k(s,t,u),o=!0,l||(i=G(e,"click",n[4]),l=!0)},p(s,[u]){s[0]?a?(a.p(s,u),u&1&&b(a,1)):(a=Un(s),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(ue(),y(a,1,1,()=>{a=null}),fe())},i(s){o||(b(a),o=!0)},o(s){y(a),o=!1},d(s){s&&(w(e),w(r),w(t)),a&&a.d(s),l=!1,i()}}}function Wi(n,e,r){let t=!1,o=oo[0],l=Ot(o)[0];function i(){r(2,l=Ot(o)[0])}const a=()=>r(0,t=!0);function s(d){o=d,r(1,o)}function u(d){l=d,r(2,l)}return[t,o,l,i,a,s,u,()=>r(0,t=!1),()=>r(0,t=!1)]}class Zi extends se{constructor(e){super(),ae(this,e,Wi,Ki,ie,{})}}function Xi(n){let e;return{c(){e=O("User")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Kn(n){let e,r;return e=new Zi({}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Vi(n){let e;return{c(){e=O("Score")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Yi(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,A,z,_;function C(M){n[6](M)}let j={k:"horiz-radio",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]],$$slots:{default:[Xi]},$$scope:{ctx:n}};n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind!==void 0&&(j.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind),l=new Je({props:j}),pe.push(()=>ke(l,"value",C));let h=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind=="cycling"&&Kn();function S(M){n[7](M)}let v={k:"horiz-radio",choices:n[4],$$slots:{default:[Vi]},$$scope:{ctx:n}};return n[3].jats[n[0]].properties[n[1]].movements[n[2]].score!==void 0&&(v.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].score),u=new Je({props:v}),pe.push(()=>ke(u,"value",S)),{c(){e=$("label"),r=O(`Name
  `),t=$("input"),o=L(),B(l.$$.fragment),a=L(),h&&h.c(),s=L(),B(u.$$.fragment),f=L(),d=$("label"),p=O(`Comments
  `),m=$("textarea"),F(t,"type","text")},m(M,I){k(M,e,I),g(e,r),g(e,t),ve(t,n[3].jats[n[0]].properties[n[1]].movements[n[2]].name),k(M,o,I),E(l,M,I),k(M,a,I),h&&h.m(M,I),k(M,s,I),E(u,M,I),k(M,f,I),k(M,d,I),g(d,p),g(d,m),ve(m,n[3].jats[n[0]].properties[n[1]].movements[n[2]].notes),A=!0,z||(_=[G(t,"input",n[5]),G(m,"input",n[8])],z=!0)},p(M,[I]){I&15&&t.value!==M[3].jats[M[0]].properties[M[1]].movements[M[2]].name&&ve(t,M[3].jats[M[0]].properties[M[1]].movements[M[2]].name);const q={};I&512&&(q.$$scope={dirty:I,ctx:M}),!i&&I&15&&(i=!0,q.value=M[3].jats[M[0]].properties[M[1]].movements[M[2]].kind,we(()=>i=!1)),l.$set(q),M[3].jats[M[0]].properties[M[1]].movements[M[2]].kind=="cycling"?h?I&15&&b(h,1):(h=Kn(),h.c(),b(h,1),h.m(s.parentNode,s)):h&&(ue(),y(h,1,1,()=>{h=null}),fe());const Z={};I&512&&(Z.$$scope={dirty:I,ctx:M}),!c&&I&15&&(c=!0,Z.value=M[3].jats[M[0]].properties[M[1]].movements[M[2]].score,we(()=>c=!1)),u.$set(Z),I&15&&ve(m,M[3].jats[M[0]].properties[M[1]].movements[M[2]].notes)},i(M){A||(b(l.$$.fragment,M),b(h),b(u.$$.fragment,M),A=!0)},o(M){y(l.$$.fragment,M),y(h),y(u.$$.fragment,M),A=!1},d(M){M&&(w(e),w(o),w(a),w(s),w(f),w(d)),T(l,M),h&&h.d(M),T(u,M),z=!1,je(_)}}}function xi(n,e,r){let t;ne(n,J,d=>r(3,t=d));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(){t.jats[o].properties[l].movements[i].name=this.value,J.set(t)}function u(d){n.$$.not_equal(t.jats[o].properties[l].movements[i].kind,d)&&(t.jats[o].properties[l].movements[i].kind=d,J.set(t))}function c(d){n.$$.not_equal(t.jats[o].properties[l].movements[i].score,d)&&(t.jats[o].properties[l].movements[i].score=d,J.set(t))}function f(){t.jats[o].properties[l].movements[i].notes=this.value,J.set(t)}return n.$$set=d=>{"junctionIdx"in d&&r(0,o=d.junctionIdx),"stage"in d&&r(1,l=d.stage),"idx"in d&&r(2,i=d.idx)},[o,l,i,t,a,s,u,c,f]}class es extends se{constructor(e){super(),ae(this,e,xi,Yi,ie,{junctionIdx:0,stage:1,idx:2})}}function ts(n){return n%(2*Math.PI)*180/Math.PI}function Bt(n){return n%360*Math.PI/180}function Wn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function lo(n,e,r={}){if(r.final===!0)return ns(n,e);const t=Wn(n),o=Wn(e),l=Bt(t[0]),i=Bt(o[0]),a=Bt(t[1]),s=Bt(o[1]),u=Math.sin(i-l)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return ts(Math.atan2(u,c))}function ns(n,e){let r=lo(e,n);return r=(r+180)%360,r}var ct=lo;function rs(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function os(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Zn(n[0])||!Zn(n[1]))throw new Error("coordinates must contain numbers");return rs({type:"Point",coordinates:n},e,r)}function Zn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function ls(n,e={}){const r=Mo(n),t=(r[0]+r[2])/2,o=(r[1]+r[3])/2;return os([t,o],e.properties,e)}var is=ls,Me=63710088e-1,ss={centimeters:Me*100,centimetres:Me*100,degrees:360/(2*Math.PI),feet:Me*3.28084,inches:Me*39.37,kilometers:Me/1e3,kilometres:Me/1e3,meters:Me,metres:Me,miles:Me/1609.344,millimeters:Me*1e3,millimetres:Me*1e3,nauticalmiles:Me/1852,radians:1,yards:Me*1.0936};function as(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function cs(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Vn(n[0])||!Vn(n[1]))throw new Error("coordinates must contain numbers");return as({type:"Point",coordinates:n},e,r)}function us(n,e="kilometers"){const r=ss[e];if(!r)throw new Error(e+" units is invalid");return n/r}function Xn(n){return n%(2*Math.PI)*180/Math.PI}function Qt(n){return n%360*Math.PI/180}function Vn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function fs(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ds(n,e,r,t={}){const o=fs(n),l=Qt(o[0]),i=Qt(o[1]),a=Qt(r),s=us(e,t.units),u=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),c=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(u)),f=Xn(c),d=Xn(u);return cs([f,d],t.properties)}var wt=ds,Be=63710088e-1,ps={centimeters:Be*100,centimetres:Be*100,degrees:360/(2*Math.PI),feet:Be*3.28084,inches:Be*39.37,kilometers:Be/1e3,kilometres:Be/1e3,meters:Be,metres:Be,miles:Be/1609.344,millimeters:Be*1e3,millimetres:Be*1e3,nauticalmiles:Be/1852,radians:1,yards:Be*1.0936};function ms(n,e="kilometers"){const r=ps[e];if(!r)throw new Error(e+" units is invalid");return n*r}function Et(n){return n%360*Math.PI/180}function Yn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function gs(n,e,r={}){var t=Yn(n),o=Yn(e),l=Et(o[1]-t[1]),i=Et(o[0]-t[0]),a=Et(t[1]),s=Et(o[1]),u=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return ms(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)}var _s=gs;function hs(n){let e=is({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,o)=>xn(ct(e,o.point))-xn(ct(e,t.point)));let r=[];for(let t=0;t<n.length;t++){let o=n[t],l=ct(o.point,e),i=1;for(let a of $s(t,n.length)){let s=n[a],u=ct(e,s.point),c=bs(o.point,e,i++),f=_s(o.point,e),d=wt(c,.5*f,l).geometry.coordinates,p=wt(d,.2*f,u).geometry.coordinates;r.push({point1:c,point2:d,point3:p,kind:"cycling",score:"X",name:`${o.name} to ${s.name}`,notes:""})}}return r}function bs(n,e,r){let t=.003,l=ct(n,e)-90,i=t*r;return wt(n,i,l).geometry.coordinates}function xn(n){return(n+360)%360}function $s(n,e){let r=[];for(let t=n+1;t<e;t++)r.push(t);for(let t=0;t<n;t++)r.push(t);return r}const ks="/route-element/assets/movement-aa45473c.svg",ws="/route-element/assets/pan-fbcec4cd.svg";function er(n,e,r){const t=n.slice();return t[31]=e[r],t[32]=e,t[33]=r,t}function tr(n,e,r){const t=n.slice();return t[34]=e[r],t[35]=e,t[33]=r,t}function nr(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,A,z,_,C,j;function h(Q,N){return Q[0].mode=="select"?ys:vs}let S=h(n),v=S(n);function M(Q,N){return Q[0].mode=="new-arm"?Cs:As}let I=M(n),q=I(n);function Z(Q,N){return Q[0].mode=="new-movement"?Ss:js}let V=Z(n),D=V(n);return{c(){e=$("div"),r=$("button"),t=$("img"),l=L(),v.c(),i=L(),a=$("button"),s=Rt("svg"),u=Rt("circle"),c=Rt("text"),f=O("A"),d=L(),q.c(),p=L(),m=$("button"),A=$("img"),_=L(),D.c(),$t(t.src,o=ws)||F(t,"src",o),F(t,"alt","Move map"),Y(t,"vertical-align","middle"),F(r,"class","outline"),F(u,"cx","12"),F(u,"cy","12"),F(u,"r","12"),F(u,"fill","white"),F(c,"x","6"),F(c,"y","16"),F(c,"fill","#4472c4"),F(s,"width","24"),F(s,"height","24"),F(s,"xmlns","http://www.w3.org/2000/svg"),Y(s,"vertical-align","middle"),F(a,"class","outline"),$t(A.src,z=ks)||F(A,"src",z),F(A,"alt","New movement"),Y(A,"vertical-align","middle"),F(m,"class","outline"),F(e,"class","control-panel svelte-l1e6xi")},m(Q,N){k(Q,e,N),g(e,r),g(r,t),g(r,l),v.m(r,null),g(e,i),g(e,a),g(a,s),g(s,u),g(s,c),g(c,f),g(a,d),q.m(a,null),g(e,p),g(e,m),g(m,A),g(m,_),D.m(m,null),C||(j=[G(r,"click",function(){Kt(n[4])&&n[4].apply(this,arguments)}),G(a,"click",n[12]),G(m,"click",n[13])],C=!0)},p(Q,N){n=Q,S!==(S=h(n))&&(v.d(1),v=S(n),v&&(v.c(),v.m(r,null))),I!==(I=M(n))&&(q.d(1),q=I(n),q&&(q.c(),q.m(a,null))),V!==(V=Z(n))&&(D.d(1),D=V(n),D&&(D.c(),D.m(m,null)))},d(Q){Q&&w(e),v.d(),q.d(),D.d(),C=!1,je(j)}}}function vs(n){let e;return{c(){e=O("Move map")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function ys(n){let e;return{c(){e=$("b"),e.textContent="Move map"},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function As(n){let e;return{c(){e=O("New arm")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Cs(n){let e;return{c(){e=$("b"),e.textContent="New arm"},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function js(n){let e;return{c(){e=O("New movement")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Ss(n){let e;return{c(){e=$("b"),e.textContent="New movement"},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function zs(n){let e;return{c(){e=$("span"),e.textContent=`${Ps(n[33])}`,F(e,"class","dot svelte-l1e6xi"),Y(e,"color","#4472c4"),Y(e,"background-color","white")},m(r,t){k(r,e,t)},p:ee,d(r){r&&w(e)}}}function rr(n){let e,r,t;function o(s){n[14](s,n[34])}function l(){return n[15](n[33])}function i(){return n[16](n[33])}let a={draggable:!0,$$slots:{default:[zs]},$$scope:{ctx:n}};return n[34].point!==void 0&&(a.lngLat=n[34].point),e=new Ye({props:a}),pe.push(()=>ke(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){B(e.$$.fragment)},m(s,u){E(e,s,u),t=!0},p(s,u){n=s;const c={};u[1]&32&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&38&&(r=!0,c.lngLat=n[34].point,we(()=>r=!1)),e.$set(c)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){T(e,s)}}}function Ls(n){let e;return{c(){e=$("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score]),Y(e,"opacity",n[31].kind=="walking & wheeling"?"0%":"100%")},m(r,t){k(r,e,t)},p(r,t){t[0]&38&&Y(e,"background-color",r[7][r[31].score]),t[0]&38&&Y(e,"opacity",r[31].kind=="walking & wheeling"?"0%":"100%")},d(r){r&&w(e)}}}function Ms(n){let e;return{c(){e=$("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score])},m(r,t){k(r,e,t)},p(r,t){t[0]&38&&Y(e,"background-color",r[7][r[31].score])},d(r){r&&w(e)}}}function Bs(n){let e;return{c(){e=$("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score]),Y(e,"opacity","0%")},m(r,t){k(r,e,t)},p(r,t){t[0]&38&&Y(e,"background-color",r[7][r[31].score])},d(r){r&&w(e)}}}function or(n){let e,r,t,o,l,i,a,s,u;function c(v){n[17](v,n[31])}function f(){return n[18](n[33])}function d(){return n[19](n[33])}let p={draggable:!0,$$slots:{default:[Ls]},$$scope:{ctx:n}};n[31].point1!==void 0&&(p.lngLat=n[31].point1),e=new Ye({props:p}),pe.push(()=>ke(e,"lngLat",c)),e.$on("dragend",f),e.$on("click",d);function m(v){n[20](v,n[31])}function A(){return n[21](n[33])}function z(){return n[22](n[33])}let _={draggable:!0,$$slots:{default:[Ms]},$$scope:{ctx:n}};n[31].point2!==void 0&&(_.lngLat=n[31].point2),o=new Ye({props:_}),pe.push(()=>ke(o,"lngLat",m)),o.$on("dragend",A),o.$on("click",z);function C(v){n[23](v,n[31])}function j(){return n[24](n[33])}function h(){return n[25](n[33])}let S={draggable:!0,$$slots:{default:[Bs]},$$scope:{ctx:n}};return n[31].point3!==void 0&&(S.lngLat=n[31].point3),a=new Ye({props:S}),pe.push(()=>ke(a,"lngLat",C)),a.$on("dragend",j),a.$on("click",h),{c(){B(e.$$.fragment),t=L(),B(o.$$.fragment),i=L(),B(a.$$.fragment)},m(v,M){E(e,v,M),k(v,t,M),E(o,v,M),k(v,i,M),E(a,v,M),u=!0},p(v,M){n=v;const I={};M[0]&38|M[1]&32&&(I.$$scope={dirty:M,ctx:n}),!r&&M[0]&38&&(r=!0,I.lngLat=n[31].point1,we(()=>r=!1)),e.$set(I);const q={};M[0]&38|M[1]&32&&(q.$$scope={dirty:M,ctx:n}),!l&&M[0]&38&&(l=!0,q.lngLat=n[31].point2,we(()=>l=!1)),o.$set(q);const Z={};M[0]&38|M[1]&32&&(Z.$$scope={dirty:M,ctx:n}),!s&&M[0]&38&&(s=!0,Z.lngLat=n[31].point3,we(()=>s=!1)),a.$set(Z)},i(v){u||(b(e.$$.fragment,v),b(o.$$.fragment,v),b(a.$$.fragment,v),u=!0)},o(v){y(e.$$.fragment,v),y(o.$$.fragment,v),y(a.$$.fragment,v),u=!1},d(v){v&&(w(t),w(i)),T(e,v),T(o,v),T(a,v)}}}function Es(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=O(e)},m(t,o){k(t,r,o)},p(t,o){o[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&le(r,e)},d(t){t&&w(r)}}}function Ts(n){let e,r;return e=new vt({props:{$$slots:{default:[Es,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o[0]&1073741824|o[1]&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Ds(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=O(e)},m(t,o){k(t,r,o)},p(t,o){o[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&le(r,e)},d(t){t&&w(r)}}}function Ns(n){let e,r;return e=new vt({props:{$$slots:{default:[Ds,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o[0]&1073741824|o[1]&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Is(n){let e,r,t,o,l,i;return e=new Fe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":kt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Ts]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Fe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":kt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Ns]},$$scope:{ctx:n}}}),t.$on("click",n[9]),l=new ot({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){B(e.$$.fragment),r=L(),B(t.$$.fragment),o=L(),B(l.$$.fragment)},m(a,s){E(e,a,s),k(a,r,s),E(t,a,s),k(a,o,s),E(l,a,s),i=!0},p(a,s){const u={};s[1]&32&&(u.$$scope={dirty:s,ctx:a}),e.$set(u);const c={};s[1]&32&&(c.$$scope={dirty:s,ctx:a}),t.$set(c)},i(a){i||(b(e.$$.fragment,a),b(t.$$.fragment,a),b(l.$$.fragment,a),i=!0)},o(a){y(e.$$.fragment,a),y(t.$$.fragment,a),y(l.$$.fragment,a),i=!1},d(a){a&&(w(r),w(o)),T(e,a),T(t,a),T(l,a)}}}function Os(n){let e,r,t,o;return e=new Fe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new rt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){B(e.$$.fragment),r=L(),B(t.$$.fragment)},m(l,i){E(e,l,i),k(l,r,i),E(t,l,i),o=!0},p:ee,i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&w(r),T(e,l),T(t,l)}}}function Fs(n){let e,r,t,o,l,i,a,s,u;e=new qt({}),e.$on("click",n[8]);let c=n[0].mode!="editing"&&nr(n),f=x(n[5].jats[n[1]].properties[n[2]].arms),d=[];for(let _=0;_<f.length;_+=1)d[_]=rr(tr(n,f,_));const p=_=>y(d[_],1,1,()=>{d[_]=null});let m=x(n[5].jats[n[1]].properties[n[2]].movements),A=[];for(let _=0;_<m.length;_+=1)A[_]=or(er(n,m,_));const z=_=>y(A[_],1,1,()=>{A[_]=null});return i=new Ce({props:{data:n[10](n[5]),$$slots:{default:[Is]},$$scope:{ctx:n}}}),s=new Ce({props:{data:n[6],$$slots:{default:[Os]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=L(),c&&c.c(),t=L();for(let _=0;_<d.length;_+=1)d[_].c();o=L();for(let _=0;_<A.length;_+=1)A[_].c();l=L(),B(i.$$.fragment),a=L(),B(s.$$.fragment)},m(_,C){E(e,_,C),k(_,r,C),c&&c.m(_,C),k(_,t,C);for(let j=0;j<d.length;j+=1)d[j]&&d[j].m(_,C);k(_,o,C);for(let j=0;j<A.length;j+=1)A[j]&&A[j].m(_,C);k(_,l,C),E(i,_,C),k(_,a,C),E(s,_,C),u=!0},p(_,C){if(_[0].mode!="editing"?c?c.p(_,C):(c=nr(_),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),C[0]&46){f=x(_[5].jats[_[1]].properties[_[2]].arms);let S;for(S=0;S<f.length;S+=1){const v=tr(_,f,S);d[S]?(d[S].p(v,C),b(d[S],1)):(d[S]=rr(v),d[S].c(),b(d[S],1),d[S].m(o.parentNode,o))}for(ue(),S=f.length;S<d.length;S+=1)p(S);fe()}if(C[0]&174){m=x(_[5].jats[_[1]].properties[_[2]].movements);let S;for(S=0;S<m.length;S+=1){const v=er(_,m,S);A[S]?(A[S].p(v,C),b(A[S],1)):(A[S]=or(v),A[S].c(),b(A[S],1),A[S].m(l.parentNode,l))}for(ue(),S=m.length;S<A.length;S+=1)z(S);fe()}const j={};C[0]&32&&(j.data=_[10](_[5])),C[1]&32&&(j.$$scope={dirty:C,ctx:_}),i.$set(j);const h={};C[0]&64&&(h.data=_[6]),C[1]&32&&(h.$$scope={dirty:C,ctx:_}),s.$set(h)},i(_){if(!u){b(e.$$.fragment,_);for(let C=0;C<f.length;C+=1)b(d[C]);for(let C=0;C<m.length;C+=1)b(A[C]);b(i.$$.fragment,_),b(s.$$.fragment,_),u=!0}},o(_){y(e.$$.fragment,_),d=d.filter(Boolean);for(let C=0;C<d.length;C+=1)y(d[C]);A=A.filter(Boolean);for(let C=0;C<A.length;C+=1)y(A[C]);y(i.$$.fragment,_),y(s.$$.fragment,_),u=!1},d(_){_&&(w(r),w(t),w(o),w(l),w(a)),T(e,_),c&&c.d(_),ge(d,_),ge(A,_),T(i,_),T(s,_)}}}function qs(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function Ps(n){return String.fromCharCode(n+"A".charCodeAt(0))}function Us(n,e,r){let t,o,l;ne(n,J,P=>r(5,o=P)),ne(n,Nt,P=>r(26,l=P));let{junctionIdx:i}=e,{stage:a}=e,{mode:s}=e,{hoveringSidebar:u}=e,{select:c}=e,{stopEditing:f}=e,d={0:Ve.red.background,1:Ve.amber.background,2:Ve.green.background,X:Ve.critical.background};function p(P,X,$e){let be={type:"FeatureCollection",features:[]},U=X.mode=="editing"?X.id:$e;return U!=null&&(U.kind=="arm"?be.features.push(qs(P.jats[i].properties[a].arms[U.idx],U.idx)):be.features.push(_(P.jats[i].properties[a].movements[U.idx],U.idx))),be}async function m(P){if(l){for(let X of l.queryRenderedFeatures(P.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await f();return}s.mode=="new-arm"?(K(J,o.jats[i].properties[a].arms=[...o.jats[i].properties[a].arms,{point:P.detail.lngLat.toArray(),name:""}],o),await c({kind:"arm",idx:o.jats[i].properties[a].arms.length-1})):(K(J,o.jats[i].properties[a].movements=[...o.jats[i].properties[a].movements,{point1:P.detail.lngLat.toArray(),point2:wt(P.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:wt(P.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await c({kind:"movement",idx:o.jats[i].properties[a].movements.length-1}))}}}async function A(P){await c({kind:"movement",idx:P.detail.features[0].id})}function z(P){let X={type:"FeatureCollection",features:P.jats[i].properties[a].movements.map(($e,be)=>_($e,be))};for(let $e of P.jats[i].properties[a].movements)if(X.features.push(C($e,X.features.length)),$e.kind=="walking & wheeling"){let be={...$e,point1:$e.point3,point3:$e.point1};X.features.push(C(be,X.features.length))}return X}function _(P,X){return{type:"Feature",id:X,properties:{name:P.name,kind:P.kind,color:d[P.score]},geometry:{type:"LineString",coordinates:[P.point1,P.point2,P.point3]}}}function C(P,X){return{type:"Feature",id:X,properties:{kind:P.kind,color:d[P.score],angle:ct(P.point2,P.point3)},geometry:{type:"Point",coordinates:P.point3}}}const j=()=>r(0,s={mode:"new-arm"}),h=()=>r(0,s={mode:"new-movement"});function S(P,X){n.$$.not_equal(X.point,P)&&(X.point=P,J.set(o))}const v=P=>c({kind:"arm",idx:P}),M=P=>c({kind:"arm",idx:P});function I(P,X){n.$$.not_equal(X.point1,P)&&(X.point1=P,J.set(o))}const q=P=>c({kind:"movement",idx:P}),Z=P=>c({kind:"movement",idx:P});function V(P,X){n.$$.not_equal(X.point2,P)&&(X.point2=P,J.set(o))}const D=P=>c({kind:"movement",idx:P}),Q=P=>c({kind:"movement",idx:P});function N(P,X){n.$$.not_equal(X.point3,P)&&(X.point3=P,J.set(o))}const _e=P=>c({kind:"movement",idx:P}),he=P=>c({kind:"movement",idx:P});return n.$$set=P=>{"junctionIdx"in P&&r(1,i=P.junctionIdx),"stage"in P&&r(2,a=P.stage),"mode"in P&&r(0,s=P.mode),"hoveringSidebar"in P&&r(11,u=P.hoveringSidebar),"select"in P&&r(3,c=P.select),"stopEditing"in P&&r(4,f=P.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&2081&&r(6,t=p(o,s,u))},[s,i,a,c,f,o,t,d,m,A,z,u,j,h,S,v,M,I,q,Z,V,D,Q,N,_e,he]}class Rs extends se{constructor(e){super(),ae(this,e,Us,Fs,ie,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function lr(n){if(n.movements.length==0)return"No movements added";let e=0,r=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],r+=2;let t=e/r*100;return`${Math.round(t)}%`}const{window:Gs}=ut;function ir(n,e,r){const t=n.slice();t[27]=e[r],t[30]=r;const o=t[14][t[27].score];return t[28]=o,t}function sr(n,e,r){const t=n.slice();return t[31]=e[r],t[30]=r,t}function Js(n){let e,r,t,o,l,i,a,s,u;return{c(){e=$("button"),e.textContent="Done",r=L(),t=$("button"),t.textContent="Delete",o=L(),l=$("label"),i=O(`Arm name
        `),a=$("input"),F(a,"type","text")},m(c,f){k(c,e,f),k(c,r,f),k(c,t,f),k(c,o,f),k(c,l,f),g(l,i),g(l,a),ve(a,n[5].jats[n[0]].properties[n[1]].arms[n[2].id.idx].name),s||(u=[G(e,"click",n[23]),G(t,"click",n[10]),G(a,"input",n[24])],s=!0)},p(c,f){f[0]&39&&a.value!==c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name&&ve(a,c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name)},i:ee,o:ee,d(c){c&&(w(e),w(r),w(t),w(o),w(l)),s=!1,je(u)}}}function Qs(n){let e,r,t,o,l,i,a,s;return e=new es({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),{c(){B(e.$$.fragment),r=L(),t=$("button"),t.textContent="Save",o=L(),l=$("button"),l.textContent="Delete"},m(u,c){E(e,u,c),k(u,r,c),k(u,t,c),k(u,o,c),k(u,l,c),i=!0,a||(s=[G(t,"click",n[9]),G(l,"click",n[10])],a=!0)},p(u,c){const f={};c[0]&1&&(f.junctionIdx=u[0]),c[0]&2&&(f.stage=u[1]),c[0]&4&&(f.idx=u[2].id.idx),e.$set(f)},i(u){i||(b(e.$$.fragment,u),i=!0)},o(u){y(e.$$.fragment,u),i=!1},d(u){u&&(w(r),w(t),w(o),w(l)),T(e,u),a=!1,je(s)}}}function Hs(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m=n[5].jats[n[0]].properties.name+"",A,z,_=lr(n[5].jats[n[0]].properties[n[1]])+"",C,j,h,S,v,M,I,q,Z,V,D,Q=x(n[5].jats[n[0]].properties[n[1]].arms),N=[];for(let U=0;U<Q.length;U+=1)N[U]=ar(sr(n,Q,U));const _e=U=>y(N[U],1,1,()=>{N[U]=null});let he=n[5].jats[n[0]].properties[n[7]].arms.length>0&&cr(n),P=x(n[5].jats[n[0]].properties[n[1]].movements),X=[];for(let U=0;U<P.length;U+=1)X[U]=ur(ir(n,P,U));const $e=U=>y(X[U],1,1,()=>{X[U]=null});let be=n[5].jats[n[0]].properties[n[7]].movements.length>0&&fr(n);return{c(){e=$("button"),e.textContent="Done",r=L(),t=$("h3"),t.textContent="Arms",o=L();for(let U=0;U<N.length;U+=1)N[U].c();l=L(),he&&he.c(),i=L(),a=$("h3"),a.textContent="Movements",s=L(),u=$("p"),c=O("Total JAT score for "),f=O(n[1]),d=O(` junction
        `),p=$("i"),A=O(m),z=O(`
        : `),C=O(_),j=L(),h=$("button"),S=O("Generate cycling movements between all arms"),M=L();for(let U=0;U<X.length;U+=1)X[U].c();I=L(),be&&be.c(),q=Qe(),F(h,"class","secondary"),h.disabled=v=n[5].jats[n[0]].properties[n[1]].arms.length<2},m(U,re){k(U,e,re),k(U,r,re),k(U,t,re),k(U,o,re);for(let oe=0;oe<N.length;oe+=1)N[oe]&&N[oe].m(U,re);k(U,l,re),he&&he.m(U,re),k(U,i,re),k(U,a,re),k(U,s,re),k(U,u,re),g(u,c),g(u,f),g(u,d),g(u,p),g(p,A),g(u,z),g(u,C),k(U,j,re),k(U,h,re),g(h,S),k(U,M,re);for(let oe=0;oe<X.length;oe+=1)X[oe]&&X[oe].m(U,re);k(U,I,re),be&&be.m(U,re),k(U,q,re),Z=!0,V||(D=[G(e,"click",n[16]),G(h,"click",n[15])],V=!0)},p(U,re){if(re[0]&299){Q=x(U[5].jats[U[0]].properties[U[1]].arms);let oe;for(oe=0;oe<Q.length;oe+=1){const Ue=sr(U,Q,oe);N[oe]?(N[oe].p(Ue,re),b(N[oe],1)):(N[oe]=ar(Ue),N[oe].c(),b(N[oe],1),N[oe].m(l.parentNode,l))}for(ue(),oe=Q.length;oe<N.length;oe+=1)_e(oe);fe()}if(U[5].jats[U[0]].properties[U[7]].arms.length>0?he?he.p(U,re):(he=cr(U),he.c(),he.m(i.parentNode,i)):he&&(he.d(1),he=null),(!Z||re[0]&2)&&le(f,U[1]),(!Z||re[0]&33)&&m!==(m=U[5].jats[U[0]].properties.name+"")&&le(A,m),(!Z||re[0]&35)&&_!==(_=lr(U[5].jats[U[0]].properties[U[1]])+"")&&le(C,_),(!Z||re[0]&35&&v!==(v=U[5].jats[U[0]].properties[U[1]].arms.length<2))&&(h.disabled=v),re[0]&16683){P=x(U[5].jats[U[0]].properties[U[1]].movements);let oe;for(oe=0;oe<P.length;oe+=1){const Ue=ir(U,P,oe);X[oe]?(X[oe].p(Ue,re),b(X[oe],1)):(X[oe]=ur(Ue),X[oe].c(),b(X[oe],1),X[oe].m(I.parentNode,I))}for(ue(),oe=P.length;oe<X.length;oe+=1)$e(oe);fe()}U[5].jats[U[0]].properties[U[7]].movements.length>0?be?be.p(U,re):(be=fr(U),be.c(),be.m(q.parentNode,q)):be&&(be.d(1),be=null)},i(U){if(!Z){for(let re=0;re<Q.length;re+=1)b(N[re]);for(let re=0;re<P.length;re+=1)b(X[re]);Z=!0}},o(U){N=N.filter(Boolean);for(let re=0;re<N.length;re+=1)y(N[re]);X=X.filter(Boolean);for(let re=0;re<X.length;re+=1)y(X[re]);Z=!1},d(U){U&&(w(e),w(r),w(t),w(o),w(l),w(i),w(a),w(s),w(u),w(j),w(h),w(M),w(I),w(q)),ge(N,U),he&&he.d(U),ge(X,U),be&&be.d(U),V=!1,je(D)}}}function ar(n){let e,r;function t(){return n[17](n[30])}function o(){return n[18](n[30])}return e=new ro({props:{name:`${dr(n[30])} - ${n[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[19]),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0},p(l,i){n=l;const a={};i[0]&35&&(a.name=`${dr(n[30])} - ${n[31].name||"Unnamed arm"}`),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l)}}}function cr(n){let e,r,t;return{c(){e=$("button"),e.textContent=`Copy arms from ${n[7]}`,F(e,"class","secondary")},m(o,l){k(o,e,l),r||(t=G(e,"click",n[12]),r=!0)},p:ee,d(o){o&&w(e),r=!1,t()}}}function Ks(n){let e,r,t,o=n[27].score+"",l,i,a,s=pr(n[27].kind)+"",u;return{c(){e=$("div"),r=$("span"),t=O("Score: "),l=O(o),i=L(),a=$("span"),u=O(s),Y(r,"padding","4px"),Y(r,"color",n[28].font),Y(r,"background-color",n[28].background),Y(e,"width","100%"),Y(e,"display","flex"),Y(e,"justify-content","space-between")},m(c,f){k(c,e,f),g(e,r),g(r,t),g(r,l),g(e,i),g(e,a),g(a,u)},p(c,f){f[0]&35&&o!==(o=c[27].score+"")&&le(l,o),f[0]&35&&Y(r,"color",c[28].font),f[0]&35&&Y(r,"background-color",c[28].background),f[0]&35&&s!==(s=pr(c[27].kind)+"")&&le(u,s)},d(c){c&&w(e)}}}function ur(n){let e,r;function t(){return n[20](n[30])}function o(){return n[21](n[30])}return e=new ro({props:{name:n[27].name||"Unnamed movement",$$slots:{default:[Ks]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[22]),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0},p(l,i){n=l;const a={};i[0]&35&&(a.name=n[27].name||"Unnamed movement"),i[0]&35|i[1]&4&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l)}}}function fr(n){let e,r,t;return{c(){e=$("button"),e.textContent=`Copy movements from ${n[7]}`,F(e,"class","secondary")},m(o,l){k(o,e,l),r||(t=G(e,"click",n[13]),r=!0)},p:ee,d(o){o&&w(e),r=!1,t()}}}function Ws(n){let e,r,t,o,l=n[5].jats[n[0]].properties.name+"",i,a,s,u,c;const f=[Hs,Qs,Js],d=[];function p(m,A){return m[2].mode!="editing"?0:m[2].id.kind=="movement"?1:2}return s=p(n),u=d[s]=f[s](n),{c(){e=$("div"),r=$("h2"),t=O(n[1]),o=O(" JAT for "),i=O(l),a=L(),u.c(),F(e,"slot","sidebar")},m(m,A){k(m,e,A),g(e,r),g(r,t),g(r,o),g(r,i),g(e,a),d[s].m(e,null),n[25](e),c=!0},p(m,A){(!c||A[0]&2)&&le(t,m[1]),(!c||A[0]&33)&&l!==(l=m[5].jats[m[0]].properties.name+"")&&le(i,l);let z=s;s=p(m),s===z?d[s].p(m,A):(ue(),y(d[z],1,1,()=>{d[z]=null}),fe(),u=d[s],u?u.p(m,A):(u=d[s]=f[s](m),u.c()),b(u,1),u.m(e,null))},i(m){c||(b(u),c=!0)},o(m){y(u),c=!1},d(m){m&&w(e),d[s].d(),n[25](null)}}}function Zs(n){let e,r;return e=new rt({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o[0]&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Xs(n){let e,r,t,o,l,i,a;return r=new We({props:{except:"jats"}}),o=new Ce({props:{data:me(n[5].jats),generateId:!0,$$slots:{default:[Zs]},$$scope:{ctx:n}}}),i=new Rs({props:{junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],select:n[8],stopEditing:n[9]}}),{c(){e=$("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(s,u){k(s,e,u),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),a=!0},p(s,u){const c={};u[0]&32&&(c.data=me(s[5].jats)),u[0]&1|u[1]&4&&(c.$$scope={dirty:u,ctx:s}),o.$set(c);const f={};u[0]&1&&(f.junctionIdx=s[0]),u[0]&2&&(f.stage=s[1]),u[0]&4&&(f.mode=s[2]),u[0]&8&&(f.hoveringSidebar=s[3]),i.$set(f)},i(s){a||(b(r.$$.fragment,s),b(o.$$.fragment,s),b(i.$$.fragment,s),a=!0)},o(s){y(r.$$.fragment,s),y(o.$$.fragment,s),y(i.$$.fragment,s),a=!1},d(s){s&&w(e),T(r),T(o),T(i)}}}function Vs(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Xs],sidebar:[Ws]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=G(Gs,"keydown",n[11]),t=!0)},p(l,i){const a={};i[0]&127|i[1]&4&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l),t=!1,o()}}}function dr(n){return String.fromCharCode(n+"A".charCodeAt(0))}function pr(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function Ys(n,e,r){let t,o;ne(n,J,N=>r(5,t=N)),ne(n,W,N=>r(6,o=N));let{junctionIdx:l}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s={mode:"select"},u=null,c=null,f;async function d(N){u=f.scrollTop,r(2,s={mode:"editing",id:N}),r(3,c=null),await nt(),r(4,f.scrollTop=0,f)}async function p(){r(2,s={mode:"select"}),u!=null&&(await nt(),r(4,f.scrollTop=u,f),u=null)}function m(){s.mode=="editing"&&window.confirm(`Delete this ${s.id.kind}?`)&&(s.id.kind=="movement"?(t.jats[l].properties[i].movements.splice(s.id.idx,1),J.set(t)):(t.jats[l].properties[i].arms.splice(s.id.idx,1),J.set(t)),p())}function A(N){if(s.mode!="editing")return;let _e=N.target.tagName,he=_e=="INPUT"||_e=="TEXTAREA";N.key=="Escape"||N.key=="Enter"&&!he?(N.stopPropagation(),p()):N.key=="Delete"&&!he&&(N.stopPropagation(),m())}function z(){t.jats[l].properties[i].arms.length>0&&!window.confirm("Overwrite arms?")||(K(J,t.jats[l].properties[i].arms=JSON.parse(JSON.stringify(t.jats[l].properties[a].arms)),t),J.set(t))}function _(){t.jats[l].properties[i].movements.length>0&&!window.confirm("Overwrite movements?")||(K(J,t.jats[l].properties[i].movements=JSON.parse(JSON.stringify(t.jats[l].properties[a].movements)),t),J.set(t))}let C={0:Ve.red,1:Ve.amber,2:Ve.green,X:Ve.critical};function j(){if(t.jats[l].properties[i].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let N=t.jats[l].properties[i].movements.filter(_e=>_e.kind=="walking & wheeling");K(J,t.jats[l].properties[i].movements=[...N,...hs(t.jats[l].properties[i].arms)],t)}const h=()=>K(W,o={kind:"edit-jat",idx:l},o),S=N=>d({kind:"arm",idx:N}),v=N=>r(3,c={kind:"arm",idx:N}),M=()=>r(3,c=null),I=N=>d({kind:"movement",idx:N}),q=N=>r(3,c={kind:"movement",idx:N}),Z=()=>r(3,c=null),V=()=>r(2,s={mode:"select"});function D(){t.jats[l].properties[i].arms[s.id.idx].name=this.value,J.set(t)}function Q(N){pe[N?"unshift":"push"](()=>{f=N,r(4,f)})}return n.$$set=N=>{"junctionIdx"in N&&r(0,l=N.junctionIdx),"stage"in N&&r(1,i=N.stage)},[l,i,s,c,f,t,o,a,d,p,m,A,z,_,C,j,h,S,v,M,I,q,Z,V,D,Q]}class xs extends se{constructor(e){super(),ae(this,e,Ys,Vs,ie,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:ea}=ut;function ta(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m;return{c(){e=$("div"),r=$("button"),r.textContent="Done",t=L(),o=$("button"),o.textContent="Delete JAT",l=L(),i=$("label"),a=O(`Name:
      `),s=$("input"),u=L(),c=$("button"),c.textContent="Existing",f=L(),d=$("button"),d.textContent="Proposed",F(s,"type","text"),F(e,"slot","sidebar")},m(A,z){k(A,e,z),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(i,a),g(i,s),ve(s,n[1].jats[n[0]].properties.name),g(e,u),g(e,c),g(e,f),g(e,d),p||(m=[G(r,"click",n[6]),G(o,"click",n[4]),G(s,"input",n[7]),G(c,"click",n[8]),G(d,"click",n[9])],p=!0)},p(A,z){z&3&&s.value!==A[1].jats[A[0]].properties.name&&ve(s,A[1].jats[A[0]].properties.name)},d(A){A&&w(e),p=!1,je(m)}}}function na(n){let e,r;return e=new rt({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function ra(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"jats"}}),o=new Ce({props:{data:me(n[1].jats),generateId:!0,$$slots:{default:[na]},$$scope:{ctx:n}}});function u(f){n[5](f)}let c={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].jats[n[0]].geometry.coordinates),i=new Vt({props:c}),pe.push(()=>ke(i,"lngLat",u)),{c(){e=$("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){k(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].jats)),d&1025&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};d&3&&(m.color=f[1].jats[f[0]].properties.color),!a&&d&3&&(a=!0,m.lngLat=f[1].jats[f[0]].geometry.coordinates,we(()=>a=!1)),i.$set(m)},i(f){s||(b(r.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&w(e),T(r),T(o),T(i)}}}function oa(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[ra],sidebar:[ta]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=G(ea,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l),t=!1,o()}}}function la(n,e,r){let t,o;ne(n,J,p=>r(1,t=p)),ne(n,W,p=>r(2,o=p));let{idx:l}=e;function i(p){p.key=="Escape"&&K(W,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this JAT?")&&(K(W,o={kind:"neutral"},o),await nt(),t.jats.splice(l,1),J.set(t))}function s(p){n.$$.not_equal(t.jats[l].geometry.coordinates,p)&&(t.jats[l].geometry.coordinates=p,J.set(t))}const u=()=>K(W,o={kind:"neutral"},o);function c(){t.jats[l].properties.name=this.value,J.set(t)}const f=()=>K(W,o={kind:"edit-jat-detail",idx:l,stage:"existing"},o),d=()=>K(W,o={kind:"edit-jat-detail",idx:l,stage:"proposed"},o);return n.$$set=p=>{"idx"in p&&r(0,l=p.idx)},[l,t,o,i,a,s,u,c,f,d]}class ia extends se{constructor(e){super(),ae(this,e,la,oa,ie,{idx:0})}}function mr(n,e,r){const t=n.slice();return t[5]=e[r],t[6]=e,t[7]=r,t}function sa(n){let e,r;return{c(){e=$("span"),r=L(),F(e,"class","dot svelte-jgyhla")},m(t,o){k(t,e,o),k(t,r,o)},p:ee,d(t){t&&(w(e),w(r))}}}function gr(n){let e,r,t;function o(a){n[3](a,n[5],n[6],n[7])}function l(){return n[4](n[7])}let i={draggable:!0,$$slots:{default:[sa]},$$scope:{ctx:n}};return n[5]!==void 0&&(i.lngLat=n[5]),e=new Ye({props:i}),pe.push(()=>ke(e,"lngLat",o)),e.$on("contextmenu",l),{c(){B(e.$$.fragment)},m(a,s){E(e,a,s),t=!0},p(a,s){n=a;const u={};s&256&&(u.$$scope={dirty:s,ctx:n}),!r&&s&1&&(r=!0,u.lngLat=n[5],we(()=>r=!1)),e.$set(u)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){y(e.$$.fragment,a),t=!1},d(a){T(e,a)}}}function aa(n){let e,r,t,o;e=new qt({}),e.$on("click",n[1]);let l=x(n[0].geometry.coordinates),i=[];for(let s=0;s<l.length;s+=1)i[s]=gr(mr(n,l,s));const a=s=>y(i[s],1,1,()=>{i[s]=null});return{c(){B(e.$$.fragment),r=L();for(let s=0;s<i.length;s+=1)i[s].c();t=Qe()},m(s,u){E(e,s,u),k(s,r,u);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(s,u);k(s,t,u),o=!0},p(s,[u]){if(u&5){l=x(s[0].geometry.coordinates);let c;for(c=0;c<l.length;c+=1){const f=mr(s,l,c);i[c]?(i[c].p(f,u),b(i[c],1)):(i[c]=gr(f),i[c].c(),b(i[c],1),i[c].m(t.parentNode,t))}for(ue(),c=l.length;c<i.length;c+=1)a(c);fe()}},i(s){if(!o){b(e.$$.fragment,s);for(let u=0;u<l.length;u+=1)b(i[u]);o=!0}},o(s){y(e.$$.fragment,s),i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)y(i[u]);o=!1},d(s){s&&(w(r),w(t)),T(e,s),ge(i,s)}}}function ca(n,e,r){let{f:t}=e;function o(s){t.geometry.coordinates.push(s.detail.lngLat.toArray()),r(0,t)}function l(s){t.geometry.coordinates.splice(s,1),r(0,t)}function i(s,u,c,f){c[f]=s,r(0,t)}const a=s=>l(s);return n.$$set=s=>{"f"in s&&r(0,t=s.f)},[t,o,l,i,a]}class io extends se{constructor(e){super(),ae(this,e,ca,aa,ie,{f:0})}}const{window:ua}=ut;function _r(n,e,r){const t=n.slice();return t[13]=e[r],t[14]=e,t[15]=r,t}function hr(n){let e;return{c(){e=$("p"),e.textContent="A link needs at least two points"},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function fa(n){let e,r,t;function o(){return n[10](n[13])}return{c(){e=$("button"),e.textContent="?",F(e,"class","outline")},m(l,i){k(l,e,i),r||(t=G(e,"click",o),r=!0)},p(l,i){n=l},d(l){l&&w(e),r=!1,t()}}}function da(n){let e=n[13].name+"",r,t,o=n[13].description+"",l,i,a,s=xe[n[13].name]&&fa(n);return{c(){r=O(e),t=O(": "),l=O(o),i=L(),s&&s.c(),a=L()},m(u,c){k(u,r,c),k(u,t,c),k(u,l,c),k(u,i,c),s&&s.m(u,c),k(u,a,c)},p(u,c){xe[u[13].name]&&s.p(u,c)},d(u){u&&(w(r),w(t),w(l),w(i),w(a)),s&&s.d(u)}}}function br(n){let e,r,t;function o(i){n[11](i,n[15])}let l={k:"horiz-radio",choices:n[13].choices,$$slots:{default:[da]},$$scope:{ctx:n}};return n[1].links[n[0]].properties.answers[n[15]]!==void 0&&(l.value=n[1].links[n[0]].properties.answers[n[15]]),e=new Je({props:l}),pe.push(()=>ke(e,"value",o)),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,a){n=i;const s={};a&65540&&(s.$$scope={dirty:a,ctx:n}),!r&&a&3&&(r=!0,s.value=n[1].links[n[0]].properties.answers[n[15]],we(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){T(e,i)}}}function pa(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,A,z=!n[3]&&hr(),_=x(Le),C=[];for(let h=0;h<_.length;h+=1)C[h]=br(_r(n,_,h));const j=h=>y(C[h],1,1,()=>{C[h]=null});return{c(){e=$("div"),r=$("button"),t=O("Done"),l=L(),i=$("button"),i.textContent="Delete link",a=L(),z&&z.c(),s=L(),u=$("label"),c=O(`Name:
      `),f=$("input"),d=L();for(let h=0;h<C.length;h+=1)C[h].c();r.disabled=o=!n[3],F(f,"type","text"),F(e,"slot","sidebar")},m(h,S){k(h,e,S),g(e,r),g(r,t),g(e,l),g(e,i),g(e,a),z&&z.m(e,null),g(e,s),g(e,u),g(u,c),g(u,f),ve(f,n[1].links[n[0]].properties.name),g(e,d);for(let v=0;v<C.length;v+=1)C[v]&&C[v].m(e,null);p=!0,m||(A=[G(r,"click",n[8]),G(i,"click",n[6]),G(f,"input",n[9])],m=!0)},p(h,S){if((!p||S&8&&o!==(o=!h[3]))&&(r.disabled=o),h[3]?z&&(z.d(1),z=null):z||(z=hr(),z.c(),z.m(e,s)),S&3&&f.value!==h[1].links[h[0]].properties.name&&ve(f,h[1].links[h[0]].properties.name),S&7){_=x(Le);let v;for(v=0;v<_.length;v+=1){const M=_r(h,_,v);C[v]?(C[v].p(M,S),b(C[v],1)):(C[v]=br(M),C[v].c(),b(C[v],1),C[v].m(e,null))}for(ue(),v=_.length;v<C.length;v+=1)j(v);fe()}},i(h){if(!p){for(let S=0;S<_.length;S+=1)b(C[S]);p=!0}},o(h){C=C.filter(Boolean);for(let S=0;S<C.length;S+=1)y(C[S]);p=!1},d(h){h&&w(e),z&&z.d(),ge(C,h),m=!1,je(A)}}}function ma(n){let e,r;return e=new Fe({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function ga(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"links"}}),o=new Ce({props:{data:me(n[1].links),generateId:!0,$$slots:{default:[ma]},$$scope:{ctx:n}}});function u(f){n[7](f)}let c={};return n[1].links[n[0]]!==void 0&&(c.f=n[1].links[n[0]]),i=new io({props:c}),pe.push(()=>ke(i,"f",u)),{c(){e=$("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){k(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].links)),d&65537&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};!a&&d&3&&(a=!0,m.f=f[1].links[f[0]],we(()=>a=!1)),i.$set(m)},i(f){s||(b(r.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&w(e),T(r),T(o),T(i)}}}function $r(n){let e,r;return e=new Pt({props:{$$slots:{default:[_a]},$$scope:{ctx:n}}}),e.$on("close",n[12]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&65540&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function _a(n){let e,r=n[2].description+"",t,o,l,i;return l=new ft({props:{metric:n[2]}}),{c(){e=$("p"),t=O(r),o=L(),B(l.$$.fragment)},m(a,s){k(a,e,s),g(e,t),k(a,o,s),E(l,a,s),i=!0},p(a,s){(!i||s&4)&&r!==(r=a[2].description+"")&&le(t,r);const u={};s&4&&(u.metric=a[2]),l.$set(u)},i(a){i||(b(l.$$.fragment,a),i=!0)},o(a){y(l.$$.fragment,a),i=!1},d(a){a&&(w(e),w(o)),T(l,a)}}}function ha(n){let e,r,t,o,l,i;e=new Pe({props:{$$slots:{map:[ga],sidebar:[pa]},$$scope:{ctx:n}}});let a=n[2]&&$r(n);return{c(){B(e.$$.fragment),r=L(),a&&a.c(),t=Qe()},m(s,u){E(e,s,u),k(s,r,u),a&&a.m(s,u),k(s,t,u),o=!0,l||(i=G(ua,"keydown",n[5]),l=!0)},p(s,[u]){const c={};u&65567&&(c.$$scope={dirty:u,ctx:s}),e.$set(c),s[2]?a?(a.p(s,u),u&4&&b(a,1)):(a=$r(s),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(ue(),y(a,1,1,()=>{a=null}),fe())},i(s){o||(b(e.$$.fragment,s),b(a),o=!0)},o(s){y(e.$$.fragment,s),y(a),o=!1},d(s){s&&(w(r),w(t)),T(e,s),a&&a.d(s),l=!1,i()}}}function ba(n,e,r){let t,o,l;ne(n,J,z=>r(1,o=z)),ne(n,W,z=>r(4,l=z));let{idx:i}=e,a=null;function s(z){z.key=="Escape"&&t&&K(W,l={kind:"neutral"},l)}async function u(){window.confirm("Really delete this link?")&&(K(W,l={kind:"neutral"},l),await nt(),o.links.splice(i,1),J.set(o))}function c(z){n.$$.not_equal(o.links[i],z)&&(o.links[i]=z,J.set(o))}const f=()=>K(W,l={kind:"neutral"},l);function d(){o.links[i].properties.name=this.value,J.set(o)}const p=z=>r(2,a=xe[z.name]);function m(z,_){n.$$.not_equal(o.links[i].properties.answers[_],z)&&(o.links[i].properties.answers[_]=z,J.set(o))}const A=()=>r(2,a=null);return n.$$set=z=>{"idx"in z&&r(0,i=z.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(3,t=o.links[i].geometry.coordinates.length>=2)},[i,o,a,t,l,s,u,c,f,d,p,m,A]}class $a extends se{constructor(e){super(),ae(this,e,ba,ha,ie,{idx:0})}}function kr(n,e,r){const t=n.slice();return t[7]=e[r],t[8]=e,t[9]=r,t}function ka(n){let e;return{c(){e=$("p"),e.textContent=`${n[3].description}`},m(r,t){k(r,e,t)},p:ee,d(r){r&&w(e)}}}function wr(n){let e,r,t=n[7].properties.name+"",o,l,i,a,s,u;function c(d){n[6](d,n[7])}let f={k:"horiz-radio",choices:Le[n[0]].choices};return n[7].properties.answers[n[0]]!==void 0&&(f.value=n[7].properties.answers[n[0]]),i=new Je({props:f}),pe.push(()=>ke(i,"value",c)),{c(){e=$("li"),r=$("span"),o=O(t),l=L(),B(i.$$.fragment),s=L(),Y(r,"color",n[7].properties.color)},m(d,p){k(d,e,p),g(e,r),g(r,o),g(e,l),E(i,e,null),g(e,s),u=!0},p(d,p){n=d,(!u||p&4)&&t!==(t=n[7].properties.name+"")&&le(o,t),p&4&&Y(r,"color",n[7].properties.color);const m={};p&1&&(m.choices=Le[n[0]].choices),!a&&p&5&&(a=!0,m.value=n[7].properties.answers[n[0]],we(()=>a=!1)),i.$set(m)},i(d){u||(b(i.$$.fragment,d),u=!0)},o(d){y(i.$$.fragment,d),u=!1},d(d){d&&w(e),T(i)}}}function wa(n){let e,r;return e=new ft({props:{metric:n[3]}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function va(n){let e,r,t,o,l=Le[n[0]].name+"",i,a,s=Le[n[0]].description+"",u,c,f,d,p,m,A,z,_=n[3]&&ka(n),C=x(n[2].links),j=[];for(let v=0;v<C.length;v+=1)j[v]=wr(kr(n,C,v));const h=v=>y(j[v],1,1,()=>{j[v]=null});let S=n[3]&&wa(n);return{c(){e=$("div"),r=$("button"),r.textContent="Done",t=L(),o=$("h2"),i=O(l),a=O(": "),u=O(s),c=L(),_&&_.c(),f=L(),d=$("ol");for(let v=0;v<j.length;v+=1)j[v].c();p=L(),S&&S.c(),F(e,"slot","sidebar")},m(v,M){k(v,e,M),g(e,r),g(e,t),g(e,o),g(o,i),g(o,a),g(o,u),g(e,c),_&&_.m(e,null),g(e,f),g(e,d);for(let I=0;I<j.length;I+=1)j[I]&&j[I].m(d,null);g(e,p),S&&S.m(e,null),m=!0,A||(z=G(r,"click",n[5]),A=!0)},p(v,M){if((!m||M&1)&&l!==(l=Le[v[0]].name+"")&&le(i,l),(!m||M&1)&&s!==(s=Le[v[0]].description+"")&&le(u,s),v[3]&&_.p(v,M),M&5){C=x(v[2].links);let I;for(I=0;I<C.length;I+=1){const q=kr(v,C,I);j[I]?(j[I].p(q,M),b(j[I],1)):(j[I]=wr(q),j[I].c(),b(j[I],1),j[I].m(d,null))}for(ue(),I=C.length;I<j.length;I+=1)h(I);fe()}v[3]&&S.p(v,M)},i(v){if(!m){for(let M=0;M<C.length;M+=1)b(j[M]);b(S),m=!0}},o(v){j=j.filter(Boolean);for(let M=0;M<j.length;M+=1)y(j[M]);y(S),m=!1},d(v){v&&w(e),_&&_.d(),ge(j,v),S&&S.d(),A=!1,z()}}}function ya(n){let e,r,t;return r=new We({props:{showColor:"links",except:""}}),{c(){e=$("div"),B(r.$$.fragment),F(e,"slot","map")},m(o,l){k(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&w(e),T(r)}}}function Aa(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[ya],sidebar:[va]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=G(window,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l),t=!1,o()}}}function Ca(n,e,r){let t,o;ne(n,W,c=>r(1,t=c)),ne(n,J,c=>r(2,o=c));let{qIdx:l}=e,i=xe[Le[l].name];function a(c){c.key=="Escape"&&K(W,t={kind:"neutral"},t)}const s=()=>K(W,t={kind:"neutral"},t);function u(c,f){n.$$.not_equal(f.properties.answers[l],c)&&(f.properties.answers[l]=c,J.set(o))}return n.$$set=c=>{"qIdx"in c&&r(0,l=c.qIdx)},[l,t,o,i,a,s,u]}class ja extends se{constructor(e){super(),ae(this,e,Ca,Aa,ie,{qIdx:0})}}function Sa(n){let e,r,t,o;const l=n[2].default,i=De(l,n,n[1],null);return{c(){e=$("a"),i&&i.c(),F(e,"href","#"),Y(e,"color",n[0])},m(a,s){k(a,e,s),i&&i.m(e,null),r=!0,t||(o=G(e,"click",Bo(n[3])),t=!0)},p(a,[s]){i&&i.p&&(!r||s&2)&&Ne(i,l,a,a[1],r?Oe(l,a[1],s,null):Ie(a[1]),null),s&1&&Y(e,"color",a[0])},i(a){r||(b(i,a),r=!0)},o(a){y(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),t=!1,o()}}}function za(n,e,r){let{$$slots:t={},$$scope:o}=e,{color:l=void 0}=e;function i(a){ze.call(this,n,a)}return n.$$set=a=>{"color"in a&&r(0,l=a.color),"$$scope"in a&&r(1,o=a.$$scope)},[l,o,t,i]}class et extends se{constructor(e){super(),ae(this,e,za,Sa,ie,{color:0})}}function vr(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function La(n){let e;return{c(){e=O(`ST20
  `)},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Ma(n){let e=n[5].properties.name+"",r;return{c(){r=O(e)},m(t,o){k(t,r,o)},p(t,o){o&2&&e!==(e=t[5].properties.name+"")&&le(r,e)},d(t){t&&w(r)}}}function yr(n){let e,r,t,o;function l(){return n[4](n[7])}return r=new et({props:{color:n[5].properties.color,$$slots:{default:[Ma]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=$("li"),B(r.$$.fragment),t=L()},m(i,a){k(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[5].properties.color),a&258&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){y(r.$$.fragment,i),o=!1},d(i){i&&w(e),T(r)}}}function Ba(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,A;i=new et({props:{$$slots:{default:[La]},$$scope:{ctx:n}}}),i.$on("click",n[3]);let z=x(n[1].bus_stops),_=[];for(let j=0;j<z.length;j+=1)_[j]=yr(vr(n,z,j));const C=j=>y(_[j],1,1,()=>{_[j]=null});return{c(){e=O(`Bus stops:

`),r=$("div"),t=$("button"),t.textContent="New bus stop",o=L(),l=$("div"),B(i.$$.fragment),a=O(`:
  `),s=$("progress"),f=L(),d=$("ol");for(let j=0;j<_.length;j+=1)_[j].c();s.value=u=n[1].bus_stops.filter(Ar).length,F(s,"max",c=n[1].bus_stops.length),F(s,"class","svelte-zadug4")},m(j,h){k(j,e,h),k(j,r,h),g(r,t),k(j,o,h),k(j,l,h),E(i,l,null),g(l,a),g(l,s),k(j,f,h),k(j,d,h);for(let S=0;S<_.length;S+=1)_[S]&&_[S].m(d,null);p=!0,m||(A=G(t,"click",n[2]),m=!0)},p(j,[h]){const S={};if(h&256&&(S.$$scope={dirty:h,ctx:j}),i.$set(S),(!p||h&2&&u!==(u=j[1].bus_stops.filter(Ar).length))&&(s.value=u),(!p||h&2&&c!==(c=j[1].bus_stops.length))&&F(s,"max",c),h&3){z=x(j[1].bus_stops);let v;for(v=0;v<z.length;v+=1){const M=vr(j,z,v);_[v]?(_[v].p(M,h),b(_[v],1)):(_[v]=yr(M),_[v].c(),b(_[v],1),_[v].m(d,null))}for(ue(),v=z.length;v<_.length;v+=1)C(v);fe()}},i(j){if(!p){b(i.$$.fragment,j);for(let h=0;h<z.length;h+=1)b(_[h]);p=!0}},o(j){y(i.$$.fragment,j),_=_.filter(Boolean);for(let h=0;h<_.length;h+=1)y(_[h]);p=!1},d(j){j&&(w(e),w(r),w(o),w(l),w(f),w(d)),T(i),ge(_,j),m=!1,A()}}}const Ar=n=>n.properties.st20!="";function Ea(n,e,r){let t,o;return ne(n,W,s=>r(0,t=s)),ne(n,J,s=>r(1,o=s)),[t,o,()=>K(W,t={kind:"new-point",obj:"bus stop"},t),()=>K(W,t={kind:"bus-stop-questions"},t),s=>K(W,t={kind:"edit-bus-stop",idx:s},t)]}let Ta=class extends se{constructor(e){super(),ae(this,e,Ea,Ba,ie,{})}};function Cr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Da(n){let e=n[4].properties.name+"",r;return{c(){r=O(e)},m(t,o){k(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&le(r,e)},d(t){t&&w(r)}}}function jr(n){let e,r,t,o;function l(){return n[3](n[6])}return r=new et({props:{color:n[4].properties.color,$$slots:{default:[Da]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=$("li"),B(r.$$.fragment),t=L()},m(i,a){k(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[4].properties.color),a&130&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){y(r.$$.fragment,i),o=!1},d(i){i&&w(e),T(r)}}}function Na(n){let e,r,t,o,l,i,a,s,u=x(n[1].crossings),c=[];for(let d=0;d<u.length;d+=1)c[d]=jr(Cr(n,u,d));const f=d=>y(c[d],1,1,()=>{c[d]=null});return{c(){e=O(`Crossings:

`),r=$("div"),t=$("button"),t.textContent="New crossing",o=L(),l=$("ol");for(let d=0;d<c.length;d+=1)c[d].c()},m(d,p){k(d,e,p),k(d,r,p),g(r,t),k(d,o,p),k(d,l,p);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(l,null);i=!0,a||(s=G(t,"click",n[2]),a=!0)},p(d,[p]){if(p&3){u=x(d[1].crossings);let m;for(m=0;m<u.length;m+=1){const A=Cr(d,u,m);c[m]?(c[m].p(A,p),b(c[m],1)):(c[m]=jr(A),c[m].c(),b(c[m],1),c[m].m(l,null))}for(ue(),m=u.length;m<c.length;m+=1)f(m);fe()}},i(d){if(!i){for(let p=0;p<u.length;p+=1)b(c[p]);i=!0}},o(d){c=c.filter(Boolean);for(let p=0;p<c.length;p+=1)y(c[p]);i=!1},d(d){d&&(w(e),w(r),w(o),w(l)),ge(c,d),a=!1,s()}}}function Ia(n,e,r){let t,o;return ne(n,W,a=>r(0,t=a)),ne(n,J,a=>r(1,o=a)),[t,o,()=>K(W,t={kind:"new-point",obj:"crossing"},t),a=>K(W,t={kind:"edit-crossing",idx:a},t)]}let Oa=class extends se{constructor(e){super(),ae(this,e,Ia,Na,ie,{})}};function Sr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Fa(n){let e=n[4].properties.name+"",r;return{c(){r=O(e)},m(t,o){k(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&le(r,e)},d(t){t&&w(r)}}}function zr(n){let e,r,t,o;function l(){return n[3](n[6])}return r=new et({props:{color:n[4].properties.color,$$slots:{default:[Fa]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=$("li"),B(r.$$.fragment),t=L()},m(i,a){k(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[4].properties.color),a&130&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){y(r.$$.fragment,i),o=!1},d(i){i&&w(e),T(r)}}}function qa(n){let e,r,t,o,l,i,a,s,u=x(n[1].jats),c=[];for(let d=0;d<u.length;d+=1)c[d]=zr(Sr(n,u,d));const f=d=>y(c[d],1,1,()=>{c[d]=null});return{c(){e=O(`JATs:

`),r=$("div"),t=$("button"),t.textContent="New JAT",o=L(),l=$("ol");for(let d=0;d<c.length;d+=1)c[d].c()},m(d,p){k(d,e,p),k(d,r,p),g(r,t),k(d,o,p),k(d,l,p);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(l,null);i=!0,a||(s=G(t,"click",n[2]),a=!0)},p(d,[p]){if(p&3){u=x(d[1].jats);let m;for(m=0;m<u.length;m+=1){const A=Sr(d,u,m);c[m]?(c[m].p(A,p),b(c[m],1)):(c[m]=zr(A),c[m].c(),b(c[m],1),c[m].m(l,null))}for(ue(),m=u.length;m<c.length;m+=1)f(m);fe()}},i(d){if(!i){for(let p=0;p<u.length;p+=1)b(c[p]);i=!0}},o(d){c=c.filter(Boolean);for(let p=0;p<c.length;p+=1)y(c[p]);i=!1},d(d){d&&(w(e),w(r),w(o),w(l)),ge(c,d),a=!1,s()}}}function Pa(n,e,r){let t,o;return ne(n,W,a=>r(0,t=a)),ne(n,J,a=>r(1,o=a)),[t,o,()=>K(W,t={kind:"new-point",obj:"jat"},t),a=>K(W,t={kind:"edit-jat",idx:a},t)]}let Ua=class extends se{constructor(e){super(),ae(this,e,Pa,qa,ie,{})}};function Lr(n,e,r){const t=n.slice();return t[2]=e[r],t[4]=r,t}function Mr(n,e,r){const t=n.slice();t[5]=e[r];const o=t[5].properties.answers[t[4]];return t[6]=o,t}function Br(n,e,r){const t=n.slice();return t[5]=e[r],t}function Er(n){let e,r=n[5].properties.name+"",t;return{c(){e=$("th"),t=O(r),Y(e,"color",n[5].properties.color)},m(o,l){k(o,e,l),g(e,t)},p(o,l){l&1&&r!==(r=o[5].properties.name+"")&&le(t,r),l&1&&Y(e,"color",o[5].properties.color)},d(o){o&&w(e)}}}function Tr(n){let e,r=n[6]+"",t;return{c(){e=$("td"),t=O(r),Y(e,"background",n[6]==""?"red":"green")},m(o,l){k(o,e,l),g(e,t)},p(o,l){l&1&&r!==(r=o[6]+"")&&le(t,r),l&1&&Y(e,"background",o[6]==""?"red":"green")},d(o){o&&w(e)}}}function Dr(n){let e,r,t,o,l=x(n[0].links),i=[];for(let a=0;a<l.length;a+=1)i[a]=Tr(Mr(n,l,a));return{c(){e=$("tr"),r=$("th"),r.textContent=`${n[2].name}`,t=L();for(let a=0;a<i.length;a+=1)i[a].c();o=L()},m(a,s){k(a,e,s),g(e,r),g(e,t);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);g(e,o)},p(a,s){if(s&1){l=x(a[0].links);let u;for(u=0;u<l.length;u+=1){const c=Mr(a,l,u);i[u]?i[u].p(c,s):(i[u]=Tr(c),i[u].c(),i[u].m(e,o))}for(;u<i.length;u+=1)i[u].d(1);i.length=l.length}},d(a){a&&w(e),ge(i,a)}}}function Ra(n){let e,r,t,o,l,i,a,s=x(n[0].links),u=[];for(let d=0;d<s.length;d+=1)u[d]=Er(Br(n,s,d));let c=x(Le),f=[];for(let d=0;d<c.length;d+=1)f[d]=Dr(Lr(n,c,d));return{c(){e=$("table"),r=$("thead"),t=$("tr"),o=$("th"),l=L();for(let d=0;d<u.length;d+=1)u[d].c();i=L(),a=$("tbody");for(let d=0;d<f.length;d+=1)f[d].c()},m(d,p){k(d,e,p),g(e,r),g(r,t),g(t,o),g(t,l);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(t,null);g(e,i),g(e,a);for(let m=0;m<f.length;m+=1)f[m]&&f[m].m(a,null)},p(d,p){if(p&1){s=x(d[0].links);let m;for(m=0;m<s.length;m+=1){const A=Br(d,s,m);u[m]?u[m].p(A,p):(u[m]=Er(A),u[m].c(),u[m].m(t,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=s.length}if(p&1){c=x(Le);let m;for(m=0;m<c.length;m+=1){const A=Lr(d,c,m);f[m]?f[m].p(A,p):(f[m]=Dr(A),f[m].c(),f[m].m(a,null))}for(;m<f.length;m+=1)f[m].d(1);f.length=c.length}},d(d){d&&w(e),ge(u,d),ge(f,d)}}}function Ga(n){let e,r;return e=new Pt({props:{$$slots:{default:[Ra]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,[o]){const l={};o&2049&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Ja(n,e,r){let t;ne(n,J,l=>r(0,t=l));function o(l){ze.call(this,n,l)}return[t,o]}class Qa extends se{constructor(e){super(),ae(this,e,Ja,Ga,ie,{})}}function Nr(n,e,r){const t=n.slice();return t[9]=e[r],t[11]=r,t}function Ir(n,e,r){const t=n.slice();return t[12]=e[r],t[11]=r,t}function Or(n){let e,r;return e=new Qa({}),e.$on("close",n[4]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Ha(n){let e=n[12].properties.name+"",r;return{c(){r=O(e)},m(t,o){k(t,r,o)},p(t,o){o&2&&e!==(e=t[12].properties.name+"")&&le(r,e)},d(t){t&&w(r)}}}function Fr(n){let e,r,t,o;function l(){return n[6](n[11])}return r=new et({props:{color:n[12].properties.color,$$slots:{default:[Ha]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=$("li"),B(r.$$.fragment),t=L()},m(i,a){k(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[12].properties.color),a&16386&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){y(r.$$.fragment,i),o=!1},d(i){i&&w(e),T(r)}}}function Ka(n){let e=n[9].name+"",r,t;return{c(){r=O(e),t=L()},m(o,l){k(o,r,l),k(o,t,l)},p:ee,d(o){o&&(w(r),w(t))}}}function qr(n){let e,r,t,o,l,i,a,s;function u(){return n[7](n[11])}r=new et({props:{$$slots:{default:[Ka]},$$scope:{ctx:n}}}),r.$on("click",u);function c(...f){return n[8](n[11],...f)}return{c(){e=$("li"),B(r.$$.fragment),t=O(`:
      `),o=$("progress"),a=L(),o.value=l=n[1].links.filter(c).length,F(o,"max",i=n[1].links.length),F(o,"class","svelte-zadug4")},m(f,d){k(f,e,d),E(r,e,null),g(e,t),g(e,o),g(e,a),s=!0},p(f,d){n=f;const p={};d&16384&&(p.$$scope={dirty:d,ctx:n}),r.$set(p),(!s||d&2&&l!==(l=n[1].links.filter(c).length))&&(o.value=l),(!s||d&2&&i!==(i=n[1].links.length))&&F(o,"max",i)},i(f){s||(b(r.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),s=!1},d(f){f&&w(e),T(r)}}}function Wa(n){let e,r,t,o,l,i,a,s,u,c,f,d,p=n[0]&&Or(n),m=x(n[1].links),A=[];for(let h=0;h<m.length;h+=1)A[h]=Fr(Ir(n,m,h));const z=h=>y(A[h],1,1,()=>{A[h]=null});let _=x(Le),C=[];for(let h=0;h<_.length;h+=1)C[h]=qr(Nr(n,_,h));const j=h=>y(C[h],1,1,()=>{C[h]=null});return{c(){p&&p.c(),e=L(),r=$("div"),t=$("button"),t.textContent="New link",o=L(),l=$("button"),l.textContent="Table of questions",i=O(`

Links:
`),a=$("ol");for(let h=0;h<A.length;h+=1)A[h].c();s=O(`

Questions:
`),u=$("ol");for(let h=0;h<C.length;h+=1)C[h].c()},m(h,S){p&&p.m(h,S),k(h,e,S),k(h,r,S),g(r,t),g(r,o),g(r,l),k(h,i,S),k(h,a,S);for(let v=0;v<A.length;v+=1)A[v]&&A[v].m(a,null);k(h,s,S),k(h,u,S);for(let v=0;v<C.length;v+=1)C[v]&&C[v].m(u,null);c=!0,f||(d=[G(t,"click",n[3]),G(l,"click",n[5])],f=!0)},p(h,[S]){if(h[0]?p?(p.p(h,S),S&1&&b(p,1)):(p=Or(h),p.c(),b(p,1),p.m(e.parentNode,e)):p&&(ue(),y(p,1,1,()=>{p=null}),fe()),S&6){m=x(h[1].links);let v;for(v=0;v<m.length;v+=1){const M=Ir(h,m,v);A[v]?(A[v].p(M,S),b(A[v],1)):(A[v]=Fr(M),A[v].c(),b(A[v],1),A[v].m(a,null))}for(ue(),v=m.length;v<A.length;v+=1)z(v);fe()}if(S&6){_=x(Le);let v;for(v=0;v<_.length;v+=1){const M=Nr(h,_,v);C[v]?(C[v].p(M,S),b(C[v],1)):(C[v]=qr(M),C[v].c(),b(C[v],1),C[v].m(u,null))}for(ue(),v=_.length;v<C.length;v+=1)j(v);fe()}},i(h){if(!c){b(p);for(let S=0;S<m.length;S+=1)b(A[S]);for(let S=0;S<_.length;S+=1)b(C[S]);c=!0}},o(h){y(p),A=A.filter(Boolean);for(let S=0;S<A.length;S+=1)y(A[S]);C=C.filter(Boolean);for(let S=0;S<C.length;S+=1)y(C[S]);c=!1},d(h){h&&(w(e),w(r),w(i),w(a),w(s),w(u)),p&&p.d(h),ge(A,h),ge(C,h),f=!1,je(d)}}}function Za(n,e,r){let t,o;ne(n,J,d=>r(1,t=d)),ne(n,W,d=>r(2,o=d));let l=!1;function i(){let d=no(t.links.length);K(J,t.links=[...t.links,d],t),K(W,o={kind:"edit-link",idx:t.links.length-1},o)}return[l,t,o,i,()=>r(0,l=!1),()=>r(0,l=!0),d=>K(W,o={kind:"edit-link",idx:d},o),d=>K(W,o={kind:"link-questions",idx:d},o),(d,p)=>p.properties.answers[d]!=""]}let Xa=class extends se{constructor(e){super(),ae(this,e,Za,Wa,ie,{})}};function Va(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled side road",color:qe[n%qe.length],sa01:""}}}function Pr(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function Ya(n){let e;return{c(){e=O(`SA01
  `)},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function xa(n){let e=n[5].properties.name+"",r;return{c(){r=O(e)},m(t,o){k(t,r,o)},p(t,o){o&1&&e!==(e=t[5].properties.name+"")&&le(r,e)},d(t){t&&w(r)}}}function Ur(n){let e,r,t,o;function l(){return n[4](n[7])}return r=new et({props:{color:n[5].properties.color,$$slots:{default:[xa]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=$("li"),B(r.$$.fragment),t=L()},m(i,a){k(i,e,a),E(r,e,null),g(e,t),o=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){y(r.$$.fragment,i),o=!1},d(i){i&&w(e),T(r)}}}function ec(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,A;i=new et({props:{$$slots:{default:[Ya]},$$scope:{ctx:n}}}),i.$on("click",n[3]);let z=x(n[0].side_roads),_=[];for(let j=0;j<z.length;j+=1)_[j]=Ur(Pr(n,z,j));const C=j=>y(_[j],1,1,()=>{_[j]=null});return{c(){e=O(`Side roads:

`),r=$("div"),t=$("button"),t.textContent="New side road",o=L(),l=$("div"),B(i.$$.fragment),a=O(`:
  `),s=$("progress"),f=L(),d=$("ol");for(let j=0;j<_.length;j+=1)_[j].c();s.value=u=n[0].side_roads.filter(Rr).length,F(s,"max",c=n[0].side_roads.length),F(s,"class","svelte-zadug4")},m(j,h){k(j,e,h),k(j,r,h),g(r,t),k(j,o,h),k(j,l,h),E(i,l,null),g(l,a),g(l,s),k(j,f,h),k(j,d,h);for(let S=0;S<_.length;S+=1)_[S]&&_[S].m(d,null);p=!0,m||(A=G(t,"click",n[2]),m=!0)},p(j,[h]){const S={};if(h&256&&(S.$$scope={dirty:h,ctx:j}),i.$set(S),(!p||h&1&&u!==(u=j[0].side_roads.filter(Rr).length))&&(s.value=u),(!p||h&1&&c!==(c=j[0].side_roads.length))&&F(s,"max",c),h&3){z=x(j[0].side_roads);let v;for(v=0;v<z.length;v+=1){const M=Pr(j,z,v);_[v]?(_[v].p(M,h),b(_[v],1)):(_[v]=Ur(M),_[v].c(),b(_[v],1),_[v].m(d,null))}for(ue(),v=z.length;v<_.length;v+=1)C(v);fe()}},i(j){if(!p){b(i.$$.fragment,j);for(let h=0;h<z.length;h+=1)b(_[h]);p=!0}},o(j){y(i.$$.fragment,j),_=_.filter(Boolean);for(let h=0;h<_.length;h+=1)y(_[h]);p=!1},d(j){j&&(w(e),w(r),w(o),w(l),w(f),w(d)),T(i),ge(_,j),m=!1,A()}}}const Rr=n=>n.properties.sa01!="";function tc(n,e,r){let t,o;ne(n,J,s=>r(0,t=s)),ne(n,W,s=>r(1,o=s));function l(){let s=Va(t.side_roads.length);K(J,t.side_roads=[...t.side_roads,s],t),K(W,o={kind:"edit-side-road",idx:t.side_roads.length-1},o)}return[t,o,l,()=>K(W,o={kind:"side-road-questions"},o),s=>K(W,o={kind:"edit-side-road",idx:s},o)]}class nc extends se{constructor(e){super(),ae(this,e,tc,ec,ie,{})}}function rc(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,A,z,_,C,j,h,S,v,M,I,q,Z,V,D,Q,N,_e,he;return p=new Xa({}),_=new Ua({}),S=new Ta({}),q=new Oa({}),Q=new nc({}),{c(){e=$("div"),r=$("div"),t=$("button"),t.textContent="Load file",o=L(),l=$("button"),l.textContent="Download",i=L(),a=$("button"),a.textContent="Clear",s=L(),u=$("button"),u.textContent="Draw an entire route",c=L(),f=$("hr"),d=L(),B(p.$$.fragment),m=L(),A=$("hr"),z=L(),B(_.$$.fragment),C=L(),j=$("hr"),h=L(),B(S.$$.fragment),v=L(),M=$("hr"),I=L(),B(q.$$.fragment),Z=L(),V=$("hr"),D=L(),B(Q.$$.fragment),F(t,"class","secondary"),F(l,"class","secondary"),F(a,"class","secondary"),F(e,"slot","sidebar")},m(P,X){k(P,e,X),g(e,r),g(r,t),g(r,o),g(r,l),g(r,i),g(r,a),g(e,s),g(e,u),g(e,c),g(e,f),g(e,d),E(p,e,null),g(e,m),g(e,A),g(e,z),E(_,e,null),g(e,C),g(e,j),g(e,h),E(S,e,null),g(e,v),g(e,M),g(e,I),E(q,e,null),g(e,Z),g(e,V),g(e,D),E(Q,e,null),N=!0,_e||(he=[G(t,"click",n[12]),G(l,"click",n[13]),G(a,"click",n[5]),G(u,"click",n[6])],_e=!0)},p:ee,i(P){N||(b(p.$$.fragment,P),b(_.$$.fragment,P),b(S.$$.fragment,P),b(q.$$.fragment,P),b(Q.$$.fragment,P),N=!0)},o(P){y(p.$$.fragment,P),y(_.$$.fragment,P),y(S.$$.fragment,P),y(q.$$.fragment,P),y(Q.$$.fragment,P),N=!1},d(P){P&&w(e),T(p),T(_),T(S),T(q),T(Q),_e=!1,je(he)}}}function oc(n){let e,r;return e=new Fe({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":kt(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[7]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function lc(n){let e,r;return e=new rt({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":kt(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[8]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function ic(n){let e,r;return e=new ot({props:{manageHoverState:!0,layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[9]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function sc(n){let e,r;return e=new ot({props:{manageHoverState:!0,layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[10]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function ac(n){let e,r;return e=new Fe({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":kt(3,6)},hoverCursor:"pointer"}}),e.$on("click",n[11]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function cc(n){let e,r,t,o,l,i,a,s,u,c,f;return r=new Ce({props:{data:me(n[2].links),generateId:!0,$$slots:{default:[oc]},$$scope:{ctx:n}}}),o=new Ce({props:{data:me(n[2].jats),generateId:!0,$$slots:{default:[lc]},$$scope:{ctx:n}}}),i=new Ce({props:{data:me(n[2].bus_stops),generateId:!0,$$slots:{default:[ic]},$$scope:{ctx:n}}}),s=new Ce({props:{data:me(n[2].crossings),generateId:!0,$$slots:{default:[sc]},$$scope:{ctx:n}}}),c=new Ce({props:{data:me(n[2].side_roads),generateId:!0,$$slots:{default:[ac]},$$scope:{ctx:n}}}),{c(){e=$("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),a=L(),B(s.$$.fragment),u=L(),B(c.$$.fragment),F(e,"slot","map")},m(d,p){k(d,e,p),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),g(e,a),E(s,e,null),g(e,u),E(c,e,null),f=!0},p(d,p){const m={};p&4&&(m.data=me(d[2].links)),p&131080&&(m.$$scope={dirty:p,ctx:d}),r.$set(m);const A={};p&4&&(A.data=me(d[2].jats)),p&131080&&(A.$$scope={dirty:p,ctx:d}),o.$set(A);const z={};p&4&&(z.data=me(d[2].bus_stops)),p&131080&&(z.$$scope={dirty:p,ctx:d}),i.$set(z);const _={};p&4&&(_.data=me(d[2].crossings)),p&131080&&(_.$$scope={dirty:p,ctx:d}),s.$set(_);const C={};p&4&&(C.data=me(d[2].side_roads)),p&131080&&(C.$$scope={dirty:p,ctx:d}),c.$set(C)},i(d){f||(b(r.$$.fragment,d),b(o.$$.fragment,d),b(i.$$.fragment,d),b(s.$$.fragment,d),b(c.$$.fragment,d),f=!0)},o(d){y(r.$$.fragment,d),y(o.$$.fragment,d),y(i.$$.fragment,d),y(s.$$.fragment,d),y(c.$$.fragment,d),f=!1},d(d){d&&w(e),T(r),T(o),T(i),T(s),T(c)}}}function Gr(n){let e,r;return e=new Pt({props:{$$slots:{default:[uc]},$$scope:{ctx:n}}}),e.$on("close",n[15]),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&131074&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function uc(n){let e,r,t,o,l;return{c(){e=$("h1"),e.textContent="Load a file previously downloaded from this tool",r=L(),t=$("input"),F(t,"type","file")},m(i,a){k(i,e,a),k(i,r,a),k(i,t,a),n[14](t),o||(l=G(t,"change",n[4]),o=!0)},p:ee,d(i){i&&(w(e),w(r),w(t)),n[14](null),o=!1,l()}}}function fc(n){let e,r,t,o;e=new Pe({props:{$$slots:{map:[cc],sidebar:[rc]},$$scope:{ctx:n}}});let l=n[0]&&Gr(n);return{c(){B(e.$$.fragment),r=L(),l&&l.c(),t=Qe()},m(i,a){E(e,i,a),k(i,r,a),l&&l.m(i,a),k(i,t,a),o=!0},p(i,[a]){const s={};a&131085&&(s.$$scope={dirty:a,ctx:i}),e.$set(s),i[0]?l?(l.p(i,a),a&1&&b(l,1)):(l=Gr(i),l.c(),b(l,1),l.m(t.parentNode,t)):l&&(ue(),y(l,1,1,()=>{l=null}),fe())},i(i){o||(b(e.$$.fragment,i),b(l),o=!0)},o(i){y(e.$$.fragment,i),y(l),o=!1},d(i){i&&(w(r),w(t)),T(e,i),l&&l.d(i)}}}function dc(n,e,r){let t,o,l;ne(n,Nt,h=>r(16,t=h)),ne(n,J,h=>r(2,o=h)),ne(n,W,h=>r(3,l=h));let i=!1,a;async function s(h){try{let S=JSON.parse(await a.files[0].text());if(xr(S)){K(J,o=S,o),r(0,i=!1);return}}catch{}window.alert("Something's wrong with that file")}function u(){K(J,o.links=[],o),K(J,o.jats=[],o),K(J,o.bus_stops=[],o),K(J,o.crossings=[],o),K(J,o.side_roads=[],o)}async function c(){await yi(t)}const f=h=>K(W,l={kind:"edit-link",idx:h.detail.features[0].id},l),d=h=>K(W,l={kind:"edit-jat",idx:h.detail.features[0].id},l),p=h=>K(W,l={kind:"edit-bus-stop",idx:h.detail.features[0].id},l),m=h=>K(W,l={kind:"edit-crossing",idx:h.detail.features[0].id},l),A=h=>K(W,l={kind:"edit-side-road",idx:h.detail.features[0].id},l),z=()=>r(0,i=!0),_=()=>ql("rcv2.geojson",JSON.stringify(o));function C(h){pe[h?"unshift":"push"](()=>{a=h,r(1,a)})}return[i,a,o,l,s,u,c,f,d,p,m,A,z,_,C,()=>r(0,i=!1)]}class pc extends se{constructor(e){super(),ae(this,e,dc,fc,ie,{})}}function mc(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:qe[n%qe.length],st20:""}}}function gc(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:qe[n%qe.length],sa10:""}}}function _c(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:qe[n%qe.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function hc(n){let e,r,t,o,l,i,a,s;return{c(){e=$("div"),r=$("h1"),t=O("Click map to create new "),o=O(n[0]),l=L(),i=$("button"),i.textContent="Cancel",F(e,"slot","sidebar")},m(u,c){k(u,e,c),g(e,r),g(r,t),g(r,o),g(e,l),g(e,i),a||(s=G(i,"click",n[3]),a=!0)},p(u,c){c&1&&le(o,u[0])},d(u){u&&w(e),a=!1,s()}}}function bc(n){let e,r,t;return r=new We({props:{except:""}}),{c(){e=$("div"),B(r.$$.fragment),F(e,"slot","map")},m(o,l){k(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&w(e),T(r)}}}function $c(n){let e,r,t,o;return e=new qt({}),e.$on("click",n[2]),t=new Pe({props:{$$slots:{map:[bc],sidebar:[hc]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=L(),B(t.$$.fragment)},m(l,i){E(e,l,i),k(l,r,i),E(t,l,i),o=!0},p(l,[i]){const a={};i&35&&(a.$$scope={dirty:i,ctx:l}),t.$set(a)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&w(r),T(e,l),T(t,l)}}}function kc(n,e,r){let t,o;ne(n,J,s=>r(4,t=s)),ne(n,W,s=>r(1,o=s));let{obj:l}=e;function i(s){let u=s.detail.lngLat.toArray();if(l=="jat"){let c=_c(t.jats.length,u);K(J,t.jats=[...t.jats,c],t),K(W,o={kind:"edit-jat",idx:t.jats.length-1},o)}else if(l=="crossing"){let c=gc(t.crossings.length,u);K(J,t.crossings=[...t.crossings,c],t),K(W,o={kind:"edit-crossing",idx:t.crossings.length-1},o)}else if(l=="bus stop"){let c=mc(t.bus_stops.length,u);K(J,t.bus_stops=[...t.bus_stops,c],t),K(W,o={kind:"edit-bus-stop",idx:t.bus_stops.length-1},o)}}const a=()=>K(W,o={kind:"neutral"},o);return n.$$set=s=>{"obj"in s&&r(0,l=s.obj)},[l,o,i,a]}class wc extends se{constructor(e){super(),ae(this,e,kc,$c,ie,{obj:0})}}const{window:vc}=ut;function Jr(n){let e;return{c(){e=$("p"),e.textContent="A side road needs at least two points"},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function yc(n){let e;return{c(){e=O("SA01: conflict at side roads and priority junctions")},m(r,t){k(r,e,t)},d(r){r&&w(e)}}}function Ac(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m,A,z,_,C,j,h,S,v=!n[2]&&Jr();function M(q){n[10](q)}let I={k:"horiz-radio",choices:Se(),$$slots:{default:[yc]},$$scope:{ctx:n}};return n[1].side_roads[n[0]].properties.sa01!==void 0&&(I.value=n[1].side_roads[n[0]].properties.sa01),p=new Je({props:I}),pe.push(()=>ke(p,"value",M)),C=new ft({props:{metric:n[4]}}),{c(){e=$("div"),r=$("button"),t=O("Done"),l=L(),i=$("button"),i.textContent="Delete side road",a=L(),v&&v.c(),s=L(),u=$("label"),c=O(`Name:
      `),f=$("input"),d=L(),B(p.$$.fragment),A=L(),z=$("p"),z.textContent=`${n[4].description}`,_=L(),B(C.$$.fragment),r.disabled=o=!n[2],F(f,"type","text"),F(e,"slot","sidebar")},m(q,Z){k(q,e,Z),g(e,r),g(r,t),g(e,l),g(e,i),g(e,a),v&&v.m(e,null),g(e,s),g(e,u),g(u,c),g(u,f),ve(f,n[1].side_roads[n[0]].properties.name),g(e,d),E(p,e,null),g(e,A),g(e,z),g(e,_),E(C,e,null),j=!0,h||(S=[G(r,"click",n[8]),G(i,"click",n[6]),G(f,"input",n[9])],h=!0)},p(q,Z){(!j||Z&4&&o!==(o=!q[2]))&&(r.disabled=o),q[2]?v&&(v.d(1),v=null):v||(v=Jr(),v.c(),v.m(e,s)),Z&3&&f.value!==q[1].side_roads[q[0]].properties.name&&ve(f,q[1].side_roads[q[0]].properties.name);const V={};Z&2048&&(V.$$scope={dirty:Z,ctx:q}),!m&&Z&3&&(m=!0,V.value=q[1].side_roads[q[0]].properties.sa01,we(()=>m=!1)),p.$set(V)},i(q){j||(b(p.$$.fragment,q),b(C.$$.fragment,q),j=!0)},o(q){y(p.$$.fragment,q),y(C.$$.fragment,q),j=!1},d(q){q&&w(e),v&&v.d(),T(p),T(C),h=!1,je(S)}}}function Cc(n){let e,r;return e=new Fe({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":3}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":3}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function jc(n){let e,r,t,o,l,i,a,s;r=new We({props:{except:"side_roads"}}),o=new Ce({props:{data:me(n[1].side_roads),generateId:!0,$$slots:{default:[Cc]},$$scope:{ctx:n}}});function u(f){n[7](f)}let c={};return n[1].side_roads[n[0]]!==void 0&&(c.f=n[1].side_roads[n[0]]),i=new io({props:c}),pe.push(()=>ke(i,"f",u)),{c(){e=$("div"),B(r.$$.fragment),t=L(),B(o.$$.fragment),l=L(),B(i.$$.fragment),F(e,"slot","map")},m(f,d){k(f,e,d),E(r,e,null),g(e,t),E(o,e,null),g(e,l),E(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=me(f[1].side_roads)),d&2049&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};!a&&d&3&&(a=!0,m.f=f[1].side_roads[f[0]],we(()=>a=!1)),i.$set(m)},i(f){s||(b(r.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&w(e),T(r),T(o),T(i)}}}function Sc(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[jc],sidebar:[Ac]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=G(vc,"keydown",n[5]),t=!0)},p(l,[i]){const a={};i&2063&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l),t=!1,o()}}}function zc(n,e,r){let t,o,l;ne(n,J,m=>r(1,o=m)),ne(n,W,m=>r(3,l=m));let{idx:i}=e,a=xe.SA01;function s(m){m.key=="Escape"&&K(W,l={kind:"neutral"},l)}async function u(){window.confirm("Really delete this side road?")&&(K(W,l={kind:"neutral"},l),await nt(),o.side_roads.splice(i,1),J.set(o))}function c(m){n.$$.not_equal(o.side_roads[i],m)&&(o.side_roads[i]=m,J.set(o))}const f=()=>K(W,l={kind:"neutral"},l);function d(){o.side_roads[i].properties.name=this.value,J.set(o)}function p(m){n.$$.not_equal(o.side_roads[i].properties.sa01,m)&&(o.side_roads[i].properties.sa01=m,J.set(o))}return n.$$set=m=>{"idx"in m&&r(0,i=m.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(2,t=o.side_roads[i].geometry.coordinates.length>=2)},[i,o,t,l,a,s,u,c,f,d,p]}class Lc extends se{constructor(e){super(),ae(this,e,zc,Sc,ie,{idx:0})}}function Qr(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function Hr(n){let e,r,t=n[6].properties.name+"",o,l,i,a,s,u;function c(d){n[5](d,n[6])}let f={k:"horiz-radio",choices:Se()};return n[6].properties.sa01!==void 0&&(f.value=n[6].properties.sa01),i=new Je({props:f}),pe.push(()=>ke(i,"value",c)),{c(){e=$("li"),r=$("span"),o=O(t),l=L(),B(i.$$.fragment),s=L(),Y(r,"color",n[6].properties.color)},m(d,p){k(d,e,p),g(e,r),g(r,o),g(e,l),E(i,e,null),g(e,s),u=!0},p(d,p){n=d,(!u||p&2)&&t!==(t=n[6].properties.name+"")&&le(o,t),p&2&&Y(r,"color",n[6].properties.color);const m={};!a&&p&2&&(a=!0,m.value=n[6].properties.sa01,we(()=>a=!1)),i.$set(m)},i(d){u||(b(i.$$.fragment,d),u=!0)},o(d){y(i.$$.fragment,d),u=!1},d(d){d&&w(e),T(i)}}}function Mc(n){let e,r,t,o,l,i,a,s,u,c,f,d,p,m=x(n[1].side_roads),A=[];for(let _=0;_<m.length;_+=1)A[_]=Hr(Qr(n,m,_));const z=_=>y(A[_],1,1,()=>{A[_]=null});return c=new ft({props:{metric:n[2]}}),{c(){e=$("div"),r=$("button"),r.textContent="Done",t=L(),o=$("h2"),o.textContent="SA01: Conflict at Side ROads and Priority Junctions",l=L(),i=$("p"),i.textContent=`${n[2].description}`,a=L(),s=$("ol");for(let _=0;_<A.length;_+=1)A[_].c();u=L(),B(c.$$.fragment),F(e,"slot","sidebar")},m(_,C){k(_,e,C),g(e,r),g(e,t),g(e,o),g(e,l),g(e,i),g(e,a),g(e,s);for(let j=0;j<A.length;j+=1)A[j]&&A[j].m(s,null);g(e,u),E(c,e,null),f=!0,d||(p=G(r,"click",n[4]),d=!0)},p(_,C){if(C&2){m=x(_[1].side_roads);let j;for(j=0;j<m.length;j+=1){const h=Qr(_,m,j);A[j]?(A[j].p(h,C),b(A[j],1)):(A[j]=Hr(h),A[j].c(),b(A[j],1),A[j].m(s,null))}for(ue(),j=m.length;j<A.length;j+=1)z(j);fe()}},i(_){if(!f){for(let C=0;C<m.length;C+=1)b(A[C]);b(c.$$.fragment,_),f=!0}},o(_){A=A.filter(Boolean);for(let C=0;C<A.length;C+=1)y(A[C]);y(c.$$.fragment,_),f=!1},d(_){_&&w(e),ge(A,_),T(c),d=!1,p()}}}function Bc(n){let e,r,t;return r=new We({props:{showColor:"side_roads",except:""}}),{c(){e=$("div"),B(r.$$.fragment),F(e,"slot","map")},m(o,l){k(o,e,l),E(r,e,null),t=!0},p:ee,i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&w(e),T(r)}}}function Ec(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Bc],sidebar:[Mc]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){E(e,l,i),r=!0,t||(o=G(window,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){T(e,l),t=!1,o()}}}function Tc(n,e,r){let t,o;ne(n,W,u=>r(0,t=u)),ne(n,J,u=>r(1,o=u));let l=xe.SA01;function i(u){u.key=="Escape"&&K(W,t={kind:"neutral"},t)}const a=()=>K(W,t={kind:"neutral"},t);function s(u,c){n.$$.not_equal(c.properties.sa01,u)&&(c.properties.sa01=u,J.set(o))}return[t,o,l,i,a,s]}class Dc extends se{constructor(e){super(),ae(this,e,Tc,Ec,ie,{})}}function Nc(n){let e,r;return{c(){e=$("div"),r=$("div"),F(e,"slot","left")},m(t,o){k(t,e,o),g(e,r),n[10](r)},p:ee,d(t){t&&w(e),n[10](null)}}}function Ic(n){return{c:ee,m:ee,p:ee,i:ee,o:ee,d:ee}}function Oc(n){let e,r,t;function o(i){n[9](i)}let l={style:n[11],standardControls:!0,hash:!0,images:[{id:"bus_stop",url:Vr,options:{sdf:!0}},{id:"crossing",url:Yr,options:{sdf:!0}}],$$slots:{default:[Xc]},$$scope:{ctx:n}};return n[2]!==void 0&&(l.map=n[2]),e=new To({props:l}),pe.push(()=>ke(e,"map",o)),{c(){B(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,a){const s={};a&4110&&(s.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,s.map=i[2],we(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){T(e,i)}}}function Fc(n){let e,r;return e=new Fi({props:{map:n[2],editingExisting:!1,finish:Ai,cancel:n[8]}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.map=t[2]),o&8&&(l.cancel=t[8]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function qc(n){let e,r;return e=new gl({}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Pc(n){let e,r;return e=new Dc({}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Uc(n){let e,r;return e=new ja({props:{qIdx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.qIdx=t[3].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Rc(n){let e,r;return e=new Lc({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Gc(n){let e,r;return e=new pi({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Jc(n){let e,r;return e=new Sl({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Qc(n){let e,r;return e=new xs({props:{junctionIdx:n[3].idx,stage:n[3].stage}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.junctionIdx=t[3].idx),o&8&&(l.stage=t[3].stage),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Hc(n){let e,r;return e=new ia({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Kc(n){let e,r;return e=new $a({props:{idx:n[3].idx}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Wc(n){let e,r;return e=new wc({props:{obj:n[3].obj}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.obj=t[3].obj),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Zc(n){let e,r;return e=new pc({}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function Xc(n){let e,r,t,o,l,i,a;const s=[Zc,Wc,Kc,Hc,Qc,Jc,Gc,Rc,Uc,Pc,qc,Fc],u=[];function c(f,d){return f[3].kind=="neutral"?0:f[3].kind=="new-point"?1:f[3].kind=="edit-link"?2:f[3].kind=="edit-jat"?3:f[3].kind=="edit-jat-detail"?4:f[3].kind=="edit-bus-stop"?5:f[3].kind=="edit-crossing"?6:f[3].kind=="edit-side-road"?7:f[3].kind=="link-questions"?8:f[3].kind=="side-road-questions"?9:f[3].kind=="bus-stop-questions"?10:f[3].kind=="draw-route"&&f[2]?11:-1}return~(t=c(n))&&(o=u[t]=s[t](n)),i=new oi({}),{c(){e=$("div"),r=L(),o&&o.c(),l=L(),B(i.$$.fragment)},m(f,d){k(f,e,d),n[7](e),k(f,r,d),~t&&u[t].m(f,d),k(f,l,d),E(i,f,d),a=!0},p(f,d){let p=t;t=c(f),t===p?~t&&u[t].p(f,d):(o&&(ue(),y(u[p],1,1,()=>{u[p]=null}),fe()),~t?(o=u[t],o?o.p(f,d):(o=u[t]=s[t](f),o.c()),b(o,1),o.m(l.parentNode,l)):o=null)},i(f){a||(b(o),b(i.$$.fragment,f),a=!0)},o(f){y(o),y(i.$$.fragment,f),a=!1},d(f){f&&(w(e),w(r),w(l)),n[7](null),~t&&u[t].d(f),T(i,f)}}}function Vc(n){return{c:ee,m:ee,p:ee,i:ee,o:ee,d:ee}}function Yc(n){let e,r,t={ctx:n,current:null,token:null,hasCatch:!1,pending:Vc,then:Oc,catch:Ic,value:11,blocks:[,,,]};return Do(qi(new URLSearchParams(window.location.search).get("google")||""),t),{c(){e=$("div"),t.block.c(),F(e,"slot","main"),Y(e,"position","relative"),Y(e,"width","100%"),Y(e,"height","100vh")},m(o,l){k(o,e,l),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,r=!0},p(o,l){n=o,No(t,n,l)},i(o){r||(b(t.block),r=!0)},o(o){for(let l=0;l<3;l+=1){const i=t.blocks[l];y(i)}r=!1},d(o){o&&w(e),t.block.d(),t.token=null,t=null}}}function xc(n){let e,r;return e=new Eo({props:{$$slots:{main:[Yc],left:[Nc]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){E(e,t,o),r=!0},p(t,[o]){const l={};o&4111&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function eu(n,e,r){let t,o,l,i,a;ne(n,Zt,m=>r(4,t=m)),ne(n,Wt,m=>r(5,o=m)),ne(n,J,m=>r(6,l=m)),ne(n,Nt,m=>r(2,i=m)),ne(n,W,m=>r(3,a=m));let s,u;function c(m){pe[m?"unshift":"push"](()=>{u=m,r(1,u),r(4,t)})}const f=()=>K(W,a={kind:"neutral"},a);function d(m){i=m,Nt.set(i)}function p(m){pe[m?"unshift":"push"](()=>{s=m,r(0,s),r(5,o)})}return n.$$.update=()=>{n.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(l)),n.$$.dirty&33&&s&&o&&(r(0,s.innerHTML="",s),s.appendChild(o)),n.$$.dirty&18&&u&&t&&(r(1,u.innerHTML="",u),u.appendChild(t))},[s,u,i,a,t,o,l,c,f,d,p]}class tu extends se{constructor(e){super(),ae(this,e,eu,xc,ie,{})}}new tu({target:document.getElementById("app")});
