import{V as Fn,W as Bn,X as Qe,r as $e,e as C,v as ke,t as b,Y as Jn,S as pe,i as _e,s as ge,Z as zn,_ as Rn,$ as oe,a0 as Hn,L as Gn,b as be,a as Me,c as P,m as O,d as Ie,f as F,g as Un,h as Be,u as Je,j as ze,k as Re,l as Ae,y as h,z as A,q as v,w,a1 as Ve,G as Se,E as Ee,B as re,D as He,Q as W,a2 as nt,o as Q,F as Z,A as z,a3 as pt,O as d,N as de,a4 as Ge,x as ae,R as Le,M as Pe,a5 as te,a6 as Ke,a7 as _t,U as ee,a8 as ut,a9 as ht,H as ie,p as lt,K as rt,aa as Zn,ab as at,ac as Kn,C as Xe,P as In,ad as Xn,I as Wn,T as Vn}from"./Layout-4695594c.js";function Qn(t,e){const l=e.token={};function n(r,o,i,a){if(e.token!==l)return;e.resolved=a;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=a);const u=r&&(e.current=r)(s);let c=!1;e.block&&(e.blocks?e.blocks.forEach((m,p)=>{p!==o&&m&&($e(),C(m,1,1,()=>{e.blocks[p]===m&&(e.blocks[p]=null)}),ke())}):e.block.d(1),u.c(),b(u,1),u.m(e.mount(),e.anchor),c=!0),e.block=u,e.blocks&&(e.blocks[o]=u),c&&Jn()}if(Fn(t)){const r=Bn();if(t.then(o=>{Qe(r),n(e.then,1,e.value,o),Qe(null)},o=>{if(Qe(r),n(e.catch,2,e.error,o),Qe(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,t),!0;e.resolved=t}}function Yn(t,e,l){const n=e.slice(),{resolved:r}=t;t.current===t.then&&(n[t.value]=r),t.current===t.catch&&(n[t.error]=r),t.block.p(n,l)}function xn(t,e,l){let n;const r=zn();let{layer:o=void 0}=e;const{map:i}=Rn();oe(t,i,c=>l(2,n=c));function a(c){r(c.type,{...c,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Hn(()=>{if(n)if(o)for(const c of s)n.off(c,o,a);else for(const c of u)n.off(c,a)}),t.$$set=c=>{"layer"in c&&l(1,o=c.layer)},t.$$.update=()=>{if(t.$$.dirty&6&&n)if(o)for(const c of s)n.on(c,o,a);else for(const c of u)n.on(c,a)},[i,o,n]}class Nn extends pe{constructor(e){super(),_e(this,e,xn,null,ge,{layer:1})}}function el(t){let e;const l=t[16].default,n=Be(l,t,t[24],null);return{c(){n&&n.c()},m(r,o){n&&n.m(r,o),e=!0},p(r,o){n&&n.p&&(!e||o&16777216)&&Je(n,l,r,r[24],e?Re(l,r[24],o,null):ze(r[24]),null)},i(r){e||(b(n,r),e=!0)},o(r){C(n,r),e=!1},d(r){n&&n.d(r)}}}function tl(t){let e,l,n;function r(i){t[17](i)}let o={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[el]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new Gn({props:o}),be.push(()=>Me(e,"hovered",r)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){P(e.$$.fragment)},m(i,a){O(e,i,a),n=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!l&&a&1&&(l=!0,s.hovered=i[0],Ie(()=>l=!1)),e.$set(s)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function nl(t,e,l){let{$$slots:n={},$$scope:r}=e,{id:o=Un("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:m=void 0}=e,{filter:p=void 0}=e,{applyToClusters:f=void 0}=e,{minzoom:_=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:$=!1}=e,{hovered:j=null}=e,{eventsIfTopMost:B=!1}=e,{interactive:U=!0}=e;function q(k){j=k,l(0,j)}function S(k){Ae.call(this,t,k)}function J(k){Ae.call(this,t,k)}function T(k){Ae.call(this,t,k)}function H(k){Ae.call(this,t,k)}function L(k){Ae.call(this,t,k)}function I(k){Ae.call(this,t,k)}return t.$$set=k=>{"id"in k&&l(1,o=k.id),"source"in k&&l(2,i=k.source),"sourceLayer"in k&&l(3,a=k.sourceLayer),"beforeId"in k&&l(4,s=k.beforeId),"beforeLayerType"in k&&l(5,u=k.beforeLayerType),"paint"in k&&l(6,c=k.paint),"layout"in k&&l(7,m=k.layout),"filter"in k&&l(8,p=k.filter),"applyToClusters"in k&&l(9,f=k.applyToClusters),"minzoom"in k&&l(10,_=k.minzoom),"maxzoom"in k&&l(11,g=k.maxzoom),"hoverCursor"in k&&l(12,M=k.hoverCursor),"manageHoverState"in k&&l(13,$=k.manageHoverState),"hovered"in k&&l(0,j=k.hovered),"eventsIfTopMost"in k&&l(14,B=k.eventsIfTopMost),"interactive"in k&&l(15,U=k.interactive),"$$scope"in k&&l(24,r=k.$$scope)},[j,o,i,a,s,u,c,m,p,f,_,g,M,$,B,U,n,q,S,J,T,H,L,I,r]}class ll extends pe{constructor(e){super(),_e(this,e,nl,tl,ge,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const rl=t=>({}),$t=t=>({}),ol=t=>({}),kt=t=>({});function il(t){let e,l,n,r;const o=t[3].sidebar,i=Be(o,t,t[2],kt),a=t[3].map,s=Be(a,t,t[2],$t);return{c(){e=h("div"),i&&i.c(),l=A(),n=h("div"),s&&s.c()},m(u,c){v(u,e,c),i&&i.m(e,null),t[4](e),v(u,l,c),v(u,n,c),s&&s.m(n,null),t[5](n),r=!0},p(u,[c]){i&&i.p&&(!r||c&4)&&Je(i,o,u,u[2],r?Re(o,u[2],c,ol):ze(u[2]),kt),s&&s.p&&(!r||c&4)&&Je(s,a,u,u[2],r?Re(a,u[2],c,rl):ze(u[2]),$t)},i(u){r||(b(i,u),b(s,u),r=!0)},o(u){C(i,u),C(s,u),r=!1},d(u){u&&(w(e),w(l),w(n)),i&&i.d(u),t[4](null),s&&s.d(u),t[5](null)}}}function sl(t,e,l){let n,r;oe(t,ft,u=>l(0,n=u)),oe(t,mt,u=>l(1,r=u));let{$$slots:o={},$$scope:i}=e;function a(u){be[u?"unshift":"push"](()=>{n=u,ft.set(n)})}function s(u){be[u?"unshift":"push"](()=>{r=u,mt.set(r)})}return t.$$set=u=>{"$$scope"in u&&l(2,i=u.$$scope)},[n,r,i,o,a,s]}class Ze extends pe{constructor(e){super(),_e(this,e,sl,il,ge,{})}}let ft=Ve(null),mt=Ve(null),et=Ve(void 0),V=Ve(fl());function he(t){return{type:"FeatureCollection",features:t}}let le=Ve({kind:"neutral"});function Ce(){return["","2","1","0","Critical"]}let je=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:Ce()},{name:"SA04",description:"trip hazards",choices:Ce()},{name:"SA05",description:"kerbside activity",choices:Ce()},{name:"SA08",description:"motor traffic speed",choices:Ce()},{name:"SA09",description:"motor traffic volume",choices:Ce()},{name:"SA11",description:"footway widths",choices:Ce()},{name:"SA12",description:"effective width next to tram lines",choices:Ce()},{name:"SA13",description:"crossing angle of tram/train rails",choices:Ce()},{name:"SA14",description:"cycling surface and maintenance defects",choices:Ce()},{name:"SA15",description:"WW surface and maintenance defects",choices:Ce()},{name:"SA16",description:"guard railing",choices:Ce()}],Ue=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"];function al(t){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Ue[t%Ue.length],answers:Array(je.length).fill("")}}}function cl(t,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Ue[t%Ue.length],st20:""}}}function ul(t,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Ue[t%Ue.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function fl(){try{let t=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if("links"in t&&"jats"in t&&"bus_stops"in t)return t}catch{}return{links:[],jats:[],bus_stops:[]}}function ml(t){let e,l;return e=new Ee({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function dl(t){let e,l;return e=new Se({props:{data:he(t[0].jats),$$slots:{default:[ml]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&1&&(o.data=he(n[0].jats)),r&2&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function pl(t,e,l){let n;return oe(t,V,r=>l(0,n=r)),[n]}class gt extends pe{constructor(e){super(),_e(this,e,pl,dl,ge,{})}}function _l(t){let e,l;return e=new He({props:{paint:{"line-color":t[0]?["get","color"]:"black","line-width":6}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.paint={"line-color":n[0]?["get","color"]:"black","line-width":6}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function gl(t){let e,l;return e=new Se({props:{data:he(t[1].links),$$slots:{default:[_l]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&2&&(o.data=he(n[1].links)),r&5&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function hl(t,e,l){let n;oe(t,V,o=>l(1,n=o));let{showColor:r=!1}=e;return t.$$set=o=>{"showColor"in o&&l(0,r=o.showColor)},[r,n]}class ot extends pe{constructor(e){super(),_e(this,e,hl,gl,ge,{showColor:0})}}const{window:$l}=nt;function kl(t,e,l){const n=t.slice();return n[9]=e[l],n}function bl(t){let e;return{c(){e=h("option"),e.textContent=`${t[9]}`,e.__value=t[9],de(e,e.__value)},m(l,n){v(l,e,n)},p:re,d(l){l&&w(e)}}}function vl(t){let e,l,n,r,o,i,a,s,u,c,m,p,f,_,g=Q(Ce()),M=[];for(let $=0;$<g.length;$+=1)M[$]=bl(kl(t,g,$));return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=A(),r=h("button"),r.textContent="Delete bus stop",o=A(),i=h("label"),a=Z(`Name:
      `),s=h("input"),u=A(),c=h("label"),m=Z(`ST20: bus stops
      `),p=h("select");for(let $=0;$<M.length;$+=1)M[$].c();z(s,"type","text"),t[1].bus_stops[t[0]].properties.st20===void 0&&pt(()=>t[8].call(p)),z(e,"slot","sidebar")},m($,j){v($,e,j),d(e,l),d(e,n),d(e,r),d(e,o),d(e,i),d(i,a),d(i,s),de(s,t[1].bus_stops[t[0]].properties.name),d(e,u),d(e,c),d(c,m),d(c,p);for(let B=0;B<M.length;B+=1)M[B]&&M[B].m(p,null);Ge(p,t[1].bus_stops[t[0]].properties.st20,!0),f||(_=[W(l,"click",t[6]),W(r,"click",t[4]),W(s,"input",t[7]),W(p,"change",t[8])],f=!0)},p($,j){j&3&&s.value!==$[1].bus_stops[$[0]].properties.name&&de(s,$[1].bus_stops[$[0]].properties.name),j&3&&Ge(p,$[1].bus_stops[$[0]].properties.st20)},d($){$&&w(e),ae(M,$),f=!1,Le(_)}}}function wl(t){let e,l;return e=new Ee({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function yl(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-1j72wc4"),ee(e,"background-color",t[1].bus_stops[t[0]].properties.color)},m(l,n){v(l,e,n)},p(l,n){n&3&&ee(e,"background-color",l[1].bus_stops[l[0]].properties.color)},d(l){l&&w(e)}}}function jl(t){let e,l,n,r,o,i,a,s,u,c;l=new ot({}),r=new gt({}),i=new Se({props:{data:he(t[1].bus_stops),generateId:!0,$$slots:{default:[wl]},$$scope:{ctx:t}}});function m(f){t[5](f)}let p={draggable:!0,$$slots:{default:[yl]},$$scope:{ctx:t}};return t[1].bus_stops[t[0]].geometry.coordinates!==void 0&&(p.lngLat=t[1].bus_stops[t[0]].geometry.coordinates),s=new Pe({props:p}),be.push(()=>Me(s,"lngLat",m)),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment),z(e,"slot","map")},m(f,_){v(f,e,_),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),d(e,a),O(s,e,null),c=!0},p(f,_){const g={};_&2&&(g.data=he(f[1].bus_stops)),_&4097&&(g.$$scope={dirty:_,ctx:f}),i.$set(g);const M={};_&4099&&(M.$$scope={dirty:_,ctx:f}),!u&&_&3&&(u=!0,M.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,Ie(()=>u=!1)),s.$set(M)},i(f){c||(b(l.$$.fragment,f),b(r.$$.fragment,f),b(i.$$.fragment,f),b(s.$$.fragment,f),c=!0)},o(f){C(l.$$.fragment,f),C(r.$$.fragment,f),C(i.$$.fragment,f),C(s.$$.fragment,f),c=!1},d(f){f&&w(e),F(l),F(r),F(i),F(s)}}}function Cl(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[jl],sidebar:[vl]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W($l,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&4103&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function Al(t,e,l){let n,r;oe(t,V,p=>l(1,n=p)),oe(t,le,p=>l(2,r=p));let{idx:o}=e;function i(p){p.key=="Escape"&&te(le,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this bus stop?")&&(te(le,r={kind:"neutral"},r),await Ke(),n.bus_stops.splice(o,1),V.set(n))}function s(p){t.$$.not_equal(n.bus_stops[o].geometry.coordinates,p)&&(n.bus_stops[o].geometry.coordinates=p,V.set(n))}const u=()=>te(le,r={kind:"neutral"},r);function c(){n.bus_stops[o].properties.name=this.value,V.set(n)}function m(){n.bus_stops[o].properties.st20=_t(this),V.set(n)}return t.$$set=p=>{"idx"in p&&l(0,o=p.idx)},[o,n,r,i,a,s,u,c,m]}class Sl extends pe{constructor(e){super(),_e(this,e,Al,Cl,ge,{idx:0})}}let bt="MZEJTanw3WpxRvt7qDfo";async function Ll(t){return t?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await Tl(t)}&key=${t}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${bt}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${bt}`}async function Tl(t){try{let l=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${t}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB"})})).json();return"session"in l?l.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(l)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}function Ml(t){let e,l;return e=new Ee({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Il(t){let e,l;return e=new Se({props:{data:he(t[0].bus_stops),$$slots:{default:[Ml]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&1&&(o.data=he(n[0].bus_stops)),r&2&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Nl(t,e,l){let n;return oe(t,V,r=>l(0,n=r)),[n]}class it extends pe{constructor(e){super(),_e(this,e,Nl,Il,ge,{})}}const El="/route-element/assets/right-arrow-d8c7892c.svg";function vt(t){let e,l;const n=t[4].default,r=Be(n,t,t[3],null);return{c(){e=h("div"),r&&r.c(),z(e,"class","section svelte-zax3q3")},m(o,i){v(o,e,i),r&&r.m(e,null),l=!0},p(o,i){r&&r.p&&(!l||i&8)&&Je(r,n,o,o[3],l?Re(n,o[3],i,null):ze(o[3]),null)},i(o){l||(b(r,o),l=!0)},o(o){C(r,o),l=!1},d(o){o&&w(e),r&&r.d(o)}}}function Dl(t){let e,l,n,r,o,i,a,s,u,c,m,p,f=t[2]&&vt(t);return{c(){e=h("button"),l=h("div"),n=h("span"),r=Z(t[0]),o=A(),i=h("img"),u=A(),f&&f.c(),z(i,"class","arrow svelte-zax3q3"),ut(i.src,a=El)||z(i,"src",a),z(i,"alt",s="Select "+t[0]),z(l,"class","top-section section svelte-zax3q3"),ht(l,"bordered",t[2]),z(e,"class","clickable-card svelte-zax3q3"),e.disabled=t[1]},m(_,g){v(_,e,g),d(e,l),d(l,n),d(n,r),d(l,o),d(l,i),d(e,u),f&&f.m(e,null),c=!0,m||(p=[W(e,"click",t[5]),W(e,"mouseenter",t[6]),W(e,"mouseleave",t[7])],m=!0)},p(_,[g]){(!c||g&1)&&ie(r,_[0]),(!c||g&1&&s!==(s="Select "+_[0]))&&z(i,"alt",s),(!c||g&4)&&ht(l,"bordered",_[2]),_[2]?f?(f.p(_,g),g&4&&b(f,1)):(f=vt(_),f.c(),b(f,1),f.m(e,null)):f&&($e(),C(f,1,1,()=>{f=null}),ke()),(!c||g&2)&&(e.disabled=_[1])},i(_){c||(b(f),c=!0)},o(_){C(f),c=!1},d(_){_&&w(e),f&&f.d(),m=!1,Le(p)}}}function ql(t,e,l){let{$$slots:n={},$$scope:r}=e,{name:o}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(m){Ae.call(this,t,m)}function u(m){Ae.call(this,t,m)}function c(m){Ae.call(this,t,m)}return t.$$set=m=>{"name"in m&&l(0,o=m.name),"disabled"in m&&l(1,i=m.disabled),"hasSlot"in m&&l(2,a=m.hasSlot),"$$scope"in m&&l(3,r=m.$$scope)},[o,i,a,r,n,s,u,c]}class En extends pe{constructor(e){super(),_e(this,e,ql,Dl,ge,{name:0,disabled:1,hasSlot:2})}}let Ne={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const Pl=t=>({dialog:t&1}),wt=t=>({dialog:t[0]});function Ol(t){let e,l,n,r,o;const i=t[4].default,a=Be(i,t,t[3],wt);return{c(){e=h("dialog"),l=h("article"),a&&a.c(),e.open=!0},m(s,u){v(s,e,u),d(e,l),a&&a.m(l,null),t[6](e),n=!0,r||(o=[W(window,"click",t[1]),W(window,"keydown",t[2]),W(e,"close",t[5])],r=!0)},p(s,[u]){a&&a.p&&(!n||u&9)&&Je(a,i,s,s[3],n?Re(i,s[3],u,Pl):ze(s[3]),wt)},i(s){n||(b(a,s),n=!0)},o(s){C(a,s),n=!1},d(s){s&&w(e),a&&a.d(s),t[6](null),r=!1,Le(o)}}}function Fl(t,e,l){let{$$slots:n={},$$scope:r}=e,o;function i(c){o.open&&c.target==o&&o.close()}function a(c){(c.key=="Escape"||c.key=="Enter")&&(c.stopPropagation(),o.close())}function s(c){Ae.call(this,t,c)}function u(c){be[c?"unshift":"push"](()=>{o=c,l(0,o)})}return t.$$set=c=>{"$$scope"in c&&l(3,r=c.$$scope)},[o,i,a,r,n,s,u]}class Dn extends pe{constructor(e){super(),_e(this,e,Fl,Ol,ge,{})}}function Bl(t,e){let l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),l.setAttribute("download",t),document.body.appendChild(l),l.click(),document.body.removeChild(l)}const Oe={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},dt=Object.keys(Oe);function tt(t){return Object.keys(Oe[t])}const qe="All movements";function yt(t,e){let l=[],n=Oe[t][e];n&&l.push({junctionType:t,movementType:e,...n});let r=Oe[t][qe];if(r&&e!=qe&&l.push({junctionType:t,movementType:qe,...r}),t=="Crossroads"){let o=Oe["Simple priority T-junction"][qe];o&&l.push({junctionType:"Simple priority T-junction",movementType:qe,...o})}if(t!="Any type of junction"){let o=Oe["Any type of junction"][qe];o&&l.push({junctionType:"Any type of junction",movementType:qe,...o})}return l}function jt(t,e,l){const n=t.slice();return n[10]=e[l],n}function Ct(t,e,l){const n=t.slice();return n[13]=e[l],n}function At(t,e,l){const n=t.slice();return n[13]=e[l],n}function St(t,e,l){const n=t.slice();return n[13]=e[l],n}function Lt(t,e,l){const n=t.slice();return n[20]=e[l],n}function Tt(t,e,l){const n=t.slice();return n[20]=e[l],n}function Mt(t){let e,l;return e=new Dn({props:{$$slots:{default:[Jl]},$$scope:{ctx:t}}}),e.$on("close",t[9]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&33554439&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function It(t){let e,l,n,r,o,i,a,s;return i=rt(t[6][1]),{c(){e=h("label"),l=h("input"),n=A(),r=Z(t[20]),o=A(),z(l,"type","radio"),l.__value=t[20],de(l,l.__value),i.p(l)},m(u,c){v(u,e,c),d(e,l),l.checked=l.__value===t[1],d(e,n),d(e,r),d(e,o),a||(s=[W(l,"change",t[5]),W(l,"change",t[3])],a=!0)},p(u,c){c&2&&(l.checked=l.__value===u[1])},d(u){u&&w(e),i.r(),a=!1,Le(s)}}}function Nt(t){let e,l,n,r=!1,o,i=t[20]+"",a,s,u,c,m;return u=rt(t[6][0]),{c(){e=h("label"),l=h("input"),o=A(),a=Z(i),s=A(),z(l,"type","radio"),l.__value=n=t[20],de(l,l.__value),u.p(l)},m(p,f){v(p,e,f),d(e,l),l.checked=l.__value===t[2],d(e,o),d(e,a),d(e,s),c||(m=W(l,"change",t[7]),c=!0)},p(p,f){f&2&&n!==(n=p[20])&&(l.__value=n,de(l,l.__value),r=!0),(r||f&6)&&(l.checked=l.__value===p[2]),f&2&&i!==(i=p[20]+"")&&ie(a,i)},d(p){p&&w(e),u.r(),c=!1,m()}}}function Et(t){let e,l=t[13]+"",n;return{c(){e=h("li"),n=Z(l)},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&6&&l!==(l=r[13]+"")&&ie(n,l)},d(r){r&&w(e)}}}function Dt(t){let e,l=t[13]+"",n;return{c(){e=h("li"),n=Z(l)},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&6&&l!==(l=r[13]+"")&&ie(n,l)},d(r){r&&w(e)}}}function qt(t){let e,l=t[13]+"",n;return{c(){e=h("li"),n=Z(l)},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&6&&l!==(l=r[13]+"")&&ie(n,l)},d(r){r&&w(e)}}}function Pt(t){let e,l,n=t[10].junctionType+"",r,o,i,a,s,u,c=t[10].movementType+"",m,p,f,_,g,M,$,j,B,U,q,S=Q(t[10].scoreZero),J=[];for(let k=0;k<S.length;k+=1)J[k]=Et(St(t,S,k));let T=Q(t[10].scoreOne),H=[];for(let k=0;k<T.length;k+=1)H[k]=Dt(At(t,T,k));let L=Q(t[10].scoreTwo),I=[];for(let k=0;k<L.length;k+=1)I[k]=qt(Ct(t,L,k));return{c(){e=h("tr"),l=h("td"),r=Z(n),o=A(),i=h("br"),a=A(),s=h("br"),u=A(),m=Z(c),p=A(),f=h("td"),_=h("ul");for(let k=0;k<J.length;k+=1)J[k].c();g=A(),M=h("td"),$=h("ul");for(let k=0;k<H.length;k+=1)H[k].c();j=A(),B=h("td"),U=h("ul");for(let k=0;k<I.length;k+=1)I[k].c();q=A(),z(l,"class","type-row svelte-k4kgn3"),z(f,"class","score-zero svelte-k4kgn3"),z(M,"class","score-one svelte-k4kgn3"),z(B,"class","score-two svelte-k4kgn3")},m(k,X){v(k,e,X),d(e,l),d(l,r),d(l,o),d(l,i),d(l,a),d(l,s),d(l,u),d(l,m),d(e,p),d(e,f),d(f,_);for(let y=0;y<J.length;y+=1)J[y]&&J[y].m(_,null);d(e,g),d(e,M),d(M,$);for(let y=0;y<H.length;y+=1)H[y]&&H[y].m($,null);d(e,j),d(e,B),d(B,U);for(let y=0;y<I.length;y+=1)I[y]&&I[y].m(U,null);d(e,q)},p(k,X){if(X&6&&n!==(n=k[10].junctionType+"")&&ie(r,n),X&6&&c!==(c=k[10].movementType+"")&&ie(m,c),X&6){S=Q(k[10].scoreZero);let y;for(y=0;y<S.length;y+=1){const ue=St(k,S,y);J[y]?J[y].p(ue,X):(J[y]=Et(ue),J[y].c(),J[y].m(_,null))}for(;y<J.length;y+=1)J[y].d(1);J.length=S.length}if(X&6){T=Q(k[10].scoreOne);let y;for(y=0;y<T.length;y+=1){const ue=At(k,T,y);H[y]?H[y].p(ue,X):(H[y]=Dt(ue),H[y].c(),H[y].m($,null))}for(;y<H.length;y+=1)H[y].d(1);H.length=T.length}if(X&6){L=Q(k[10].scoreTwo);let y;for(y=0;y<L.length;y+=1){const ue=Ct(k,L,y);I[y]?I[y].p(ue,X):(I[y]=qt(ue),I[y].c(),I[y].m(U,null))}for(;y<I.length;y+=1)I[y].d(1);I.length=L.length}},d(k){k&&w(e),ae(J,k),ae(H,k),ae(I,k)}}}function Jl(t){let e,l,n,r,o,i,a,s,u,c,m,p,f,_,g,M,$,j=Q(dt),B=[];for(let T=0;T<j.length;T+=1)B[T]=It(Tt(t,j,T));let U=Q(tt(t[1])),q=[];for(let T=0;T<U.length;T+=1)q[T]=Nt(Lt(t,U,T));let S=Q(yt(t[1],t[2])),J=[];for(let T=0;T<S.length;T+=1)J[T]=Pt(jt(t,S,T));return{c(){e=h("h1"),e.textContent="LTN 1/20 scoring guidance",l=A(),n=h("p"),n.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,r=A(),o=h("div"),i=Z(`Type of junction:
      `),a=h("fieldset");for(let T=0;T<B.length;T+=1)B[T].c();s=Z(`

      Type of movement:
      `),u=h("fieldset");for(let T=0;T<q.length;T+=1)q[T].c();c=A(),m=h("table"),p=h("tr"),p.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,f=A();for(let T=0;T<J.length;T+=1)J[T].c();_=A(),g=h("button"),g.textContent="OK",ee(o,"display","flex"),ee(o,"justify-content","space-between")},m(T,H){v(T,e,H),v(T,l,H),v(T,n,H),v(T,r,H),v(T,o,H),d(o,i),d(o,a);for(let L=0;L<B.length;L+=1)B[L]&&B[L].m(a,null);d(o,s),d(o,u);for(let L=0;L<q.length;L+=1)q[L]&&q[L].m(u,null);v(T,c,H),v(T,m,H),d(m,p),d(m,f);for(let L=0;L<J.length;L+=1)J[L]&&J[L].m(m,null);v(T,_,H),v(T,g,H),M||($=W(g,"click",t[8]),M=!0)},p(T,H){if(H&10){j=Q(dt);let L;for(L=0;L<j.length;L+=1){const I=Tt(T,j,L);B[L]?B[L].p(I,H):(B[L]=It(I),B[L].c(),B[L].m(a,null))}for(;L<B.length;L+=1)B[L].d(1);B.length=j.length}if(H&6){U=Q(tt(T[1]));let L;for(L=0;L<U.length;L+=1){const I=Lt(T,U,L);q[L]?q[L].p(I,H):(q[L]=Nt(I),q[L].c(),q[L].m(u,null))}for(;L<q.length;L+=1)q[L].d(1);q.length=U.length}if(H&6){S=Q(yt(T[1],T[2]));let L;for(L=0;L<S.length;L+=1){const I=jt(T,S,L);J[L]?J[L].p(I,H):(J[L]=Pt(I),J[L].c(),J[L].m(m,null))}for(;L<J.length;L+=1)J[L].d(1);J.length=S.length}},d(T){T&&(w(e),w(l),w(n),w(r),w(o),w(c),w(m),w(_),w(g)),ae(B,T),ae(q,T),ae(J,T),M=!1,$()}}}function zl(t){let e,l,n,r,o,i,a=t[0]&&Mt(t);return{c(){e=h("button"),e.textContent="LTN 1/20 scoring guidance",l=A(),a&&a.c(),n=lt(),z(e,"class","secondary")},m(s,u){v(s,e,u),v(s,l,u),a&&a.m(s,u),v(s,n,u),r=!0,o||(i=W(e,"click",t[4]),o=!0)},p(s,[u]){s[0]?a?(a.p(s,u),u&1&&b(a,1)):(a=Mt(s),a.c(),b(a,1),a.m(n.parentNode,n)):a&&($e(),C(a,1,1,()=>{a=null}),ke())},i(s){r||(b(a),r=!0)},o(s){C(a),r=!1},d(s){s&&(w(e),w(l),w(n)),a&&a.d(s),o=!1,i()}}}function Rl(t,e,l){let n=!1,r=dt[0],o=tt(r)[0];function i(){l(2,o=tt(r)[0])}const a=[[],[]],s=()=>l(0,n=!0);function u(){r=this.__value,l(1,r)}function c(){o=this.__value,l(2,o)}return[n,r,o,i,s,u,a,c,()=>l(0,n=!1),()=>l(0,n=!1)]}class Hl extends pe{constructor(e){super(),_e(this,e,Rl,zl,ge,{})}}function Ot(t,e,l){const n=t.slice();return n[11]=e[l][0],n[12]=e[l][1],n}function Ft(t){let e,l;return e=new Hl({}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Bt(t){let e,l,n,r=t[12]+"",o,i,a,s,u;return a=rt(t[7][0]),{c(){e=h("label"),l=h("input"),n=A(),o=Z(r),i=A(),z(l,"type","radio"),l.__value=t[11],de(l,l.__value),a.p(l)},m(c,m){v(c,e,m),d(e,l),l.checked=l.__value===t[3].jats[t[0]].properties[t[1]].movements[t[2]].score,d(e,n),d(e,o),d(e,i),s||(u=W(l,"change",t[9]),s=!0)},p(c,m){m&15&&(l.checked=l.__value===c[3].jats[c[0]].properties[c[1]].movements[c[2]].score)},d(c){c&&w(e),a.r(),s=!1,u()}}}function Gl(t){let e,l,n,r,o,i,a,s,u,c,m,p,f,_,g,M,$,j,B,U,q,S,J,T=t[3].jats[t[0]].properties[t[1]].movements[t[2]].kind=="cycling"&&Ft(),H=Q(t[4]),L=[];for(let I=0;I<H.length;I+=1)L[I]=Bt(Ot(t,H,I));return q=rt(t[7][1]),{c(){e=h("label"),l=Z(`Name
  `),n=h("input"),r=A(),o=h("fieldset"),i=h("label"),a=h("input"),s=Z(`
    Cycling`),u=A(),c=h("label"),m=h("input"),p=Z(`
    Walking & Wheeling`),f=A(),T&&T.c(),_=A(),g=h("fieldset");for(let I=0;I<L.length;I+=1)L[I].c();M=A(),$=h("label"),j=Z(`Comments
  `),B=h("textarea"),z(n,"type","text"),z(a,"type","radio"),a.__value="cycling",de(a,a.__value),z(m,"type","radio"),m.__value="walking & wheeling",de(m,m.__value),q.p(a,m)},m(I,k){v(I,e,k),d(e,l),d(e,n),de(n,t[3].jats[t[0]].properties[t[1]].movements[t[2]].name),v(I,r,k),v(I,o,k),d(o,i),d(i,a),a.checked=a.__value===t[3].jats[t[0]].properties[t[1]].movements[t[2]].kind,d(i,s),d(o,u),d(o,c),d(c,m),m.checked=m.__value===t[3].jats[t[0]].properties[t[1]].movements[t[2]].kind,d(c,p),v(I,f,k),T&&T.m(I,k),v(I,_,k),v(I,g,k);for(let X=0;X<L.length;X+=1)L[X]&&L[X].m(g,null);v(I,M,k),v(I,$,k),d($,j),d($,B),de(B,t[3].jats[t[0]].properties[t[1]].movements[t[2]].notes),U=!0,S||(J=[W(n,"input",t[5]),W(a,"change",t[6]),W(m,"change",t[8]),W(B,"input",t[10])],S=!0)},p(I,[k]){if(k&15&&n.value!==I[3].jats[I[0]].properties[I[1]].movements[I[2]].name&&de(n,I[3].jats[I[0]].properties[I[1]].movements[I[2]].name),k&15&&(a.checked=a.__value===I[3].jats[I[0]].properties[I[1]].movements[I[2]].kind),k&15&&(m.checked=m.__value===I[3].jats[I[0]].properties[I[1]].movements[I[2]].kind),I[3].jats[I[0]].properties[I[1]].movements[I[2]].kind=="cycling"?T?k&15&&b(T,1):(T=Ft(),T.c(),b(T,1),T.m(_.parentNode,_)):T&&($e(),C(T,1,1,()=>{T=null}),ke()),k&31){H=Q(I[4]);let X;for(X=0;X<H.length;X+=1){const y=Ot(I,H,X);L[X]?L[X].p(y,k):(L[X]=Bt(y),L[X].c(),L[X].m(g,null))}for(;X<L.length;X+=1)L[X].d(1);L.length=H.length}k&15&&de(B,I[3].jats[I[0]].properties[I[1]].movements[I[2]].notes)},i(I){U||(b(T),U=!0)},o(I){C(T),U=!1},d(I){I&&(w(e),w(r),w(o),w(f),w(_),w(g),w(M),w($)),T&&T.d(I),ae(L,I),q.r(),S=!1,Le(J)}}}function Ul(t,e,l){let n;oe(t,V,_=>l(3,n=_));let{junctionIdx:r}=e,{stage:o}=e,{idx:i}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];const s=[[],[]];function u(){n.jats[r].properties[o].movements[i].name=this.value,V.set(n)}function c(){n.jats[r].properties[o].movements[i].kind=this.__value,V.set(n)}function m(){n.jats[r].properties[o].movements[i].kind=this.__value,V.set(n)}function p(){n.jats[r].properties[o].movements[i].score=this.__value,V.set(n)}function f(){n.jats[r].properties[o].movements[i].notes=this.value,V.set(n)}return t.$$set=_=>{"junctionIdx"in _&&l(0,r=_.junctionIdx),"stage"in _&&l(1,o=_.stage),"idx"in _&&l(2,i=_.idx)},[r,o,i,n,a,u,c,s,m,p,f]}class Zl extends pe{constructor(e){super(),_e(this,e,Ul,Gl,ge,{junctionIdx:0,stage:1,idx:2})}}function Kl(t){return t%(2*Math.PI)*180/Math.PI}function Ye(t){return t%360*Math.PI/180}function Jt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function qn(t,e,l={}){if(l.final===!0)return Xl(t,e);const n=Jt(t),r=Jt(e),o=Ye(n[0]),i=Ye(r[0]),a=Ye(n[1]),s=Ye(r[1]),u=Math.sin(i-o)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-o);return Kl(Math.atan2(u,c))}function Xl(t,e){let l=qn(e,t);return l=(l+180)%360,l}var Fe=qn;function Wl(t,e,l={}){const n={type:"Feature"};return(l.id===0||l.id)&&(n.id=l.id),l.bbox&&(n.bbox=l.bbox),n.properties=e||{},n.geometry=t,n}function Vl(t,e,l={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!zt(t[0])||!zt(t[1]))throw new Error("coordinates must contain numbers");return Wl({type:"Point",coordinates:t},e,l)}function zt(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Ql(t,e={}){const l=Zn(t),n=(l[0]+l[2])/2,r=(l[1]+l[3])/2;return Vl([n,r],e.properties,e)}var Yl=Ql,we=63710088e-1,xl={centimeters:we*100,centimetres:we*100,degrees:360/(2*Math.PI),feet:we*3.28084,inches:we*39.37,kilometers:we/1e3,kilometres:we/1e3,meters:we,metres:we,miles:we/1609.344,millimeters:we*1e3,millimetres:we*1e3,nauticalmiles:we/1852,radians:1,yards:we*1.0936};function er(t,e,l={}){const n={type:"Feature"};return(l.id===0||l.id)&&(n.id=l.id),l.bbox&&(n.bbox=l.bbox),n.properties=e||{},n.geometry=t,n}function tr(t,e,l={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ht(t[0])||!Ht(t[1]))throw new Error("coordinates must contain numbers");return er({type:"Point",coordinates:t},e,l)}function nr(t,e="kilometers"){const l=xl[e];if(!l)throw new Error(e+" units is invalid");return t/l}function Rt(t){return t%(2*Math.PI)*180/Math.PI}function ct(t){return t%360*Math.PI/180}function Ht(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function lr(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function rr(t,e,l,n={}){const r=lr(t),o=ct(r[0]),i=ct(r[1]),a=ct(l),s=nr(e,n.units),u=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(u)),m=Rt(c),p=Rt(u);return tr([m,p],n.properties)}var We=rr,ye=63710088e-1,or={centimeters:ye*100,centimetres:ye*100,degrees:360/(2*Math.PI),feet:ye*3.28084,inches:ye*39.37,kilometers:ye/1e3,kilometres:ye/1e3,meters:ye,metres:ye,miles:ye/1609.344,millimeters:ye*1e3,millimetres:ye*1e3,nauticalmiles:ye/1852,radians:1,yards:ye*1.0936};function ir(t,e="kilometers"){const l=or[e];if(!l)throw new Error(e+" units is invalid");return t*l}function xe(t){return t%360*Math.PI/180}function Gt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function sr(t,e,l={}){var n=Gt(t),r=Gt(e),o=xe(r[1]-n[1]),i=xe(r[0]-n[0]),a=xe(n[1]),s=xe(r[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return ir(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),l.units)}var ar=sr;function cr(t){let e=Yl({type:"FeatureCollection",features:t.map(n=>({type:"Feature",geometry:{type:"Point",coordinates:n.point},properties:{}}))}).geometry.coordinates;t.sort((n,r)=>Ut(Fe(e,r.point))-Ut(Fe(e,n.point)));let l=[];for(let n=0;n<t.length;n++){let r=t[n],o=Fe(r.point,e),i=1;for(let a of fr(n,t.length)){let s=t[a],u=Fe(e,s.point),c=ur(r.point,e,i++),m=ar(r.point,e),p=We(c,.5*m,o).geometry.coordinates,f=We(p,.2*m,u).geometry.coordinates;l.push({point1:c,point2:p,point3:f,kind:"cycling",score:"X",name:`${r.name} to ${s.name}`,notes:""})}}return l}function ur(t,e,l){let n=.003,o=Fe(t,e)-90,i=n*l;return We(t,i,o).geometry.coordinates}function Ut(t){return(t+360)%360}function fr(t,e){let l=[];for(let n=t+1;n<e;n++)l.push(n);for(let n=0;n<t;n++)l.push(n);return l}const mr="/route-element/assets/movement-aa45473c.svg",dr="/route-element/assets/pan-fbcec4cd.svg";function Zt(t,e,l){const n=t.slice();return n[31]=e[l],n[32]=e,n[33]=l,n}function Kt(t,e,l){const n=t.slice();return n[34]=e[l],n[35]=e,n[33]=l,n}function Xt(t){let e,l,n,r,o,i,a,s,u,c,m,p,f,_,g,M,$,j,B;function U(X,y){return X[0].mode=="select"?_r:pr}let q=U(t),S=q(t);function J(X,y){return X[0].mode=="new-arm"?hr:gr}let T=J(t),H=T(t);function L(X,y){return X[0].mode=="new-movement"?kr:$r}let I=L(t),k=I(t);return{c(){e=h("div"),l=h("button"),n=h("img"),o=A(),S.c(),i=A(),a=h("button"),s=at("svg"),u=at("circle"),c=at("text"),m=Z("A"),p=A(),H.c(),f=A(),_=h("button"),g=h("img"),$=A(),k.c(),ut(n.src,r=dr)||z(n,"src",r),z(n,"alt","Move map"),ee(n,"vertical-align","middle"),z(l,"class","outline"),z(u,"cx","12"),z(u,"cy","12"),z(u,"r","12"),z(u,"fill","white"),z(c,"x","6"),z(c,"y","16"),z(c,"fill","#4472c4"),z(s,"width","24"),z(s,"height","24"),z(s,"xmlns","http://www.w3.org/2000/svg"),ee(s,"vertical-align","middle"),z(a,"class","outline"),ut(g.src,M=mr)||z(g,"src",M),z(g,"alt","New movement"),ee(g,"vertical-align","middle"),z(_,"class","outline"),z(e,"class","control-panel svelte-l1e6xi")},m(X,y){v(X,e,y),d(e,l),d(l,n),d(l,o),S.m(l,null),d(e,i),d(e,a),d(a,s),d(s,u),d(s,c),d(c,m),d(a,p),H.m(a,null),d(e,f),d(e,_),d(_,g),d(_,$),k.m(_,null),j||(B=[W(l,"click",function(){Kn(t[4])&&t[4].apply(this,arguments)}),W(a,"click",t[12]),W(_,"click",t[13])],j=!0)},p(X,y){t=X,q!==(q=U(t))&&(S.d(1),S=q(t),S&&(S.c(),S.m(l,null))),T!==(T=J(t))&&(H.d(1),H=T(t),H&&(H.c(),H.m(a,null))),I!==(I=L(t))&&(k.d(1),k=I(t),k&&(k.c(),k.m(_,null)))},d(X){X&&w(e),S.d(),H.d(),k.d(),j=!1,Le(B)}}}function pr(t){let e;return{c(){e=Z("Move map")},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function _r(t){let e;return{c(){e=h("b"),e.textContent="Move map"},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function gr(t){let e;return{c(){e=Z("New arm")},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function hr(t){let e;return{c(){e=h("b"),e.textContent="New arm"},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function $r(t){let e;return{c(){e=Z("New movement")},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function kr(t){let e;return{c(){e=h("b"),e.textContent="New movement"},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function br(t){let e;return{c(){e=h("span"),e.textContent=`${Nr(t[33])}`,z(e,"class","dot svelte-l1e6xi"),ee(e,"color","#4472c4"),ee(e,"background-color","white")},m(l,n){v(l,e,n)},p:re,d(l){l&&w(e)}}}function Wt(t){let e,l,n;function r(s){t[14](s,t[34])}function o(){return t[15](t[33])}function i(){return t[16](t[33])}let a={draggable:!0,$$slots:{default:[br]},$$scope:{ctx:t}};return t[34].point!==void 0&&(a.lngLat=t[34].point),e=new Pe({props:a}),be.push(()=>Me(e,"lngLat",r)),e.$on("dragend",o),e.$on("click",i),{c(){P(e.$$.fragment)},m(s,u){O(e,s,u),n=!0},p(s,u){t=s;const c={};u[1]&32&&(c.$$scope={dirty:u,ctx:t}),!l&&u[0]&38&&(l=!0,c.lngLat=t[34].point,Ie(()=>l=!1)),e.$set(c)},i(s){n||(b(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){F(e,s)}}}function vr(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-l1e6xi"),ee(e,"background-color",t[7][t[31].score]),ee(e,"opacity",t[31].kind=="walking & wheeling"?"0%":"100%")},m(l,n){v(l,e,n)},p(l,n){n[0]&38&&ee(e,"background-color",l[7][l[31].score]),n[0]&38&&ee(e,"opacity",l[31].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&w(e)}}}function wr(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-l1e6xi"),ee(e,"background-color",t[7][t[31].score])},m(l,n){v(l,e,n)},p(l,n){n[0]&38&&ee(e,"background-color",l[7][l[31].score])},d(l){l&&w(e)}}}function yr(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-l1e6xi"),ee(e,"background-color",t[7][t[31].score]),ee(e,"opacity","0%")},m(l,n){v(l,e,n)},p(l,n){n[0]&38&&ee(e,"background-color",l[7][l[31].score])},d(l){l&&w(e)}}}function Vt(t){let e,l,n,r,o,i,a,s,u;function c(S){t[17](S,t[31])}function m(){return t[18](t[33])}function p(){return t[19](t[33])}let f={draggable:!0,$$slots:{default:[vr]},$$scope:{ctx:t}};t[31].point1!==void 0&&(f.lngLat=t[31].point1),e=new Pe({props:f}),be.push(()=>Me(e,"lngLat",c)),e.$on("dragend",m),e.$on("click",p);function _(S){t[20](S,t[31])}function g(){return t[21](t[33])}function M(){return t[22](t[33])}let $={draggable:!0,$$slots:{default:[wr]},$$scope:{ctx:t}};t[31].point2!==void 0&&($.lngLat=t[31].point2),r=new Pe({props:$}),be.push(()=>Me(r,"lngLat",_)),r.$on("dragend",g),r.$on("click",M);function j(S){t[23](S,t[31])}function B(){return t[24](t[33])}function U(){return t[25](t[33])}let q={draggable:!0,$$slots:{default:[yr]},$$scope:{ctx:t}};return t[31].point3!==void 0&&(q.lngLat=t[31].point3),a=new Pe({props:q}),be.push(()=>Me(a,"lngLat",j)),a.$on("dragend",B),a.$on("click",U),{c(){P(e.$$.fragment),n=A(),P(r.$$.fragment),i=A(),P(a.$$.fragment)},m(S,J){O(e,S,J),v(S,n,J),O(r,S,J),v(S,i,J),O(a,S,J),u=!0},p(S,J){t=S;const T={};J[0]&38|J[1]&32&&(T.$$scope={dirty:J,ctx:t}),!l&&J[0]&38&&(l=!0,T.lngLat=t[31].point1,Ie(()=>l=!1)),e.$set(T);const H={};J[0]&38|J[1]&32&&(H.$$scope={dirty:J,ctx:t}),!o&&J[0]&38&&(o=!0,H.lngLat=t[31].point2,Ie(()=>o=!1)),r.$set(H);const L={};J[0]&38|J[1]&32&&(L.$$scope={dirty:J,ctx:t}),!s&&J[0]&38&&(s=!0,L.lngLat=t[31].point3,Ie(()=>s=!1)),a.$set(L)},i(S){u||(b(e.$$.fragment,S),b(r.$$.fragment,S),b(a.$$.fragment,S),u=!0)},o(S){C(e.$$.fragment,S),C(r.$$.fragment,S),C(a.$$.fragment,S),u=!1},d(S){S&&(w(n),w(i)),F(e,S),F(r,S),F(a,S)}}}function jr(t){let e=(t[30].name||"Untitled movement")+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r[0]&1073741824&&e!==(e=(n[30].name||"Untitled movement")+"")&&ie(l,e)},d(n){n&&w(l)}}}function Cr(t){let e,l;return e=new In({props:{$$slots:{default:[jr,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ar(t){let e=(t[30].name||"Untitled movement")+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r[0]&1073741824&&e!==(e=(n[30].name||"Untitled movement")+"")&&ie(l,e)},d(n){n&&w(l)}}}function Sr(t){let e,l;return e=new In({props:{$$slots:{default:[Ar,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Lr(t){let e,l,n,r,o,i;return e=new He({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Xe(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Cr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),n=new He({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Xe(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Sr]},$$scope:{ctx:t}}}),n.$on("click",t[9]),o=new ll({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){P(e.$$.fragment),l=A(),P(n.$$.fragment),r=A(),P(o.$$.fragment)},m(a,s){O(e,a,s),v(a,l,s),O(n,a,s),v(a,r,s),O(o,a,s),i=!0},p(a,s){const u={};s[1]&32&&(u.$$scope={dirty:s,ctx:a}),e.$set(u);const c={};s[1]&32&&(c.$$scope={dirty:s,ctx:a}),n.$set(c)},i(a){i||(b(e.$$.fragment,a),b(n.$$.fragment,a),b(o.$$.fragment,a),i=!0)},o(a){C(e.$$.fragment,a),C(n.$$.fragment,a),C(o.$$.fragment,a),i=!1},d(a){a&&(w(l),w(r)),F(e,a),F(n,a),F(o,a)}}}function Tr(t){let e,l,n,r;return e=new He({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),n=new Ee({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){P(e.$$.fragment),l=A(),P(n.$$.fragment)},m(o,i){O(e,o,i),v(o,l,i),O(n,o,i),r=!0},p:re,i(o){r||(b(e.$$.fragment,o),b(n.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),C(n.$$.fragment,o),r=!1},d(o){o&&w(l),F(e,o),F(n,o)}}}function Mr(t){let e,l,n,r,o,i,a,s,u;e=new Nn({}),e.$on("click",t[8]);let c=t[0].mode!="editing"&&Xt(t),m=Q(t[5].jats[t[1]].properties[t[2]].arms),p=[];for(let $=0;$<m.length;$+=1)p[$]=Wt(Kt(t,m,$));const f=$=>C(p[$],1,1,()=>{p[$]=null});let _=Q(t[5].jats[t[1]].properties[t[2]].movements),g=[];for(let $=0;$<_.length;$+=1)g[$]=Vt(Zt(t,_,$));const M=$=>C(g[$],1,1,()=>{g[$]=null});return i=new Se({props:{data:t[10](t[5]),$$slots:{default:[Lr]},$$scope:{ctx:t}}}),s=new Se({props:{data:t[6],$$slots:{default:[Tr]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment),l=A(),c&&c.c(),n=A();for(let $=0;$<p.length;$+=1)p[$].c();r=A();for(let $=0;$<g.length;$+=1)g[$].c();o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment)},m($,j){O(e,$,j),v($,l,j),c&&c.m($,j),v($,n,j);for(let B=0;B<p.length;B+=1)p[B]&&p[B].m($,j);v($,r,j);for(let B=0;B<g.length;B+=1)g[B]&&g[B].m($,j);v($,o,j),O(i,$,j),v($,a,j),O(s,$,j),u=!0},p($,j){if($[0].mode!="editing"?c?c.p($,j):(c=Xt($),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null),j[0]&46){m=Q($[5].jats[$[1]].properties[$[2]].arms);let q;for(q=0;q<m.length;q+=1){const S=Kt($,m,q);p[q]?(p[q].p(S,j),b(p[q],1)):(p[q]=Wt(S),p[q].c(),b(p[q],1),p[q].m(r.parentNode,r))}for($e(),q=m.length;q<p.length;q+=1)f(q);ke()}if(j[0]&174){_=Q($[5].jats[$[1]].properties[$[2]].movements);let q;for(q=0;q<_.length;q+=1){const S=Zt($,_,q);g[q]?(g[q].p(S,j),b(g[q],1)):(g[q]=Vt(S),g[q].c(),b(g[q],1),g[q].m(o.parentNode,o))}for($e(),q=_.length;q<g.length;q+=1)M(q);ke()}const B={};j[0]&32&&(B.data=$[10]($[5])),j[1]&32&&(B.$$scope={dirty:j,ctx:$}),i.$set(B);const U={};j[0]&64&&(U.data=$[6]),j[1]&32&&(U.$$scope={dirty:j,ctx:$}),s.$set(U)},i($){if(!u){b(e.$$.fragment,$);for(let j=0;j<m.length;j+=1)b(p[j]);for(let j=0;j<_.length;j+=1)b(g[j]);b(i.$$.fragment,$),b(s.$$.fragment,$),u=!0}},o($){C(e.$$.fragment,$),p=p.filter(Boolean);for(let j=0;j<p.length;j+=1)C(p[j]);g=g.filter(Boolean);for(let j=0;j<g.length;j+=1)C(g[j]);C(i.$$.fragment,$),C(s.$$.fragment,$),u=!1},d($){$&&(w(l),w(n),w(r),w(o),w(a)),F(e,$),c&&c.d($),ae(p,$),ae(g,$),F(i,$),F(s,$)}}}function Ir(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Nr(t){return String.fromCharCode(t+"A".charCodeAt(0))}function Er(t,e,l){let n,r,o;oe(t,V,D=>l(5,r=D)),oe(t,et,D=>l(26,o=D));let{junctionIdx:i}=e,{stage:a}=e,{mode:s}=e,{hoveringSidebar:u}=e,{select:c}=e,{stopEditing:m}=e,p={0:Ne.red.background,1:Ne.amber.background,2:Ne.green.background,X:Ne.critical.background};function f(D,K,ne){let se={type:"FeatureCollection",features:[]},N=K.mode=="editing"?K.id:ne;return N!=null&&(N.kind=="arm"?se.features.push(Ir(D.jats[i].properties[a].arms[N.idx],N.idx)):se.features.push($(D.jats[i].properties[a].movements[N.idx],N.idx))),se}async function _(D){if(o){for(let K of o.queryRenderedFeatures(D.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await m();return}s.mode=="new-arm"?(te(V,r.jats[i].properties[a].arms=[...r.jats[i].properties[a].arms,{point:D.detail.lngLat.toArray(),name:""}],r),await c({kind:"arm",idx:r.jats[i].properties[a].arms.length-1})):(te(V,r.jats[i].properties[a].movements=[...r.jats[i].properties[a].movements,{point1:D.detail.lngLat.toArray(),point2:We(D.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:We(D.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],r),await c({kind:"movement",idx:r.jats[i].properties[a].movements.length-1}))}}}async function g(D){await c({kind:"movement",idx:D.detail.features[0].id})}function M(D){let K={type:"FeatureCollection",features:D.jats[i].properties[a].movements.map((ne,se)=>$(ne,se))};for(let ne of D.jats[i].properties[a].movements)if(K.features.push(j(ne,K.features.length)),ne.kind=="walking & wheeling"){let se={...ne,point1:ne.point3,point3:ne.point1};K.features.push(j(se,K.features.length))}return K}function $(D,K){return{type:"Feature",id:K,properties:{name:D.name,kind:D.kind,color:p[D.score]},geometry:{type:"LineString",coordinates:[D.point1,D.point2,D.point3]}}}function j(D,K){return{type:"Feature",id:K,properties:{kind:D.kind,color:p[D.score],angle:Fe(D.point2,D.point3)},geometry:{type:"Point",coordinates:D.point3}}}const B=()=>l(0,s={mode:"new-arm"}),U=()=>l(0,s={mode:"new-movement"});function q(D,K){t.$$.not_equal(K.point,D)&&(K.point=D,V.set(r))}const S=D=>c({kind:"arm",idx:D}),J=D=>c({kind:"arm",idx:D});function T(D,K){t.$$.not_equal(K.point1,D)&&(K.point1=D,V.set(r))}const H=D=>c({kind:"movement",idx:D}),L=D=>c({kind:"movement",idx:D});function I(D,K){t.$$.not_equal(K.point2,D)&&(K.point2=D,V.set(r))}const k=D=>c({kind:"movement",idx:D}),X=D=>c({kind:"movement",idx:D});function y(D,K){t.$$.not_equal(K.point3,D)&&(K.point3=D,V.set(r))}const ue=D=>c({kind:"movement",idx:D}),ce=D=>c({kind:"movement",idx:D});return t.$$set=D=>{"junctionIdx"in D&&l(1,i=D.junctionIdx),"stage"in D&&l(2,a=D.stage),"mode"in D&&l(0,s=D.mode),"hoveringSidebar"in D&&l(11,u=D.hoveringSidebar),"select"in D&&l(3,c=D.select),"stopEditing"in D&&l(4,m=D.stopEditing)},t.$$.update=()=>{t.$$.dirty[0]&2081&&l(6,n=f(r,s,u))},[s,i,a,c,m,r,n,p,_,g,M,u,B,U,q,S,J,T,H,L,I,k,X,y,ue,ce]}class Dr extends pe{constructor(e){super(),_e(this,e,Er,Mr,ge,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function Qt(t){if(t.movements.length==0)return"No movements added";let e=0,l=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],l+=2;let n=e/l*100;return`${Math.round(n)}%`}const{window:qr}=nt;function Yt(t,e,l){const n=t.slice();n[27]=e[l],n[30]=l;const r=n[14][n[27].score];return n[28]=r,n}function xt(t,e,l){const n=t.slice();return n[31]=e[l],n[30]=l,n}function Pr(t){let e,l,n,r,o,i,a,s,u;return{c(){e=h("button"),e.textContent="Done",l=A(),n=h("button"),n.textContent="Delete",r=A(),o=h("label"),i=Z(`Arm name
        `),a=h("input"),z(a,"type","text")},m(c,m){v(c,e,m),v(c,l,m),v(c,n,m),v(c,r,m),v(c,o,m),d(o,i),d(o,a),de(a,t[5].jats[t[0]].properties[t[1]].arms[t[2].id.idx].name),s||(u=[W(e,"click",t[23]),W(n,"click",t[10]),W(a,"input",t[24])],s=!0)},p(c,m){m[0]&39&&a.value!==c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name&&de(a,c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name)},i:re,o:re,d(c){c&&(w(e),w(l),w(n),w(r),w(o)),s=!1,Le(u)}}}function Or(t){let e,l,n,r,o,i,a,s;return e=new Zl({props:{junctionIdx:t[0],stage:t[1],idx:t[2].id.idx}}),{c(){P(e.$$.fragment),l=A(),n=h("button"),n.textContent="Save",r=A(),o=h("button"),o.textContent="Delete"},m(u,c){O(e,u,c),v(u,l,c),v(u,n,c),v(u,r,c),v(u,o,c),i=!0,a||(s=[W(n,"click",t[9]),W(o,"click",t[10])],a=!0)},p(u,c){const m={};c[0]&1&&(m.junctionIdx=u[0]),c[0]&2&&(m.stage=u[1]),c[0]&4&&(m.idx=u[2].id.idx),e.$set(m)},i(u){i||(b(e.$$.fragment,u),i=!0)},o(u){C(e.$$.fragment,u),i=!1},d(u){u&&(w(l),w(n),w(r),w(o)),F(e,u),a=!1,Le(s)}}}function Fr(t){let e,l,n,r,o,i,a,s,u,c,m,p,f,_=t[5].jats[t[0]].properties.name+"",g,M,$=Qt(t[5].jats[t[0]].properties[t[1]])+"",j,B,U,q,S,J,T,H,L,I,k,X=Q(t[5].jats[t[0]].properties[t[1]].arms),y=[];for(let N=0;N<X.length;N+=1)y[N]=en(xt(t,X,N));const ue=N=>C(y[N],1,1,()=>{y[N]=null});let ce=t[5].jats[t[0]].properties[t[7]].arms.length>0&&tn(t),D=Q(t[5].jats[t[0]].properties[t[1]].movements),K=[];for(let N=0;N<D.length;N+=1)K[N]=nn(Yt(t,D,N));const ne=N=>C(K[N],1,1,()=>{K[N]=null});let se=t[5].jats[t[0]].properties[t[7]].movements.length>0&&ln(t);return{c(){e=h("button"),e.textContent="Done",l=A(),n=h("h3"),n.textContent="Arms",r=A();for(let N=0;N<y.length;N+=1)y[N].c();o=A(),ce&&ce.c(),i=A(),a=h("h3"),a.textContent="Movements",s=A(),u=h("p"),c=Z("Total JAT score for "),m=Z(t[1]),p=Z(` junction
        `),f=h("i"),g=Z(_),M=Z(`
        : `),j=Z($),B=A(),U=h("button"),q=Z("Generate cycling movements between all arms"),J=A();for(let N=0;N<K.length;N+=1)K[N].c();T=A(),se&&se.c(),H=lt(),z(U,"class","secondary"),U.disabled=S=t[5].jats[t[0]].properties[t[1]].arms.length<2},m(N,R){v(N,e,R),v(N,l,R),v(N,n,R),v(N,r,R);for(let Y=0;Y<y.length;Y+=1)y[Y]&&y[Y].m(N,R);v(N,o,R),ce&&ce.m(N,R),v(N,i,R),v(N,a,R),v(N,s,R),v(N,u,R),d(u,c),d(u,m),d(u,p),d(u,f),d(f,g),d(u,M),d(u,j),v(N,B,R),v(N,U,R),d(U,q),v(N,J,R);for(let Y=0;Y<K.length;Y+=1)K[Y]&&K[Y].m(N,R);v(N,T,R),se&&se.m(N,R),v(N,H,R),L=!0,I||(k=[W(e,"click",t[16]),W(U,"click",t[15])],I=!0)},p(N,R){if(R[0]&299){X=Q(N[5].jats[N[0]].properties[N[1]].arms);let Y;for(Y=0;Y<X.length;Y+=1){const ve=xt(N,X,Y);y[Y]?(y[Y].p(ve,R),b(y[Y],1)):(y[Y]=en(ve),y[Y].c(),b(y[Y],1),y[Y].m(o.parentNode,o))}for($e(),Y=X.length;Y<y.length;Y+=1)ue(Y);ke()}if(N[5].jats[N[0]].properties[N[7]].arms.length>0?ce?ce.p(N,R):(ce=tn(N),ce.c(),ce.m(i.parentNode,i)):ce&&(ce.d(1),ce=null),(!L||R[0]&2)&&ie(m,N[1]),(!L||R[0]&33)&&_!==(_=N[5].jats[N[0]].properties.name+"")&&ie(g,_),(!L||R[0]&35)&&$!==($=Qt(N[5].jats[N[0]].properties[N[1]])+"")&&ie(j,$),(!L||R[0]&35&&S!==(S=N[5].jats[N[0]].properties[N[1]].arms.length<2))&&(U.disabled=S),R[0]&16683){D=Q(N[5].jats[N[0]].properties[N[1]].movements);let Y;for(Y=0;Y<D.length;Y+=1){const ve=Yt(N,D,Y);K[Y]?(K[Y].p(ve,R),b(K[Y],1)):(K[Y]=nn(ve),K[Y].c(),b(K[Y],1),K[Y].m(T.parentNode,T))}for($e(),Y=D.length;Y<K.length;Y+=1)ne(Y);ke()}N[5].jats[N[0]].properties[N[7]].movements.length>0?se?se.p(N,R):(se=ln(N),se.c(),se.m(H.parentNode,H)):se&&(se.d(1),se=null)},i(N){if(!L){for(let R=0;R<X.length;R+=1)b(y[R]);for(let R=0;R<D.length;R+=1)b(K[R]);L=!0}},o(N){y=y.filter(Boolean);for(let R=0;R<y.length;R+=1)C(y[R]);K=K.filter(Boolean);for(let R=0;R<K.length;R+=1)C(K[R]);L=!1},d(N){N&&(w(e),w(l),w(n),w(r),w(o),w(i),w(a),w(s),w(u),w(B),w(U),w(J),w(T),w(H)),ae(y,N),ce&&ce.d(N),ae(K,N),se&&se.d(N),I=!1,Le(k)}}}function en(t){let e,l;function n(){return t[17](t[30])}function r(){return t[18](t[30])}return e=new En({props:{name:`${rn(t[30])} - ${t[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",n),e.$on("mouseenter",r),e.$on("mouseleave",t[19]),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0},p(o,i){t=o;const a={};i[0]&35&&(a.name=`${rn(t[30])} - ${t[31].name||"Unnamed arm"}`),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o)}}}function tn(t){let e,l,n;return{c(){e=h("button"),e.textContent=`Copy arms from ${t[7]}`,z(e,"class","secondary")},m(r,o){v(r,e,o),l||(n=W(e,"click",t[12]),l=!0)},p:re,d(r){r&&w(e),l=!1,n()}}}function Br(t){let e,l,n,r=t[27].score+"",o,i,a,s=on(t[27].kind)+"",u;return{c(){e=h("div"),l=h("span"),n=Z("Score: "),o=Z(r),i=A(),a=h("span"),u=Z(s),ee(l,"padding","4px"),ee(l,"color",t[28].font),ee(l,"background-color",t[28].background),ee(e,"width","100%"),ee(e,"display","flex"),ee(e,"justify-content","space-between")},m(c,m){v(c,e,m),d(e,l),d(l,n),d(l,o),d(e,i),d(e,a),d(a,u)},p(c,m){m[0]&35&&r!==(r=c[27].score+"")&&ie(o,r),m[0]&35&&ee(l,"color",c[28].font),m[0]&35&&ee(l,"background-color",c[28].background),m[0]&35&&s!==(s=on(c[27].kind)+"")&&ie(u,s)},d(c){c&&w(e)}}}function nn(t){let e,l;function n(){return t[20](t[30])}function r(){return t[21](t[30])}return e=new En({props:{name:t[27].name||"Unnamed movement",$$slots:{default:[Br]},$$scope:{ctx:t}}}),e.$on("click",n),e.$on("mouseenter",r),e.$on("mouseleave",t[22]),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0},p(o,i){t=o;const a={};i[0]&35&&(a.name=t[27].name||"Unnamed movement"),i[0]&35|i[1]&4&&(a.$$scope={dirty:i,ctx:t}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o)}}}function ln(t){let e,l,n;return{c(){e=h("button"),e.textContent=`Copy movements from ${t[7]}`,z(e,"class","secondary")},m(r,o){v(r,e,o),l||(n=W(e,"click",t[13]),l=!0)},p:re,d(r){r&&w(e),l=!1,n()}}}function Jr(t){let e,l,n,r,o=t[5].jats[t[0]].properties.name+"",i,a,s,u,c;const m=[Fr,Or,Pr],p=[];function f(_,g){return _[2].mode!="editing"?0:_[2].id.kind=="movement"?1:2}return s=f(t),u=p[s]=m[s](t),{c(){e=h("div"),l=h("h2"),n=Z(t[1]),r=Z(" JAT for "),i=Z(o),a=A(),u.c(),z(e,"slot","sidebar")},m(_,g){v(_,e,g),d(e,l),d(l,n),d(l,r),d(l,i),d(e,a),p[s].m(e,null),t[25](e),c=!0},p(_,g){(!c||g[0]&2)&&ie(n,_[1]),(!c||g[0]&33)&&o!==(o=_[5].jats[_[0]].properties.name+"")&&ie(i,o);let M=s;s=f(_),s===M?p[s].p(_,g):($e(),C(p[M],1,1,()=>{p[M]=null}),ke(),u=p[s],u?u.p(_,g):(u=p[s]=m[s](_),u.c()),b(u,1),u.m(e,null))},i(_){c||(b(u),c=!0)},o(_){C(u),c=!1},d(_){_&&w(e),p[s].d(),t[25](null)}}}function zr(t){let e,l;return e=new Ee({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r[0]&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Rr(t){let e,l,n,r,o,i,a,s,u;return l=new ot({}),r=new it({}),i=new Se({props:{data:he(t[5].jats),generateId:!0,$$slots:{default:[zr]},$$scope:{ctx:t}}}),s=new Dr({props:{junctionIdx:t[0],stage:t[1],mode:t[2],hoveringSidebar:t[3],select:t[8],stopEditing:t[9]}}),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment),z(e,"slot","map")},m(c,m){v(c,e,m),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),d(e,a),O(s,e,null),u=!0},p(c,m){const p={};m[0]&32&&(p.data=he(c[5].jats)),m[0]&1|m[1]&4&&(p.$$scope={dirty:m,ctx:c}),i.$set(p);const f={};m[0]&1&&(f.junctionIdx=c[0]),m[0]&2&&(f.stage=c[1]),m[0]&4&&(f.mode=c[2]),m[0]&8&&(f.hoveringSidebar=c[3]),s.$set(f)},i(c){u||(b(l.$$.fragment,c),b(r.$$.fragment,c),b(i.$$.fragment,c),b(s.$$.fragment,c),u=!0)},o(c){C(l.$$.fragment,c),C(r.$$.fragment,c),C(i.$$.fragment,c),C(s.$$.fragment,c),u=!1},d(c){c&&w(e),F(l),F(r),F(i),F(s)}}}function Hr(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[Rr],sidebar:[Jr]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W(qr,"keydown",t[11]),n=!0)},p(o,i){const a={};i[0]&127|i[1]&4&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function rn(t){return String.fromCharCode(t+"A".charCodeAt(0))}function on(t){return t.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function Gr(t,e,l){let n,r;oe(t,V,y=>l(5,n=y)),oe(t,le,y=>l(6,r=y));let{junctionIdx:o}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s={mode:"select"},u=null,c=null,m;async function p(y){u=m.scrollTop,l(2,s={mode:"editing",id:y}),l(3,c=null),await Ke(),l(4,m.scrollTop=0,m)}async function f(){l(2,s={mode:"select"}),u!=null&&(await Ke(),l(4,m.scrollTop=u,m),u=null)}function _(){s.mode=="editing"&&window.confirm(`Delete this ${s.id.kind}?`)&&(s.id.kind=="movement"?(n.jats[o].properties[i].movements.splice(s.id.idx,1),V.set(n)):(n.jats[o].properties[i].arms.splice(s.id.idx,1),V.set(n)),f())}function g(y){if(s.mode!="editing")return;let ue=y.target.tagName,ce=ue=="INPUT"||ue=="TEXTAREA";y.key=="Escape"||y.key=="Enter"&&!ce?(y.stopPropagation(),f()):y.key=="Delete"&&!ce&&(y.stopPropagation(),_())}function M(){n.jats[o].properties[i].arms.length>0&&!window.confirm("Overwrite arms?")||(te(V,n.jats[o].properties[i].arms=JSON.parse(JSON.stringify(n.jats[o].properties[a].arms)),n),V.set(n))}function $(){n.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite movements?")||(te(V,n.jats[o].properties[i].movements=JSON.parse(JSON.stringify(n.jats[o].properties[a].movements)),n),V.set(n))}let j={0:Ne.red,1:Ne.amber,2:Ne.green,X:Ne.critical};function B(){if(n.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let y=n.jats[o].properties[i].movements.filter(ue=>ue.kind=="walking & wheeling");te(V,n.jats[o].properties[i].movements=[...y,...cr(n.jats[o].properties[i].arms)],n)}const U=()=>te(le,r={kind:"edit-jat",idx:o},r),q=y=>p({kind:"arm",idx:y}),S=y=>l(3,c={kind:"arm",idx:y}),J=()=>l(3,c=null),T=y=>p({kind:"movement",idx:y}),H=y=>l(3,c={kind:"movement",idx:y}),L=()=>l(3,c=null),I=()=>l(2,s={mode:"select"});function k(){n.jats[o].properties[i].arms[s.id.idx].name=this.value,V.set(n)}function X(y){be[y?"unshift":"push"](()=>{m=y,l(4,m)})}return t.$$set=y=>{"junctionIdx"in y&&l(0,o=y.junctionIdx),"stage"in y&&l(1,i=y.stage)},[o,i,s,c,m,n,r,a,p,f,_,g,M,$,j,B,U,q,S,J,T,H,L,I,k,X]}class Ur extends pe{constructor(e){super(),_e(this,e,Gr,Hr,ge,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:Zr}=nt;function Kr(t){let e,l,n,r,o,i,a,s,u,c,m,p,f,_;return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=A(),r=h("button"),r.textContent="Delete JAT",o=A(),i=h("label"),a=Z(`Name:
      `),s=h("input"),u=A(),c=h("button"),c.textContent="Existing",m=A(),p=h("button"),p.textContent="Proposed",z(s,"type","text"),z(e,"slot","sidebar")},m(g,M){v(g,e,M),d(e,l),d(e,n),d(e,r),d(e,o),d(e,i),d(i,a),d(i,s),de(s,t[1].jats[t[0]].properties.name),d(e,u),d(e,c),d(e,m),d(e,p),f||(_=[W(l,"click",t[6]),W(r,"click",t[4]),W(s,"input",t[7]),W(c,"click",t[8]),W(p,"click",t[9])],f=!0)},p(g,M){M&3&&s.value!==g[1].jats[g[0]].properties.name&&de(s,g[1].jats[g[0]].properties.name)},d(g){g&&w(e),f=!1,Le(_)}}}function Xr(t){let e,l;return e=new Ee({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Wr(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-114j1n1"),ee(e,"border-color",t[1].jats[t[0]].properties.color)},m(l,n){v(l,e,n)},p(l,n){n&3&&ee(e,"border-color",l[1].jats[l[0]].properties.color)},d(l){l&&w(e)}}}function Vr(t){let e,l,n,r,o,i,a,s,u,c;l=new ot({}),r=new it({}),i=new Se({props:{data:he(t[1].jats),generateId:!0,$$slots:{default:[Xr]},$$scope:{ctx:t}}});function m(f){t[5](f)}let p={draggable:!0,$$slots:{default:[Wr]},$$scope:{ctx:t}};return t[1].jats[t[0]].geometry.coordinates!==void 0&&(p.lngLat=t[1].jats[t[0]].geometry.coordinates),s=new Pe({props:p}),be.push(()=>Me(s,"lngLat",m)),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment),z(e,"slot","map")},m(f,_){v(f,e,_),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),d(e,a),O(s,e,null),c=!0},p(f,_){const g={};_&2&&(g.data=he(f[1].jats)),_&1025&&(g.$$scope={dirty:_,ctx:f}),i.$set(g);const M={};_&1027&&(M.$$scope={dirty:_,ctx:f}),!u&&_&3&&(u=!0,M.lngLat=f[1].jats[f[0]].geometry.coordinates,Ie(()=>u=!1)),s.$set(M)},i(f){c||(b(l.$$.fragment,f),b(r.$$.fragment,f),b(i.$$.fragment,f),b(s.$$.fragment,f),c=!0)},o(f){C(l.$$.fragment,f),C(r.$$.fragment,f),C(i.$$.fragment,f),C(s.$$.fragment,f),c=!1},d(f){f&&w(e),F(l),F(r),F(i),F(s)}}}function Qr(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[Vr],sidebar:[Kr]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W(Zr,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function Yr(t,e,l){let n,r;oe(t,V,f=>l(1,n=f)),oe(t,le,f=>l(2,r=f));let{idx:o}=e;function i(f){f.key=="Escape"&&te(le,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this JAT?")&&(te(le,r={kind:"neutral"},r),await Ke(),n.jats.splice(o,1),V.set(n))}function s(f){t.$$.not_equal(n.jats[o].geometry.coordinates,f)&&(n.jats[o].geometry.coordinates=f,V.set(n))}const u=()=>te(le,r={kind:"neutral"},r);function c(){n.jats[o].properties.name=this.value,V.set(n)}const m=()=>te(le,r={kind:"edit-jat-detail",idx:o,stage:"existing"},r),p=()=>te(le,r={kind:"edit-jat-detail",idx:o,stage:"proposed"},r);return t.$$set=f=>{"idx"in f&&l(0,o=f.idx)},[o,n,r,i,a,s,u,c,m,p]}class xr extends pe{constructor(e){super(),_e(this,e,Yr,Qr,ge,{idx:0})}}function sn(t,e,l){const n=t.slice();return n[3]=e[l],n[4]=e,n[5]=l,n}function eo(t){let e,l;return{c(){e=h("span"),l=A(),z(e,"class","dot svelte-jgyhla")},m(n,r){v(n,e,r),v(n,l,r)},p:re,d(n){n&&(w(e),w(l))}}}function an(t){let e,l,n;function r(i){t[2](i,t[3],t[4],t[5])}let o={draggable:!0,$$slots:{default:[eo]},$$scope:{ctx:t}};return t[3]!==void 0&&(o.lngLat=t[3]),e=new Pe({props:o}),be.push(()=>Me(e,"lngLat",r)),{c(){P(e.$$.fragment)},m(i,a){O(e,i,a),n=!0},p(i,a){t=i;const s={};a&64&&(s.$$scope={dirty:a,ctx:t}),!l&&a&1&&(l=!0,s.lngLat=t[3],Ie(()=>l=!1)),e.$set(s)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function to(t){let e,l,n,r;e=new Nn({}),e.$on("click",t[1]);let o=Q(t[0].geometry.coordinates),i=[];for(let s=0;s<o.length;s+=1)i[s]=an(sn(t,o,s));const a=s=>C(i[s],1,1,()=>{i[s]=null});return{c(){P(e.$$.fragment),l=A();for(let s=0;s<i.length;s+=1)i[s].c();n=lt()},m(s,u){O(e,s,u),v(s,l,u);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(s,u);v(s,n,u),r=!0},p(s,[u]){if(u&1){o=Q(s[0].geometry.coordinates);let c;for(c=0;c<o.length;c+=1){const m=sn(s,o,c);i[c]?(i[c].p(m,u),b(i[c],1)):(i[c]=an(m),i[c].c(),b(i[c],1),i[c].m(n.parentNode,n))}for($e(),c=o.length;c<i.length;c+=1)a(c);ke()}},i(s){if(!r){b(e.$$.fragment,s);for(let u=0;u<o.length;u+=1)b(i[u]);r=!0}},o(s){C(e.$$.fragment,s),i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)C(i[u]);r=!1},d(s){s&&(w(l),w(n)),F(e,s),ae(i,s)}}}function no(t,e,l){let{f:n}=e;function r(i){n.geometry.coordinates.push(i.detail.lngLat.toArray()),l(0,n)}function o(i,a,s,u){s[u]=i,l(0,n)}return t.$$set=i=>{"f"in i&&l(0,n=i.f)},[n,r,o]}class lo extends pe{constructor(e){super(),_e(this,e,no,to,ge,{f:0})}}const{window:ro}=nt;function cn(t,e,l){const n=t.slice();return n[10]=e[l],n[11]=e,n[12]=l,n}function oo(t,e,l){const n=t.slice();return n[13]=e[l],n}function un(t){let e;return{c(){e=h("p"),e.textContent="A link needs at least two points"},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function io(t){let e;return{c(){e=h("option"),e.textContent=`${t[13]}`,e.__value=t[13],de(e,e.__value)},m(l,n){v(l,e,n)},p:re,d(l){l&&w(e)}}}function fn(t){let e,l=t[10].name+"",n,r,o=t[10].description+"",i,a,s,u,c,m,p=Q(t[10].choices),f=[];for(let g=0;g<p.length;g+=1)f[g]=io(oo(t,p,g));function _(){t[9].call(s,t[12])}return{c(){e=h("label"),n=Z(l),r=Z(": "),i=Z(o),a=A(),s=h("select");for(let g=0;g<f.length;g+=1)f[g].c();u=A(),t[1].links[t[0]].properties.answers[t[12]]===void 0&&pt(_)},m(g,M){v(g,e,M),d(e,n),d(e,r),d(e,i),d(e,a),d(e,s);for(let $=0;$<f.length;$+=1)f[$]&&f[$].m(s,null);Ge(s,t[1].links[t[0]].properties.answers[t[12]],!0),d(e,u),c||(m=W(s,"change",_),c=!0)},p(g,M){t=g,M&3&&Ge(s,t[1].links[t[0]].properties.answers[t[12]])},d(g){g&&w(e),ae(f,g),c=!1,m()}}}function so(t){let e,l,n,r,o,i,a,s,u,c,m,p,f,_,g=!t[2]&&un(),M=Q(je),$=[];for(let j=0;j<M.length;j+=1)$[j]=fn(cn(t,M,j));return{c(){e=h("div"),l=h("button"),n=Z("Done"),o=A(),i=h("button"),i.textContent="Delete link",a=A(),g&&g.c(),s=A(),u=h("label"),c=Z(`Name:
      `),m=h("input"),p=A();for(let j=0;j<$.length;j+=1)$[j].c();l.disabled=r=!t[2],z(m,"type","text"),z(e,"slot","sidebar")},m(j,B){v(j,e,B),d(e,l),d(l,n),d(e,o),d(e,i),d(e,a),g&&g.m(e,null),d(e,s),d(e,u),d(u,c),d(u,m),de(m,t[1].links[t[0]].properties.name),d(e,p);for(let U=0;U<$.length;U+=1)$[U]&&$[U].m(e,null);f||(_=[W(l,"click",t[7]),W(i,"click",t[5]),W(m,"input",t[8])],f=!0)},p(j,B){if(B&4&&r!==(r=!j[2])&&(l.disabled=r),j[2]?g&&(g.d(1),g=null):g||(g=un(),g.c(),g.m(e,s)),B&3&&m.value!==j[1].links[j[0]].properties.name&&de(m,j[1].links[j[0]].properties.name),B&3){M=Q(je);let U;for(U=0;U<M.length;U+=1){const q=cn(j,M,U);$[U]?$[U].p(q,B):($[U]=fn(q),$[U].c(),$[U].m(e,null))}for(;U<$.length;U+=1)$[U].d(1);$.length=M.length}},d(j){j&&w(e),g&&g.d(),ae($,j),f=!1,Le(_)}}}function ao(t){let e,l;return e=new He({props:{paint:{"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.paint={"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function co(t){let e,l,n,r,o,i,a,s,u,c;l=new Se({props:{data:he(t[1].links),generateId:!0,$$slots:{default:[ao]},$$scope:{ctx:t}}}),r=new gt({}),i=new it({});function m(f){t[6](f)}let p={};return t[1].links[t[0]]!==void 0&&(p.f=t[1].links[t[0]]),s=new lo({props:p}),be.push(()=>Me(s,"f",m)),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment),z(e,"slot","map")},m(f,_){v(f,e,_),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),d(e,a),O(s,e,null),c=!0},p(f,_){const g={};_&2&&(g.data=he(f[1].links)),_&65537&&(g.$$scope={dirty:_,ctx:f}),l.$set(g);const M={};!u&&_&3&&(u=!0,M.f=f[1].links[f[0]],Ie(()=>u=!1)),s.$set(M)},i(f){c||(b(l.$$.fragment,f),b(r.$$.fragment,f),b(i.$$.fragment,f),b(s.$$.fragment,f),c=!0)},o(f){C(l.$$.fragment,f),C(r.$$.fragment,f),C(i.$$.fragment,f),C(s.$$.fragment,f),c=!1},d(f){f&&w(e),F(l),F(r),F(i),F(s)}}}function uo(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[co],sidebar:[so]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W(ro,"keydown",t[4]),n=!0)},p(o,[i]){const a={};i&65551&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function fo(t,e,l){let n,r,o;oe(t,V,f=>l(1,r=f)),oe(t,le,f=>l(3,o=f));let{idx:i}=e;function a(f){f.key=="Escape"&&n&&te(le,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this link?")&&(te(le,o={kind:"neutral"},o),await Ke(),r.links.splice(i,1),V.set(r))}function u(f){t.$$.not_equal(r.links[i],f)&&(r.links[i]=f,V.set(r))}const c=()=>te(le,o={kind:"neutral"},o);function m(){r.links[i].properties.name=this.value,V.set(r)}function p(f){r.links[i].properties.answers[f]=_t(this),V.set(r)}return t.$$set=f=>{"idx"in f&&l(0,i=f.idx)},t.$$.update=()=>{t.$$.dirty&3&&l(2,n=r.links[i].geometry.coordinates.length>=2)},[i,r,n,o,a,s,u,c,m,p]}class mo extends pe{constructor(e){super(),_e(this,e,fo,uo,ge,{idx:0})}}function mn(t,e,l){const n=t.slice();return n[6]=e[l],n[7]=e,n[8]=l,n}function dn(t,e,l){const n=t.slice();return n[9]=e[l],n}function pn(t){let e,l=t[9]+"",n,r;return{c(){e=h("option"),n=Z(l),e.__value=r=t[9],de(e,e.__value)},m(o,i){v(o,e,i),d(e,n)},p(o,i){i&1&&l!==(l=o[9]+"")&&ie(n,l),i&1&&r!==(r=o[9])&&(e.__value=r,de(e,e.__value))},d(o){o&&w(e)}}}function _n(t){let e,l,n=t[6].properties.name+"",r,o,i,a,s,u,c=Q(je[t[0]].choices),m=[];for(let f=0;f<c.length;f+=1)m[f]=pn(dn(t,c,f));function p(){t[5].call(i,t[7],t[8])}return{c(){e=h("li"),l=h("span"),r=Z(n),o=A(),i=h("select");for(let f=0;f<m.length;f+=1)m[f].c();a=A(),ee(l,"color",t[6].properties.color),t[6].properties.answers[t[0]]===void 0&&pt(p)},m(f,_){v(f,e,_),d(e,l),d(l,r),d(e,o),d(e,i);for(let g=0;g<m.length;g+=1)m[g]&&m[g].m(i,null);Ge(i,t[6].properties.answers[t[0]],!0),d(e,a),s||(u=W(i,"change",p),s=!0)},p(f,_){if(t=f,_&4&&n!==(n=t[6].properties.name+"")&&ie(r,n),_&4&&ee(l,"color",t[6].properties.color),_&1){c=Q(je[t[0]].choices);let g;for(g=0;g<c.length;g+=1){const M=dn(t,c,g);m[g]?m[g].p(M,_):(m[g]=pn(M),m[g].c(),m[g].m(i,null))}for(;g<m.length;g+=1)m[g].d(1);m.length=c.length}_&5&&Ge(i,t[6].properties.answers[t[0]])},d(f){f&&w(e),ae(m,f),s=!1,u()}}}function po(t){let e,l,n,r,o=je[t[0]].name+"",i,a,s=je[t[0]].description+"",u,c,m,p,f,_=Q(t[2].links),g=[];for(let M=0;M<_.length;M+=1)g[M]=_n(mn(t,_,M));return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=A(),r=h("h2"),i=Z(o),a=Z(": "),u=Z(s),c=A(),m=h("ol");for(let M=0;M<g.length;M+=1)g[M].c();z(e,"slot","sidebar")},m(M,$){v(M,e,$),d(e,l),d(e,n),d(e,r),d(r,i),d(r,a),d(r,u),d(e,c),d(e,m);for(let j=0;j<g.length;j+=1)g[j]&&g[j].m(m,null);p||(f=W(l,"click",t[4]),p=!0)},p(M,$){if($&1&&o!==(o=je[M[0]].name+"")&&ie(i,o),$&1&&s!==(s=je[M[0]].description+"")&&ie(u,s),$&5){_=Q(M[2].links);let j;for(j=0;j<_.length;j+=1){const B=mn(M,_,j);g[j]?g[j].p(B,$):(g[j]=_n(B),g[j].c(),g[j].m(m,null))}for(;j<g.length;j+=1)g[j].d(1);g.length=_.length}},d(M){M&&w(e),ae(g,M),p=!1,f()}}}function _o(t){let e,l,n,r,o,i,a;return l=new ot({props:{showColor:!0}}),r=new gt({}),i=new it({}),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),z(e,"slot","map")},m(s,u){v(s,e,u),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),a=!0},p:re,i(s){a||(b(l.$$.fragment,s),b(r.$$.fragment,s),b(i.$$.fragment,s),a=!0)},o(s){C(l.$$.fragment,s),C(r.$$.fragment,s),C(i.$$.fragment,s),a=!1},d(s){s&&w(e),F(l),F(r),F(i)}}}function go(t){let e,l,n,r;return e=new Ze({props:{$$slots:{map:[_o],sidebar:[po]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W(window,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&4103&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function ho(t,e,l){let n,r;oe(t,le,u=>l(1,n=u)),oe(t,V,u=>l(2,r=u));let{qIdx:o}=e;function i(u){u.key=="Escape"&&te(le,n={kind:"neutral"},n)}const a=()=>te(le,n={kind:"neutral"},n);function s(u,c){u[c].properties.answers[o]=_t(this),V.set(r),l(0,o)}return t.$$set=u=>{"qIdx"in u&&l(0,o=u.qIdx)},[o,n,r,i,a,s]}class $o extends pe{constructor(e){super(),_e(this,e,ho,go,ge,{qIdx:0})}}function ko(t){let e,l,n,r;const o=t[2].default,i=Be(o,t,t[1],null);return{c(){e=h("a"),i&&i.c(),z(e,"href","#"),ee(e,"color",t[0])},m(a,s){v(a,e,s),i&&i.m(e,null),l=!0,n||(r=W(e,"click",Xn(t[3])),n=!0)},p(a,[s]){i&&i.p&&(!l||s&2)&&Je(i,o,a,a[1],l?Re(o,a[1],s,null):ze(a[1]),null),s&1&&ee(e,"color",a[0])},i(a){l||(b(i,a),l=!0)},o(a){C(i,a),l=!1},d(a){a&&w(e),i&&i.d(a),n=!1,r()}}}function bo(t,e,l){let{$$slots:n={},$$scope:r}=e,{color:o=void 0}=e;function i(a){Ae.call(this,t,a)}return t.$$set=a=>{"color"in a&&l(0,o=a.color),"$$scope"in a&&l(1,r=a.$$scope)},[o,r,n,i]}class st extends pe{constructor(e){super(),_e(this,e,bo,ko,ge,{color:0})}}function gn(t,e,l){const n=t.slice();return n[2]=e[l],n[4]=l,n}function hn(t,e,l){const n=t.slice();n[5]=e[l];const r=n[5].properties.answers[n[4]];return n[6]=r,n}function $n(t,e,l){const n=t.slice();return n[5]=e[l],n}function kn(t){let e,l=t[5].properties.name+"",n;return{c(){e=h("th"),n=Z(l),ee(e,"color",t[5].properties.color)},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&1&&l!==(l=r[5].properties.name+"")&&ie(n,l),o&1&&ee(e,"color",r[5].properties.color)},d(r){r&&w(e)}}}function bn(t){let e,l=t[6]+"",n;return{c(){e=h("td"),n=Z(l),ee(e,"background",t[6]==""?"red":"green")},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&1&&l!==(l=r[6]+"")&&ie(n,l),o&1&&ee(e,"background",r[6]==""?"red":"green")},d(r){r&&w(e)}}}function vn(t){let e,l,n,r,o=Q(t[0].links),i=[];for(let a=0;a<o.length;a+=1)i[a]=bn(hn(t,o,a));return{c(){e=h("tr"),l=h("th"),l.textContent=`${t[2].name}`,n=A();for(let a=0;a<i.length;a+=1)i[a].c();r=A()},m(a,s){v(a,e,s),d(e,l),d(e,n);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);d(e,r)},p(a,s){if(s&1){o=Q(a[0].links);let u;for(u=0;u<o.length;u+=1){const c=hn(a,o,u);i[u]?i[u].p(c,s):(i[u]=bn(c),i[u].c(),i[u].m(e,r))}for(;u<i.length;u+=1)i[u].d(1);i.length=o.length}},d(a){a&&w(e),ae(i,a)}}}function vo(t){let e,l,n,r,o,i,a,s=Q(t[0].links),u=[];for(let p=0;p<s.length;p+=1)u[p]=kn($n(t,s,p));let c=Q(je),m=[];for(let p=0;p<c.length;p+=1)m[p]=vn(gn(t,c,p));return{c(){e=h("table"),l=h("thead"),n=h("tr"),r=h("th"),o=A();for(let p=0;p<u.length;p+=1)u[p].c();i=A(),a=h("tbody");for(let p=0;p<m.length;p+=1)m[p].c()},m(p,f){v(p,e,f),d(e,l),d(l,n),d(n,r),d(n,o);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(n,null);d(e,i),d(e,a);for(let _=0;_<m.length;_+=1)m[_]&&m[_].m(a,null)},p(p,f){if(f&1){s=Q(p[0].links);let _;for(_=0;_<s.length;_+=1){const g=$n(p,s,_);u[_]?u[_].p(g,f):(u[_]=kn(g),u[_].c(),u[_].m(n,null))}for(;_<u.length;_+=1)u[_].d(1);u.length=s.length}if(f&1){c=Q(je);let _;for(_=0;_<c.length;_+=1){const g=gn(p,c,_);m[_]?m[_].p(g,f):(m[_]=vn(g),m[_].c(),m[_].m(a,null))}for(;_<m.length;_+=1)m[_].d(1);m.length=c.length}},d(p){p&&w(e),ae(u,p),ae(m,p)}}}function wo(t){let e,l;return e=new Dn({props:{$$slots:{default:[vo]},$$scope:{ctx:t}}}),e.$on("close",t[1]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&2049&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function yo(t,e,l){let n;oe(t,V,o=>l(0,n=o));function r(o){Ae.call(this,t,o)}return[n,r]}class jo extends pe{constructor(e){super(),_e(this,e,yo,wo,ge,{})}}function wn(t,e,l){const n=t.slice();return n[19]=e[l],n[21]=l,n}function yn(t,e,l){const n=t.slice();return n[22]=e[l],n[21]=l,n}function jn(t,e,l){const n=t.slice();return n[24]=e[l],n[21]=l,n}function Cn(t,e,l){const n=t.slice();return n[26]=e[l],n[21]=l,n}function An(t){let e,l;return e=new jo({}),e.$on("close",t[7]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Co(t){let e=t[26].properties.name+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r&2&&e!==(e=n[26].properties.name+"")&&ie(l,e)},d(n){n&&w(l)}}}function Sn(t){let e,l,n,r;function o(){return t[13](t[21])}return l=new st({props:{color:t[26].properties.color,$$slots:{default:[Co]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),P(l.$$.fragment),n=A()},m(i,a){v(i,e,a),O(l,e,null),d(e,n),r=!0},p(i,a){t=i;const s={};a&2&&(s.color=t[26].properties.color),a&268435458&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(b(l.$$.fragment,i),r=!0)},o(i){C(l.$$.fragment,i),r=!1},d(i){i&&w(e),F(l)}}}function Ao(t){let e=t[24].name+"",l,n;return{c(){l=Z(e),n=A()},m(r,o){v(r,l,o),v(r,n,o)},p:re,d(r){r&&(w(l),w(n))}}}function Ln(t){let e,l,n,r,o,i,a,s;function u(){return t[14](t[21])}l=new st({props:{$$slots:{default:[Ao]},$$scope:{ctx:t}}}),l.$on("click",u);function c(...m){return t[15](t[21],...m)}return{c(){e=h("li"),P(l.$$.fragment),n=Z(`:
          `),r=h("progress"),a=A(),r.value=o=t[1].links.filter(c).length,z(r,"max",i=t[1].links.length),z(r,"class","svelte-zadug4")},m(m,p){v(m,e,p),O(l,e,null),d(e,n),d(e,r),d(e,a),s=!0},p(m,p){t=m;const f={};p&268435456&&(f.$$scope={dirty:p,ctx:t}),l.$set(f),(!s||p&2&&o!==(o=t[1].links.filter(c).length))&&(r.value=o),(!s||p&2&&i!==(i=t[1].links.length))&&z(r,"max",i)},i(m){s||(b(l.$$.fragment,m),s=!0)},o(m){C(l.$$.fragment,m),s=!1},d(m){m&&w(e),F(l)}}}function So(t){let e=t[22].properties.name+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r&2&&e!==(e=n[22].properties.name+"")&&ie(l,e)},d(n){n&&w(l)}}}function Tn(t){let e,l,n,r;function o(){return t[16](t[21])}return l=new st({props:{color:t[22].properties.color,$$slots:{default:[So]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),P(l.$$.fragment),n=A()},m(i,a){v(i,e,a),O(l,e,null),d(e,n),r=!0},p(i,a){t=i;const s={};a&2&&(s.color=t[22].properties.color),a&268435458&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(b(l.$$.fragment,i),r=!0)},o(i){C(l.$$.fragment,i),r=!1},d(i){i&&w(e),F(l)}}}function Lo(t){let e=t[19].properties.name+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r&2&&e!==(e=n[19].properties.name+"")&&ie(l,e)},d(n){n&&w(l)}}}function Mn(t){let e,l,n,r;function o(){return t[17](t[21])}return l=new st({props:{color:t[19].properties.color,$$slots:{default:[Lo]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),P(l.$$.fragment),n=A()},m(i,a){v(i,e,a),O(l,e,null),d(e,n),r=!0},p(i,a){t=i;const s={};a&2&&(s.color=t[19].properties.color),a&268435458&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(b(l.$$.fragment,i),r=!0)},o(i){C(l.$$.fragment,i),r=!1},d(i){i&&w(e),F(l)}}}function To(t){let e,l,n,r,o,i,a,s,u,c,m,p,f,_,g,M,$,j,B,U,q,S,J,T,H,L,I,k,X,y,ue,ce,D,K=Q(t[1].links),ne=[];for(let G=0;G<K.length;G+=1)ne[G]=Sn(Cn(t,K,G));const se=G=>C(ne[G],1,1,()=>{ne[G]=null});let N=Q(je),R=[];for(let G=0;G<N.length;G+=1)R[G]=Ln(jn(t,N,G));const Y=G=>C(R[G],1,1,()=>{R[G]=null});let ve=Q(t[1].jats),fe=[];for(let G=0;G<ve.length;G+=1)fe[G]=Tn(yn(t,ve,G));const Pn=G=>C(fe[G],1,1,()=>{fe[G]=null});let De=Q(t[1].bus_stops),me=[];for(let G=0;G<De.length;G+=1)me[G]=Mn(wn(t,De,G));const On=G=>C(me[G],1,1,()=>{me[G]=null});return{c(){e=h("div"),l=h("div"),n=h("button"),n.textContent="Download",r=A(),o=h("button"),o.textContent="Clear",i=A(),a=h("hr"),s=A(),u=h("div"),c=h("button"),c.textContent="New link",m=A(),p=h("button"),p.textContent="Table of questions",f=Z(`

    Links:
    `),_=h("ol");for(let G=0;G<ne.length;G+=1)ne[G].c();g=Z(`

    Questions:
    `),M=h("ol");for(let G=0;G<R.length;G+=1)R[G].c();$=A(),j=h("hr"),B=Z(`

    JATs:

    `),U=h("div"),q=h("button"),q.textContent="New JAT",S=A(),J=h("ol");for(let G=0;G<fe.length;G+=1)fe[G].c();T=A(),H=h("hr"),L=Z(`

    Bus stops:

    `),I=h("div"),k=h("button"),k.textContent="New bus stop",X=A(),y=h("ol");for(let G=0;G<me.length;G+=1)me[G].c();z(n,"class","secondary"),z(o,"class","secondary"),z(e,"slot","sidebar")},m(G,x){v(G,e,x),d(e,l),d(l,n),d(l,r),d(l,o),d(e,i),d(e,a),d(e,s),d(e,u),d(u,c),d(u,m),d(u,p),d(e,f),d(e,_);for(let E=0;E<ne.length;E+=1)ne[E]&&ne[E].m(_,null);d(e,g),d(e,M);for(let E=0;E<R.length;E+=1)R[E]&&R[E].m(M,null);d(e,$),d(e,j),d(e,B),d(e,U),d(U,q),d(e,S),d(e,J);for(let E=0;E<fe.length;E+=1)fe[E]&&fe[E].m(J,null);d(e,T),d(e,H),d(e,L),d(e,I),d(I,k),d(e,X),d(e,y);for(let E=0;E<me.length;E+=1)me[E]&&me[E].m(y,null);ue=!0,ce||(D=[W(n,"click",t[11]),W(o,"click",t[3]),W(c,"click",t[4]),W(p,"click",t[12]),W(q,"click",t[5]),W(k,"click",t[6])],ce=!0)},p(G,x){if(x&6){K=Q(G[1].links);let E;for(E=0;E<K.length;E+=1){const Te=Cn(G,K,E);ne[E]?(ne[E].p(Te,x),b(ne[E],1)):(ne[E]=Sn(Te),ne[E].c(),b(ne[E],1),ne[E].m(_,null))}for($e(),E=K.length;E<ne.length;E+=1)se(E);ke()}if(x&6){N=Q(je);let E;for(E=0;E<N.length;E+=1){const Te=jn(G,N,E);R[E]?(R[E].p(Te,x),b(R[E],1)):(R[E]=Ln(Te),R[E].c(),b(R[E],1),R[E].m(M,null))}for($e(),E=N.length;E<R.length;E+=1)Y(E);ke()}if(x&6){ve=Q(G[1].jats);let E;for(E=0;E<ve.length;E+=1){const Te=yn(G,ve,E);fe[E]?(fe[E].p(Te,x),b(fe[E],1)):(fe[E]=Tn(Te),fe[E].c(),b(fe[E],1),fe[E].m(J,null))}for($e(),E=ve.length;E<fe.length;E+=1)Pn(E);ke()}if(x&6){De=Q(G[1].bus_stops);let E;for(E=0;E<De.length;E+=1){const Te=wn(G,De,E);me[E]?(me[E].p(Te,x),b(me[E],1)):(me[E]=Mn(Te),me[E].c(),b(me[E],1),me[E].m(y,null))}for($e(),E=De.length;E<me.length;E+=1)On(E);ke()}},i(G){if(!ue){for(let x=0;x<K.length;x+=1)b(ne[x]);for(let x=0;x<N.length;x+=1)b(R[x]);for(let x=0;x<ve.length;x+=1)b(fe[x]);for(let x=0;x<De.length;x+=1)b(me[x]);ue=!0}},o(G){ne=ne.filter(Boolean);for(let x=0;x<ne.length;x+=1)C(ne[x]);R=R.filter(Boolean);for(let x=0;x<R.length;x+=1)C(R[x]);fe=fe.filter(Boolean);for(let x=0;x<fe.length;x+=1)C(fe[x]);me=me.filter(Boolean);for(let x=0;x<me.length;x+=1)C(me[x]);ue=!1},d(G){G&&w(e),ae(ne,G),ae(R,G),ae(fe,G),ae(me,G),ce=!1,Le(D)}}}function Mo(t){let e,l;return e=new He({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":Xe(6,9)},hoverCursor:"pointer"}}),e.$on("click",t[8]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Io(t){let e,l;return e=new Ee({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":Xe(20,25)},hoverCursor:"pointer"}}),e.$on("click",t[9]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function No(t){let e,l;return e=new Ee({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":Xe(10,15)},hoverCursor:"pointer"}}),e.$on("click",t[10]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Eo(t){let e,l,n,r,o,i,a;return l=new Se({props:{data:he(t[1].links),generateId:!0,$$slots:{default:[Mo]},$$scope:{ctx:t}}}),r=new Se({props:{data:he(t[1].jats),generateId:!0,$$slots:{default:[Io]},$$scope:{ctx:t}}}),i=new Se({props:{data:he(t[1].bus_stops),generateId:!0,$$slots:{default:[No]},$$scope:{ctx:t}}}),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),z(e,"slot","map")},m(s,u){v(s,e,u),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),a=!0},p(s,u){const c={};u&2&&(c.data=he(s[1].links)),u&268435460&&(c.$$scope={dirty:u,ctx:s}),l.$set(c);const m={};u&2&&(m.data=he(s[1].jats)),u&268435460&&(m.$$scope={dirty:u,ctx:s}),r.$set(m);const p={};u&2&&(p.data=he(s[1].bus_stops)),u&268435460&&(p.$$scope={dirty:u,ctx:s}),i.$set(p)},i(s){a||(b(l.$$.fragment,s),b(r.$$.fragment,s),b(i.$$.fragment,s),a=!0)},o(s){C(l.$$.fragment,s),C(r.$$.fragment,s),C(i.$$.fragment,s),a=!1},d(s){s&&w(e),F(l),F(r),F(i)}}}function Do(t){let e,l,n,r=t[0]&&An(t);return l=new Ze({props:{$$slots:{map:[Eo],sidebar:[To]},$$scope:{ctx:t}}}),{c(){r&&r.c(),e=A(),P(l.$$.fragment)},m(o,i){r&&r.m(o,i),v(o,e,i),O(l,o,i),n=!0},p(o,[i]){o[0]?r?(r.p(o,i),i&1&&b(r,1)):(r=An(o),r.c(),b(r,1),r.m(e.parentNode,e)):r&&($e(),C(r,1,1,()=>{r=null}),ke());const a={};i&268435463&&(a.$$scope={dirty:i,ctx:o}),l.$set(a)},i(o){n||(b(r),b(l.$$.fragment,o),n=!0)},o(o){C(r),C(l.$$.fragment,o),n=!1},d(o){o&&w(e),r&&r.d(o),F(l,o)}}}function qo(t,e,l){let n,r,o;oe(t,V,S=>l(1,n=S)),oe(t,le,S=>l(2,r=S)),oe(t,et,S=>l(18,o=S));let i=!1;function a(){te(V,n.links=[],n),te(V,n.jats=[],n),te(V,n.bus_stops=[],n)}function s(){let S=al(n.links.length);te(V,n.links=[...n.links,S],n),te(le,r={kind:"edit-link",idx:n.links.length-1},r)}function u(){if(!o)return;let S=ul(n.jats.length,o.getCenter().toArray());te(V,n.jats=[...n.jats,S],n),te(le,r={kind:"edit-jat",idx:n.jats.length-1},r)}function c(){if(!o)return;let S=cl(n.bus_stops.length,o.getCenter().toArray());te(V,n.bus_stops=[...n.bus_stops,S],n),te(le,r={kind:"edit-bus-stop",idx:n.bus_stops.length-1},r)}return[i,n,r,a,s,u,c,()=>l(0,i=!1),S=>te(le,r={kind:"edit-link",idx:S.detail.features[0].id},r),S=>te(le,r={kind:"edit-jat",idx:S.detail.features[0].id},r),S=>te(le,r={kind:"edit-bus-stop",idx:S.detail.features[0].id},r),()=>Bl("rcv2.geojson",JSON.stringify(n)),()=>l(0,i=!0),S=>te(le,r={kind:"edit-link",idx:S},r),S=>te(le,r={kind:"edit-question",idx:S},r),(S,J)=>J.properties.answers[S]!="",S=>te(le,r={kind:"edit-jat",idx:S},r),S=>te(le,r={kind:"edit-bus-stop",idx:S},r)]}class Po extends pe{constructor(e){super(),_e(this,e,qo,Do,ge,{})}}function Oo(t){let e,l;return{c(){e=h("div"),l=h("div"),z(e,"slot","left")},m(n,r){v(n,e,r),d(e,l),t[9](l)},p:re,d(n){n&&w(e),t[9](null)}}}function Fo(t){return{c:re,m:re,p:re,i:re,o:re,d:re}}function Bo(t){let e,l,n;function r(i){t[8](i)}let o={style:t[10],standardControls:!0,hash:!0,$$slots:{default:[Zo]},$$scope:{ctx:t}};return t[2]!==void 0&&(o.map=t[2]),e=new Vn({props:o}),be.push(()=>Me(e,"map",r)),{c(){P(e.$$.fragment)},m(i,a){O(e,i,a),n=!0},p(i,a){const s={};a&2058&&(s.$$scope={dirty:a,ctx:i}),!l&&a&4&&(l=!0,s.map=i[2],Ie(()=>l=!1)),e.$set(s)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Jo(t){let e,l;return e=new $o({props:{qIdx:t[3].idx}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.qIdx=n[3].idx),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function zo(t){let e,l;return e=new Sl({props:{idx:t[3].idx}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ro(t){let e,l;return e=new Ur({props:{junctionIdx:t[3].idx,stage:t[3].stage}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.junctionIdx=n[3].idx),r&8&&(o.stage=n[3].stage),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ho(t){let e,l;return e=new xr({props:{idx:t[3].idx}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Go(t){let e,l;return e=new mo({props:{idx:t[3].idx}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Uo(t){let e,l;return e=new Po({}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Zo(t){let e,l,n,r,o,i;const a=[Uo,Go,Ho,Ro,zo,Jo],s=[];function u(c,m){return c[3].kind=="neutral"?0:c[3].kind=="edit-link"?1:c[3].kind=="edit-jat"?2:c[3].kind=="edit-jat-detail"?3:c[3].kind=="edit-bus-stop"?4:c[3].kind=="edit-question"?5:-1}return~(n=u(t))&&(r=s[n]=a[n](t)),{c(){e=h("div"),l=A(),r&&r.c(),o=lt()},m(c,m){v(c,e,m),t[7](e),v(c,l,m),~n&&s[n].m(c,m),v(c,o,m),i=!0},p(c,m){let p=n;n=u(c),n===p?~n&&s[n].p(c,m):(r&&($e(),C(s[p],1,1,()=>{s[p]=null}),ke()),~n?(r=s[n],r?r.p(c,m):(r=s[n]=a[n](c),r.c()),b(r,1),r.m(o.parentNode,o)):r=null)},i(c){i||(b(r),i=!0)},o(c){C(r),i=!1},d(c){c&&(w(e),w(l),w(o)),t[7](null),~n&&s[n].d(c)}}}function Ko(t){return{c:re,m:re,p:re,i:re,o:re,d:re}}function Xo(t){let e,l,n={ctx:t,current:null,token:null,hasCatch:!1,pending:Ko,then:Bo,catch:Fo,value:10,blocks:[,,,]};return Qn(Ll(new URLSearchParams(window.location.search).get("google")||""),n),{c(){e=h("div"),n.block.c(),z(e,"slot","main"),ee(e,"position","relative"),ee(e,"width","100%"),ee(e,"height","100vh")},m(r,o){v(r,e,o),n.block.m(e,n.anchor=null),n.mount=()=>e,n.anchor=null,l=!0},p(r,o){t=r,Yn(n,t,o)},i(r){l||(b(n.block),l=!0)},o(r){for(let o=0;o<3;o+=1){const i=n.blocks[o];C(i)}l=!1},d(r){r&&w(e),n.block.d(),n.token=null,n=null}}}function Wo(t){let e,l;return e=new Wn({props:{$$slots:{main:[Xo],left:[Oo]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&2063&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Vo(t,e,l){let n,r,o,i,a;oe(t,mt,f=>l(4,n=f)),oe(t,ft,f=>l(5,r=f)),oe(t,V,f=>l(6,o=f)),oe(t,et,f=>l(2,i=f)),oe(t,le,f=>l(3,a=f));let s,u;function c(f){be[f?"unshift":"push"](()=>{u=f,l(1,u),l(4,n)})}function m(f){i=f,et.set(i)}function p(f){be[f?"unshift":"push"](()=>{s=f,l(0,s),l(5,r)})}return t.$$.update=()=>{t.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(o)),t.$$.dirty&33&&s&&r&&(l(0,s.innerHTML="",s),s.appendChild(r)),t.$$.dirty&18&&u&&n&&(l(1,u.innerHTML="",u),u.appendChild(n))},[s,u,i,a,n,r,o,c,m,p]}class Qo extends pe{constructor(e){super(),_e(this,e,Vo,Wo,ge,{})}}new Qo({target:document.getElementById("app")});
