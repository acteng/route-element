import{V as Dn,W as qn,X as We,r as ue,e as y,v as fe,t as k,Y as Pn,S as ie,i as se,s as ae,Z as Fn,_ as On,$ as ee,a0 as Bn,L as zn,b as de,a as we,c as D,m as q,d as ye,f as P,g as Jn,h as De,u as qe,j as Pe,k as Fe,l as ve,y as $,z as C,q as b,w as v,a1 as Ue,M as Ee,A as R,a2 as Ye,U as V,p as Ze,G as ge,D as Oe,E as Ce,B as te,Q as G,a3 as Ke,o as K,F as H,a4 as et,O as g,N as oe,a5 as Se,x as le,R as _e,a6 as Q,a7 as Be,a8 as tt,a9 as ot,H as re,K as nt,aa as Rn,ab as lt,ac as Hn,C as ze,P as Tn,ad as Gn,I as Un,T as Zn}from"./Layout-58a65f18.js";function Kn(n,e){const l=e.token={};function t(r,o,i,c){if(e.token!==l)return;e.resolved=c;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=c);const u=r&&(e.current=r)(s);let a=!1;e.block&&(e.blocks?e.blocks.forEach((f,m)=>{m!==o&&f&&(ue(),y(f,1,1,()=>{e.blocks[m]===f&&(e.blocks[m]=null)}),fe())}):e.block.d(1),u.c(),k(u,1),u.m(e.mount(),e.anchor),a=!0),e.block=u,e.blocks&&(e.blocks[o]=u),a&&Pn()}if(Dn(n)){const r=qn();if(n.then(o=>{We(r),t(e.then,1,e.value,o),We(null)},o=>{if(We(r),t(e.catch,2,e.error,o),We(null),!e.hasCatch)throw o}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function Xn(n,e,l){const t=e.slice(),{resolved:r}=n;n.current===n.then&&(t[n.value]=r),n.current===n.catch&&(t[n.error]=r),n.block.p(t,l)}function Wn(n,e,l){let t;const r=Fn();let{layer:o=void 0}=e;const{map:i}=On();ee(n,i,a=>l(2,t=a));function c(a){r(a.type,{...a,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Bn(()=>{if(t)if(o)for(const a of s)t.off(a,o,c);else for(const a of u)t.off(a,c)}),n.$$set=a=>{"layer"in a&&l(1,o=a.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(o)for(const a of s)t.on(a,o,c);else for(const a of u)t.on(a,c)},[i,o,t]}class Mn extends ie{constructor(e){super(),se(this,e,Wn,null,ae,{layer:1})}}function Vn(n){let e;const l=n[16].default,t=De(l,n,n[24],null);return{c(){t&&t.c()},m(r,o){t&&t.m(r,o),e=!0},p(r,o){t&&t.p&&(!e||o&16777216)&&qe(t,l,r,r[24],e?Fe(l,r[24],o,null):Pe(r[24]),null)},i(r){e||(k(t,r),e=!0)},o(r){y(t,r),e=!1},d(r){t&&t.d(r)}}}function Qn(n){let e,l,t;function r(i){n[17](i)}let o={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Vn]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.hovered=n[0]),e=new zn({props:o}),de.push(()=>we(e,"hovered",r)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){D(e.$$.fragment)},m(i,c){q(e,i,c),t=!0},p(i,[c]){const s={};c&2&&(s.id=i[1]),c&4&&(s.source=i[2]),c&8&&(s.sourceLayer=i[3]),c&16&&(s.beforeId=i[4]),c&32&&(s.beforeLayerType=i[5]),c&64&&(s.paint=i[6]),c&128&&(s.layout=i[7]),c&256&&(s.filter=i[8]),c&512&&(s.applyToClusters=i[9]),c&1024&&(s.minzoom=i[10]),c&2048&&(s.maxzoom=i[11]),c&4096&&(s.hoverCursor=i[12]),c&8192&&(s.manageHoverState=i[13]),c&16384&&(s.eventsIfTopMost=i[14]),c&32768&&(s.interactive=i[15]),c&16777216&&(s.$$scope={dirty:c,ctx:i}),!l&&c&1&&(l=!0,s.hovered=i[0],ye(()=>l=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){P(e,i)}}}function Yn(n,e,l){let{$$slots:t={},$$scope:r}=e,{id:o=Jn("symbol")}=e,{source:i=void 0}=e,{sourceLayer:c=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:a=void 0}=e,{layout:f=void 0}=e,{filter:m=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:_=void 0}=e,{hoverCursor:N=void 0}=e,{manageHoverState:h=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:T=!0}=e;function A(j){w=j,l(0,w)}function S(j){ve.call(this,n,j)}function J(j){ve.call(this,n,j)}function I(j){ve.call(this,n,j)}function z(j){ve.call(this,n,j)}function M(j){ve.call(this,n,j)}function E(j){ve.call(this,n,j)}return n.$$set=j=>{"id"in j&&l(1,o=j.id),"source"in j&&l(2,i=j.source),"sourceLayer"in j&&l(3,c=j.sourceLayer),"beforeId"in j&&l(4,s=j.beforeId),"beforeLayerType"in j&&l(5,u=j.beforeLayerType),"paint"in j&&l(6,a=j.paint),"layout"in j&&l(7,f=j.layout),"filter"in j&&l(8,m=j.filter),"applyToClusters"in j&&l(9,d=j.applyToClusters),"minzoom"in j&&l(10,p=j.minzoom),"maxzoom"in j&&l(11,_=j.maxzoom),"hoverCursor"in j&&l(12,N=j.hoverCursor),"manageHoverState"in j&&l(13,h=j.manageHoverState),"hovered"in j&&l(0,w=j.hovered),"eventsIfTopMost"in j&&l(14,O=j.eventsIfTopMost),"interactive"in j&&l(15,T=j.interactive),"$$scope"in j&&l(24,r=j.$$scope)},[w,o,i,c,s,u,a,f,m,d,p,_,N,h,O,T,t,A,S,J,I,z,M,E,r]}class xn extends ie{constructor(e){super(),se(this,e,Yn,Qn,ae,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const el=n=>({}),ut=n=>({}),tl=n=>({}),ft=n=>({});function nl(n){let e,l,t,r;const o=n[3].sidebar,i=De(o,n,n[2],ft),c=n[3].map,s=De(c,n,n[2],ut);return{c(){e=$("div"),i&&i.c(),l=C(),t=$("div"),s&&s.c()},m(u,a){b(u,e,a),i&&i.m(e,null),n[4](e),b(u,l,a),b(u,t,a),s&&s.m(t,null),n[5](t),r=!0},p(u,[a]){i&&i.p&&(!r||a&4)&&qe(i,o,u,u[2],r?Fe(o,u[2],a,tl):Pe(u[2]),ft),s&&s.p&&(!r||a&4)&&qe(s,c,u,u[2],r?Fe(c,u[2],a,el):Pe(u[2]),ut)},i(u){r||(k(i,u),k(s,u),r=!0)},o(u){y(i,u),y(s,u),r=!1},d(u){u&&(v(e),v(l),v(t)),i&&i.d(u),n[4](null),s&&s.d(u),n[5](null)}}}function ll(n,e,l){let t,r;ee(n,it,u=>l(0,t=u)),ee(n,st,u=>l(1,r=u));let{$$slots:o={},$$scope:i}=e;function c(u){de[u?"unshift":"push"](()=>{t=u,it.set(t)})}function s(u){de[u?"unshift":"push"](()=>{r=u,st.set(r)})}return n.$$set=u=>{"$$scope"in u&&l(2,i=u.$$scope)},[t,r,i,o,c,s]}class Me extends ie{constructor(e){super(),se(this,e,ll,nl,ae,{})}}let it=Ue(null),st=Ue(null);function ke(){return["","2","1","0","Critical"]}let Ae=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"];function rl(n){let e;return{c(){e=$("span"),R(e,"class","dot svelte-117v9mi"),Ye(e,"outline",n[3]),V(e,"background-color",n[3]?void 0:n[1]),V(e,"border-color",n[3]?n[1]:void 0),V(e,"width",n[2]),V(e,"height",n[2])},m(l,t){b(l,e,t)},p(l,t){t&8&&Ye(e,"outline",l[3]),t&10&&V(e,"background-color",l[3]?void 0:l[1]),t&10&&V(e,"border-color",l[3]?l[1]:void 0),t&4&&V(e,"width",l[2]),t&4&&V(e,"height",l[2])},d(l){l&&v(e)}}}function ol(n){let e,l,t;function r(i){n[4](i)}let o={draggable:!0,$$slots:{default:[rl]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.lngLat=n[0]),e=new Ee({props:o}),de.push(()=>we(e,"lngLat",r)),{c(){D(e.$$.fragment)},m(i,c){q(e,i,c),t=!0},p(i,[c]){const s={};c&46&&(s.$$scope={dirty:c,ctx:i}),!l&&c&1&&(l=!0,s.lngLat=i[0],ye(()=>l=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){P(e,i)}}}function il(n,e,l){let{lngLat:t}=e,{color:r}=e,{radius:o="30px"}=e,{outline:i=!1}=e;function c(s){t=s,l(0,t)}return n.$$set=s=>{"lngLat"in s&&l(0,t=s.lngLat),"color"in s&&l(1,r=s.color),"radius"in s&&l(2,o=s.radius),"outline"in s&&l(3,i=s.outline)},[t,r,o,i,c]}class ct extends ie{constructor(e){super(),se(this,e,il,ol,ae,{lngLat:0,color:1,radius:2,outline:3})}}let Je=Ue(void 0),U=Ue(sl());function ne(n){return{type:"FeatureCollection",features:n}}let Y=Ue({kind:"neutral"});function sl(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if("links"in n&&"jats"in n&&"crossings"in n)return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[]}}function mt(n){let e,l;return e=new ge({props:{data:ne(n[2].links),$$slots:{default:[al]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&4&&(o.data=ne(t[2].links)),r&10&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function al(n){let e,l;return e=new Oe({props:{paint:{"line-color":n[1]?["get","color"]:"black","line-width":6}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&2&&(o.paint={"line-color":t[1]?["get","color"]:"black","line-width":6}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function dt(n){let e,l;return e=new ge({props:{data:ne(n[2].bus_stops),$$slots:{default:[cl]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&4&&(o.data=ne(t[2].bus_stops)),r&8&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function cl(n){let e,l;return e=new Ce({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function pt(n){let e,l;return e=new ge({props:{data:ne(n[2].crossings),$$slots:{default:[ul]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&4&&(o.data=ne(t[2].crossings)),r&8&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function ul(n){let e,l;return e=new Ce({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function gt(n){let e,l;return e=new ge({props:{data:ne(n[2].jats),$$slots:{default:[fl]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&4&&(o.data=ne(t[2].jats)),r&8&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function fl(n){let e,l;return e=new Ce({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function ml(n){let e,l,t,r,o,i=n[0]!="links"&&mt(n),c=n[0]!="bus_stops"&&dt(n),s=n[0]!="crossings"&&pt(n),u=n[0]!="jats"&&gt(n);return{c(){i&&i.c(),e=C(),c&&c.c(),l=C(),s&&s.c(),t=C(),u&&u.c(),r=Ze()},m(a,f){i&&i.m(a,f),b(a,e,f),c&&c.m(a,f),b(a,l,f),s&&s.m(a,f),b(a,t,f),u&&u.m(a,f),b(a,r,f),o=!0},p(a,[f]){a[0]!="links"?i?(i.p(a,f),f&1&&k(i,1)):(i=mt(a),i.c(),k(i,1),i.m(e.parentNode,e)):i&&(ue(),y(i,1,1,()=>{i=null}),fe()),a[0]!="bus_stops"?c?(c.p(a,f),f&1&&k(c,1)):(c=dt(a),c.c(),k(c,1),c.m(l.parentNode,l)):c&&(ue(),y(c,1,1,()=>{c=null}),fe()),a[0]!="crossings"?s?(s.p(a,f),f&1&&k(s,1)):(s=pt(a),s.c(),k(s,1),s.m(t.parentNode,t)):s&&(ue(),y(s,1,1,()=>{s=null}),fe()),a[0]!="jats"?u?(u.p(a,f),f&1&&k(u,1)):(u=gt(a),u.c(),k(u,1),u.m(r.parentNode,r)):u&&(ue(),y(u,1,1,()=>{u=null}),fe())},i(a){o||(k(i),k(c),k(s),k(u),o=!0)},o(a){y(i),y(c),y(s),y(u),o=!1},d(a){a&&(v(e),v(l),v(t),v(r)),i&&i.d(a),c&&c.d(a),s&&s.d(a),u&&u.d(a)}}}function dl(n,e,l){let t;ee(n,U,i=>l(2,t=i));let{except:r}=e,{showLinkColor:o=!1}=e;return n.$$set=i=>{"except"in i&&l(0,r=i.except),"showLinkColor"in i&&l(1,o=i.showLinkColor)},[r,o,t]}class Re extends ie{constructor(e){super(),se(this,e,dl,ml,ae,{except:0,showLinkColor:1})}}const{window:pl}=Ke;function gl(n,e,l){const t=n.slice();return t[9]=e[l],t}function _l(n){let e;return{c(){e=$("option"),e.textContent=`${n[9]}`,e.__value=n[9],oe(e,e.__value)},m(l,t){b(l,e,t)},p:te,d(l){l&&v(e)}}}function hl(n){let e,l,t,r,o,i,c,s,u,a,f,m,d,p,_=K(ke()),N=[];for(let h=0;h<_.length;h+=1)N[h]=_l(gl(n,_,h));return{c(){e=$("div"),l=$("button"),l.textContent="Done",t=C(),r=$("button"),r.textContent="Delete bus stop",o=C(),i=$("label"),c=H(`Name:
      `),s=$("input"),u=C(),a=$("label"),f=H(`ST20: bus stops
      `),m=$("select");for(let h=0;h<N.length;h+=1)N[h].c();R(s,"type","text"),n[1].bus_stops[n[0]].properties.st20===void 0&&et(()=>n[8].call(m)),R(e,"slot","sidebar")},m(h,w){b(h,e,w),g(e,l),g(e,t),g(e,r),g(e,o),g(e,i),g(i,c),g(i,s),oe(s,n[1].bus_stops[n[0]].properties.name),g(e,u),g(e,a),g(a,f),g(a,m);for(let O=0;O<N.length;O+=1)N[O]&&N[O].m(m,null);Se(m,n[1].bus_stops[n[0]].properties.st20,!0),d||(p=[G(l,"click",n[6]),G(r,"click",n[4]),G(s,"input",n[7]),G(m,"change",n[8])],d=!0)},p(h,w){w&3&&s.value!==h[1].bus_stops[h[0]].properties.name&&oe(s,h[1].bus_stops[h[0]].properties.name),w&3&&Se(m,h[1].bus_stops[h[0]].properties.st20)},d(h){h&&v(e),le(N,h),d=!1,_e(p)}}}function $l(n){let e,l;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function kl(n){let e,l,t,r,o,i,c,s;l=new Re({props:{except:"bus_stops"}}),r=new ge({props:{data:ne(n[1].bus_stops),generateId:!0,$$slots:{default:[$l]},$$scope:{ctx:n}}});function u(f){n[5](f)}let a={color:n[1].bus_stops[n[0]].properties.color};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(a.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),i=new ct({props:a}),de.push(()=>we(i,"lngLat",u)),{c(){e=$("div"),D(l.$$.fragment),t=C(),D(r.$$.fragment),o=C(),D(i.$$.fragment),R(e,"slot","map")},m(f,m){b(f,e,m),q(l,e,null),g(e,t),q(r,e,null),g(e,o),q(i,e,null),s=!0},p(f,m){const d={};m&2&&(d.data=ne(f[1].bus_stops)),m&4097&&(d.$$scope={dirty:m,ctx:f}),r.$set(d);const p={};m&3&&(p.color=f[1].bus_stops[f[0]].properties.color),!c&&m&3&&(c=!0,p.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,ye(()=>c=!1)),i.$set(p)},i(f){s||(k(l.$$.fragment,f),k(r.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),y(r.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),P(l),P(r),P(i)}}}function bl(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[kl],sidebar:[hl]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(o,i){q(e,o,i),l=!0,t||(r=G(pl,"keydown",n[3]),t=!0)},p(o,[i]){const c={};i&4103&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){P(e,o),t=!1,r()}}}function vl(n,e,l){let t,r;ee(n,U,m=>l(1,t=m)),ee(n,Y,m=>l(2,r=m));let{idx:o}=e;function i(m){m.key=="Escape"&&Q(Y,r={kind:"neutral"},r)}async function c(){window.confirm("Really delete this bus stop?")&&(Q(Y,r={kind:"neutral"},r),await Be(),t.bus_stops.splice(o,1),U.set(t))}function s(m){n.$$.not_equal(t.bus_stops[o].geometry.coordinates,m)&&(t.bus_stops[o].geometry.coordinates=m,U.set(t))}const u=()=>Q(Y,r={kind:"neutral"},r);function a(){t.bus_stops[o].properties.name=this.value,U.set(t)}function f(){t.bus_stops[o].properties.st20=tt(this),U.set(t)}return n.$$set=m=>{"idx"in m&&l(0,o=m.idx)},[o,t,r,i,c,s,u,a,f]}class wl extends ie{constructor(e){super(),se(this,e,vl,bl,ae,{idx:0})}}const{window:yl}=Ke;function jl(n,e,l){const t=n.slice();return t[9]=e[l],t}function Cl(n){let e;return{c(){e=$("option"),e.textContent=`${n[9]}`,e.__value=n[9],oe(e,e.__value)},m(l,t){b(l,e,t)},p:te,d(l){l&&v(e)}}}function Ll(n){let e,l,t,r,o,i,c,s,u,a,f,m,d,p,_=K(ke()),N=[];for(let h=0;h<_.length;h+=1)N[h]=Cl(jl(n,_,h));return{c(){e=$("div"),l=$("button"),l.textContent="Done",t=C(),r=$("button"),r.textContent="Delete crossing",o=C(),i=$("label"),c=H(`Name:
      `),s=$("input"),u=C(),a=$("label"),f=H(`SA10: pedestrian crossing speed
      `),m=$("select");for(let h=0;h<N.length;h+=1)N[h].c();R(s,"type","text"),n[1].crossings[n[0]].properties.sa10===void 0&&et(()=>n[8].call(m)),R(e,"slot","sidebar")},m(h,w){b(h,e,w),g(e,l),g(e,t),g(e,r),g(e,o),g(e,i),g(i,c),g(i,s),oe(s,n[1].crossings[n[0]].properties.name),g(e,u),g(e,a),g(a,f),g(a,m);for(let O=0;O<N.length;O+=1)N[O]&&N[O].m(m,null);Se(m,n[1].crossings[n[0]].properties.sa10,!0),d||(p=[G(l,"click",n[6]),G(r,"click",n[4]),G(s,"input",n[7]),G(m,"change",n[8])],d=!0)},p(h,w){w&3&&s.value!==h[1].crossings[h[0]].properties.name&&oe(s,h[1].crossings[h[0]].properties.name),w&3&&Se(m,h[1].crossings[h[0]].properties.sa10)},d(h){h&&v(e),le(N,h),d=!1,_e(p)}}}function Sl(n){let e,l;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Al(n){let e,l,t,r,o,i,c,s;l=new Re({props:{except:"crossings"}}),r=new ge({props:{data:ne(n[1].crossings),generateId:!0,$$slots:{default:[Sl]},$$scope:{ctx:n}}});function u(f){n[5](f)}let a={color:n[1].crossings[n[0]].properties.color};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(a.lngLat=n[1].crossings[n[0]].geometry.coordinates),i=new ct({props:a}),de.push(()=>we(i,"lngLat",u)),{c(){e=$("div"),D(l.$$.fragment),t=C(),D(r.$$.fragment),o=C(),D(i.$$.fragment),R(e,"slot","map")},m(f,m){b(f,e,m),q(l,e,null),g(e,t),q(r,e,null),g(e,o),q(i,e,null),s=!0},p(f,m){const d={};m&2&&(d.data=ne(f[1].crossings)),m&4097&&(d.$$scope={dirty:m,ctx:f}),r.$set(d);const p={};m&3&&(p.color=f[1].crossings[f[0]].properties.color),!c&&m&3&&(c=!0,p.lngLat=f[1].crossings[f[0]].geometry.coordinates,ye(()=>c=!1)),i.$set(p)},i(f){s||(k(l.$$.fragment,f),k(r.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),y(r.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),P(l),P(r),P(i)}}}function Tl(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[Al],sidebar:[Ll]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(o,i){q(e,o,i),l=!0,t||(r=G(yl,"keydown",n[3]),t=!0)},p(o,[i]){const c={};i&4103&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){P(e,o),t=!1,r()}}}function Ml(n,e,l){let t,r;ee(n,U,m=>l(1,t=m)),ee(n,Y,m=>l(2,r=m));let{idx:o}=e;function i(m){m.key=="Escape"&&Q(Y,r={kind:"neutral"},r)}async function c(){window.confirm("Really delete this crossing?")&&(Q(Y,r={kind:"neutral"},r),await Be(),t.crossings.splice(o,1),U.set(t))}function s(m){n.$$.not_equal(t.crossings[o].geometry.coordinates,m)&&(t.crossings[o].geometry.coordinates=m,U.set(t))}const u=()=>Q(Y,r={kind:"neutral"},r);function a(){t.crossings[o].properties.name=this.value,U.set(t)}function f(){t.crossings[o].properties.sa10=tt(this),U.set(t)}return n.$$set=m=>{"idx"in m&&l(0,o=m.idx)},[o,t,r,i,c,s,u,a,f]}class Il extends ie{constructor(e){super(),se(this,e,Ml,Tl,ae,{idx:0})}}let _t="MZEJTanw3WpxRvt7qDfo";async function Nl(n){return n?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await El(n)}&key=${n}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${_t}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${_t}`}async function El(n){try{let l=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB"})})).json();return"session"in l?l.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(l)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}const Dl="/route-element/assets/right-arrow-d8c7892c.svg";function ht(n){let e,l;const t=n[4].default,r=De(t,n,n[3],null);return{c(){e=$("div"),r&&r.c(),R(e,"class","section svelte-zax3q3")},m(o,i){b(o,e,i),r&&r.m(e,null),l=!0},p(o,i){r&&r.p&&(!l||i&8)&&qe(r,t,o,o[3],l?Fe(t,o[3],i,null):Pe(o[3]),null)},i(o){l||(k(r,o),l=!0)},o(o){y(r,o),l=!1},d(o){o&&v(e),r&&r.d(o)}}}function ql(n){let e,l,t,r,o,i,c,s,u,a,f,m,d=n[2]&&ht(n);return{c(){e=$("button"),l=$("div"),t=$("span"),r=H(n[0]),o=C(),i=$("img"),u=C(),d&&d.c(),R(i,"class","arrow svelte-zax3q3"),ot(i.src,c=Dl)||R(i,"src",c),R(i,"alt",s="Select "+n[0]),R(l,"class","top-section section svelte-zax3q3"),Ye(l,"bordered",n[2]),R(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m(p,_){b(p,e,_),g(e,l),g(l,t),g(t,r),g(l,o),g(l,i),g(e,u),d&&d.m(e,null),a=!0,f||(m=[G(e,"click",n[5]),G(e,"mouseenter",n[6]),G(e,"mouseleave",n[7])],f=!0)},p(p,[_]){(!a||_&1)&&re(r,p[0]),(!a||_&1&&s!==(s="Select "+p[0]))&&R(i,"alt",s),(!a||_&4)&&Ye(l,"bordered",p[2]),p[2]?d?(d.p(p,_),_&4&&k(d,1)):(d=ht(p),d.c(),k(d,1),d.m(e,null)):d&&(ue(),y(d,1,1,()=>{d=null}),fe()),(!a||_&2)&&(e.disabled=p[1])},i(p){a||(k(d),a=!0)},o(p){y(d),a=!1},d(p){p&&v(e),d&&d.d(),f=!1,_e(m)}}}function Pl(n,e,l){let{$$slots:t={},$$scope:r}=e,{name:o}=e,{disabled:i=!1}=e,{hasSlot:c=!0}=e;function s(f){ve.call(this,n,f)}function u(f){ve.call(this,n,f)}function a(f){ve.call(this,n,f)}return n.$$set=f=>{"name"in f&&l(0,o=f.name),"disabled"in f&&l(1,i=f.disabled),"hasSlot"in f&&l(2,c=f.hasSlot),"$$scope"in f&&l(3,r=f.$$scope)},[o,i,c,r,t,s,u,a]}class In extends ie{constructor(e){super(),se(this,e,Pl,ql,ae,{name:0,disabled:1,hasSlot:2})}}let Le={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const Fl=n=>({dialog:n&1}),$t=n=>({dialog:n[0]});function Ol(n){let e,l,t,r,o;const i=n[4].default,c=De(i,n,n[3],$t);return{c(){e=$("dialog"),l=$("article"),c&&c.c(),e.open=!0},m(s,u){b(s,e,u),g(e,l),c&&c.m(l,null),n[6](e),t=!0,r||(o=[G(window,"click",n[1]),G(window,"keydown",n[2]),G(e,"close",n[5])],r=!0)},p(s,[u]){c&&c.p&&(!t||u&9)&&qe(c,i,s,s[3],t?Fe(i,s[3],u,Fl):Pe(s[3]),$t)},i(s){t||(k(c,s),t=!0)},o(s){y(c,s),t=!1},d(s){s&&v(e),c&&c.d(s),n[6](null),r=!1,_e(o)}}}function Bl(n,e,l){let{$$slots:t={},$$scope:r}=e,o;function i(a){o.open&&a.target==o&&o.close()}function c(a){(a.key=="Escape"||a.key=="Enter")&&(a.stopPropagation(),o.close())}function s(a){ve.call(this,n,a)}function u(a){de[a?"unshift":"push"](()=>{o=a,l(0,o)})}return n.$$set=a=>{"$$scope"in a&&l(3,r=a.$$scope)},[o,i,c,r,t,s,u]}class Nn extends ie{constructor(e){super(),se(this,e,Bl,Ol,ae,{})}}function zl(n,e){let l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),l.setAttribute("download",n),document.body.appendChild(l),l.click(),document.body.removeChild(l)}const Ie={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius â‰¥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},at=Object.keys(Ie);function xe(n){return Object.keys(Ie[n])}const Te="All movements";function kt(n,e){let l=[],t=Ie[n][e];t&&l.push({junctionType:n,movementType:e,...t});let r=Ie[n][Te];if(r&&e!=Te&&l.push({junctionType:n,movementType:Te,...r}),n=="Crossroads"){let o=Ie["Simple priority T-junction"][Te];o&&l.push({junctionType:"Simple priority T-junction",movementType:Te,...o})}if(n!="Any type of junction"){let o=Ie["Any type of junction"][Te];o&&l.push({junctionType:"Any type of junction",movementType:Te,...o})}return l}function bt(n,e,l){const t=n.slice();return t[10]=e[l],t}function vt(n,e,l){const t=n.slice();return t[13]=e[l],t}function wt(n,e,l){const t=n.slice();return t[13]=e[l],t}function yt(n,e,l){const t=n.slice();return t[13]=e[l],t}function jt(n,e,l){const t=n.slice();return t[20]=e[l],t}function Ct(n,e,l){const t=n.slice();return t[20]=e[l],t}function Lt(n){let e,l;return e=new Nn({props:{$$slots:{default:[Jl]},$$scope:{ctx:n}}}),e.$on("close",n[9]),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&33554439&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function St(n){let e,l,t,r,o,i,c,s;return i=nt(n[6][1]),{c(){e=$("label"),l=$("input"),t=C(),r=H(n[20]),o=C(),R(l,"type","radio"),l.__value=n[20],oe(l,l.__value),i.p(l)},m(u,a){b(u,e,a),g(e,l),l.checked=l.__value===n[1],g(e,t),g(e,r),g(e,o),c||(s=[G(l,"change",n[5]),G(l,"change",n[3])],c=!0)},p(u,a){a&2&&(l.checked=l.__value===u[1])},d(u){u&&v(e),i.r(),c=!1,_e(s)}}}function At(n){let e,l,t,r=!1,o,i=n[20]+"",c,s,u,a,f;return u=nt(n[6][0]),{c(){e=$("label"),l=$("input"),o=C(),c=H(i),s=C(),R(l,"type","radio"),l.__value=t=n[20],oe(l,l.__value),u.p(l)},m(m,d){b(m,e,d),g(e,l),l.checked=l.__value===n[2],g(e,o),g(e,c),g(e,s),a||(f=G(l,"change",n[7]),a=!0)},p(m,d){d&2&&t!==(t=m[20])&&(l.__value=t,oe(l,l.__value),r=!0),(r||d&6)&&(l.checked=l.__value===m[2]),d&2&&i!==(i=m[20]+"")&&re(c,i)},d(m){m&&v(e),u.r(),a=!1,f()}}}function Tt(n){let e,l=n[13]+"",t;return{c(){e=$("li"),t=H(l)},m(r,o){b(r,e,o),g(e,t)},p(r,o){o&6&&l!==(l=r[13]+"")&&re(t,l)},d(r){r&&v(e)}}}function Mt(n){let e,l=n[13]+"",t;return{c(){e=$("li"),t=H(l)},m(r,o){b(r,e,o),g(e,t)},p(r,o){o&6&&l!==(l=r[13]+"")&&re(t,l)},d(r){r&&v(e)}}}function It(n){let e,l=n[13]+"",t;return{c(){e=$("li"),t=H(l)},m(r,o){b(r,e,o),g(e,t)},p(r,o){o&6&&l!==(l=r[13]+"")&&re(t,l)},d(r){r&&v(e)}}}function Nt(n){let e,l,t=n[10].junctionType+"",r,o,i,c,s,u,a=n[10].movementType+"",f,m,d,p,_,N,h,w,O,T,A,S=K(n[10].scoreZero),J=[];for(let j=0;j<S.length;j+=1)J[j]=Tt(yt(n,S,j));let I=K(n[10].scoreOne),z=[];for(let j=0;j<I.length;j+=1)z[j]=Mt(wt(n,I,j));let M=K(n[10].scoreTwo),E=[];for(let j=0;j<M.length;j+=1)E[j]=It(vt(n,M,j));return{c(){e=$("tr"),l=$("td"),r=H(t),o=C(),i=$("br"),c=C(),s=$("br"),u=C(),f=H(a),m=C(),d=$("td"),p=$("ul");for(let j=0;j<J.length;j+=1)J[j].c();_=C(),N=$("td"),h=$("ul");for(let j=0;j<z.length;j+=1)z[j].c();w=C(),O=$("td"),T=$("ul");for(let j=0;j<E.length;j+=1)E[j].c();A=C(),R(l,"class","type-row svelte-k4kgn3"),R(d,"class","score-zero svelte-k4kgn3"),R(N,"class","score-one svelte-k4kgn3"),R(O,"class","score-two svelte-k4kgn3")},m(j,Z){b(j,e,Z),g(e,l),g(l,r),g(l,o),g(l,i),g(l,c),g(l,s),g(l,u),g(l,f),g(e,m),g(e,d),g(d,p);for(let L=0;L<J.length;L+=1)J[L]&&J[L].m(p,null);g(e,_),g(e,N),g(N,h);for(let L=0;L<z.length;L+=1)z[L]&&z[L].m(h,null);g(e,w),g(e,O),g(O,T);for(let L=0;L<E.length;L+=1)E[L]&&E[L].m(T,null);g(e,A)},p(j,Z){if(Z&6&&t!==(t=j[10].junctionType+"")&&re(r,t),Z&6&&a!==(a=j[10].movementType+"")&&re(f,a),Z&6){S=K(j[10].scoreZero);let L;for(L=0;L<S.length;L+=1){const pe=yt(j,S,L);J[L]?J[L].p(pe,Z):(J[L]=Tt(pe),J[L].c(),J[L].m(p,null))}for(;L<J.length;L+=1)J[L].d(1);J.length=S.length}if(Z&6){I=K(j[10].scoreOne);let L;for(L=0;L<I.length;L+=1){const pe=wt(j,I,L);z[L]?z[L].p(pe,Z):(z[L]=Mt(pe),z[L].c(),z[L].m(h,null))}for(;L<z.length;L+=1)z[L].d(1);z.length=I.length}if(Z&6){M=K(j[10].scoreTwo);let L;for(L=0;L<M.length;L+=1){const pe=vt(j,M,L);E[L]?E[L].p(pe,Z):(E[L]=It(pe),E[L].c(),E[L].m(T,null))}for(;L<E.length;L+=1)E[L].d(1);E.length=M.length}},d(j){j&&v(e),le(J,j),le(z,j),le(E,j)}}}function Jl(n){let e,l,t,r,o,i,c,s,u,a,f,m,d,p,_,N,h,w=K(at),O=[];for(let I=0;I<w.length;I+=1)O[I]=St(Ct(n,w,I));let T=K(xe(n[1])),A=[];for(let I=0;I<T.length;I+=1)A[I]=At(jt(n,T,I));let S=K(kt(n[1],n[2])),J=[];for(let I=0;I<S.length;I+=1)J[I]=Nt(bt(n,S,I));return{c(){e=$("h1"),e.textContent="LTN 1/20 scoring guidance",l=C(),t=$("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,r=C(),o=$("div"),i=H(`Type of junction:
      `),c=$("fieldset");for(let I=0;I<O.length;I+=1)O[I].c();s=H(`

      Type of movement:
      `),u=$("fieldset");for(let I=0;I<A.length;I+=1)A[I].c();a=C(),f=$("table"),m=$("tr"),m.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,d=C();for(let I=0;I<J.length;I+=1)J[I].c();p=C(),_=$("button"),_.textContent="OK",V(o,"display","flex"),V(o,"justify-content","space-between")},m(I,z){b(I,e,z),b(I,l,z),b(I,t,z),b(I,r,z),b(I,o,z),g(o,i),g(o,c);for(let M=0;M<O.length;M+=1)O[M]&&O[M].m(c,null);g(o,s),g(o,u);for(let M=0;M<A.length;M+=1)A[M]&&A[M].m(u,null);b(I,a,z),b(I,f,z),g(f,m),g(f,d);for(let M=0;M<J.length;M+=1)J[M]&&J[M].m(f,null);b(I,p,z),b(I,_,z),N||(h=G(_,"click",n[8]),N=!0)},p(I,z){if(z&10){w=K(at);let M;for(M=0;M<w.length;M+=1){const E=Ct(I,w,M);O[M]?O[M].p(E,z):(O[M]=St(E),O[M].c(),O[M].m(c,null))}for(;M<O.length;M+=1)O[M].d(1);O.length=w.length}if(z&6){T=K(xe(I[1]));let M;for(M=0;M<T.length;M+=1){const E=jt(I,T,M);A[M]?A[M].p(E,z):(A[M]=At(E),A[M].c(),A[M].m(u,null))}for(;M<A.length;M+=1)A[M].d(1);A.length=T.length}if(z&6){S=K(kt(I[1],I[2]));let M;for(M=0;M<S.length;M+=1){const E=bt(I,S,M);J[M]?J[M].p(E,z):(J[M]=Nt(E),J[M].c(),J[M].m(f,null))}for(;M<J.length;M+=1)J[M].d(1);J.length=S.length}},d(I){I&&(v(e),v(l),v(t),v(r),v(o),v(a),v(f),v(p),v(_)),le(O,I),le(A,I),le(J,I),N=!1,h()}}}function Rl(n){let e,l,t,r,o,i,c=n[0]&&Lt(n);return{c(){e=$("button"),e.textContent="LTN 1/20 scoring guidance",l=C(),c&&c.c(),t=Ze(),R(e,"class","secondary")},m(s,u){b(s,e,u),b(s,l,u),c&&c.m(s,u),b(s,t,u),r=!0,o||(i=G(e,"click",n[4]),o=!0)},p(s,[u]){s[0]?c?(c.p(s,u),u&1&&k(c,1)):(c=Lt(s),c.c(),k(c,1),c.m(t.parentNode,t)):c&&(ue(),y(c,1,1,()=>{c=null}),fe())},i(s){r||(k(c),r=!0)},o(s){y(c),r=!1},d(s){s&&(v(e),v(l),v(t)),c&&c.d(s),o=!1,i()}}}function Hl(n,e,l){let t=!1,r=at[0],o=xe(r)[0];function i(){l(2,o=xe(r)[0])}const c=[[],[]],s=()=>l(0,t=!0);function u(){r=this.__value,l(1,r)}function a(){o=this.__value,l(2,o)}return[t,r,o,i,s,u,c,a,()=>l(0,t=!1),()=>l(0,t=!1)]}class Gl extends ie{constructor(e){super(),se(this,e,Hl,Rl,ae,{})}}function Et(n,e,l){const t=n.slice();return t[11]=e[l][0],t[12]=e[l][1],t}function Dt(n){let e,l;return e=new Gl({}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function qt(n){let e,l,t,r=n[12]+"",o,i,c,s,u;return c=nt(n[7][0]),{c(){e=$("label"),l=$("input"),t=C(),o=H(r),i=C(),R(l,"type","radio"),l.__value=n[11],oe(l,l.__value),c.p(l)},m(a,f){b(a,e,f),g(e,l),l.checked=l.__value===n[3].jats[n[0]].properties[n[1]].movements[n[2]].score,g(e,t),g(e,o),g(e,i),s||(u=G(l,"change",n[9]),s=!0)},p(a,f){f&15&&(l.checked=l.__value===a[3].jats[a[0]].properties[a[1]].movements[a[2]].score)},d(a){a&&v(e),c.r(),s=!1,u()}}}function Ul(n){let e,l,t,r,o,i,c,s,u,a,f,m,d,p,_,N,h,w,O,T,A,S,J,I=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind=="cycling"&&Dt(),z=K(n[4]),M=[];for(let E=0;E<z.length;E+=1)M[E]=qt(Et(n,z,E));return A=nt(n[7][1]),{c(){e=$("label"),l=H(`Name
  `),t=$("input"),r=C(),o=$("fieldset"),i=$("label"),c=$("input"),s=H(`
    Cycling`),u=C(),a=$("label"),f=$("input"),m=H(`
    Walking & Wheeling`),d=C(),I&&I.c(),p=C(),_=$("fieldset");for(let E=0;E<M.length;E+=1)M[E].c();N=C(),h=$("label"),w=H(`Comments
  `),O=$("textarea"),R(t,"type","text"),R(c,"type","radio"),c.__value="cycling",oe(c,c.__value),R(f,"type","radio"),f.__value="walking & wheeling",oe(f,f.__value),A.p(c,f)},m(E,j){b(E,e,j),g(e,l),g(e,t),oe(t,n[3].jats[n[0]].properties[n[1]].movements[n[2]].name),b(E,r,j),b(E,o,j),g(o,i),g(i,c),c.checked=c.__value===n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind,g(i,s),g(o,u),g(o,a),g(a,f),f.checked=f.__value===n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind,g(a,m),b(E,d,j),I&&I.m(E,j),b(E,p,j),b(E,_,j);for(let Z=0;Z<M.length;Z+=1)M[Z]&&M[Z].m(_,null);b(E,N,j),b(E,h,j),g(h,w),g(h,O),oe(O,n[3].jats[n[0]].properties[n[1]].movements[n[2]].notes),T=!0,S||(J=[G(t,"input",n[5]),G(c,"change",n[6]),G(f,"change",n[8]),G(O,"input",n[10])],S=!0)},p(E,[j]){if(j&15&&t.value!==E[3].jats[E[0]].properties[E[1]].movements[E[2]].name&&oe(t,E[3].jats[E[0]].properties[E[1]].movements[E[2]].name),j&15&&(c.checked=c.__value===E[3].jats[E[0]].properties[E[1]].movements[E[2]].kind),j&15&&(f.checked=f.__value===E[3].jats[E[0]].properties[E[1]].movements[E[2]].kind),E[3].jats[E[0]].properties[E[1]].movements[E[2]].kind=="cycling"?I?j&15&&k(I,1):(I=Dt(),I.c(),k(I,1),I.m(p.parentNode,p)):I&&(ue(),y(I,1,1,()=>{I=null}),fe()),j&31){z=K(E[4]);let Z;for(Z=0;Z<z.length;Z+=1){const L=Et(E,z,Z);M[Z]?M[Z].p(L,j):(M[Z]=qt(L),M[Z].c(),M[Z].m(_,null))}for(;Z<M.length;Z+=1)M[Z].d(1);M.length=z.length}j&15&&oe(O,E[3].jats[E[0]].properties[E[1]].movements[E[2]].notes)},i(E){T||(k(I),T=!0)},o(E){y(I),T=!1},d(E){E&&(v(e),v(r),v(o),v(d),v(p),v(_),v(N),v(h)),I&&I.d(E),le(M,E),A.r(),S=!1,_e(J)}}}function Zl(n,e,l){let t;ee(n,U,p=>l(3,t=p));let{junctionIdx:r}=e,{stage:o}=e,{idx:i}=e,c=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];const s=[[],[]];function u(){t.jats[r].properties[o].movements[i].name=this.value,U.set(t)}function a(){t.jats[r].properties[o].movements[i].kind=this.__value,U.set(t)}function f(){t.jats[r].properties[o].movements[i].kind=this.__value,U.set(t)}function m(){t.jats[r].properties[o].movements[i].score=this.__value,U.set(t)}function d(){t.jats[r].properties[o].movements[i].notes=this.value,U.set(t)}return n.$$set=p=>{"junctionIdx"in p&&l(0,r=p.junctionIdx),"stage"in p&&l(1,o=p.stage),"idx"in p&&l(2,i=p.idx)},[r,o,i,t,c,u,a,s,f,m,d]}class Kl extends ie{constructor(e){super(),se(this,e,Zl,Ul,ae,{junctionIdx:0,stage:1,idx:2})}}function Xl(n){return n%(2*Math.PI)*180/Math.PI}function Ve(n){return n%360*Math.PI/180}function Pt(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function En(n,e,l={}){if(l.final===!0)return Wl(n,e);const t=Pt(n),r=Pt(e),o=Ve(t[0]),i=Ve(r[0]),c=Ve(t[1]),s=Ve(r[1]),u=Math.sin(i-o)*Math.cos(s),a=Math.cos(c)*Math.sin(s)-Math.sin(c)*Math.cos(s)*Math.cos(i-o);return Xl(Math.atan2(u,a))}function Wl(n,e){let l=En(e,n);return l=(l+180)%360,l}var Ne=En;function Vl(n,e,l={}){const t={type:"Feature"};return(l.id===0||l.id)&&(t.id=l.id),l.bbox&&(t.bbox=l.bbox),t.properties=e||{},t.geometry=n,t}function Ql(n,e,l={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ft(n[0])||!Ft(n[1]))throw new Error("coordinates must contain numbers");return Vl({type:"Point",coordinates:n},e,l)}function Ft(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Yl(n,e={}){const l=Rn(n),t=(l[0]+l[2])/2,r=(l[1]+l[3])/2;return Ql([t,r],e.properties,e)}var xl=Yl,he=63710088e-1,er={centimeters:he*100,centimetres:he*100,degrees:360/(2*Math.PI),feet:he*3.28084,inches:he*39.37,kilometers:he/1e3,kilometres:he/1e3,meters:he,metres:he,miles:he/1609.344,millimeters:he*1e3,millimetres:he*1e3,nauticalmiles:he/1852,radians:1,yards:he*1.0936};function tr(n,e,l={}){const t={type:"Feature"};return(l.id===0||l.id)&&(t.id=l.id),l.bbox&&(t.bbox=l.bbox),t.properties=e||{},t.geometry=n,t}function nr(n,e,l={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Bt(n[0])||!Bt(n[1]))throw new Error("coordinates must contain numbers");return tr({type:"Point",coordinates:n},e,l)}function lr(n,e="kilometers"){const l=er[e];if(!l)throw new Error(e+" units is invalid");return n/l}function Ot(n){return n%(2*Math.PI)*180/Math.PI}function rt(n){return n%360*Math.PI/180}function Bt(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function rr(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function or(n,e,l,t={}){const r=rr(n),o=rt(r[0]),i=rt(r[1]),c=rt(l),s=lr(e,t.units),u=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(c)),a=o+Math.atan2(Math.sin(c)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(u)),f=Ot(a),m=Ot(u);return nr([f,m],t.properties)}var Ge=or,$e=63710088e-1,ir={centimeters:$e*100,centimetres:$e*100,degrees:360/(2*Math.PI),feet:$e*3.28084,inches:$e*39.37,kilometers:$e/1e3,kilometres:$e/1e3,meters:$e,metres:$e,miles:$e/1609.344,millimeters:$e*1e3,millimetres:$e*1e3,nauticalmiles:$e/1852,radians:1,yards:$e*1.0936};function sr(n,e="kilometers"){const l=ir[e];if(!l)throw new Error(e+" units is invalid");return n*l}function Qe(n){return n%360*Math.PI/180}function zt(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ar(n,e,l={}){var t=zt(n),r=zt(e),o=Qe(r[1]-t[1]),i=Qe(r[0]-t[0]),c=Qe(t[1]),s=Qe(r[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(c)*Math.cos(s);return sr(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),l.units)}var cr=ar;function ur(n){let e=xl({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,r)=>Jt(Ne(e,r.point))-Jt(Ne(e,t.point)));let l=[];for(let t=0;t<n.length;t++){let r=n[t],o=Ne(r.point,e),i=1;for(let c of mr(t,n.length)){let s=n[c],u=Ne(e,s.point),a=fr(r.point,e,i++),f=cr(r.point,e),m=Ge(a,.5*f,o).geometry.coordinates,d=Ge(m,.2*f,u).geometry.coordinates;l.push({point1:a,point2:m,point3:d,kind:"cycling",score:"X",name:`${r.name} to ${s.name}`,notes:""})}}return l}function fr(n,e,l){let t=.003,o=Ne(n,e)-90,i=t*l;return Ge(n,i,o).geometry.coordinates}function Jt(n){return(n+360)%360}function mr(n,e){let l=[];for(let t=n+1;t<e;t++)l.push(t);for(let t=0;t<n;t++)l.push(t);return l}const dr="/route-element/assets/movement-aa45473c.svg",pr="/route-element/assets/pan-fbcec4cd.svg";function Rt(n,e,l){const t=n.slice();return t[31]=e[l],t[32]=e,t[33]=l,t}function Ht(n,e,l){const t=n.slice();return t[34]=e[l],t[35]=e,t[33]=l,t}function Gt(n){let e,l,t,r,o,i,c,s,u,a,f,m,d,p,_,N,h,w,O;function T(Z,L){return Z[0].mode=="select"?_r:gr}let A=T(n),S=A(n);function J(Z,L){return Z[0].mode=="new-arm"?$r:hr}let I=J(n),z=I(n);function M(Z,L){return Z[0].mode=="new-movement"?br:kr}let E=M(n),j=E(n);return{c(){e=$("div"),l=$("button"),t=$("img"),o=C(),S.c(),i=C(),c=$("button"),s=lt("svg"),u=lt("circle"),a=lt("text"),f=H("A"),m=C(),z.c(),d=C(),p=$("button"),_=$("img"),h=C(),j.c(),ot(t.src,r=pr)||R(t,"src",r),R(t,"alt","Move map"),V(t,"vertical-align","middle"),R(l,"class","outline"),R(u,"cx","12"),R(u,"cy","12"),R(u,"r","12"),R(u,"fill","white"),R(a,"x","6"),R(a,"y","16"),R(a,"fill","#4472c4"),R(s,"width","24"),R(s,"height","24"),R(s,"xmlns","http://www.w3.org/2000/svg"),V(s,"vertical-align","middle"),R(c,"class","outline"),ot(_.src,N=dr)||R(_,"src",N),R(_,"alt","New movement"),V(_,"vertical-align","middle"),R(p,"class","outline"),R(e,"class","control-panel svelte-l1e6xi")},m(Z,L){b(Z,e,L),g(e,l),g(l,t),g(l,o),S.m(l,null),g(e,i),g(e,c),g(c,s),g(s,u),g(s,a),g(a,f),g(c,m),z.m(c,null),g(e,d),g(e,p),g(p,_),g(p,h),j.m(p,null),w||(O=[G(l,"click",function(){Hn(n[4])&&n[4].apply(this,arguments)}),G(c,"click",n[12]),G(p,"click",n[13])],w=!0)},p(Z,L){n=Z,A!==(A=T(n))&&(S.d(1),S=A(n),S&&(S.c(),S.m(l,null))),I!==(I=J(n))&&(z.d(1),z=I(n),z&&(z.c(),z.m(c,null))),E!==(E=M(n))&&(j.d(1),j=E(n),j&&(j.c(),j.m(p,null)))},d(Z){Z&&v(e),S.d(),z.d(),j.d(),w=!1,_e(O)}}}function gr(n){let e;return{c(){e=H("Move map")},m(l,t){b(l,e,t)},d(l){l&&v(e)}}}function _r(n){let e;return{c(){e=$("b"),e.textContent="Move map"},m(l,t){b(l,e,t)},d(l){l&&v(e)}}}function hr(n){let e;return{c(){e=H("New arm")},m(l,t){b(l,e,t)},d(l){l&&v(e)}}}function $r(n){let e;return{c(){e=$("b"),e.textContent="New arm"},m(l,t){b(l,e,t)},d(l){l&&v(e)}}}function kr(n){let e;return{c(){e=H("New movement")},m(l,t){b(l,e,t)},d(l){l&&v(e)}}}function br(n){let e;return{c(){e=$("b"),e.textContent="New movement"},m(l,t){b(l,e,t)},d(l){l&&v(e)}}}function vr(n){let e;return{c(){e=$("span"),e.textContent=`${Er(n[33])}`,R(e,"class","dot svelte-l1e6xi"),V(e,"color","#4472c4"),V(e,"background-color","white")},m(l,t){b(l,e,t)},p:te,d(l){l&&v(e)}}}function Ut(n){let e,l,t;function r(s){n[14](s,n[34])}function o(){return n[15](n[33])}function i(){return n[16](n[33])}let c={draggable:!0,$$slots:{default:[vr]},$$scope:{ctx:n}};return n[34].point!==void 0&&(c.lngLat=n[34].point),e=new Ee({props:c}),de.push(()=>we(e,"lngLat",r)),e.$on("dragend",o),e.$on("click",i),{c(){D(e.$$.fragment)},m(s,u){q(e,s,u),t=!0},p(s,u){n=s;const a={};u[1]&32&&(a.$$scope={dirty:u,ctx:n}),!l&&u[0]&38&&(l=!0,a.lngLat=n[34].point,ye(()=>l=!1)),e.$set(a)},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){P(e,s)}}}function wr(n){let e;return{c(){e=$("span"),R(e,"class","dot svelte-l1e6xi"),V(e,"background-color",n[7][n[31].score]),V(e,"opacity",n[31].kind=="walking & wheeling"?"0%":"100%")},m(l,t){b(l,e,t)},p(l,t){t[0]&38&&V(e,"background-color",l[7][l[31].score]),t[0]&38&&V(e,"opacity",l[31].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&v(e)}}}function yr(n){let e;return{c(){e=$("span"),R(e,"class","dot svelte-l1e6xi"),V(e,"background-color",n[7][n[31].score])},m(l,t){b(l,e,t)},p(l,t){t[0]&38&&V(e,"background-color",l[7][l[31].score])},d(l){l&&v(e)}}}function jr(n){let e;return{c(){e=$("span"),R(e,"class","dot svelte-l1e6xi"),V(e,"background-color",n[7][n[31].score]),V(e,"opacity","0%")},m(l,t){b(l,e,t)},p(l,t){t[0]&38&&V(e,"background-color",l[7][l[31].score])},d(l){l&&v(e)}}}function Zt(n){let e,l,t,r,o,i,c,s,u;function a(S){n[17](S,n[31])}function f(){return n[18](n[33])}function m(){return n[19](n[33])}let d={draggable:!0,$$slots:{default:[wr]},$$scope:{ctx:n}};n[31].point1!==void 0&&(d.lngLat=n[31].point1),e=new Ee({props:d}),de.push(()=>we(e,"lngLat",a)),e.$on("dragend",f),e.$on("click",m);function p(S){n[20](S,n[31])}function _(){return n[21](n[33])}function N(){return n[22](n[33])}let h={draggable:!0,$$slots:{default:[yr]},$$scope:{ctx:n}};n[31].point2!==void 0&&(h.lngLat=n[31].point2),r=new Ee({props:h}),de.push(()=>we(r,"lngLat",p)),r.$on("dragend",_),r.$on("click",N);function w(S){n[23](S,n[31])}function O(){return n[24](n[33])}function T(){return n[25](n[33])}let A={draggable:!0,$$slots:{default:[jr]},$$scope:{ctx:n}};return n[31].point3!==void 0&&(A.lngLat=n[31].point3),c=new Ee({props:A}),de.push(()=>we(c,"lngLat",w)),c.$on("dragend",O),c.$on("click",T),{c(){D(e.$$.fragment),t=C(),D(r.$$.fragment),i=C(),D(c.$$.fragment)},m(S,J){q(e,S,J),b(S,t,J),q(r,S,J),b(S,i,J),q(c,S,J),u=!0},p(S,J){n=S;const I={};J[0]&38|J[1]&32&&(I.$$scope={dirty:J,ctx:n}),!l&&J[0]&38&&(l=!0,I.lngLat=n[31].point1,ye(()=>l=!1)),e.$set(I);const z={};J[0]&38|J[1]&32&&(z.$$scope={dirty:J,ctx:n}),!o&&J[0]&38&&(o=!0,z.lngLat=n[31].point2,ye(()=>o=!1)),r.$set(z);const M={};J[0]&38|J[1]&32&&(M.$$scope={dirty:J,ctx:n}),!s&&J[0]&38&&(s=!0,M.lngLat=n[31].point3,ye(()=>s=!1)),c.$set(M)},i(S){u||(k(e.$$.fragment,S),k(r.$$.fragment,S),k(c.$$.fragment,S),u=!0)},o(S){y(e.$$.fragment,S),y(r.$$.fragment,S),y(c.$$.fragment,S),u=!1},d(S){S&&(v(t),v(i)),P(e,S),P(r,S),P(c,S)}}}function Cr(n){let e=(n[30].name||"Untitled movement")+"",l;return{c(){l=H(e)},m(t,r){b(t,l,r)},p(t,r){r[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&re(l,e)},d(t){t&&v(l)}}}function Lr(n){let e,l;return e=new Tn({props:{$$slots:{default:[Cr,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Sr(n){let e=(n[30].name||"Untitled movement")+"",l;return{c(){l=H(e)},m(t,r){b(t,l,r)},p(t,r){r[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&re(l,e)},d(t){t&&v(l)}}}function Ar(n){let e,l;return e=new Tn({props:{$$slots:{default:[Sr,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Tr(n){let e,l,t,r,o,i;return e=new Oe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":ze(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Lr]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Oe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":ze(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Ar]},$$scope:{ctx:n}}}),t.$on("click",n[9]),o=new xn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){D(e.$$.fragment),l=C(),D(t.$$.fragment),r=C(),D(o.$$.fragment)},m(c,s){q(e,c,s),b(c,l,s),q(t,c,s),b(c,r,s),q(o,c,s),i=!0},p(c,s){const u={};s[1]&32&&(u.$$scope={dirty:s,ctx:c}),e.$set(u);const a={};s[1]&32&&(a.$$scope={dirty:s,ctx:c}),t.$set(a)},i(c){i||(k(e.$$.fragment,c),k(t.$$.fragment,c),k(o.$$.fragment,c),i=!0)},o(c){y(e.$$.fragment,c),y(t.$$.fragment,c),y(o.$$.fragment,c),i=!1},d(c){c&&(v(l),v(r)),P(e,c),P(t,c),P(o,c)}}}function Mr(n){let e,l,t,r;return e=new Oe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Ce({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){D(e.$$.fragment),l=C(),D(t.$$.fragment)},m(o,i){q(e,o,i),b(o,l,i),q(t,o,i),r=!0},p:te,i(o){r||(k(e.$$.fragment,o),k(t.$$.fragment,o),r=!0)},o(o){y(e.$$.fragment,o),y(t.$$.fragment,o),r=!1},d(o){o&&v(l),P(e,o),P(t,o)}}}function Ir(n){let e,l,t,r,o,i,c,s,u;e=new Mn({}),e.$on("click",n[8]);let a=n[0].mode!="editing"&&Gt(n),f=K(n[5].jats[n[1]].properties[n[2]].arms),m=[];for(let h=0;h<f.length;h+=1)m[h]=Ut(Ht(n,f,h));const d=h=>y(m[h],1,1,()=>{m[h]=null});let p=K(n[5].jats[n[1]].properties[n[2]].movements),_=[];for(let h=0;h<p.length;h+=1)_[h]=Zt(Rt(n,p,h));const N=h=>y(_[h],1,1,()=>{_[h]=null});return i=new ge({props:{data:n[10](n[5]),$$slots:{default:[Tr]},$$scope:{ctx:n}}}),s=new ge({props:{data:n[6],$$slots:{default:[Mr]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment),l=C(),a&&a.c(),t=C();for(let h=0;h<m.length;h+=1)m[h].c();r=C();for(let h=0;h<_.length;h+=1)_[h].c();o=C(),D(i.$$.fragment),c=C(),D(s.$$.fragment)},m(h,w){q(e,h,w),b(h,l,w),a&&a.m(h,w),b(h,t,w);for(let O=0;O<m.length;O+=1)m[O]&&m[O].m(h,w);b(h,r,w);for(let O=0;O<_.length;O+=1)_[O]&&_[O].m(h,w);b(h,o,w),q(i,h,w),b(h,c,w),q(s,h,w),u=!0},p(h,w){if(h[0].mode!="editing"?a?a.p(h,w):(a=Gt(h),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),w[0]&46){f=K(h[5].jats[h[1]].properties[h[2]].arms);let A;for(A=0;A<f.length;A+=1){const S=Ht(h,f,A);m[A]?(m[A].p(S,w),k(m[A],1)):(m[A]=Ut(S),m[A].c(),k(m[A],1),m[A].m(r.parentNode,r))}for(ue(),A=f.length;A<m.length;A+=1)d(A);fe()}if(w[0]&174){p=K(h[5].jats[h[1]].properties[h[2]].movements);let A;for(A=0;A<p.length;A+=1){const S=Rt(h,p,A);_[A]?(_[A].p(S,w),k(_[A],1)):(_[A]=Zt(S),_[A].c(),k(_[A],1),_[A].m(o.parentNode,o))}for(ue(),A=p.length;A<_.length;A+=1)N(A);fe()}const O={};w[0]&32&&(O.data=h[10](h[5])),w[1]&32&&(O.$$scope={dirty:w,ctx:h}),i.$set(O);const T={};w[0]&64&&(T.data=h[6]),w[1]&32&&(T.$$scope={dirty:w,ctx:h}),s.$set(T)},i(h){if(!u){k(e.$$.fragment,h);for(let w=0;w<f.length;w+=1)k(m[w]);for(let w=0;w<p.length;w+=1)k(_[w]);k(i.$$.fragment,h),k(s.$$.fragment,h),u=!0}},o(h){y(e.$$.fragment,h),m=m.filter(Boolean);for(let w=0;w<m.length;w+=1)y(m[w]);_=_.filter(Boolean);for(let w=0;w<_.length;w+=1)y(_[w]);y(i.$$.fragment,h),y(s.$$.fragment,h),u=!1},d(h){h&&(v(l),v(t),v(r),v(o),v(c)),P(e,h),a&&a.d(h),le(m,h),le(_,h),P(i,h),P(s,h)}}}function Nr(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function Er(n){return String.fromCharCode(n+"A".charCodeAt(0))}function Dr(n,e,l){let t,r,o;ee(n,U,B=>l(5,r=B)),ee(n,Je,B=>l(26,o=B));let{junctionIdx:i}=e,{stage:c}=e,{mode:s}=e,{hoveringSidebar:u}=e,{select:a}=e,{stopEditing:f}=e,m={0:Le.red.background,1:Le.amber.background,2:Le.green.background,X:Le.critical.background};function d(B,X,je){let ce={type:"FeatureCollection",features:[]},F=X.mode=="editing"?X.id:je;return F!=null&&(F.kind=="arm"?ce.features.push(Nr(B.jats[i].properties[c].arms[F.idx],F.idx)):ce.features.push(h(B.jats[i].properties[c].movements[F.idx],F.idx))),ce}async function p(B){if(o){for(let X of o.queryRenderedFeatures(B.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await f();return}s.mode=="new-arm"?(Q(U,r.jats[i].properties[c].arms=[...r.jats[i].properties[c].arms,{point:B.detail.lngLat.toArray(),name:""}],r),await a({kind:"arm",idx:r.jats[i].properties[c].arms.length-1})):(Q(U,r.jats[i].properties[c].movements=[...r.jats[i].properties[c].movements,{point1:B.detail.lngLat.toArray(),point2:Ge(B.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Ge(B.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],r),await a({kind:"movement",idx:r.jats[i].properties[c].movements.length-1}))}}}async function _(B){await a({kind:"movement",idx:B.detail.features[0].id})}function N(B){let X={type:"FeatureCollection",features:B.jats[i].properties[c].movements.map((je,ce)=>h(je,ce))};for(let je of B.jats[i].properties[c].movements)if(X.features.push(w(je,X.features.length)),je.kind=="walking & wheeling"){let ce={...je,point1:je.point3,point3:je.point1};X.features.push(w(ce,X.features.length))}return X}function h(B,X){return{type:"Feature",id:X,properties:{name:B.name,kind:B.kind,color:m[B.score]},geometry:{type:"LineString",coordinates:[B.point1,B.point2,B.point3]}}}function w(B,X){return{type:"Feature",id:X,properties:{kind:B.kind,color:m[B.score],angle:Ne(B.point2,B.point3)},geometry:{type:"Point",coordinates:B.point3}}}const O=()=>l(0,s={mode:"new-arm"}),T=()=>l(0,s={mode:"new-movement"});function A(B,X){n.$$.not_equal(X.point,B)&&(X.point=B,U.set(r))}const S=B=>a({kind:"arm",idx:B}),J=B=>a({kind:"arm",idx:B});function I(B,X){n.$$.not_equal(X.point1,B)&&(X.point1=B,U.set(r))}const z=B=>a({kind:"movement",idx:B}),M=B=>a({kind:"movement",idx:B});function E(B,X){n.$$.not_equal(X.point2,B)&&(X.point2=B,U.set(r))}const j=B=>a({kind:"movement",idx:B}),Z=B=>a({kind:"movement",idx:B});function L(B,X){n.$$.not_equal(X.point3,B)&&(X.point3=B,U.set(r))}const pe=B=>a({kind:"movement",idx:B}),me=B=>a({kind:"movement",idx:B});return n.$$set=B=>{"junctionIdx"in B&&l(1,i=B.junctionIdx),"stage"in B&&l(2,c=B.stage),"mode"in B&&l(0,s=B.mode),"hoveringSidebar"in B&&l(11,u=B.hoveringSidebar),"select"in B&&l(3,a=B.select),"stopEditing"in B&&l(4,f=B.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&2081&&l(6,t=d(r,s,u))},[s,i,c,a,f,r,t,m,p,_,N,u,O,T,A,S,J,I,z,M,E,j,Z,L,pe,me]}class qr extends ie{constructor(e){super(),se(this,e,Dr,Ir,ae,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function Kt(n){if(n.movements.length==0)return"No movements added";let e=0,l=0;for(let r of n.movements)e+={0:0,1:1,2:2,X:0}[r.score],l+=2;let t=e/l*100;return`${Math.round(t)}%`}const{window:Pr}=Ke;function Xt(n,e,l){const t=n.slice();t[27]=e[l],t[30]=l;const r=t[14][t[27].score];return t[28]=r,t}function Wt(n,e,l){const t=n.slice();return t[31]=e[l],t[30]=l,t}function Fr(n){let e,l,t,r,o,i,c,s,u;return{c(){e=$("button"),e.textContent="Done",l=C(),t=$("button"),t.textContent="Delete",r=C(),o=$("label"),i=H(`Arm name
        `),c=$("input"),R(c,"type","text")},m(a,f){b(a,e,f),b(a,l,f),b(a,t,f),b(a,r,f),b(a,o,f),g(o,i),g(o,c),oe(c,n[5].jats[n[0]].properties[n[1]].arms[n[2].id.idx].name),s||(u=[G(e,"click",n[23]),G(t,"click",n[10]),G(c,"input",n[24])],s=!0)},p(a,f){f[0]&39&&c.value!==a[5].jats[a[0]].properties[a[1]].arms[a[2].id.idx].name&&oe(c,a[5].jats[a[0]].properties[a[1]].arms[a[2].id.idx].name)},i:te,o:te,d(a){a&&(v(e),v(l),v(t),v(r),v(o)),s=!1,_e(u)}}}function Or(n){let e,l,t,r,o,i,c,s;return e=new Kl({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),{c(){D(e.$$.fragment),l=C(),t=$("button"),t.textContent="Save",r=C(),o=$("button"),o.textContent="Delete"},m(u,a){q(e,u,a),b(u,l,a),b(u,t,a),b(u,r,a),b(u,o,a),i=!0,c||(s=[G(t,"click",n[9]),G(o,"click",n[10])],c=!0)},p(u,a){const f={};a[0]&1&&(f.junctionIdx=u[0]),a[0]&2&&(f.stage=u[1]),a[0]&4&&(f.idx=u[2].id.idx),e.$set(f)},i(u){i||(k(e.$$.fragment,u),i=!0)},o(u){y(e.$$.fragment,u),i=!1},d(u){u&&(v(l),v(t),v(r),v(o)),P(e,u),c=!1,_e(s)}}}function Br(n){let e,l,t,r,o,i,c,s,u,a,f,m,d,p=n[5].jats[n[0]].properties.name+"",_,N,h=Kt(n[5].jats[n[0]].properties[n[1]])+"",w,O,T,A,S,J,I,z,M,E,j,Z=K(n[5].jats[n[0]].properties[n[1]].arms),L=[];for(let F=0;F<Z.length;F+=1)L[F]=Vt(Wt(n,Z,F));const pe=F=>y(L[F],1,1,()=>{L[F]=null});let me=n[5].jats[n[0]].properties[n[7]].arms.length>0&&Qt(n),B=K(n[5].jats[n[0]].properties[n[1]].movements),X=[];for(let F=0;F<B.length;F+=1)X[F]=Yt(Xt(n,B,F));const je=F=>y(X[F],1,1,()=>{X[F]=null});let ce=n[5].jats[n[0]].properties[n[7]].movements.length>0&&xt(n);return{c(){e=$("button"),e.textContent="Done",l=C(),t=$("h3"),t.textContent="Arms",r=C();for(let F=0;F<L.length;F+=1)L[F].c();o=C(),me&&me.c(),i=C(),c=$("h3"),c.textContent="Movements",s=C(),u=$("p"),a=H("Total JAT score for "),f=H(n[1]),m=H(` junction
        `),d=$("i"),_=H(p),N=H(`
        : `),w=H(h),O=C(),T=$("button"),A=H("Generate cycling movements between all arms"),J=C();for(let F=0;F<X.length;F+=1)X[F].c();I=C(),ce&&ce.c(),z=Ze(),R(T,"class","secondary"),T.disabled=S=n[5].jats[n[0]].properties[n[1]].arms.length<2},m(F,W){b(F,e,W),b(F,l,W),b(F,t,W),b(F,r,W);for(let x=0;x<L.length;x+=1)L[x]&&L[x].m(F,W);b(F,o,W),me&&me.m(F,W),b(F,i,W),b(F,c,W),b(F,s,W),b(F,u,W),g(u,a),g(u,f),g(u,m),g(u,d),g(d,_),g(u,N),g(u,w),b(F,O,W),b(F,T,W),g(T,A),b(F,J,W);for(let x=0;x<X.length;x+=1)X[x]&&X[x].m(F,W);b(F,I,W),ce&&ce.m(F,W),b(F,z,W),M=!0,E||(j=[G(e,"click",n[16]),G(T,"click",n[15])],E=!0)},p(F,W){if(W[0]&299){Z=K(F[5].jats[F[0]].properties[F[1]].arms);let x;for(x=0;x<Z.length;x+=1){const He=Wt(F,Z,x);L[x]?(L[x].p(He,W),k(L[x],1)):(L[x]=Vt(He),L[x].c(),k(L[x],1),L[x].m(o.parentNode,o))}for(ue(),x=Z.length;x<L.length;x+=1)pe(x);fe()}if(F[5].jats[F[0]].properties[F[7]].arms.length>0?me?me.p(F,W):(me=Qt(F),me.c(),me.m(i.parentNode,i)):me&&(me.d(1),me=null),(!M||W[0]&2)&&re(f,F[1]),(!M||W[0]&33)&&p!==(p=F[5].jats[F[0]].properties.name+"")&&re(_,p),(!M||W[0]&35)&&h!==(h=Kt(F[5].jats[F[0]].properties[F[1]])+"")&&re(w,h),(!M||W[0]&35&&S!==(S=F[5].jats[F[0]].properties[F[1]].arms.length<2))&&(T.disabled=S),W[0]&16683){B=K(F[5].jats[F[0]].properties[F[1]].movements);let x;for(x=0;x<B.length;x+=1){const He=Xt(F,B,x);X[x]?(X[x].p(He,W),k(X[x],1)):(X[x]=Yt(He),X[x].c(),k(X[x],1),X[x].m(I.parentNode,I))}for(ue(),x=B.length;x<X.length;x+=1)je(x);fe()}F[5].jats[F[0]].properties[F[7]].movements.length>0?ce?ce.p(F,W):(ce=xt(F),ce.c(),ce.m(z.parentNode,z)):ce&&(ce.d(1),ce=null)},i(F){if(!M){for(let W=0;W<Z.length;W+=1)k(L[W]);for(let W=0;W<B.length;W+=1)k(X[W]);M=!0}},o(F){L=L.filter(Boolean);for(let W=0;W<L.length;W+=1)y(L[W]);X=X.filter(Boolean);for(let W=0;W<X.length;W+=1)y(X[W]);M=!1},d(F){F&&(v(e),v(l),v(t),v(r),v(o),v(i),v(c),v(s),v(u),v(O),v(T),v(J),v(I),v(z)),le(L,F),me&&me.d(F),le(X,F),ce&&ce.d(F),E=!1,_e(j)}}}function Vt(n){let e,l;function t(){return n[17](n[30])}function r(){return n[18](n[30])}return e=new In({props:{name:`${en(n[30])} - ${n[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",r),e.$on("mouseleave",n[19]),{c(){D(e.$$.fragment)},m(o,i){q(e,o,i),l=!0},p(o,i){n=o;const c={};i[0]&35&&(c.name=`${en(n[30])} - ${n[31].name||"Unnamed arm"}`),e.$set(c)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){P(e,o)}}}function Qt(n){let e,l,t;return{c(){e=$("button"),e.textContent=`Copy arms from ${n[7]}`,R(e,"class","secondary")},m(r,o){b(r,e,o),l||(t=G(e,"click",n[12]),l=!0)},p:te,d(r){r&&v(e),l=!1,t()}}}function zr(n){let e,l,t,r=n[27].score+"",o,i,c,s=tn(n[27].kind)+"",u;return{c(){e=$("div"),l=$("span"),t=H("Score: "),o=H(r),i=C(),c=$("span"),u=H(s),V(l,"padding","4px"),V(l,"color",n[28].font),V(l,"background-color",n[28].background),V(e,"width","100%"),V(e,"display","flex"),V(e,"justify-content","space-between")},m(a,f){b(a,e,f),g(e,l),g(l,t),g(l,o),g(e,i),g(e,c),g(c,u)},p(a,f){f[0]&35&&r!==(r=a[27].score+"")&&re(o,r),f[0]&35&&V(l,"color",a[28].font),f[0]&35&&V(l,"background-color",a[28].background),f[0]&35&&s!==(s=tn(a[27].kind)+"")&&re(u,s)},d(a){a&&v(e)}}}function Yt(n){let e,l;function t(){return n[20](n[30])}function r(){return n[21](n[30])}return e=new In({props:{name:n[27].name||"Unnamed movement",$$slots:{default:[zr]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",r),e.$on("mouseleave",n[22]),{c(){D(e.$$.fragment)},m(o,i){q(e,o,i),l=!0},p(o,i){n=o;const c={};i[0]&35&&(c.name=n[27].name||"Unnamed movement"),i[0]&35|i[1]&4&&(c.$$scope={dirty:i,ctx:n}),e.$set(c)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){P(e,o)}}}function xt(n){let e,l,t;return{c(){e=$("button"),e.textContent=`Copy movements from ${n[7]}`,R(e,"class","secondary")},m(r,o){b(r,e,o),l||(t=G(e,"click",n[13]),l=!0)},p:te,d(r){r&&v(e),l=!1,t()}}}function Jr(n){let e,l,t,r,o=n[5].jats[n[0]].properties.name+"",i,c,s,u,a;const f=[Br,Or,Fr],m=[];function d(p,_){return p[2].mode!="editing"?0:p[2].id.kind=="movement"?1:2}return s=d(n),u=m[s]=f[s](n),{c(){e=$("div"),l=$("h2"),t=H(n[1]),r=H(" JAT for "),i=H(o),c=C(),u.c(),R(e,"slot","sidebar")},m(p,_){b(p,e,_),g(e,l),g(l,t),g(l,r),g(l,i),g(e,c),m[s].m(e,null),n[25](e),a=!0},p(p,_){(!a||_[0]&2)&&re(t,p[1]),(!a||_[0]&33)&&o!==(o=p[5].jats[p[0]].properties.name+"")&&re(i,o);let N=s;s=d(p),s===N?m[s].p(p,_):(ue(),y(m[N],1,1,()=>{m[N]=null}),fe(),u=m[s],u?u.p(p,_):(u=m[s]=f[s](p),u.c()),k(u,1),u.m(e,null))},i(p){a||(k(u),a=!0)},o(p){y(u),a=!1},d(p){p&&v(e),m[s].d(),n[25](null)}}}function Rr(n){let e,l;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r[0]&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Hr(n){let e,l,t,r,o,i,c;return l=new Re({props:{except:"jats"}}),r=new ge({props:{data:ne(n[5].jats),generateId:!0,$$slots:{default:[Rr]},$$scope:{ctx:n}}}),i=new qr({props:{junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],select:n[8],stopEditing:n[9]}}),{c(){e=$("div"),D(l.$$.fragment),t=C(),D(r.$$.fragment),o=C(),D(i.$$.fragment),R(e,"slot","map")},m(s,u){b(s,e,u),q(l,e,null),g(e,t),q(r,e,null),g(e,o),q(i,e,null),c=!0},p(s,u){const a={};u[0]&32&&(a.data=ne(s[5].jats)),u[0]&1|u[1]&4&&(a.$$scope={dirty:u,ctx:s}),r.$set(a);const f={};u[0]&1&&(f.junctionIdx=s[0]),u[0]&2&&(f.stage=s[1]),u[0]&4&&(f.mode=s[2]),u[0]&8&&(f.hoveringSidebar=s[3]),i.$set(f)},i(s){c||(k(l.$$.fragment,s),k(r.$$.fragment,s),k(i.$$.fragment,s),c=!0)},o(s){y(l.$$.fragment,s),y(r.$$.fragment,s),y(i.$$.fragment,s),c=!1},d(s){s&&v(e),P(l),P(r),P(i)}}}function Gr(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[Hr],sidebar:[Jr]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(o,i){q(e,o,i),l=!0,t||(r=G(Pr,"keydown",n[11]),t=!0)},p(o,i){const c={};i[0]&127|i[1]&4&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){P(e,o),t=!1,r()}}}function en(n){return String.fromCharCode(n+"A".charCodeAt(0))}function tn(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function Ur(n,e,l){let t,r;ee(n,U,L=>l(5,t=L)),ee(n,Y,L=>l(6,r=L));let{junctionIdx:o}=e,{stage:i}=e,c=i=="existing"?"proposed":"existing",s={mode:"select"},u=null,a=null,f;async function m(L){u=f.scrollTop,l(2,s={mode:"editing",id:L}),l(3,a=null),await Be(),l(4,f.scrollTop=0,f)}async function d(){l(2,s={mode:"select"}),u!=null&&(await Be(),l(4,f.scrollTop=u,f),u=null)}function p(){s.mode=="editing"&&window.confirm(`Delete this ${s.id.kind}?`)&&(s.id.kind=="movement"?(t.jats[o].properties[i].movements.splice(s.id.idx,1),U.set(t)):(t.jats[o].properties[i].arms.splice(s.id.idx,1),U.set(t)),d())}function _(L){if(s.mode!="editing")return;let pe=L.target.tagName,me=pe=="INPUT"||pe=="TEXTAREA";L.key=="Escape"||L.key=="Enter"&&!me?(L.stopPropagation(),d()):L.key=="Delete"&&!me&&(L.stopPropagation(),p())}function N(){t.jats[o].properties[i].arms.length>0&&!window.confirm("Overwrite arms?")||(Q(U,t.jats[o].properties[i].arms=JSON.parse(JSON.stringify(t.jats[o].properties[c].arms)),t),U.set(t))}function h(){t.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite movements?")||(Q(U,t.jats[o].properties[i].movements=JSON.parse(JSON.stringify(t.jats[o].properties[c].movements)),t),U.set(t))}let w={0:Le.red,1:Le.amber,2:Le.green,X:Le.critical};function O(){if(t.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let L=t.jats[o].properties[i].movements.filter(pe=>pe.kind=="walking & wheeling");Q(U,t.jats[o].properties[i].movements=[...L,...ur(t.jats[o].properties[i].arms)],t)}const T=()=>Q(Y,r={kind:"edit-jat",idx:o},r),A=L=>m({kind:"arm",idx:L}),S=L=>l(3,a={kind:"arm",idx:L}),J=()=>l(3,a=null),I=L=>m({kind:"movement",idx:L}),z=L=>l(3,a={kind:"movement",idx:L}),M=()=>l(3,a=null),E=()=>l(2,s={mode:"select"});function j(){t.jats[o].properties[i].arms[s.id.idx].name=this.value,U.set(t)}function Z(L){de[L?"unshift":"push"](()=>{f=L,l(4,f)})}return n.$$set=L=>{"junctionIdx"in L&&l(0,o=L.junctionIdx),"stage"in L&&l(1,i=L.stage)},[o,i,s,a,f,t,r,c,m,d,p,_,N,h,w,O,T,A,S,J,I,z,M,E,j,Z]}class Zr extends ie{constructor(e){super(),se(this,e,Ur,Gr,ae,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:Kr}=Ke;function Xr(n){let e,l,t,r,o,i,c,s,u,a,f,m,d,p;return{c(){e=$("div"),l=$("button"),l.textContent="Done",t=C(),r=$("button"),r.textContent="Delete JAT",o=C(),i=$("label"),c=H(`Name:
      `),s=$("input"),u=C(),a=$("button"),a.textContent="Existing",f=C(),m=$("button"),m.textContent="Proposed",R(s,"type","text"),R(e,"slot","sidebar")},m(_,N){b(_,e,N),g(e,l),g(e,t),g(e,r),g(e,o),g(e,i),g(i,c),g(i,s),oe(s,n[1].jats[n[0]].properties.name),g(e,u),g(e,a),g(e,f),g(e,m),d||(p=[G(l,"click",n[6]),G(r,"click",n[4]),G(s,"input",n[7]),G(a,"click",n[8]),G(m,"click",n[9])],d=!0)},p(_,N){N&3&&s.value!==_[1].jats[_[0]].properties.name&&oe(s,_[1].jats[_[0]].properties.name)},d(_){_&&v(e),d=!1,_e(p)}}}function Wr(n){let e,l;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Vr(n){let e,l,t,r,o,i,c,s;l=new Re({props:{except:"jats"}}),r=new ge({props:{data:ne(n[1].jats),generateId:!0,$$slots:{default:[Wr]},$$scope:{ctx:n}}});function u(f){n[5](f)}let a={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(a.lngLat=n[1].jats[n[0]].geometry.coordinates),i=new ct({props:a}),de.push(()=>we(i,"lngLat",u)),{c(){e=$("div"),D(l.$$.fragment),t=C(),D(r.$$.fragment),o=C(),D(i.$$.fragment),R(e,"slot","map")},m(f,m){b(f,e,m),q(l,e,null),g(e,t),q(r,e,null),g(e,o),q(i,e,null),s=!0},p(f,m){const d={};m&2&&(d.data=ne(f[1].jats)),m&1025&&(d.$$scope={dirty:m,ctx:f}),r.$set(d);const p={};m&3&&(p.color=f[1].jats[f[0]].properties.color),!c&&m&3&&(c=!0,p.lngLat=f[1].jats[f[0]].geometry.coordinates,ye(()=>c=!1)),i.$set(p)},i(f){s||(k(l.$$.fragment,f),k(r.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),y(r.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),P(l),P(r),P(i)}}}function Qr(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[Vr],sidebar:[Xr]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(o,i){q(e,o,i),l=!0,t||(r=G(Kr,"keydown",n[3]),t=!0)},p(o,[i]){const c={};i&1031&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){P(e,o),t=!1,r()}}}function Yr(n,e,l){let t,r;ee(n,U,d=>l(1,t=d)),ee(n,Y,d=>l(2,r=d));let{idx:o}=e;function i(d){d.key=="Escape"&&Q(Y,r={kind:"neutral"},r)}async function c(){window.confirm("Really delete this JAT?")&&(Q(Y,r={kind:"neutral"},r),await Be(),t.jats.splice(o,1),U.set(t))}function s(d){n.$$.not_equal(t.jats[o].geometry.coordinates,d)&&(t.jats[o].geometry.coordinates=d,U.set(t))}const u=()=>Q(Y,r={kind:"neutral"},r);function a(){t.jats[o].properties.name=this.value,U.set(t)}const f=()=>Q(Y,r={kind:"edit-jat-detail",idx:o,stage:"existing"},r),m=()=>Q(Y,r={kind:"edit-jat-detail",idx:o,stage:"proposed"},r);return n.$$set=d=>{"idx"in d&&l(0,o=d.idx)},[o,t,r,i,c,s,u,a,f,m]}class xr extends ie{constructor(e){super(),se(this,e,Yr,Qr,ae,{idx:0})}}function nn(n,e,l){const t=n.slice();return t[3]=e[l],t[4]=e,t[5]=l,t}function eo(n){let e,l;return{c(){e=$("span"),l=C(),R(e,"class","dot svelte-jgyhla")},m(t,r){b(t,e,r),b(t,l,r)},p:te,d(t){t&&(v(e),v(l))}}}function ln(n){let e,l,t;function r(i){n[2](i,n[3],n[4],n[5])}let o={draggable:!0,$$slots:{default:[eo]},$$scope:{ctx:n}};return n[3]!==void 0&&(o.lngLat=n[3]),e=new Ee({props:o}),de.push(()=>we(e,"lngLat",r)),{c(){D(e.$$.fragment)},m(i,c){q(e,i,c),t=!0},p(i,c){n=i;const s={};c&64&&(s.$$scope={dirty:c,ctx:n}),!l&&c&1&&(l=!0,s.lngLat=n[3],ye(()=>l=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){P(e,i)}}}function to(n){let e,l,t,r;e=new Mn({}),e.$on("click",n[1]);let o=K(n[0].geometry.coordinates),i=[];for(let s=0;s<o.length;s+=1)i[s]=ln(nn(n,o,s));const c=s=>y(i[s],1,1,()=>{i[s]=null});return{c(){D(e.$$.fragment),l=C();for(let s=0;s<i.length;s+=1)i[s].c();t=Ze()},m(s,u){q(e,s,u),b(s,l,u);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(s,u);b(s,t,u),r=!0},p(s,[u]){if(u&1){o=K(s[0].geometry.coordinates);let a;for(a=0;a<o.length;a+=1){const f=nn(s,o,a);i[a]?(i[a].p(f,u),k(i[a],1)):(i[a]=ln(f),i[a].c(),k(i[a],1),i[a].m(t.parentNode,t))}for(ue(),a=o.length;a<i.length;a+=1)c(a);fe()}},i(s){if(!r){k(e.$$.fragment,s);for(let u=0;u<o.length;u+=1)k(i[u]);r=!0}},o(s){y(e.$$.fragment,s),i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)y(i[u]);r=!1},d(s){s&&(v(l),v(t)),P(e,s),le(i,s)}}}function no(n,e,l){let{f:t}=e;function r(i){t.geometry.coordinates.push(i.detail.lngLat.toArray()),l(0,t)}function o(i,c,s,u){s[u]=i,l(0,t)}return n.$$set=i=>{"f"in i&&l(0,t=i.f)},[t,r,o]}class lo extends ie{constructor(e){super(),se(this,e,no,to,ae,{f:0})}}function ro(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Ae[n%Ae.length],answers:Array(be.length).fill("")}}}let be=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:ke()},{name:"SA04",description:"trip hazards",choices:ke()},{name:"SA05",description:"kerbside activity",choices:ke()},{name:"SA08",description:"motor traffic speed",choices:ke()},{name:"SA09",description:"motor traffic volume",choices:ke()},{name:"SA11",description:"footway widths",choices:ke()},{name:"SA12",description:"effective width next to tram lines",choices:ke()},{name:"SA13",description:"crossing angle of tram/train rails",choices:ke()},{name:"SA14",description:"cycling surface and maintenance defects",choices:ke()},{name:"SA15",description:"WW surface and maintenance defects",choices:ke()},{name:"SA16",description:"guard railing",choices:ke()}];const{window:oo}=Ke;function rn(n,e,l){const t=n.slice();return t[10]=e[l],t[11]=e,t[12]=l,t}function io(n,e,l){const t=n.slice();return t[13]=e[l],t}function on(n){let e;return{c(){e=$("p"),e.textContent="A link needs at least two points"},m(l,t){b(l,e,t)},d(l){l&&v(e)}}}function so(n){let e;return{c(){e=$("option"),e.textContent=`${n[13]}`,e.__value=n[13],oe(e,e.__value)},m(l,t){b(l,e,t)},p:te,d(l){l&&v(e)}}}function sn(n){let e,l=n[10].name+"",t,r,o=n[10].description+"",i,c,s,u,a,f,m=K(n[10].choices),d=[];for(let _=0;_<m.length;_+=1)d[_]=so(io(n,m,_));function p(){n[9].call(s,n[12])}return{c(){e=$("label"),t=H(l),r=H(": "),i=H(o),c=C(),s=$("select");for(let _=0;_<d.length;_+=1)d[_].c();u=C(),n[1].links[n[0]].properties.answers[n[12]]===void 0&&et(p)},m(_,N){b(_,e,N),g(e,t),g(e,r),g(e,i),g(e,c),g(e,s);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(s,null);Se(s,n[1].links[n[0]].properties.answers[n[12]],!0),g(e,u),a||(f=G(s,"change",p),a=!0)},p(_,N){n=_,N&3&&Se(s,n[1].links[n[0]].properties.answers[n[12]])},d(_){_&&v(e),le(d,_),a=!1,f()}}}function ao(n){let e,l,t,r,o,i,c,s,u,a,f,m,d,p,_=!n[2]&&on(),N=K(be),h=[];for(let w=0;w<N.length;w+=1)h[w]=sn(rn(n,N,w));return{c(){e=$("div"),l=$("button"),t=H("Done"),o=C(),i=$("button"),i.textContent="Delete link",c=C(),_&&_.c(),s=C(),u=$("label"),a=H(`Name:
      `),f=$("input"),m=C();for(let w=0;w<h.length;w+=1)h[w].c();l.disabled=r=!n[2],R(f,"type","text"),R(e,"slot","sidebar")},m(w,O){b(w,e,O),g(e,l),g(l,t),g(e,o),g(e,i),g(e,c),_&&_.m(e,null),g(e,s),g(e,u),g(u,a),g(u,f),oe(f,n[1].links[n[0]].properties.name),g(e,m);for(let T=0;T<h.length;T+=1)h[T]&&h[T].m(e,null);d||(p=[G(l,"click",n[7]),G(i,"click",n[5]),G(f,"input",n[8])],d=!0)},p(w,O){if(O&4&&r!==(r=!w[2])&&(l.disabled=r),w[2]?_&&(_.d(1),_=null):_||(_=on(),_.c(),_.m(e,s)),O&3&&f.value!==w[1].links[w[0]].properties.name&&oe(f,w[1].links[w[0]].properties.name),O&3){N=K(be);let T;for(T=0;T<N.length;T+=1){const A=rn(w,N,T);h[T]?h[T].p(A,O):(h[T]=sn(A),h[T].c(),h[T].m(e,null))}for(;T<h.length;T+=1)h[T].d(1);h.length=N.length}},d(w){w&&v(e),_&&_.d(),le(h,w),d=!1,_e(p)}}}function co(n){let e,l;return e=new Oe({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function uo(n){let e,l,t,r,o,i,c,s;l=new Re({props:{except:"links"}}),r=new ge({props:{data:ne(n[1].links),generateId:!0,$$slots:{default:[co]},$$scope:{ctx:n}}});function u(f){n[6](f)}let a={};return n[1].links[n[0]]!==void 0&&(a.f=n[1].links[n[0]]),i=new lo({props:a}),de.push(()=>we(i,"f",u)),{c(){e=$("div"),D(l.$$.fragment),t=C(),D(r.$$.fragment),o=C(),D(i.$$.fragment),R(e,"slot","map")},m(f,m){b(f,e,m),q(l,e,null),g(e,t),q(r,e,null),g(e,o),q(i,e,null),s=!0},p(f,m){const d={};m&2&&(d.data=ne(f[1].links)),m&65537&&(d.$$scope={dirty:m,ctx:f}),r.$set(d);const p={};!c&&m&3&&(c=!0,p.f=f[1].links[f[0]],ye(()=>c=!1)),i.$set(p)},i(f){s||(k(l.$$.fragment,f),k(r.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),y(r.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),P(l),P(r),P(i)}}}function fo(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[uo],sidebar:[ao]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(o,i){q(e,o,i),l=!0,t||(r=G(oo,"keydown",n[4]),t=!0)},p(o,[i]){const c={};i&65551&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){P(e,o),t=!1,r()}}}function mo(n,e,l){let t,r,o;ee(n,U,d=>l(1,r=d)),ee(n,Y,d=>l(3,o=d));let{idx:i}=e;function c(d){d.key=="Escape"&&t&&Q(Y,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this link?")&&(Q(Y,o={kind:"neutral"},o),await Be(),r.links.splice(i,1),U.set(r))}function u(d){n.$$.not_equal(r.links[i],d)&&(r.links[i]=d,U.set(r))}const a=()=>Q(Y,o={kind:"neutral"},o);function f(){r.links[i].properties.name=this.value,U.set(r)}function m(d){r.links[i].properties.answers[d]=tt(this),U.set(r)}return n.$$set=d=>{"idx"in d&&l(0,i=d.idx)},n.$$.update=()=>{n.$$.dirty&3&&l(2,t=r.links[i].geometry.coordinates.length>=2)},[i,r,t,o,c,s,u,a,f,m]}class po extends ie{constructor(e){super(),se(this,e,mo,fo,ae,{idx:0})}}function an(n,e,l){const t=n.slice();return t[6]=e[l],t[7]=e,t[8]=l,t}function cn(n,e,l){const t=n.slice();return t[9]=e[l],t}function un(n){let e,l=n[9]+"",t,r;return{c(){e=$("option"),t=H(l),e.__value=r=n[9],oe(e,e.__value)},m(o,i){b(o,e,i),g(e,t)},p(o,i){i&1&&l!==(l=o[9]+"")&&re(t,l),i&1&&r!==(r=o[9])&&(e.__value=r,oe(e,e.__value))},d(o){o&&v(e)}}}function fn(n){let e,l,t=n[6].properties.name+"",r,o,i,c,s,u,a=K(be[n[0]].choices),f=[];for(let d=0;d<a.length;d+=1)f[d]=un(cn(n,a,d));function m(){n[5].call(i,n[7],n[8])}return{c(){e=$("li"),l=$("span"),r=H(t),o=C(),i=$("select");for(let d=0;d<f.length;d+=1)f[d].c();c=C(),V(l,"color",n[6].properties.color),n[6].properties.answers[n[0]]===void 0&&et(m)},m(d,p){b(d,e,p),g(e,l),g(l,r),g(e,o),g(e,i);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(i,null);Se(i,n[6].properties.answers[n[0]],!0),g(e,c),s||(u=G(i,"change",m),s=!0)},p(d,p){if(n=d,p&4&&t!==(t=n[6].properties.name+"")&&re(r,t),p&4&&V(l,"color",n[6].properties.color),p&1){a=K(be[n[0]].choices);let _;for(_=0;_<a.length;_+=1){const N=cn(n,a,_);f[_]?f[_].p(N,p):(f[_]=un(N),f[_].c(),f[_].m(i,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=a.length}p&5&&Se(i,n[6].properties.answers[n[0]])},d(d){d&&v(e),le(f,d),s=!1,u()}}}function go(n){let e,l,t,r,o=be[n[0]].name+"",i,c,s=be[n[0]].description+"",u,a,f,m,d,p=K(n[2].links),_=[];for(let N=0;N<p.length;N+=1)_[N]=fn(an(n,p,N));return{c(){e=$("div"),l=$("button"),l.textContent="Done",t=C(),r=$("h2"),i=H(o),c=H(": "),u=H(s),a=C(),f=$("ol");for(let N=0;N<_.length;N+=1)_[N].c();R(e,"slot","sidebar")},m(N,h){b(N,e,h),g(e,l),g(e,t),g(e,r),g(r,i),g(r,c),g(r,u),g(e,a),g(e,f);for(let w=0;w<_.length;w+=1)_[w]&&_[w].m(f,null);m||(d=G(l,"click",n[4]),m=!0)},p(N,h){if(h&1&&o!==(o=be[N[0]].name+"")&&re(i,o),h&1&&s!==(s=be[N[0]].description+"")&&re(u,s),h&5){p=K(N[2].links);let w;for(w=0;w<p.length;w+=1){const O=an(N,p,w);_[w]?_[w].p(O,h):(_[w]=fn(O),_[w].c(),_[w].m(f,null))}for(;w<_.length;w+=1)_[w].d(1);_.length=p.length}},d(N){N&&v(e),le(_,N),m=!1,d()}}}function _o(n){let e,l,t;return l=new Re({props:{showLinkColor:!0,except:""}}),{c(){e=$("div"),D(l.$$.fragment),R(e,"slot","map")},m(r,o){b(r,e,o),q(l,e,null),t=!0},p:te,i(r){t||(k(l.$$.fragment,r),t=!0)},o(r){y(l.$$.fragment,r),t=!1},d(r){r&&v(e),P(l)}}}function ho(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[_o],sidebar:[go]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(o,i){q(e,o,i),l=!0,t||(r=G(window,"keydown",n[3]),t=!0)},p(o,[i]){const c={};i&4103&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){P(e,o),t=!1,r()}}}function $o(n,e,l){let t,r;ee(n,Y,u=>l(1,t=u)),ee(n,U,u=>l(2,r=u));let{qIdx:o}=e;function i(u){u.key=="Escape"&&Q(Y,t={kind:"neutral"},t)}const c=()=>Q(Y,t={kind:"neutral"},t);function s(u,a){u[a].properties.answers[o]=tt(this),U.set(r),l(0,o)}return n.$$set=u=>{"qIdx"in u&&l(0,o=u.qIdx)},[o,t,r,i,c,s]}class ko extends ie{constructor(e){super(),se(this,e,$o,ho,ae,{qIdx:0})}}function bo(n){let e,l,t,r;const o=n[2].default,i=De(o,n,n[1],null);return{c(){e=$("a"),i&&i.c(),R(e,"href","#"),V(e,"color",n[0])},m(c,s){b(c,e,s),i&&i.m(e,null),l=!0,t||(r=G(e,"click",Gn(n[3])),t=!0)},p(c,[s]){i&&i.p&&(!l||s&2)&&qe(i,o,c,c[1],l?Fe(o,c[1],s,null):Pe(c[1]),null),s&1&&V(e,"color",c[0])},i(c){l||(k(i,c),l=!0)},o(c){y(i,c),l=!1},d(c){c&&v(e),i&&i.d(c),t=!1,r()}}}function vo(n,e,l){let{$$slots:t={},$$scope:r}=e,{color:o=void 0}=e;function i(c){ve.call(this,n,c)}return n.$$set=c=>{"color"in c&&l(0,o=c.color),"$$scope"in c&&l(1,r=c.$$scope)},[o,r,t,i]}class Xe extends ie{constructor(e){super(),se(this,e,vo,bo,ae,{color:0})}}function wo(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Ae[n%Ae.length],st20:""}}}function mn(n,e,l){const t=n.slice();return t[5]=e[l],t[7]=l,t}function yo(n){let e=n[5].properties.name+"",l;return{c(){l=H(e)},m(t,r){b(t,l,r)},p(t,r){r&1&&e!==(e=t[5].properties.name+"")&&re(l,e)},d(t){t&&v(l)}}}function dn(n){let e,l,t,r;function o(){return n[3](n[7])}return l=new Xe({props:{color:n[5].properties.color,$$slots:{default:[yo]},$$scope:{ctx:n}}}),l.$on("click",o),{c(){e=$("li"),D(l.$$.fragment),t=C()},m(i,c){b(i,e,c),q(l,e,null),g(e,t),r=!0},p(i,c){n=i;const s={};c&1&&(s.color=n[5].properties.color),c&257&&(s.$$scope={dirty:c,ctx:n}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&v(e),P(l)}}}function jo(n){let e,l,t,r,o,i,c,s,u=K(n[0].bus_stops),a=[];for(let m=0;m<u.length;m+=1)a[m]=dn(mn(n,u,m));const f=m=>y(a[m],1,1,()=>{a[m]=null});return{c(){e=H(`Bus stops:

`),l=$("div"),t=$("button"),t.textContent="New bus stop",r=C(),o=$("ol");for(let m=0;m<a.length;m+=1)a[m].c()},m(m,d){b(m,e,d),b(m,l,d),g(l,t),b(m,r,d),b(m,o,d);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(o,null);i=!0,c||(s=G(t,"click",n[2]),c=!0)},p(m,[d]){if(d&3){u=K(m[0].bus_stops);let p;for(p=0;p<u.length;p+=1){const _=mn(m,u,p);a[p]?(a[p].p(_,d),k(a[p],1)):(a[p]=dn(_),a[p].c(),k(a[p],1),a[p].m(o,null))}for(ue(),p=u.length;p<a.length;p+=1)f(p);fe()}},i(m){if(!i){for(let d=0;d<u.length;d+=1)k(a[d]);i=!0}},o(m){a=a.filter(Boolean);for(let d=0;d<a.length;d+=1)y(a[d]);i=!1},d(m){m&&(v(e),v(l),v(r),v(o)),le(a,m),c=!1,s()}}}function Co(n,e,l){let t,r,o;ee(n,U,s=>l(0,t=s)),ee(n,Y,s=>l(1,r=s)),ee(n,Je,s=>l(4,o=s));function i(){if(!o)return;let s=wo(t.bus_stops.length,o.getCenter().toArray());Q(U,t.bus_stops=[...t.bus_stops,s],t),Q(Y,r={kind:"edit-bus-stop",idx:t.bus_stops.length-1},r)}return[t,r,i,s=>Q(Y,r={kind:"edit-bus-stop",idx:s},r)]}let Lo=class extends ie{constructor(e){super(),se(this,e,Co,jo,ae,{})}};function So(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:Ae[n%Ae.length],sa10:""}}}function pn(n,e,l){const t=n.slice();return t[5]=e[l],t[7]=l,t}function Ao(n){let e=n[5].properties.name+"",l;return{c(){l=H(e)},m(t,r){b(t,l,r)},p(t,r){r&1&&e!==(e=t[5].properties.name+"")&&re(l,e)},d(t){t&&v(l)}}}function gn(n){let e,l,t,r;function o(){return n[3](n[7])}return l=new Xe({props:{color:n[5].properties.color,$$slots:{default:[Ao]},$$scope:{ctx:n}}}),l.$on("click",o),{c(){e=$("li"),D(l.$$.fragment),t=C()},m(i,c){b(i,e,c),q(l,e,null),g(e,t),r=!0},p(i,c){n=i;const s={};c&1&&(s.color=n[5].properties.color),c&257&&(s.$$scope={dirty:c,ctx:n}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&v(e),P(l)}}}function To(n){let e,l,t,r,o,i,c,s,u=K(n[0].crossings),a=[];for(let m=0;m<u.length;m+=1)a[m]=gn(pn(n,u,m));const f=m=>y(a[m],1,1,()=>{a[m]=null});return{c(){e=H(`Crossings:

`),l=$("div"),t=$("button"),t.textContent="New crossing",r=C(),o=$("ol");for(let m=0;m<a.length;m+=1)a[m].c()},m(m,d){b(m,e,d),b(m,l,d),g(l,t),b(m,r,d),b(m,o,d);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(o,null);i=!0,c||(s=G(t,"click",n[2]),c=!0)},p(m,[d]){if(d&3){u=K(m[0].crossings);let p;for(p=0;p<u.length;p+=1){const _=pn(m,u,p);a[p]?(a[p].p(_,d),k(a[p],1)):(a[p]=gn(_),a[p].c(),k(a[p],1),a[p].m(o,null))}for(ue(),p=u.length;p<a.length;p+=1)f(p);fe()}},i(m){if(!i){for(let d=0;d<u.length;d+=1)k(a[d]);i=!0}},o(m){a=a.filter(Boolean);for(let d=0;d<a.length;d+=1)y(a[d]);i=!1},d(m){m&&(v(e),v(l),v(r),v(o)),le(a,m),c=!1,s()}}}function Mo(n,e,l){let t,r,o;ee(n,U,s=>l(0,t=s)),ee(n,Y,s=>l(1,r=s)),ee(n,Je,s=>l(4,o=s));function i(){if(!o)return;let s=So(t.crossings.length,o.getCenter().toArray());Q(U,t.crossings=[...t.crossings,s],t),Q(Y,r={kind:"edit-crossing",idx:t.crossings.length-1},r)}return[t,r,i,s=>Q(Y,r={kind:"edit-crossing",idx:s},r)]}let Io=class extends ie{constructor(e){super(),se(this,e,Mo,To,ae,{})}};function No(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Ae[n%Ae.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function _n(n,e,l){const t=n.slice();return t[5]=e[l],t[7]=l,t}function Eo(n){let e=n[5].properties.name+"",l;return{c(){l=H(e)},m(t,r){b(t,l,r)},p(t,r){r&1&&e!==(e=t[5].properties.name+"")&&re(l,e)},d(t){t&&v(l)}}}function hn(n){let e,l,t,r;function o(){return n[3](n[7])}return l=new Xe({props:{color:n[5].properties.color,$$slots:{default:[Eo]},$$scope:{ctx:n}}}),l.$on("click",o),{c(){e=$("li"),D(l.$$.fragment),t=C()},m(i,c){b(i,e,c),q(l,e,null),g(e,t),r=!0},p(i,c){n=i;const s={};c&1&&(s.color=n[5].properties.color),c&257&&(s.$$scope={dirty:c,ctx:n}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&v(e),P(l)}}}function Do(n){let e,l,t,r,o,i,c,s,u=K(n[0].jats),a=[];for(let m=0;m<u.length;m+=1)a[m]=hn(_n(n,u,m));const f=m=>y(a[m],1,1,()=>{a[m]=null});return{c(){e=H(`JATs:

`),l=$("div"),t=$("button"),t.textContent="New JAT",r=C(),o=$("ol");for(let m=0;m<a.length;m+=1)a[m].c()},m(m,d){b(m,e,d),b(m,l,d),g(l,t),b(m,r,d),b(m,o,d);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(o,null);i=!0,c||(s=G(t,"click",n[2]),c=!0)},p(m,[d]){if(d&3){u=K(m[0].jats);let p;for(p=0;p<u.length;p+=1){const _=_n(m,u,p);a[p]?(a[p].p(_,d),k(a[p],1)):(a[p]=hn(_),a[p].c(),k(a[p],1),a[p].m(o,null))}for(ue(),p=u.length;p<a.length;p+=1)f(p);fe()}},i(m){if(!i){for(let d=0;d<u.length;d+=1)k(a[d]);i=!0}},o(m){a=a.filter(Boolean);for(let d=0;d<a.length;d+=1)y(a[d]);i=!1},d(m){m&&(v(e),v(l),v(r),v(o)),le(a,m),c=!1,s()}}}function qo(n,e,l){let t,r,o;ee(n,U,s=>l(0,t=s)),ee(n,Y,s=>l(1,r=s)),ee(n,Je,s=>l(4,o=s));function i(){if(!o)return;let s=No(t.jats.length,o.getCenter().toArray());Q(U,t.jats=[...t.jats,s],t),Q(Y,r={kind:"edit-jat",idx:t.jats.length-1},r)}return[t,r,i,s=>Q(Y,r={kind:"edit-jat",idx:s},r)]}let Po=class extends ie{constructor(e){super(),se(this,e,qo,Do,ae,{})}};function $n(n,e,l){const t=n.slice();return t[2]=e[l],t[4]=l,t}function kn(n,e,l){const t=n.slice();t[5]=e[l];const r=t[5].properties.answers[t[4]];return t[6]=r,t}function bn(n,e,l){const t=n.slice();return t[5]=e[l],t}function vn(n){let e,l=n[5].properties.name+"",t;return{c(){e=$("th"),t=H(l),V(e,"color",n[5].properties.color)},m(r,o){b(r,e,o),g(e,t)},p(r,o){o&1&&l!==(l=r[5].properties.name+"")&&re(t,l),o&1&&V(e,"color",r[5].properties.color)},d(r){r&&v(e)}}}function wn(n){let e,l=n[6]+"",t;return{c(){e=$("td"),t=H(l),V(e,"background",n[6]==""?"red":"green")},m(r,o){b(r,e,o),g(e,t)},p(r,o){o&1&&l!==(l=r[6]+"")&&re(t,l),o&1&&V(e,"background",r[6]==""?"red":"green")},d(r){r&&v(e)}}}function yn(n){let e,l,t,r,o=K(n[0].links),i=[];for(let c=0;c<o.length;c+=1)i[c]=wn(kn(n,o,c));return{c(){e=$("tr"),l=$("th"),l.textContent=`${n[2].name}`,t=C();for(let c=0;c<i.length;c+=1)i[c].c();r=C()},m(c,s){b(c,e,s),g(e,l),g(e,t);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);g(e,r)},p(c,s){if(s&1){o=K(c[0].links);let u;for(u=0;u<o.length;u+=1){const a=kn(c,o,u);i[u]?i[u].p(a,s):(i[u]=wn(a),i[u].c(),i[u].m(e,r))}for(;u<i.length;u+=1)i[u].d(1);i.length=o.length}},d(c){c&&v(e),le(i,c)}}}function Fo(n){let e,l,t,r,o,i,c,s=K(n[0].links),u=[];for(let m=0;m<s.length;m+=1)u[m]=vn(bn(n,s,m));let a=K(be),f=[];for(let m=0;m<a.length;m+=1)f[m]=yn($n(n,a,m));return{c(){e=$("table"),l=$("thead"),t=$("tr"),r=$("th"),o=C();for(let m=0;m<u.length;m+=1)u[m].c();i=C(),c=$("tbody");for(let m=0;m<f.length;m+=1)f[m].c()},m(m,d){b(m,e,d),g(e,l),g(l,t),g(t,r),g(t,o);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(t,null);g(e,i),g(e,c);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(c,null)},p(m,d){if(d&1){s=K(m[0].links);let p;for(p=0;p<s.length;p+=1){const _=bn(m,s,p);u[p]?u[p].p(_,d):(u[p]=vn(_),u[p].c(),u[p].m(t,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=s.length}if(d&1){a=K(be);let p;for(p=0;p<a.length;p+=1){const _=$n(m,a,p);f[p]?f[p].p(_,d):(f[p]=yn(_),f[p].c(),f[p].m(c,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=a.length}},d(m){m&&v(e),le(u,m),le(f,m)}}}function Oo(n){let e,l;return e=new Nn({props:{$$slots:{default:[Fo]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,[r]){const o={};r&2049&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Bo(n,e,l){let t;ee(n,U,o=>l(0,t=o));function r(o){ve.call(this,n,o)}return[t,r]}class zo extends ie{constructor(e){super(),se(this,e,Bo,Oo,ae,{})}}function jn(n,e,l){const t=n.slice();return t[9]=e[l],t[11]=l,t}function Cn(n,e,l){const t=n.slice();return t[12]=e[l],t[11]=l,t}function Ln(n){let e,l;return e=new zo({}),e.$on("close",n[4]),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Jo(n){let e=n[12].properties.name+"",l;return{c(){l=H(e)},m(t,r){b(t,l,r)},p(t,r){r&2&&e!==(e=t[12].properties.name+"")&&re(l,e)},d(t){t&&v(l)}}}function Sn(n){let e,l,t,r;function o(){return n[6](n[11])}return l=new Xe({props:{color:n[12].properties.color,$$slots:{default:[Jo]},$$scope:{ctx:n}}}),l.$on("click",o),{c(){e=$("li"),D(l.$$.fragment),t=C()},m(i,c){b(i,e,c),q(l,e,null),g(e,t),r=!0},p(i,c){n=i;const s={};c&2&&(s.color=n[12].properties.color),c&16386&&(s.$$scope={dirty:c,ctx:n}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&v(e),P(l)}}}function Ro(n){let e=n[9].name+"",l,t;return{c(){l=H(e),t=C()},m(r,o){b(r,l,o),b(r,t,o)},p:te,d(r){r&&(v(l),v(t))}}}function An(n){let e,l,t,r,o,i,c,s;function u(){return n[7](n[11])}l=new Xe({props:{$$slots:{default:[Ro]},$$scope:{ctx:n}}}),l.$on("click",u);function a(...f){return n[8](n[11],...f)}return{c(){e=$("li"),D(l.$$.fragment),t=H(`:
      `),r=$("progress"),c=C(),r.value=o=n[1].links.filter(a).length,R(r,"max",i=n[1].links.length),R(r,"class","svelte-zadug4")},m(f,m){b(f,e,m),q(l,e,null),g(e,t),g(e,r),g(e,c),s=!0},p(f,m){n=f;const d={};m&16384&&(d.$$scope={dirty:m,ctx:n}),l.$set(d),(!s||m&2&&o!==(o=n[1].links.filter(a).length))&&(r.value=o),(!s||m&2&&i!==(i=n[1].links.length))&&R(r,"max",i)},i(f){s||(k(l.$$.fragment,f),s=!0)},o(f){y(l.$$.fragment,f),s=!1},d(f){f&&v(e),P(l)}}}function Ho(n){let e,l,t,r,o,i,c,s,u,a,f,m,d=n[0]&&Ln(n),p=K(n[1].links),_=[];for(let T=0;T<p.length;T+=1)_[T]=Sn(Cn(n,p,T));const N=T=>y(_[T],1,1,()=>{_[T]=null});let h=K(be),w=[];for(let T=0;T<h.length;T+=1)w[T]=An(jn(n,h,T));const O=T=>y(w[T],1,1,()=>{w[T]=null});return{c(){d&&d.c(),e=C(),l=$("div"),t=$("button"),t.textContent="New link",r=C(),o=$("button"),o.textContent="Table of questions",i=H(`

Links:
`),c=$("ol");for(let T=0;T<_.length;T+=1)_[T].c();s=H(`

Questions:
`),u=$("ol");for(let T=0;T<w.length;T+=1)w[T].c()},m(T,A){d&&d.m(T,A),b(T,e,A),b(T,l,A),g(l,t),g(l,r),g(l,o),b(T,i,A),b(T,c,A);for(let S=0;S<_.length;S+=1)_[S]&&_[S].m(c,null);b(T,s,A),b(T,u,A);for(let S=0;S<w.length;S+=1)w[S]&&w[S].m(u,null);a=!0,f||(m=[G(t,"click",n[3]),G(o,"click",n[5])],f=!0)},p(T,[A]){if(T[0]?d?(d.p(T,A),A&1&&k(d,1)):(d=Ln(T),d.c(),k(d,1),d.m(e.parentNode,e)):d&&(ue(),y(d,1,1,()=>{d=null}),fe()),A&6){p=K(T[1].links);let S;for(S=0;S<p.length;S+=1){const J=Cn(T,p,S);_[S]?(_[S].p(J,A),k(_[S],1)):(_[S]=Sn(J),_[S].c(),k(_[S],1),_[S].m(c,null))}for(ue(),S=p.length;S<_.length;S+=1)N(S);fe()}if(A&6){h=K(be);let S;for(S=0;S<h.length;S+=1){const J=jn(T,h,S);w[S]?(w[S].p(J,A),k(w[S],1)):(w[S]=An(J),w[S].c(),k(w[S],1),w[S].m(u,null))}for(ue(),S=h.length;S<w.length;S+=1)O(S);fe()}},i(T){if(!a){k(d);for(let A=0;A<p.length;A+=1)k(_[A]);for(let A=0;A<h.length;A+=1)k(w[A]);a=!0}},o(T){y(d),_=_.filter(Boolean);for(let A=0;A<_.length;A+=1)y(_[A]);w=w.filter(Boolean);for(let A=0;A<w.length;A+=1)y(w[A]);a=!1},d(T){T&&(v(e),v(l),v(i),v(c),v(s),v(u)),d&&d.d(T),le(_,T),le(w,T),f=!1,_e(m)}}}function Go(n,e,l){let t,r;ee(n,U,m=>l(1,t=m)),ee(n,Y,m=>l(2,r=m));let o=!1;function i(){let m=ro(t.links.length);Q(U,t.links=[...t.links,m],t),Q(Y,r={kind:"edit-link",idx:t.links.length-1},r)}return[o,t,r,i,()=>l(0,o=!1),()=>l(0,o=!0),m=>Q(Y,r={kind:"edit-link",idx:m},r),m=>Q(Y,r={kind:"edit-question",idx:m},r),(m,d)=>d.properties.answers[m]!=""]}class Uo extends ie{constructor(e){super(),se(this,e,Go,Ho,ae,{})}}function Zo(n){let e,l,t,r,o,i,c,s,u,a,f,m,d,p,_,N,h,w,O,T,A,S,J,I;return u=new Uo({}),d=new Po({}),h=new Lo({}),A=new Io({}),{c(){e=$("div"),l=$("div"),t=$("button"),t.textContent="Download",r=C(),o=$("button"),o.textContent="Clear",i=C(),c=$("hr"),s=C(),D(u.$$.fragment),a=C(),f=$("hr"),m=C(),D(d.$$.fragment),p=C(),_=$("hr"),N=C(),D(h.$$.fragment),w=C(),O=$("hr"),T=C(),D(A.$$.fragment),R(t,"class","secondary"),R(o,"class","secondary"),R(e,"slot","sidebar")},m(z,M){b(z,e,M),g(e,l),g(l,t),g(l,r),g(l,o),g(e,i),g(e,c),g(e,s),q(u,e,null),g(e,a),g(e,f),g(e,m),q(d,e,null),g(e,p),g(e,_),g(e,N),q(h,e,null),g(e,w),g(e,O),g(e,T),q(A,e,null),S=!0,J||(I=[G(t,"click",n[7]),G(o,"click",n[2])],J=!0)},p:te,i(z){S||(k(u.$$.fragment,z),k(d.$$.fragment,z),k(h.$$.fragment,z),k(A.$$.fragment,z),S=!0)},o(z){y(u.$$.fragment,z),y(d.$$.fragment,z),y(h.$$.fragment,z),y(A.$$.fragment,z),S=!1},d(z){z&&v(e),P(u),P(d),P(h),P(A),J=!1,_e(I)}}}function Ko(n){let e,l;return e=new Oe({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":ze(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[3]),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Xo(n){let e,l;return e=new Ce({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":ze(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[4]),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Wo(n){let e,l;return e=new Ce({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":ze(10,15)},hoverCursor:"pointer"}}),e.$on("click",n[5]),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Vo(n){let e,l;return e=new Ce({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":ze(10,15)},hoverCursor:"pointer"}}),e.$on("click",n[6]),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function Qo(n){let e,l,t,r,o,i,c,s,u;return l=new ge({props:{data:ne(n[0].links),generateId:!0,$$slots:{default:[Ko]},$$scope:{ctx:n}}}),r=new ge({props:{data:ne(n[0].jats),generateId:!0,$$slots:{default:[Xo]},$$scope:{ctx:n}}}),i=new ge({props:{data:ne(n[0].bus_stops),generateId:!0,$$slots:{default:[Wo]},$$scope:{ctx:n}}}),s=new ge({props:{data:ne(n[0].crossings),generateId:!0,$$slots:{default:[Vo]},$$scope:{ctx:n}}}),{c(){e=$("div"),D(l.$$.fragment),t=C(),D(r.$$.fragment),o=C(),D(i.$$.fragment),c=C(),D(s.$$.fragment),R(e,"slot","map")},m(a,f){b(a,e,f),q(l,e,null),g(e,t),q(r,e,null),g(e,o),q(i,e,null),g(e,c),q(s,e,null),u=!0},p(a,f){const m={};f&1&&(m.data=ne(a[0].links)),f&258&&(m.$$scope={dirty:f,ctx:a}),l.$set(m);const d={};f&1&&(d.data=ne(a[0].jats)),f&258&&(d.$$scope={dirty:f,ctx:a}),r.$set(d);const p={};f&1&&(p.data=ne(a[0].bus_stops)),f&258&&(p.$$scope={dirty:f,ctx:a}),i.$set(p);const _={};f&1&&(_.data=ne(a[0].crossings)),f&258&&(_.$$scope={dirty:f,ctx:a}),s.$set(_)},i(a){u||(k(l.$$.fragment,a),k(r.$$.fragment,a),k(i.$$.fragment,a),k(s.$$.fragment,a),u=!0)},o(a){y(l.$$.fragment,a),y(r.$$.fragment,a),y(i.$$.fragment,a),y(s.$$.fragment,a),u=!1},d(a){a&&v(e),P(l),P(r),P(i),P(s)}}}function Yo(n){let e,l;return e=new Me({props:{$$slots:{map:[Qo],sidebar:[Zo]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,[r]){const o={};r&259&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function xo(n,e,l){let t,r;ee(n,U,f=>l(0,t=f)),ee(n,Y,f=>l(1,r=f));function o(){Q(U,t.links=[],t),Q(U,t.jats=[],t),Q(U,t.bus_stops=[],t),Q(U,t.crossings=[],t)}return[t,r,o,f=>Q(Y,r={kind:"edit-link",idx:f.detail.features[0].id},r),f=>Q(Y,r={kind:"edit-jat",idx:f.detail.features[0].id},r),f=>Q(Y,r={kind:"edit-bus-stop",idx:f.detail.features[0].id},r),f=>Q(Y,r={kind:"edit-crossing",idx:f.detail.features[0].id},r),()=>zl("rcv2.geojson",JSON.stringify(t))]}class ei extends ie{constructor(e){super(),se(this,e,xo,Yo,ae,{})}}function ti(n){let e,l;return{c(){e=$("div"),l=$("div"),R(e,"slot","left")},m(t,r){b(t,e,r),g(e,l),n[9](l)},p:te,d(t){t&&v(e),n[9](null)}}}function ni(n){return{c:te,m:te,p:te,i:te,o:te,d:te}}function li(n){let e,l,t;function r(i){n[8](i)}let o={style:n[10],standardControls:!0,hash:!0,$$slots:{default:[fi]},$$scope:{ctx:n}};return n[2]!==void 0&&(o.map=n[2]),e=new Zn({props:o}),de.push(()=>we(e,"map",r)),{c(){D(e.$$.fragment)},m(i,c){q(e,i,c),t=!0},p(i,c){const s={};c&2058&&(s.$$scope={dirty:c,ctx:i}),!l&&c&4&&(l=!0,s.map=i[2],ye(()=>l=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){P(e,i)}}}function ri(n){let e,l;return e=new ko({props:{qIdx:n[3].idx}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.qIdx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function oi(n){let e,l;return e=new Il({props:{idx:n[3].idx}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.idx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function ii(n){let e,l;return e=new wl({props:{idx:n[3].idx}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.idx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function si(n){let e,l;return e=new Zr({props:{junctionIdx:n[3].idx,stage:n[3].stage}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.junctionIdx=t[3].idx),r&8&&(o.stage=t[3].stage),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function ai(n){let e,l;return e=new xr({props:{idx:n[3].idx}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.idx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function ci(n){let e,l;return e=new po({props:{idx:n[3].idx}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.idx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function ui(n){let e,l;return e=new ei({}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function fi(n){let e,l,t,r,o,i;const c=[ui,ci,ai,si,ii,oi,ri],s=[];function u(a,f){return a[3].kind=="neutral"?0:a[3].kind=="edit-link"?1:a[3].kind=="edit-jat"?2:a[3].kind=="edit-jat-detail"?3:a[3].kind=="edit-bus-stop"?4:a[3].kind=="edit-crossing"?5:a[3].kind=="edit-question"?6:-1}return~(t=u(n))&&(r=s[t]=c[t](n)),{c(){e=$("div"),l=C(),r&&r.c(),o=Ze()},m(a,f){b(a,e,f),n[7](e),b(a,l,f),~t&&s[t].m(a,f),b(a,o,f),i=!0},p(a,f){let m=t;t=u(a),t===m?~t&&s[t].p(a,f):(r&&(ue(),y(s[m],1,1,()=>{s[m]=null}),fe()),~t?(r=s[t],r?r.p(a,f):(r=s[t]=c[t](a),r.c()),k(r,1),r.m(o.parentNode,o)):r=null)},i(a){i||(k(r),i=!0)},o(a){y(r),i=!1},d(a){a&&(v(e),v(l),v(o)),n[7](null),~t&&s[t].d(a)}}}function mi(n){return{c:te,m:te,p:te,i:te,o:te,d:te}}function di(n){let e,l,t={ctx:n,current:null,token:null,hasCatch:!1,pending:mi,then:li,catch:ni,value:10,blocks:[,,,]};return Kn(Nl(new URLSearchParams(window.location.search).get("google")||""),t),{c(){e=$("div"),t.block.c(),R(e,"slot","main"),V(e,"position","relative"),V(e,"width","100%"),V(e,"height","100vh")},m(r,o){b(r,e,o),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,l=!0},p(r,o){n=r,Xn(t,n,o)},i(r){l||(k(t.block),l=!0)},o(r){for(let o=0;o<3;o+=1){const i=t.blocks[o];y(i)}l=!1},d(r){r&&v(e),t.block.d(),t.token=null,t=null}}}function pi(n){let e,l;return e=new Un({props:{$$slots:{main:[di],left:[ti]},$$scope:{ctx:n}}}),{c(){D(e.$$.fragment)},m(t,r){q(e,t,r),l=!0},p(t,[r]){const o={};r&2063&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){P(e,t)}}}function gi(n,e,l){let t,r,o,i,c;ee(n,st,d=>l(4,t=d)),ee(n,it,d=>l(5,r=d)),ee(n,U,d=>l(6,o=d)),ee(n,Je,d=>l(2,i=d)),ee(n,Y,d=>l(3,c=d));let s,u;function a(d){de[d?"unshift":"push"](()=>{u=d,l(1,u),l(4,t)})}function f(d){i=d,Je.set(i)}function m(d){de[d?"unshift":"push"](()=>{s=d,l(0,s),l(5,r)})}return n.$$.update=()=>{n.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(o)),n.$$.dirty&33&&s&&r&&(l(0,s.innerHTML="",s),s.appendChild(r)),n.$$.dirty&18&&u&&t&&(l(1,u.innerHTML="",u),u.appendChild(t))},[s,u,i,c,t,r,o,a,f,m]}class _i extends ie{constructor(e){super(),se(this,e,gi,pi,ae,{})}}new _i({target:document.getElementById("app")});
