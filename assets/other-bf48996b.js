import{V as Bn,W as Rn,X as Qe,r as ce,e as y,v as ue,t as k,Y as zn,S as ie,i as se,s as ae,Z as Jn,_ as Hn,$ as x,a0 as Gn,L as Un,b as me,a as ve,c as N,m as E,d as we,f as D,g as Zn,h as Oe,u as Be,j as Re,k as ze,l as ye,y as $,z as C,q as v,w,a1 as Ke,M as Fe,A as z,a2 as et,U as Y,p as Xe,G as pe,D as Ae,E as Ce,B as te,Q as Z,a3 as He,o as K,F as G,a4 as We,O as g,N as le,a5 as Le,x as re,R as _e,a6 as X,a7 as Ne,a8 as Ve,a9 as ot,H as oe,K as nt,aa as Kn,ab as lt,ac as Xn,C as Ee,P as En,ad as Wn,I as Vn,T as Qn}from"./Layout-58a65f18.js";function Yn(n,e){const l=e.token={};function t(r,o,i,a){if(e.token!==l)return;e.resolved=a;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=a);const f=r&&(e.current=r)(s);let c=!1;e.block&&(e.blocks?e.blocks.forEach((d,u)=>{u!==o&&d&&(ce(),y(d,1,1,()=>{e.blocks[u]===d&&(e.blocks[u]=null)}),ue())}):e.block.d(1),f.c(),k(f,1),f.m(e.mount(),e.anchor),c=!0),e.block=f,e.blocks&&(e.blocks[o]=f),c&&zn()}if(Bn(n)){const r=Rn();if(n.then(o=>{Qe(r),t(e.then,1,e.value,o),Qe(null)},o=>{if(Qe(r),t(e.catch,2,e.error,o),Qe(null),!e.hasCatch)throw o}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function xn(n,e,l){const t=e.slice(),{resolved:r}=n;n.current===n.then&&(t[n.value]=r),n.current===n.catch&&(t[n.error]=r),n.block.p(t,l)}function el(n,e,l){let t;const r=Jn();let{layer:o=void 0}=e;const{map:i}=Hn();x(n,i,c=>l(2,t=c));function a(c){r(c.type,{...c,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Gn(()=>{if(t)if(o)for(const c of s)t.off(c,o,a);else for(const c of f)t.off(c,a)}),n.$$set=c=>{"layer"in c&&l(1,o=c.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(o)for(const c of s)t.on(c,o,a);else for(const c of f)t.on(c,a)},[i,o,t]}class Dn extends ie{constructor(e){super(),se(this,e,el,null,ae,{layer:1})}}function tl(n){let e;const l=n[16].default,t=Oe(l,n,n[24],null);return{c(){t&&t.c()},m(r,o){t&&t.m(r,o),e=!0},p(r,o){t&&t.p&&(!e||o&16777216)&&Be(t,l,r,r[24],e?ze(l,r[24],o,null):Re(r[24]),null)},i(r){e||(k(t,r),e=!0)},o(r){y(t,r),e=!1},d(r){t&&t.d(r)}}}function nl(n){let e,l,t;function r(i){n[17](i)}let o={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[tl]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.hovered=n[0]),e=new Un({props:o}),me.push(()=>ve(e,"hovered",r)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){N(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!l&&a&1&&(l=!0,s.hovered=i[0],we(()=>l=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function ll(n,e,l){let{$$slots:t={},$$scope:r}=e,{id:o=Zn("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:c=void 0}=e,{layout:d=void 0}=e,{filter:u=void 0}=e,{applyToClusters:m=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:_=void 0}=e,{hoverCursor:I=void 0}=e,{manageHoverState:h=!1}=e,{hovered:b=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:T=!0}=e;function j(L){b=L,l(0,b)}function S(L){ye.call(this,n,L)}function B(L){ye.call(this,n,L)}function q(L){ye.call(this,n,L)}function J(L){ye.call(this,n,L)}function M(L){ye.call(this,n,L)}function P(L){ye.call(this,n,L)}return n.$$set=L=>{"id"in L&&l(1,o=L.id),"source"in L&&l(2,i=L.source),"sourceLayer"in L&&l(3,a=L.sourceLayer),"beforeId"in L&&l(4,s=L.beforeId),"beforeLayerType"in L&&l(5,f=L.beforeLayerType),"paint"in L&&l(6,c=L.paint),"layout"in L&&l(7,d=L.layout),"filter"in L&&l(8,u=L.filter),"applyToClusters"in L&&l(9,m=L.applyToClusters),"minzoom"in L&&l(10,p=L.minzoom),"maxzoom"in L&&l(11,_=L.maxzoom),"hoverCursor"in L&&l(12,I=L.hoverCursor),"manageHoverState"in L&&l(13,h=L.manageHoverState),"hovered"in L&&l(0,b=L.hovered),"eventsIfTopMost"in L&&l(14,O=L.eventsIfTopMost),"interactive"in L&&l(15,T=L.interactive),"$$scope"in L&&l(24,r=L.$$scope)},[b,o,i,a,s,f,c,d,u,m,p,_,I,h,O,T,t,j,S,B,q,J,M,P,r]}class rl extends ie{constructor(e){super(),se(this,e,ll,nl,ae,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const ol=n=>({}),ut=n=>({}),il=n=>({}),ft=n=>({});function sl(n){let e,l,t,r;const o=n[3].sidebar,i=Oe(o,n,n[2],ft),a=n[3].map,s=Oe(a,n,n[2],ut);return{c(){e=$("div"),i&&i.c(),l=C(),t=$("div"),s&&s.c()},m(f,c){v(f,e,c),i&&i.m(e,null),n[4](e),v(f,l,c),v(f,t,c),s&&s.m(t,null),n[5](t),r=!0},p(f,[c]){i&&i.p&&(!r||c&4)&&Be(i,o,f,f[2],r?ze(o,f[2],c,il):Re(f[2]),ft),s&&s.p&&(!r||c&4)&&Be(s,a,f,f[2],r?ze(a,f[2],c,ol):Re(f[2]),ut)},i(f){r||(k(i,f),k(s,f),r=!0)},o(f){y(i,f),y(s,f),r=!1},d(f){f&&(w(e),w(l),w(t)),i&&i.d(f),n[4](null),s&&s.d(f),n[5](null)}}}function al(n,e,l){let t,r;x(n,it,f=>l(0,t=f)),x(n,st,f=>l(1,r=f));let{$$slots:o={},$$scope:i}=e;function a(f){me[f?"unshift":"push"](()=>{t=f,it.set(t)})}function s(f){me[f?"unshift":"push"](()=>{r=f,st.set(r)})}return n.$$set=f=>{"$$scope"in f&&l(2,i=f.$$scope)},[t,r,i,o,a,s]}class Me extends ie{constructor(e){super(),se(this,e,al,sl,ae,{})}}let it=Ke(null),st=Ke(null);function he(){return["","2","1","0","Critical"]}let Se=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"];function cl(n){let e;return{c(){e=$("span"),z(e,"class","dot svelte-117v9mi"),et(e,"outline",n[3]),Y(e,"background-color",n[3]?void 0:n[1]),Y(e,"border-color",n[3]?n[1]:void 0),Y(e,"width",n[2]),Y(e,"height",n[2])},m(l,t){v(l,e,t)},p(l,t){t&8&&et(e,"outline",l[3]),t&10&&Y(e,"background-color",l[3]?void 0:l[1]),t&10&&Y(e,"border-color",l[3]?l[1]:void 0),t&4&&Y(e,"width",l[2]),t&4&&Y(e,"height",l[2])},d(l){l&&w(e)}}}function ul(n){let e,l,t;function r(i){n[4](i)}let o={draggable:!0,$$slots:{default:[cl]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.lngLat=n[0]),e=new Fe({props:o}),me.push(()=>ve(e,"lngLat",r)),{c(){N(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,[a]){const s={};a&46&&(s.$$scope={dirty:a,ctx:i}),!l&&a&1&&(l=!0,s.lngLat=i[0],we(()=>l=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function fl(n,e,l){let{lngLat:t}=e,{color:r}=e,{radius:o="30px"}=e,{outline:i=!1}=e;function a(s){t=s,l(0,t)}return n.$$set=s=>{"lngLat"in s&&l(0,t=s.lngLat),"color"in s&&l(1,r=s.color),"radius"in s&&l(2,o=s.radius),"outline"in s&&l(3,i=s.outline)},[t,r,o,i,a]}class ct extends ie{constructor(e){super(),se(this,e,fl,ul,ae,{lngLat:0,color:1,radius:2,outline:3})}}let Je=Ke(void 0),U=Ke(dl());function ne(n){return{type:"FeatureCollection",features:n}}let W=Ke({kind:"neutral"});function dl(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if("links"in n&&"jats"in n&&"crossings"in n&&"side_roads"in n)return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[],side_roads:[]}}function dt(n){let e,l;return e=new pe({props:{data:ne(n[2].links),$$slots:{default:[ml]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&4&&(o.data=ne(t[2].links)),r&10&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function ml(n){let e,l;return e=new Ae({props:{paint:{"line-color":n[1]?["get","color"]:"black","line-width":6}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&2&&(o.paint={"line-color":t[1]?["get","color"]:"black","line-width":6}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function mt(n){let e,l;return e=new pe({props:{data:ne(n[2].bus_stops),$$slots:{default:[pl]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&4&&(o.data=ne(t[2].bus_stops)),r&8&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function pl(n){let e,l;return e=new Ce({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function pt(n){let e,l;return e=new pe({props:{data:ne(n[2].crossings),$$slots:{default:[gl]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&4&&(o.data=ne(t[2].crossings)),r&8&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function gl(n){let e,l;return e=new Ce({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function gt(n){let e,l;return e=new pe({props:{data:ne(n[2].jats),$$slots:{default:[_l]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&4&&(o.data=ne(t[2].jats)),r&8&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function _l(n){let e,l;return e=new Ce({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function _t(n){let e,l;return e=new pe({props:{data:ne(n[2].side_roads),$$slots:{default:[hl]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&4&&(o.data=ne(t[2].side_roads)),r&8&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function hl(n){let e,l;return e=new Ae({props:{paint:{"line-color":"black","line-width":3}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function $l(n){let e,l,t,r,o,i,a=n[0]!="links"&&dt(n),s=n[0]!="bus_stops"&&mt(n),f=n[0]!="crossings"&&pt(n),c=n[0]!="jats"&&gt(n),d=n[0]!="side_roads"&&_t(n);return{c(){a&&a.c(),e=C(),s&&s.c(),l=C(),f&&f.c(),t=C(),c&&c.c(),r=C(),d&&d.c(),o=Xe()},m(u,m){a&&a.m(u,m),v(u,e,m),s&&s.m(u,m),v(u,l,m),f&&f.m(u,m),v(u,t,m),c&&c.m(u,m),v(u,r,m),d&&d.m(u,m),v(u,o,m),i=!0},p(u,[m]){u[0]!="links"?a?(a.p(u,m),m&1&&k(a,1)):(a=dt(u),a.c(),k(a,1),a.m(e.parentNode,e)):a&&(ce(),y(a,1,1,()=>{a=null}),ue()),u[0]!="bus_stops"?s?(s.p(u,m),m&1&&k(s,1)):(s=mt(u),s.c(),k(s,1),s.m(l.parentNode,l)):s&&(ce(),y(s,1,1,()=>{s=null}),ue()),u[0]!="crossings"?f?(f.p(u,m),m&1&&k(f,1)):(f=pt(u),f.c(),k(f,1),f.m(t.parentNode,t)):f&&(ce(),y(f,1,1,()=>{f=null}),ue()),u[0]!="jats"?c?(c.p(u,m),m&1&&k(c,1)):(c=gt(u),c.c(),k(c,1),c.m(r.parentNode,r)):c&&(ce(),y(c,1,1,()=>{c=null}),ue()),u[0]!="side_roads"?d?(d.p(u,m),m&1&&k(d,1)):(d=_t(u),d.c(),k(d,1),d.m(o.parentNode,o)):d&&(ce(),y(d,1,1,()=>{d=null}),ue())},i(u){i||(k(a),k(s),k(f),k(c),k(d),i=!0)},o(u){y(a),y(s),y(f),y(c),y(d),i=!1},d(u){u&&(w(e),w(l),w(t),w(r),w(o)),a&&a.d(u),s&&s.d(u),f&&f.d(u),c&&c.d(u),d&&d.d(u)}}}function kl(n,e,l){let t;x(n,U,i=>l(2,t=i));let{except:r}=e,{showLinkColor:o=!1}=e;return n.$$set=i=>{"except"in i&&l(0,r=i.except),"showLinkColor"in i&&l(1,o=i.showLinkColor)},[r,o,t]}class De extends ie{constructor(e){super(),se(this,e,kl,$l,ae,{except:0,showLinkColor:1})}}const{window:bl}=He;function vl(n,e,l){const t=n.slice();return t[9]=e[l],t}function wl(n){let e;return{c(){e=$("option"),e.textContent=`${n[9]}`,e.__value=n[9],le(e,e.__value)},m(l,t){v(l,e,t)},p:te,d(l){l&&w(e)}}}function yl(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p,_=K(he()),I=[];for(let h=0;h<_.length;h+=1)I[h]=wl(vl(n,_,h));return{c(){e=$("div"),l=$("button"),l.textContent="Done",t=C(),r=$("button"),r.textContent="Delete bus stop",o=C(),i=$("label"),a=G(`Name:
      `),s=$("input"),f=C(),c=$("label"),d=G(`ST20: bus stops
      `),u=$("select");for(let h=0;h<I.length;h+=1)I[h].c();z(s,"type","text"),n[1].bus_stops[n[0]].properties.st20===void 0&&We(()=>n[8].call(u)),z(e,"slot","sidebar")},m(h,b){v(h,e,b),g(e,l),g(e,t),g(e,r),g(e,o),g(e,i),g(i,a),g(i,s),le(s,n[1].bus_stops[n[0]].properties.name),g(e,f),g(e,c),g(c,d),g(c,u);for(let O=0;O<I.length;O+=1)I[O]&&I[O].m(u,null);Le(u,n[1].bus_stops[n[0]].properties.st20,!0),m||(p=[Z(l,"click",n[6]),Z(r,"click",n[4]),Z(s,"input",n[7]),Z(u,"change",n[8])],m=!0)},p(h,b){b&3&&s.value!==h[1].bus_stops[h[0]].properties.name&&le(s,h[1].bus_stops[h[0]].properties.name),b&3&&Le(u,h[1].bus_stops[h[0]].properties.st20)},d(h){h&&w(e),re(I,h),m=!1,_e(p)}}}function jl(n){let e,l;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Cl(n){let e,l,t,r,o,i,a,s;l=new De({props:{except:"bus_stops"}}),r=new pe({props:{data:ne(n[1].bus_stops),generateId:!0,$$slots:{default:[jl]},$$scope:{ctx:n}}});function f(d){n[5](d)}let c={color:n[1].bus_stops[n[0]].properties.color};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),i=new ct({props:c}),me.push(()=>ve(i,"lngLat",f)),{c(){e=$("div"),N(l.$$.fragment),t=C(),N(r.$$.fragment),o=C(),N(i.$$.fragment),z(e,"slot","map")},m(d,u){v(d,e,u),E(l,e,null),g(e,t),E(r,e,null),g(e,o),E(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].bus_stops)),u&4097&&(m.$$scope={dirty:u,ctx:d}),r.$set(m);const p={};u&3&&(p.color=d[1].bus_stops[d[0]].properties.color),!a&&u&3&&(a=!0,p.lngLat=d[1].bus_stops[d[0]].geometry.coordinates,we(()=>a=!1)),i.$set(p)},i(d){s||(k(l.$$.fragment,d),k(r.$$.fragment,d),k(i.$$.fragment,d),s=!0)},o(d){y(l.$$.fragment,d),y(r.$$.fragment,d),y(i.$$.fragment,d),s=!1},d(d){d&&w(e),D(l),D(r),D(i)}}}function Ll(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[Cl],sidebar:[yl]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){E(e,o,i),l=!0,t||(r=Z(bl,"keydown",n[3]),t=!0)},p(o,[i]){const a={};i&4103&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){D(e,o),t=!1,r()}}}function Sl(n,e,l){let t,r;x(n,U,u=>l(1,t=u)),x(n,W,u=>l(2,r=u));let{idx:o}=e;function i(u){u.key=="Escape"&&X(W,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this bus stop?")&&(X(W,r={kind:"neutral"},r),await Ne(),t.bus_stops.splice(o,1),U.set(t))}function s(u){n.$$.not_equal(t.bus_stops[o].geometry.coordinates,u)&&(t.bus_stops[o].geometry.coordinates=u,U.set(t))}const f=()=>X(W,r={kind:"neutral"},r);function c(){t.bus_stops[o].properties.name=this.value,U.set(t)}function d(){t.bus_stops[o].properties.st20=Ve(this),U.set(t)}return n.$$set=u=>{"idx"in u&&l(0,o=u.idx)},[o,t,r,i,a,s,f,c,d]}class Al extends ie{constructor(e){super(),se(this,e,Sl,Ll,ae,{idx:0})}}const{window:Tl}=He;function Ml(n,e,l){const t=n.slice();return t[9]=e[l],t}function Il(n){let e;return{c(){e=$("option"),e.textContent=`${n[9]}`,e.__value=n[9],le(e,e.__value)},m(l,t){v(l,e,t)},p:te,d(l){l&&w(e)}}}function Nl(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p,_=K(he()),I=[];for(let h=0;h<_.length;h+=1)I[h]=Il(Ml(n,_,h));return{c(){e=$("div"),l=$("button"),l.textContent="Done",t=C(),r=$("button"),r.textContent="Delete crossing",o=C(),i=$("label"),a=G(`Name:
      `),s=$("input"),f=C(),c=$("label"),d=G(`SA10: pedestrian crossing speed
      `),u=$("select");for(let h=0;h<I.length;h+=1)I[h].c();z(s,"type","text"),n[1].crossings[n[0]].properties.sa10===void 0&&We(()=>n[8].call(u)),z(e,"slot","sidebar")},m(h,b){v(h,e,b),g(e,l),g(e,t),g(e,r),g(e,o),g(e,i),g(i,a),g(i,s),le(s,n[1].crossings[n[0]].properties.name),g(e,f),g(e,c),g(c,d),g(c,u);for(let O=0;O<I.length;O+=1)I[O]&&I[O].m(u,null);Le(u,n[1].crossings[n[0]].properties.sa10,!0),m||(p=[Z(l,"click",n[6]),Z(r,"click",n[4]),Z(s,"input",n[7]),Z(u,"change",n[8])],m=!0)},p(h,b){b&3&&s.value!==h[1].crossings[h[0]].properties.name&&le(s,h[1].crossings[h[0]].properties.name),b&3&&Le(u,h[1].crossings[h[0]].properties.sa10)},d(h){h&&w(e),re(I,h),m=!1,_e(p)}}}function El(n){let e,l;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Dl(n){let e,l,t,r,o,i,a,s;l=new De({props:{except:"crossings"}}),r=new pe({props:{data:ne(n[1].crossings),generateId:!0,$$slots:{default:[El]},$$scope:{ctx:n}}});function f(d){n[5](d)}let c={color:n[1].crossings[n[0]].properties.color};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].crossings[n[0]].geometry.coordinates),i=new ct({props:c}),me.push(()=>ve(i,"lngLat",f)),{c(){e=$("div"),N(l.$$.fragment),t=C(),N(r.$$.fragment),o=C(),N(i.$$.fragment),z(e,"slot","map")},m(d,u){v(d,e,u),E(l,e,null),g(e,t),E(r,e,null),g(e,o),E(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].crossings)),u&4097&&(m.$$scope={dirty:u,ctx:d}),r.$set(m);const p={};u&3&&(p.color=d[1].crossings[d[0]].properties.color),!a&&u&3&&(a=!0,p.lngLat=d[1].crossings[d[0]].geometry.coordinates,we(()=>a=!1)),i.$set(p)},i(d){s||(k(l.$$.fragment,d),k(r.$$.fragment,d),k(i.$$.fragment,d),s=!0)},o(d){y(l.$$.fragment,d),y(r.$$.fragment,d),y(i.$$.fragment,d),s=!1},d(d){d&&w(e),D(l),D(r),D(i)}}}function ql(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[Dl],sidebar:[Nl]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){E(e,o,i),l=!0,t||(r=Z(Tl,"keydown",n[3]),t=!0)},p(o,[i]){const a={};i&4103&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){D(e,o),t=!1,r()}}}function Pl(n,e,l){let t,r;x(n,U,u=>l(1,t=u)),x(n,W,u=>l(2,r=u));let{idx:o}=e;function i(u){u.key=="Escape"&&X(W,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this crossing?")&&(X(W,r={kind:"neutral"},r),await Ne(),t.crossings.splice(o,1),U.set(t))}function s(u){n.$$.not_equal(t.crossings[o].geometry.coordinates,u)&&(t.crossings[o].geometry.coordinates=u,U.set(t))}const f=()=>X(W,r={kind:"neutral"},r);function c(){t.crossings[o].properties.name=this.value,U.set(t)}function d(){t.crossings[o].properties.sa10=Ve(this),U.set(t)}return n.$$set=u=>{"idx"in u&&l(0,o=u.idx)},[o,t,r,i,a,s,f,c,d]}class Fl extends ie{constructor(e){super(),se(this,e,Pl,ql,ae,{idx:0})}}let ht="MZEJTanw3WpxRvt7qDfo";async function Ol(n){return n?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await Bl(n)}&key=${n}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${ht}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${ht}`}async function Bl(n){try{let l=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB"})})).json();return"session"in l?l.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(l)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}const Rl="/route-element/assets/right-arrow-d8c7892c.svg";function $t(n){let e,l;const t=n[4].default,r=Oe(t,n,n[3],null);return{c(){e=$("div"),r&&r.c(),z(e,"class","section svelte-zax3q3")},m(o,i){v(o,e,i),r&&r.m(e,null),l=!0},p(o,i){r&&r.p&&(!l||i&8)&&Be(r,t,o,o[3],l?ze(t,o[3],i,null):Re(o[3]),null)},i(o){l||(k(r,o),l=!0)},o(o){y(r,o),l=!1},d(o){o&&w(e),r&&r.d(o)}}}function zl(n){let e,l,t,r,o,i,a,s,f,c,d,u,m=n[2]&&$t(n);return{c(){e=$("button"),l=$("div"),t=$("span"),r=G(n[0]),o=C(),i=$("img"),f=C(),m&&m.c(),z(i,"class","arrow svelte-zax3q3"),ot(i.src,a=Rl)||z(i,"src",a),z(i,"alt",s="Select "+n[0]),z(l,"class","top-section section svelte-zax3q3"),et(l,"bordered",n[2]),z(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m(p,_){v(p,e,_),g(e,l),g(l,t),g(t,r),g(l,o),g(l,i),g(e,f),m&&m.m(e,null),c=!0,d||(u=[Z(e,"click",n[5]),Z(e,"mouseenter",n[6]),Z(e,"mouseleave",n[7])],d=!0)},p(p,[_]){(!c||_&1)&&oe(r,p[0]),(!c||_&1&&s!==(s="Select "+p[0]))&&z(i,"alt",s),(!c||_&4)&&et(l,"bordered",p[2]),p[2]?m?(m.p(p,_),_&4&&k(m,1)):(m=$t(p),m.c(),k(m,1),m.m(e,null)):m&&(ce(),y(m,1,1,()=>{m=null}),ue()),(!c||_&2)&&(e.disabled=p[1])},i(p){c||(k(m),c=!0)},o(p){y(m),c=!1},d(p){p&&w(e),m&&m.d(),d=!1,_e(u)}}}function Jl(n,e,l){let{$$slots:t={},$$scope:r}=e,{name:o}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(d){ye.call(this,n,d)}function f(d){ye.call(this,n,d)}function c(d){ye.call(this,n,d)}return n.$$set=d=>{"name"in d&&l(0,o=d.name),"disabled"in d&&l(1,i=d.disabled),"hasSlot"in d&&l(2,a=d.hasSlot),"$$scope"in d&&l(3,r=d.$$scope)},[o,i,a,r,t,s,f,c]}class qn extends ie{constructor(e){super(),se(this,e,Jl,zl,ae,{name:0,disabled:1,hasSlot:2})}}let Te={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const Hl=n=>({dialog:n&1}),kt=n=>({dialog:n[0]});function Gl(n){let e,l,t,r,o;const i=n[4].default,a=Oe(i,n,n[3],kt);return{c(){e=$("dialog"),l=$("article"),a&&a.c(),e.open=!0},m(s,f){v(s,e,f),g(e,l),a&&a.m(l,null),n[6](e),t=!0,r||(o=[Z(window,"click",n[1]),Z(window,"keydown",n[2]),Z(e,"close",n[5])],r=!0)},p(s,[f]){a&&a.p&&(!t||f&9)&&Be(a,i,s,s[3],t?ze(i,s[3],f,Hl):Re(s[3]),kt)},i(s){t||(k(a,s),t=!0)},o(s){y(a,s),t=!1},d(s){s&&w(e),a&&a.d(s),n[6](null),r=!1,_e(o)}}}function Ul(n,e,l){let{$$slots:t={},$$scope:r}=e,o;function i(c){o.open&&c.target==o&&o.close()}function a(c){(c.key=="Escape"||c.key=="Enter")&&(c.stopPropagation(),o.close())}function s(c){ye.call(this,n,c)}function f(c){me[c?"unshift":"push"](()=>{o=c,l(0,o)})}return n.$$set=c=>{"$$scope"in c&&l(3,r=c.$$scope)},[o,i,a,r,t,s,f]}class Pn extends ie{constructor(e){super(),se(this,e,Ul,Gl,ae,{})}}function Zl(n,e){let l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),l.setAttribute("download",n),document.body.appendChild(l),l.click(),document.body.removeChild(l)}const qe={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius â‰¥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},at=Object.keys(qe);function tt(n){return Object.keys(qe[n])}const Ie="All movements";function bt(n,e){let l=[],t=qe[n][e];t&&l.push({junctionType:n,movementType:e,...t});let r=qe[n][Ie];if(r&&e!=Ie&&l.push({junctionType:n,movementType:Ie,...r}),n=="Crossroads"){let o=qe["Simple priority T-junction"][Ie];o&&l.push({junctionType:"Simple priority T-junction",movementType:Ie,...o})}if(n!="Any type of junction"){let o=qe["Any type of junction"][Ie];o&&l.push({junctionType:"Any type of junction",movementType:Ie,...o})}return l}function vt(n,e,l){const t=n.slice();return t[10]=e[l],t}function wt(n,e,l){const t=n.slice();return t[13]=e[l],t}function yt(n,e,l){const t=n.slice();return t[13]=e[l],t}function jt(n,e,l){const t=n.slice();return t[13]=e[l],t}function Ct(n,e,l){const t=n.slice();return t[20]=e[l],t}function Lt(n,e,l){const t=n.slice();return t[20]=e[l],t}function St(n){let e,l;return e=new Pn({props:{$$slots:{default:[Kl]},$$scope:{ctx:n}}}),e.$on("close",n[9]),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&33554439&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function At(n){let e,l,t,r,o,i,a,s;return i=nt(n[6][1]),{c(){e=$("label"),l=$("input"),t=C(),r=G(n[20]),o=C(),z(l,"type","radio"),l.__value=n[20],le(l,l.__value),i.p(l)},m(f,c){v(f,e,c),g(e,l),l.checked=l.__value===n[1],g(e,t),g(e,r),g(e,o),a||(s=[Z(l,"change",n[5]),Z(l,"change",n[3])],a=!0)},p(f,c){c&2&&(l.checked=l.__value===f[1])},d(f){f&&w(e),i.r(),a=!1,_e(s)}}}function Tt(n){let e,l,t,r=!1,o,i=n[20]+"",a,s,f,c,d;return f=nt(n[6][0]),{c(){e=$("label"),l=$("input"),o=C(),a=G(i),s=C(),z(l,"type","radio"),l.__value=t=n[20],le(l,l.__value),f.p(l)},m(u,m){v(u,e,m),g(e,l),l.checked=l.__value===n[2],g(e,o),g(e,a),g(e,s),c||(d=Z(l,"change",n[7]),c=!0)},p(u,m){m&2&&t!==(t=u[20])&&(l.__value=t,le(l,l.__value),r=!0),(r||m&6)&&(l.checked=l.__value===u[2]),m&2&&i!==(i=u[20]+"")&&oe(a,i)},d(u){u&&w(e),f.r(),c=!1,d()}}}function Mt(n){let e,l=n[13]+"",t;return{c(){e=$("li"),t=G(l)},m(r,o){v(r,e,o),g(e,t)},p(r,o){o&6&&l!==(l=r[13]+"")&&oe(t,l)},d(r){r&&w(e)}}}function It(n){let e,l=n[13]+"",t;return{c(){e=$("li"),t=G(l)},m(r,o){v(r,e,o),g(e,t)},p(r,o){o&6&&l!==(l=r[13]+"")&&oe(t,l)},d(r){r&&w(e)}}}function Nt(n){let e,l=n[13]+"",t;return{c(){e=$("li"),t=G(l)},m(r,o){v(r,e,o),g(e,t)},p(r,o){o&6&&l!==(l=r[13]+"")&&oe(t,l)},d(r){r&&w(e)}}}function Et(n){let e,l,t=n[10].junctionType+"",r,o,i,a,s,f,c=n[10].movementType+"",d,u,m,p,_,I,h,b,O,T,j,S=K(n[10].scoreZero),B=[];for(let L=0;L<S.length;L+=1)B[L]=Mt(jt(n,S,L));let q=K(n[10].scoreOne),J=[];for(let L=0;L<q.length;L+=1)J[L]=It(yt(n,q,L));let M=K(n[10].scoreTwo),P=[];for(let L=0;L<M.length;L+=1)P[L]=Nt(wt(n,M,L));return{c(){e=$("tr"),l=$("td"),r=G(t),o=C(),i=$("br"),a=C(),s=$("br"),f=C(),d=G(c),u=C(),m=$("td"),p=$("ul");for(let L=0;L<B.length;L+=1)B[L].c();_=C(),I=$("td"),h=$("ul");for(let L=0;L<J.length;L+=1)J[L].c();b=C(),O=$("td"),T=$("ul");for(let L=0;L<P.length;L+=1)P[L].c();j=C(),z(l,"class","type-row svelte-k4kgn3"),z(m,"class","score-zero svelte-k4kgn3"),z(I,"class","score-one svelte-k4kgn3"),z(O,"class","score-two svelte-k4kgn3")},m(L,H){v(L,e,H),g(e,l),g(l,r),g(l,o),g(l,i),g(l,a),g(l,s),g(l,f),g(l,d),g(e,u),g(e,m),g(m,p);for(let A=0;A<B.length;A+=1)B[A]&&B[A].m(p,null);g(e,_),g(e,I),g(I,h);for(let A=0;A<J.length;A+=1)J[A]&&J[A].m(h,null);g(e,b),g(e,O),g(O,T);for(let A=0;A<P.length;A+=1)P[A]&&P[A].m(T,null);g(e,j)},p(L,H){if(H&6&&t!==(t=L[10].junctionType+"")&&oe(r,t),H&6&&c!==(c=L[10].movementType+"")&&oe(d,c),H&6){S=K(L[10].scoreZero);let A;for(A=0;A<S.length;A+=1){const ge=jt(L,S,A);B[A]?B[A].p(ge,H):(B[A]=Mt(ge),B[A].c(),B[A].m(p,null))}for(;A<B.length;A+=1)B[A].d(1);B.length=S.length}if(H&6){q=K(L[10].scoreOne);let A;for(A=0;A<q.length;A+=1){const ge=yt(L,q,A);J[A]?J[A].p(ge,H):(J[A]=It(ge),J[A].c(),J[A].m(h,null))}for(;A<J.length;A+=1)J[A].d(1);J.length=q.length}if(H&6){M=K(L[10].scoreTwo);let A;for(A=0;A<M.length;A+=1){const ge=wt(L,M,A);P[A]?P[A].p(ge,H):(P[A]=Nt(ge),P[A].c(),P[A].m(T,null))}for(;A<P.length;A+=1)P[A].d(1);P.length=M.length}},d(L){L&&w(e),re(B,L),re(J,L),re(P,L)}}}function Kl(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p,_,I,h,b=K(at),O=[];for(let q=0;q<b.length;q+=1)O[q]=At(Lt(n,b,q));let T=K(tt(n[1])),j=[];for(let q=0;q<T.length;q+=1)j[q]=Tt(Ct(n,T,q));let S=K(bt(n[1],n[2])),B=[];for(let q=0;q<S.length;q+=1)B[q]=Et(vt(n,S,q));return{c(){e=$("h1"),e.textContent="LTN 1/20 scoring guidance",l=C(),t=$("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,r=C(),o=$("div"),i=G(`Type of junction:
      `),a=$("fieldset");for(let q=0;q<O.length;q+=1)O[q].c();s=G(`

      Type of movement:
      `),f=$("fieldset");for(let q=0;q<j.length;q+=1)j[q].c();c=C(),d=$("table"),u=$("tr"),u.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,m=C();for(let q=0;q<B.length;q+=1)B[q].c();p=C(),_=$("button"),_.textContent="OK",Y(o,"display","flex"),Y(o,"justify-content","space-between")},m(q,J){v(q,e,J),v(q,l,J),v(q,t,J),v(q,r,J),v(q,o,J),g(o,i),g(o,a);for(let M=0;M<O.length;M+=1)O[M]&&O[M].m(a,null);g(o,s),g(o,f);for(let M=0;M<j.length;M+=1)j[M]&&j[M].m(f,null);v(q,c,J),v(q,d,J),g(d,u),g(d,m);for(let M=0;M<B.length;M+=1)B[M]&&B[M].m(d,null);v(q,p,J),v(q,_,J),I||(h=Z(_,"click",n[8]),I=!0)},p(q,J){if(J&10){b=K(at);let M;for(M=0;M<b.length;M+=1){const P=Lt(q,b,M);O[M]?O[M].p(P,J):(O[M]=At(P),O[M].c(),O[M].m(a,null))}for(;M<O.length;M+=1)O[M].d(1);O.length=b.length}if(J&6){T=K(tt(q[1]));let M;for(M=0;M<T.length;M+=1){const P=Ct(q,T,M);j[M]?j[M].p(P,J):(j[M]=Tt(P),j[M].c(),j[M].m(f,null))}for(;M<j.length;M+=1)j[M].d(1);j.length=T.length}if(J&6){S=K(bt(q[1],q[2]));let M;for(M=0;M<S.length;M+=1){const P=vt(q,S,M);B[M]?B[M].p(P,J):(B[M]=Et(P),B[M].c(),B[M].m(d,null))}for(;M<B.length;M+=1)B[M].d(1);B.length=S.length}},d(q){q&&(w(e),w(l),w(t),w(r),w(o),w(c),w(d),w(p),w(_)),re(O,q),re(j,q),re(B,q),I=!1,h()}}}function Xl(n){let e,l,t,r,o,i,a=n[0]&&St(n);return{c(){e=$("button"),e.textContent="LTN 1/20 scoring guidance",l=C(),a&&a.c(),t=Xe(),z(e,"class","secondary")},m(s,f){v(s,e,f),v(s,l,f),a&&a.m(s,f),v(s,t,f),r=!0,o||(i=Z(e,"click",n[4]),o=!0)},p(s,[f]){s[0]?a?(a.p(s,f),f&1&&k(a,1)):(a=St(s),a.c(),k(a,1),a.m(t.parentNode,t)):a&&(ce(),y(a,1,1,()=>{a=null}),ue())},i(s){r||(k(a),r=!0)},o(s){y(a),r=!1},d(s){s&&(w(e),w(l),w(t)),a&&a.d(s),o=!1,i()}}}function Wl(n,e,l){let t=!1,r=at[0],o=tt(r)[0];function i(){l(2,o=tt(r)[0])}const a=[[],[]],s=()=>l(0,t=!0);function f(){r=this.__value,l(1,r)}function c(){o=this.__value,l(2,o)}return[t,r,o,i,s,f,a,c,()=>l(0,t=!1),()=>l(0,t=!1)]}class Vl extends ie{constructor(e){super(),se(this,e,Wl,Xl,ae,{})}}function Dt(n,e,l){const t=n.slice();return t[11]=e[l][0],t[12]=e[l][1],t}function qt(n){let e,l;return e=new Vl({}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Pt(n){let e,l,t,r=n[12]+"",o,i,a,s,f;return a=nt(n[7][0]),{c(){e=$("label"),l=$("input"),t=C(),o=G(r),i=C(),z(l,"type","radio"),l.__value=n[11],le(l,l.__value),a.p(l)},m(c,d){v(c,e,d),g(e,l),l.checked=l.__value===n[3].jats[n[0]].properties[n[1]].movements[n[2]].score,g(e,t),g(e,o),g(e,i),s||(f=Z(l,"change",n[9]),s=!0)},p(c,d){d&15&&(l.checked=l.__value===c[3].jats[c[0]].properties[c[1]].movements[c[2]].score)},d(c){c&&w(e),a.r(),s=!1,f()}}}function Ql(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p,_,I,h,b,O,T,j,S,B,q=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind=="cycling"&&qt(),J=K(n[4]),M=[];for(let P=0;P<J.length;P+=1)M[P]=Pt(Dt(n,J,P));return j=nt(n[7][1]),{c(){e=$("label"),l=G(`Name
  `),t=$("input"),r=C(),o=$("fieldset"),i=$("label"),a=$("input"),s=G(`
    Cycling`),f=C(),c=$("label"),d=$("input"),u=G(`
    Walking & Wheeling`),m=C(),q&&q.c(),p=C(),_=$("fieldset");for(let P=0;P<M.length;P+=1)M[P].c();I=C(),h=$("label"),b=G(`Comments
  `),O=$("textarea"),z(t,"type","text"),z(a,"type","radio"),a.__value="cycling",le(a,a.__value),z(d,"type","radio"),d.__value="walking & wheeling",le(d,d.__value),j.p(a,d)},m(P,L){v(P,e,L),g(e,l),g(e,t),le(t,n[3].jats[n[0]].properties[n[1]].movements[n[2]].name),v(P,r,L),v(P,o,L),g(o,i),g(i,a),a.checked=a.__value===n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind,g(i,s),g(o,f),g(o,c),g(c,d),d.checked=d.__value===n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind,g(c,u),v(P,m,L),q&&q.m(P,L),v(P,p,L),v(P,_,L);for(let H=0;H<M.length;H+=1)M[H]&&M[H].m(_,null);v(P,I,L),v(P,h,L),g(h,b),g(h,O),le(O,n[3].jats[n[0]].properties[n[1]].movements[n[2]].notes),T=!0,S||(B=[Z(t,"input",n[5]),Z(a,"change",n[6]),Z(d,"change",n[8]),Z(O,"input",n[10])],S=!0)},p(P,[L]){if(L&15&&t.value!==P[3].jats[P[0]].properties[P[1]].movements[P[2]].name&&le(t,P[3].jats[P[0]].properties[P[1]].movements[P[2]].name),L&15&&(a.checked=a.__value===P[3].jats[P[0]].properties[P[1]].movements[P[2]].kind),L&15&&(d.checked=d.__value===P[3].jats[P[0]].properties[P[1]].movements[P[2]].kind),P[3].jats[P[0]].properties[P[1]].movements[P[2]].kind=="cycling"?q?L&15&&k(q,1):(q=qt(),q.c(),k(q,1),q.m(p.parentNode,p)):q&&(ce(),y(q,1,1,()=>{q=null}),ue()),L&31){J=K(P[4]);let H;for(H=0;H<J.length;H+=1){const A=Dt(P,J,H);M[H]?M[H].p(A,L):(M[H]=Pt(A),M[H].c(),M[H].m(_,null))}for(;H<M.length;H+=1)M[H].d(1);M.length=J.length}L&15&&le(O,P[3].jats[P[0]].properties[P[1]].movements[P[2]].notes)},i(P){T||(k(q),T=!0)},o(P){y(q),T=!1},d(P){P&&(w(e),w(r),w(o),w(m),w(p),w(_),w(I),w(h)),q&&q.d(P),re(M,P),j.r(),S=!1,_e(B)}}}function Yl(n,e,l){let t;x(n,U,p=>l(3,t=p));let{junctionIdx:r}=e,{stage:o}=e,{idx:i}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];const s=[[],[]];function f(){t.jats[r].properties[o].movements[i].name=this.value,U.set(t)}function c(){t.jats[r].properties[o].movements[i].kind=this.__value,U.set(t)}function d(){t.jats[r].properties[o].movements[i].kind=this.__value,U.set(t)}function u(){t.jats[r].properties[o].movements[i].score=this.__value,U.set(t)}function m(){t.jats[r].properties[o].movements[i].notes=this.value,U.set(t)}return n.$$set=p=>{"junctionIdx"in p&&l(0,r=p.junctionIdx),"stage"in p&&l(1,o=p.stage),"idx"in p&&l(2,i=p.idx)},[r,o,i,t,a,f,c,s,d,u,m]}class xl extends ie{constructor(e){super(),se(this,e,Yl,Ql,ae,{junctionIdx:0,stage:1,idx:2})}}function er(n){return n%(2*Math.PI)*180/Math.PI}function Ye(n){return n%360*Math.PI/180}function Ft(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Fn(n,e,l={}){if(l.final===!0)return tr(n,e);const t=Ft(n),r=Ft(e),o=Ye(t[0]),i=Ye(r[0]),a=Ye(t[1]),s=Ye(r[1]),f=Math.sin(i-o)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-o);return er(Math.atan2(f,c))}function tr(n,e){let l=Fn(e,n);return l=(l+180)%360,l}var Pe=Fn;function nr(n,e,l={}){const t={type:"Feature"};return(l.id===0||l.id)&&(t.id=l.id),l.bbox&&(t.bbox=l.bbox),t.properties=e||{},t.geometry=n,t}function lr(n,e,l={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ot(n[0])||!Ot(n[1]))throw new Error("coordinates must contain numbers");return nr({type:"Point",coordinates:n},e,l)}function Ot(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function rr(n,e={}){const l=Kn(n),t=(l[0]+l[2])/2,r=(l[1]+l[3])/2;return lr([t,r],e.properties,e)}var or=rr,$e=63710088e-1,ir={centimeters:$e*100,centimetres:$e*100,degrees:360/(2*Math.PI),feet:$e*3.28084,inches:$e*39.37,kilometers:$e/1e3,kilometres:$e/1e3,meters:$e,metres:$e,miles:$e/1609.344,millimeters:$e*1e3,millimetres:$e*1e3,nauticalmiles:$e/1852,radians:1,yards:$e*1.0936};function sr(n,e,l={}){const t={type:"Feature"};return(l.id===0||l.id)&&(t.id=l.id),l.bbox&&(t.bbox=l.bbox),t.properties=e||{},t.geometry=n,t}function ar(n,e,l={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Rt(n[0])||!Rt(n[1]))throw new Error("coordinates must contain numbers");return sr({type:"Point",coordinates:n},e,l)}function cr(n,e="kilometers"){const l=ir[e];if(!l)throw new Error(e+" units is invalid");return n/l}function Bt(n){return n%(2*Math.PI)*180/Math.PI}function rt(n){return n%360*Math.PI/180}function Rt(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function ur(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function fr(n,e,l,t={}){const r=ur(n),o=rt(r[0]),i=rt(r[1]),a=rt(l),s=cr(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(f)),d=Bt(c),u=Bt(f);return ar([d,u],t.properties)}var Ze=fr,ke=63710088e-1,dr={centimeters:ke*100,centimetres:ke*100,degrees:360/(2*Math.PI),feet:ke*3.28084,inches:ke*39.37,kilometers:ke/1e3,kilometres:ke/1e3,meters:ke,metres:ke,miles:ke/1609.344,millimeters:ke*1e3,millimetres:ke*1e3,nauticalmiles:ke/1852,radians:1,yards:ke*1.0936};function mr(n,e="kilometers"){const l=dr[e];if(!l)throw new Error(e+" units is invalid");return n*l}function xe(n){return n%360*Math.PI/180}function zt(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function pr(n,e,l={}){var t=zt(n),r=zt(e),o=xe(r[1]-t[1]),i=xe(r[0]-t[0]),a=xe(t[1]),s=xe(r[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return mr(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),l.units)}var gr=pr;function _r(n){let e=or({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,r)=>Jt(Pe(e,r.point))-Jt(Pe(e,t.point)));let l=[];for(let t=0;t<n.length;t++){let r=n[t],o=Pe(r.point,e),i=1;for(let a of $r(t,n.length)){let s=n[a],f=Pe(e,s.point),c=hr(r.point,e,i++),d=gr(r.point,e),u=Ze(c,.5*d,o).geometry.coordinates,m=Ze(u,.2*d,f).geometry.coordinates;l.push({point1:c,point2:u,point3:m,kind:"cycling",score:"X",name:`${r.name} to ${s.name}`,notes:""})}}return l}function hr(n,e,l){let t=.003,o=Pe(n,e)-90,i=t*l;return Ze(n,i,o).geometry.coordinates}function Jt(n){return(n+360)%360}function $r(n,e){let l=[];for(let t=n+1;t<e;t++)l.push(t);for(let t=0;t<n;t++)l.push(t);return l}const kr="/route-element/assets/movement-aa45473c.svg",br="/route-element/assets/pan-fbcec4cd.svg";function Ht(n,e,l){const t=n.slice();return t[31]=e[l],t[32]=e,t[33]=l,t}function Gt(n,e,l){const t=n.slice();return t[34]=e[l],t[35]=e,t[33]=l,t}function Ut(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p,_,I,h,b,O;function T(H,A){return H[0].mode=="select"?wr:vr}let j=T(n),S=j(n);function B(H,A){return H[0].mode=="new-arm"?jr:yr}let q=B(n),J=q(n);function M(H,A){return H[0].mode=="new-movement"?Lr:Cr}let P=M(n),L=P(n);return{c(){e=$("div"),l=$("button"),t=$("img"),o=C(),S.c(),i=C(),a=$("button"),s=lt("svg"),f=lt("circle"),c=lt("text"),d=G("A"),u=C(),J.c(),m=C(),p=$("button"),_=$("img"),h=C(),L.c(),ot(t.src,r=br)||z(t,"src",r),z(t,"alt","Move map"),Y(t,"vertical-align","middle"),z(l,"class","outline"),z(f,"cx","12"),z(f,"cy","12"),z(f,"r","12"),z(f,"fill","white"),z(c,"x","6"),z(c,"y","16"),z(c,"fill","#4472c4"),z(s,"width","24"),z(s,"height","24"),z(s,"xmlns","http://www.w3.org/2000/svg"),Y(s,"vertical-align","middle"),z(a,"class","outline"),ot(_.src,I=kr)||z(_,"src",I),z(_,"alt","New movement"),Y(_,"vertical-align","middle"),z(p,"class","outline"),z(e,"class","control-panel svelte-l1e6xi")},m(H,A){v(H,e,A),g(e,l),g(l,t),g(l,o),S.m(l,null),g(e,i),g(e,a),g(a,s),g(s,f),g(s,c),g(c,d),g(a,u),J.m(a,null),g(e,m),g(e,p),g(p,_),g(p,h),L.m(p,null),b||(O=[Z(l,"click",function(){Xn(n[4])&&n[4].apply(this,arguments)}),Z(a,"click",n[12]),Z(p,"click",n[13])],b=!0)},p(H,A){n=H,j!==(j=T(n))&&(S.d(1),S=j(n),S&&(S.c(),S.m(l,null))),q!==(q=B(n))&&(J.d(1),J=q(n),J&&(J.c(),J.m(a,null))),P!==(P=M(n))&&(L.d(1),L=P(n),L&&(L.c(),L.m(p,null)))},d(H){H&&w(e),S.d(),J.d(),L.d(),b=!1,_e(O)}}}function vr(n){let e;return{c(){e=G("Move map")},m(l,t){v(l,e,t)},d(l){l&&w(e)}}}function wr(n){let e;return{c(){e=$("b"),e.textContent="Move map"},m(l,t){v(l,e,t)},d(l){l&&w(e)}}}function yr(n){let e;return{c(){e=G("New arm")},m(l,t){v(l,e,t)},d(l){l&&w(e)}}}function jr(n){let e;return{c(){e=$("b"),e.textContent="New arm"},m(l,t){v(l,e,t)},d(l){l&&w(e)}}}function Cr(n){let e;return{c(){e=G("New movement")},m(l,t){v(l,e,t)},d(l){l&&w(e)}}}function Lr(n){let e;return{c(){e=$("b"),e.textContent="New movement"},m(l,t){v(l,e,t)},d(l){l&&w(e)}}}function Sr(n){let e;return{c(){e=$("span"),e.textContent=`${Br(n[33])}`,z(e,"class","dot svelte-l1e6xi"),Y(e,"color","#4472c4"),Y(e,"background-color","white")},m(l,t){v(l,e,t)},p:te,d(l){l&&w(e)}}}function Zt(n){let e,l,t;function r(s){n[14](s,n[34])}function o(){return n[15](n[33])}function i(){return n[16](n[33])}let a={draggable:!0,$$slots:{default:[Sr]},$$scope:{ctx:n}};return n[34].point!==void 0&&(a.lngLat=n[34].point),e=new Fe({props:a}),me.push(()=>ve(e,"lngLat",r)),e.$on("dragend",o),e.$on("click",i),{c(){N(e.$$.fragment)},m(s,f){E(e,s,f),t=!0},p(s,f){n=s;const c={};f[1]&32&&(c.$$scope={dirty:f,ctx:n}),!l&&f[0]&38&&(l=!0,c.lngLat=n[34].point,we(()=>l=!1)),e.$set(c)},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){D(e,s)}}}function Ar(n){let e;return{c(){e=$("span"),z(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score]),Y(e,"opacity",n[31].kind=="walking & wheeling"?"0%":"100%")},m(l,t){v(l,e,t)},p(l,t){t[0]&38&&Y(e,"background-color",l[7][l[31].score]),t[0]&38&&Y(e,"opacity",l[31].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&w(e)}}}function Tr(n){let e;return{c(){e=$("span"),z(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score])},m(l,t){v(l,e,t)},p(l,t){t[0]&38&&Y(e,"background-color",l[7][l[31].score])},d(l){l&&w(e)}}}function Mr(n){let e;return{c(){e=$("span"),z(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[7][n[31].score]),Y(e,"opacity","0%")},m(l,t){v(l,e,t)},p(l,t){t[0]&38&&Y(e,"background-color",l[7][l[31].score])},d(l){l&&w(e)}}}function Kt(n){let e,l,t,r,o,i,a,s,f;function c(S){n[17](S,n[31])}function d(){return n[18](n[33])}function u(){return n[19](n[33])}let m={draggable:!0,$$slots:{default:[Ar]},$$scope:{ctx:n}};n[31].point1!==void 0&&(m.lngLat=n[31].point1),e=new Fe({props:m}),me.push(()=>ve(e,"lngLat",c)),e.$on("dragend",d),e.$on("click",u);function p(S){n[20](S,n[31])}function _(){return n[21](n[33])}function I(){return n[22](n[33])}let h={draggable:!0,$$slots:{default:[Tr]},$$scope:{ctx:n}};n[31].point2!==void 0&&(h.lngLat=n[31].point2),r=new Fe({props:h}),me.push(()=>ve(r,"lngLat",p)),r.$on("dragend",_),r.$on("click",I);function b(S){n[23](S,n[31])}function O(){return n[24](n[33])}function T(){return n[25](n[33])}let j={draggable:!0,$$slots:{default:[Mr]},$$scope:{ctx:n}};return n[31].point3!==void 0&&(j.lngLat=n[31].point3),a=new Fe({props:j}),me.push(()=>ve(a,"lngLat",b)),a.$on("dragend",O),a.$on("click",T),{c(){N(e.$$.fragment),t=C(),N(r.$$.fragment),i=C(),N(a.$$.fragment)},m(S,B){E(e,S,B),v(S,t,B),E(r,S,B),v(S,i,B),E(a,S,B),f=!0},p(S,B){n=S;const q={};B[0]&38|B[1]&32&&(q.$$scope={dirty:B,ctx:n}),!l&&B[0]&38&&(l=!0,q.lngLat=n[31].point1,we(()=>l=!1)),e.$set(q);const J={};B[0]&38|B[1]&32&&(J.$$scope={dirty:B,ctx:n}),!o&&B[0]&38&&(o=!0,J.lngLat=n[31].point2,we(()=>o=!1)),r.$set(J);const M={};B[0]&38|B[1]&32&&(M.$$scope={dirty:B,ctx:n}),!s&&B[0]&38&&(s=!0,M.lngLat=n[31].point3,we(()=>s=!1)),a.$set(M)},i(S){f||(k(e.$$.fragment,S),k(r.$$.fragment,S),k(a.$$.fragment,S),f=!0)},o(S){y(e.$$.fragment,S),y(r.$$.fragment,S),y(a.$$.fragment,S),f=!1},d(S){S&&(w(t),w(i)),D(e,S),D(r,S),D(a,S)}}}function Ir(n){let e=(n[30].name||"Untitled movement")+"",l;return{c(){l=G(e)},m(t,r){v(t,l,r)},p(t,r){r[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&oe(l,e)},d(t){t&&w(l)}}}function Nr(n){let e,l;return e=new En({props:{$$slots:{default:[Ir,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Er(n){let e=(n[30].name||"Untitled movement")+"",l;return{c(){l=G(e)},m(t,r){v(t,l,r)},p(t,r){r[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&oe(l,e)},d(t){t&&w(l)}}}function Dr(n){let e,l;return e=new En({props:{$$slots:{default:[Er,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function qr(n){let e,l,t,r,o,i;return e=new Ae({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Ee(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Nr]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Ae({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Ee(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Dr]},$$scope:{ctx:n}}}),t.$on("click",n[9]),o=new rl({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){N(e.$$.fragment),l=C(),N(t.$$.fragment),r=C(),N(o.$$.fragment)},m(a,s){E(e,a,s),v(a,l,s),E(t,a,s),v(a,r,s),E(o,a,s),i=!0},p(a,s){const f={};s[1]&32&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const c={};s[1]&32&&(c.$$scope={dirty:s,ctx:a}),t.$set(c)},i(a){i||(k(e.$$.fragment,a),k(t.$$.fragment,a),k(o.$$.fragment,a),i=!0)},o(a){y(e.$$.fragment,a),y(t.$$.fragment,a),y(o.$$.fragment,a),i=!1},d(a){a&&(w(l),w(r)),D(e,a),D(t,a),D(o,a)}}}function Pr(n){let e,l,t,r;return e=new Ae({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Ce({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){N(e.$$.fragment),l=C(),N(t.$$.fragment)},m(o,i){E(e,o,i),v(o,l,i),E(t,o,i),r=!0},p:te,i(o){r||(k(e.$$.fragment,o),k(t.$$.fragment,o),r=!0)},o(o){y(e.$$.fragment,o),y(t.$$.fragment,o),r=!1},d(o){o&&w(l),D(e,o),D(t,o)}}}function Fr(n){let e,l,t,r,o,i,a,s,f;e=new Dn({}),e.$on("click",n[8]);let c=n[0].mode!="editing"&&Ut(n),d=K(n[5].jats[n[1]].properties[n[2]].arms),u=[];for(let h=0;h<d.length;h+=1)u[h]=Zt(Gt(n,d,h));const m=h=>y(u[h],1,1,()=>{u[h]=null});let p=K(n[5].jats[n[1]].properties[n[2]].movements),_=[];for(let h=0;h<p.length;h+=1)_[h]=Kt(Ht(n,p,h));const I=h=>y(_[h],1,1,()=>{_[h]=null});return i=new pe({props:{data:n[10](n[5]),$$slots:{default:[qr]},$$scope:{ctx:n}}}),s=new pe({props:{data:n[6],$$slots:{default:[Pr]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment),l=C(),c&&c.c(),t=C();for(let h=0;h<u.length;h+=1)u[h].c();r=C();for(let h=0;h<_.length;h+=1)_[h].c();o=C(),N(i.$$.fragment),a=C(),N(s.$$.fragment)},m(h,b){E(e,h,b),v(h,l,b),c&&c.m(h,b),v(h,t,b);for(let O=0;O<u.length;O+=1)u[O]&&u[O].m(h,b);v(h,r,b);for(let O=0;O<_.length;O+=1)_[O]&&_[O].m(h,b);v(h,o,b),E(i,h,b),v(h,a,b),E(s,h,b),f=!0},p(h,b){if(h[0].mode!="editing"?c?c.p(h,b):(c=Ut(h),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),b[0]&46){d=K(h[5].jats[h[1]].properties[h[2]].arms);let j;for(j=0;j<d.length;j+=1){const S=Gt(h,d,j);u[j]?(u[j].p(S,b),k(u[j],1)):(u[j]=Zt(S),u[j].c(),k(u[j],1),u[j].m(r.parentNode,r))}for(ce(),j=d.length;j<u.length;j+=1)m(j);ue()}if(b[0]&174){p=K(h[5].jats[h[1]].properties[h[2]].movements);let j;for(j=0;j<p.length;j+=1){const S=Ht(h,p,j);_[j]?(_[j].p(S,b),k(_[j],1)):(_[j]=Kt(S),_[j].c(),k(_[j],1),_[j].m(o.parentNode,o))}for(ce(),j=p.length;j<_.length;j+=1)I(j);ue()}const O={};b[0]&32&&(O.data=h[10](h[5])),b[1]&32&&(O.$$scope={dirty:b,ctx:h}),i.$set(O);const T={};b[0]&64&&(T.data=h[6]),b[1]&32&&(T.$$scope={dirty:b,ctx:h}),s.$set(T)},i(h){if(!f){k(e.$$.fragment,h);for(let b=0;b<d.length;b+=1)k(u[b]);for(let b=0;b<p.length;b+=1)k(_[b]);k(i.$$.fragment,h),k(s.$$.fragment,h),f=!0}},o(h){y(e.$$.fragment,h),u=u.filter(Boolean);for(let b=0;b<u.length;b+=1)y(u[b]);_=_.filter(Boolean);for(let b=0;b<_.length;b+=1)y(_[b]);y(i.$$.fragment,h),y(s.$$.fragment,h),f=!1},d(h){h&&(w(l),w(t),w(r),w(o),w(a)),D(e,h),c&&c.d(h),re(u,h),re(_,h),D(i,h),D(s,h)}}}function Or(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function Br(n){return String.fromCharCode(n+"A".charCodeAt(0))}function Rr(n,e,l){let t,r,o;x(n,U,R=>l(5,r=R)),x(n,Je,R=>l(26,o=R));let{junctionIdx:i}=e,{stage:a}=e,{mode:s}=e,{hoveringSidebar:f}=e,{select:c}=e,{stopEditing:d}=e,u={0:Te.red.background,1:Te.amber.background,2:Te.green.background,X:Te.critical.background};function m(R,V,je){let fe={type:"FeatureCollection",features:[]},F=V.mode=="editing"?V.id:je;return F!=null&&(F.kind=="arm"?fe.features.push(Or(R.jats[i].properties[a].arms[F.idx],F.idx)):fe.features.push(h(R.jats[i].properties[a].movements[F.idx],F.idx))),fe}async function p(R){if(o){for(let V of o.queryRenderedFeatures(R.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await d();return}s.mode=="new-arm"?(X(U,r.jats[i].properties[a].arms=[...r.jats[i].properties[a].arms,{point:R.detail.lngLat.toArray(),name:""}],r),await c({kind:"arm",idx:r.jats[i].properties[a].arms.length-1})):(X(U,r.jats[i].properties[a].movements=[...r.jats[i].properties[a].movements,{point1:R.detail.lngLat.toArray(),point2:Ze(R.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Ze(R.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],r),await c({kind:"movement",idx:r.jats[i].properties[a].movements.length-1}))}}}async function _(R){await c({kind:"movement",idx:R.detail.features[0].id})}function I(R){let V={type:"FeatureCollection",features:R.jats[i].properties[a].movements.map((je,fe)=>h(je,fe))};for(let je of R.jats[i].properties[a].movements)if(V.features.push(b(je,V.features.length)),je.kind=="walking & wheeling"){let fe={...je,point1:je.point3,point3:je.point1};V.features.push(b(fe,V.features.length))}return V}function h(R,V){return{type:"Feature",id:V,properties:{name:R.name,kind:R.kind,color:u[R.score]},geometry:{type:"LineString",coordinates:[R.point1,R.point2,R.point3]}}}function b(R,V){return{type:"Feature",id:V,properties:{kind:R.kind,color:u[R.score],angle:Pe(R.point2,R.point3)},geometry:{type:"Point",coordinates:R.point3}}}const O=()=>l(0,s={mode:"new-arm"}),T=()=>l(0,s={mode:"new-movement"});function j(R,V){n.$$.not_equal(V.point,R)&&(V.point=R,U.set(r))}const S=R=>c({kind:"arm",idx:R}),B=R=>c({kind:"arm",idx:R});function q(R,V){n.$$.not_equal(V.point1,R)&&(V.point1=R,U.set(r))}const J=R=>c({kind:"movement",idx:R}),M=R=>c({kind:"movement",idx:R});function P(R,V){n.$$.not_equal(V.point2,R)&&(V.point2=R,U.set(r))}const L=R=>c({kind:"movement",idx:R}),H=R=>c({kind:"movement",idx:R});function A(R,V){n.$$.not_equal(V.point3,R)&&(V.point3=R,U.set(r))}const ge=R=>c({kind:"movement",idx:R}),de=R=>c({kind:"movement",idx:R});return n.$$set=R=>{"junctionIdx"in R&&l(1,i=R.junctionIdx),"stage"in R&&l(2,a=R.stage),"mode"in R&&l(0,s=R.mode),"hoveringSidebar"in R&&l(11,f=R.hoveringSidebar),"select"in R&&l(3,c=R.select),"stopEditing"in R&&l(4,d=R.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&2081&&l(6,t=m(r,s,f))},[s,i,a,c,d,r,t,u,p,_,I,f,O,T,j,S,B,q,J,M,P,L,H,A,ge,de]}class zr extends ie{constructor(e){super(),se(this,e,Rr,Fr,ae,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function Xt(n){if(n.movements.length==0)return"No movements added";let e=0,l=0;for(let r of n.movements)e+={0:0,1:1,2:2,X:0}[r.score],l+=2;let t=e/l*100;return`${Math.round(t)}%`}const{window:Jr}=He;function Wt(n,e,l){const t=n.slice();t[27]=e[l],t[30]=l;const r=t[14][t[27].score];return t[28]=r,t}function Vt(n,e,l){const t=n.slice();return t[31]=e[l],t[30]=l,t}function Hr(n){let e,l,t,r,o,i,a,s,f;return{c(){e=$("button"),e.textContent="Done",l=C(),t=$("button"),t.textContent="Delete",r=C(),o=$("label"),i=G(`Arm name
        `),a=$("input"),z(a,"type","text")},m(c,d){v(c,e,d),v(c,l,d),v(c,t,d),v(c,r,d),v(c,o,d),g(o,i),g(o,a),le(a,n[5].jats[n[0]].properties[n[1]].arms[n[2].id.idx].name),s||(f=[Z(e,"click",n[23]),Z(t,"click",n[10]),Z(a,"input",n[24])],s=!0)},p(c,d){d[0]&39&&a.value!==c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name&&le(a,c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name)},i:te,o:te,d(c){c&&(w(e),w(l),w(t),w(r),w(o)),s=!1,_e(f)}}}function Gr(n){let e,l,t,r,o,i,a,s;return e=new xl({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),{c(){N(e.$$.fragment),l=C(),t=$("button"),t.textContent="Save",r=C(),o=$("button"),o.textContent="Delete"},m(f,c){E(e,f,c),v(f,l,c),v(f,t,c),v(f,r,c),v(f,o,c),i=!0,a||(s=[Z(t,"click",n[9]),Z(o,"click",n[10])],a=!0)},p(f,c){const d={};c[0]&1&&(d.junctionIdx=f[0]),c[0]&2&&(d.stage=f[1]),c[0]&4&&(d.idx=f[2].id.idx),e.$set(d)},i(f){i||(k(e.$$.fragment,f),i=!0)},o(f){y(e.$$.fragment,f),i=!1},d(f){f&&(w(l),w(t),w(r),w(o)),D(e,f),a=!1,_e(s)}}}function Ur(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p=n[5].jats[n[0]].properties.name+"",_,I,h=Xt(n[5].jats[n[0]].properties[n[1]])+"",b,O,T,j,S,B,q,J,M,P,L,H=K(n[5].jats[n[0]].properties[n[1]].arms),A=[];for(let F=0;F<H.length;F+=1)A[F]=Qt(Vt(n,H,F));const ge=F=>y(A[F],1,1,()=>{A[F]=null});let de=n[5].jats[n[0]].properties[n[7]].arms.length>0&&Yt(n),R=K(n[5].jats[n[0]].properties[n[1]].movements),V=[];for(let F=0;F<R.length;F+=1)V[F]=xt(Wt(n,R,F));const je=F=>y(V[F],1,1,()=>{V[F]=null});let fe=n[5].jats[n[0]].properties[n[7]].movements.length>0&&en(n);return{c(){e=$("button"),e.textContent="Done",l=C(),t=$("h3"),t.textContent="Arms",r=C();for(let F=0;F<A.length;F+=1)A[F].c();o=C(),de&&de.c(),i=C(),a=$("h3"),a.textContent="Movements",s=C(),f=$("p"),c=G("Total JAT score for "),d=G(n[1]),u=G(` junction
        `),m=$("i"),_=G(p),I=G(`
        : `),b=G(h),O=C(),T=$("button"),j=G("Generate cycling movements between all arms"),B=C();for(let F=0;F<V.length;F+=1)V[F].c();q=C(),fe&&fe.c(),J=Xe(),z(T,"class","secondary"),T.disabled=S=n[5].jats[n[0]].properties[n[1]].arms.length<2},m(F,Q){v(F,e,Q),v(F,l,Q),v(F,t,Q),v(F,r,Q);for(let ee=0;ee<A.length;ee+=1)A[ee]&&A[ee].m(F,Q);v(F,o,Q),de&&de.m(F,Q),v(F,i,Q),v(F,a,Q),v(F,s,Q),v(F,f,Q),g(f,c),g(f,d),g(f,u),g(f,m),g(m,_),g(f,I),g(f,b),v(F,O,Q),v(F,T,Q),g(T,j),v(F,B,Q);for(let ee=0;ee<V.length;ee+=1)V[ee]&&V[ee].m(F,Q);v(F,q,Q),fe&&fe.m(F,Q),v(F,J,Q),M=!0,P||(L=[Z(e,"click",n[16]),Z(T,"click",n[15])],P=!0)},p(F,Q){if(Q[0]&299){H=K(F[5].jats[F[0]].properties[F[1]].arms);let ee;for(ee=0;ee<H.length;ee+=1){const Ue=Vt(F,H,ee);A[ee]?(A[ee].p(Ue,Q),k(A[ee],1)):(A[ee]=Qt(Ue),A[ee].c(),k(A[ee],1),A[ee].m(o.parentNode,o))}for(ce(),ee=H.length;ee<A.length;ee+=1)ge(ee);ue()}if(F[5].jats[F[0]].properties[F[7]].arms.length>0?de?de.p(F,Q):(de=Yt(F),de.c(),de.m(i.parentNode,i)):de&&(de.d(1),de=null),(!M||Q[0]&2)&&oe(d,F[1]),(!M||Q[0]&33)&&p!==(p=F[5].jats[F[0]].properties.name+"")&&oe(_,p),(!M||Q[0]&35)&&h!==(h=Xt(F[5].jats[F[0]].properties[F[1]])+"")&&oe(b,h),(!M||Q[0]&35&&S!==(S=F[5].jats[F[0]].properties[F[1]].arms.length<2))&&(T.disabled=S),Q[0]&16683){R=K(F[5].jats[F[0]].properties[F[1]].movements);let ee;for(ee=0;ee<R.length;ee+=1){const Ue=Wt(F,R,ee);V[ee]?(V[ee].p(Ue,Q),k(V[ee],1)):(V[ee]=xt(Ue),V[ee].c(),k(V[ee],1),V[ee].m(q.parentNode,q))}for(ce(),ee=R.length;ee<V.length;ee+=1)je(ee);ue()}F[5].jats[F[0]].properties[F[7]].movements.length>0?fe?fe.p(F,Q):(fe=en(F),fe.c(),fe.m(J.parentNode,J)):fe&&(fe.d(1),fe=null)},i(F){if(!M){for(let Q=0;Q<H.length;Q+=1)k(A[Q]);for(let Q=0;Q<R.length;Q+=1)k(V[Q]);M=!0}},o(F){A=A.filter(Boolean);for(let Q=0;Q<A.length;Q+=1)y(A[Q]);V=V.filter(Boolean);for(let Q=0;Q<V.length;Q+=1)y(V[Q]);M=!1},d(F){F&&(w(e),w(l),w(t),w(r),w(o),w(i),w(a),w(s),w(f),w(O),w(T),w(B),w(q),w(J)),re(A,F),de&&de.d(F),re(V,F),fe&&fe.d(F),P=!1,_e(L)}}}function Qt(n){let e,l;function t(){return n[17](n[30])}function r(){return n[18](n[30])}return e=new qn({props:{name:`${tn(n[30])} - ${n[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",r),e.$on("mouseleave",n[19]),{c(){N(e.$$.fragment)},m(o,i){E(e,o,i),l=!0},p(o,i){n=o;const a={};i[0]&35&&(a.name=`${tn(n[30])} - ${n[31].name||"Unnamed arm"}`),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){D(e,o)}}}function Yt(n){let e,l,t;return{c(){e=$("button"),e.textContent=`Copy arms from ${n[7]}`,z(e,"class","secondary")},m(r,o){v(r,e,o),l||(t=Z(e,"click",n[12]),l=!0)},p:te,d(r){r&&w(e),l=!1,t()}}}function Zr(n){let e,l,t,r=n[27].score+"",o,i,a,s=nn(n[27].kind)+"",f;return{c(){e=$("div"),l=$("span"),t=G("Score: "),o=G(r),i=C(),a=$("span"),f=G(s),Y(l,"padding","4px"),Y(l,"color",n[28].font),Y(l,"background-color",n[28].background),Y(e,"width","100%"),Y(e,"display","flex"),Y(e,"justify-content","space-between")},m(c,d){v(c,e,d),g(e,l),g(l,t),g(l,o),g(e,i),g(e,a),g(a,f)},p(c,d){d[0]&35&&r!==(r=c[27].score+"")&&oe(o,r),d[0]&35&&Y(l,"color",c[28].font),d[0]&35&&Y(l,"background-color",c[28].background),d[0]&35&&s!==(s=nn(c[27].kind)+"")&&oe(f,s)},d(c){c&&w(e)}}}function xt(n){let e,l;function t(){return n[20](n[30])}function r(){return n[21](n[30])}return e=new qn({props:{name:n[27].name||"Unnamed movement",$$slots:{default:[Zr]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",r),e.$on("mouseleave",n[22]),{c(){N(e.$$.fragment)},m(o,i){E(e,o,i),l=!0},p(o,i){n=o;const a={};i[0]&35&&(a.name=n[27].name||"Unnamed movement"),i[0]&35|i[1]&4&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){D(e,o)}}}function en(n){let e,l,t;return{c(){e=$("button"),e.textContent=`Copy movements from ${n[7]}`,z(e,"class","secondary")},m(r,o){v(r,e,o),l||(t=Z(e,"click",n[13]),l=!0)},p:te,d(r){r&&w(e),l=!1,t()}}}function Kr(n){let e,l,t,r,o=n[5].jats[n[0]].properties.name+"",i,a,s,f,c;const d=[Ur,Gr,Hr],u=[];function m(p,_){return p[2].mode!="editing"?0:p[2].id.kind=="movement"?1:2}return s=m(n),f=u[s]=d[s](n),{c(){e=$("div"),l=$("h2"),t=G(n[1]),r=G(" JAT for "),i=G(o),a=C(),f.c(),z(e,"slot","sidebar")},m(p,_){v(p,e,_),g(e,l),g(l,t),g(l,r),g(l,i),g(e,a),u[s].m(e,null),n[25](e),c=!0},p(p,_){(!c||_[0]&2)&&oe(t,p[1]),(!c||_[0]&33)&&o!==(o=p[5].jats[p[0]].properties.name+"")&&oe(i,o);let I=s;s=m(p),s===I?u[s].p(p,_):(ce(),y(u[I],1,1,()=>{u[I]=null}),ue(),f=u[s],f?f.p(p,_):(f=u[s]=d[s](p),f.c()),k(f,1),f.m(e,null))},i(p){c||(k(f),c=!0)},o(p){y(f),c=!1},d(p){p&&w(e),u[s].d(),n[25](null)}}}function Xr(n){let e,l;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r[0]&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Wr(n){let e,l,t,r,o,i,a;return l=new De({props:{except:"jats"}}),r=new pe({props:{data:ne(n[5].jats),generateId:!0,$$slots:{default:[Xr]},$$scope:{ctx:n}}}),i=new zr({props:{junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],select:n[8],stopEditing:n[9]}}),{c(){e=$("div"),N(l.$$.fragment),t=C(),N(r.$$.fragment),o=C(),N(i.$$.fragment),z(e,"slot","map")},m(s,f){v(s,e,f),E(l,e,null),g(e,t),E(r,e,null),g(e,o),E(i,e,null),a=!0},p(s,f){const c={};f[0]&32&&(c.data=ne(s[5].jats)),f[0]&1|f[1]&4&&(c.$$scope={dirty:f,ctx:s}),r.$set(c);const d={};f[0]&1&&(d.junctionIdx=s[0]),f[0]&2&&(d.stage=s[1]),f[0]&4&&(d.mode=s[2]),f[0]&8&&(d.hoveringSidebar=s[3]),i.$set(d)},i(s){a||(k(l.$$.fragment,s),k(r.$$.fragment,s),k(i.$$.fragment,s),a=!0)},o(s){y(l.$$.fragment,s),y(r.$$.fragment,s),y(i.$$.fragment,s),a=!1},d(s){s&&w(e),D(l),D(r),D(i)}}}function Vr(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[Wr],sidebar:[Kr]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){E(e,o,i),l=!0,t||(r=Z(Jr,"keydown",n[11]),t=!0)},p(o,i){const a={};i[0]&127|i[1]&4&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){D(e,o),t=!1,r()}}}function tn(n){return String.fromCharCode(n+"A".charCodeAt(0))}function nn(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function Qr(n,e,l){let t,r;x(n,U,A=>l(5,t=A)),x(n,W,A=>l(6,r=A));let{junctionIdx:o}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s={mode:"select"},f=null,c=null,d;async function u(A){f=d.scrollTop,l(2,s={mode:"editing",id:A}),l(3,c=null),await Ne(),l(4,d.scrollTop=0,d)}async function m(){l(2,s={mode:"select"}),f!=null&&(await Ne(),l(4,d.scrollTop=f,d),f=null)}function p(){s.mode=="editing"&&window.confirm(`Delete this ${s.id.kind}?`)&&(s.id.kind=="movement"?(t.jats[o].properties[i].movements.splice(s.id.idx,1),U.set(t)):(t.jats[o].properties[i].arms.splice(s.id.idx,1),U.set(t)),m())}function _(A){if(s.mode!="editing")return;let ge=A.target.tagName,de=ge=="INPUT"||ge=="TEXTAREA";A.key=="Escape"||A.key=="Enter"&&!de?(A.stopPropagation(),m()):A.key=="Delete"&&!de&&(A.stopPropagation(),p())}function I(){t.jats[o].properties[i].arms.length>0&&!window.confirm("Overwrite arms?")||(X(U,t.jats[o].properties[i].arms=JSON.parse(JSON.stringify(t.jats[o].properties[a].arms)),t),U.set(t))}function h(){t.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite movements?")||(X(U,t.jats[o].properties[i].movements=JSON.parse(JSON.stringify(t.jats[o].properties[a].movements)),t),U.set(t))}let b={0:Te.red,1:Te.amber,2:Te.green,X:Te.critical};function O(){if(t.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let A=t.jats[o].properties[i].movements.filter(ge=>ge.kind=="walking & wheeling");X(U,t.jats[o].properties[i].movements=[...A,..._r(t.jats[o].properties[i].arms)],t)}const T=()=>X(W,r={kind:"edit-jat",idx:o},r),j=A=>u({kind:"arm",idx:A}),S=A=>l(3,c={kind:"arm",idx:A}),B=()=>l(3,c=null),q=A=>u({kind:"movement",idx:A}),J=A=>l(3,c={kind:"movement",idx:A}),M=()=>l(3,c=null),P=()=>l(2,s={mode:"select"});function L(){t.jats[o].properties[i].arms[s.id.idx].name=this.value,U.set(t)}function H(A){me[A?"unshift":"push"](()=>{d=A,l(4,d)})}return n.$$set=A=>{"junctionIdx"in A&&l(0,o=A.junctionIdx),"stage"in A&&l(1,i=A.stage)},[o,i,s,c,d,t,r,a,u,m,p,_,I,h,b,O,T,j,S,B,q,J,M,P,L,H]}class Yr extends ie{constructor(e){super(),se(this,e,Qr,Vr,ae,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:xr}=He;function eo(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p;return{c(){e=$("div"),l=$("button"),l.textContent="Done",t=C(),r=$("button"),r.textContent="Delete JAT",o=C(),i=$("label"),a=G(`Name:
      `),s=$("input"),f=C(),c=$("button"),c.textContent="Existing",d=C(),u=$("button"),u.textContent="Proposed",z(s,"type","text"),z(e,"slot","sidebar")},m(_,I){v(_,e,I),g(e,l),g(e,t),g(e,r),g(e,o),g(e,i),g(i,a),g(i,s),le(s,n[1].jats[n[0]].properties.name),g(e,f),g(e,c),g(e,d),g(e,u),m||(p=[Z(l,"click",n[6]),Z(r,"click",n[4]),Z(s,"input",n[7]),Z(c,"click",n[8]),Z(u,"click",n[9])],m=!0)},p(_,I){I&3&&s.value!==_[1].jats[_[0]].properties.name&&le(s,_[1].jats[_[0]].properties.name)},d(_){_&&w(e),m=!1,_e(p)}}}function to(n){let e,l;return e=new Ce({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.filter=["!=",["id"],t[0]]),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function no(n){let e,l,t,r,o,i,a,s;l=new De({props:{except:"jats"}}),r=new pe({props:{data:ne(n[1].jats),generateId:!0,$$slots:{default:[to]},$$scope:{ctx:n}}});function f(d){n[5](d)}let c={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].jats[n[0]].geometry.coordinates),i=new ct({props:c}),me.push(()=>ve(i,"lngLat",f)),{c(){e=$("div"),N(l.$$.fragment),t=C(),N(r.$$.fragment),o=C(),N(i.$$.fragment),z(e,"slot","map")},m(d,u){v(d,e,u),E(l,e,null),g(e,t),E(r,e,null),g(e,o),E(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].jats)),u&1025&&(m.$$scope={dirty:u,ctx:d}),r.$set(m);const p={};u&3&&(p.color=d[1].jats[d[0]].properties.color),!a&&u&3&&(a=!0,p.lngLat=d[1].jats[d[0]].geometry.coordinates,we(()=>a=!1)),i.$set(p)},i(d){s||(k(l.$$.fragment,d),k(r.$$.fragment,d),k(i.$$.fragment,d),s=!0)},o(d){y(l.$$.fragment,d),y(r.$$.fragment,d),y(i.$$.fragment,d),s=!1},d(d){d&&w(e),D(l),D(r),D(i)}}}function lo(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[no],sidebar:[eo]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){E(e,o,i),l=!0,t||(r=Z(xr,"keydown",n[3]),t=!0)},p(o,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){D(e,o),t=!1,r()}}}function ro(n,e,l){let t,r;x(n,U,m=>l(1,t=m)),x(n,W,m=>l(2,r=m));let{idx:o}=e;function i(m){m.key=="Escape"&&X(W,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this JAT?")&&(X(W,r={kind:"neutral"},r),await Ne(),t.jats.splice(o,1),U.set(t))}function s(m){n.$$.not_equal(t.jats[o].geometry.coordinates,m)&&(t.jats[o].geometry.coordinates=m,U.set(t))}const f=()=>X(W,r={kind:"neutral"},r);function c(){t.jats[o].properties.name=this.value,U.set(t)}const d=()=>X(W,r={kind:"edit-jat-detail",idx:o,stage:"existing"},r),u=()=>X(W,r={kind:"edit-jat-detail",idx:o,stage:"proposed"},r);return n.$$set=m=>{"idx"in m&&l(0,o=m.idx)},[o,t,r,i,a,s,f,c,d,u]}class oo extends ie{constructor(e){super(),se(this,e,ro,lo,ae,{idx:0})}}function ln(n,e,l){const t=n.slice();return t[3]=e[l],t[4]=e,t[5]=l,t}function io(n){let e,l;return{c(){e=$("span"),l=C(),z(e,"class","dot svelte-jgyhla")},m(t,r){v(t,e,r),v(t,l,r)},p:te,d(t){t&&(w(e),w(l))}}}function rn(n){let e,l,t;function r(i){n[2](i,n[3],n[4],n[5])}let o={draggable:!0,$$slots:{default:[io]},$$scope:{ctx:n}};return n[3]!==void 0&&(o.lngLat=n[3]),e=new Fe({props:o}),me.push(()=>ve(e,"lngLat",r)),{c(){N(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,a){n=i;const s={};a&64&&(s.$$scope={dirty:a,ctx:n}),!l&&a&1&&(l=!0,s.lngLat=n[3],we(()=>l=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function so(n){let e,l,t,r;e=new Dn({}),e.$on("click",n[1]);let o=K(n[0].geometry.coordinates),i=[];for(let s=0;s<o.length;s+=1)i[s]=rn(ln(n,o,s));const a=s=>y(i[s],1,1,()=>{i[s]=null});return{c(){N(e.$$.fragment),l=C();for(let s=0;s<i.length;s+=1)i[s].c();t=Xe()},m(s,f){E(e,s,f),v(s,l,f);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(s,f);v(s,t,f),r=!0},p(s,[f]){if(f&1){o=K(s[0].geometry.coordinates);let c;for(c=0;c<o.length;c+=1){const d=ln(s,o,c);i[c]?(i[c].p(d,f),k(i[c],1)):(i[c]=rn(d),i[c].c(),k(i[c],1),i[c].m(t.parentNode,t))}for(ce(),c=o.length;c<i.length;c+=1)a(c);ue()}},i(s){if(!r){k(e.$$.fragment,s);for(let f=0;f<o.length;f+=1)k(i[f]);r=!0}},o(s){y(e.$$.fragment,s),i=i.filter(Boolean);for(let f=0;f<i.length;f+=1)y(i[f]);r=!1},d(s){s&&(w(l),w(t)),D(e,s),re(i,s)}}}function ao(n,e,l){let{f:t}=e;function r(i){t.geometry.coordinates.push(i.detail.lngLat.toArray()),l(0,t)}function o(i,a,s,f){s[f]=i,l(0,t)}return n.$$set=i=>{"f"in i&&l(0,t=i.f)},[t,r,o]}class On extends ie{constructor(e){super(),se(this,e,ao,so,ae,{f:0})}}function co(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Se[n%Se.length],answers:Array(be.length).fill("")}}}let be=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:he()},{name:"SA04",description:"trip hazards",choices:he()},{name:"SA05",description:"kerbside activity",choices:he()},{name:"SA08",description:"motor traffic speed",choices:he()},{name:"SA09",description:"motor traffic volume",choices:he()},{name:"SA11",description:"footway widths",choices:he()},{name:"SA12",description:"effective width next to tram lines",choices:he()},{name:"SA13",description:"crossing angle of tram/train rails",choices:he()},{name:"SA14",description:"cycling surface and maintenance defects",choices:he()},{name:"SA15",description:"WW surface and maintenance defects",choices:he()},{name:"SA16",description:"guard railing",choices:he()}];const{window:uo}=He;function on(n,e,l){const t=n.slice();return t[10]=e[l],t[11]=e,t[12]=l,t}function fo(n,e,l){const t=n.slice();return t[13]=e[l],t}function sn(n){let e;return{c(){e=$("p"),e.textContent="A link needs at least two points"},m(l,t){v(l,e,t)},d(l){l&&w(e)}}}function mo(n){let e;return{c(){e=$("option"),e.textContent=`${n[13]}`,e.__value=n[13],le(e,e.__value)},m(l,t){v(l,e,t)},p:te,d(l){l&&w(e)}}}function an(n){let e,l=n[10].name+"",t,r,o=n[10].description+"",i,a,s,f,c,d,u=K(n[10].choices),m=[];for(let _=0;_<u.length;_+=1)m[_]=mo(fo(n,u,_));function p(){n[9].call(s,n[12])}return{c(){e=$("label"),t=G(l),r=G(": "),i=G(o),a=C(),s=$("select");for(let _=0;_<m.length;_+=1)m[_].c();f=C(),n[1].links[n[0]].properties.answers[n[12]]===void 0&&We(p)},m(_,I){v(_,e,I),g(e,t),g(e,r),g(e,i),g(e,a),g(e,s);for(let h=0;h<m.length;h+=1)m[h]&&m[h].m(s,null);Le(s,n[1].links[n[0]].properties.answers[n[12]],!0),g(e,f),c||(d=Z(s,"change",p),c=!0)},p(_,I){n=_,I&3&&Le(s,n[1].links[n[0]].properties.answers[n[12]])},d(_){_&&w(e),re(m,_),c=!1,d()}}}function po(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p,_=!n[2]&&sn(),I=K(be),h=[];for(let b=0;b<I.length;b+=1)h[b]=an(on(n,I,b));return{c(){e=$("div"),l=$("button"),t=G("Done"),o=C(),i=$("button"),i.textContent="Delete link",a=C(),_&&_.c(),s=C(),f=$("label"),c=G(`Name:
      `),d=$("input"),u=C();for(let b=0;b<h.length;b+=1)h[b].c();l.disabled=r=!n[2],z(d,"type","text"),z(e,"slot","sidebar")},m(b,O){v(b,e,O),g(e,l),g(l,t),g(e,o),g(e,i),g(e,a),_&&_.m(e,null),g(e,s),g(e,f),g(f,c),g(f,d),le(d,n[1].links[n[0]].properties.name),g(e,u);for(let T=0;T<h.length;T+=1)h[T]&&h[T].m(e,null);m||(p=[Z(l,"click",n[7]),Z(i,"click",n[5]),Z(d,"input",n[8])],m=!0)},p(b,O){if(O&4&&r!==(r=!b[2])&&(l.disabled=r),b[2]?_&&(_.d(1),_=null):_||(_=sn(),_.c(),_.m(e,s)),O&3&&d.value!==b[1].links[b[0]].properties.name&&le(d,b[1].links[b[0]].properties.name),O&3){I=K(be);let T;for(T=0;T<I.length;T+=1){const j=on(b,I,T);h[T]?h[T].p(j,O):(h[T]=an(j),h[T].c(),h[T].m(e,null))}for(;T<h.length;T+=1)h[T].d(1);h.length=I.length}},d(b){b&&w(e),_&&_.d(),re(h,b),m=!1,_e(p)}}}function go(n){let e,l;return e=new Ae({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function _o(n){let e,l,t,r,o,i,a,s;l=new De({props:{except:"links"}}),r=new pe({props:{data:ne(n[1].links),generateId:!0,$$slots:{default:[go]},$$scope:{ctx:n}}});function f(d){n[6](d)}let c={};return n[1].links[n[0]]!==void 0&&(c.f=n[1].links[n[0]]),i=new On({props:c}),me.push(()=>ve(i,"f",f)),{c(){e=$("div"),N(l.$$.fragment),t=C(),N(r.$$.fragment),o=C(),N(i.$$.fragment),z(e,"slot","map")},m(d,u){v(d,e,u),E(l,e,null),g(e,t),E(r,e,null),g(e,o),E(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].links)),u&65537&&(m.$$scope={dirty:u,ctx:d}),r.$set(m);const p={};!a&&u&3&&(a=!0,p.f=d[1].links[d[0]],we(()=>a=!1)),i.$set(p)},i(d){s||(k(l.$$.fragment,d),k(r.$$.fragment,d),k(i.$$.fragment,d),s=!0)},o(d){y(l.$$.fragment,d),y(r.$$.fragment,d),y(i.$$.fragment,d),s=!1},d(d){d&&w(e),D(l),D(r),D(i)}}}function ho(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[_o],sidebar:[po]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){E(e,o,i),l=!0,t||(r=Z(uo,"keydown",n[4]),t=!0)},p(o,[i]){const a={};i&65551&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){D(e,o),t=!1,r()}}}function $o(n,e,l){let t,r,o;x(n,U,m=>l(1,r=m)),x(n,W,m=>l(3,o=m));let{idx:i}=e;function a(m){m.key=="Escape"&&t&&X(W,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this link?")&&(X(W,o={kind:"neutral"},o),await Ne(),r.links.splice(i,1),U.set(r))}function f(m){n.$$.not_equal(r.links[i],m)&&(r.links[i]=m,U.set(r))}const c=()=>X(W,o={kind:"neutral"},o);function d(){r.links[i].properties.name=this.value,U.set(r)}function u(m){r.links[i].properties.answers[m]=Ve(this),U.set(r)}return n.$$set=m=>{"idx"in m&&l(0,i=m.idx)},n.$$.update=()=>{n.$$.dirty&3&&l(2,t=r.links[i].geometry.coordinates.length>=2)},[i,r,t,o,a,s,f,c,d,u]}class ko extends ie{constructor(e){super(),se(this,e,$o,ho,ae,{idx:0})}}function cn(n,e,l){const t=n.slice();return t[6]=e[l],t[7]=e,t[8]=l,t}function un(n,e,l){const t=n.slice();return t[9]=e[l],t}function fn(n){let e,l=n[9]+"",t,r;return{c(){e=$("option"),t=G(l),e.__value=r=n[9],le(e,e.__value)},m(o,i){v(o,e,i),g(e,t)},p(o,i){i&1&&l!==(l=o[9]+"")&&oe(t,l),i&1&&r!==(r=o[9])&&(e.__value=r,le(e,e.__value))},d(o){o&&w(e)}}}function dn(n){let e,l,t=n[6].properties.name+"",r,o,i,a,s,f,c=K(be[n[0]].choices),d=[];for(let m=0;m<c.length;m+=1)d[m]=fn(un(n,c,m));function u(){n[5].call(i,n[7],n[8])}return{c(){e=$("li"),l=$("span"),r=G(t),o=C(),i=$("select");for(let m=0;m<d.length;m+=1)d[m].c();a=C(),Y(l,"color",n[6].properties.color),n[6].properties.answers[n[0]]===void 0&&We(u)},m(m,p){v(m,e,p),g(e,l),g(l,r),g(e,o),g(e,i);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(i,null);Le(i,n[6].properties.answers[n[0]],!0),g(e,a),s||(f=Z(i,"change",u),s=!0)},p(m,p){if(n=m,p&4&&t!==(t=n[6].properties.name+"")&&oe(r,t),p&4&&Y(l,"color",n[6].properties.color),p&1){c=K(be[n[0]].choices);let _;for(_=0;_<c.length;_+=1){const I=un(n,c,_);d[_]?d[_].p(I,p):(d[_]=fn(I),d[_].c(),d[_].m(i,null))}for(;_<d.length;_+=1)d[_].d(1);d.length=c.length}p&5&&Le(i,n[6].properties.answers[n[0]])},d(m){m&&w(e),re(d,m),s=!1,f()}}}function bo(n){let e,l,t,r,o=be[n[0]].name+"",i,a,s=be[n[0]].description+"",f,c,d,u,m,p=K(n[2].links),_=[];for(let I=0;I<p.length;I+=1)_[I]=dn(cn(n,p,I));return{c(){e=$("div"),l=$("button"),l.textContent="Done",t=C(),r=$("h2"),i=G(o),a=G(": "),f=G(s),c=C(),d=$("ol");for(let I=0;I<_.length;I+=1)_[I].c();z(e,"slot","sidebar")},m(I,h){v(I,e,h),g(e,l),g(e,t),g(e,r),g(r,i),g(r,a),g(r,f),g(e,c),g(e,d);for(let b=0;b<_.length;b+=1)_[b]&&_[b].m(d,null);u||(m=Z(l,"click",n[4]),u=!0)},p(I,h){if(h&1&&o!==(o=be[I[0]].name+"")&&oe(i,o),h&1&&s!==(s=be[I[0]].description+"")&&oe(f,s),h&5){p=K(I[2].links);let b;for(b=0;b<p.length;b+=1){const O=cn(I,p,b);_[b]?_[b].p(O,h):(_[b]=dn(O),_[b].c(),_[b].m(d,null))}for(;b<_.length;b+=1)_[b].d(1);_.length=p.length}},d(I){I&&w(e),re(_,I),u=!1,m()}}}function vo(n){let e,l,t;return l=new De({props:{showLinkColor:!0,except:""}}),{c(){e=$("div"),N(l.$$.fragment),z(e,"slot","map")},m(r,o){v(r,e,o),E(l,e,null),t=!0},p:te,i(r){t||(k(l.$$.fragment,r),t=!0)},o(r){y(l.$$.fragment,r),t=!1},d(r){r&&w(e),D(l)}}}function wo(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[vo],sidebar:[bo]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){E(e,o,i),l=!0,t||(r=Z(window,"keydown",n[3]),t=!0)},p(o,[i]){const a={};i&4103&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){D(e,o),t=!1,r()}}}function yo(n,e,l){let t,r;x(n,W,f=>l(1,t=f)),x(n,U,f=>l(2,r=f));let{qIdx:o}=e;function i(f){f.key=="Escape"&&X(W,t={kind:"neutral"},t)}const a=()=>X(W,t={kind:"neutral"},t);function s(f,c){f[c].properties.answers[o]=Ve(this),U.set(r),l(0,o)}return n.$$set=f=>{"qIdx"in f&&l(0,o=f.qIdx)},[o,t,r,i,a,s]}class jo extends ie{constructor(e){super(),se(this,e,yo,wo,ae,{qIdx:0})}}function Co(n){let e,l,t,r;const o=n[2].default,i=Oe(o,n,n[1],null);return{c(){e=$("a"),i&&i.c(),z(e,"href","#"),Y(e,"color",n[0])},m(a,s){v(a,e,s),i&&i.m(e,null),l=!0,t||(r=Z(e,"click",Wn(n[3])),t=!0)},p(a,[s]){i&&i.p&&(!l||s&2)&&Be(i,o,a,a[1],l?ze(o,a[1],s,null):Re(a[1]),null),s&1&&Y(e,"color",a[0])},i(a){l||(k(i,a),l=!0)},o(a){y(i,a),l=!1},d(a){a&&w(e),i&&i.d(a),t=!1,r()}}}function Lo(n,e,l){let{$$slots:t={},$$scope:r}=e,{color:o=void 0}=e;function i(a){ye.call(this,n,a)}return n.$$set=a=>{"color"in a&&l(0,o=a.color),"$$scope"in a&&l(1,r=a.$$scope)},[o,r,t,i]}class Ge extends ie{constructor(e){super(),se(this,e,Lo,Co,ae,{color:0})}}function So(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Se[n%Se.length],st20:""}}}function mn(n,e,l){const t=n.slice();return t[5]=e[l],t[7]=l,t}function Ao(n){let e=n[5].properties.name+"",l;return{c(){l=G(e)},m(t,r){v(t,l,r)},p(t,r){r&1&&e!==(e=t[5].properties.name+"")&&oe(l,e)},d(t){t&&w(l)}}}function pn(n){let e,l,t,r;function o(){return n[3](n[7])}return l=new Ge({props:{color:n[5].properties.color,$$slots:{default:[Ao]},$$scope:{ctx:n}}}),l.$on("click",o),{c(){e=$("li"),N(l.$$.fragment),t=C()},m(i,a){v(i,e,a),E(l,e,null),g(e,t),r=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&w(e),D(l)}}}function To(n){let e,l,t,r,o,i,a,s,f=K(n[0].bus_stops),c=[];for(let u=0;u<f.length;u+=1)c[u]=pn(mn(n,f,u));const d=u=>y(c[u],1,1,()=>{c[u]=null});return{c(){e=G(`Bus stops:

`),l=$("div"),t=$("button"),t.textContent="New bus stop",r=C(),o=$("ol");for(let u=0;u<c.length;u+=1)c[u].c()},m(u,m){v(u,e,m),v(u,l,m),g(l,t),v(u,r,m),v(u,o,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(o,null);i=!0,a||(s=Z(t,"click",n[2]),a=!0)},p(u,[m]){if(m&3){f=K(u[0].bus_stops);let p;for(p=0;p<f.length;p+=1){const _=mn(u,f,p);c[p]?(c[p].p(_,m),k(c[p],1)):(c[p]=pn(_),c[p].c(),k(c[p],1),c[p].m(o,null))}for(ce(),p=f.length;p<c.length;p+=1)d(p);ue()}},i(u){if(!i){for(let m=0;m<f.length;m+=1)k(c[m]);i=!0}},o(u){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)y(c[m]);i=!1},d(u){u&&(w(e),w(l),w(r),w(o)),re(c,u),a=!1,s()}}}function Mo(n,e,l){let t,r,o;x(n,U,s=>l(0,t=s)),x(n,W,s=>l(1,r=s)),x(n,Je,s=>l(4,o=s));function i(){if(!o)return;let s=So(t.bus_stops.length,o.getCenter().toArray());X(U,t.bus_stops=[...t.bus_stops,s],t),X(W,r={kind:"edit-bus-stop",idx:t.bus_stops.length-1},r)}return[t,r,i,s=>X(W,r={kind:"edit-bus-stop",idx:s},r)]}let Io=class extends ie{constructor(e){super(),se(this,e,Mo,To,ae,{})}};function No(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:Se[n%Se.length],sa10:""}}}function gn(n,e,l){const t=n.slice();return t[5]=e[l],t[7]=l,t}function Eo(n){let e=n[5].properties.name+"",l;return{c(){l=G(e)},m(t,r){v(t,l,r)},p(t,r){r&1&&e!==(e=t[5].properties.name+"")&&oe(l,e)},d(t){t&&w(l)}}}function _n(n){let e,l,t,r;function o(){return n[3](n[7])}return l=new Ge({props:{color:n[5].properties.color,$$slots:{default:[Eo]},$$scope:{ctx:n}}}),l.$on("click",o),{c(){e=$("li"),N(l.$$.fragment),t=C()},m(i,a){v(i,e,a),E(l,e,null),g(e,t),r=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&w(e),D(l)}}}function Do(n){let e,l,t,r,o,i,a,s,f=K(n[0].crossings),c=[];for(let u=0;u<f.length;u+=1)c[u]=_n(gn(n,f,u));const d=u=>y(c[u],1,1,()=>{c[u]=null});return{c(){e=G(`Crossings:

`),l=$("div"),t=$("button"),t.textContent="New crossing",r=C(),o=$("ol");for(let u=0;u<c.length;u+=1)c[u].c()},m(u,m){v(u,e,m),v(u,l,m),g(l,t),v(u,r,m),v(u,o,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(o,null);i=!0,a||(s=Z(t,"click",n[2]),a=!0)},p(u,[m]){if(m&3){f=K(u[0].crossings);let p;for(p=0;p<f.length;p+=1){const _=gn(u,f,p);c[p]?(c[p].p(_,m),k(c[p],1)):(c[p]=_n(_),c[p].c(),k(c[p],1),c[p].m(o,null))}for(ce(),p=f.length;p<c.length;p+=1)d(p);ue()}},i(u){if(!i){for(let m=0;m<f.length;m+=1)k(c[m]);i=!0}},o(u){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)y(c[m]);i=!1},d(u){u&&(w(e),w(l),w(r),w(o)),re(c,u),a=!1,s()}}}function qo(n,e,l){let t,r,o;x(n,U,s=>l(0,t=s)),x(n,W,s=>l(1,r=s)),x(n,Je,s=>l(4,o=s));function i(){if(!o)return;let s=No(t.crossings.length,o.getCenter().toArray());X(U,t.crossings=[...t.crossings,s],t),X(W,r={kind:"edit-crossing",idx:t.crossings.length-1},r)}return[t,r,i,s=>X(W,r={kind:"edit-crossing",idx:s},r)]}let Po=class extends ie{constructor(e){super(),se(this,e,qo,Do,ae,{})}};function Fo(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Se[n%Se.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function hn(n,e,l){const t=n.slice();return t[5]=e[l],t[7]=l,t}function Oo(n){let e=n[5].properties.name+"",l;return{c(){l=G(e)},m(t,r){v(t,l,r)},p(t,r){r&1&&e!==(e=t[5].properties.name+"")&&oe(l,e)},d(t){t&&w(l)}}}function $n(n){let e,l,t,r;function o(){return n[3](n[7])}return l=new Ge({props:{color:n[5].properties.color,$$slots:{default:[Oo]},$$scope:{ctx:n}}}),l.$on("click",o),{c(){e=$("li"),N(l.$$.fragment),t=C()},m(i,a){v(i,e,a),E(l,e,null),g(e,t),r=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&w(e),D(l)}}}function Bo(n){let e,l,t,r,o,i,a,s,f=K(n[0].jats),c=[];for(let u=0;u<f.length;u+=1)c[u]=$n(hn(n,f,u));const d=u=>y(c[u],1,1,()=>{c[u]=null});return{c(){e=G(`JATs:

`),l=$("div"),t=$("button"),t.textContent="New JAT",r=C(),o=$("ol");for(let u=0;u<c.length;u+=1)c[u].c()},m(u,m){v(u,e,m),v(u,l,m),g(l,t),v(u,r,m),v(u,o,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(o,null);i=!0,a||(s=Z(t,"click",n[2]),a=!0)},p(u,[m]){if(m&3){f=K(u[0].jats);let p;for(p=0;p<f.length;p+=1){const _=hn(u,f,p);c[p]?(c[p].p(_,m),k(c[p],1)):(c[p]=$n(_),c[p].c(),k(c[p],1),c[p].m(o,null))}for(ce(),p=f.length;p<c.length;p+=1)d(p);ue()}},i(u){if(!i){for(let m=0;m<f.length;m+=1)k(c[m]);i=!0}},o(u){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)y(c[m]);i=!1},d(u){u&&(w(e),w(l),w(r),w(o)),re(c,u),a=!1,s()}}}function Ro(n,e,l){let t,r,o;x(n,U,s=>l(0,t=s)),x(n,W,s=>l(1,r=s)),x(n,Je,s=>l(4,o=s));function i(){if(!o)return;let s=Fo(t.jats.length,o.getCenter().toArray());X(U,t.jats=[...t.jats,s],t),X(W,r={kind:"edit-jat",idx:t.jats.length-1},r)}return[t,r,i,s=>X(W,r={kind:"edit-jat",idx:s},r)]}let zo=class extends ie{constructor(e){super(),se(this,e,Ro,Bo,ae,{})}};function kn(n,e,l){const t=n.slice();return t[2]=e[l],t[4]=l,t}function bn(n,e,l){const t=n.slice();t[5]=e[l];const r=t[5].properties.answers[t[4]];return t[6]=r,t}function vn(n,e,l){const t=n.slice();return t[5]=e[l],t}function wn(n){let e,l=n[5].properties.name+"",t;return{c(){e=$("th"),t=G(l),Y(e,"color",n[5].properties.color)},m(r,o){v(r,e,o),g(e,t)},p(r,o){o&1&&l!==(l=r[5].properties.name+"")&&oe(t,l),o&1&&Y(e,"color",r[5].properties.color)},d(r){r&&w(e)}}}function yn(n){let e,l=n[6]+"",t;return{c(){e=$("td"),t=G(l),Y(e,"background",n[6]==""?"red":"green")},m(r,o){v(r,e,o),g(e,t)},p(r,o){o&1&&l!==(l=r[6]+"")&&oe(t,l),o&1&&Y(e,"background",r[6]==""?"red":"green")},d(r){r&&w(e)}}}function jn(n){let e,l,t,r,o=K(n[0].links),i=[];for(let a=0;a<o.length;a+=1)i[a]=yn(bn(n,o,a));return{c(){e=$("tr"),l=$("th"),l.textContent=`${n[2].name}`,t=C();for(let a=0;a<i.length;a+=1)i[a].c();r=C()},m(a,s){v(a,e,s),g(e,l),g(e,t);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(e,null);g(e,r)},p(a,s){if(s&1){o=K(a[0].links);let f;for(f=0;f<o.length;f+=1){const c=bn(a,o,f);i[f]?i[f].p(c,s):(i[f]=yn(c),i[f].c(),i[f].m(e,r))}for(;f<i.length;f+=1)i[f].d(1);i.length=o.length}},d(a){a&&w(e),re(i,a)}}}function Jo(n){let e,l,t,r,o,i,a,s=K(n[0].links),f=[];for(let u=0;u<s.length;u+=1)f[u]=wn(vn(n,s,u));let c=K(be),d=[];for(let u=0;u<c.length;u+=1)d[u]=jn(kn(n,c,u));return{c(){e=$("table"),l=$("thead"),t=$("tr"),r=$("th"),o=C();for(let u=0;u<f.length;u+=1)f[u].c();i=C(),a=$("tbody");for(let u=0;u<d.length;u+=1)d[u].c()},m(u,m){v(u,e,m),g(e,l),g(l,t),g(t,r),g(t,o);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(t,null);g(e,i),g(e,a);for(let p=0;p<d.length;p+=1)d[p]&&d[p].m(a,null)},p(u,m){if(m&1){s=K(u[0].links);let p;for(p=0;p<s.length;p+=1){const _=vn(u,s,p);f[p]?f[p].p(_,m):(f[p]=wn(_),f[p].c(),f[p].m(t,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=s.length}if(m&1){c=K(be);let p;for(p=0;p<c.length;p+=1){const _=kn(u,c,p);d[p]?d[p].p(_,m):(d[p]=jn(_),d[p].c(),d[p].m(a,null))}for(;p<d.length;p+=1)d[p].d(1);d.length=c.length}},d(u){u&&w(e),re(f,u),re(d,u)}}}function Ho(n){let e,l;return e=new Pn({props:{$$slots:{default:[Jo]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,[r]){const o={};r&2049&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Go(n,e,l){let t;x(n,U,o=>l(0,t=o));function r(o){ye.call(this,n,o)}return[t,r]}class Uo extends ie{constructor(e){super(),se(this,e,Go,Ho,ae,{})}}function Cn(n,e,l){const t=n.slice();return t[9]=e[l],t[11]=l,t}function Ln(n,e,l){const t=n.slice();return t[12]=e[l],t[11]=l,t}function Sn(n){let e,l;return e=new Uo({}),e.$on("close",n[4]),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Zo(n){let e=n[12].properties.name+"",l;return{c(){l=G(e)},m(t,r){v(t,l,r)},p(t,r){r&2&&e!==(e=t[12].properties.name+"")&&oe(l,e)},d(t){t&&w(l)}}}function An(n){let e,l,t,r;function o(){return n[6](n[11])}return l=new Ge({props:{color:n[12].properties.color,$$slots:{default:[Zo]},$$scope:{ctx:n}}}),l.$on("click",o),{c(){e=$("li"),N(l.$$.fragment),t=C()},m(i,a){v(i,e,a),E(l,e,null),g(e,t),r=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[12].properties.color),a&16386&&(s.$$scope={dirty:a,ctx:n}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&w(e),D(l)}}}function Ko(n){let e=n[9].name+"",l,t;return{c(){l=G(e),t=C()},m(r,o){v(r,l,o),v(r,t,o)},p:te,d(r){r&&(w(l),w(t))}}}function Tn(n){let e,l,t,r,o,i,a,s;function f(){return n[7](n[11])}l=new Ge({props:{$$slots:{default:[Ko]},$$scope:{ctx:n}}}),l.$on("click",f);function c(...d){return n[8](n[11],...d)}return{c(){e=$("li"),N(l.$$.fragment),t=G(`:
      `),r=$("progress"),a=C(),r.value=o=n[1].links.filter(c).length,z(r,"max",i=n[1].links.length),z(r,"class","svelte-zadug4")},m(d,u){v(d,e,u),E(l,e,null),g(e,t),g(e,r),g(e,a),s=!0},p(d,u){n=d;const m={};u&16384&&(m.$$scope={dirty:u,ctx:n}),l.$set(m),(!s||u&2&&o!==(o=n[1].links.filter(c).length))&&(r.value=o),(!s||u&2&&i!==(i=n[1].links.length))&&z(r,"max",i)},i(d){s||(k(l.$$.fragment,d),s=!0)},o(d){y(l.$$.fragment,d),s=!1},d(d){d&&w(e),D(l)}}}function Xo(n){let e,l,t,r,o,i,a,s,f,c,d,u,m=n[0]&&Sn(n),p=K(n[1].links),_=[];for(let T=0;T<p.length;T+=1)_[T]=An(Ln(n,p,T));const I=T=>y(_[T],1,1,()=>{_[T]=null});let h=K(be),b=[];for(let T=0;T<h.length;T+=1)b[T]=Tn(Cn(n,h,T));const O=T=>y(b[T],1,1,()=>{b[T]=null});return{c(){m&&m.c(),e=C(),l=$("div"),t=$("button"),t.textContent="New link",r=C(),o=$("button"),o.textContent="Table of questions",i=G(`

Links:
`),a=$("ol");for(let T=0;T<_.length;T+=1)_[T].c();s=G(`

Questions:
`),f=$("ol");for(let T=0;T<b.length;T+=1)b[T].c()},m(T,j){m&&m.m(T,j),v(T,e,j),v(T,l,j),g(l,t),g(l,r),g(l,o),v(T,i,j),v(T,a,j);for(let S=0;S<_.length;S+=1)_[S]&&_[S].m(a,null);v(T,s,j),v(T,f,j);for(let S=0;S<b.length;S+=1)b[S]&&b[S].m(f,null);c=!0,d||(u=[Z(t,"click",n[3]),Z(o,"click",n[5])],d=!0)},p(T,[j]){if(T[0]?m?(m.p(T,j),j&1&&k(m,1)):(m=Sn(T),m.c(),k(m,1),m.m(e.parentNode,e)):m&&(ce(),y(m,1,1,()=>{m=null}),ue()),j&6){p=K(T[1].links);let S;for(S=0;S<p.length;S+=1){const B=Ln(T,p,S);_[S]?(_[S].p(B,j),k(_[S],1)):(_[S]=An(B),_[S].c(),k(_[S],1),_[S].m(a,null))}for(ce(),S=p.length;S<_.length;S+=1)I(S);ue()}if(j&6){h=K(be);let S;for(S=0;S<h.length;S+=1){const B=Cn(T,h,S);b[S]?(b[S].p(B,j),k(b[S],1)):(b[S]=Tn(B),b[S].c(),k(b[S],1),b[S].m(f,null))}for(ce(),S=h.length;S<b.length;S+=1)O(S);ue()}},i(T){if(!c){k(m);for(let j=0;j<p.length;j+=1)k(_[j]);for(let j=0;j<h.length;j+=1)k(b[j]);c=!0}},o(T){y(m),_=_.filter(Boolean);for(let j=0;j<_.length;j+=1)y(_[j]);b=b.filter(Boolean);for(let j=0;j<b.length;j+=1)y(b[j]);c=!1},d(T){T&&(w(e),w(l),w(i),w(a),w(s),w(f)),m&&m.d(T),re(_,T),re(b,T),d=!1,_e(u)}}}function Wo(n,e,l){let t,r;x(n,U,u=>l(1,t=u)),x(n,W,u=>l(2,r=u));let o=!1;function i(){let u=co(t.links.length);X(U,t.links=[...t.links,u],t),X(W,r={kind:"edit-link",idx:t.links.length-1},r)}return[o,t,r,i,()=>l(0,o=!1),()=>l(0,o=!0),u=>X(W,r={kind:"edit-link",idx:u},r),u=>X(W,r={kind:"edit-question",idx:u},r),(u,m)=>m.properties.answers[u]!=""]}let Vo=class extends ie{constructor(e){super(),se(this,e,Wo,Xo,ae,{})}};function Qo(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled side road",color:Se[n%Se.length],sa01:""}}}function Mn(n,e,l){const t=n.slice();return t[4]=e[l],t[6]=l,t}function Yo(n){let e=n[4].properties.name+"",l;return{c(){l=G(e)},m(t,r){v(t,l,r)},p(t,r){r&1&&e!==(e=t[4].properties.name+"")&&oe(l,e)},d(t){t&&w(l)}}}function In(n){let e,l,t,r;function o(){return n[3](n[6])}return l=new Ge({props:{color:n[4].properties.color,$$slots:{default:[Yo]},$$scope:{ctx:n}}}),l.$on("click",o),{c(){e=$("li"),N(l.$$.fragment),t=C()},m(i,a){v(i,e,a),E(l,e,null),g(e,t),r=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[4].properties.color),a&129&&(s.$$scope={dirty:a,ctx:n}),l.$set(s)},i(i){r||(k(l.$$.fragment,i),r=!0)},o(i){y(l.$$.fragment,i),r=!1},d(i){i&&w(e),D(l)}}}function xo(n){let e,l,t,r,o,i,a,s,f=K(n[0].side_roads),c=[];for(let u=0;u<f.length;u+=1)c[u]=In(Mn(n,f,u));const d=u=>y(c[u],1,1,()=>{c[u]=null});return{c(){e=G(`Side roads:

`),l=$("div"),t=$("button"),t.textContent="New side road",r=C(),o=$("ol");for(let u=0;u<c.length;u+=1)c[u].c()},m(u,m){v(u,e,m),v(u,l,m),g(l,t),v(u,r,m),v(u,o,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(o,null);i=!0,a||(s=Z(t,"click",n[2]),a=!0)},p(u,[m]){if(m&3){f=K(u[0].side_roads);let p;for(p=0;p<f.length;p+=1){const _=Mn(u,f,p);c[p]?(c[p].p(_,m),k(c[p],1)):(c[p]=In(_),c[p].c(),k(c[p],1),c[p].m(o,null))}for(ce(),p=f.length;p<c.length;p+=1)d(p);ue()}},i(u){if(!i){for(let m=0;m<f.length;m+=1)k(c[m]);i=!0}},o(u){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)y(c[m]);i=!1},d(u){u&&(w(e),w(l),w(r),w(o)),re(c,u),a=!1,s()}}}function ei(n,e,l){let t,r;x(n,U,a=>l(0,t=a)),x(n,W,a=>l(1,r=a));function o(){let a=Qo(t.side_roads.length);X(U,t.side_roads=[...t.side_roads,a],t),X(W,r={kind:"edit-side-road",idx:t.side_roads.length-1},r)}return[t,r,o,a=>X(W,r={kind:"edit-side-road",idx:a},r)]}class ti extends ie{constructor(e){super(),se(this,e,ei,xo,ae,{})}}function ni(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p,_,I,h,b,O,T,j,S,B,q,J,M,P,L;return f=new Vo({}),m=new zo({}),h=new Io({}),j=new Po({}),J=new ti({}),{c(){e=$("div"),l=$("div"),t=$("button"),t.textContent="Download",r=C(),o=$("button"),o.textContent="Clear",i=C(),a=$("hr"),s=C(),N(f.$$.fragment),c=C(),d=$("hr"),u=C(),N(m.$$.fragment),p=C(),_=$("hr"),I=C(),N(h.$$.fragment),b=C(),O=$("hr"),T=C(),N(j.$$.fragment),S=C(),B=$("hr"),q=C(),N(J.$$.fragment),z(t,"class","secondary"),z(o,"class","secondary"),z(e,"slot","sidebar")},m(H,A){v(H,e,A),g(e,l),g(l,t),g(l,r),g(l,o),g(e,i),g(e,a),g(e,s),E(f,e,null),g(e,c),g(e,d),g(e,u),E(m,e,null),g(e,p),g(e,_),g(e,I),E(h,e,null),g(e,b),g(e,O),g(e,T),E(j,e,null),g(e,S),g(e,B),g(e,q),E(J,e,null),M=!0,P||(L=[Z(t,"click",n[8]),Z(o,"click",n[2])],P=!0)},p:te,i(H){M||(k(f.$$.fragment,H),k(m.$$.fragment,H),k(h.$$.fragment,H),k(j.$$.fragment,H),k(J.$$.fragment,H),M=!0)},o(H){y(f.$$.fragment,H),y(m.$$.fragment,H),y(h.$$.fragment,H),y(j.$$.fragment,H),y(J.$$.fragment,H),M=!1},d(H){H&&w(e),D(f),D(m),D(h),D(j),D(J),P=!1,_e(L)}}}function li(n){let e,l;return e=new Ae({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":Ee(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[3]),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function ri(n){let e,l;return e=new Ce({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":Ee(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[4]),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function oi(n){let e,l;return e=new Ce({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":Ee(10,15)},hoverCursor:"pointer"}}),e.$on("click",n[5]),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function ii(n){let e,l;return e=new Ce({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":Ee(10,15)},hoverCursor:"pointer"}}),e.$on("click",n[6]),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function si(n){let e,l;return e=new Ae({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":Ee(3,6)},hoverCursor:"pointer"}}),e.$on("click",n[7]),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function ai(n){let e,l,t,r,o,i,a,s,f,c,d;return l=new pe({props:{data:ne(n[0].links),generateId:!0,$$slots:{default:[li]},$$scope:{ctx:n}}}),r=new pe({props:{data:ne(n[0].jats),generateId:!0,$$slots:{default:[ri]},$$scope:{ctx:n}}}),i=new pe({props:{data:ne(n[0].bus_stops),generateId:!0,$$slots:{default:[oi]},$$scope:{ctx:n}}}),s=new pe({props:{data:ne(n[0].crossings),generateId:!0,$$slots:{default:[ii]},$$scope:{ctx:n}}}),c=new pe({props:{data:ne(n[0].side_roads),generateId:!0,$$slots:{default:[si]},$$scope:{ctx:n}}}),{c(){e=$("div"),N(l.$$.fragment),t=C(),N(r.$$.fragment),o=C(),N(i.$$.fragment),a=C(),N(s.$$.fragment),f=C(),N(c.$$.fragment),z(e,"slot","map")},m(u,m){v(u,e,m),E(l,e,null),g(e,t),E(r,e,null),g(e,o),E(i,e,null),g(e,a),E(s,e,null),g(e,f),E(c,e,null),d=!0},p(u,m){const p={};m&1&&(p.data=ne(u[0].links)),m&514&&(p.$$scope={dirty:m,ctx:u}),l.$set(p);const _={};m&1&&(_.data=ne(u[0].jats)),m&514&&(_.$$scope={dirty:m,ctx:u}),r.$set(_);const I={};m&1&&(I.data=ne(u[0].bus_stops)),m&514&&(I.$$scope={dirty:m,ctx:u}),i.$set(I);const h={};m&1&&(h.data=ne(u[0].crossings)),m&514&&(h.$$scope={dirty:m,ctx:u}),s.$set(h);const b={};m&1&&(b.data=ne(u[0].side_roads)),m&514&&(b.$$scope={dirty:m,ctx:u}),c.$set(b)},i(u){d||(k(l.$$.fragment,u),k(r.$$.fragment,u),k(i.$$.fragment,u),k(s.$$.fragment,u),k(c.$$.fragment,u),d=!0)},o(u){y(l.$$.fragment,u),y(r.$$.fragment,u),y(i.$$.fragment,u),y(s.$$.fragment,u),y(c.$$.fragment,u),d=!1},d(u){u&&w(e),D(l),D(r),D(i),D(s),D(c)}}}function ci(n){let e,l;return e=new Me({props:{$$slots:{map:[ai],sidebar:[ni]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,[r]){const o={};r&515&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function ui(n,e,l){let t,r;x(n,U,u=>l(0,t=u)),x(n,W,u=>l(1,r=u));function o(){X(U,t.links=[],t),X(U,t.jats=[],t),X(U,t.bus_stops=[],t),X(U,t.crossings=[],t),X(U,t.side_roads=[],t)}return[t,r,o,u=>X(W,r={kind:"edit-link",idx:u.detail.features[0].id},r),u=>X(W,r={kind:"edit-jat",idx:u.detail.features[0].id},r),u=>X(W,r={kind:"edit-bus-stop",idx:u.detail.features[0].id},r),u=>X(W,r={kind:"edit-crossing",idx:u.detail.features[0].id},r),u=>X(W,r={kind:"edit-side-road",idx:u.detail.features[0].id},r),()=>Zl("rcv2.geojson",JSON.stringify(t))]}class fi extends ie{constructor(e){super(),se(this,e,ui,ci,ae,{})}}const{window:di}=He;function mi(n,e,l){const t=n.slice();return t[10]=e[l],t}function Nn(n){let e;return{c(){e=$("p"),e.textContent="A side road needs at least two points"},m(l,t){v(l,e,t)},d(l){l&&w(e)}}}function pi(n){let e;return{c(){e=$("option"),e.textContent=`${n[10]}`,e.__value=n[10],le(e,e.__value)},m(l,t){v(l,e,t)},p:te,d(l){l&&w(e)}}}function gi(n){let e,l,t,r,o,i,a,s,f,c,d,u,m,p,_,I,h,b=!n[2]&&Nn(),O=K(he()),T=[];for(let j=0;j<O.length;j+=1)T[j]=pi(mi(n,O,j));return{c(){e=$("div"),l=$("button"),t=G("Done"),o=C(),i=$("button"),i.textContent="Delete side road",a=C(),b&&b.c(),s=C(),f=$("label"),c=G(`Name:
      `),d=$("input"),u=C(),m=$("label"),p=G(`SA01: conflict at side roads and priority junctions
      `),_=$("select");for(let j=0;j<T.length;j+=1)T[j].c();l.disabled=r=!n[2],z(d,"type","text"),n[1].side_roads[n[0]].properties.sa01===void 0&&We(()=>n[9].call(_)),z(e,"slot","sidebar")},m(j,S){v(j,e,S),g(e,l),g(l,t),g(e,o),g(e,i),g(e,a),b&&b.m(e,null),g(e,s),g(e,f),g(f,c),g(f,d),le(d,n[1].side_roads[n[0]].properties.name),g(e,u),g(e,m),g(m,p),g(m,_);for(let B=0;B<T.length;B+=1)T[B]&&T[B].m(_,null);Le(_,n[1].side_roads[n[0]].properties.sa01,!0),I||(h=[Z(l,"click",n[7]),Z(i,"click",n[5]),Z(d,"input",n[8]),Z(_,"change",n[9])],I=!0)},p(j,S){S&4&&r!==(r=!j[2])&&(l.disabled=r),j[2]?b&&(b.d(1),b=null):b||(b=Nn(),b.c(),b.m(e,s)),S&3&&d.value!==j[1].side_roads[j[0]].properties.name&&le(d,j[1].side_roads[j[0]].properties.name),S&3&&Le(_,j[1].side_roads[j[0]].properties.sa01)},d(j){j&&w(e),b&&b.d(),re(T,j),I=!1,_e(h)}}}function _i(n){let e,l;return e=new Ae({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":3}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&1&&(o.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":3}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function hi(n){let e,l,t,r,o,i,a,s;l=new De({props:{except:"side_roads"}}),r=new pe({props:{data:ne(n[1].side_roads),generateId:!0,$$slots:{default:[_i]},$$scope:{ctx:n}}});function f(d){n[6](d)}let c={};return n[1].side_roads[n[0]]!==void 0&&(c.f=n[1].side_roads[n[0]]),i=new On({props:c}),me.push(()=>ve(i,"f",f)),{c(){e=$("div"),N(l.$$.fragment),t=C(),N(r.$$.fragment),o=C(),N(i.$$.fragment),z(e,"slot","map")},m(d,u){v(d,e,u),E(l,e,null),g(e,t),E(r,e,null),g(e,o),E(i,e,null),s=!0},p(d,u){const m={};u&2&&(m.data=ne(d[1].side_roads)),u&8193&&(m.$$scope={dirty:u,ctx:d}),r.$set(m);const p={};!a&&u&3&&(a=!0,p.f=d[1].side_roads[d[0]],we(()=>a=!1)),i.$set(p)},i(d){s||(k(l.$$.fragment,d),k(r.$$.fragment,d),k(i.$$.fragment,d),s=!0)},o(d){y(l.$$.fragment,d),y(r.$$.fragment,d),y(i.$$.fragment,d),s=!1},d(d){d&&w(e),D(l),D(r),D(i)}}}function $i(n){let e,l,t,r;return e=new Me({props:{$$slots:{map:[hi],sidebar:[gi]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(o,i){E(e,o,i),l=!0,t||(r=Z(di,"keydown",n[4]),t=!0)},p(o,[i]){const a={};i&8207&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){y(e.$$.fragment,o),l=!1},d(o){D(e,o),t=!1,r()}}}function ki(n,e,l){let t,r,o;x(n,U,m=>l(1,r=m)),x(n,W,m=>l(3,o=m));let{idx:i}=e;function a(m){m.key=="Escape"&&X(W,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this side road?")&&(X(W,o={kind:"neutral"},o),await Ne(),r.side_roads.splice(i,1),U.set(r))}function f(m){n.$$.not_equal(r.side_roads[i],m)&&(r.side_roads[i]=m,U.set(r))}const c=()=>X(W,o={kind:"neutral"},o);function d(){r.side_roads[i].properties.name=this.value,U.set(r)}function u(){r.side_roads[i].properties.sa01=Ve(this),U.set(r)}return n.$$set=m=>{"idx"in m&&l(0,i=m.idx)},n.$$.update=()=>{n.$$.dirty&3&&l(2,t=r.side_roads[i].geometry.coordinates.length>=2)},[i,r,t,o,a,s,f,c,d,u]}class bi extends ie{constructor(e){super(),se(this,e,ki,$i,ae,{idx:0})}}function vi(n){let e,l;return{c(){e=$("div"),l=$("div"),z(e,"slot","left")},m(t,r){v(t,e,r),g(e,l),n[9](l)},p:te,d(t){t&&w(e),n[9](null)}}}function wi(n){return{c:te,m:te,p:te,i:te,o:te,d:te}}function yi(n){let e,l,t;function r(i){n[8](i)}let o={style:n[10],standardControls:!0,hash:!0,$$slots:{default:[Ni]},$$scope:{ctx:n}};return n[2]!==void 0&&(o.map=n[2]),e=new Qn({props:o}),me.push(()=>ve(e,"map",r)),{c(){N(e.$$.fragment)},m(i,a){E(e,i,a),t=!0},p(i,a){const s={};a&2058&&(s.$$scope={dirty:a,ctx:i}),!l&&a&4&&(l=!0,s.map=i[2],we(()=>l=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function ji(n){let e,l;return e=new jo({props:{qIdx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.qIdx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Ci(n){let e,l;return e=new bi({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.idx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Li(n){let e,l;return e=new Fl({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.idx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Si(n){let e,l;return e=new Al({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.idx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Ai(n){let e,l;return e=new Yr({props:{junctionIdx:n[3].idx,stage:n[3].stage}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.junctionIdx=t[3].idx),r&8&&(o.stage=t[3].stage),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Ti(n){let e,l;return e=new oo({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.idx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Mi(n){let e,l;return e=new ko({props:{idx:n[3].idx}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,r){const o={};r&8&&(o.idx=t[3].idx),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Ii(n){let e,l;return e=new fi({}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p:te,i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Ni(n){let e,l,t,r,o,i;const a=[Ii,Mi,Ti,Ai,Si,Li,Ci,ji],s=[];function f(c,d){return c[3].kind=="neutral"?0:c[3].kind=="edit-link"?1:c[3].kind=="edit-jat"?2:c[3].kind=="edit-jat-detail"?3:c[3].kind=="edit-bus-stop"?4:c[3].kind=="edit-crossing"?5:c[3].kind=="edit-side-road"?6:c[3].kind=="edit-question"?7:-1}return~(t=f(n))&&(r=s[t]=a[t](n)),{c(){e=$("div"),l=C(),r&&r.c(),o=Xe()},m(c,d){v(c,e,d),n[7](e),v(c,l,d),~t&&s[t].m(c,d),v(c,o,d),i=!0},p(c,d){let u=t;t=f(c),t===u?~t&&s[t].p(c,d):(r&&(ce(),y(s[u],1,1,()=>{s[u]=null}),ue()),~t?(r=s[t],r?r.p(c,d):(r=s[t]=a[t](c),r.c()),k(r,1),r.m(o.parentNode,o)):r=null)},i(c){i||(k(r),i=!0)},o(c){y(r),i=!1},d(c){c&&(w(e),w(l),w(o)),n[7](null),~t&&s[t].d(c)}}}function Ei(n){return{c:te,m:te,p:te,i:te,o:te,d:te}}function Di(n){let e,l,t={ctx:n,current:null,token:null,hasCatch:!1,pending:Ei,then:yi,catch:wi,value:10,blocks:[,,,]};return Yn(Ol(new URLSearchParams(window.location.search).get("google")||""),t),{c(){e=$("div"),t.block.c(),z(e,"slot","main"),Y(e,"position","relative"),Y(e,"width","100%"),Y(e,"height","100vh")},m(r,o){v(r,e,o),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,l=!0},p(r,o){n=r,xn(t,n,o)},i(r){l||(k(t.block),l=!0)},o(r){for(let o=0;o<3;o+=1){const i=t.blocks[o];y(i)}l=!1},d(r){r&&w(e),t.block.d(),t.token=null,t=null}}}function qi(n){let e,l;return e=new Vn({props:{$$slots:{main:[Di],left:[vi]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),l=!0},p(t,[r]){const o={};r&2063&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){l||(k(e.$$.fragment,t),l=!0)},o(t){y(e.$$.fragment,t),l=!1},d(t){D(e,t)}}}function Pi(n,e,l){let t,r,o,i,a;x(n,st,m=>l(4,t=m)),x(n,it,m=>l(5,r=m)),x(n,U,m=>l(6,o=m)),x(n,Je,m=>l(2,i=m)),x(n,W,m=>l(3,a=m));let s,f;function c(m){me[m?"unshift":"push"](()=>{f=m,l(1,f),l(4,t)})}function d(m){i=m,Je.set(i)}function u(m){me[m?"unshift":"push"](()=>{s=m,l(0,s),l(5,r)})}return n.$$.update=()=>{n.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(o)),n.$$.dirty&33&&s&&r&&(l(0,s.innerHTML="",s),s.appendChild(r)),n.$$.dirty&18&&f&&t&&(l(1,f.innerHTML="",f),f.appendChild(t))},[s,f,i,a,t,r,o,c,d,u]}class Fi extends ie{constructor(e){super(),se(this,e,Pi,qi,ae,{})}}new Fi({target:document.getElementById("app")});
