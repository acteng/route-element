import{V as Fn,W as Bn,X as Ve,r as $e,e as C,v as ke,t as b,Y as Jn,S as pe,i as _e,s as ge,Z as zn,_ as Rn,$ as oe,a0 as Hn,L as Gn,b as be,a as Me,c as P,m as O,d as Ie,f as F,g as Un,h as Be,u as Je,j as ze,k as Re,l as Ce,y as h,z as A,q as v,w,a1 as We,G as Ae,E as Ee,B as re,D as He,Q as W,a2 as nt,F as Z,A as z,O as d,N as de,R as Se,M as Pe,a3 as te,a4 as Ze,U as ee,a5 as ut,a6 as _t,H as ie,p as lt,o as Q,x as ce,K as rt,a7 as Zn,a8 as at,a9 as Kn,C as Ke,P as Tn,aa as Mn,ab as In,ac as xe,ad as Xn,I as Wn,T as Vn}from"./Layout-9b79d398.js";function Qn(t,e){const l=e.token={};function n(r,o,i,a){if(e.token!==l)return;e.resolved=a;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=a);const u=r&&(e.current=r)(s);let c=!1;e.block&&(e.blocks?e.blocks.forEach((f,p)=>{p!==o&&f&&($e(),C(f,1,1,()=>{e.blocks[p]===f&&(e.blocks[p]=null)}),ke())}):e.block.d(1),u.c(),b(u,1),u.m(e.mount(),e.anchor),c=!0),e.block=u,e.blocks&&(e.blocks[o]=u),c&&Jn()}if(Fn(t)){const r=Bn();if(t.then(o=>{Ve(r),n(e.then,1,e.value,o),Ve(null)},o=>{if(Ve(r),n(e.catch,2,e.error,o),Ve(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,t),!0;e.resolved=t}}function Yn(t,e,l){const n=e.slice(),{resolved:r}=t;t.current===t.then&&(n[t.value]=r),t.current===t.catch&&(n[t.error]=r),t.block.p(n,l)}function xn(t,e,l){let n;const r=zn();let{layer:o=void 0}=e;const{map:i}=Rn();oe(t,i,c=>l(2,n=c));function a(c){r(c.type,{...c,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Hn(()=>{if(n)if(o)for(const c of s)n.off(c,o,a);else for(const c of u)n.off(c,a)}),t.$$set=c=>{"layer"in c&&l(1,o=c.layer)},t.$$.update=()=>{if(t.$$.dirty&6&&n)if(o)for(const c of s)n.on(c,o,a);else for(const c of u)n.on(c,a)},[i,o,n]}class Nn extends pe{constructor(e){super(),_e(this,e,xn,null,ge,{layer:1})}}function el(t){let e;const l=t[16].default,n=Be(l,t,t[24],null);return{c(){n&&n.c()},m(r,o){n&&n.m(r,o),e=!0},p(r,o){n&&n.p&&(!e||o&16777216)&&Je(n,l,r,r[24],e?Re(l,r[24],o,null):ze(r[24]),null)},i(r){e||(b(n,r),e=!0)},o(r){C(n,r),e=!1},d(r){n&&n.d(r)}}}function tl(t){let e,l,n;function r(i){t[17](i)}let o={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[el]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new Gn({props:o}),be.push(()=>Me(e,"hovered",r)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){P(e.$$.fragment)},m(i,a){O(e,i,a),n=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!l&&a&1&&(l=!0,s.hovered=i[0],Ie(()=>l=!1)),e.$set(s)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function nl(t,e,l){let{$$slots:n={},$$scope:r}=e,{id:o=Un("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:f=void 0}=e,{filter:p=void 0}=e,{applyToClusters:m=void 0}=e,{minzoom:_=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:N=void 0}=e,{manageHoverState:$=!1}=e,{hovered:j=null}=e,{eventsIfTopMost:J=!1}=e,{interactive:U=!0}=e;function q(k){j=k,l(0,j)}function S(k){Ce.call(this,t,k)}function B(k){Ce.call(this,t,k)}function T(k){Ce.call(this,t,k)}function H(k){Ce.call(this,t,k)}function L(k){Ce.call(this,t,k)}function M(k){Ce.call(this,t,k)}return t.$$set=k=>{"id"in k&&l(1,o=k.id),"source"in k&&l(2,i=k.source),"sourceLayer"in k&&l(3,a=k.sourceLayer),"beforeId"in k&&l(4,s=k.beforeId),"beforeLayerType"in k&&l(5,u=k.beforeLayerType),"paint"in k&&l(6,c=k.paint),"layout"in k&&l(7,f=k.layout),"filter"in k&&l(8,p=k.filter),"applyToClusters"in k&&l(9,m=k.applyToClusters),"minzoom"in k&&l(10,_=k.minzoom),"maxzoom"in k&&l(11,g=k.maxzoom),"hoverCursor"in k&&l(12,N=k.hoverCursor),"manageHoverState"in k&&l(13,$=k.manageHoverState),"hovered"in k&&l(0,j=k.hovered),"eventsIfTopMost"in k&&l(14,J=k.eventsIfTopMost),"interactive"in k&&l(15,U=k.interactive),"$$scope"in k&&l(24,r=k.$$scope)},[j,o,i,a,s,u,c,f,p,m,_,g,N,$,J,U,n,q,S,B,T,H,L,M,r]}class ll extends pe{constructor(e){super(),_e(this,e,nl,tl,ge,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const rl=t=>({}),gt=t=>({}),ol=t=>({}),ht=t=>({});function il(t){let e,l,n,r;const o=t[3].sidebar,i=Be(o,t,t[2],ht),a=t[3].map,s=Be(a,t,t[2],gt);return{c(){e=h("div"),i&&i.c(),l=A(),n=h("div"),s&&s.c()},m(u,c){v(u,e,c),i&&i.m(e,null),t[4](e),v(u,l,c),v(u,n,c),s&&s.m(n,null),t[5](n),r=!0},p(u,[c]){i&&i.p&&(!r||c&4)&&Je(i,o,u,u[2],r?Re(o,u[2],c,ol):ze(u[2]),ht),s&&s.p&&(!r||c&4)&&Je(s,a,u,u[2],r?Re(a,u[2],c,rl):ze(u[2]),gt)},i(u){r||(b(i,u),b(s,u),r=!0)},o(u){C(i,u),C(s,u),r=!1},d(u){u&&(w(e),w(l),w(n)),i&&i.d(u),t[4](null),s&&s.d(u),t[5](null)}}}function sl(t,e,l){let n,r;oe(t,ft,u=>l(0,n=u)),oe(t,mt,u=>l(1,r=u));let{$$slots:o={},$$scope:i}=e;function a(u){be[u?"unshift":"push"](()=>{n=u,ft.set(n)})}function s(u){be[u?"unshift":"push"](()=>{r=u,mt.set(r)})}return t.$$set=u=>{"$$scope"in u&&l(2,i=u.$$scope)},[n,r,i,o,a,s]}class Ue extends pe{constructor(e){super(),_e(this,e,sl,il,ge,{})}}let ft=We(null),mt=We(null),et=We(void 0),V=We(fl());function he(t){return{type:"FeatureCollection",features:t}}let le=We({kind:"neutral"});function Te(){return["","2","1","0","Critical"]}let je=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:Te()},{name:"SA04",description:"trip hazards",choices:Te()},{name:"SA05",description:"kerbside activity",choices:Te()},{name:"SA08",description:"motor traffic speed",choices:Te()},{name:"SA09",description:"motor traffic volume",choices:Te()},{name:"SA11",description:"footway widths",choices:Te()},{name:"SA12",description:"effective width next to tram lines",choices:Te()},{name:"SA13",description:"crossing angle of tram/train rails",choices:Te()},{name:"SA14",description:"cycling surface and maintenance defects",choices:Te()},{name:"SA15",description:"WW surface and maintenance defects",choices:Te()},{name:"SA16",description:"guard railing",choices:Te()}],Ge=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"];function al(t){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Ge[t%Ge.length],answers:Array(je.length).fill("")}}}function cl(t,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Ge[t%Ge.length],st20:""}}}function ul(t,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Ge[t%Ge.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function fl(){try{let t=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if("links"in t&&"jats"in t&&"bus_stops"in t)return t}catch{}return{links:[],jats:[],bus_stops:[]}}function ml(t){let e,l;return e=new Ee({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function dl(t){let e,l;return e=new Ae({props:{data:he(t[0].jats),$$slots:{default:[ml]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&1&&(o.data=he(n[0].jats)),r&2&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function pl(t,e,l){let n;return oe(t,V,r=>l(0,n=r)),[n]}class pt extends pe{constructor(e){super(),_e(this,e,pl,dl,ge,{})}}function _l(t){let e,l;return e=new He({props:{paint:{"line-color":t[0]?["get","color"]:"black","line-width":6}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.paint={"line-color":n[0]?["get","color"]:"black","line-width":6}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function gl(t){let e,l;return e=new Ae({props:{data:he(t[1].links),$$slots:{default:[_l]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&2&&(o.data=he(n[1].links)),r&5&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function hl(t,e,l){let n;oe(t,V,o=>l(1,n=o));let{showColor:r=!1}=e;return t.$$set=o=>{"showColor"in o&&l(0,r=o.showColor)},[r,n]}class ot extends pe{constructor(e){super(),_e(this,e,hl,gl,ge,{showColor:0})}}const{window:$l}=nt;function kl(t){let e,l,n,r,o,i,a,s,u,c,f;return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=A(),r=h("button"),r.textContent="Delete bus stop",o=A(),i=h("label"),a=Z(`Name:
      `),s=h("input"),u=Z(`

    TODO question`),z(s,"type","text"),z(e,"slot","sidebar")},m(p,m){v(p,e,m),d(e,l),d(e,n),d(e,r),d(e,o),d(e,i),d(i,a),d(i,s),de(s,t[1].bus_stops[t[0]].properties.name),d(e,u),c||(f=[W(l,"click",t[6]),W(r,"click",t[4]),W(s,"input",t[7])],c=!0)},p(p,m){m&3&&s.value!==p[1].bus_stops[p[0]].properties.name&&de(s,p[1].bus_stops[p[0]].properties.name)},d(p){p&&w(e),c=!1,Se(f)}}}function bl(t){let e,l;return e=new Ee({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"black","circle-radius":10}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function vl(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-1j72wc4"),ee(e,"background-color",t[1].bus_stops[t[0]].properties.color)},m(l,n){v(l,e,n)},p(l,n){n&3&&ee(e,"background-color",l[1].bus_stops[l[0]].properties.color)},d(l){l&&w(e)}}}function wl(t){let e,l,n,r,o,i,a,s,u,c;l=new ot({}),r=new pt({}),i=new Ae({props:{data:he(t[1].bus_stops),generateId:!0,$$slots:{default:[bl]},$$scope:{ctx:t}}});function f(m){t[5](m)}let p={draggable:!0,$$slots:{default:[vl]},$$scope:{ctx:t}};return t[1].bus_stops[t[0]].geometry.coordinates!==void 0&&(p.lngLat=t[1].bus_stops[t[0]].geometry.coordinates),s=new Pe({props:p}),be.push(()=>Me(s,"lngLat",f)),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment),z(e,"slot","map")},m(m,_){v(m,e,_),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),d(e,a),O(s,e,null),c=!0},p(m,_){const g={};_&2&&(g.data=he(m[1].bus_stops)),_&257&&(g.$$scope={dirty:_,ctx:m}),i.$set(g);const N={};_&259&&(N.$$scope={dirty:_,ctx:m}),!u&&_&3&&(u=!0,N.lngLat=m[1].bus_stops[m[0]].geometry.coordinates,Ie(()=>u=!1)),s.$set(N)},i(m){c||(b(l.$$.fragment,m),b(r.$$.fragment,m),b(i.$$.fragment,m),b(s.$$.fragment,m),c=!0)},o(m){C(l.$$.fragment,m),C(r.$$.fragment,m),C(i.$$.fragment,m),C(s.$$.fragment,m),c=!1},d(m){m&&w(e),F(l),F(r),F(i),F(s)}}}function yl(t){let e,l,n,r;return e=new Ue({props:{$$slots:{map:[wl],sidebar:[kl]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W($l,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&263&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function jl(t,e,l){let n,r;oe(t,V,f=>l(1,n=f)),oe(t,le,f=>l(2,r=f));let{idx:o}=e;function i(f){f.key=="Escape"&&te(le,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this bus stop?")&&(te(le,r={kind:"neutral"},r),await Ze(),n.bus_stops.splice(o,1),V.set(n))}function s(f){t.$$.not_equal(n.bus_stops[o].geometry.coordinates,f)&&(n.bus_stops[o].geometry.coordinates=f,V.set(n))}const u=()=>te(le,r={kind:"neutral"},r);function c(){n.bus_stops[o].properties.name=this.value,V.set(n)}return t.$$set=f=>{"idx"in f&&l(0,o=f.idx)},[o,n,r,i,a,s,u,c]}class Cl extends pe{constructor(e){super(),_e(this,e,jl,yl,ge,{idx:0})}}let $t="MZEJTanw3WpxRvt7qDfo";async function Al(t){return t?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await Sl(t)}&key=${t}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${$t}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${$t}`}async function Sl(t){try{let l=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${t}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB"})})).json();return"session"in l?l.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(l)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}function Ll(t){let e,l;return e=new Ee({props:{paint:{"circle-color":"black","circle-radius":10}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Tl(t){let e,l;return e=new Ae({props:{data:he(t[0].bus_stops),$$slots:{default:[Ll]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&1&&(o.data=he(n[0].bus_stops)),r&2&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ml(t,e,l){let n;return oe(t,V,r=>l(0,n=r)),[n]}class it extends pe{constructor(e){super(),_e(this,e,Ml,Tl,ge,{})}}const Il="/route-element/assets/right-arrow-d8c7892c.svg";function kt(t){let e,l;const n=t[4].default,r=Be(n,t,t[3],null);return{c(){e=h("div"),r&&r.c(),z(e,"class","section svelte-zax3q3")},m(o,i){v(o,e,i),r&&r.m(e,null),l=!0},p(o,i){r&&r.p&&(!l||i&8)&&Je(r,n,o,o[3],l?Re(n,o[3],i,null):ze(o[3]),null)},i(o){l||(b(r,o),l=!0)},o(o){C(r,o),l=!1},d(o){o&&w(e),r&&r.d(o)}}}function Nl(t){let e,l,n,r,o,i,a,s,u,c,f,p,m=t[2]&&kt(t);return{c(){e=h("button"),l=h("div"),n=h("span"),r=Z(t[0]),o=A(),i=h("img"),u=A(),m&&m.c(),z(i,"class","arrow svelte-zax3q3"),ut(i.src,a=Il)||z(i,"src",a),z(i,"alt",s="Select "+t[0]),z(l,"class","top-section section svelte-zax3q3"),_t(l,"bordered",t[2]),z(e,"class","clickable-card svelte-zax3q3"),e.disabled=t[1]},m(_,g){v(_,e,g),d(e,l),d(l,n),d(n,r),d(l,o),d(l,i),d(e,u),m&&m.m(e,null),c=!0,f||(p=[W(e,"click",t[5]),W(e,"mouseenter",t[6]),W(e,"mouseleave",t[7])],f=!0)},p(_,[g]){(!c||g&1)&&ie(r,_[0]),(!c||g&1&&s!==(s="Select "+_[0]))&&z(i,"alt",s),(!c||g&4)&&_t(l,"bordered",_[2]),_[2]?m?(m.p(_,g),g&4&&b(m,1)):(m=kt(_),m.c(),b(m,1),m.m(e,null)):m&&($e(),C(m,1,1,()=>{m=null}),ke()),(!c||g&2)&&(e.disabled=_[1])},i(_){c||(b(m),c=!0)},o(_){C(m),c=!1},d(_){_&&w(e),m&&m.d(),f=!1,Se(p)}}}function El(t,e,l){let{$$slots:n={},$$scope:r}=e,{name:o}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(f){Ce.call(this,t,f)}function u(f){Ce.call(this,t,f)}function c(f){Ce.call(this,t,f)}return t.$$set=f=>{"name"in f&&l(0,o=f.name),"disabled"in f&&l(1,i=f.disabled),"hasSlot"in f&&l(2,a=f.hasSlot),"$$scope"in f&&l(3,r=f.$$scope)},[o,i,a,r,n,s,u,c]}class En extends pe{constructor(e){super(),_e(this,e,El,Nl,ge,{name:0,disabled:1,hasSlot:2})}}let Ne={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const Dl=t=>({dialog:t&1}),bt=t=>({dialog:t[0]});function ql(t){let e,l,n,r,o;const i=t[4].default,a=Be(i,t,t[3],bt);return{c(){e=h("dialog"),l=h("article"),a&&a.c(),e.open=!0},m(s,u){v(s,e,u),d(e,l),a&&a.m(l,null),t[6](e),n=!0,r||(o=[W(window,"click",t[1]),W(window,"keydown",t[2]),W(e,"close",t[5])],r=!0)},p(s,[u]){a&&a.p&&(!n||u&9)&&Je(a,i,s,s[3],n?Re(i,s[3],u,Dl):ze(s[3]),bt)},i(s){n||(b(a,s),n=!0)},o(s){C(a,s),n=!1},d(s){s&&w(e),a&&a.d(s),t[6](null),r=!1,Se(o)}}}function Pl(t,e,l){let{$$slots:n={},$$scope:r}=e,o;function i(c){o.open&&c.target==o&&o.close()}function a(c){(c.key=="Escape"||c.key=="Enter")&&(c.stopPropagation(),o.close())}function s(c){Ce.call(this,t,c)}function u(c){be[c?"unshift":"push"](()=>{o=c,l(0,o)})}return t.$$set=c=>{"$$scope"in c&&l(3,r=c.$$scope)},[o,i,a,r,n,s,u]}class Dn extends pe{constructor(e){super(),_e(this,e,Pl,ql,ge,{})}}function Ol(t,e){let l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),l.setAttribute("download",t),document.body.appendChild(l),l.click(),document.body.removeChild(l)}const Oe={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},dt=Object.keys(Oe);function tt(t){return Object.keys(Oe[t])}const qe="All movements";function vt(t,e){let l=[],n=Oe[t][e];n&&l.push({junctionType:t,movementType:e,...n});let r=Oe[t][qe];if(r&&e!=qe&&l.push({junctionType:t,movementType:qe,...r}),t=="Crossroads"){let o=Oe["Simple priority T-junction"][qe];o&&l.push({junctionType:"Simple priority T-junction",movementType:qe,...o})}if(t!="Any type of junction"){let o=Oe["Any type of junction"][qe];o&&l.push({junctionType:"Any type of junction",movementType:qe,...o})}return l}function wt(t,e,l){const n=t.slice();return n[10]=e[l],n}function yt(t,e,l){const n=t.slice();return n[13]=e[l],n}function jt(t,e,l){const n=t.slice();return n[13]=e[l],n}function Ct(t,e,l){const n=t.slice();return n[13]=e[l],n}function At(t,e,l){const n=t.slice();return n[20]=e[l],n}function St(t,e,l){const n=t.slice();return n[20]=e[l],n}function Lt(t){let e,l;return e=new Dn({props:{$$slots:{default:[Fl]},$$scope:{ctx:t}}}),e.$on("close",t[9]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&33554439&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Tt(t){let e,l,n,r,o,i,a,s;return i=rt(t[6][1]),{c(){e=h("label"),l=h("input"),n=A(),r=Z(t[20]),o=A(),z(l,"type","radio"),l.__value=t[20],de(l,l.__value),i.p(l)},m(u,c){v(u,e,c),d(e,l),l.checked=l.__value===t[1],d(e,n),d(e,r),d(e,o),a||(s=[W(l,"change",t[5]),W(l,"change",t[3])],a=!0)},p(u,c){c&2&&(l.checked=l.__value===u[1])},d(u){u&&w(e),i.r(),a=!1,Se(s)}}}function Mt(t){let e,l,n,r=!1,o,i=t[20]+"",a,s,u,c,f;return u=rt(t[6][0]),{c(){e=h("label"),l=h("input"),o=A(),a=Z(i),s=A(),z(l,"type","radio"),l.__value=n=t[20],de(l,l.__value),u.p(l)},m(p,m){v(p,e,m),d(e,l),l.checked=l.__value===t[2],d(e,o),d(e,a),d(e,s),c||(f=W(l,"change",t[7]),c=!0)},p(p,m){m&2&&n!==(n=p[20])&&(l.__value=n,de(l,l.__value),r=!0),(r||m&6)&&(l.checked=l.__value===p[2]),m&2&&i!==(i=p[20]+"")&&ie(a,i)},d(p){p&&w(e),u.r(),c=!1,f()}}}function It(t){let e,l=t[13]+"",n;return{c(){e=h("li"),n=Z(l)},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&6&&l!==(l=r[13]+"")&&ie(n,l)},d(r){r&&w(e)}}}function Nt(t){let e,l=t[13]+"",n;return{c(){e=h("li"),n=Z(l)},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&6&&l!==(l=r[13]+"")&&ie(n,l)},d(r){r&&w(e)}}}function Et(t){let e,l=t[13]+"",n;return{c(){e=h("li"),n=Z(l)},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&6&&l!==(l=r[13]+"")&&ie(n,l)},d(r){r&&w(e)}}}function Dt(t){let e,l,n=t[10].junctionType+"",r,o,i,a,s,u,c=t[10].movementType+"",f,p,m,_,g,N,$,j,J,U,q,S=Q(t[10].scoreZero),B=[];for(let k=0;k<S.length;k+=1)B[k]=It(Ct(t,S,k));let T=Q(t[10].scoreOne),H=[];for(let k=0;k<T.length;k+=1)H[k]=Nt(jt(t,T,k));let L=Q(t[10].scoreTwo),M=[];for(let k=0;k<L.length;k+=1)M[k]=Et(yt(t,L,k));return{c(){e=h("tr"),l=h("td"),r=Z(n),o=A(),i=h("br"),a=A(),s=h("br"),u=A(),f=Z(c),p=A(),m=h("td"),_=h("ul");for(let k=0;k<B.length;k+=1)B[k].c();g=A(),N=h("td"),$=h("ul");for(let k=0;k<H.length;k+=1)H[k].c();j=A(),J=h("td"),U=h("ul");for(let k=0;k<M.length;k+=1)M[k].c();q=A(),z(l,"class","type-row svelte-k4kgn3"),z(m,"class","score-zero svelte-k4kgn3"),z(N,"class","score-one svelte-k4kgn3"),z(J,"class","score-two svelte-k4kgn3")},m(k,X){v(k,e,X),d(e,l),d(l,r),d(l,o),d(l,i),d(l,a),d(l,s),d(l,u),d(l,f),d(e,p),d(e,m),d(m,_);for(let y=0;y<B.length;y+=1)B[y]&&B[y].m(_,null);d(e,g),d(e,N),d(N,$);for(let y=0;y<H.length;y+=1)H[y]&&H[y].m($,null);d(e,j),d(e,J),d(J,U);for(let y=0;y<M.length;y+=1)M[y]&&M[y].m(U,null);d(e,q)},p(k,X){if(X&6&&n!==(n=k[10].junctionType+"")&&ie(r,n),X&6&&c!==(c=k[10].movementType+"")&&ie(f,c),X&6){S=Q(k[10].scoreZero);let y;for(y=0;y<S.length;y+=1){const ue=Ct(k,S,y);B[y]?B[y].p(ue,X):(B[y]=It(ue),B[y].c(),B[y].m(_,null))}for(;y<B.length;y+=1)B[y].d(1);B.length=S.length}if(X&6){T=Q(k[10].scoreOne);let y;for(y=0;y<T.length;y+=1){const ue=jt(k,T,y);H[y]?H[y].p(ue,X):(H[y]=Nt(ue),H[y].c(),H[y].m($,null))}for(;y<H.length;y+=1)H[y].d(1);H.length=T.length}if(X&6){L=Q(k[10].scoreTwo);let y;for(y=0;y<L.length;y+=1){const ue=yt(k,L,y);M[y]?M[y].p(ue,X):(M[y]=Et(ue),M[y].c(),M[y].m(U,null))}for(;y<M.length;y+=1)M[y].d(1);M.length=L.length}},d(k){k&&w(e),ce(B,k),ce(H,k),ce(M,k)}}}function Fl(t){let e,l,n,r,o,i,a,s,u,c,f,p,m,_,g,N,$,j=Q(dt),J=[];for(let T=0;T<j.length;T+=1)J[T]=Tt(St(t,j,T));let U=Q(tt(t[1])),q=[];for(let T=0;T<U.length;T+=1)q[T]=Mt(At(t,U,T));let S=Q(vt(t[1],t[2])),B=[];for(let T=0;T<S.length;T+=1)B[T]=Dt(wt(t,S,T));return{c(){e=h("h1"),e.textContent="LTN 1/20 scoring guidance",l=A(),n=h("p"),n.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,r=A(),o=h("div"),i=Z(`Type of junction:
      `),a=h("fieldset");for(let T=0;T<J.length;T+=1)J[T].c();s=Z(`

      Type of movement:
      `),u=h("fieldset");for(let T=0;T<q.length;T+=1)q[T].c();c=A(),f=h("table"),p=h("tr"),p.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,m=A();for(let T=0;T<B.length;T+=1)B[T].c();_=A(),g=h("button"),g.textContent="OK",ee(o,"display","flex"),ee(o,"justify-content","space-between")},m(T,H){v(T,e,H),v(T,l,H),v(T,n,H),v(T,r,H),v(T,o,H),d(o,i),d(o,a);for(let L=0;L<J.length;L+=1)J[L]&&J[L].m(a,null);d(o,s),d(o,u);for(let L=0;L<q.length;L+=1)q[L]&&q[L].m(u,null);v(T,c,H),v(T,f,H),d(f,p),d(f,m);for(let L=0;L<B.length;L+=1)B[L]&&B[L].m(f,null);v(T,_,H),v(T,g,H),N||($=W(g,"click",t[8]),N=!0)},p(T,H){if(H&10){j=Q(dt);let L;for(L=0;L<j.length;L+=1){const M=St(T,j,L);J[L]?J[L].p(M,H):(J[L]=Tt(M),J[L].c(),J[L].m(a,null))}for(;L<J.length;L+=1)J[L].d(1);J.length=j.length}if(H&6){U=Q(tt(T[1]));let L;for(L=0;L<U.length;L+=1){const M=At(T,U,L);q[L]?q[L].p(M,H):(q[L]=Mt(M),q[L].c(),q[L].m(u,null))}for(;L<q.length;L+=1)q[L].d(1);q.length=U.length}if(H&6){S=Q(vt(T[1],T[2]));let L;for(L=0;L<S.length;L+=1){const M=wt(T,S,L);B[L]?B[L].p(M,H):(B[L]=Dt(M),B[L].c(),B[L].m(f,null))}for(;L<B.length;L+=1)B[L].d(1);B.length=S.length}},d(T){T&&(w(e),w(l),w(n),w(r),w(o),w(c),w(f),w(_),w(g)),ce(J,T),ce(q,T),ce(B,T),N=!1,$()}}}function Bl(t){let e,l,n,r,o,i,a=t[0]&&Lt(t);return{c(){e=h("button"),e.textContent="LTN 1/20 scoring guidance",l=A(),a&&a.c(),n=lt(),z(e,"class","secondary")},m(s,u){v(s,e,u),v(s,l,u),a&&a.m(s,u),v(s,n,u),r=!0,o||(i=W(e,"click",t[4]),o=!0)},p(s,[u]){s[0]?a?(a.p(s,u),u&1&&b(a,1)):(a=Lt(s),a.c(),b(a,1),a.m(n.parentNode,n)):a&&($e(),C(a,1,1,()=>{a=null}),ke())},i(s){r||(b(a),r=!0)},o(s){C(a),r=!1},d(s){s&&(w(e),w(l),w(n)),a&&a.d(s),o=!1,i()}}}function Jl(t,e,l){let n=!1,r=dt[0],o=tt(r)[0];function i(){l(2,o=tt(r)[0])}const a=[[],[]],s=()=>l(0,n=!0);function u(){r=this.__value,l(1,r)}function c(){o=this.__value,l(2,o)}return[n,r,o,i,s,u,a,c,()=>l(0,n=!1),()=>l(0,n=!1)]}class zl extends pe{constructor(e){super(),_e(this,e,Jl,Bl,ge,{})}}function qt(t,e,l){const n=t.slice();return n[11]=e[l][0],n[12]=e[l][1],n}function Pt(t){let e,l;return e=new zl({}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ot(t){let e,l,n,r=t[12]+"",o,i,a,s,u;return a=rt(t[7][0]),{c(){e=h("label"),l=h("input"),n=A(),o=Z(r),i=A(),z(l,"type","radio"),l.__value=t[11],de(l,l.__value),a.p(l)},m(c,f){v(c,e,f),d(e,l),l.checked=l.__value===t[3].jats[t[0]].properties[t[1]].movements[t[2]].score,d(e,n),d(e,o),d(e,i),s||(u=W(l,"change",t[9]),s=!0)},p(c,f){f&15&&(l.checked=l.__value===c[3].jats[c[0]].properties[c[1]].movements[c[2]].score)},d(c){c&&w(e),a.r(),s=!1,u()}}}function Rl(t){let e,l,n,r,o,i,a,s,u,c,f,p,m,_,g,N,$,j,J,U,q,S,B,T=t[3].jats[t[0]].properties[t[1]].movements[t[2]].kind=="cycling"&&Pt(),H=Q(t[4]),L=[];for(let M=0;M<H.length;M+=1)L[M]=Ot(qt(t,H,M));return q=rt(t[7][1]),{c(){e=h("label"),l=Z(`Name
  `),n=h("input"),r=A(),o=h("fieldset"),i=h("label"),a=h("input"),s=Z(`
    Cycling`),u=A(),c=h("label"),f=h("input"),p=Z(`
    Walking & Wheeling`),m=A(),T&&T.c(),_=A(),g=h("fieldset");for(let M=0;M<L.length;M+=1)L[M].c();N=A(),$=h("label"),j=Z(`Comments
  `),J=h("textarea"),z(n,"type","text"),z(a,"type","radio"),a.__value="cycling",de(a,a.__value),z(f,"type","radio"),f.__value="walking & wheeling",de(f,f.__value),q.p(a,f)},m(M,k){v(M,e,k),d(e,l),d(e,n),de(n,t[3].jats[t[0]].properties[t[1]].movements[t[2]].name),v(M,r,k),v(M,o,k),d(o,i),d(i,a),a.checked=a.__value===t[3].jats[t[0]].properties[t[1]].movements[t[2]].kind,d(i,s),d(o,u),d(o,c),d(c,f),f.checked=f.__value===t[3].jats[t[0]].properties[t[1]].movements[t[2]].kind,d(c,p),v(M,m,k),T&&T.m(M,k),v(M,_,k),v(M,g,k);for(let X=0;X<L.length;X+=1)L[X]&&L[X].m(g,null);v(M,N,k),v(M,$,k),d($,j),d($,J),de(J,t[3].jats[t[0]].properties[t[1]].movements[t[2]].notes),U=!0,S||(B=[W(n,"input",t[5]),W(a,"change",t[6]),W(f,"change",t[8]),W(J,"input",t[10])],S=!0)},p(M,[k]){if(k&15&&n.value!==M[3].jats[M[0]].properties[M[1]].movements[M[2]].name&&de(n,M[3].jats[M[0]].properties[M[1]].movements[M[2]].name),k&15&&(a.checked=a.__value===M[3].jats[M[0]].properties[M[1]].movements[M[2]].kind),k&15&&(f.checked=f.__value===M[3].jats[M[0]].properties[M[1]].movements[M[2]].kind),M[3].jats[M[0]].properties[M[1]].movements[M[2]].kind=="cycling"?T?k&15&&b(T,1):(T=Pt(),T.c(),b(T,1),T.m(_.parentNode,_)):T&&($e(),C(T,1,1,()=>{T=null}),ke()),k&31){H=Q(M[4]);let X;for(X=0;X<H.length;X+=1){const y=qt(M,H,X);L[X]?L[X].p(y,k):(L[X]=Ot(y),L[X].c(),L[X].m(g,null))}for(;X<L.length;X+=1)L[X].d(1);L.length=H.length}k&15&&de(J,M[3].jats[M[0]].properties[M[1]].movements[M[2]].notes)},i(M){U||(b(T),U=!0)},o(M){C(T),U=!1},d(M){M&&(w(e),w(r),w(o),w(m),w(_),w(g),w(N),w($)),T&&T.d(M),ce(L,M),q.r(),S=!1,Se(B)}}}function Hl(t,e,l){let n;oe(t,V,_=>l(3,n=_));let{junctionIdx:r}=e,{stage:o}=e,{idx:i}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];const s=[[],[]];function u(){n.jats[r].properties[o].movements[i].name=this.value,V.set(n)}function c(){n.jats[r].properties[o].movements[i].kind=this.__value,V.set(n)}function f(){n.jats[r].properties[o].movements[i].kind=this.__value,V.set(n)}function p(){n.jats[r].properties[o].movements[i].score=this.__value,V.set(n)}function m(){n.jats[r].properties[o].movements[i].notes=this.value,V.set(n)}return t.$$set=_=>{"junctionIdx"in _&&l(0,r=_.junctionIdx),"stage"in _&&l(1,o=_.stage),"idx"in _&&l(2,i=_.idx)},[r,o,i,n,a,u,c,s,f,p,m]}class Gl extends pe{constructor(e){super(),_e(this,e,Hl,Rl,ge,{junctionIdx:0,stage:1,idx:2})}}function Ul(t){return t%(2*Math.PI)*180/Math.PI}function Qe(t){return t%360*Math.PI/180}function Ft(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function qn(t,e,l={}){if(l.final===!0)return Zl(t,e);const n=Ft(t),r=Ft(e),o=Qe(n[0]),i=Qe(r[0]),a=Qe(n[1]),s=Qe(r[1]),u=Math.sin(i-o)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-o);return Ul(Math.atan2(u,c))}function Zl(t,e){let l=qn(e,t);return l=(l+180)%360,l}var Fe=qn;function Kl(t,e,l={}){const n={type:"Feature"};return(l.id===0||l.id)&&(n.id=l.id),l.bbox&&(n.bbox=l.bbox),n.properties=e||{},n.geometry=t,n}function Xl(t,e,l={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Bt(t[0])||!Bt(t[1]))throw new Error("coordinates must contain numbers");return Kl({type:"Point",coordinates:t},e,l)}function Bt(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Wl(t,e={}){const l=Zn(t),n=(l[0]+l[2])/2,r=(l[1]+l[3])/2;return Xl([n,r],e.properties,e)}var Vl=Wl,we=63710088e-1,Ql={centimeters:we*100,centimetres:we*100,degrees:360/(2*Math.PI),feet:we*3.28084,inches:we*39.37,kilometers:we/1e3,kilometres:we/1e3,meters:we,metres:we,miles:we/1609.344,millimeters:we*1e3,millimetres:we*1e3,nauticalmiles:we/1852,radians:1,yards:we*1.0936};function Yl(t,e,l={}){const n={type:"Feature"};return(l.id===0||l.id)&&(n.id=l.id),l.bbox&&(n.bbox=l.bbox),n.properties=e||{},n.geometry=t,n}function xl(t,e,l={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!zt(t[0])||!zt(t[1]))throw new Error("coordinates must contain numbers");return Yl({type:"Point",coordinates:t},e,l)}function er(t,e="kilometers"){const l=Ql[e];if(!l)throw new Error(e+" units is invalid");return t/l}function Jt(t){return t%(2*Math.PI)*180/Math.PI}function ct(t){return t%360*Math.PI/180}function zt(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function tr(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function nr(t,e,l,n={}){const r=tr(t),o=ct(r[0]),i=ct(r[1]),a=ct(l),s=er(e,n.units),u=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(u)),f=Jt(c),p=Jt(u);return xl([f,p],n.properties)}var Xe=nr,ye=63710088e-1,lr={centimeters:ye*100,centimetres:ye*100,degrees:360/(2*Math.PI),feet:ye*3.28084,inches:ye*39.37,kilometers:ye/1e3,kilometres:ye/1e3,meters:ye,metres:ye,miles:ye/1609.344,millimeters:ye*1e3,millimetres:ye*1e3,nauticalmiles:ye/1852,radians:1,yards:ye*1.0936};function rr(t,e="kilometers"){const l=lr[e];if(!l)throw new Error(e+" units is invalid");return t*l}function Ye(t){return t%360*Math.PI/180}function Rt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function or(t,e,l={}){var n=Rt(t),r=Rt(e),o=Ye(r[1]-n[1]),i=Ye(r[0]-n[0]),a=Ye(n[1]),s=Ye(r[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return rr(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),l.units)}var ir=or;function sr(t){let e=Vl({type:"FeatureCollection",features:t.map(n=>({type:"Feature",geometry:{type:"Point",coordinates:n.point},properties:{}}))}).geometry.coordinates;t.sort((n,r)=>Ht(Fe(e,r.point))-Ht(Fe(e,n.point)));let l=[];for(let n=0;n<t.length;n++){let r=t[n],o=Fe(r.point,e),i=1;for(let a of cr(n,t.length)){let s=t[a],u=Fe(e,s.point),c=ar(r.point,e,i++),f=ir(r.point,e),p=Xe(c,.5*f,o).geometry.coordinates,m=Xe(p,.2*f,u).geometry.coordinates;l.push({point1:c,point2:p,point3:m,kind:"cycling",score:"X",name:`${r.name} to ${s.name}`,notes:""})}}return l}function ar(t,e,l){let n=.003,o=Fe(t,e)-90,i=n*l;return Xe(t,i,o).geometry.coordinates}function Ht(t){return(t+360)%360}function cr(t,e){let l=[];for(let n=t+1;n<e;n++)l.push(n);for(let n=0;n<t;n++)l.push(n);return l}const ur="/route-element/assets/movement-aa45473c.svg",fr="/route-element/assets/pan-fbcec4cd.svg";function Gt(t,e,l){const n=t.slice();return n[31]=e[l],n[32]=e,n[33]=l,n}function Ut(t,e,l){const n=t.slice();return n[34]=e[l],n[35]=e,n[33]=l,n}function Zt(t){let e,l,n,r,o,i,a,s,u,c,f,p,m,_,g,N,$,j,J;function U(X,y){return X[0].mode=="select"?dr:mr}let q=U(t),S=q(t);function B(X,y){return X[0].mode=="new-arm"?_r:pr}let T=B(t),H=T(t);function L(X,y){return X[0].mode=="new-movement"?hr:gr}let M=L(t),k=M(t);return{c(){e=h("div"),l=h("button"),n=h("img"),o=A(),S.c(),i=A(),a=h("button"),s=at("svg"),u=at("circle"),c=at("text"),f=Z("A"),p=A(),H.c(),m=A(),_=h("button"),g=h("img"),$=A(),k.c(),ut(n.src,r=fr)||z(n,"src",r),z(n,"alt","Move map"),ee(n,"vertical-align","middle"),z(l,"class","outline"),z(u,"cx","12"),z(u,"cy","12"),z(u,"r","12"),z(u,"fill","white"),z(c,"x","6"),z(c,"y","16"),z(c,"fill","#4472c4"),z(s,"width","24"),z(s,"height","24"),z(s,"xmlns","http://www.w3.org/2000/svg"),ee(s,"vertical-align","middle"),z(a,"class","outline"),ut(g.src,N=ur)||z(g,"src",N),z(g,"alt","New movement"),ee(g,"vertical-align","middle"),z(_,"class","outline"),z(e,"class","control-panel svelte-l1e6xi")},m(X,y){v(X,e,y),d(e,l),d(l,n),d(l,o),S.m(l,null),d(e,i),d(e,a),d(a,s),d(s,u),d(s,c),d(c,f),d(a,p),H.m(a,null),d(e,m),d(e,_),d(_,g),d(_,$),k.m(_,null),j||(J=[W(l,"click",function(){Kn(t[4])&&t[4].apply(this,arguments)}),W(a,"click",t[12]),W(_,"click",t[13])],j=!0)},p(X,y){t=X,q!==(q=U(t))&&(S.d(1),S=q(t),S&&(S.c(),S.m(l,null))),T!==(T=B(t))&&(H.d(1),H=T(t),H&&(H.c(),H.m(a,null))),M!==(M=L(t))&&(k.d(1),k=M(t),k&&(k.c(),k.m(_,null)))},d(X){X&&w(e),S.d(),H.d(),k.d(),j=!1,Se(J)}}}function mr(t){let e;return{c(){e=Z("Move map")},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function dr(t){let e;return{c(){e=h("b"),e.textContent="Move map"},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function pr(t){let e;return{c(){e=Z("New arm")},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function _r(t){let e;return{c(){e=h("b"),e.textContent="New arm"},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function gr(t){let e;return{c(){e=Z("New movement")},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function hr(t){let e;return{c(){e=h("b"),e.textContent="New movement"},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function $r(t){let e;return{c(){e=h("span"),e.textContent=`${Mr(t[33])}`,z(e,"class","dot svelte-l1e6xi"),ee(e,"color","#4472c4"),ee(e,"background-color","white")},m(l,n){v(l,e,n)},p:re,d(l){l&&w(e)}}}function Kt(t){let e,l,n;function r(s){t[14](s,t[34])}function o(){return t[15](t[33])}function i(){return t[16](t[33])}let a={draggable:!0,$$slots:{default:[$r]},$$scope:{ctx:t}};return t[34].point!==void 0&&(a.lngLat=t[34].point),e=new Pe({props:a}),be.push(()=>Me(e,"lngLat",r)),e.$on("dragend",o),e.$on("click",i),{c(){P(e.$$.fragment)},m(s,u){O(e,s,u),n=!0},p(s,u){t=s;const c={};u[1]&32&&(c.$$scope={dirty:u,ctx:t}),!l&&u[0]&38&&(l=!0,c.lngLat=t[34].point,Ie(()=>l=!1)),e.$set(c)},i(s){n||(b(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){F(e,s)}}}function kr(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-l1e6xi"),ee(e,"background-color",t[7][t[31].score]),ee(e,"opacity",t[31].kind=="walking & wheeling"?"0%":"100%")},m(l,n){v(l,e,n)},p(l,n){n[0]&38&&ee(e,"background-color",l[7][l[31].score]),n[0]&38&&ee(e,"opacity",l[31].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&w(e)}}}function br(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-l1e6xi"),ee(e,"background-color",t[7][t[31].score])},m(l,n){v(l,e,n)},p(l,n){n[0]&38&&ee(e,"background-color",l[7][l[31].score])},d(l){l&&w(e)}}}function vr(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-l1e6xi"),ee(e,"background-color",t[7][t[31].score]),ee(e,"opacity","0%")},m(l,n){v(l,e,n)},p(l,n){n[0]&38&&ee(e,"background-color",l[7][l[31].score])},d(l){l&&w(e)}}}function Xt(t){let e,l,n,r,o,i,a,s,u;function c(S){t[17](S,t[31])}function f(){return t[18](t[33])}function p(){return t[19](t[33])}let m={draggable:!0,$$slots:{default:[kr]},$$scope:{ctx:t}};t[31].point1!==void 0&&(m.lngLat=t[31].point1),e=new Pe({props:m}),be.push(()=>Me(e,"lngLat",c)),e.$on("dragend",f),e.$on("click",p);function _(S){t[20](S,t[31])}function g(){return t[21](t[33])}function N(){return t[22](t[33])}let $={draggable:!0,$$slots:{default:[br]},$$scope:{ctx:t}};t[31].point2!==void 0&&($.lngLat=t[31].point2),r=new Pe({props:$}),be.push(()=>Me(r,"lngLat",_)),r.$on("dragend",g),r.$on("click",N);function j(S){t[23](S,t[31])}function J(){return t[24](t[33])}function U(){return t[25](t[33])}let q={draggable:!0,$$slots:{default:[vr]},$$scope:{ctx:t}};return t[31].point3!==void 0&&(q.lngLat=t[31].point3),a=new Pe({props:q}),be.push(()=>Me(a,"lngLat",j)),a.$on("dragend",J),a.$on("click",U),{c(){P(e.$$.fragment),n=A(),P(r.$$.fragment),i=A(),P(a.$$.fragment)},m(S,B){O(e,S,B),v(S,n,B),O(r,S,B),v(S,i,B),O(a,S,B),u=!0},p(S,B){t=S;const T={};B[0]&38|B[1]&32&&(T.$$scope={dirty:B,ctx:t}),!l&&B[0]&38&&(l=!0,T.lngLat=t[31].point1,Ie(()=>l=!1)),e.$set(T);const H={};B[0]&38|B[1]&32&&(H.$$scope={dirty:B,ctx:t}),!o&&B[0]&38&&(o=!0,H.lngLat=t[31].point2,Ie(()=>o=!1)),r.$set(H);const L={};B[0]&38|B[1]&32&&(L.$$scope={dirty:B,ctx:t}),!s&&B[0]&38&&(s=!0,L.lngLat=t[31].point3,Ie(()=>s=!1)),a.$set(L)},i(S){u||(b(e.$$.fragment,S),b(r.$$.fragment,S),b(a.$$.fragment,S),u=!0)},o(S){C(e.$$.fragment,S),C(r.$$.fragment,S),C(a.$$.fragment,S),u=!1},d(S){S&&(w(n),w(i)),F(e,S),F(r,S),F(a,S)}}}function wr(t){let e=(t[30].name||"Untitled movement")+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r[0]&1073741824&&e!==(e=(n[30].name||"Untitled movement")+"")&&ie(l,e)},d(n){n&&w(l)}}}function yr(t){let e,l;return e=new Tn({props:{$$slots:{default:[wr,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function jr(t){let e=(t[30].name||"Untitled movement")+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r[0]&1073741824&&e!==(e=(n[30].name||"Untitled movement")+"")&&ie(l,e)},d(n){n&&w(l)}}}function Cr(t){let e,l;return e=new Tn({props:{$$slots:{default:[jr,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r[0]&1073741824|r[1]&32&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ar(t){let e,l,n,r,o,i;return e=new He({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Ke(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[yr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),n=new He({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Ke(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Cr]},$$scope:{ctx:t}}}),n.$on("click",t[9]),o=new ll({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){P(e.$$.fragment),l=A(),P(n.$$.fragment),r=A(),P(o.$$.fragment)},m(a,s){O(e,a,s),v(a,l,s),O(n,a,s),v(a,r,s),O(o,a,s),i=!0},p(a,s){const u={};s[1]&32&&(u.$$scope={dirty:s,ctx:a}),e.$set(u);const c={};s[1]&32&&(c.$$scope={dirty:s,ctx:a}),n.$set(c)},i(a){i||(b(e.$$.fragment,a),b(n.$$.fragment,a),b(o.$$.fragment,a),i=!0)},o(a){C(e.$$.fragment,a),C(n.$$.fragment,a),C(o.$$.fragment,a),i=!1},d(a){a&&(w(l),w(r)),F(e,a),F(n,a),F(o,a)}}}function Sr(t){let e,l,n,r;return e=new He({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),n=new Ee({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){P(e.$$.fragment),l=A(),P(n.$$.fragment)},m(o,i){O(e,o,i),v(o,l,i),O(n,o,i),r=!0},p:re,i(o){r||(b(e.$$.fragment,o),b(n.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),C(n.$$.fragment,o),r=!1},d(o){o&&w(l),F(e,o),F(n,o)}}}function Lr(t){let e,l,n,r,o,i,a,s,u;e=new Nn({}),e.$on("click",t[8]);let c=t[0].mode!="editing"&&Zt(t),f=Q(t[5].jats[t[1]].properties[t[2]].arms),p=[];for(let $=0;$<f.length;$+=1)p[$]=Kt(Ut(t,f,$));const m=$=>C(p[$],1,1,()=>{p[$]=null});let _=Q(t[5].jats[t[1]].properties[t[2]].movements),g=[];for(let $=0;$<_.length;$+=1)g[$]=Xt(Gt(t,_,$));const N=$=>C(g[$],1,1,()=>{g[$]=null});return i=new Ae({props:{data:t[10](t[5]),$$slots:{default:[Ar]},$$scope:{ctx:t}}}),s=new Ae({props:{data:t[6],$$slots:{default:[Sr]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment),l=A(),c&&c.c(),n=A();for(let $=0;$<p.length;$+=1)p[$].c();r=A();for(let $=0;$<g.length;$+=1)g[$].c();o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment)},m($,j){O(e,$,j),v($,l,j),c&&c.m($,j),v($,n,j);for(let J=0;J<p.length;J+=1)p[J]&&p[J].m($,j);v($,r,j);for(let J=0;J<g.length;J+=1)g[J]&&g[J].m($,j);v($,o,j),O(i,$,j),v($,a,j),O(s,$,j),u=!0},p($,j){if($[0].mode!="editing"?c?c.p($,j):(c=Zt($),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null),j[0]&46){f=Q($[5].jats[$[1]].properties[$[2]].arms);let q;for(q=0;q<f.length;q+=1){const S=Ut($,f,q);p[q]?(p[q].p(S,j),b(p[q],1)):(p[q]=Kt(S),p[q].c(),b(p[q],1),p[q].m(r.parentNode,r))}for($e(),q=f.length;q<p.length;q+=1)m(q);ke()}if(j[0]&174){_=Q($[5].jats[$[1]].properties[$[2]].movements);let q;for(q=0;q<_.length;q+=1){const S=Gt($,_,q);g[q]?(g[q].p(S,j),b(g[q],1)):(g[q]=Xt(S),g[q].c(),b(g[q],1),g[q].m(o.parentNode,o))}for($e(),q=_.length;q<g.length;q+=1)N(q);ke()}const J={};j[0]&32&&(J.data=$[10]($[5])),j[1]&32&&(J.$$scope={dirty:j,ctx:$}),i.$set(J);const U={};j[0]&64&&(U.data=$[6]),j[1]&32&&(U.$$scope={dirty:j,ctx:$}),s.$set(U)},i($){if(!u){b(e.$$.fragment,$);for(let j=0;j<f.length;j+=1)b(p[j]);for(let j=0;j<_.length;j+=1)b(g[j]);b(i.$$.fragment,$),b(s.$$.fragment,$),u=!0}},o($){C(e.$$.fragment,$),p=p.filter(Boolean);for(let j=0;j<p.length;j+=1)C(p[j]);g=g.filter(Boolean);for(let j=0;j<g.length;j+=1)C(g[j]);C(i.$$.fragment,$),C(s.$$.fragment,$),u=!1},d($){$&&(w(l),w(n),w(r),w(o),w(a)),F(e,$),c&&c.d($),ce(p,$),ce(g,$),F(i,$),F(s,$)}}}function Tr(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Mr(t){return String.fromCharCode(t+"A".charCodeAt(0))}function Ir(t,e,l){let n,r,o;oe(t,V,D=>l(5,r=D)),oe(t,et,D=>l(26,o=D));let{junctionIdx:i}=e,{stage:a}=e,{mode:s}=e,{hoveringSidebar:u}=e,{select:c}=e,{stopEditing:f}=e,p={0:Ne.red.background,1:Ne.amber.background,2:Ne.green.background,X:Ne.critical.background};function m(D,K,ne){let se={type:"FeatureCollection",features:[]},I=K.mode=="editing"?K.id:ne;return I!=null&&(I.kind=="arm"?se.features.push(Tr(D.jats[i].properties[a].arms[I.idx],I.idx)):se.features.push($(D.jats[i].properties[a].movements[I.idx],I.idx))),se}async function _(D){if(o){for(let K of o.queryRenderedFeatures(D.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s.mode!="select"){if(s.mode=="editing"){await f();return}s.mode=="new-arm"?(te(V,r.jats[i].properties[a].arms=[...r.jats[i].properties[a].arms,{point:D.detail.lngLat.toArray(),name:""}],r),await c({kind:"arm",idx:r.jats[i].properties[a].arms.length-1})):(te(V,r.jats[i].properties[a].movements=[...r.jats[i].properties[a].movements,{point1:D.detail.lngLat.toArray(),point2:Xe(D.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Xe(D.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],r),await c({kind:"movement",idx:r.jats[i].properties[a].movements.length-1}))}}}async function g(D){await c({kind:"movement",idx:D.detail.features[0].id})}function N(D){let K={type:"FeatureCollection",features:D.jats[i].properties[a].movements.map((ne,se)=>$(ne,se))};for(let ne of D.jats[i].properties[a].movements)if(K.features.push(j(ne,K.features.length)),ne.kind=="walking & wheeling"){let se={...ne,point1:ne.point3,point3:ne.point1};K.features.push(j(se,K.features.length))}return K}function $(D,K){return{type:"Feature",id:K,properties:{name:D.name,kind:D.kind,color:p[D.score]},geometry:{type:"LineString",coordinates:[D.point1,D.point2,D.point3]}}}function j(D,K){return{type:"Feature",id:K,properties:{kind:D.kind,color:p[D.score],angle:Fe(D.point2,D.point3)},geometry:{type:"Point",coordinates:D.point3}}}const J=()=>l(0,s={mode:"new-arm"}),U=()=>l(0,s={mode:"new-movement"});function q(D,K){t.$$.not_equal(K.point,D)&&(K.point=D,V.set(r))}const S=D=>c({kind:"arm",idx:D}),B=D=>c({kind:"arm",idx:D});function T(D,K){t.$$.not_equal(K.point1,D)&&(K.point1=D,V.set(r))}const H=D=>c({kind:"movement",idx:D}),L=D=>c({kind:"movement",idx:D});function M(D,K){t.$$.not_equal(K.point2,D)&&(K.point2=D,V.set(r))}const k=D=>c({kind:"movement",idx:D}),X=D=>c({kind:"movement",idx:D});function y(D,K){t.$$.not_equal(K.point3,D)&&(K.point3=D,V.set(r))}const ue=D=>c({kind:"movement",idx:D}),ae=D=>c({kind:"movement",idx:D});return t.$$set=D=>{"junctionIdx"in D&&l(1,i=D.junctionIdx),"stage"in D&&l(2,a=D.stage),"mode"in D&&l(0,s=D.mode),"hoveringSidebar"in D&&l(11,u=D.hoveringSidebar),"select"in D&&l(3,c=D.select),"stopEditing"in D&&l(4,f=D.stopEditing)},t.$$.update=()=>{t.$$.dirty[0]&2081&&l(6,n=m(r,s,u))},[s,i,a,c,f,r,n,p,_,g,N,u,J,U,q,S,B,T,H,L,M,k,X,y,ue,ae]}class Nr extends pe{constructor(e){super(),_e(this,e,Ir,Lr,ge,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function Wt(t){if(t.movements.length==0)return"No movements added";let e=0,l=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],l+=2;let n=e/l*100;return`${Math.round(n)}%`}const{window:Er}=nt;function Vt(t,e,l){const n=t.slice();n[27]=e[l],n[30]=l;const r=n[14][n[27].score];return n[28]=r,n}function Qt(t,e,l){const n=t.slice();return n[31]=e[l],n[30]=l,n}function Dr(t){let e,l,n,r,o,i,a,s,u;return{c(){e=h("button"),e.textContent="Done",l=A(),n=h("button"),n.textContent="Delete",r=A(),o=h("label"),i=Z(`Arm name
        `),a=h("input"),z(a,"type","text")},m(c,f){v(c,e,f),v(c,l,f),v(c,n,f),v(c,r,f),v(c,o,f),d(o,i),d(o,a),de(a,t[5].jats[t[0]].properties[t[1]].arms[t[2].id.idx].name),s||(u=[W(e,"click",t[23]),W(n,"click",t[10]),W(a,"input",t[24])],s=!0)},p(c,f){f[0]&39&&a.value!==c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name&&de(a,c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name)},i:re,o:re,d(c){c&&(w(e),w(l),w(n),w(r),w(o)),s=!1,Se(u)}}}function qr(t){let e,l,n,r,o,i,a,s;return e=new Gl({props:{junctionIdx:t[0],stage:t[1],idx:t[2].id.idx}}),{c(){P(e.$$.fragment),l=A(),n=h("button"),n.textContent="Save",r=A(),o=h("button"),o.textContent="Delete"},m(u,c){O(e,u,c),v(u,l,c),v(u,n,c),v(u,r,c),v(u,o,c),i=!0,a||(s=[W(n,"click",t[9]),W(o,"click",t[10])],a=!0)},p(u,c){const f={};c[0]&1&&(f.junctionIdx=u[0]),c[0]&2&&(f.stage=u[1]),c[0]&4&&(f.idx=u[2].id.idx),e.$set(f)},i(u){i||(b(e.$$.fragment,u),i=!0)},o(u){C(e.$$.fragment,u),i=!1},d(u){u&&(w(l),w(n),w(r),w(o)),F(e,u),a=!1,Se(s)}}}function Pr(t){let e,l,n,r,o,i,a,s,u,c,f,p,m,_=t[5].jats[t[0]].properties.name+"",g,N,$=Wt(t[5].jats[t[0]].properties[t[1]])+"",j,J,U,q,S,B,T,H,L,M,k,X=Q(t[5].jats[t[0]].properties[t[1]].arms),y=[];for(let I=0;I<X.length;I+=1)y[I]=Yt(Qt(t,X,I));const ue=I=>C(y[I],1,1,()=>{y[I]=null});let ae=t[5].jats[t[0]].properties[t[7]].arms.length>0&&xt(t),D=Q(t[5].jats[t[0]].properties[t[1]].movements),K=[];for(let I=0;I<D.length;I+=1)K[I]=en(Vt(t,D,I));const ne=I=>C(K[I],1,1,()=>{K[I]=null});let se=t[5].jats[t[0]].properties[t[7]].movements.length>0&&tn(t);return{c(){e=h("button"),e.textContent="Done",l=A(),n=h("h3"),n.textContent="Arms",r=A();for(let I=0;I<y.length;I+=1)y[I].c();o=A(),ae&&ae.c(),i=A(),a=h("h3"),a.textContent="Movements",s=A(),u=h("p"),c=Z("Total JAT score for "),f=Z(t[1]),p=Z(` junction
        `),m=h("i"),g=Z(_),N=Z(`
        : `),j=Z($),J=A(),U=h("button"),q=Z("Generate cycling movements between all arms"),B=A();for(let I=0;I<K.length;I+=1)K[I].c();T=A(),se&&se.c(),H=lt(),z(U,"class","secondary"),U.disabled=S=t[5].jats[t[0]].properties[t[1]].arms.length<2},m(I,R){v(I,e,R),v(I,l,R),v(I,n,R),v(I,r,R);for(let Y=0;Y<y.length;Y+=1)y[Y]&&y[Y].m(I,R);v(I,o,R),ae&&ae.m(I,R),v(I,i,R),v(I,a,R),v(I,s,R),v(I,u,R),d(u,c),d(u,f),d(u,p),d(u,m),d(m,g),d(u,N),d(u,j),v(I,J,R),v(I,U,R),d(U,q),v(I,B,R);for(let Y=0;Y<K.length;Y+=1)K[Y]&&K[Y].m(I,R);v(I,T,R),se&&se.m(I,R),v(I,H,R),L=!0,M||(k=[W(e,"click",t[16]),W(U,"click",t[15])],M=!0)},p(I,R){if(R[0]&299){X=Q(I[5].jats[I[0]].properties[I[1]].arms);let Y;for(Y=0;Y<X.length;Y+=1){const ve=Qt(I,X,Y);y[Y]?(y[Y].p(ve,R),b(y[Y],1)):(y[Y]=Yt(ve),y[Y].c(),b(y[Y],1),y[Y].m(o.parentNode,o))}for($e(),Y=X.length;Y<y.length;Y+=1)ue(Y);ke()}if(I[5].jats[I[0]].properties[I[7]].arms.length>0?ae?ae.p(I,R):(ae=xt(I),ae.c(),ae.m(i.parentNode,i)):ae&&(ae.d(1),ae=null),(!L||R[0]&2)&&ie(f,I[1]),(!L||R[0]&33)&&_!==(_=I[5].jats[I[0]].properties.name+"")&&ie(g,_),(!L||R[0]&35)&&$!==($=Wt(I[5].jats[I[0]].properties[I[1]])+"")&&ie(j,$),(!L||R[0]&35&&S!==(S=I[5].jats[I[0]].properties[I[1]].arms.length<2))&&(U.disabled=S),R[0]&16683){D=Q(I[5].jats[I[0]].properties[I[1]].movements);let Y;for(Y=0;Y<D.length;Y+=1){const ve=Vt(I,D,Y);K[Y]?(K[Y].p(ve,R),b(K[Y],1)):(K[Y]=en(ve),K[Y].c(),b(K[Y],1),K[Y].m(T.parentNode,T))}for($e(),Y=D.length;Y<K.length;Y+=1)ne(Y);ke()}I[5].jats[I[0]].properties[I[7]].movements.length>0?se?se.p(I,R):(se=tn(I),se.c(),se.m(H.parentNode,H)):se&&(se.d(1),se=null)},i(I){if(!L){for(let R=0;R<X.length;R+=1)b(y[R]);for(let R=0;R<D.length;R+=1)b(K[R]);L=!0}},o(I){y=y.filter(Boolean);for(let R=0;R<y.length;R+=1)C(y[R]);K=K.filter(Boolean);for(let R=0;R<K.length;R+=1)C(K[R]);L=!1},d(I){I&&(w(e),w(l),w(n),w(r),w(o),w(i),w(a),w(s),w(u),w(J),w(U),w(B),w(T),w(H)),ce(y,I),ae&&ae.d(I),ce(K,I),se&&se.d(I),M=!1,Se(k)}}}function Yt(t){let e,l;function n(){return t[17](t[30])}function r(){return t[18](t[30])}return e=new En({props:{name:`${nn(t[30])} - ${t[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",n),e.$on("mouseenter",r),e.$on("mouseleave",t[19]),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0},p(o,i){t=o;const a={};i[0]&35&&(a.name=`${nn(t[30])} - ${t[31].name||"Unnamed arm"}`),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o)}}}function xt(t){let e,l,n;return{c(){e=h("button"),e.textContent=`Copy arms from ${t[7]}`,z(e,"class","secondary")},m(r,o){v(r,e,o),l||(n=W(e,"click",t[12]),l=!0)},p:re,d(r){r&&w(e),l=!1,n()}}}function Or(t){let e,l,n,r=t[27].score+"",o,i,a,s=ln(t[27].kind)+"",u;return{c(){e=h("div"),l=h("span"),n=Z("Score: "),o=Z(r),i=A(),a=h("span"),u=Z(s),ee(l,"padding","4px"),ee(l,"color",t[28].font),ee(l,"background-color",t[28].background),ee(e,"width","100%"),ee(e,"display","flex"),ee(e,"justify-content","space-between")},m(c,f){v(c,e,f),d(e,l),d(l,n),d(l,o),d(e,i),d(e,a),d(a,u)},p(c,f){f[0]&35&&r!==(r=c[27].score+"")&&ie(o,r),f[0]&35&&ee(l,"color",c[28].font),f[0]&35&&ee(l,"background-color",c[28].background),f[0]&35&&s!==(s=ln(c[27].kind)+"")&&ie(u,s)},d(c){c&&w(e)}}}function en(t){let e,l;function n(){return t[20](t[30])}function r(){return t[21](t[30])}return e=new En({props:{name:t[27].name||"Unnamed movement",$$slots:{default:[Or]},$$scope:{ctx:t}}}),e.$on("click",n),e.$on("mouseenter",r),e.$on("mouseleave",t[22]),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0},p(o,i){t=o;const a={};i[0]&35&&(a.name=t[27].name||"Unnamed movement"),i[0]&35|i[1]&4&&(a.$$scope={dirty:i,ctx:t}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o)}}}function tn(t){let e,l,n;return{c(){e=h("button"),e.textContent=`Copy movements from ${t[7]}`,z(e,"class","secondary")},m(r,o){v(r,e,o),l||(n=W(e,"click",t[13]),l=!0)},p:re,d(r){r&&w(e),l=!1,n()}}}function Fr(t){let e,l,n,r,o=t[5].jats[t[0]].properties.name+"",i,a,s,u,c;const f=[Pr,qr,Dr],p=[];function m(_,g){return _[2].mode!="editing"?0:_[2].id.kind=="movement"?1:2}return s=m(t),u=p[s]=f[s](t),{c(){e=h("div"),l=h("h2"),n=Z(t[1]),r=Z(" JAT for "),i=Z(o),a=A(),u.c(),z(e,"slot","sidebar")},m(_,g){v(_,e,g),d(e,l),d(l,n),d(l,r),d(l,i),d(e,a),p[s].m(e,null),t[25](e),c=!0},p(_,g){(!c||g[0]&2)&&ie(n,_[1]),(!c||g[0]&33)&&o!==(o=_[5].jats[_[0]].properties.name+"")&&ie(i,o);let N=s;s=m(_),s===N?p[s].p(_,g):($e(),C(p[N],1,1,()=>{p[N]=null}),ke(),u=p[s],u?u.p(_,g):(u=p[s]=f[s](_),u.c()),b(u,1),u.m(e,null))},i(_){c||(b(u),c=!0)},o(_){C(u),c=!1},d(_){_&&w(e),p[s].d(),t[25](null)}}}function Br(t){let e,l;return e=new Ee({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r[0]&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Jr(t){let e,l,n,r,o,i,a,s,u;return l=new ot({}),r=new it({}),i=new Ae({props:{data:he(t[5].jats),generateId:!0,$$slots:{default:[Br]},$$scope:{ctx:t}}}),s=new Nr({props:{junctionIdx:t[0],stage:t[1],mode:t[2],hoveringSidebar:t[3],select:t[8],stopEditing:t[9]}}),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment),z(e,"slot","map")},m(c,f){v(c,e,f),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),d(e,a),O(s,e,null),u=!0},p(c,f){const p={};f[0]&32&&(p.data=he(c[5].jats)),f[0]&1|f[1]&4&&(p.$$scope={dirty:f,ctx:c}),i.$set(p);const m={};f[0]&1&&(m.junctionIdx=c[0]),f[0]&2&&(m.stage=c[1]),f[0]&4&&(m.mode=c[2]),f[0]&8&&(m.hoveringSidebar=c[3]),s.$set(m)},i(c){u||(b(l.$$.fragment,c),b(r.$$.fragment,c),b(i.$$.fragment,c),b(s.$$.fragment,c),u=!0)},o(c){C(l.$$.fragment,c),C(r.$$.fragment,c),C(i.$$.fragment,c),C(s.$$.fragment,c),u=!1},d(c){c&&w(e),F(l),F(r),F(i),F(s)}}}function zr(t){let e,l,n,r;return e=new Ue({props:{$$slots:{map:[Jr],sidebar:[Fr]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W(Er,"keydown",t[11]),n=!0)},p(o,i){const a={};i[0]&127|i[1]&4&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function nn(t){return String.fromCharCode(t+"A".charCodeAt(0))}function ln(t){return t.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function Rr(t,e,l){let n,r;oe(t,V,y=>l(5,n=y)),oe(t,le,y=>l(6,r=y));let{junctionIdx:o}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s={mode:"select"},u=null,c=null,f;async function p(y){u=f.scrollTop,l(2,s={mode:"editing",id:y}),l(3,c=null),await Ze(),l(4,f.scrollTop=0,f)}async function m(){l(2,s={mode:"select"}),u!=null&&(await Ze(),l(4,f.scrollTop=u,f),u=null)}function _(){s.mode=="editing"&&window.confirm(`Delete this ${s.id.kind}?`)&&(s.id.kind=="movement"?(n.jats[o].properties[i].movements.splice(s.id.idx,1),V.set(n)):(n.jats[o].properties[i].arms.splice(s.id.idx,1),V.set(n)),m())}function g(y){if(s.mode!="editing")return;let ue=y.target.tagName,ae=ue=="INPUT"||ue=="TEXTAREA";y.key=="Escape"||y.key=="Enter"&&!ae?(y.stopPropagation(),m()):y.key=="Delete"&&!ae&&(y.stopPropagation(),_())}function N(){n.jats[o].properties[i].arms.length>0&&!window.confirm("Overwrite arms?")||(te(V,n.jats[o].properties[i].arms=JSON.parse(JSON.stringify(n.jats[o].properties[a].arms)),n),V.set(n))}function $(){n.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite movements?")||(te(V,n.jats[o].properties[i].movements=JSON.parse(JSON.stringify(n.jats[o].properties[a].movements)),n),V.set(n))}let j={0:Ne.red,1:Ne.amber,2:Ne.green,X:Ne.critical};function J(){if(n.jats[o].properties[i].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let y=n.jats[o].properties[i].movements.filter(ue=>ue.kind=="walking & wheeling");te(V,n.jats[o].properties[i].movements=[...y,...sr(n.jats[o].properties[i].arms)],n)}const U=()=>te(le,r={kind:"edit-jat",idx:o},r),q=y=>p({kind:"arm",idx:y}),S=y=>l(3,c={kind:"arm",idx:y}),B=()=>l(3,c=null),T=y=>p({kind:"movement",idx:y}),H=y=>l(3,c={kind:"movement",idx:y}),L=()=>l(3,c=null),M=()=>l(2,s={mode:"select"});function k(){n.jats[o].properties[i].arms[s.id.idx].name=this.value,V.set(n)}function X(y){be[y?"unshift":"push"](()=>{f=y,l(4,f)})}return t.$$set=y=>{"junctionIdx"in y&&l(0,o=y.junctionIdx),"stage"in y&&l(1,i=y.stage)},[o,i,s,c,f,n,r,a,p,m,_,g,N,$,j,J,U,q,S,B,T,H,L,M,k,X]}class Hr extends pe{constructor(e){super(),_e(this,e,Rr,zr,ge,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:Gr}=nt;function Ur(t){let e,l,n,r,o,i,a,s,u,c,f,p,m,_;return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=A(),r=h("button"),r.textContent="Delete JAT",o=A(),i=h("label"),a=Z(`Name:
      `),s=h("input"),u=A(),c=h("button"),c.textContent="Existing",f=A(),p=h("button"),p.textContent="Proposed",z(s,"type","text"),z(e,"slot","sidebar")},m(g,N){v(g,e,N),d(e,l),d(e,n),d(e,r),d(e,o),d(e,i),d(i,a),d(i,s),de(s,t[1].jats[t[0]].properties.name),d(e,u),d(e,c),d(e,f),d(e,p),m||(_=[W(l,"click",t[6]),W(r,"click",t[4]),W(s,"input",t[7]),W(c,"click",t[8]),W(p,"click",t[9])],m=!0)},p(g,N){N&3&&s.value!==g[1].jats[g[0]].properties.name&&de(s,g[1].jats[g[0]].properties.name)},d(g){g&&w(e),m=!1,Se(_)}}}function Zr(t){let e,l;return e=new Ee({props:{filter:["!=",["id"],t[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.filter=["!=",["id"],n[0]]),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Kr(t){let e;return{c(){e=h("span"),z(e,"class","dot svelte-114j1n1"),ee(e,"border-color",t[1].jats[t[0]].properties.color)},m(l,n){v(l,e,n)},p(l,n){n&3&&ee(e,"border-color",l[1].jats[l[0]].properties.color)},d(l){l&&w(e)}}}function Xr(t){let e,l,n,r,o,i,a,s,u,c;l=new ot({}),r=new it({}),i=new Ae({props:{data:he(t[1].jats),generateId:!0,$$slots:{default:[Zr]},$$scope:{ctx:t}}});function f(m){t[5](m)}let p={draggable:!0,$$slots:{default:[Kr]},$$scope:{ctx:t}};return t[1].jats[t[0]].geometry.coordinates!==void 0&&(p.lngLat=t[1].jats[t[0]].geometry.coordinates),s=new Pe({props:p}),be.push(()=>Me(s,"lngLat",f)),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment),z(e,"slot","map")},m(m,_){v(m,e,_),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),d(e,a),O(s,e,null),c=!0},p(m,_){const g={};_&2&&(g.data=he(m[1].jats)),_&1025&&(g.$$scope={dirty:_,ctx:m}),i.$set(g);const N={};_&1027&&(N.$$scope={dirty:_,ctx:m}),!u&&_&3&&(u=!0,N.lngLat=m[1].jats[m[0]].geometry.coordinates,Ie(()=>u=!1)),s.$set(N)},i(m){c||(b(l.$$.fragment,m),b(r.$$.fragment,m),b(i.$$.fragment,m),b(s.$$.fragment,m),c=!0)},o(m){C(l.$$.fragment,m),C(r.$$.fragment,m),C(i.$$.fragment,m),C(s.$$.fragment,m),c=!1},d(m){m&&w(e),F(l),F(r),F(i),F(s)}}}function Wr(t){let e,l,n,r;return e=new Ue({props:{$$slots:{map:[Xr],sidebar:[Ur]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W(Gr,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function Vr(t,e,l){let n,r;oe(t,V,m=>l(1,n=m)),oe(t,le,m=>l(2,r=m));let{idx:o}=e;function i(m){m.key=="Escape"&&te(le,r={kind:"neutral"},r)}async function a(){window.confirm("Really delete this JAT?")&&(te(le,r={kind:"neutral"},r),await Ze(),n.jats.splice(o,1),V.set(n))}function s(m){t.$$.not_equal(n.jats[o].geometry.coordinates,m)&&(n.jats[o].geometry.coordinates=m,V.set(n))}const u=()=>te(le,r={kind:"neutral"},r);function c(){n.jats[o].properties.name=this.value,V.set(n)}const f=()=>te(le,r={kind:"edit-jat-detail",idx:o,stage:"existing"},r),p=()=>te(le,r={kind:"edit-jat-detail",idx:o,stage:"proposed"},r);return t.$$set=m=>{"idx"in m&&l(0,o=m.idx)},[o,n,r,i,a,s,u,c,f,p]}class Qr extends pe{constructor(e){super(),_e(this,e,Vr,Wr,ge,{idx:0})}}function rn(t,e,l){const n=t.slice();return n[3]=e[l],n[4]=e,n[5]=l,n}function Yr(t){let e,l;return{c(){e=h("span"),l=A(),z(e,"class","dot svelte-jgyhla")},m(n,r){v(n,e,r),v(n,l,r)},p:re,d(n){n&&(w(e),w(l))}}}function on(t){let e,l,n;function r(i){t[2](i,t[3],t[4],t[5])}let o={draggable:!0,$$slots:{default:[Yr]},$$scope:{ctx:t}};return t[3]!==void 0&&(o.lngLat=t[3]),e=new Pe({props:o}),be.push(()=>Me(e,"lngLat",r)),{c(){P(e.$$.fragment)},m(i,a){O(e,i,a),n=!0},p(i,a){t=i;const s={};a&64&&(s.$$scope={dirty:a,ctx:t}),!l&&a&1&&(l=!0,s.lngLat=t[3],Ie(()=>l=!1)),e.$set(s)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function xr(t){let e,l,n,r;e=new Nn({}),e.$on("click",t[1]);let o=Q(t[0].geometry.coordinates),i=[];for(let s=0;s<o.length;s+=1)i[s]=on(rn(t,o,s));const a=s=>C(i[s],1,1,()=>{i[s]=null});return{c(){P(e.$$.fragment),l=A();for(let s=0;s<i.length;s+=1)i[s].c();n=lt()},m(s,u){O(e,s,u),v(s,l,u);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(s,u);v(s,n,u),r=!0},p(s,[u]){if(u&1){o=Q(s[0].geometry.coordinates);let c;for(c=0;c<o.length;c+=1){const f=rn(s,o,c);i[c]?(i[c].p(f,u),b(i[c],1)):(i[c]=on(f),i[c].c(),b(i[c],1),i[c].m(n.parentNode,n))}for($e(),c=o.length;c<i.length;c+=1)a(c);ke()}},i(s){if(!r){b(e.$$.fragment,s);for(let u=0;u<o.length;u+=1)b(i[u]);r=!0}},o(s){C(e.$$.fragment,s),i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)C(i[u]);r=!1},d(s){s&&(w(l),w(n)),F(e,s),ce(i,s)}}}function eo(t,e,l){let{f:n}=e;function r(i){n.geometry.coordinates.push(i.detail.lngLat.toArray()),l(0,n)}function o(i,a,s,u){s[u]=i,l(0,n)}return t.$$set=i=>{"f"in i&&l(0,n=i.f)},[n,r,o]}class to extends pe{constructor(e){super(),_e(this,e,eo,xr,ge,{f:0})}}const{window:no}=nt;function sn(t,e,l){const n=t.slice();return n[10]=e[l],n[11]=e,n[12]=l,n}function lo(t,e,l){const n=t.slice();return n[13]=e[l],n}function an(t){let e;return{c(){e=h("p"),e.textContent="A link needs at least two points"},m(l,n){v(l,e,n)},d(l){l&&w(e)}}}function ro(t){let e;return{c(){e=h("option"),e.textContent=`${t[13]}`,e.__value=t[13],de(e,e.__value)},m(l,n){v(l,e,n)},p:re,d(l){l&&w(e)}}}function cn(t){let e,l=t[10].name+"",n,r,o=t[10].description+"",i,a,s,u,c,f,p=Q(t[10].choices),m=[];for(let g=0;g<p.length;g+=1)m[g]=ro(lo(t,p,g));function _(){t[9].call(s,t[12])}return{c(){e=h("label"),n=Z(l),r=Z(": "),i=Z(o),a=A(),s=h("select");for(let g=0;g<m.length;g+=1)m[g].c();u=A(),t[1].links[t[0]].properties.answers[t[12]]===void 0&&In(_)},m(g,N){v(g,e,N),d(e,n),d(e,r),d(e,i),d(e,a),d(e,s);for(let $=0;$<m.length;$+=1)m[$]&&m[$].m(s,null);xe(s,t[1].links[t[0]].properties.answers[t[12]],!0),d(e,u),c||(f=W(s,"change",_),c=!0)},p(g,N){t=g,N&3&&xe(s,t[1].links[t[0]].properties.answers[t[12]])},d(g){g&&w(e),ce(m,g),c=!1,f()}}}function oo(t){let e,l,n,r,o,i,a,s,u,c,f,p,m,_,g=!t[2]&&an(),N=Q(je),$=[];for(let j=0;j<N.length;j+=1)$[j]=cn(sn(t,N,j));return{c(){e=h("div"),l=h("button"),n=Z("Done"),o=A(),i=h("button"),i.textContent="Delete link",a=A(),g&&g.c(),s=A(),u=h("label"),c=Z(`Name:
      `),f=h("input"),p=A();for(let j=0;j<$.length;j+=1)$[j].c();l.disabled=r=!t[2],z(f,"type","text"),z(e,"slot","sidebar")},m(j,J){v(j,e,J),d(e,l),d(l,n),d(e,o),d(e,i),d(e,a),g&&g.m(e,null),d(e,s),d(e,u),d(u,c),d(u,f),de(f,t[1].links[t[0]].properties.name),d(e,p);for(let U=0;U<$.length;U+=1)$[U]&&$[U].m(e,null);m||(_=[W(l,"click",t[7]),W(i,"click",t[5]),W(f,"input",t[8])],m=!0)},p(j,J){if(J&4&&r!==(r=!j[2])&&(l.disabled=r),j[2]?g&&(g.d(1),g=null):g||(g=an(),g.c(),g.m(e,s)),J&3&&f.value!==j[1].links[j[0]].properties.name&&de(f,j[1].links[j[0]].properties.name),J&3){N=Q(je);let U;for(U=0;U<N.length;U+=1){const q=sn(j,N,U);$[U]?$[U].p(q,J):($[U]=cn(q),$[U].c(),$[U].m(e,null))}for(;U<$.length;U+=1)$[U].d(1);$.length=N.length}},d(j){j&&w(e),g&&g.d(),ce($,j),m=!1,Se(_)}}}function io(t){let e,l;return e=new He({props:{paint:{"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&1&&(o.paint={"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function so(t){let e,l,n,r,o,i,a,s,u,c;l=new Ae({props:{data:he(t[1].links),generateId:!0,$$slots:{default:[io]},$$scope:{ctx:t}}}),r=new pt({}),i=new it({});function f(m){t[6](m)}let p={};return t[1].links[t[0]]!==void 0&&(p.f=t[1].links[t[0]]),s=new to({props:p}),be.push(()=>Me(s,"f",f)),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),a=A(),P(s.$$.fragment),z(e,"slot","map")},m(m,_){v(m,e,_),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),d(e,a),O(s,e,null),c=!0},p(m,_){const g={};_&2&&(g.data=he(m[1].links)),_&65537&&(g.$$scope={dirty:_,ctx:m}),l.$set(g);const N={};!u&&_&3&&(u=!0,N.f=m[1].links[m[0]],Ie(()=>u=!1)),s.$set(N)},i(m){c||(b(l.$$.fragment,m),b(r.$$.fragment,m),b(i.$$.fragment,m),b(s.$$.fragment,m),c=!0)},o(m){C(l.$$.fragment,m),C(r.$$.fragment,m),C(i.$$.fragment,m),C(s.$$.fragment,m),c=!1},d(m){m&&w(e),F(l),F(r),F(i),F(s)}}}function ao(t){let e,l,n,r;return e=new Ue({props:{$$slots:{map:[so],sidebar:[oo]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W(no,"keydown",t[4]),n=!0)},p(o,[i]){const a={};i&65551&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function co(t,e,l){let n,r,o;oe(t,V,m=>l(1,r=m)),oe(t,le,m=>l(3,o=m));let{idx:i}=e;function a(m){m.key=="Escape"&&n&&te(le,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this link?")&&(te(le,o={kind:"neutral"},o),await Ze(),r.links.splice(i,1),V.set(r))}function u(m){t.$$.not_equal(r.links[i],m)&&(r.links[i]=m,V.set(r))}const c=()=>te(le,o={kind:"neutral"},o);function f(){r.links[i].properties.name=this.value,V.set(r)}function p(m){r.links[i].properties.answers[m]=Mn(this),V.set(r)}return t.$$set=m=>{"idx"in m&&l(0,i=m.idx)},t.$$.update=()=>{t.$$.dirty&3&&l(2,n=r.links[i].geometry.coordinates.length>=2)},[i,r,n,o,a,s,u,c,f,p]}class uo extends pe{constructor(e){super(),_e(this,e,co,ao,ge,{idx:0})}}function un(t,e,l){const n=t.slice();return n[6]=e[l],n[7]=e,n[8]=l,n}function fn(t,e,l){const n=t.slice();return n[9]=e[l],n}function mn(t){let e,l=t[9]+"",n,r;return{c(){e=h("option"),n=Z(l),e.__value=r=t[9],de(e,e.__value)},m(o,i){v(o,e,i),d(e,n)},p(o,i){i&1&&l!==(l=o[9]+"")&&ie(n,l),i&1&&r!==(r=o[9])&&(e.__value=r,de(e,e.__value))},d(o){o&&w(e)}}}function dn(t){let e,l,n=t[6].properties.name+"",r,o,i,a,s,u,c=Q(je[t[0]].choices),f=[];for(let m=0;m<c.length;m+=1)f[m]=mn(fn(t,c,m));function p(){t[5].call(i,t[7],t[8])}return{c(){e=h("li"),l=h("span"),r=Z(n),o=A(),i=h("select");for(let m=0;m<f.length;m+=1)f[m].c();a=A(),ee(l,"color",t[6].properties.color),t[6].properties.answers[t[0]]===void 0&&In(p)},m(m,_){v(m,e,_),d(e,l),d(l,r),d(e,o),d(e,i);for(let g=0;g<f.length;g+=1)f[g]&&f[g].m(i,null);xe(i,t[6].properties.answers[t[0]],!0),d(e,a),s||(u=W(i,"change",p),s=!0)},p(m,_){if(t=m,_&4&&n!==(n=t[6].properties.name+"")&&ie(r,n),_&4&&ee(l,"color",t[6].properties.color),_&1){c=Q(je[t[0]].choices);let g;for(g=0;g<c.length;g+=1){const N=fn(t,c,g);f[g]?f[g].p(N,_):(f[g]=mn(N),f[g].c(),f[g].m(i,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=c.length}_&5&&xe(i,t[6].properties.answers[t[0]])},d(m){m&&w(e),ce(f,m),s=!1,u()}}}function fo(t){let e,l,n,r,o=je[t[0]].name+"",i,a,s=je[t[0]].description+"",u,c,f,p,m,_=Q(t[2].links),g=[];for(let N=0;N<_.length;N+=1)g[N]=dn(un(t,_,N));return{c(){e=h("div"),l=h("button"),l.textContent="Done",n=A(),r=h("h2"),i=Z(o),a=Z(": "),u=Z(s),c=A(),f=h("ol");for(let N=0;N<g.length;N+=1)g[N].c();z(e,"slot","sidebar")},m(N,$){v(N,e,$),d(e,l),d(e,n),d(e,r),d(r,i),d(r,a),d(r,u),d(e,c),d(e,f);for(let j=0;j<g.length;j+=1)g[j]&&g[j].m(f,null);p||(m=W(l,"click",t[4]),p=!0)},p(N,$){if($&1&&o!==(o=je[N[0]].name+"")&&ie(i,o),$&1&&s!==(s=je[N[0]].description+"")&&ie(u,s),$&5){_=Q(N[2].links);let j;for(j=0;j<_.length;j+=1){const J=un(N,_,j);g[j]?g[j].p(J,$):(g[j]=dn(J),g[j].c(),g[j].m(f,null))}for(;j<g.length;j+=1)g[j].d(1);g.length=_.length}},d(N){N&&w(e),ce(g,N),p=!1,m()}}}function mo(t){let e,l,n,r,o,i,a;return l=new ot({props:{showColor:!0}}),r=new pt({}),i=new it({}),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),z(e,"slot","map")},m(s,u){v(s,e,u),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),a=!0},p:re,i(s){a||(b(l.$$.fragment,s),b(r.$$.fragment,s),b(i.$$.fragment,s),a=!0)},o(s){C(l.$$.fragment,s),C(r.$$.fragment,s),C(i.$$.fragment,s),a=!1},d(s){s&&w(e),F(l),F(r),F(i)}}}function po(t){let e,l,n,r;return e=new Ue({props:{$$slots:{map:[mo],sidebar:[fo]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(o,i){O(e,o,i),l=!0,n||(r=W(window,"keydown",t[3]),n=!0)},p(o,[i]){const a={};i&4103&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){F(e,o),n=!1,r()}}}function _o(t,e,l){let n,r;oe(t,le,u=>l(1,n=u)),oe(t,V,u=>l(2,r=u));let{qIdx:o}=e;function i(u){u.key=="Escape"&&te(le,n={kind:"neutral"},n)}const a=()=>te(le,n={kind:"neutral"},n);function s(u,c){u[c].properties.answers[o]=Mn(this),V.set(r),l(0,o)}return t.$$set=u=>{"qIdx"in u&&l(0,o=u.qIdx)},[o,n,r,i,a,s]}class go extends pe{constructor(e){super(),_e(this,e,_o,po,ge,{qIdx:0})}}function ho(t){let e,l,n,r;const o=t[2].default,i=Be(o,t,t[1],null);return{c(){e=h("a"),i&&i.c(),z(e,"href","#"),ee(e,"color",t[0])},m(a,s){v(a,e,s),i&&i.m(e,null),l=!0,n||(r=W(e,"click",Xn(t[3])),n=!0)},p(a,[s]){i&&i.p&&(!l||s&2)&&Je(i,o,a,a[1],l?Re(o,a[1],s,null):ze(a[1]),null),s&1&&ee(e,"color",a[0])},i(a){l||(b(i,a),l=!0)},o(a){C(i,a),l=!1},d(a){a&&w(e),i&&i.d(a),n=!1,r()}}}function $o(t,e,l){let{$$slots:n={},$$scope:r}=e,{color:o=void 0}=e;function i(a){Ce.call(this,t,a)}return t.$$set=a=>{"color"in a&&l(0,o=a.color),"$$scope"in a&&l(1,r=a.$$scope)},[o,r,n,i]}class st extends pe{constructor(e){super(),_e(this,e,$o,ho,ge,{color:0})}}function pn(t,e,l){const n=t.slice();return n[2]=e[l],n[4]=l,n}function _n(t,e,l){const n=t.slice();n[5]=e[l];const r=n[5].properties.answers[n[4]];return n[6]=r,n}function gn(t,e,l){const n=t.slice();return n[5]=e[l],n}function hn(t){let e,l=t[5].properties.name+"",n;return{c(){e=h("th"),n=Z(l),ee(e,"color",t[5].properties.color)},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&1&&l!==(l=r[5].properties.name+"")&&ie(n,l),o&1&&ee(e,"color",r[5].properties.color)},d(r){r&&w(e)}}}function $n(t){let e,l=t[6]+"",n;return{c(){e=h("td"),n=Z(l),ee(e,"background",t[6]==""?"red":"green")},m(r,o){v(r,e,o),d(e,n)},p(r,o){o&1&&l!==(l=r[6]+"")&&ie(n,l),o&1&&ee(e,"background",r[6]==""?"red":"green")},d(r){r&&w(e)}}}function kn(t){let e,l,n,r,o=Q(t[0].links),i=[];for(let a=0;a<o.length;a+=1)i[a]=$n(_n(t,o,a));return{c(){e=h("tr"),l=h("th"),l.textContent=`${t[2].name}`,n=A();for(let a=0;a<i.length;a+=1)i[a].c();r=A()},m(a,s){v(a,e,s),d(e,l),d(e,n);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);d(e,r)},p(a,s){if(s&1){o=Q(a[0].links);let u;for(u=0;u<o.length;u+=1){const c=_n(a,o,u);i[u]?i[u].p(c,s):(i[u]=$n(c),i[u].c(),i[u].m(e,r))}for(;u<i.length;u+=1)i[u].d(1);i.length=o.length}},d(a){a&&w(e),ce(i,a)}}}function ko(t){let e,l,n,r,o,i,a,s=Q(t[0].links),u=[];for(let p=0;p<s.length;p+=1)u[p]=hn(gn(t,s,p));let c=Q(je),f=[];for(let p=0;p<c.length;p+=1)f[p]=kn(pn(t,c,p));return{c(){e=h("table"),l=h("thead"),n=h("tr"),r=h("th"),o=A();for(let p=0;p<u.length;p+=1)u[p].c();i=A(),a=h("tbody");for(let p=0;p<f.length;p+=1)f[p].c()},m(p,m){v(p,e,m),d(e,l),d(l,n),d(n,r),d(n,o);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(n,null);d(e,i),d(e,a);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(a,null)},p(p,m){if(m&1){s=Q(p[0].links);let _;for(_=0;_<s.length;_+=1){const g=gn(p,s,_);u[_]?u[_].p(g,m):(u[_]=hn(g),u[_].c(),u[_].m(n,null))}for(;_<u.length;_+=1)u[_].d(1);u.length=s.length}if(m&1){c=Q(je);let _;for(_=0;_<c.length;_+=1){const g=pn(p,c,_);f[_]?f[_].p(g,m):(f[_]=kn(g),f[_].c(),f[_].m(a,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=c.length}},d(p){p&&w(e),ce(u,p),ce(f,p)}}}function bo(t){let e,l;return e=new Dn({props:{$$slots:{default:[ko]},$$scope:{ctx:t}}}),e.$on("close",t[1]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&2049&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function vo(t,e,l){let n;oe(t,V,o=>l(0,n=o));function r(o){Ce.call(this,t,o)}return[n,r]}class wo extends pe{constructor(e){super(),_e(this,e,vo,bo,ge,{})}}function bn(t,e,l){const n=t.slice();return n[19]=e[l],n[21]=l,n}function vn(t,e,l){const n=t.slice();return n[22]=e[l],n[21]=l,n}function wn(t,e,l){const n=t.slice();return n[24]=e[l],n[21]=l,n}function yn(t,e,l){const n=t.slice();return n[26]=e[l],n[21]=l,n}function jn(t){let e,l;return e=new wo({}),e.$on("close",t[7]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function yo(t){let e=t[26].properties.name+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r&2&&e!==(e=n[26].properties.name+"")&&ie(l,e)},d(n){n&&w(l)}}}function Cn(t){let e,l,n,r;function o(){return t[13](t[21])}return l=new st({props:{color:t[26].properties.color,$$slots:{default:[yo]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),P(l.$$.fragment),n=A()},m(i,a){v(i,e,a),O(l,e,null),d(e,n),r=!0},p(i,a){t=i;const s={};a&2&&(s.color=t[26].properties.color),a&268435458&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(b(l.$$.fragment,i),r=!0)},o(i){C(l.$$.fragment,i),r=!1},d(i){i&&w(e),F(l)}}}function jo(t){let e=t[24].name+"",l,n;return{c(){l=Z(e),n=A()},m(r,o){v(r,l,o),v(r,n,o)},p:re,d(r){r&&(w(l),w(n))}}}function An(t){let e,l,n,r,o,i,a,s;function u(){return t[14](t[21])}l=new st({props:{$$slots:{default:[jo]},$$scope:{ctx:t}}}),l.$on("click",u);function c(...f){return t[15](t[21],...f)}return{c(){e=h("li"),P(l.$$.fragment),n=Z(`:
          `),r=h("progress"),a=A(),r.value=o=t[1].links.filter(c).length,z(r,"max",i=t[1].links.length),z(r,"class","svelte-zadug4")},m(f,p){v(f,e,p),O(l,e,null),d(e,n),d(e,r),d(e,a),s=!0},p(f,p){t=f;const m={};p&268435456&&(m.$$scope={dirty:p,ctx:t}),l.$set(m),(!s||p&2&&o!==(o=t[1].links.filter(c).length))&&(r.value=o),(!s||p&2&&i!==(i=t[1].links.length))&&z(r,"max",i)},i(f){s||(b(l.$$.fragment,f),s=!0)},o(f){C(l.$$.fragment,f),s=!1},d(f){f&&w(e),F(l)}}}function Co(t){let e=t[22].properties.name+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r&2&&e!==(e=n[22].properties.name+"")&&ie(l,e)},d(n){n&&w(l)}}}function Sn(t){let e,l,n,r;function o(){return t[16](t[21])}return l=new st({props:{color:t[22].properties.color,$$slots:{default:[Co]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),P(l.$$.fragment),n=A()},m(i,a){v(i,e,a),O(l,e,null),d(e,n),r=!0},p(i,a){t=i;const s={};a&2&&(s.color=t[22].properties.color),a&268435458&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(b(l.$$.fragment,i),r=!0)},o(i){C(l.$$.fragment,i),r=!1},d(i){i&&w(e),F(l)}}}function Ao(t){let e=t[19].properties.name+"",l;return{c(){l=Z(e)},m(n,r){v(n,l,r)},p(n,r){r&2&&e!==(e=n[19].properties.name+"")&&ie(l,e)},d(n){n&&w(l)}}}function Ln(t){let e,l,n,r;function o(){return t[17](t[21])}return l=new st({props:{color:t[19].properties.color,$$slots:{default:[Ao]},$$scope:{ctx:t}}}),l.$on("click",o),{c(){e=h("li"),P(l.$$.fragment),n=A()},m(i,a){v(i,e,a),O(l,e,null),d(e,n),r=!0},p(i,a){t=i;const s={};a&2&&(s.color=t[19].properties.color),a&268435458&&(s.$$scope={dirty:a,ctx:t}),l.$set(s)},i(i){r||(b(l.$$.fragment,i),r=!0)},o(i){C(l.$$.fragment,i),r=!1},d(i){i&&w(e),F(l)}}}function So(t){let e,l,n,r,o,i,a,s,u,c,f,p,m,_,g,N,$,j,J,U,q,S,B,T,H,L,M,k,X,y,ue,ae,D,K=Q(t[1].links),ne=[];for(let G=0;G<K.length;G+=1)ne[G]=Cn(yn(t,K,G));const se=G=>C(ne[G],1,1,()=>{ne[G]=null});let I=Q(je),R=[];for(let G=0;G<I.length;G+=1)R[G]=An(wn(t,I,G));const Y=G=>C(R[G],1,1,()=>{R[G]=null});let ve=Q(t[1].jats),fe=[];for(let G=0;G<ve.length;G+=1)fe[G]=Sn(vn(t,ve,G));const Pn=G=>C(fe[G],1,1,()=>{fe[G]=null});let De=Q(t[1].bus_stops),me=[];for(let G=0;G<De.length;G+=1)me[G]=Ln(bn(t,De,G));const On=G=>C(me[G],1,1,()=>{me[G]=null});return{c(){e=h("div"),l=h("div"),n=h("button"),n.textContent="Download",r=A(),o=h("button"),o.textContent="Clear",i=A(),a=h("hr"),s=A(),u=h("div"),c=h("button"),c.textContent="New link",f=A(),p=h("button"),p.textContent="Table of questions",m=Z(`

    Links:
    `),_=h("ol");for(let G=0;G<ne.length;G+=1)ne[G].c();g=Z(`

    Questions:
    `),N=h("ol");for(let G=0;G<R.length;G+=1)R[G].c();$=A(),j=h("hr"),J=Z(`

    JATs:

    `),U=h("div"),q=h("button"),q.textContent="New JAT",S=A(),B=h("ol");for(let G=0;G<fe.length;G+=1)fe[G].c();T=A(),H=h("hr"),L=Z(`

    Bus stops:

    `),M=h("div"),k=h("button"),k.textContent="New bus stop",X=A(),y=h("ol");for(let G=0;G<me.length;G+=1)me[G].c();z(n,"class","secondary"),z(o,"class","secondary"),z(e,"slot","sidebar")},m(G,x){v(G,e,x),d(e,l),d(l,n),d(l,r),d(l,o),d(e,i),d(e,a),d(e,s),d(e,u),d(u,c),d(u,f),d(u,p),d(e,m),d(e,_);for(let E=0;E<ne.length;E+=1)ne[E]&&ne[E].m(_,null);d(e,g),d(e,N);for(let E=0;E<R.length;E+=1)R[E]&&R[E].m(N,null);d(e,$),d(e,j),d(e,J),d(e,U),d(U,q),d(e,S),d(e,B);for(let E=0;E<fe.length;E+=1)fe[E]&&fe[E].m(B,null);d(e,T),d(e,H),d(e,L),d(e,M),d(M,k),d(e,X),d(e,y);for(let E=0;E<me.length;E+=1)me[E]&&me[E].m(y,null);ue=!0,ae||(D=[W(n,"click",t[11]),W(o,"click",t[3]),W(c,"click",t[4]),W(p,"click",t[12]),W(q,"click",t[5]),W(k,"click",t[6])],ae=!0)},p(G,x){if(x&6){K=Q(G[1].links);let E;for(E=0;E<K.length;E+=1){const Le=yn(G,K,E);ne[E]?(ne[E].p(Le,x),b(ne[E],1)):(ne[E]=Cn(Le),ne[E].c(),b(ne[E],1),ne[E].m(_,null))}for($e(),E=K.length;E<ne.length;E+=1)se(E);ke()}if(x&6){I=Q(je);let E;for(E=0;E<I.length;E+=1){const Le=wn(G,I,E);R[E]?(R[E].p(Le,x),b(R[E],1)):(R[E]=An(Le),R[E].c(),b(R[E],1),R[E].m(N,null))}for($e(),E=I.length;E<R.length;E+=1)Y(E);ke()}if(x&6){ve=Q(G[1].jats);let E;for(E=0;E<ve.length;E+=1){const Le=vn(G,ve,E);fe[E]?(fe[E].p(Le,x),b(fe[E],1)):(fe[E]=Sn(Le),fe[E].c(),b(fe[E],1),fe[E].m(B,null))}for($e(),E=ve.length;E<fe.length;E+=1)Pn(E);ke()}if(x&6){De=Q(G[1].bus_stops);let E;for(E=0;E<De.length;E+=1){const Le=bn(G,De,E);me[E]?(me[E].p(Le,x),b(me[E],1)):(me[E]=Ln(Le),me[E].c(),b(me[E],1),me[E].m(y,null))}for($e(),E=De.length;E<me.length;E+=1)On(E);ke()}},i(G){if(!ue){for(let x=0;x<K.length;x+=1)b(ne[x]);for(let x=0;x<I.length;x+=1)b(R[x]);for(let x=0;x<ve.length;x+=1)b(fe[x]);for(let x=0;x<De.length;x+=1)b(me[x]);ue=!0}},o(G){ne=ne.filter(Boolean);for(let x=0;x<ne.length;x+=1)C(ne[x]);R=R.filter(Boolean);for(let x=0;x<R.length;x+=1)C(R[x]);fe=fe.filter(Boolean);for(let x=0;x<fe.length;x+=1)C(fe[x]);me=me.filter(Boolean);for(let x=0;x<me.length;x+=1)C(me[x]);ue=!1},d(G){G&&w(e),ce(ne,G),ce(R,G),ce(fe,G),ce(me,G),ae=!1,Se(D)}}}function Lo(t){let e,l;return e=new He({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":Ke(6,9)},hoverCursor:"pointer"}}),e.$on("click",t[8]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function To(t){let e,l;return e=new Ee({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":Ke(20,25)},hoverCursor:"pointer"}}),e.$on("click",t[9]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Mo(t){let e,l;return e=new Ee({props:{manageHoverState:!0,paint:{"circle-color":["get","color"],"circle-radius":Ke(10,15)},hoverCursor:"pointer"}}),e.$on("click",t[10]),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Io(t){let e,l,n,r,o,i,a;return l=new Ae({props:{data:he(t[1].links),generateId:!0,$$slots:{default:[Lo]},$$scope:{ctx:t}}}),r=new Ae({props:{data:he(t[1].jats),generateId:!0,$$slots:{default:[To]},$$scope:{ctx:t}}}),i=new Ae({props:{data:he(t[1].bus_stops),generateId:!0,$$slots:{default:[Mo]},$$scope:{ctx:t}}}),{c(){e=h("div"),P(l.$$.fragment),n=A(),P(r.$$.fragment),o=A(),P(i.$$.fragment),z(e,"slot","map")},m(s,u){v(s,e,u),O(l,e,null),d(e,n),O(r,e,null),d(e,o),O(i,e,null),a=!0},p(s,u){const c={};u&2&&(c.data=he(s[1].links)),u&268435460&&(c.$$scope={dirty:u,ctx:s}),l.$set(c);const f={};u&2&&(f.data=he(s[1].jats)),u&268435460&&(f.$$scope={dirty:u,ctx:s}),r.$set(f);const p={};u&2&&(p.data=he(s[1].bus_stops)),u&268435460&&(p.$$scope={dirty:u,ctx:s}),i.$set(p)},i(s){a||(b(l.$$.fragment,s),b(r.$$.fragment,s),b(i.$$.fragment,s),a=!0)},o(s){C(l.$$.fragment,s),C(r.$$.fragment,s),C(i.$$.fragment,s),a=!1},d(s){s&&w(e),F(l),F(r),F(i)}}}function No(t){let e,l,n,r=t[0]&&jn(t);return l=new Ue({props:{$$slots:{map:[Io],sidebar:[So]},$$scope:{ctx:t}}}),{c(){r&&r.c(),e=A(),P(l.$$.fragment)},m(o,i){r&&r.m(o,i),v(o,e,i),O(l,o,i),n=!0},p(o,[i]){o[0]?r?(r.p(o,i),i&1&&b(r,1)):(r=jn(o),r.c(),b(r,1),r.m(e.parentNode,e)):r&&($e(),C(r,1,1,()=>{r=null}),ke());const a={};i&268435463&&(a.$$scope={dirty:i,ctx:o}),l.$set(a)},i(o){n||(b(r),b(l.$$.fragment,o),n=!0)},o(o){C(r),C(l.$$.fragment,o),n=!1},d(o){o&&w(e),r&&r.d(o),F(l,o)}}}function Eo(t,e,l){let n,r,o;oe(t,V,S=>l(1,n=S)),oe(t,le,S=>l(2,r=S)),oe(t,et,S=>l(18,o=S));let i=!1;function a(){te(V,n.links=[],n),te(V,n.jats=[],n),te(V,n.bus_stops=[],n)}function s(){let S=al(n.links.length);te(V,n.links=[...n.links,S],n),te(le,r={kind:"edit-link",idx:n.links.length-1},r)}function u(){if(!o)return;let S=ul(n.jats.length,o.getCenter().toArray());te(V,n.jats=[...n.jats,S],n),te(le,r={kind:"edit-jat",idx:n.jats.length-1},r)}function c(){if(!o)return;let S=cl(n.bus_stops.length,o.getCenter().toArray());te(V,n.bus_stops=[...n.bus_stops,S],n),te(le,r={kind:"edit-bus-stop",idx:n.bus_stops.length-1},r)}return[i,n,r,a,s,u,c,()=>l(0,i=!1),S=>te(le,r={kind:"edit-link",idx:S.detail.features[0].id},r),S=>te(le,r={kind:"edit-jat",idx:S.detail.features[0].id},r),S=>te(le,r={kind:"edit-bus-stop",idx:S.detail.features[0].id},r),()=>Ol("rcv2.geojson",JSON.stringify(n)),()=>l(0,i=!0),S=>te(le,r={kind:"edit-link",idx:S},r),S=>te(le,r={kind:"edit-question",idx:S},r),(S,B)=>B.properties.answers[S]!="",S=>te(le,r={kind:"edit-jat",idx:S},r),S=>te(le,r={kind:"edit-bus-stop",idx:S},r)]}class Do extends pe{constructor(e){super(),_e(this,e,Eo,No,ge,{})}}function qo(t){let e,l;return{c(){e=h("div"),l=h("div"),z(e,"slot","left")},m(n,r){v(n,e,r),d(e,l),t[9](l)},p:re,d(n){n&&w(e),t[9](null)}}}function Po(t){return{c:re,m:re,p:re,i:re,o:re,d:re}}function Oo(t){let e,l,n;function r(i){t[8](i)}let o={style:t[10],standardControls:!0,hash:!0,$$slots:{default:[Go]},$$scope:{ctx:t}};return t[2]!==void 0&&(o.map=t[2]),e=new Vn({props:o}),be.push(()=>Me(e,"map",r)),{c(){P(e.$$.fragment)},m(i,a){O(e,i,a),n=!0},p(i,a){const s={};a&2058&&(s.$$scope={dirty:a,ctx:i}),!l&&a&4&&(l=!0,s.map=i[2],Ie(()=>l=!1)),e.$set(s)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Fo(t){let e,l;return e=new go({props:{qIdx:t[3].idx}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.qIdx=n[3].idx),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Bo(t){let e,l;return e=new Cl({props:{idx:t[3].idx}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Jo(t){let e,l;return e=new Hr({props:{junctionIdx:t[3].idx,stage:t[3].stage}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.junctionIdx=n[3].idx),r&8&&(o.stage=n[3].stage),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function zo(t){let e,l;return e=new Qr({props:{idx:t[3].idx}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ro(t){let e,l;return e=new uo({props:{idx:t[3].idx}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,r){const o={};r&8&&(o.idx=n[3].idx),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Ho(t){let e,l;return e=new Do({}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p:re,i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Go(t){let e,l,n,r,o,i;const a=[Ho,Ro,zo,Jo,Bo,Fo],s=[];function u(c,f){return c[3].kind=="neutral"?0:c[3].kind=="edit-link"?1:c[3].kind=="edit-jat"?2:c[3].kind=="edit-jat-detail"?3:c[3].kind=="edit-bus-stop"?4:c[3].kind=="edit-question"?5:-1}return~(n=u(t))&&(r=s[n]=a[n](t)),{c(){e=h("div"),l=A(),r&&r.c(),o=lt()},m(c,f){v(c,e,f),t[7](e),v(c,l,f),~n&&s[n].m(c,f),v(c,o,f),i=!0},p(c,f){let p=n;n=u(c),n===p?~n&&s[n].p(c,f):(r&&($e(),C(s[p],1,1,()=>{s[p]=null}),ke()),~n?(r=s[n],r?r.p(c,f):(r=s[n]=a[n](c),r.c()),b(r,1),r.m(o.parentNode,o)):r=null)},i(c){i||(b(r),i=!0)},o(c){C(r),i=!1},d(c){c&&(w(e),w(l),w(o)),t[7](null),~n&&s[n].d(c)}}}function Uo(t){return{c:re,m:re,p:re,i:re,o:re,d:re}}function Zo(t){let e,l,n={ctx:t,current:null,token:null,hasCatch:!1,pending:Uo,then:Oo,catch:Po,value:10,blocks:[,,,]};return Qn(Al(new URLSearchParams(window.location.search).get("google")||""),n),{c(){e=h("div"),n.block.c(),z(e,"slot","main"),ee(e,"position","relative"),ee(e,"width","100%"),ee(e,"height","100vh")},m(r,o){v(r,e,o),n.block.m(e,n.anchor=null),n.mount=()=>e,n.anchor=null,l=!0},p(r,o){t=r,Yn(n,t,o)},i(r){l||(b(n.block),l=!0)},o(r){for(let o=0;o<3;o+=1){const i=n.blocks[o];C(i)}l=!1},d(r){r&&w(e),n.block.d(),n.token=null,n=null}}}function Ko(t){let e,l;return e=new Wn({props:{$$slots:{main:[Zo],left:[qo]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},m(n,r){O(e,n,r),l=!0},p(n,[r]){const o={};r&2063&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){C(e.$$.fragment,n),l=!1},d(n){F(e,n)}}}function Xo(t,e,l){let n,r,o,i,a;oe(t,mt,m=>l(4,n=m)),oe(t,ft,m=>l(5,r=m)),oe(t,V,m=>l(6,o=m)),oe(t,et,m=>l(2,i=m)),oe(t,le,m=>l(3,a=m));let s,u;function c(m){be[m?"unshift":"push"](()=>{u=m,l(1,u),l(4,n)})}function f(m){i=m,et.set(i)}function p(m){be[m?"unshift":"push"](()=>{s=m,l(0,s),l(5,r)})}return t.$$.update=()=>{t.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(o)),t.$$.dirty&33&&s&&r&&(l(0,s.innerHTML="",s),s.appendChild(r)),t.$$.dirty&18&&u&&n&&(l(1,u.innerHTML="",u),u.appendChild(n))},[s,u,i,a,n,r,o,c,f,p]}class Wo extends pe{constructor(e){super(),_e(this,e,Xo,Ko,ge,{})}}new Wo({target:document.getElementById("app")});
