import{S as oe,i as le,s as ne,h as De,z as v,B as F,X as ve,r as A,u as Te,j as Ne,k as Ie,t as k,e as y,x as C,Y as xr,Z as ee,$ as Pt,b as fe,a0 as nn,Q as m,R as J,l as Ce,a1 as ko,L as wo,a as me,c as L,m as B,d as ge,f as E,g as eo,q as qe,v as ae,w as ce,a2 as rn,a3 as vo,a4 as yo,a5 as X,a6 as Ao,a7 as Co,C as ie,a8 as jo,A as M,a9 as Pe,H as I,I as re,aa as So,p as x,ab as zo,ac as on,y as pe,T as Ae,O as $e,N as Wt,G as we,E as Me,F as Ve,V as Y,M as Xe,ad as at,ae as xe,af as kt,ag as Mo,P as ct,ah as Lo,ai as ln,aj as Bo,ak as Gt,_ as Eo,al as Do,n as Tt,am as Zt,an as To,ao as Jt,D as wt,ap as No,J as Io,K as Oo,U as Fo}from"./Layout-c26de20b.js";function Po(r){let e,n;const t=r[7].default,o=De(t,r,r[6],null);return{c(){e=v("div"),o&&o.c(),F(e,"class",r[1]),ve(e,"maplibregl-ctrl",r[0])},m(l,i){A(l,e,i),o&&o.m(e,null),r[8](e),n=!0},p(l,[i]){o&&o.p&&(!n||i&64)&&Te(o,t,l,l[6],n?Ie(t,l[6],i,null):Ne(l[6]),null),(!n||i&2)&&F(e,"class",l[1]),(!n||i&3)&&ve(e,"maplibregl-ctrl",l[0])},i(l){n||(k(o,l),n=!0)},o(l){y(o,l),n=!1},d(l){l&&C(e),o&&o.d(l),r[8](null)}}}function qo(r,e,n){let t,{$$slots:o={},$$scope:l}=e,{defaultStyling:i=!0}=e,{position:a="top-right"}=e,{class:s=void 0}=e;const{map:c}=xr();ee(r,c,p=>n(5,t=p));let u,f={onAdd(){return u},onRemove(){var p;(p=u==null?void 0:u.parentNode)==null||p.removeChild(u)}};Pt(()=>{t==null||t.removeControl(f)});function d(p){fe[p?"unshift":"push"](()=>{u=p,n(2,u)})}return r.$$set=p=>{"defaultStyling"in p&&n(0,i=p.defaultStyling),"position"in p&&n(4,a=p.position),"class"in p&&n(1,s=p.class),"$$scope"in p&&n(6,l=p.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&t&&u&&t.addControl(f,a)},[i,s,u,c,a,t,l,o,d]}class Uo extends oe{constructor(e){super(),le(this,e,qo,Po,ne,{defaultStyling:0,position:4,class:1})}}function Ro(r){let e,n,t,o,l,i;const a=r[4].default,s=De(a,r,r[3],null);return{c(){e=v("button"),n=v("div"),s&&s.c(),F(n,"class",t=nn(r[2])+" svelte-1s83zbq"),ve(n,"maplibregl-ctrl-icon",r[0]),ve(n,"ctrl-btn-center",r[1]),F(e,"type","button")},m(c,u){A(c,e,u),m(e,n),s&&s.m(n,null),o=!0,l||(i=J(e,"click",r[5]),l=!0)},p(c,[u]){s&&s.p&&(!o||u&8)&&Te(s,a,c,c[3],o?Ie(a,c[3],u,null):Ne(c[3]),null),(!o||u&4&&t!==(t=nn(c[2])+" svelte-1s83zbq"))&&F(n,"class",t),(!o||u&5)&&ve(n,"maplibregl-ctrl-icon",c[0]),(!o||u&6)&&ve(n,"ctrl-btn-center",c[1])},i(c){o||(k(s,c),o=!0)},o(c){y(s,c),o=!1},d(c){c&&C(e),s&&s.d(c),l=!1,i()}}}function Go(r,e,n){let{$$slots:t={},$$scope:o}=e,{icon:l=!0}=e,{center:i=!0}=e,{class:a=void 0}=e;function s(c){Ce.call(this,r,c)}return r.$$set=c=>{"icon"in c&&n(0,l=c.icon),"center"in c&&n(1,i=c.center),"class"in c&&n(2,a=c.class),"$$scope"in c&&n(3,o=c.$$scope)},[l,i,a,o,t,s]}class to extends oe{constructor(e){super(),le(this,e,Go,Ro,ne,{icon:0,center:1,class:2})}}function Jo(r,e,n){let t;const o=ko();let{layer:l=void 0}=e;const{map:i}=xr();ee(r,i,u=>n(2,t=u));function a(u){o(u.type,{...u,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],c=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Pt(()=>{if(t)if(l)for(const u of s)t.off(u,l,a);else for(const u of c)t.off(u,a)}),r.$$set=u=>{"layer"in u&&n(1,l=u.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&t)if(l)for(const u of s)t.on(u,l,a);else for(const u of c)t.on(u,a)},[i,l,t]}class qt extends oe{constructor(e){super(),le(this,e,Jo,null,ne,{layer:1})}}function Qo(r){let e;const n=r[16].default,t=De(n,r,r[24],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16777216)&&Te(t,n,o,o[24],e?Ie(n,o[24],l,null):Ne(o[24]),null)},i(o){e||(k(t,o),e=!0)},o(o){y(t,o),e=!1},d(o){t&&t.d(o)}}}function Ko(r){let e,n,t;function o(i){r[17](i)}let l={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Qo]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new wo({props:l}),fe.push(()=>me(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){L(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],ge(()=>n=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Ho(r,e,n){let{$$slots:t={},$$scope:o}=e,{id:l=eo("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:u=void 0}=e,{layout:f=void 0}=e,{filter:d=void 0}=e,{applyToClusters:p=void 0}=e,{minzoom:_=void 0}=e,{maxzoom:j=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:g=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:h=!1}=e,{interactive:b=!0}=e;function S(T){$=T,n(0,$)}function w(T){Ce.call(this,r,T)}function z(T){Ce.call(this,r,T)}function N(T){Ce.call(this,r,T)}function P(T){Ce.call(this,r,T)}function q(T){Ce.call(this,r,T)}function V(T){Ce.call(this,r,T)}return r.$$set=T=>{"id"in T&&n(1,l=T.id),"source"in T&&n(2,i=T.source),"sourceLayer"in T&&n(3,a=T.sourceLayer),"beforeId"in T&&n(4,s=T.beforeId),"beforeLayerType"in T&&n(5,c=T.beforeLayerType),"paint"in T&&n(6,u=T.paint),"layout"in T&&n(7,f=T.layout),"filter"in T&&n(8,d=T.filter),"applyToClusters"in T&&n(9,p=T.applyToClusters),"minzoom"in T&&n(10,_=T.minzoom),"maxzoom"in T&&n(11,j=T.maxzoom),"hoverCursor"in T&&n(12,D=T.hoverCursor),"manageHoverState"in T&&n(13,g=T.manageHoverState),"hovered"in T&&n(0,$=T.hovered),"eventsIfTopMost"in T&&n(14,h=T.eventsIfTopMost),"interactive"in T&&n(15,b=T.interactive),"$$scope"in T&&n(24,o=T.$$scope)},[$,l,i,a,s,c,u,f,d,p,_,j,D,g,h,b,t,S,w,z,N,P,q,V,o]}class et extends oe{constructor(e){super(),le(this,e,Ho,Ko,ne,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function sn(r){let e=r[0],n,t,o=an(r);return{c(){o.c(),n=qe()},m(l,i){o.m(l,i),A(l,n,i),t=!0},p(l,i){i&1&&ne(e,e=l[0])?(ae(),y(o,1,1,ie),ce(),o=an(l),o.c(),k(o,1),o.m(n.parentNode,n)):o.p(l,i)},i(l){t||(k(o),t=!0)},o(l){y(o),t=!1},d(l){l&&C(n),o.d(l)}}}function an(r){let e;const n=r[15].default,t=De(n,r,r[14],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16384)&&Te(t,n,o,o[14],e?Ie(n,o[14],l,null):Ne(o[14]),null)},i(o){e||(k(t,o),e=!0)},o(o){y(t,o),e=!1},d(o){t&&t.d(o)}}}function Wo(r){let e,n,t=r[0]&&sn(r);return{c(){t&&t.c(),e=qe()},m(o,l){t&&t.m(o,l),A(o,e,l),n=!0},p(o,[l]){o[0]?t?(t.p(o,l),l&1&&k(t,1)):(t=sn(o),t.c(),k(t,1),t.m(e.parentNode,e)):t&&(ae(),y(t,1,1,()=>{t=null}),ce())},i(o){n||(k(t),n=!0)},o(o){y(t),n=!1},d(o){o&&C(e),t&&t.d(o)}}}function Zo(r,e,n){let t,o,{$$slots:l={},$$scope:i}=e,{id:a=eo("vector")}=e,{url:s=null}=e,{tiles:c=null}=e,{promoteId:u=null}=e,{bounds:f=null}=e,{scheme:d=null}=e,{attribution:p=null}=e,{minzoom:_=null}=e,{maxzoom:j=null}=e,{volatile:D=null}=e;if(s&&s.includes("pmtiles://")&&!rn.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let b=new jo;rn.addProtocol("pmtiles",b.tile)}const{map:g,self:$}=vo();ee(r,g,b=>n(13,o=b)),ee(r,$,b=>n(0,t=b));let h;return Pt(()=>{t&&o&&(yo(g,t,h),X($,t=null,t),h=void 0)}),r.$$set=b=>{"id"in b&&n(3,a=b.id),"url"in b&&n(4,s=b.url),"tiles"in b&&n(5,c=b.tiles),"promoteId"in b&&n(6,u=b.promoteId),"bounds"in b&&n(7,f=b.bounds),"scheme"in b&&n(8,d=b.scheme),"attribution"in b&&n(9,p=b.attribution),"minzoom"in b&&n(10,_=b.minzoom),"maxzoom"in b&&n(11,j=b.maxzoom),"volatile"in b&&n(12,D=b.volatile),"$$scope"in b&&n(14,i=b.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&o&&t!==a&&(X($,t=a,t),Ao(o,t,Co({type:"vector",url:s,tiles:c,promoteId:u,bounds:f,scheme:d,attribution:p,minzoom:_,maxzoom:j,volatile:D}),b=>o&&b===t,()=>{t&&(h=o==null?void 0:o.getSource(t))})),r.$$.dirty&8200&&(o==null||o.on("style.load",()=>{h=o==null?void 0:o.getSource(a)}))},[t,g,$,a,s,c,u,f,d,p,_,j,D,o,i,l]}class no extends oe{constructor(e){super(),le(this,e,Zo,Wo,ne,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const Xo=r=>({}),cn=r=>({}),Vo=r=>({}),un=r=>({});function Yo(r){let e,n,t,o;const l=r[3].sidebar,i=De(l,r,r[2],un),a=r[3].map,s=De(a,r,r[2],cn);return{c(){e=v("div"),i&&i.c(),n=M(),t=v("div"),s&&s.c()},m(c,u){A(c,e,u),i&&i.m(e,null),r[4](e),A(c,n,u),A(c,t,u),s&&s.m(t,null),r[5](t),o=!0},p(c,[u]){i&&i.p&&(!o||u&4)&&Te(i,l,c,c[2],o?Ie(l,c[2],u,Vo):Ne(c[2]),un),s&&s.p&&(!o||u&4)&&Te(s,a,c,c[2],o?Ie(a,c[2],u,Xo):Ne(c[2]),cn)},i(c){o||(k(i,c),k(s,c),o=!0)},o(c){y(i,c),y(s,c),o=!1},d(c){c&&(C(e),C(n),C(t)),i&&i.d(c),r[4](null),s&&s.d(c),r[5](null)}}}function xo(r,e,n){let t,o;ee(r,Xt,c=>n(0,t=c)),ee(r,Vt,c=>n(1,o=c));let{$$slots:l={},$$scope:i}=e;function a(c){fe[c?"unshift":"push"](()=>{t=c,Xt.set(t)})}function s(c){fe[c?"unshift":"push"](()=>{o=c,Vt.set(o)})}return r.$$set=c=>{"$$scope"in c&&n(2,i=c.$$scope)},[t,o,i,l,a,s]}class Be extends oe{constructor(e){super(),le(this,e,xo,Yo,ne,{})}}let Xt=Pe(null),Vt=Pe(null);const ro="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAACmlBMVEXo6uzn6e3o6u7n6ezn6uzm6Ozn6evo6ezm6evo6e3p6u7p6+3p6u3o6u3n6u3n6evn6evn6ezo6uzo6u3n6evn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezo6uzo6uzo6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezo6+3n6ezn6ezn6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6ezn6e3n6e3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6e3o6u3o6uzo6uzo6u3o6u3o6u3n6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6uzn6ezn6e3o6u3o6u3o6u3o6u3o6u3n6u3n6ezo6u3o6u3o6uzn6uzn6ezo6ezo6uzn6ezo6u3o6u3o6u3n6u3n6Ozm6ezn6ezo6u3o6u3o6uzo6u3n6u3o6e3o6u3o6u3o6u3n6u3n6ezo6uzo6u3o6u3n6+3o6uzo6u3o6u3o6uzo6uzn6uzn6uzn6ezn6ezn6ezn6ezo6u3n6ezo6ezn6ezn6ezn6ezn6ezn6e3o6u3o6e3n6ezn6ezo6uzn6evo6uzo6uzn6evn6ezo6u3n6ezn6uzo6u3n6ezn6ezo6u3n6u3n6ezo6u3o6u3n6ezn6u3o6u3o6u3n6ezo6u3n6u3n6ezn6ezo6u3n6ezo6u3n6e3n6uzn6ezn6ezn6ezn6ezn6ezn6ezo6u3o6u3n6ezn6ezo6u3o6e3o6u3n6e3o6u3n6u3n6uzo6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6evo6u3o6u3o6u3n6uvn6ezo6u3n6uzn6ezn6ezn6ezo6u3n6uzn6uzo6u3n6u3n6uzo6+zm6uzjK5F0AAAA3nRSTlMAAAAAAAAAAAAAAAAAAAAIDxIUFBMDKEVdbn2IjpOWlpCJb15HKgUACXqjwtrt/P/u3MSmSg0gc7vz4dnSz83U5fT3vnciCnPV8MCdg2JYUk5LU1pmdoyoy/rYdApBt31IIyMjIyyI0LY/AABh366lq19s6GnraXg8PHsAAwOEeF0MKiEiCymqnFmeqXsncN6sOTuuDYzPTlCJCHhyOjyxcGfmkhotgqFcrYIrHONkymEKEC8mLg9jzMhNmr1XVVi/mCSz79ddrI6v3FooDSsAQ6OCFReFoi48GTwtAAD3GpCFAAADBklEQVR4nKWUh1IUQRCGZ+nx8JRZMcspoiKekfbMomDABAaSCbNwxhPMgmLOCTFnxZxzzlkxY86+i927BxzeUmWVf+1O1c5+09Pd09NCaJoWAFJCOQAb0GuzQSAPAOXppVlhD6hQMUgIJpUECUxpviCAxoOuKlRUShikMmYMk5WCK1epWi24UgloDwhSBOqKSTtNVa9Rs1aIo3ad0LphofXqOxqEN4xoxLDBKaGcTiU0pRo3bNK0WfMWkehVZEtXq9aONm1Ne0oXQHuT0XbtO3Sk3y2jOnWOjomJ7tK8azf67B7boydTJMFeBIpevftgXHzffiH9ByQkJiUlJqcMHDR4yNBUHDZ8hG5IlCMBjByF0aPHjE1Loyfd7U5Lc7vd6eOSx0/AiZN0jSUmTyaTnikZmDnVQtPQNZ0ou10JMy8zWmAZmjmLIyeLdkMExloKZ8/x+lgEpmZlz/XXvMjZc3IM+YA2ofxkDVqQ/wn+69bzF/jLClxoqUi/9JSVcD+LGGUpfzB10WILzfPfmqKGJUuXcXkaguURK0BYgysdq1avCTRQCSlr163PVdbghjzEjZvoflJJbd6C6ArRLcGt2yjI7TvMq7qzM33s2u0DFtVj6h7YG4WYuY8sKoD9+YgZB2A9gdKQFzx4CA8fOXos8/gJ8+g0CD9+8tTpM2F49hyAAZotYedQPH/h4qXLV6D4mHOvXltx/QbevMX/PR4vmHsb8U7W3XuldD/rAeLDR5wrqixza0h+jPjk6V+KQ8xPgKLUeslneVYn7Uqhm2UD7lFgNizFYMHzUnqB+PIVJ4uyYGdQY98ZXPX6jY/eFpggo+yjt64NsIZPceuni0GW6WehzfbufXzsh48l2ZGeT59j47+MNHowg4WFheahff327Ts5UwQScCT7x0/JfYdbrDA8oBauSUkhUUP1ngx4aJEOimbNJsVBM6dLyUFpmtcesHFdCiWVMkGbzNFB1xWBupPnDFzzcDJotXJKJ22kCeJyqFupXyaoVCAw+JuzrGi5cOqSurf2B4tMU69Bi01ZAAAAAElFTkSuQmCC",oo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMA/1uRIrUAAAjuSURBVHic7dxLlqM2FAZgCOdEGUUZZtCntZPWlrKCiKwgW2IpZAdkxoBAbJCEHle27r3UoxNr0KdMoc9Y/HoArm6aV3mVV/m/lHYbeIDaFh6wbVvPqd/dgJEDyBswcwB9A1YOYG7AxgHu9Tmt2O3ASAfEDkx0QO4A4zSwAbUDjDDrHWAEYY8BJwhs4KhPT1JrgeHDgM4C4/cLCAuQe9PHA9IC5O74Al7AC/hswHc8IrGBj58XPn5ydUBPBdgLjE+wRtJ7fcYyT+0AY6HJXuqyV+vs64WWF8SGf8nDv+hSvLN4wYUn+9KXffHNv/xvmAfwKq/yKq/yKv+p0rImxua+TBt4B8Ccm++LLNZN4X15wAI0c4nVMBd5xzKRscw8Vrqc06CYS+1jlcg4jy33ckNwr5gUF9DMq0Z30UcG2FfOkgso7t0DwwTclTcZEFzANQG5O2ousDGBjgtILqC5gGECPkZUQHABFQK/EAATAr8SgC0EvuDrdxHwFQ/ICFB4QMdAjwa2GBiw9dsEGLGASAD0oKQSAB1GkwDoNcLGBLoUwC4yRApgFxk50OMAmQEDDlAZMOIAnQHIJOUAMkkmA5BByAFkEHIAGYQtB3ouMHCBkQvgggAAqCC4EfGfAEAFwQF/BwAqCA74KwBQQXDAHyHQ44G1DYEBD8wRMCIAO6aOEYAJggX6CMAE4QDWJgIwQehsvQjABME9mokATBCOaaFPgB4JrE0CDEhgSYERCcwpgAgCDCCCAAOIIEgQQAQBBhBBkLbNEqDnAgMXGLlAfRDUGwH1SXLRT4D6JBWA+iQVgPok6QLQc4GBC4woYAgAu/StDkIGCPcDFbBTVXUQTAq46ZoMuEUTHTC4IBi78wloXBByAJmkHJC4JG0ZILhAh4uiO2Un0HKBBpdlADBcQGOAFgAUF0B9KWevt8aA4AIdF2gxQAcADRswXEBjgSUBFBdwiw4yIBCAgIBdHRlAiwXO9Nimu/80cADDBe5B6DnAPQh19c/HlBEg6yfXFFjccdVO7z500aze1o/qKWA/ev3ElAH9vllXz+4ZMOybu+olkoKB+uIBt7IZKcAYANj72jIFsPe1T8CESWIA2NvSJ6CjJOGA4f6TipJUXUQGDFSA+OC480ctuIB7TIBMUmsb/iffGbBJsqf+i48iNkm2yhdyksxx0N/ISdJHs2lykuRx4kzvgzDgAHHUuP1DTFJ7fOgbQP0DBnNMKyM1Se44JnKS9tIFF4yk7+OIezVikiywkpO0F3mvRkySA8hJ2ovagiCMBEBvzCDsXYoTBLO/LyMIW3jngAiwktQe1ehJsmMzPUl2dqAnyU5w9CSJoxo9SXaxR0+SWzGTk6Q2ZhD0FgWBCARBQANmi4PQ04AzCAMWcNWo39BrXTVqkvy9K2qSOn/gxCR1vumISRIe0LQgSH/2iUk6AWKSlH9bYpK0bzlikk7ABQGZJHOefA5w3sRCRzGopClRDG/jqg8Bzr7kk4TrDGdf8knCASIAXJJQwNkV0jshBAD7gGQvKqxjCN1Rhe2mCYAOAUUAgr7kG2QgA4IARB0wjCUOsENAiweSZyp4IDloE3HvAiTtrqlAb1+q8JxUFRkD+D97jvqSOyDMmBb1JdemGEBzARPXaGPvPYCoL9GBKXldXz97PokFsgEgzhUBMEggG8OIwFlBJ+CzIrlA0pcuAFTSqM9K0peoQND7VBKsZ8WkgEQCSV+6AEA9NYae9dOAMQWqx7R8NkYOivl6gAb0KVA9pmV9CTsoZl2BDyAHxawv0YCozbNWeViyvoQdFLOucBkw1NWHvjejCcBIBqCVrco3lQu0tr4IqBzT8r6EHBQlkFsUAPQl3KAI9KV3BoC+hBsUDfBuKADoS6hRFfwOGmZQBK/RMAB8lQhko1Tg69T3BKC+hBoUob6EAqC+hBpVoa6AGhTZANSXUIMi1JdQANSXMEDh+5zlQbENT7BeQkAFvcIB7q813d95JIBZwr6UA3MjZxiwh2Pm8EZgCIgE6IqAYAG3Dxn0pRBwg6JYQMDl7rZzJdAWAVurIQH3/9b7qLWmgBsUuxUElhPQdUBTBMzmNxzWET+br6dAH/alEGgeA/7k9sBN9RjwkXkMTBlwHNlt98dA1BkBoC8AvotFExsM9Me+ugCEN9UjQL8tMB4b5er/qq4MDMe+qgCIEqBwQIMEhgRYc0AmgIQA9RTYv6FTASxFoIOB/jkgEkBAgF794FkGphpgygE7ihaABgTMFhxOCnQQYFwSxwJwG1TDZwY5sJWB9hGwpsCQA83xowfah0BfAO4T1yNgcwMKBBgLLACwpEADAHpvGxXsDAH9OVyngNrb5iHQPgTk/tF08HlPYA4Ac4IxIOx3Os4Wh4BjbpwhoLXfKnkAdJudnUHg9nLatwHAGe9jfTCBwP4fOZyx1QVA+iRnT6x/O/YuA+L+U+eTDD3y7rYtmBg8MAZA8B6PAQUCc9jOR/1o4S5gYPC/Xe6/mMqAPAGZA3LfWfjLCgDQ0d4AANyBiwADA+dBAfcAI2CLPnAKqC2+sMuBcCItAMNDQBSA5gTGh4AKgC4H9BnKArBHa3oIzI+AY8TNgTUA0iaPNqkQaGFgKwPdn9sTwARnGQLs6zkDlhAYa4GmAMxFIP12Vg4cv38KLBkwRxV8ElyFtQCYApBVqAZKFUqvT2CiAboEpI3mB5m3A8ZjQ1cJnL3/8wDDsUHUAv3xUpaAuQSYNwP8hkrAv+HnAZoYmEqAjoEuBVQC+P9uKwXGq4GVCLQpoGuB6WpgSX4/loD0M6aAqQXmq4GZCpirAbf/8AxYEmCqBWQC6IuBthpYE2CkAupiwO/f29+LFEg3OGB4BpRE+WmA/tn+pQ3irYCmBKQf0gHuE9UDrtU+C5BOCxXAeLxuYWAtAu0bAQsZaGJA1wPTtcBMB36PAGN/66/yfDAGt8VtmK8FJjrwLQK2emC5FhjpwFcQmMtA2kwR0CKANQIGOvDzpUCHALYI6BNgKgM6AX68FBAYoA+Bhg78cCkgM0C5LeNDIHu/sQz4LUPzKq/yKq9yefkXR6tlrDrSxQ4AAAAASUVORK5CYII=";let fn="MZEJTanw3WpxRvt7qDfo";async function dn(r){if(r!="google")return`https://api.maptiler.com/maps/${r}/style.json?key=${fn}`;let e=new URLSearchParams(window.location.search).get("google")||"";return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await el(e)}&key=${e}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${fn}`}}async function el(r){try{let n=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${r}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB",layerTypes:["layerRoadmap"],overlay:!1})})).json();return"session"in n?n.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(n)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}function ye(){return["","2","1","0","Critical"]}let Ge=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],Qe={SA01:{description:"Pedestrian and cyclist conflict with motor traffic at side roads/priority junctions",green:"Side roads/priority junctions have entry treatments that offer greater protection for  pedestrian and cycle movements (e.g. exit only, continuous footways, zebra/parallel crossings as appropriate to context).",amber:"<2,500vpd cut across main walking, wheeling or cycling streams and side roads and priority junctions have entry treatments. ",red:"<2,500vpd cut across main walking, wheeling or cycling streams, but side roads and priority junctions are untreated.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA02:{description:"Pedestrian and cyclist conflict with motor traffic at roundabouts and signal-controlled junctions",green:"All pedestrian and cyclist movements are separated from all motor traffic movements at roundabouts and/or signal controlled junctions.",amber:"The principal pedestrian and cyclist movements are separated from motor traffic movements at roundabouts and/or signal controlled junctions.",red:"The principal pedestrian and/or cyclist movements are in conflict with motor traffic movements at roundabouts and/or signal controlled junctions.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA03:{description:"Effect of lane widths on conflict between cyclists and motor traffic",green:"Cyclists are protected from motor traffic or off-road entirely.",amber:`Cyclists are in cycle lanes with light protection or stepped cycle tracks under 1.8m wide (single direction).

Or, cyclists are in a protected bidirectional cycle facility under 2.5m wide.

Or, cyclists are mixed with traffic on quiet urban streets with no centre line.`,red:`Cyclists are mixed with traffic in lanes less than 3.25m wide or over 3.9m wide.

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is under 3.25m or over 3.9m. 

Or cyclists are mixed with traffic on busy urban streets with no centre line.

Or, there are speed cushions present.`,critical:`Cyclists are mixed with traffic in lanes between 3.25m and 3.9m wide. 

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is between 3.25m and 3.9m.`},SA04:{description:"Risk of pedestrians tripping due to hazards",green:"No trip hazards, level clear surface.",amber:"Few trip hazards.",red:"Many trip hazards.",critical:"There are level differences of greater than 13mm with no tactile information and colour contrast to help identify them."},SA05:{description:"Cyclist conflict with kerbside activity, including risk of 'dooring' ",green:"Kerbside activity is well-managed with no or minimal conflict with cyclists. ",amber:"Less frequent kerbside activity, and conflict with cyclists is well-managed.",red:"Frequent kerbside activity for cyclists to contend with. Conflict with cyclists is not well-managed.",critical:`Cycle facility next to parking/loading facility, without a buffer of at least 0.5m.

Or, an unprotected cycle lane is next to a frequently-used bus layby.`},SA06:{description:"Ability of pedestrians to cross the street safely on desire lines",green:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 50-100m. 

On quieter streets (<8,000vpd), there are controlled crossings or only one lane of traffic to cross.`,amber:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 100-200m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross on desire lines.`,red:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 200-400m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross.`,critical:`On very busy streets (>8,000vpd) controlled crossings (including zebra crossings) are not present or more than 400m apart.

On quieter streets (<8,000vpd), desire lines are blocked by parking and loading. `},SA07:{description:"Suitability of pedestrian crossings in context",green:`On very busy streets (>8,000vpd), signal crossings rest on green for pedestrians or have rapid response.

On quieter streets (<8,000vpd), crossing points are controlled crossings.`,amber:`On very busy streets (>8,000vpd), signal crossings are provided for pedestrians.

On quieter streets (<8,000vpd), crossing points have effective implied priority for pedestrians.`,red:`On very busy streets (>8,000vpd), there are uncontrolled crossings or zebra/parallel crossings.

On quieter streets (<8,000vpd), crossing points have no implied priority or there are no crossing points.`,critical:`On very busy streets (>8,000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic.

At signal junctions there are arms with dropped kerbs and tactile paving but no green pedestrian symbol.`},SA08:{description:"85th percentile speed of motor traffic (where cyclists are not protected or pedestrians are crossing uncontrolled)",green:`85th percentile speed is under 20mph.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:"85th percentile speed is between 20mph and 25mph.",red:"85th percentile speed is over 25mph.",critical:"85th percentile speed is over 30mph."},SA09:{description:"Volume of motor traffic at the busiest hour (where cyclists are not protected or pedestrians cross uncontrolled)",green:`<200 vehicles in the busiest hour.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:`200-499 vehicles in the busiest hour.

And, less than 2% of traffic is HGVs.`,red:`500-1,000 vehicles in the busiest hour.

Or, 2-5% of traffic is HGVs where there are 200-499 vehicles in the busiest hour.`,critical:`>1,000 vehicles in the busiest hour.

Or, over 5% of traffic is HGVs where there are over 500 vehicles in the busiest hour.`},SA10:{description:"Required crossing speed at signal crossings (risk of pedestrians coming into conflict with traffic).",green:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1m/s.",amber:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1.2m/s.",red:"There are no detectors to extend crossing times, but pedestrians who start crossing at the end of the 'invitation to cross' can cross at a speed of 1.2m/s and get across the whole crossing in time.",critical:"Pedestrians who start crossing at the end of the 'invitation to cross' must cross at a speed of over 1.2m/s to get across the whole crossing in time."},SA11:{description:"Clear walking and wheeling spaces free of permanent obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",green:">3m clear footway width and pedestrian comfort is good (PCL of A-C).",amber:`Where the footway is next to the carriageway, there is:
• 2m-3m clear footway width and pedestrian comfort is good (PCL of A-C).
• >3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is 1.5m-3m.`,red:`Where the footway is next to the carriageway, there is:
• <2m clear footway width but pedestrian comfort is good (PCL of A-C)
• 2m-3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is <1.5m.`,critical:`Where the footway is next to the carriageway, there is:
• <1m clear footway width on any footway
• <1.5m clear footway width for over 6m
• 1m-2m clear footway width with a Pedestrian Comfort Level of D-E

Or there is no footway.`},SA12:{description:"Effective width next to tram line on a straight run or a curve",green:"Physical protection is provided for cyclists.",amber:">2.4m from tramline edge to kerb.",red:"2.4m from tramline edge to kerb.",critical:`<2.4m from tramline edge to kerb on a straight run.

Insufficient clearance on a curve.`},SA13:{description:"Crossing angle (between cyclist desire line and tram or train rails).",green:"Crossing angle between 80 and 90 degrees with track filler creating a smooth crossing for cyclists.",amber:"Crossing angle between 80 and 90 degrees (or between 60 and 80 degrees with track filler creating a smooth crossing for cyclists).",red:"Crossing angle between 60 and 80 degrees.",critical:"Crossing angle less than 60 degrees."},SA14:{description:`Cycling surface and maintenance defects:
• sharp gradients (≥12.5%)
• non cycle friendly ironworks
• raised/sunken covers or gullies
• potholes
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA15:{description:`Walking/wheeling surface and maintenance defects:
• steep camber (horizontal gradient >2.5% )
• steep longitudinal gradients (≥8% if under 1m, ≥5% if 1m or over) 
• missing dropped kerbs
• non flush tables
• misleading tactile information
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation
`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA16:{description:"Presence of guard railing",green:"No guard railing anywhere on the route.",amber:"Minimal guard railing, used to address a clear safety issue such as a level difference.",red:"Guard railing used to control behaviour in complex environments.",critical:"Guard railing used as standard without consideration of inherent safety risks."},ST20:{description:"Interactions at bus stops.",green:"At bus stops, cyclists are protected from buses and traffic and interactions between pedestrians and cyclists are likely to be low-level.",amber:"At bus stops, cyclists are protected from buses and traffic, but there are likely to be medium-level interactions between pedestrians and cyclists.",red:"At bus stops, cyclists regularly have to wait behind buses or overtake them in general traffic lanes. Or, there are likely to be high-level interactions between pedestrians and cyclists.",critical:""}};function pn(r){let e,n,t,o=r[0].critical+"",l;return{c(){e=v("p"),n=v("b"),n.textContent="Critical",t=I(`
    : `),l=I(o)},m(i,a){A(i,e,a),m(e,n),m(e,t),m(e,l)},p(i,a){a&1&&o!==(o=i[0].critical+"")&&re(l,o)},d(i){i&&C(e)}}}function tl(r){let e,n,t,o=r[0].green+"",l,i,a,s,c,u=r[0].amber+"",f,d,p,_,j,D=r[0].red+"",g,$,h,b=r[0].critical&&pn(r);return{c(){e=v("p"),n=v("b"),n.textContent="2",t=I(`
  : `),l=I(o),i=M(),a=v("p"),s=v("b"),s.textContent="1",c=I(`
  : `),f=I(u),d=M(),p=v("p"),_=v("b"),_.textContent="0",j=I(`
  : `),g=I(D),$=M(),b&&b.c(),h=qe()},m(S,w){A(S,e,w),m(e,n),m(e,t),m(e,l),A(S,i,w),A(S,a,w),m(a,s),m(a,c),m(a,f),A(S,d,w),A(S,p,w),m(p,_),m(p,j),m(p,g),A(S,$,w),b&&b.m(S,w),A(S,h,w)},p(S,[w]){w&1&&o!==(o=S[0].green+"")&&re(l,o),w&1&&u!==(u=S[0].amber+"")&&re(f,u),w&1&&D!==(D=S[0].red+"")&&re(g,D),S[0].critical?b?b.p(S,w):(b=pn(S),b.c(),b.m(h.parentNode,h)):b&&(b.d(1),b=null)},i:ie,o:ie,d(S){S&&(C(e),C(i),C(a),C(d),C(p),C($),C(h)),b&&b.d(S)}}}function nl(r,e,n){let{metric:t}=e;return r.$$set=o=>{"metric"in o&&n(0,t=o.metric)},[t]}class tt extends oe{constructor(e){super(),le(this,e,nl,tl,ne,{metric:0})}}function mn(r,e,n){const t=r.slice();return t[11]=e[n][0],t[12]=e[n][1],t}function gn(r,e,n){const t=r.slice();return t[11]=e[n][0],t[12]=e[n][1],t}function rl(r){let e,n,t,o,l,i;const a=r[5].default,s=De(a,r,r[4],null);let c=x(r[2]),u=[];for(let f=0;f<c.length;f+=1)u[f]=_n(mn(r,c,f));return{c(){e=v("label"),s&&s.c(),n=M(),t=v("select");for(let f=0;f<u.length;f+=1)u[f].c();r[0]===void 0&&zo(()=>r[10].call(t))},m(f,d){A(f,e,d),s&&s.m(e,null),m(e,n),m(e,t);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(t,null);on(t,r[0],!0),o=!0,l||(i=[J(t,"change",r[10]),J(t,"change",r[7])],l=!0)},p(f,d){if(s&&s.p&&(!o||d&16)&&Te(s,a,f,f[4],o?Ie(a,f[4],d,null):Ne(f[4]),null),d&4){c=x(f[2]);let p;for(p=0;p<c.length;p+=1){const _=mn(f,c,p);u[p]?u[p].p(_,d):(u[p]=_n(_),u[p].c(),u[p].m(t,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=c.length}d&5&&on(t,f[0])},i(f){o||(k(s,f),o=!0)},o(f){y(s,f),o=!1},d(f){f&&C(e),s&&s.d(f),pe(u,f),l=!1,Ae(i)}}}function ol(r){let e,n,t,o;const l=r[5].default,i=De(l,r,r[4],null);let a=x(r[2]),s=[];for(let c=0;c<a.length;c+=1)s[c]=hn(gn(r,a,c));return{c(){e=v("fieldset"),i&&i.c(),n=M(),t=v("div");for(let c=0;c<s.length;c+=1)s[c].c();F(t,"class","svelte-1vb210n"),ve(t,"horiz_radio",r[1]=="horiz-radio")},m(c,u){A(c,e,u),i&&i.m(e,null),m(e,n),m(e,t);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(t,null);o=!0},p(c,u){if(i&&i.p&&(!o||u&16)&&Te(i,l,c,c[4],o?Ie(l,c[4],u,null):Ne(c[4]),null),u&5){a=x(c[2]);let f;for(f=0;f<a.length;f+=1){const d=gn(c,a,f);s[f]?s[f].p(d,u):(s[f]=hn(d),s[f].c(),s[f].m(t,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=a.length}(!o||u&2)&&ve(t,"horiz_radio",c[1]=="horiz-radio")},i(c){o||(k(i,c),o=!0)},o(c){y(i,c),o=!1},d(c){c&&C(e),i&&i.d(c),pe(s,c)}}}function _n(r){let e,n=r[12]+"",t;return{c(){e=v("option"),t=I(n),e.__value=r[11],$e(e,e.__value)},m(o,l){A(o,e,l),m(e,t)},p:ie,d(o){o&&C(e)}}}function hn(r){let e,n,t,o=r[12]+"",l,i,a,s,c;return a=Wt(r[9][0]),{c(){e=v("label"),n=v("input"),t=M(),l=I(o),i=M(),F(n,"type","radio"),n.__value=r[11],$e(n,n.__value),a.p(n)},m(u,f){A(u,e,f),m(e,n),n.checked=n.__value===r[0],m(e,t),m(e,l),m(e,i),s||(c=[J(n,"change",r[8]),J(n,"change",r[6])],s=!0)},p(u,f){f&5&&(n.checked=n.__value===u[0])},d(u){u&&C(e),a.r(),s=!1,Ae(c)}}}function ll(r){let e,n,t,o;const l=[ol,rl],i=[];function a(s,c){return s[1]=="horiz-radio"||s[1]=="vert-radio"?0:s[1]=="dropdown"?1:-1}return~(e=a(r))&&(n=i[e]=l[e](r)),{c(){n&&n.c(),t=qe()},m(s,c){~e&&i[e].m(s,c),A(s,t,c),o=!0},p(s,[c]){let u=e;e=a(s),e===u?~e&&i[e].p(s,c):(n&&(ae(),y(i[u],1,1,()=>{i[u]=null}),ce()),~e?(n=i[e],n?n.p(s,c):(n=i[e]=l[e](s),n.c()),k(n,1),n.m(t.parentNode,t)):n=null)},i(s){o||(k(n),o=!0)},o(s){y(n),o=!1},d(s){s&&C(t),~e&&i[e].d(s)}}}function il(r,e,n){let{$$slots:t={},$$scope:o}=e,{k:l}=e,{value:i}=e,{choices:a}=e,s=a[0].length==2?a:a.map(_=>[_,_]);const c=[[]];function u(_){Ce.call(this,r,_)}function f(_){Ce.call(this,r,_)}function d(){i=this.__value,n(0,i),n(2,s)}function p(){i=So(this),n(0,i),n(2,s)}return r.$$set=_=>{"k"in _&&n(1,l=_.k),"value"in _&&n(0,i=_.value),"choices"in _&&n(3,a=_.choices),"$$scope"in _&&n(4,o=_.$$scope)},[i,l,s,a,o,t,u,f,d,c,p]}class Le extends oe{constructor(e){super(),le(this,e,il,ll,ne,{k:1,value:0,choices:3})}}let It=Pe(void 0),H=Pe(sl());function de(r){return{type:"FeatureCollection",features:r}}let W=Pe({kind:"neutral"}),Yt=Pe(new URLSearchParams(window.location.search).has("google")?"google":"dataviz");function lo(r){return"links"in r&&"jats"in r&&"bus_stops"&&"crossings"in r&&"side_roads"in r}function sl(){try{let r=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if(lo(r))return r}catch{}return{links:[],jats:[],bus_stops:[],crossings:[],side_roads:[]}}function $n(r){let e,n;return e=new we({props:{data:de(r[3].links),$$slots:{default:[al]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&8&&(l.data=de(t[3].links)),o&22&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function al(r){let e,n;return e=new Me({props:{paint:{"line-color":r[1]=="links"?["get","color"]:"black","line-width":r[1]=="links"&&r[2]?["case",["to-boolean",r[2]],6,15]:6}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&6&&(l.paint={"line-color":t[1]=="links"?["get","color"]:"black","line-width":t[1]=="links"&&t[2]?["case",["to-boolean",t[2]],6,15]:6}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function bn(r){let e,n;return e=new we({props:{data:de(r[3].bus_stops),$$slots:{default:[cl]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&8&&(l.data=de(t[3].bus_stops)),o&22&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function cl(r){let e,n;return e=new et({props:{layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":r[1]=="bus_stops"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":r[1]=="bus_stops"&&r[2]?["case",["to-boolean",r[2]],0,5]:0}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&6&&(l.paint={"icon-color":t[1]=="bus_stops"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":t[1]=="bus_stops"&&t[2]?["case",["to-boolean",t[2]],0,5]:0}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function kn(r){let e,n;return e=new we({props:{data:de(r[3].crossings),$$slots:{default:[ul]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&8&&(l.data=de(t[3].crossings)),o&22&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ul(r){let e,n;return e=new et({props:{layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":r[1]=="crossings"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":r[1]=="crossings"&&r[2]?["case",["to-boolean",r[2]],0,5]:0}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&6&&(l.paint={"icon-color":t[1]=="crossings"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":t[1]=="crossings"&&t[2]?["case",["to-boolean",t[2]],0,5]:0}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function wn(r){let e,n;return e=new we({props:{data:de(r[3].jats),$$slots:{default:[fl]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&8&&(l.data=de(t[3].jats)),o&18&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function fl(r){let e,n;return e=new Ve({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-color":r[1]=="jats"?["get","color"]:"black","circle-radius":20}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&2&&(l.paint={"circle-color":"rgba(0,0,0,0)","circle-stroke-color":t[1]=="jats"?["get","color"]:"black","circle-radius":20}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function vn(r){let e,n;return e=new we({props:{data:de(r[3].side_roads),$$slots:{default:[dl]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&8&&(l.data=de(t[3].side_roads)),o&22&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function dl(r){let e,n;return e=new Me({props:{paint:{"line-color":r[1]=="side_roads"?["get","color"]:"black","line-width":r[1]=="side_roads"&&r[2]?["case",["to-boolean",r[2]],3,6]:3}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&6&&(l.paint={"line-color":t[1]=="side_roads"?["get","color"]:"black","line-width":t[1]=="side_roads"&&t[2]?["case",["to-boolean",t[2]],3,6]:3}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function pl(r){let e,n,t,o,l,i,a=r[0]!="links"&&$n(r),s=r[0]!="bus_stops"&&bn(r),c=r[0]!="crossings"&&kn(r),u=r[0]!="jats"&&wn(r),f=r[0]!="side_roads"&&vn(r);return{c(){a&&a.c(),e=M(),s&&s.c(),n=M(),c&&c.c(),t=M(),u&&u.c(),o=M(),f&&f.c(),l=qe()},m(d,p){a&&a.m(d,p),A(d,e,p),s&&s.m(d,p),A(d,n,p),c&&c.m(d,p),A(d,t,p),u&&u.m(d,p),A(d,o,p),f&&f.m(d,p),A(d,l,p),i=!0},p(d,[p]){d[0]!="links"?a?(a.p(d,p),p&1&&k(a,1)):(a=$n(d),a.c(),k(a,1),a.m(e.parentNode,e)):a&&(ae(),y(a,1,1,()=>{a=null}),ce()),d[0]!="bus_stops"?s?(s.p(d,p),p&1&&k(s,1)):(s=bn(d),s.c(),k(s,1),s.m(n.parentNode,n)):s&&(ae(),y(s,1,1,()=>{s=null}),ce()),d[0]!="crossings"?c?(c.p(d,p),p&1&&k(c,1)):(c=kn(d),c.c(),k(c,1),c.m(t.parentNode,t)):c&&(ae(),y(c,1,1,()=>{c=null}),ce()),d[0]!="jats"?u?(u.p(d,p),p&1&&k(u,1)):(u=wn(d),u.c(),k(u,1),u.m(o.parentNode,o)):u&&(ae(),y(u,1,1,()=>{u=null}),ce()),d[0]!="side_roads"?f?(f.p(d,p),p&1&&k(f,1)):(f=vn(d),f.c(),k(f,1),f.m(l.parentNode,l)):f&&(ae(),y(f,1,1,()=>{f=null}),ce())},i(d){i||(k(a),k(s),k(c),k(u),k(f),i=!0)},o(d){y(a),y(s),y(c),y(u),y(f),i=!1},d(d){d&&(C(e),C(n),C(t),C(o),C(l)),a&&a.d(d),s&&s.d(d),c&&c.d(d),u&&u.d(d),f&&f.d(d)}}}function ml(r,e,n){let t;ee(r,H,a=>n(3,t=a));let{except:o}=e,{showColor:l=""}=e,{showMissingProperty:i=null}=e;return r.$$set=a=>{"except"in a&&n(0,o=a.except),"showColor"in a&&n(1,l=a.showColor),"showMissingProperty"in a&&n(2,i=a.showMissingProperty)},[o,l,i,t]}class Ue extends oe{constructor(e){super(),le(this,e,ml,pl,ne,{except:0,showColor:1,showMissingProperty:2})}}function yn(r,e,n){const t=r.slice();return t[6]=e[n],t[7]=e,t[8]=n,t}function An(r){let e,n,t=r[6].properties.name+"",o,l,i,a,s,c;function u(d){r[5](d,r[6])}let f={k:"horiz-radio",choices:ye()};return r[6].properties.st20!==void 0&&(f.value=r[6].properties.st20),i=new Le({props:f}),fe.push(()=>me(i,"value",u)),{c(){e=v("li"),n=v("span"),o=I(t),l=M(),L(i.$$.fragment),s=M(),Y(n,"color",r[6].properties.color)},m(d,p){A(d,e,p),m(e,n),m(n,o),m(e,l),B(i,e,null),m(e,s),c=!0},p(d,p){r=d,(!c||p&2)&&t!==(t=r[6].properties.name+"")&&re(o,t),p&2&&Y(n,"color",r[6].properties.color);const _={};!a&&p&2&&(a=!0,_.value=r[6].properties.st20,ge(()=>a=!1)),i.$set(_)},i(d){c||(k(i.$$.fragment,d),c=!0)},o(d){y(i.$$.fragment,d),c=!1},d(d){d&&C(e),E(i)}}}function gl(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_=x(r[1].bus_stops),j=[];for(let g=0;g<_.length;g+=1)j[g]=An(yn(r,_,g));const D=g=>y(j[g],1,1,()=>{j[g]=null});return u=new tt({props:{metric:r[2]}}),{c(){e=v("div"),n=v("button"),n.textContent="Done",t=M(),o=v("h2"),o.textContent="ST20: bus stops",l=M(),i=v("p"),i.textContent=`${r[2].description}`,a=M(),s=v("ol");for(let g=0;g<j.length;g+=1)j[g].c();c=M(),L(u.$$.fragment),F(e,"slot","sidebar")},m(g,$){A(g,e,$),m(e,n),m(e,t),m(e,o),m(e,l),m(e,i),m(e,a),m(e,s);for(let h=0;h<j.length;h+=1)j[h]&&j[h].m(s,null);m(e,c),B(u,e,null),f=!0,d||(p=J(n,"click",r[4]),d=!0)},p(g,$){if($&2){_=x(g[1].bus_stops);let h;for(h=0;h<_.length;h+=1){const b=yn(g,_,h);j[h]?(j[h].p(b,$),k(j[h],1)):(j[h]=An(b),j[h].c(),k(j[h],1),j[h].m(s,null))}for(ae(),h=_.length;h<j.length;h+=1)D(h);ce()}},i(g){if(!f){for(let $=0;$<_.length;$+=1)k(j[$]);k(u.$$.fragment,g),f=!0}},o(g){j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)y(j[$]);y(u.$$.fragment,g),f=!1},d(g){g&&C(e),pe(j,g),E(u),d=!1,p()}}}function _l(r){let e,n,t;return n=new Ue({props:{showColor:"bus_stops",except:"",showMissingProperty:["get","st20"]}}),{c(){e=v("div"),L(n.$$.fragment),F(e,"slot","map")},m(o,l){A(o,e,l),B(n,e,null),t=!0},p:ie,i(o){t||(k(n.$$.fragment,o),t=!0)},o(o){y(n.$$.fragment,o),t=!1},d(o){o&&C(e),E(n)}}}function hl(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[_l],sidebar:[gl]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J(window,"keydown",r[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function $l(r,e,n){let t,o;ee(r,W,c=>n(0,t=c)),ee(r,H,c=>n(1,o=c));let l=Qe.ST20;function i(c){c.key=="Escape"&&X(W,t={kind:"neutral"},t)}const a=()=>X(W,t={kind:"neutral"},t);function s(c,u){r.$$.not_equal(u.properties.st20,c)&&(u.properties.st20=c,H.set(o))}return[t,o,l,i,a,s]}class bl extends oe{constructor(e){super(),le(this,e,$l,hl,ne,{})}}function kl(r){let e,n;const t=r[4].default,o=De(t,r,r[6],null);return{c(){e=v("span"),o&&o.c(),F(e,"class","dot svelte-117v9mi"),ve(e,"outline",r[3]),Y(e,"background-color",r[3]?void 0:r[1]),Y(e,"border-color",r[3]?r[1]:void 0),Y(e,"width",r[2]),Y(e,"height",r[2])},m(l,i){A(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&64)&&Te(o,t,l,l[6],n?Ie(t,l[6],i,null):Ne(l[6]),null),(!n||i&8)&&ve(e,"outline",l[3]),i&10&&Y(e,"background-color",l[3]?void 0:l[1]),i&10&&Y(e,"border-color",l[3]?l[1]:void 0),i&4&&Y(e,"width",l[2]),i&4&&Y(e,"height",l[2])},i(l){n||(k(o,l),n=!0)},o(l){y(o,l),n=!1},d(l){l&&C(e),o&&o.d(l)}}}function wl(r){let e,n,t;function o(i){r[5](i)}let l={draggable:!0,$$slots:{default:[kl]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.lngLat=r[0]),e=new Xe({props:l}),fe.push(()=>me(e,"lngLat",o)),{c(){L(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,[a]){const s={};a&78&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.lngLat=i[0],ge(()=>n=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function vl(r,e,n){let{$$slots:t={},$$scope:o}=e,{lngLat:l}=e,{color:i}=e,{radius:a="30px"}=e,{outline:s=!1}=e;function c(u){l=u,n(0,l)}return r.$$set=u=>{"lngLat"in u&&n(0,l=u.lngLat),"color"in u&&n(1,i=u.color),"radius"in u&&n(2,a=u.radius),"outline"in u&&n(3,s=u.outline),"$$scope"in u&&n(6,o=u.$$scope)},[l,i,a,s,t,c,o]}class en extends oe{constructor(e){super(),le(this,e,vl,wl,ne,{lngLat:0,color:1,radius:2,outline:3})}}const{window:yl}=at;function Al(r){let e;return{c(){e=I("ST20: bus stops")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Cl(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_;function j(g){r[8](g)}let D={k:"horiz-radio",choices:ye(),$$slots:{default:[Al]},$$scope:{ctx:r}};return r[1].bus_stops[r[0]].properties.st20!==void 0&&(D.value=r[1].bus_stops[r[0]].properties.st20),u=new Le({props:D}),fe.push(()=>me(u,"value",j)),{c(){e=v("div"),n=v("button"),n.textContent="Done",t=M(),o=v("button"),o.textContent="Delete bus stop",l=M(),i=v("label"),a=I(`Name:
      `),s=v("input"),c=M(),L(u.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(g,$){A(g,e,$),m(e,n),m(e,t),m(e,o),m(e,l),m(e,i),m(i,a),m(i,s),$e(s,r[1].bus_stops[r[0]].properties.name),m(e,c),B(u,e,null),d=!0,p||(_=[J(n,"click",r[6]),J(o,"click",r[4]),J(s,"input",r[7])],p=!0)},p(g,$){$&3&&s.value!==g[1].bus_stops[g[0]].properties.name&&$e(s,g[1].bus_stops[g[0]].properties.name);const h={};$&512&&(h.$$scope={dirty:$,ctx:g}),!f&&$&3&&(f=!0,h.value=g[1].bus_stops[g[0]].properties.st20,ge(()=>f=!1)),u.$set(h)},i(g){d||(k(u.$$.fragment,g),d=!0)},o(g){y(u.$$.fragment,g),d=!1},d(g){g&&C(e),E(u),p=!1,Ae(_)}}}function jl(r){let e,n;return e=new et({props:{filter:["!=",["id"],r[0]],layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Sl(r){let e,n;return{c(){e=v("img"),kt(e.src,n=ro)||F(e,"src",n),F(e,"alt","")},m(t,o){A(t,e,o)},p:ie,d(t){t&&C(e)}}}function zl(r){let e,n,t,o,l,i,a,s;n=new Ue({props:{except:"bus_stops"}}),o=new we({props:{data:de(r[1].bus_stops),generateId:!0,$$slots:{default:[jl]},$$scope:{ctx:r}}});function c(f){r[5](f)}let u={color:r[1].bus_stops[r[0]].properties.color,$$slots:{default:[Sl]},$$scope:{ctx:r}};return r[1].bus_stops[r[0]].geometry.coordinates!==void 0&&(u.lngLat=r[1].bus_stops[r[0]].geometry.coordinates),i=new en({props:u}),fe.push(()=>me(i,"lngLat",c)),{c(){e=v("div"),L(n.$$.fragment),t=M(),L(o.$$.fragment),l=M(),L(i.$$.fragment),F(e,"slot","map")},m(f,d){A(f,e,d),B(n,e,null),m(e,t),B(o,e,null),m(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].bus_stops)),d&513&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const _={};d&3&&(_.color=f[1].bus_stops[f[0]].properties.color),d&512&&(_.$$scope={dirty:d,ctx:f}),!a&&d&3&&(a=!0,_.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,ge(()=>a=!1)),i.$set(_)},i(f){s||(k(n.$$.fragment,f),k(o.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(n.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&C(e),E(n),E(o),E(i)}}}function Ml(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[zl],sidebar:[Cl]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J(yl,"keydown",r[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function Ll(r,e,n){let t,o;ee(r,H,d=>n(1,t=d)),ee(r,W,d=>n(2,o=d));let{idx:l}=e;function i(d){d.key=="Escape"&&X(W,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this bus stop?")&&(X(W,o={kind:"neutral"},o),await xe(),t.bus_stops.splice(l,1),H.set(t))}function s(d){r.$$.not_equal(t.bus_stops[l].geometry.coordinates,d)&&(t.bus_stops[l].geometry.coordinates=d,H.set(t))}const c=()=>X(W,o={kind:"neutral"},o);function u(){t.bus_stops[l].properties.name=this.value,H.set(t)}function f(d){r.$$.not_equal(t.bus_stops[l].properties.st20,d)&&(t.bus_stops[l].properties.st20=d,H.set(t))}return r.$$set=d=>{"idx"in d&&n(0,l=d.idx)},[l,t,o,i,a,s,c,u,f]}class Bl extends oe{constructor(e){super(),le(this,e,Ll,Ml,ne,{idx:0})}}function El(r){let e,n,t;function o(i){r[1](i)}let l={k:"dropdown",choices:Dl()};return r[0]!==void 0&&(l.value=r[0]),e=new Le({props:l}),fe.push(()=>me(e,"value",o)),{c(){L(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,[a]){const s={};!n&&a&1&&(n=!0,s.value=i[0],ge(()=>n=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Dl(){let r=[["streets","MapTiler Streets"],["dataviz","MapTiler Dataviz"],["uk-openzoomstack-light","OS Open Zoomstack"],["openstreetmap","OpenStreetMap"]];return new URLSearchParams(window.location.search).has("google")&&r.splice(0,1,["google","Google satellite"]),r}function Tl(r,e,n){let t;ee(r,Yt,l=>n(0,t=l));function o(l){t=l,Yt.set(t)}return[t,o]}class Nl extends oe{constructor(e){super(),le(this,e,Tl,El,ne,{})}}function Cn(r,e,n){const t=r.slice();return t[1]=e[n][0],t[2]=e[n][1],t}function jn(r){let e,n,t,o=r[1]+"",l,i;return{c(){e=v("li"),n=v("span"),t=M(),l=I(o),i=M(),F(n,"class","svelte-kzgqtg"),Y(n,"background",r[2])},m(a,s){A(a,e,s),m(e,n),m(e,t),m(e,l),m(e,i)},p(a,s){s&1&&Y(n,"background",a[2]),s&1&&o!==(o=a[1]+"")&&re(l,o)},d(a){a&&C(e)}}}function Il(r){let e,n=x(r[0]),t=[];for(let o=0;o<n.length;o+=1)t[o]=jn(Cn(r,n,o));return{c(){e=v("ul");for(let o=0;o<t.length;o+=1)t[o].c()},m(o,l){A(o,e,l);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(o,[l]){if(l&1){n=x(o[0]);let i;for(i=0;i<n.length;i+=1){const a=Cn(o,n,i);t[i]?t[i].p(a,l):(t[i]=jn(a),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},i:ie,o:ie,d(o){o&&C(e),pe(t,o)}}}function Ol(r,e,n){let{rows:t}=e;return r.$$set=o=>{"rows"in o&&n(0,t=o.rows)},[t]}class Fl extends oe{constructor(e){super(),le(this,e,Ol,Il,ne,{rows:0})}}const Pl=r=>({dialog:r&1}),Sn=r=>({dialog:r[0]});function ql(r){let e,n,t,o,l;const i=r[4].default,a=De(i,r,r[3],Sn);return{c(){e=v("dialog"),n=v("article"),a&&a.c(),e.open=!0},m(s,c){A(s,e,c),m(e,n),a&&a.m(n,null),r[6](e),t=!0,o||(l=[J(window,"click",r[1]),J(window,"keydown",r[2]),J(e,"close",r[5])],o=!0)},p(s,[c]){a&&a.p&&(!t||c&9)&&Te(a,i,s,s[3],t?Ie(i,s[3],c,Pl):Ne(s[3]),Sn)},i(s){t||(k(a,s),t=!0)},o(s){y(a,s),t=!1},d(s){s&&C(e),a&&a.d(s),r[6](null),o=!1,Ae(l)}}}function Ul(r,e,n){let{$$slots:t={},$$scope:o}=e,l;function i(u){l.open&&u.target==l&&l.close()}function a(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),l.close())}function s(u){Ce.call(this,r,u)}function c(u){fe[u?"unshift":"push"](()=>{l=u,n(0,l)})}return r.$$set=u=>{"$$scope"in u&&n(3,o=u.$$scope)},[l,i,a,o,t,s,c]}class Ut extends oe{constructor(e){super(),le(this,e,Ul,ql,ne,{})}}function zn(r,e,n){const t=r.slice();return t[3]=e[n],t}function Mn(r,e,n){const t=r.slice();return t[6]=e[n],t}function Ln(r){let e,n;return{c(){e=v("span"),n=I(` 
    `),Y(e,"background",r[6]),Y(e,"width","100%"),Y(e,"border","1px solid black")},m(t,o){A(t,e,o),m(e,n)},p(t,o){o&1&&Y(e,"background",t[6])},d(t){t&&C(e)}}}function Rl(r){let e,n=r[3]+"",t;return{c(){e=v("span"),t=I(n)},m(o,l){A(o,e,l),m(e,t)},p(o,l){l&2&&n!==(n=o[3]+"")&&re(t,n)},d(o){o&&C(e)}}}function Gl(r){let e,n=r[3].toFixed(r[2])+"",t;return{c(){e=v("span"),t=I(n)},m(o,l){A(o,e,l),m(e,t)},p(o,l){l&6&&n!==(n=o[3].toFixed(o[2])+"")&&re(t,n)},d(o){o&&C(e)}}}function Bn(r){let e;function n(l,i){return l[2]>0?Gl:Rl}let t=n(r),o=t(r);return{c(){o.c(),e=qe()},m(l,i){o.m(l,i),A(l,e,i)},p(l,i){t===(t=n(l))&&o?o.p(l,i):(o.d(1),o=t(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&C(e),o.d(l)}}}function Jl(r){let e,n,t,o=x(r[0]),l=[];for(let s=0;s<o.length;s+=1)l[s]=Ln(Mn(r,o,s));let i=x(r[1]),a=[];for(let s=0;s<i.length;s+=1)a[s]=Bn(zn(r,i,s));return{c(){e=v("div");for(let s=0;s<l.length;s+=1)l[s].c();n=M(),t=v("div");for(let s=0;s<a.length;s+=1)a[s].c();Y(e,"display","flex"),Y(t,"display","flex"),Y(t,"justify-content","space-between")},m(s,c){A(s,e,c);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);A(s,n,c),A(s,t,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(t,null)},p(s,[c]){if(c&1){o=x(s[0]);let u;for(u=0;u<o.length;u+=1){const f=Mn(s,o,u);l[u]?l[u].p(f,c):(l[u]=Ln(f),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=o.length}if(c&6){i=x(s[1]);let u;for(u=0;u<i.length;u+=1){const f=zn(s,i,u);a[u]?a[u].p(f,c):(a[u]=Bn(f),a[u].c(),a[u].m(t,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=i.length}},i:ie,o:ie,d(s){s&&(C(e),C(n),C(t)),pe(l,s),pe(a,s)}}}function Ql(r,e,n){let{colorScale:t}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return r.$$set=i=>{"colorScale"in i&&n(0,t=i.colorScale),"limits"in i&&n(1,o=i.limits),"decimalPlaces"in i&&n(2,l=i.decimalPlaces)},[t,o,l]}class Kl extends oe{constructor(e){super(),le(this,e,Ql,Jl,ne,{colorScale:0,limits:1,decimalPlaces:2})}}function Hl(r,e){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function Wl(r){let e;return{c(){e=I("Bus stops")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function En(r){let e,n,t,o,l;return o=new Kl({props:{colorScale:r[1],limits:r[2]}}),{c(){e=v("div"),n=v("p"),n.textContent="Peak hourly frequency:",t=M(),L(o.$$.fragment),F(e,"class","svelte-yxmabo")},m(i,a){A(i,e,a),m(e,n),m(e,t),B(o,e,null),l=!0},p:ie,i(i){l||(k(o.$$.fragment,i),l=!0)},o(i){y(o.$$.fragment,i),l=!1},d(i){i&&C(e),E(o)}}}function Zl(r){let e,n,t,o=r[4].stop_name+"",l,i,a,s,c,u=r[4].peak+"",f,d,p,_,j,D=r[4].peak_description+"",g,$,h,b,S,w=r[4].total+"",z,N,P=r[4].total_description+"",q,V;return{c(){e=v("p"),n=I("Stop name: "),t=v("b"),l=I(o),i=M(),a=v("p"),s=I("Peak: "),c=v("b"),f=I(u),d=I(`
        buses during the busiest hour of any day`),p=M(),_=v("p"),j=I("The peak hour is "),g=I(D),$=M(),h=v("p"),b=I("Total buses per day: "),S=v("b"),z=I(w),N=I(`
        (for `),q=I(P),V=I(", the busiest day of the week)")},m(T,G){A(T,e,G),m(e,n),m(e,t),m(t,l),A(T,i,G),A(T,a,G),m(a,s),m(a,c),m(c,f),m(a,d),A(T,p,G),A(T,_,G),m(_,j),m(_,g),A(T,$,G),A(T,h,G),m(h,b),m(h,S),m(S,z),m(h,N),m(h,q),m(h,V)},p(T,G){G&16&&o!==(o=T[4].stop_name+"")&&re(l,o),G&16&&u!==(u=T[4].peak+"")&&re(f,u),G&16&&D!==(D=T[4].peak_description+"")&&re(g,D),G&16&&w!==(w=T[4].total+"")&&re(z,w),G&16&&P!==(P=T[4].total_description+"")&&re(q,P)},d(T){T&&(C(e),C(i),C(a),C(p),C(_),C($),C(h))}}}function Xl(r){let e,n;return e=new ct({props:{$$slots:{default:[Zl,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&48&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Vl(r){let e,n;return e=new Ve({props:{sourceLayer:"bus_stops",paint:{"circle-color":Mo(["get","peak"],r[2],r[1]),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:r[0]?"visible":"none"},manageHoverState:!0,$$slots:{default:[Xl]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),o&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Yl(r){let e,n,t,o,l;e=new to({props:{$$slots:{default:[Wl]},$$scope:{ctx:r}}}),e.$on("click",r[3]);let i=r[0]&&En(r);return o=new no({props:{url:"pmtiles://https://atip.uk/layers/v1/bus_stops.pmtiles",$$slots:{default:[Vl]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),n=M(),i&&i.c(),t=M(),L(o.$$.fragment)},m(a,s){B(e,a,s),A(a,n,s),i&&i.m(a,s),A(a,t,s),B(o,a,s),l=!0},p(a,[s]){const c={};s&32&&(c.$$scope={dirty:s,ctx:a}),e.$set(c),a[0]?i?(i.p(a,s),s&1&&k(i,1)):(i=En(a),i.c(),k(i,1),i.m(t.parentNode,t)):i&&(ae(),y(i,1,1,()=>{i=null}),ce());const u={};s&33&&(u.$$scope={dirty:s,ctx:a}),o.$set(u)},i(a){l||(k(e.$$.fragment,a),k(i),k(o.$$.fragment,a),l=!0)},o(a){y(e.$$.fragment,a),y(i),y(o.$$.fragment,a),l=!1},d(a){a&&(C(n),C(t)),E(e,a),i&&i.d(a),E(o,a)}}}function xl(r,e,n){let t=!1;return[t,["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],[0,3,10,20,30,100],()=>n(0,t=!t)]}class ei extends oe{constructor(e){super(),le(this,e,xl,Yl,ne,{})}}function ti(r){let e;return{c(){e=I("Crossings")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Dn(r){let e,n,t;return n=new Fl({props:{rows:r[1]}}),{c(){e=v("div"),L(n.$$.fragment),F(e,"class","svelte-yxmabo")},m(o,l){A(o,e,l),B(n,e,null),t=!0},p:ie,i(o){t||(k(n.$$.fragment,o),t=!0)},o(o){y(n.$$.fragment,o),t=!1},d(o){o&&C(e),E(n)}}}function ni(r){let e,n=(r[3].class||"Unknown")+"",t,o;return{c(){e=v("p"),t=I(n),o=I(" crossing")},m(l,i){A(l,e,i),m(e,t),m(e,o)},p(l,i){i&8&&n!==(n=(l[3].class||"Unknown")+"")&&re(t,n)},d(l){l&&C(e)}}}function ri(r){let e,n;return e=new ct({props:{$$slots:{default:[ni,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function oi(r){let e,n=(r[3].class||"Unknown")+"",t,o;return{c(){e=v("p"),t=I(n),o=I(" crossing")},m(l,i){A(l,e,i),m(e,t),m(e,o)},p(l,i){i&8&&n!==(n=(l[3].class||"Unknown")+"")&&re(t,n)},d(l){l&&C(e)}}}function li(r){let e,n;return e=new ct({props:{$$slots:{default:[oi,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ii(r){let e,n,t,o;return e=new Me({props:{sourceLayer:"crossings",filter:Lo,paint:{"line-color":ln(["get","class"],Object.fromEntries(r[1]),"red"),"line-width":3},layout:{visibility:r[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[ri]},$$scope:{ctx:r}}}),e.$on("click",Tn),t=new Ve({props:{sourceLayer:"crossings",filter:Bo,paint:{"circle-color":ln(["get","class"],Object.fromEntries(r[1]),"red"),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:r[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[li]},$$scope:{ctx:r}}}),t.$on("click",Tn),{c(){L(e.$$.fragment),n=M(),L(t.$$.fragment)},m(l,i){B(e,l,i),A(l,n,i),B(t,l,i),o=!0},p(l,i){const a={};i&1&&(a.layout={visibility:l[0]?"visible":"none"}),i&16&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&1&&(s.layout={visibility:l[0]?"visible":"none"}),i&16&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(k(e.$$.fragment,l),k(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&C(n),E(e,l),E(t,l)}}}function si(r){let e,n,t,o,l;e=new to({props:{$$slots:{default:[ti]},$$scope:{ctx:r}}}),e.$on("click",r[2]);let i=r[0]&&Dn(r);return o=new no({props:{url:"pmtiles://https://atip.uk/layers/v1/crossings.pmtiles",$$slots:{default:[ii]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),n=M(),i&&i.c(),t=M(),L(o.$$.fragment)},m(a,s){B(e,a,s),A(a,n,s),i&&i.m(a,s),A(a,t,s),B(o,a,s),l=!0},p(a,[s]){const c={};s&16&&(c.$$scope={dirty:s,ctx:a}),e.$set(c),a[0]?i?(i.p(a,s),s&1&&k(i,1)):(i=Dn(a),i.c(),k(i,1),i.m(t.parentNode,t)):i&&(ae(),y(i,1,1,()=>{i=null}),ce());const u={};s&17&&(u.$$scope={dirty:s,ctx:a}),o.$set(u)},i(a){l||(k(e.$$.fragment,a),k(i),k(o.$$.fragment,a),l=!0)},o(a){y(e.$$.fragment,a),y(i),y(o.$$.fragment,a),l=!1},d(a){a&&(C(n),C(t)),E(e,a),i&&i.d(a),E(o,a)}}}function Tn(r){window.open(`https://www.openstreetmap.org/${r.detail.features[0].properties.osm}`,"_blank")}function ai(r,e,n){let t=!1;return[t,[["Zebra","#66C5CC"],["Parallel","#F6CF71"],["Pelican","#F89C74"],["Puffin","#DCB0F2"],["Toucan","#87C55F"],["Pegasus","#9EB9F3"],["Uncontrolled","#FE88B1"],["Signalised","#C9DB74"],["Unknown","red"]],()=>n(0,t=!t)]}class ci extends oe{constructor(e){super(),le(this,e,ai,si,ne,{})}}function ui(r){let e,n,t,o,l,i,a;return n=new ei({}),o=new ci({}),i=new Nl({}),{c(){e=v("div"),L(n.$$.fragment),t=M(),L(o.$$.fragment),l=M(),L(i.$$.fragment),Y(e,"display","flex"),Y(e,"flex-direction","column")},m(s,c){A(s,e,c),B(n,e,null),m(e,t),B(o,e,null),m(e,l),B(i,e,null),a=!0},p:ie,i(s){a||(k(n.$$.fragment,s),k(o.$$.fragment,s),k(i.$$.fragment,s),a=!0)},o(s){y(n.$$.fragment,s),y(o.$$.fragment,s),y(i.$$.fragment,s),a=!1},d(s){s&&C(e),E(n),E(o),E(i)}}}function fi(r){let e,n;return e=new Uo({props:{$$slots:{default:[ui]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,[o]){const l={};o&1&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}class di extends oe{constructor(e){super(),le(this,e,null,fi,ne,{})}}function Nn(r,e,n){const t=r.slice();return t[6]=e[n],t[7]=e,t[8]=n,t}function In(r){let e,n,t=r[6].properties.name+"",o,l,i,a,s,c;function u(d){r[5](d,r[6])}let f={k:"horiz-radio",choices:ye()};return r[6].properties.sa10!==void 0&&(f.value=r[6].properties.sa10),i=new Le({props:f}),fe.push(()=>me(i,"value",u)),{c(){e=v("li"),n=v("span"),o=I(t),l=M(),L(i.$$.fragment),s=M(),Y(n,"color",r[6].properties.color)},m(d,p){A(d,e,p),m(e,n),m(n,o),m(e,l),B(i,e,null),m(e,s),c=!0},p(d,p){r=d,(!c||p&2)&&t!==(t=r[6].properties.name+"")&&re(o,t),p&2&&Y(n,"color",r[6].properties.color);const _={};!a&&p&2&&(a=!0,_.value=r[6].properties.sa10,ge(()=>a=!1)),i.$set(_)},i(d){c||(k(i.$$.fragment,d),c=!0)},o(d){y(i.$$.fragment,d),c=!1},d(d){d&&C(e),E(i)}}}function pi(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_=x(r[1].crossings),j=[];for(let g=0;g<_.length;g+=1)j[g]=In(Nn(r,_,g));const D=g=>y(j[g],1,1,()=>{j[g]=null});return u=new tt({props:{metric:r[2]}}),{c(){e=v("div"),n=v("button"),n.textContent="Done",t=M(),o=v("h2"),o.textContent="SA10: pedestrian crossing speed",l=M(),i=v("p"),i.textContent=`${r[2].description}`,a=M(),s=v("ol");for(let g=0;g<j.length;g+=1)j[g].c();c=M(),L(u.$$.fragment),F(e,"slot","sidebar")},m(g,$){A(g,e,$),m(e,n),m(e,t),m(e,o),m(e,l),m(e,i),m(e,a),m(e,s);for(let h=0;h<j.length;h+=1)j[h]&&j[h].m(s,null);m(e,c),B(u,e,null),f=!0,d||(p=J(n,"click",r[4]),d=!0)},p(g,$){if($&2){_=x(g[1].crossings);let h;for(h=0;h<_.length;h+=1){const b=Nn(g,_,h);j[h]?(j[h].p(b,$),k(j[h],1)):(j[h]=In(b),j[h].c(),k(j[h],1),j[h].m(s,null))}for(ae(),h=_.length;h<j.length;h+=1)D(h);ce()}},i(g){if(!f){for(let $=0;$<_.length;$+=1)k(j[$]);k(u.$$.fragment,g),f=!0}},o(g){j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)y(j[$]);y(u.$$.fragment,g),f=!1},d(g){g&&C(e),pe(j,g),E(u),d=!1,p()}}}function mi(r){let e,n,t;return n=new Ue({props:{showColor:"crossings",except:"",showMissingProperty:["get","sa10"]}}),{c(){e=v("div"),L(n.$$.fragment),F(e,"slot","map")},m(o,l){A(o,e,l),B(n,e,null),t=!0},p:ie,i(o){t||(k(n.$$.fragment,o),t=!0)},o(o){y(n.$$.fragment,o),t=!1},d(o){o&&C(e),E(n)}}}function gi(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[mi],sidebar:[pi]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J(window,"keydown",r[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function _i(r,e,n){let t,o;ee(r,W,c=>n(0,t=c)),ee(r,H,c=>n(1,o=c));let l=Qe.SA10;function i(c){c.key=="Escape"&&X(W,t={kind:"neutral"},t)}const a=()=>X(W,t={kind:"neutral"},t);function s(c,u){r.$$.not_equal(u.properties.sa10,c)&&(u.properties.sa10=c,H.set(o))}return[t,o,l,i,a,s]}class hi extends oe{constructor(e){super(),le(this,e,_i,gi,ne,{})}}const{window:$i}=at;function bi(r){let e;return{c(){e=I("SA10: pedestrian crossing speed")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function ki(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j,D,g,$;function h(S){r[9](S)}let b={k:"horiz-radio",choices:ye(),$$slots:{default:[bi]},$$scope:{ctx:r}};return r[1].crossings[r[0]].properties.sa10!==void 0&&(b.value=r[1].crossings[r[0]].properties.sa10),u=new Le({props:b}),fe.push(()=>me(u,"value",h)),j=new tt({props:{metric:r[3]}}),{c(){e=v("div"),n=v("button"),n.textContent="Done",t=M(),o=v("button"),o.textContent="Delete crossing",l=M(),i=v("label"),a=I(`Name:
      `),s=v("input"),c=M(),L(u.$$.fragment),d=M(),p=v("p"),p.textContent=`${r[3].description}`,_=M(),L(j.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(S,w){A(S,e,w),m(e,n),m(e,t),m(e,o),m(e,l),m(e,i),m(i,a),m(i,s),$e(s,r[1].crossings[r[0]].properties.name),m(e,c),B(u,e,null),m(e,d),m(e,p),m(e,_),B(j,e,null),D=!0,g||($=[J(n,"click",r[7]),J(o,"click",r[5]),J(s,"input",r[8])],g=!0)},p(S,w){w&3&&s.value!==S[1].crossings[S[0]].properties.name&&$e(s,S[1].crossings[S[0]].properties.name);const z={};w&1024&&(z.$$scope={dirty:w,ctx:S}),!f&&w&3&&(f=!0,z.value=S[1].crossings[S[0]].properties.sa10,ge(()=>f=!1)),u.$set(z)},i(S){D||(k(u.$$.fragment,S),k(j.$$.fragment,S),D=!0)},o(S){y(u.$$.fragment,S),y(j.$$.fragment,S),D=!1},d(S){S&&C(e),E(u),E(j),g=!1,Ae($)}}}function wi(r){let e,n;return e=new et({props:{filter:["!=",["id"],r[0]],layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":"black"}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function vi(r){let e,n;return{c(){e=v("img"),kt(e.src,n=oo)||F(e,"src",n),F(e,"alt","")},m(t,o){A(t,e,o)},p:ie,d(t){t&&C(e)}}}function yi(r){let e,n,t,o,l,i,a,s;n=new Ue({props:{except:"crossings",showMissingProperty:["get","sa10"]}}),o=new we({props:{data:de(r[1].crossings),generateId:!0,$$slots:{default:[wi]},$$scope:{ctx:r}}});function c(f){r[6](f)}let u={color:r[1].crossings[r[0]].properties.color,$$slots:{default:[vi]},$$scope:{ctx:r}};return r[1].crossings[r[0]].geometry.coordinates!==void 0&&(u.lngLat=r[1].crossings[r[0]].geometry.coordinates),i=new en({props:u}),fe.push(()=>me(i,"lngLat",c)),{c(){e=v("div"),L(n.$$.fragment),t=M(),L(o.$$.fragment),l=M(),L(i.$$.fragment),F(e,"slot","map")},m(f,d){A(f,e,d),B(n,e,null),m(e,t),B(o,e,null),m(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].crossings)),d&1025&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const _={};d&3&&(_.color=f[1].crossings[f[0]].properties.color),d&1024&&(_.$$scope={dirty:d,ctx:f}),!a&&d&3&&(a=!0,_.lngLat=f[1].crossings[f[0]].geometry.coordinates,ge(()=>a=!1)),i.$set(_)},i(f){s||(k(n.$$.fragment,f),k(o.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(n.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&C(e),E(n),E(o),E(i)}}}function Ai(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[yi],sidebar:[ki]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J($i,"keydown",r[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function Ci(r,e,n){let t,o;ee(r,H,p=>n(1,t=p)),ee(r,W,p=>n(2,o=p));let{idx:l}=e,i=Qe.SA10;function a(p){p.key=="Escape"&&X(W,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this crossing?")&&(X(W,o={kind:"neutral"},o),await xe(),t.crossings.splice(l,1),H.set(t))}function c(p){r.$$.not_equal(t.crossings[l].geometry.coordinates,p)&&(t.crossings[l].geometry.coordinates=p,H.set(t))}const u=()=>X(W,o={kind:"neutral"},o);function f(){t.crossings[l].properties.name=this.value,H.set(t)}function d(p){r.$$.not_equal(t.crossings[l].properties.sa10,p)&&(t.crossings[l].properties.sa10=p,H.set(t))}return r.$$set=p=>{"idx"in p&&n(0,l=p.idx)},[l,t,o,i,a,s,c,u,f,d]}class ji extends oe{constructor(e){super(),le(this,e,Ci,Ai,ne,{idx:0})}}let Z;const io=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&io.decode();let gt=null;function $t(){return(gt===null||gt.byteLength===0)&&(gt=new Uint8Array(Z.memory.buffer)),gt}function Ee(r,e){return r=r>>>0,io.decode($t().subarray(r,r+e))}const Je=new Array(128).fill(void 0);Je.push(void 0,null,!0,!1);let bt=Je.length;function ke(r){bt===Je.length&&Je.push(Je.length+1);const e=bt;return bt=Je[e],Je[e]=r,e}function se(r){return Je[r]}function Si(r){r<132||(Je[r]=bt,bt=r)}function lt(r){const e=se(r);return Si(r),e}function Qt(r){return r==null}let _t=null;function zi(){return(_t===null||_t.byteLength===0)&&(_t=new Float64Array(Z.memory.buffer)),_t}let ht=null;function ue(){return(ht===null||ht.byteLength===0)&&(ht=new Int32Array(Z.memory.buffer)),ht}let We=0;const Nt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Mi=typeof Nt.encodeInto=="function"?function(r,e){return Nt.encodeInto(r,e)}:function(r,e){const n=Nt.encode(r);return e.set(n),{read:r.length,written:n.length}};function Bt(r,e,n){if(n===void 0){const a=Nt.encode(r),s=e(a.length,1)>>>0;return $t().subarray(s,s+a.length).set(a),We=a.length,s}let t=r.length,o=e(t,1)>>>0;const l=$t();let i=0;for(;i<t;i++){const a=r.charCodeAt(i);if(a>127)break;l[o+i]=a}if(i!==t){i!==0&&(r=r.slice(i)),o=n(o,t,t=i+r.length*3,1)>>>0;const a=$t().subarray(o+i,o+t),s=Mi(r,a);i+=s.written}return We=i,o}function xt(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=xt(r[0]));for(let i=1;i<o;i++)l+=", "+xt(r[i]);return l+="]",l}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}function Li(r,e){const n=e(r.length*1,1)>>>0;return $t().set(r,n/1),We=r.length,n}function Kt(r,e){try{return r.apply(this,e)}catch(n){Z.__wbindgen_exn_store(ke(n))}}class Ot{static __wrap(e){e=e>>>0;const n=Object.create(Ot.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Z.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=Z.__wbindgen_add_to_stack_pointer(-16),i=Li(e,Z.__wbindgen_malloc),a=We;Z.jsroutesnapper_new(l,i,a);var n=ue()[l/4+0],t=ue()[l/4+1],o=ue()[l/4+2];if(o)throw lt(t);return Ot.__wrap(n)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Z.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ke(e))}setAreaMode(){Z.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,n;try{const l=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_getConfig(l,this.__wbg_ptr);var t=ue()[l/4+0],o=ue()[l/4+1];return e=t,n=o,Ee(t,o)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,n,1)}}toFinalFeature(){try{const t=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=ue()[t/4+0],n=ue()[t/4+1];let o;return e!==0&&(o=Ee(e,n).slice(),Z.__wbindgen_free(e,n*1)),o}finally{Z.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,n;try{const l=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var t=ue()[l/4+0],o=ue()[l/4+1];return e=t,n=o,Ee(t,o)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,n,1)}}toggleSnapMode(){Z.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,n,t){return Z.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,n,t)!==0}onClick(){Z.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Z.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Z.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Z.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_editExisting(o,this.__wbg_ptr,ke(e));var n=ue()[o/4+0],t=ue()[o/4+1];if(t)throw lt(n)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,n;try{const l=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var t=ue()[l/4+0],o=ue()[l/4+1];return e=t,n=o,Ee(t,o)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,n,1)}}debugSnappableNodes(){let e,n;try{const l=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var t=ue()[l/4+0],o=ue()[l/4+1];return e=t,n=o,Ee(t,o)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,n,1)}}routeNameForWaypoints(e){let n,t;try{const u=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,ke(e));var o=ue()[u/4+0],l=ue()[u/4+1],i=ue()[u/4+2],a=ue()[u/4+3],s=o,c=l;if(a)throw s=0,c=0,lt(i);return n=s,t=c,Ee(s,c)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(n,t,1)}}addSnappedWaypoint(e,n){Z.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,n)}undo(){Z.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let n,t;try{const u=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,ke(e));var o=ue()[u/4+0],l=ue()[u/4+1],i=ue()[u/4+2],a=ue()[u/4+3],s=o,c=l;if(a)throw s=0,c=0,lt(i);return n=s,t=c,Ee(s,c)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(n,t,1)}}getExtraNodes(e,n){let t,o;try{const f=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_getExtraNodes(f,this.__wbg_ptr,ke(e),ke(n));var l=ue()[f/4+0],i=ue()[f/4+1],a=ue()[f/4+2],s=ue()[f/4+3],c=l,u=i;if(s)throw c=0,u=0,lt(a);return t=c,o=u,Ee(c,u)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(t,o,1)}}}async function Bi(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function Ei(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,n){const t=Ee(e,n);return ke(t)},r.wbg.__wbindgen_object_drop_ref=function(e){lt(e)},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(Ee(e,n));return ke(t)},r.wbg.__wbindgen_number_get=function(e,n){const t=se(n),o=typeof t=="number"?t:void 0;zi()[e/8+1]=Qt(o)?0:o,ue()[e/4+0]=!Qt(o)},r.wbg.__wbindgen_is_object=function(e){const n=se(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_is_undefined=function(e){return se(e)===void 0},r.wbg.__wbindgen_in=function(e,n){return se(e)in se(n)},r.wbg.__wbindgen_boolean_get=function(e){const n=se(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return se(e)==se(n)},r.wbg.__wbindgen_string_get=function(e,n){const t=se(n),o=typeof t=="string"?t:void 0;var l=Qt(o)?0:Bt(o,Z.__wbindgen_malloc,Z.__wbindgen_realloc),i=We;ue()[e/4+1]=i,ue()[e/4+0]=l},r.wbg.__wbg_String_4370c5505c674d30=function(e,n){const t=String(se(n)),o=Bt(t,Z.__wbindgen_malloc,Z.__wbindgen_realloc),l=We;ue()[e/4+1]=l,ue()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const n=se(e);return ke(n)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,n){const t=se(e)[se(n)];return ke(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ke(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=se(n).stack,o=Bt(t,Z.__wbindgen_malloc,Z.__wbindgen_realloc),l=We;ue()[e/4+1]=l,ue()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let t,o;try{t=e,o=n,console.error(Ee(e,n))}finally{Z.__wbindgen_free(t,o,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(se(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(se(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(se(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(se(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(se(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,n){const t=se(e)[n>>>0];return ke(t)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return se(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof se(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const n=se(e).next;return ke(n)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Kt(function(e){const n=se(e).next();return ke(n)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return se(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const n=se(e).value;return ke(n)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ke(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Kt(function(e,n){const t=Reflect.get(se(e),se(n));return ke(t)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Kt(function(e,n){const t=se(e).call(se(n));return ke(t)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(se(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let n;try{n=se(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const n=se(e).buffer;return ke(n)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const n=new Uint8Array(se(e));return ke(n)},r.wbg.__wbg_set_5cf90238115182c3=function(e,n,t){se(e).set(se(n),t>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return se(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let n;try{n=se(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_debug_string=function(e,n){const t=xt(se(n)),o=Bt(t,Z.__wbindgen_malloc,Z.__wbindgen_realloc),l=We;ue()[e/4+1]=l,ue()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,n){throw new Error(Ee(e,n))},r.wbg.__wbindgen_memory=function(){const e=Z.memory;return ke(e)},r}function Di(r,e){return Z=r.exports,so.__wbindgen_wasm_module=e,_t=null,ht=null,gt=null,Z}async function so(r){if(Z!==void 0)return Z;typeof r>"u"&&(r="/route-element/assets/route_snapper_bg.wasm");const e=Ei();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await Bi(await r,e);return Di(n,t)}const Ti=30;class Ni{constructor(e,n,t,o,l){this.onMouseMove=i=>{if(!this.active)return;const a=[i.point.x-Ti,i.point.y],s=this.map.unproject(i.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,s)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Ot(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersSuccess)n(JSON.parse(e));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersUpdated)n(JSON.parse(e))}}function Ii(r){let e=r[4].road_classification+"",n;return{c(){n=I(e)},m(t,o){A(t,n,o)},p(t,o){o&16&&e!==(e=t[4].road_classification+"")&&re(n,e)},d(t){t&&C(n)}}}function Oi(r){let e,n;return e=new ct({props:{openOn:"hover",$$slots:{default:[Ii,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&48&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Fi(r){let e,n;return e=new Me({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":3,"line-color":"black"},$$slots:{default:[Oi]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),o&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Pi(r){let e,n;return e=new Ve({props:{manageHoverState:!0,layout:{visibility:r[0]?"visible":"none"},paint:{"circle-color":["case",["get","traffic_signals"],"green","black"],"circle-radius":5}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function qi(r){let e,n,t,o;return e=new we({props:{data:r[1].os_links,$$slots:{default:[Fi]},$$scope:{ctx:r}}}),t=new we({props:{data:r[1].os_nodes,$$slots:{default:[Pi]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),n=M(),L(t.$$.fragment)},m(l,i){B(e,l,i),A(l,n,i),B(t,l,i),o=!0},p(l,[i]){const a={};i&33&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&33&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(k(e.$$.fragment,l),k(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&C(n),E(e,l),E(t,l)}}}function Ui(r,e,n){let{graph:t}=e,{showDebug:o}=e;function l(){let a=JSON.parse(t.debugNetwork());return{os_nodes:JSON.parse(a.os_nodes),os_links:JSON.parse(a.os_links)}}let i=l();return r.$$set=a=>{"graph"in a&&n(2,t=a.graph),"showDebug"in a&&n(0,o=a.showDebug)},[o,i,t]}class Ri extends oe{constructor(e){super(),le(this,e,Ui,qi,ne,{graph:2,showDebug:0})}}function ao(r,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Ge[r%Ge.length],details:{arms:[],movements:[],notes:""}}}}function co(r){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Ge[r%Ge.length],answers:Array(je.length).fill("")}}}let je=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:ye()},{name:"SA04",description:"trip hazards",choices:ye()},{name:"SA05",description:"kerbside activity",choices:ye()},{name:"SA08",description:"motor traffic speed",choices:ye()},{name:"SA09",description:"motor traffic volume",choices:ye()},{name:"SA11",description:"footway widths",choices:ye()},{name:"SA12",description:"effective width next to tram lines",choices:ye()},{name:"SA13",description:"crossing angle of tram/train rails",choices:ye()},{name:"SA14",description:"cycling surface and maintenance defects",choices:ye()},{name:"SA15",description:"WW surface and maintenance defects",choices:ye()},{name:"SA16",description:"guard railing",choices:ye()}];function uo(r){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled side road",color:Ge[r%Ge.length],sa01:""}}}let tn=Pe(null);const Fe=Pe([]);async function Gi(r){await Eo(),await so();let e="https://assets.od2net.org/route-element",n=r.getBounds();try{let t=await new Do(e,n.getEast(),n.getNorth(),n.getWest(),n.getSouth());tn.set(new Ni(r,t.getRouteSnapper(),Pe(Tt()),Pe(!0),Pe(0))),W.set({kind:"draw-route",graph:t})}catch(t){window.alert(t)}}function Ji(r){try{let e=JSON.parse(Gt(tn).inner.calculateRoute(Gt(Fe)));if(!e){window.alert("No route drawn");return}H.update(n=>{for(let t of JSON.parse(r.splitLinks(e,e.properties.full_path)).features){let o=co(n.links.length);o.geometry=t.geometry,o.properties.name=e.properties.route_name,n.links.push(o)}for(let t of JSON.parse(r.getSideRoads(e.properties.full_path)).features)t.properties=uo(n.side_roads.length).properties,n.side_roads.push(t);for(let t of JSON.parse(r.getSignalizedJunctions(e.properties.full_path)).features)n.jats.push(ao(n.jats.length,t.geometry.coordinates));return n}),W.set({kind:"edit-link",idx:Gt(H).links.length-1})}catch(e){window.alert(`Bug: ${e}`)}Fe.set([]),W.set({kind:"neutral"})}function On(r,e,n){const t=r.slice();return t[49]=e[n],t[50]=e,t[51]=n,t}function Fn(r,e,n){const t=r.slice();return t[52]=e[n],t[53]=e,t[54]=n,t}function Qi(r){let e;return{c(){e=v("h2"),e.textContent="Drawing a new route"},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Ki(r){let e;return{c(){e=v("h2"),e.textContent="Editing a route"},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Hi(r){let e,n=r[12].length+"",t,o;return{c(){e=I("Undo ("),t=I(n),o=I(")")},m(l,i){A(l,e,i),A(l,t,i),A(l,o,i)},p(l,i){i[0]&4096&&n!==(n=l[12].length+"")&&re(t,n)},d(l){l&&(C(e),C(t),C(o))}}}function Wi(r){let e;return{c(){e=I("Undo")},m(n,t){A(n,e,t)},p:ie,d(n){n&&C(e)}}}function Zi(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j,D,g,$,h,b,S,w,z,N,P,q,V,T,G,K,Q,O,U,_e,be,Oe,ut,yt,At,nt,He,Ct,ft,dt,pt,jt;function St(te,he){return te[3]?Ki:Qi}let rt=St(r),Re=rt(r);function zt(te,he){return te[12].length==0?Wi:Hi}let ot=zt(r),R=ot(r);return ft=Wt(r[39][0]),dt=Wt(r[39][1]),{c(){e=v("div"),Re.c(),n=M(),t=v("button"),o=I("Finish"),i=M(),a=v("button"),R.c(),c=M(),u=v("button"),u.textContent="Cancel",f=M(),d=v("fieldset"),p=v("label"),_=v("input"),j=I(`
        Snap to roads`),D=M(),g=v("label"),$=v("input"),h=I(`
        Draw anywhere`),b=M(),S=v("fieldset"),w=v("label"),z=v("input"),N=I(`
        Extend from start (
        `),P=v("b"),P.textContent="1",q=I(`
        )`),V=M(),T=v("label"),G=v("input"),K=I(`
        Extend from end (
        `),Q=v("b"),Q.textContent="2",O=I(`
        )`),U=M(),_e=v("label"),be=v("input"),Oe=I(`
        Adjust middle points (
        `),ut=v("b"),ut.textContent="3",yt=I(`
        )`),At=M(),nt=v("label"),He=v("input"),Ct=I(`
      Debug the network`),t.disabled=l=r[8].length<2,F(a,"class","secondary"),a.disabled=s=r[12].length==0,F(u,"class","secondary"),F(_,"type","radio"),_.__value="snap",$e(_,_.__value),F($,"type","radio"),$.__value="free",$e($,$.__value),F(z,"type","radio"),z.__value="append-start",$e(z,z.__value),F(G,"type","radio"),G.__value="append-end",$e(G,G.__value),F(be,"type","radio"),be.__value="adjust",$e(be,be.__value),F(He,"type","checkbox"),F(e,"slot","sidebar"),ft.p(z,G,be),dt.p(_,$)},m(te,he){A(te,e,he),Re.m(e,null),m(e,n),m(e,t),m(t,o),m(e,i),m(e,a),R.m(a,null),m(e,c),m(e,u),m(e,f),m(e,d),m(d,p),m(p,_),_.checked=_.__value===r[11],m(p,j),m(d,D),m(d,g),m(g,$),$.checked=$.__value===r[11],m(g,h),m(e,b),m(e,S),m(S,w),m(w,z),z.checked=z.__value===r[4],m(w,N),m(w,P),m(w,q),m(S,V),m(S,T),m(T,G),G.checked=G.__value===r[4],m(T,K),m(T,Q),m(T,O),m(S,U),m(S,_e),m(_e,be),be.checked=be.__value===r[4],m(_e,Oe),m(_e,ut),m(_e,yt),m(e,At),m(e,nt),m(nt,He),He.checked=r[10],m(nt,Ct),pt||(jt=[J(t,"click",function(){Zt(r[1])&&r[1].apply(this,arguments)}),J(a,"click",r[15]),J(u,"click",function(){Zt(r[2])&&r[2].apply(this,arguments)}),J(_,"change",r[38]),J(_,"change",r[16]),J($,"change",r[40]),J($,"change",r[16]),J(z,"change",r[41]),J(G,"change",r[42]),J(be,"change",r[43]),J(He,"change",r[44])],pt=!0)},p(te,he){r=te,rt!==(rt=St(r))&&(Re.d(1),Re=rt(r),Re&&(Re.c(),Re.m(e,n))),he[0]&256&&l!==(l=r[8].length<2)&&(t.disabled=l),ot===(ot=zt(r))&&R?R.p(r,he):(R.d(1),R=ot(r),R&&(R.c(),R.m(a,null))),he[0]&4096&&s!==(s=r[12].length==0)&&(a.disabled=s),he[0]&2048&&(_.checked=_.__value===r[11]),he[0]&2048&&($.checked=$.__value===r[11]),he[0]&16&&(z.checked=z.__value===r[4]),he[0]&16&&(G.checked=G.__value===r[4]),he[0]&16&&(be.checked=be.__value===r[4]),he[0]&1024&&(He.checked=r[10])},d(te){te&&C(e),Re.d(),R.d(),ft.r(),dt.r(),pt=!1,Ae(jt)}}}function Xi(r){let e;return{c(){e=v("span"),F(e,"class","dot svelte-1cj4rwq"),ve(e,"snapped-node",r[52].snapped),ve(e,"free-node",!r[52].snapped),ve(e,"hide",r[7])},m(n,t){A(n,e,t)},p(n,t){t[0]&8192&&ve(e,"snapped-node",n[52].snapped),t[0]&8192&&ve(e,"free-node",!n[52].snapped),t[0]&128&&ve(e,"hide",n[7])},d(n){n&&C(e)}}}function Pn(r){let e,n,t;function o(s){r[29](s,r[52])}function l(){return r[30](r[52])}function i(){return r[31](r[52])}let a={draggable:!0,zIndex:0,$$slots:{default:[Xi]},$$scope:{ctx:r}};return r[52].point!==void 0&&(a.lngLat=r[52].point),e=new Xe({props:a}),fe.push(()=>me(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",r[24]),{c(){L(e.$$.fragment)},m(s,c){B(e,s,c),t=!0},p(s,c){r=s;const u={};c[0]&8320|c[1]&16777216&&(u.$$scope={dirty:c,ctx:r}),!n&&c[0]&8192&&(n=!0,u.lngLat=r[52].point,ge(()=>n=!1)),e.$set(u)},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function Vi(r){let e;return{c(){e=v("span"),e.textContent=`${r[51]+1}`,F(e,"class","dot svelte-1cj4rwq"),ve(e,"snapped",r[49].snapped)},m(n,t){A(n,e,t)},p(n,t){t[0]&256&&ve(e,"snapped",n[49].snapped)},d(n){n&&C(e)}}}function qn(r){let e,n,t;function o(s){r[32](s,r[49])}function l(){return r[33](r[51])}function i(){return r[34](r[51])}let a={draggable:!0,zIndex:1,$$slots:{default:[Vi]},$$scope:{ctx:r}};return r[49].point!==void 0&&(a.lngLat=r[49].point),e=new Xe({props:a}),fe.push(()=>me(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",r[35]),e.$on("mouseleave",r[36]),e.$on("dragstart",r[26]),e.$on("dragend",r[37]),{c(){L(e.$$.fragment)},m(s,c){B(e,s,c),t=!0},p(s,c){r=s;const u={};c[0]&256|c[1]&16777216&&(u.$$scope={dirty:c,ctx:r}),!n&&c[0]&256&&(n=!0,u.lngLat=r[49].point,ge(()=>n=!1)),e.$set(u)},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function Yi(r){let e,n;return e=new Me({props:{paint:{"line-color":"black","line-width":10}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function xi(r){let e,n;return e=new Me({props:{paint:{"line-color":"black","line-width":3}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function es(r){let e,n,t,o,l,i,a,s,c,u,f;n=new qt({}),n.$on("click",r[17]),n.$on("mousemove",r[18]),o=new Ri({props:{showDebug:r[10],graph:r[0]}});let d=x(r[13]),p=[];for(let $=0;$<d.length;$+=1)p[$]=Pn(Fn(r,d,$));const _=$=>y(p[$],1,1,()=>{p[$]=null});let j=x(r[8]),D=[];for(let $=0;$<j.length;$+=1)D[$]=qn(On(r,j,$));const g=$=>y(D[$],1,1,()=>{D[$]=null});return s=new we({props:{data:r[21](r[9],r[8]),generateId:!0,$$slots:{default:[Yi]},$$scope:{ctx:r}}}),u=new we({props:{data:r[14],$$slots:{default:[xi]},$$scope:{ctx:r}}}),{c(){e=v("div"),L(n.$$.fragment),t=M(),L(o.$$.fragment),l=M();for(let $=0;$<p.length;$+=1)p[$].c();i=M();for(let $=0;$<D.length;$+=1)D[$].c();a=M(),L(s.$$.fragment),c=M(),L(u.$$.fragment),F(e,"slot","map")},m($,h){A($,e,h),B(n,e,null),m(e,t),B(o,e,null),m(e,l);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(e,null);m(e,i);for(let b=0;b<D.length;b+=1)D[b]&&D[b].m(e,null);m(e,a),B(s,e,null),m(e,c),B(u,e,null),f=!0},p($,h){const b={};if(h[0]&1024&&(b.showDebug=$[10]),h[0]&1&&(b.graph=$[0]),o.$set(b),h[0]&29368448){d=x($[13]);let z;for(z=0;z<d.length;z+=1){const N=Fn($,d,z);p[z]?(p[z].p(N,h),k(p[z],1)):(p[z]=Pn(N),p[z].c(),k(p[z],1),p[z].m(e,i))}for(ae(),z=d.length;z<p.length;z+=1)_(z);ce()}if(h[0]&68682080){j=x($[8]);let z;for(z=0;z<j.length;z+=1){const N=On($,j,z);D[z]?(D[z].p(N,h),k(D[z],1)):(D[z]=qn(N),D[z].c(),k(D[z],1),D[z].m(e,a))}for(ae(),z=j.length;z<D.length;z+=1)g(z);ce()}const S={};h[0]&768&&(S.data=$[21]($[9],$[8])),h[1]&16777216&&(S.$$scope={dirty:h,ctx:$}),s.$set(S);const w={};h[0]&16384&&(w.data=$[14]),h[1]&16777216&&(w.$$scope={dirty:h,ctx:$}),u.$set(w)},i($){if(!f){k(n.$$.fragment,$),k(o.$$.fragment,$);for(let h=0;h<d.length;h+=1)k(p[h]);for(let h=0;h<j.length;h+=1)k(D[h]);k(s.$$.fragment,$),k(u.$$.fragment,$),f=!0}},o($){y(n.$$.fragment,$),y(o.$$.fragment,$),p=p.filter(Boolean);for(let h=0;h<p.length;h+=1)y(p[h]);D=D.filter(Boolean);for(let h=0;h<D.length;h+=1)y(D[h]);y(s.$$.fragment,$),y(u.$$.fragment,$),f=!1},d($){$&&C(e),E(n),E(o),pe(p,$),pe(D,$),E(s),E(u)}}}function ts(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[es],sidebar:[Zi]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J(window,"keydown",r[25]),t=!0)},p(l,i){const a={};i[0]&32767|i[1]&16777216&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function ns(r,e,n){let t,o,l;ee(r,Fe,R=>n(8,o=R)),ee(r,tn,R=>n(9,l=R));let{graph:i}=e,{map:a}=e,{finish:s}=e,{cancel:c}=e,{editingExisting:u}=e;Pt(()=>{X(Fe,o=[],o),l==null||l.stop(),a.getCanvas().style.cursor="inherit"});let f=!0,d=u?"adjust":"append-end",p="snap",_=[],j=[],D=null,g=!1,$=!1,h=!1;function b(R){let te=R.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=te}function S(){let R=_.pop();n(12,_),R&&X(Fe,o=R,o)}function w(){_.length==100&&_.shift(),n(12,_=[..._,JSON.parse(JSON.stringify(o))])}function z(){n(11,p=p=="snap"?"free":"snap"),D&&n(28,D.snapped=p=="snap",D)}function N(R){w(),Fe.update(te=>(d=="append-start"?te.splice(0,0,{point:R.detail.lngLat.toArray(),snapped:p=="snap"}):d=="append-end"&&te.push({point:R.detail.lngLat.toArray(),snapped:p=="snap"}),te))}function P(R){n(28,D={point:R.detail.lngLat.toArray(),snapped:p=="snap"})}function q(R){w(),Fe.update(te=>(te[R].snapped=!te[R].snapped,te))}function V(R){w(),Fe.update(te=>(te.splice(R,1),te)),n(5,g=!1)}function T(R,te){try{if(R)return JSON.parse(R.inner.calculateRoute(te))}catch{}return Tt()}function G(R,te,he,mt,Mt){if(Mt)return Tt();try{if(R&&te.length>0&&mt){if(he=="append-start")return JSON.parse(R.inner.calculateRoute([mt,te[0]]));if(he=="append-end")return JSON.parse(R.inner.calculateRoute([te[te.length-1],mt]))}}catch{}return Tt()}function K(R,te,he,mt){if(mt)return;if(!R||he!="adjust"){n(13,j=[]);return}let Mt=[],Rt=1;for(let Lt=0;Lt<te.length-1;Lt++){let _o=JSON.parse(R.inner.getExtraNodes(te[Lt],te[Lt+1]));for(let[ho,$o,bo]of _o)Mt.push({point:[ho,$o],snapped:bo,insertIdx:Rt});Rt++}n(13,j=Mt)}function Q(R){w(),Fe.update(te=>(te.splice(R.insertIdx,0,{point:R.point,snapped:R.snapped}),te)),n(7,h=!0)}function O(R){Fe.update(te=>(te[R.insertIdx].point=R.point,te))}function U(){n(7,h=!1)}function _e(R){let te=R.target.tagName,he=te=="INPUT"||te=="TEXTAREA";R.key==="Enter"&&!he?(R.stopPropagation(),o.length>=2&&s()):R.key==="Escape"?(R.stopPropagation(),c()):R.key=="s"&&!he?z():R.key=="1"&&!he?n(4,d="append-start"):R.key=="2"&&!he?n(4,d="append-end"):R.key=="3"&&!he?n(4,d="adjust"):R.key=="z"&&R.ctrlKey&&(R.stopPropagation(),S())}function be(){w(),n(6,$=!0)}const Oe=[[],[]];function ut(R,te){r.$$.not_equal(te.point,R)&&(te.point=R,n(13,j))}const yt=R=>Q(R),At=R=>O(R);function nt(R,te){r.$$.not_equal(te.point,R)&&(te.point=R,Fe.set(o))}const He=R=>q(R),Ct=R=>V(R),ft=()=>n(5,g=!0),dt=()=>n(5,g=!1),pt=()=>n(6,$=!1);function jt(){p=this.__value,n(11,p)}function St(){p=this.__value,n(11,p)}function rt(){d=this.__value,n(4,d)}function Re(){d=this.__value,n(4,d)}function zt(){d=this.__value,n(4,d)}function ot(){f=this.checked,n(10,f)}return r.$$set=R=>{"graph"in R&&n(0,i=R.graph),"map"in R&&n(27,a=R.map),"finish"in R&&n(1,s=R.finish),"cancel"in R&&n(2,c=R.cancel),"editingExisting"in R&&n(3,u=R.editingExisting)},r.$$.update=()=>{r.$$.dirty[0]&912&&K(l,o,d,h),r.$$.dirty[0]&268436336&&n(14,t=G(l,o,d,D,g||$)),r.$$.dirty[0]&256&&b(o)},[i,s,c,u,d,g,$,h,o,l,f,p,_,j,t,S,z,N,P,q,V,T,Q,O,U,_e,be,a,D,ut,yt,At,nt,He,Ct,ft,dt,pt,jt,Oe,St,rt,Re,zt,ot]}class rs extends oe{constructor(e){super(),le(this,e,ns,ts,ne,{graph:0,map:27,finish:1,cancel:2,editingExisting:3},null,[-1,-1])}}const os="/route-element/assets/right-arrow-d8c7892c.svg";function Un(r){let e,n;const t=r[4].default,o=De(t,r,r[3],null);return{c(){e=v("div"),o&&o.c(),F(e,"class","section svelte-zax3q3")},m(l,i){A(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&8)&&Te(o,t,l,l[3],n?Ie(t,l[3],i,null):Ne(l[3]),null)},i(l){n||(k(o,l),n=!0)},o(l){y(o,l),n=!1},d(l){l&&C(e),o&&o.d(l)}}}function ls(r){let e,n,t,o,l,i,a,s,c,u,f,d,p=r[2]&&Un(r);return{c(){e=v("button"),n=v("div"),t=v("span"),o=I(r[0]),l=M(),i=v("img"),c=M(),p&&p.c(),F(i,"class","arrow svelte-zax3q3"),kt(i.src,a=os)||F(i,"src",a),F(i,"alt",s="Select "+r[0]),F(n,"class","top-section section svelte-zax3q3"),ve(n,"bordered",r[2]),F(e,"class","clickable-card svelte-zax3q3"),e.disabled=r[1]},m(_,j){A(_,e,j),m(e,n),m(n,t),m(t,o),m(n,l),m(n,i),m(e,c),p&&p.m(e,null),u=!0,f||(d=[J(e,"click",r[5]),J(e,"mouseenter",r[6]),J(e,"mouseleave",r[7])],f=!0)},p(_,[j]){(!u||j&1)&&re(o,_[0]),(!u||j&1&&s!==(s="Select "+_[0]))&&F(i,"alt",s),(!u||j&4)&&ve(n,"bordered",_[2]),_[2]?p?(p.p(_,j),j&4&&k(p,1)):(p=Un(_),p.c(),k(p,1),p.m(e,null)):p&&(ae(),y(p,1,1,()=>{p=null}),ce()),(!u||j&2)&&(e.disabled=_[1])},i(_){u||(k(p),u=!0)},o(_){y(p),u=!1},d(_){_&&C(e),p&&p.d(),f=!1,Ae(d)}}}function is(r,e,n){let{$$slots:t={},$$scope:o}=e,{name:l}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(f){Ce.call(this,r,f)}function c(f){Ce.call(this,r,f)}function u(f){Ce.call(this,r,f)}return r.$$set=f=>{"name"in f&&n(0,l=f.name),"disabled"in f&&n(1,i=f.disabled),"hasSlot"in f&&n(2,a=f.hasSlot),"$$scope"in f&&n(3,o=f.$$scope)},[l,i,a,o,t,s,c,u]}class fo extends oe{constructor(e){super(),le(this,e,is,ls,ne,{name:0,disabled:1,hasSlot:2})}}let Ze={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const it={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},po=Object.keys(it);function Ft(r){return Object.keys(it[r])}const Ye="All movements";function Rn(r,e){let n=[],t=it[r][e];t&&n.push({junctionType:r,movementType:e,...t});let o=it[r][Ye];if(o&&e!=Ye&&n.push({junctionType:r,movementType:Ye,...o}),r=="Crossroads"){let l=it["Simple priority T-junction"][Ye];l&&n.push({junctionType:"Simple priority T-junction",movementType:Ye,...l})}if(r!="Any type of junction"){let l=it["Any type of junction"][Ye];l&&n.push({junctionType:"Any type of junction",movementType:Ye,...l})}return n}function Gn(r,e,n){const t=r.slice();return t[9]=e[n],t}function Jn(r,e,n){const t=r.slice();return t[12]=e[n],t}function Qn(r,e,n){const t=r.slice();return t[12]=e[n],t}function Kn(r,e,n){const t=r.slice();return t[12]=e[n],t}function Hn(r){let e,n;return e=new Ut({props:{$$slots:{default:[cs]},$$scope:{ctx:r}}}),e.$on("close",r[8]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&524295&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ss(r){let e;return{c(){e=I("Type of junction")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function as(r){let e;return{c(){e=I("Type of movement")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Wn(r){let e,n,t;function o(i){r[6](i)}let l={k:"vert-radio",choices:Ft(r[1]),$$slots:{default:[as]},$$scope:{ctx:r}};return r[2]!==void 0&&(l.value=r[2]),e=new Le({props:l}),fe.push(()=>me(e,"value",o)),{c(){L(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,a){const s={};a&2&&(s.choices=Ft(i[1])),a&524288&&(s.$$scope={dirty:a,ctx:i}),!n&&a&4&&(n=!0,s.value=i[2],ge(()=>n=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Zn(r){let e,n=r[12]+"",t;return{c(){e=v("li"),t=I(n)},m(o,l){A(o,e,l),m(e,t)},p(o,l){l&6&&n!==(n=o[12]+"")&&re(t,n)},d(o){o&&C(e)}}}function Xn(r){let e,n=r[12]+"",t;return{c(){e=v("li"),t=I(n)},m(o,l){A(o,e,l),m(e,t)},p(o,l){l&6&&n!==(n=o[12]+"")&&re(t,n)},d(o){o&&C(e)}}}function Vn(r){let e,n=r[12]+"",t;return{c(){e=v("li"),t=I(n)},m(o,l){A(o,e,l),m(e,t)},p(o,l){l&6&&n!==(n=o[12]+"")&&re(t,n)},d(o){o&&C(e)}}}function Yn(r){let e,n,t=r[9].junctionType+"",o,l,i,a,s,c,u=r[9].movementType+"",f,d,p,_,j,D,g,$,h,b,S,w=x(r[9].scoreZero),z=[];for(let T=0;T<w.length;T+=1)z[T]=Zn(Kn(r,w,T));let N=x(r[9].scoreOne),P=[];for(let T=0;T<N.length;T+=1)P[T]=Xn(Qn(r,N,T));let q=x(r[9].scoreTwo),V=[];for(let T=0;T<q.length;T+=1)V[T]=Vn(Jn(r,q,T));return{c(){e=v("tr"),n=v("td"),o=I(t),l=M(),i=v("br"),a=M(),s=v("br"),c=M(),f=I(u),d=M(),p=v("td"),_=v("ul");for(let T=0;T<z.length;T+=1)z[T].c();j=M(),D=v("td"),g=v("ul");for(let T=0;T<P.length;T+=1)P[T].c();$=M(),h=v("td"),b=v("ul");for(let T=0;T<V.length;T+=1)V[T].c();S=M(),F(n,"class","type-row svelte-k4kgn3"),F(p,"class","score-zero svelte-k4kgn3"),F(D,"class","score-one svelte-k4kgn3"),F(h,"class","score-two svelte-k4kgn3")},m(T,G){A(T,e,G),m(e,n),m(n,o),m(n,l),m(n,i),m(n,a),m(n,s),m(n,c),m(n,f),m(e,d),m(e,p),m(p,_);for(let K=0;K<z.length;K+=1)z[K]&&z[K].m(_,null);m(e,j),m(e,D),m(D,g);for(let K=0;K<P.length;K+=1)P[K]&&P[K].m(g,null);m(e,$),m(e,h),m(h,b);for(let K=0;K<V.length;K+=1)V[K]&&V[K].m(b,null);m(e,S)},p(T,G){if(G&6&&t!==(t=T[9].junctionType+"")&&re(o,t),G&6&&u!==(u=T[9].movementType+"")&&re(f,u),G&6){w=x(T[9].scoreZero);let K;for(K=0;K<w.length;K+=1){const Q=Kn(T,w,K);z[K]?z[K].p(Q,G):(z[K]=Zn(Q),z[K].c(),z[K].m(_,null))}for(;K<z.length;K+=1)z[K].d(1);z.length=w.length}if(G&6){N=x(T[9].scoreOne);let K;for(K=0;K<N.length;K+=1){const Q=Qn(T,N,K);P[K]?P[K].p(Q,G):(P[K]=Xn(Q),P[K].c(),P[K].m(g,null))}for(;K<P.length;K+=1)P[K].d(1);P.length=N.length}if(G&6){q=x(T[9].scoreTwo);let K;for(K=0;K<q.length;K+=1){const Q=Jn(T,q,K);V[K]?V[K].p(Q,G):(V[K]=Vn(Q),V[K].c(),V[K].m(b,null))}for(;K<V.length;K+=1)V[K].d(1);V.length=q.length}},d(T){T&&C(e),pe(z,T),pe(P,T),pe(V,T)}}}function cs(r){let e,n,t,o,l,i,a,s,c=r[1],u,f,d,p,_,j,D,g,$;function h(N){r[5](N)}let b={k:"vert-radio",choices:po,$$slots:{default:[ss]},$$scope:{ctx:r}};r[1]!==void 0&&(b.value=r[1]),i=new Le({props:b}),fe.push(()=>me(i,"value",h)),i.$on("change",r[3]);let S=Wn(r),w=x(Rn(r[1],r[2])),z=[];for(let N=0;N<w.length;N+=1)z[N]=Yn(Gn(r,w,N));return{c(){e=v("h1"),e.textContent="LTN 1/20 scoring guidance",n=M(),t=v("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,o=M(),l=v("div"),L(i.$$.fragment),s=M(),S.c(),u=M(),f=v("table"),d=v("tr"),d.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,p=M();for(let N=0;N<z.length;N+=1)z[N].c();_=M(),j=v("button"),j.textContent="OK",Y(l,"display","flex"),Y(l,"justify-content","space-between")},m(N,P){A(N,e,P),A(N,n,P),A(N,t,P),A(N,o,P),A(N,l,P),B(i,l,null),m(l,s),S.m(l,null),A(N,u,P),A(N,f,P),m(f,d),m(f,p);for(let q=0;q<z.length;q+=1)z[q]&&z[q].m(f,null);A(N,_,P),A(N,j,P),D=!0,g||($=J(j,"click",r[7]),g=!0)},p(N,P){const q={};if(P&524288&&(q.$$scope={dirty:P,ctx:N}),!a&&P&2&&(a=!0,q.value=N[1],ge(()=>a=!1)),i.$set(q),P&2&&ne(c,c=N[1])?(ae(),y(S,1,1,ie),ce(),S=Wn(N),S.c(),k(S,1),S.m(l,null)):S.p(N,P),P&6){w=x(Rn(N[1],N[2]));let V;for(V=0;V<w.length;V+=1){const T=Gn(N,w,V);z[V]?z[V].p(T,P):(z[V]=Yn(T),z[V].c(),z[V].m(f,null))}for(;V<z.length;V+=1)z[V].d(1);z.length=w.length}},i(N){D||(k(i.$$.fragment,N),k(S),D=!0)},o(N){y(i.$$.fragment,N),y(S),D=!1},d(N){N&&(C(e),C(n),C(t),C(o),C(l),C(u),C(f),C(_),C(j)),E(i),S.d(N),pe(z,N),g=!1,$()}}}function us(r){let e,n,t,o,l,i,a=r[0]&&Hn(r);return{c(){e=v("button"),e.textContent="LTN 1/20 scoring guidance",n=M(),a&&a.c(),t=qe(),F(e,"class","secondary")},m(s,c){A(s,e,c),A(s,n,c),a&&a.m(s,c),A(s,t,c),o=!0,l||(i=J(e,"click",r[4]),l=!0)},p(s,[c]){s[0]?a?(a.p(s,c),c&1&&k(a,1)):(a=Hn(s),a.c(),k(a,1),a.m(t.parentNode,t)):a&&(ae(),y(a,1,1,()=>{a=null}),ce())},i(s){o||(k(a),o=!0)},o(s){y(a),o=!1},d(s){s&&(C(e),C(n),C(t)),a&&a.d(s),l=!1,i()}}}function fs(r,e,n){let t=!1,o=po[0],l=Ft(o)[0];function i(){n(2,l=Ft(o)[0])}const a=()=>n(0,t=!0);function s(d){o=d,n(1,o)}function c(d){l=d,n(2,l)}return[t,o,l,i,a,s,c,()=>n(0,t=!1),()=>n(0,t=!1)]}class ds extends oe{constructor(e){super(),le(this,e,fs,us,ne,{})}}function ps(r){let e;return{c(){e=I("User")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function xn(r){let e,n;return e=new ds({}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ms(r){let e;return{c(){e=I("Score")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function gs(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j,D,g;function $(z){r[5](z)}let h={k:"horiz-radio",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]],$$slots:{default:[ps]},$$scope:{ctx:r}};r[2].jats[r[0]].properties.details.movements[r[1]].kind!==void 0&&(h.value=r[2].jats[r[0]].properties.details.movements[r[1]].kind),l=new Le({props:h}),fe.push(()=>me(l,"value",$));let b=r[2].jats[r[0]].properties.details.movements[r[1]].kind=="cycling"&&xn();function S(z){r[6](z)}let w={k:"horiz-radio",choices:r[3],$$slots:{default:[ms]},$$scope:{ctx:r}};return r[2].jats[r[0]].properties.details.movements[r[1]].score!==void 0&&(w.value=r[2].jats[r[0]].properties.details.movements[r[1]].score),c=new Le({props:w}),fe.push(()=>me(c,"value",S)),{c(){e=v("label"),n=I(`Name
  `),t=v("input"),o=M(),L(l.$$.fragment),a=M(),b&&b.c(),s=M(),L(c.$$.fragment),f=M(),d=v("label"),p=I(`Comments
  `),_=v("textarea"),F(t,"type","text")},m(z,N){A(z,e,N),m(e,n),m(e,t),$e(t,r[2].jats[r[0]].properties.details.movements[r[1]].name),A(z,o,N),B(l,z,N),A(z,a,N),b&&b.m(z,N),A(z,s,N),B(c,z,N),A(z,f,N),A(z,d,N),m(d,p),m(d,_),$e(_,r[2].jats[r[0]].properties.details.movements[r[1]].notes),j=!0,D||(g=[J(t,"input",r[4]),J(_,"input",r[7])],D=!0)},p(z,[N]){N&7&&t.value!==z[2].jats[z[0]].properties.details.movements[z[1]].name&&$e(t,z[2].jats[z[0]].properties.details.movements[z[1]].name);const P={};N&256&&(P.$$scope={dirty:N,ctx:z}),!i&&N&7&&(i=!0,P.value=z[2].jats[z[0]].properties.details.movements[z[1]].kind,ge(()=>i=!1)),l.$set(P),z[2].jats[z[0]].properties.details.movements[z[1]].kind=="cycling"?b?N&7&&k(b,1):(b=xn(),b.c(),k(b,1),b.m(s.parentNode,s)):b&&(ae(),y(b,1,1,()=>{b=null}),ce());const q={};N&256&&(q.$$scope={dirty:N,ctx:z}),!u&&N&7&&(u=!0,q.value=z[2].jats[z[0]].properties.details.movements[z[1]].score,ge(()=>u=!1)),c.$set(q),N&7&&$e(_,z[2].jats[z[0]].properties.details.movements[z[1]].notes)},i(z){j||(k(l.$$.fragment,z),k(b),k(c.$$.fragment,z),j=!0)},o(z){y(l.$$.fragment,z),y(b),y(c.$$.fragment,z),j=!1},d(z){z&&(C(e),C(o),C(a),C(s),C(f),C(d)),E(l,z),b&&b.d(z),E(c,z),D=!1,Ae(g)}}}function _s(r,e,n){let t;ee(r,H,f=>n(2,t=f));let{junctionIdx:o}=e,{idx:l}=e,i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function a(){t.jats[o].properties.details.movements[l].name=this.value,H.set(t)}function s(f){r.$$.not_equal(t.jats[o].properties.details.movements[l].kind,f)&&(t.jats[o].properties.details.movements[l].kind=f,H.set(t))}function c(f){r.$$.not_equal(t.jats[o].properties.details.movements[l].score,f)&&(t.jats[o].properties.details.movements[l].score=f,H.set(t))}function u(){t.jats[o].properties.details.movements[l].notes=this.value,H.set(t)}return r.$$set=f=>{"junctionIdx"in f&&n(0,o=f.junctionIdx),"idx"in f&&n(1,l=f.idx)},[o,l,t,i,a,s,c,u]}class hs extends oe{constructor(e){super(),le(this,e,_s,gs,ne,{junctionIdx:0,idx:1})}}function $s(r){return r%(2*Math.PI)*180/Math.PI}function Et(r){return r%360*Math.PI/180}function er(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function mo(r,e,n={}){if(n.final===!0)return bs(r,e);const t=er(r),o=er(e),l=Et(t[0]),i=Et(o[0]),a=Et(t[1]),s=Et(o[1]),c=Math.sin(i-l)*Math.cos(s),u=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return $s(Math.atan2(c,u))}function bs(r,e){let n=mo(e,r);return n=(n+180)%360,n}var st=mo;function ks(r,e,n={}){const t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function ws(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!tr(r[0])||!tr(r[1]))throw new Error("coordinates must contain numbers");return ks({type:"Point",coordinates:r},e,n)}function tr(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function vs(r,e={}){const n=To(r),t=(n[0]+n[2])/2,o=(n[1]+n[3])/2;return ws([t,o],e.properties,e)}var ys=vs,Se=63710088e-1,As={centimeters:Se*100,centimetres:Se*100,degrees:360/(2*Math.PI),feet:Se*3.28084,inches:Se*39.37,kilometers:Se/1e3,kilometres:Se/1e3,meters:Se,metres:Se,miles:Se/1609.344,millimeters:Se*1e3,millimetres:Se*1e3,nauticalmiles:Se/1852,radians:1,yards:Se*1.0936};function Cs(r,e,n={}){const t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function js(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!rr(r[0])||!rr(r[1]))throw new Error("coordinates must contain numbers");return Cs({type:"Point",coordinates:r},e,n)}function Ss(r,e="kilometers"){const n=As[e];if(!n)throw new Error(e+" units is invalid");return r/n}function nr(r){return r%(2*Math.PI)*180/Math.PI}function Ht(r){return r%360*Math.PI/180}function rr(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function zs(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ms(r,e,n,t={}){const o=zs(r),l=Ht(o[0]),i=Ht(o[1]),a=Ht(n),s=Ss(e,t.units),c=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),u=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(c)),f=nr(u),d=nr(c);return js([f,d],t.properties)}var vt=Ms,ze=63710088e-1,Ls={centimeters:ze*100,centimetres:ze*100,degrees:360/(2*Math.PI),feet:ze*3.28084,inches:ze*39.37,kilometers:ze/1e3,kilometres:ze/1e3,meters:ze,metres:ze,miles:ze/1609.344,millimeters:ze*1e3,millimetres:ze*1e3,nauticalmiles:ze/1852,radians:1,yards:ze*1.0936};function Bs(r,e="kilometers"){const n=Ls[e];if(!n)throw new Error(e+" units is invalid");return r*n}function Dt(r){return r%360*Math.PI/180}function or(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Es(r,e,n={}){var t=or(r),o=or(e),l=Dt(o[1]-t[1]),i=Dt(o[0]-t[0]),a=Dt(t[1]),s=Dt(o[1]),c=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return Bs(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}var Ds=Es;function Ts(r){let e=ys({type:"FeatureCollection",features:r.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;r.sort((t,o)=>lr(st(e,o.point))-lr(st(e,t.point)));let n=[];for(let t=0;t<r.length;t++){let o=r[t],l=st(o.point,e),i=1;for(let a of Is(t,r.length)){let s=r[a],c=st(e,s.point),u=Ns(o.point,e,i++),f=Ds(o.point,e),d=vt(u,.5*f,l).geometry.coordinates,p=vt(d,.2*f,c).geometry.coordinates;n.push({point1:u,point2:d,point3:p,kind:"cycling",score:"X",name:`${o.name} to ${s.name}`,notes:""})}}return n}function Ns(r,e,n){let t=.003,l=st(r,e)-90,i=t*n;return vt(r,i,l).geometry.coordinates}function lr(r){return(r+360)%360}function Is(r,e){let n=[];for(let t=r+1;t<e;t++)n.push(t);for(let t=0;t<r;t++)n.push(t);return n}const Os="/route-element/assets/movement-aa45473c.svg",Fs="/route-element/assets/pan-fbcec4cd.svg";function ir(r,e,n){const t=r.slice();return t[30]=e[n],t[31]=e,t[32]=n,t}function sr(r,e,n){const t=r.slice();return t[33]=e[n],t[34]=e,t[32]=n,t}function ar(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j,D,g,$,h;function b(G,K){return G[0].mode=="select"?qs:Ps}let S=b(r),w=S(r);function z(G,K){return G[0].mode=="new-arm"?Rs:Us}let N=z(r),P=N(r);function q(G,K){return G[0].mode=="new-movement"?Js:Gs}let V=q(r),T=V(r);return{c(){e=v("div"),n=v("button"),t=v("img"),l=M(),w.c(),i=M(),a=v("button"),s=Jt("svg"),c=Jt("circle"),u=Jt("text"),f=I("A"),d=M(),P.c(),p=M(),_=v("button"),j=v("img"),g=M(),T.c(),kt(t.src,o=Fs)||F(t,"src",o),F(t,"alt","Move map"),Y(t,"vertical-align","middle"),F(n,"class","outline"),F(c,"cx","12"),F(c,"cy","12"),F(c,"r","12"),F(c,"fill","white"),F(u,"x","6"),F(u,"y","16"),F(u,"fill","#4472c4"),F(s,"width","24"),F(s,"height","24"),F(s,"xmlns","http://www.w3.org/2000/svg"),Y(s,"vertical-align","middle"),F(a,"class","outline"),kt(j.src,D=Os)||F(j,"src",D),F(j,"alt","New movement"),Y(j,"vertical-align","middle"),F(_,"class","outline"),F(e,"class","control-panel svelte-l1e6xi")},m(G,K){A(G,e,K),m(e,n),m(n,t),m(n,l),w.m(n,null),m(e,i),m(e,a),m(a,s),m(s,c),m(s,u),m(u,f),m(a,d),P.m(a,null),m(e,p),m(e,_),m(_,j),m(_,g),T.m(_,null),$||(h=[J(n,"click",function(){Zt(r[3])&&r[3].apply(this,arguments)}),J(a,"click",r[11]),J(_,"click",r[12])],$=!0)},p(G,K){r=G,S!==(S=b(r))&&(w.d(1),w=S(r),w&&(w.c(),w.m(n,null))),N!==(N=z(r))&&(P.d(1),P=N(r),P&&(P.c(),P.m(a,null))),V!==(V=q(r))&&(T.d(1),T=V(r),T&&(T.c(),T.m(_,null)))},d(G){G&&C(e),w.d(),P.d(),T.d(),$=!1,Ae(h)}}}function Ps(r){let e;return{c(){e=I("Move map")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function qs(r){let e;return{c(){e=v("b"),e.textContent="Move map"},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Us(r){let e;return{c(){e=I("New arm")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Rs(r){let e;return{c(){e=v("b"),e.textContent="New arm"},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Gs(r){let e;return{c(){e=I("New movement")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Js(r){let e;return{c(){e=v("b"),e.textContent="New movement"},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Qs(r){let e;return{c(){e=v("span"),e.textContent=`${ra(r[32])}`,F(e,"class","dot svelte-l1e6xi"),Y(e,"color","#4472c4"),Y(e,"background-color","white")},m(n,t){A(n,e,t)},p:ie,d(n){n&&C(e)}}}function cr(r){let e,n,t;function o(s){r[13](s,r[33])}function l(){return r[14](r[32])}function i(){return r[15](r[32])}let a={draggable:!0,$$slots:{default:[Qs]},$$scope:{ctx:r}};return r[33].point!==void 0&&(a.lngLat=r[33].point),e=new Xe({props:a}),fe.push(()=>me(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){L(e.$$.fragment)},m(s,c){B(e,s,c),t=!0},p(s,c){r=s;const u={};c[1]&16&&(u.$$scope={dirty:c,ctx:r}),!n&&c[0]&18&&(n=!0,u.lngLat=r[33].point,ge(()=>n=!1)),e.$set(u)},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function Ks(r){let e;return{c(){e=v("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",r[6][r[30].score]),Y(e,"opacity",r[30].kind=="walking & wheeling"?"0%":"100%")},m(n,t){A(n,e,t)},p(n,t){t[0]&18&&Y(e,"background-color",n[6][n[30].score]),t[0]&18&&Y(e,"opacity",n[30].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&C(e)}}}function Hs(r){let e;return{c(){e=v("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",r[6][r[30].score])},m(n,t){A(n,e,t)},p(n,t){t[0]&18&&Y(e,"background-color",n[6][n[30].score])},d(n){n&&C(e)}}}function Ws(r){let e;return{c(){e=v("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",r[6][r[30].score]),Y(e,"opacity","0%")},m(n,t){A(n,e,t)},p(n,t){t[0]&18&&Y(e,"background-color",n[6][n[30].score])},d(n){n&&C(e)}}}function ur(r){let e,n,t,o,l,i,a,s,c;function u(w){r[16](w,r[30])}function f(){return r[17](r[32])}function d(){return r[18](r[32])}let p={draggable:!0,$$slots:{default:[Ks]},$$scope:{ctx:r}};r[30].point1!==void 0&&(p.lngLat=r[30].point1),e=new Xe({props:p}),fe.push(()=>me(e,"lngLat",u)),e.$on("dragend",f),e.$on("click",d);function _(w){r[19](w,r[30])}function j(){return r[20](r[32])}function D(){return r[21](r[32])}let g={draggable:!0,$$slots:{default:[Hs]},$$scope:{ctx:r}};r[30].point2!==void 0&&(g.lngLat=r[30].point2),o=new Xe({props:g}),fe.push(()=>me(o,"lngLat",_)),o.$on("dragend",j),o.$on("click",D);function $(w){r[22](w,r[30])}function h(){return r[23](r[32])}function b(){return r[24](r[32])}let S={draggable:!0,$$slots:{default:[Ws]},$$scope:{ctx:r}};return r[30].point3!==void 0&&(S.lngLat=r[30].point3),a=new Xe({props:S}),fe.push(()=>me(a,"lngLat",$)),a.$on("dragend",h),a.$on("click",b),{c(){L(e.$$.fragment),t=M(),L(o.$$.fragment),i=M(),L(a.$$.fragment)},m(w,z){B(e,w,z),A(w,t,z),B(o,w,z),A(w,i,z),B(a,w,z),c=!0},p(w,z){r=w;const N={};z[0]&18|z[1]&16&&(N.$$scope={dirty:z,ctx:r}),!n&&z[0]&18&&(n=!0,N.lngLat=r[30].point1,ge(()=>n=!1)),e.$set(N);const P={};z[0]&18|z[1]&16&&(P.$$scope={dirty:z,ctx:r}),!l&&z[0]&18&&(l=!0,P.lngLat=r[30].point2,ge(()=>l=!1)),o.$set(P);const q={};z[0]&18|z[1]&16&&(q.$$scope={dirty:z,ctx:r}),!s&&z[0]&18&&(s=!0,q.lngLat=r[30].point3,ge(()=>s=!1)),a.$set(q)},i(w){c||(k(e.$$.fragment,w),k(o.$$.fragment,w),k(a.$$.fragment,w),c=!0)},o(w){y(e.$$.fragment,w),y(o.$$.fragment,w),y(a.$$.fragment,w),c=!1},d(w){w&&(C(t),C(i)),E(e,w),E(o,w),E(a,w)}}}function Zs(r){let e=(r[29].name||"Untitled movement")+"",n;return{c(){n=I(e)},m(t,o){A(t,n,o)},p(t,o){o[0]&536870912&&e!==(e=(t[29].name||"Untitled movement")+"")&&re(n,e)},d(t){t&&C(n)}}}function Xs(r){let e,n;return e=new ct({props:{$$slots:{default:[Zs,({props:t})=>({29:t}),({props:t})=>[t?536870912:0]]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o[0]&536870912|o[1]&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Vs(r){let e=(r[29].name||"Untitled movement")+"",n;return{c(){n=I(e)},m(t,o){A(t,n,o)},p(t,o){o[0]&536870912&&e!==(e=(t[29].name||"Untitled movement")+"")&&re(n,e)},d(t){t&&C(n)}}}function Ys(r){let e,n;return e=new ct({props:{$$slots:{default:[Vs,({props:t})=>({29:t}),({props:t})=>[t?536870912:0]]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o[0]&536870912|o[1]&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function xs(r){let e,n,t,o,l,i;return e=new Me({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":wt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Xs]},$$scope:{ctx:r}}}),e.$on("click",r[8]),t=new Me({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":wt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Ys]},$$scope:{ctx:r}}}),t.$on("click",r[8]),l=new et({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){L(e.$$.fragment),n=M(),L(t.$$.fragment),o=M(),L(l.$$.fragment)},m(a,s){B(e,a,s),A(a,n,s),B(t,a,s),A(a,o,s),B(l,a,s),i=!0},p(a,s){const c={};s[1]&16&&(c.$$scope={dirty:s,ctx:a}),e.$set(c);const u={};s[1]&16&&(u.$$scope={dirty:s,ctx:a}),t.$set(u)},i(a){i||(k(e.$$.fragment,a),k(t.$$.fragment,a),k(l.$$.fragment,a),i=!0)},o(a){y(e.$$.fragment,a),y(t.$$.fragment,a),y(l.$$.fragment,a),i=!1},d(a){a&&(C(n),C(o)),E(e,a),E(t,a),E(l,a)}}}function ea(r){let e,n,t,o;return e=new Me({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Ve({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){L(e.$$.fragment),n=M(),L(t.$$.fragment)},m(l,i){B(e,l,i),A(l,n,i),B(t,l,i),o=!0},p:ie,i(l){o||(k(e.$$.fragment,l),k(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&C(n),E(e,l),E(t,l)}}}function ta(r){let e,n,t,o,l,i,a,s,c;e=new qt({}),e.$on("click",r[7]);let u=r[0].mode!="editing"&&ar(r),f=x(r[4].jats[r[1]].properties.details.arms),d=[];for(let g=0;g<f.length;g+=1)d[g]=cr(sr(r,f,g));const p=g=>y(d[g],1,1,()=>{d[g]=null});let _=x(r[4].jats[r[1]].properties.details.movements),j=[];for(let g=0;g<_.length;g+=1)j[g]=ur(ir(r,_,g));const D=g=>y(j[g],1,1,()=>{j[g]=null});return i=new we({props:{data:r[9](r[4]),$$slots:{default:[xs]},$$scope:{ctx:r}}}),s=new we({props:{data:r[5],$$slots:{default:[ea]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),n=M(),u&&u.c(),t=M();for(let g=0;g<d.length;g+=1)d[g].c();o=M();for(let g=0;g<j.length;g+=1)j[g].c();l=M(),L(i.$$.fragment),a=M(),L(s.$$.fragment)},m(g,$){B(e,g,$),A(g,n,$),u&&u.m(g,$),A(g,t,$);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(g,$);A(g,o,$);for(let h=0;h<j.length;h+=1)j[h]&&j[h].m(g,$);A(g,l,$),B(i,g,$),A(g,a,$),B(s,g,$),c=!0},p(g,$){if(g[0].mode!="editing"?u?u.p(g,$):(u=ar(g),u.c(),u.m(t.parentNode,t)):u&&(u.d(1),u=null),$[0]&22){f=x(g[4].jats[g[1]].properties.details.arms);let S;for(S=0;S<f.length;S+=1){const w=sr(g,f,S);d[S]?(d[S].p(w,$),k(d[S],1)):(d[S]=cr(w),d[S].c(),k(d[S],1),d[S].m(o.parentNode,o))}for(ae(),S=f.length;S<d.length;S+=1)p(S);ce()}if($[0]&86){_=x(g[4].jats[g[1]].properties.details.movements);let S;for(S=0;S<_.length;S+=1){const w=ir(g,_,S);j[S]?(j[S].p(w,$),k(j[S],1)):(j[S]=ur(w),j[S].c(),k(j[S],1),j[S].m(l.parentNode,l))}for(ae(),S=_.length;S<j.length;S+=1)D(S);ce()}const h={};$[0]&16&&(h.data=g[9](g[4])),$[1]&16&&(h.$$scope={dirty:$,ctx:g}),i.$set(h);const b={};$[0]&32&&(b.data=g[5]),$[1]&16&&(b.$$scope={dirty:$,ctx:g}),s.$set(b)},i(g){if(!c){k(e.$$.fragment,g);for(let $=0;$<f.length;$+=1)k(d[$]);for(let $=0;$<_.length;$+=1)k(j[$]);k(i.$$.fragment,g),k(s.$$.fragment,g),c=!0}},o(g){y(e.$$.fragment,g),d=d.filter(Boolean);for(let $=0;$<d.length;$+=1)y(d[$]);j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)y(j[$]);y(i.$$.fragment,g),y(s.$$.fragment,g),c=!1},d(g){g&&(C(n),C(t),C(o),C(l),C(a)),E(e,g),u&&u.d(g),pe(d,g),pe(j,g),E(i,g),E(s,g)}}}function na(r,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:r.point}}}function ra(r){return String.fromCharCode(r+"A".charCodeAt(0))}function oa(r,e,n){let t,o,l;ee(r,H,O=>n(4,o=O)),ee(r,It,O=>n(25,l=O));let{junctionIdx:i}=e,{mode:a}=e,{hoveringSidebar:s}=e,{select:c}=e,{stopEditing:u}=e,f={0:Ze.red.background,1:Ze.amber.background,2:Ze.green.background,X:Ze.critical.background};function d(O,U,_e){let be={type:"FeatureCollection",features:[]},Oe=U.mode=="editing"?U.id:_e;return Oe!=null&&(Oe.kind=="arm"?be.features.push(na(O.jats[i].properties.details.arms[Oe.idx],Oe.idx)):be.features.push(D(O.jats[i].properties.details.movements[Oe.idx],Oe.idx))),be}async function p(O){if(l){for(let U of l.queryRenderedFeatures(O.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a.mode!="select"){if(a.mode=="editing"){await u();return}a.mode=="new-arm"?(X(H,o.jats[i].properties.details.arms=[...o.jats[i].properties.details.arms,{point:O.detail.lngLat.toArray(),name:""}],o),await c({kind:"arm",idx:o.jats[i].properties.details.arms.length-1})):(X(H,o.jats[i].properties.details.movements=[...o.jats[i].properties.details.movements,{point1:O.detail.lngLat.toArray(),point2:vt(O.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:vt(O.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await c({kind:"movement",idx:o.jats[i].properties.details.movements.length-1}))}}}async function _(O){await c({kind:"movement",idx:O.detail.features[0].id})}function j(O){let U={type:"FeatureCollection",features:O.jats[i].properties.details.movements.map((_e,be)=>D(_e,be))};for(let _e of O.jats[i].properties.details.movements)if(U.features.push(g(_e,U.features.length)),_e.kind=="walking & wheeling"){let be={..._e,point1:_e.point3,point3:_e.point1};U.features.push(g(be,U.features.length))}return U}function D(O,U){return{type:"Feature",id:U,properties:{name:O.name,kind:O.kind,color:f[O.score]},geometry:{type:"LineString",coordinates:[O.point1,O.point2,O.point3]}}}function g(O,U){return{type:"Feature",id:U,properties:{kind:O.kind,color:f[O.score],angle:st(O.point2,O.point3)},geometry:{type:"Point",coordinates:O.point3}}}const $=()=>n(0,a={mode:"new-arm"}),h=()=>n(0,a={mode:"new-movement"});function b(O,U){r.$$.not_equal(U.point,O)&&(U.point=O,H.set(o))}const S=O=>c({kind:"arm",idx:O}),w=O=>c({kind:"arm",idx:O});function z(O,U){r.$$.not_equal(U.point1,O)&&(U.point1=O,H.set(o))}const N=O=>c({kind:"movement",idx:O}),P=O=>c({kind:"movement",idx:O});function q(O,U){r.$$.not_equal(U.point2,O)&&(U.point2=O,H.set(o))}const V=O=>c({kind:"movement",idx:O}),T=O=>c({kind:"movement",idx:O});function G(O,U){r.$$.not_equal(U.point3,O)&&(U.point3=O,H.set(o))}const K=O=>c({kind:"movement",idx:O}),Q=O=>c({kind:"movement",idx:O});return r.$$set=O=>{"junctionIdx"in O&&n(1,i=O.junctionIdx),"mode"in O&&n(0,a=O.mode),"hoveringSidebar"in O&&n(10,s=O.hoveringSidebar),"select"in O&&n(2,c=O.select),"stopEditing"in O&&n(3,u=O.stopEditing)},r.$$.update=()=>{r.$$.dirty[0]&1041&&n(5,t=d(o,a,s))},[a,i,c,u,o,t,f,p,_,j,s,$,h,b,S,w,z,N,P,q,V,T,G,K,Q]}class la extends oe{constructor(e){super(),le(this,e,oa,ta,ne,{junctionIdx:1,mode:0,hoveringSidebar:10,select:2,stopEditing:3},null,[-1,-1])}}function fr(r){if(r.movements.length==0)return"No movements added";let e=0,n=0;for(let o of r.movements)e+={0:0,1:1,2:2,X:0}[o.score],n+=2;let t=e/n*100;return`${Math.round(t)}%`}const{window:ia}=at;function dr(r,e,n){const t=r.slice();t[23]=e[n],t[26]=n;const o=t[10][t[23].score];return t[24]=o,t}function pr(r,e,n){const t=r.slice();return t[27]=e[n],t[26]=n,t}function sa(r){let e,n,t,o,l,i,a,s,c;return{c(){e=v("button"),e.textContent="Done",n=M(),t=v("button"),t.textContent="Delete",o=M(),l=v("label"),i=I(`Arm name
        `),a=v("input"),F(a,"type","text")},m(u,f){A(u,e,f),A(u,n,f),A(u,t,f),A(u,o,f),A(u,l,f),m(l,i),m(l,a),$e(a,r[4].jats[r[0]].properties.details.arms[r[1].id.idx].name),s||(c=[J(e,"click",r[19]),J(t,"click",r[8]),J(a,"input",r[20])],s=!0)},p(u,f){f&19&&a.value!==u[4].jats[u[0]].properties.details.arms[u[1].id.idx].name&&$e(a,u[4].jats[u[0]].properties.details.arms[u[1].id.idx].name)},i:ie,o:ie,d(u){u&&(C(e),C(n),C(t),C(o),C(l)),s=!1,Ae(c)}}}function aa(r){let e,n,t,o,l,i,a,s;return e=new hs({props:{junctionIdx:r[0],idx:r[1].id.idx}}),{c(){L(e.$$.fragment),n=M(),t=v("button"),t.textContent="Save",o=M(),l=v("button"),l.textContent="Delete"},m(c,u){B(e,c,u),A(c,n,u),A(c,t,u),A(c,o,u),A(c,l,u),i=!0,a||(s=[J(t,"click",r[7]),J(l,"click",r[8])],a=!0)},p(c,u){const f={};u&1&&(f.junctionIdx=c[0]),u&2&&(f.idx=c[1].id.idx),e.$set(f)},i(c){i||(k(e.$$.fragment,c),i=!0)},o(c){y(e.$$.fragment,c),i=!1},d(c){c&&(C(n),C(t),C(o),C(l)),E(e,c),a=!1,Ae(s)}}}function ca(r){let e,n,t,o,l,i,a,s,c,u,f=r[4].jats[r[0]].properties.name+"",d,p,_=fr(r[4].jats[r[0]].properties.details)+"",j,D,g,$,h,b,S,w,z,N,P=x(r[4].jats[r[0]].properties.details.arms),q=[];for(let Q=0;Q<P.length;Q+=1)q[Q]=mr(pr(r,P,Q));const V=Q=>y(q[Q],1,1,()=>{q[Q]=null});let T=x(r[4].jats[r[0]].properties.details.movements),G=[];for(let Q=0;Q<T.length;Q+=1)G[Q]=gr(dr(r,T,Q));const K=Q=>y(G[Q],1,1,()=>{G[Q]=null});return{c(){e=v("button"),e.textContent="Done",n=M(),t=v("h3"),t.textContent="Arms",o=M();for(let Q=0;Q<q.length;Q+=1)q[Q].c();l=M(),i=v("h3"),i.textContent="Movements",a=M(),s=v("p"),c=I(`Total JAT score
        `),u=v("i"),d=I(f),p=I(`
        : `),j=I(_),D=M(),g=v("button"),$=I("Generate cycling movements between all arms"),b=M();for(let Q=0;Q<G.length;Q+=1)G[Q].c();S=qe(),F(g,"class","secondary"),g.disabled=h=r[4].jats[r[0]].properties.details.arms.length<2},m(Q,O){A(Q,e,O),A(Q,n,O),A(Q,t,O),A(Q,o,O);for(let U=0;U<q.length;U+=1)q[U]&&q[U].m(Q,O);A(Q,l,O),A(Q,i,O),A(Q,a,O),A(Q,s,O),m(s,c),m(s,u),m(u,d),m(s,p),m(s,j),A(Q,D,O),A(Q,g,O),m(g,$),A(Q,b,O);for(let U=0;U<G.length;U+=1)G[U]&&G[U].m(Q,O);A(Q,S,O),w=!0,z||(N=[J(e,"click",r[12]),J(g,"click",r[11])],z=!0)},p(Q,O){if(O&85){P=x(Q[4].jats[Q[0]].properties.details.arms);let U;for(U=0;U<P.length;U+=1){const _e=pr(Q,P,U);q[U]?(q[U].p(_e,O),k(q[U],1)):(q[U]=mr(_e),q[U].c(),k(q[U],1),q[U].m(l.parentNode,l))}for(ae(),U=P.length;U<q.length;U+=1)V(U);ce()}if((!w||O&17)&&f!==(f=Q[4].jats[Q[0]].properties.name+"")&&re(d,f),(!w||O&17)&&_!==(_=fr(Q[4].jats[Q[0]].properties.details)+"")&&re(j,_),(!w||O&17&&h!==(h=Q[4].jats[Q[0]].properties.details.arms.length<2))&&(g.disabled=h),O&1109){T=x(Q[4].jats[Q[0]].properties.details.movements);let U;for(U=0;U<T.length;U+=1){const _e=dr(Q,T,U);G[U]?(G[U].p(_e,O),k(G[U],1)):(G[U]=gr(_e),G[U].c(),k(G[U],1),G[U].m(S.parentNode,S))}for(ae(),U=T.length;U<G.length;U+=1)K(U);ce()}},i(Q){if(!w){for(let O=0;O<P.length;O+=1)k(q[O]);for(let O=0;O<T.length;O+=1)k(G[O]);w=!0}},o(Q){q=q.filter(Boolean);for(let O=0;O<q.length;O+=1)y(q[O]);G=G.filter(Boolean);for(let O=0;O<G.length;O+=1)y(G[O]);w=!1},d(Q){Q&&(C(e),C(n),C(t),C(o),C(l),C(i),C(a),C(s),C(D),C(g),C(b),C(S)),pe(q,Q),pe(G,Q),z=!1,Ae(N)}}}function mr(r){let e,n;function t(){return r[13](r[26])}function o(){return r[14](r[26])}return e=new fo({props:{name:`${_r(r[26])} - ${r[27].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",r[15]),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0},p(l,i){r=l;const a={};i&17&&(a.name=`${_r(r[26])} - ${r[27].name||"Unnamed arm"}`),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l)}}}function ua(r){let e,n,t,o=r[23].score+"",l,i,a,s=hr(r[23].kind)+"",c,u;return{c(){e=v("div"),n=v("span"),t=I("Score: "),l=I(o),i=M(),a=v("span"),c=I(s),u=M(),Y(n,"padding","4px"),Y(n,"color",r[24].font),Y(n,"background-color",r[24].background),Y(e,"width","100%"),Y(e,"display","flex"),Y(e,"justify-content","space-between")},m(f,d){A(f,e,d),m(e,n),m(n,t),m(n,l),m(e,i),m(e,a),m(a,c),A(f,u,d)},p(f,d){d&17&&o!==(o=f[23].score+"")&&re(l,o),d&17&&Y(n,"color",f[24].font),d&17&&Y(n,"background-color",f[24].background),d&17&&s!==(s=hr(f[23].kind)+"")&&re(c,s)},d(f){f&&(C(e),C(u))}}}function gr(r){let e,n;function t(){return r[16](r[26])}function o(){return r[17](r[26])}return e=new fo({props:{name:r[23].name||"Unnamed movement",$$slots:{default:[ua]},$$scope:{ctx:r}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",r[18]),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0},p(l,i){r=l;const a={};i&17&&(a.name=r[23].name||"Unnamed movement"),i&536870929&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l)}}}function fa(r){let e,n,t,o=r[4].jats[r[0]].properties.name+"",l,i,a,s,c;const u=[ca,aa,sa],f=[];function d(p,_){return p[1].mode!="editing"?0:p[1].id.kind=="movement"?1:2}return a=d(r),s=f[a]=u[a](r),{c(){e=v("div"),n=v("h2"),t=I("JAT for "),l=I(o),i=M(),s.c(),F(e,"slot","sidebar")},m(p,_){A(p,e,_),m(e,n),m(n,t),m(n,l),m(e,i),f[a].m(e,null),r[21](e),c=!0},p(p,_){(!c||_&17)&&o!==(o=p[4].jats[p[0]].properties.name+"")&&re(l,o);let j=a;a=d(p),a===j?f[a].p(p,_):(ae(),y(f[j],1,1,()=>{f[j]=null}),ce(),s=f[a],s?s.p(p,_):(s=f[a]=u[a](p),s.c()),k(s,1),s.m(e,null))},i(p){c||(k(s),c=!0)},o(p){y(s),c=!1},d(p){p&&C(e),f[a].d(),r[21](null)}}}function da(r){let e,n;return e=new Ve({props:{filter:["!=",["id"],r[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function pa(r){let e,n,t,o,l,i,a;return n=new Ue({props:{except:"jats"}}),o=new we({props:{data:de(r[4].jats),generateId:!0,$$slots:{default:[da]},$$scope:{ctx:r}}}),i=new la({props:{junctionIdx:r[0],mode:r[1],hoveringSidebar:r[2],select:r[6],stopEditing:r[7]}}),{c(){e=v("div"),L(n.$$.fragment),t=M(),L(o.$$.fragment),l=M(),L(i.$$.fragment),F(e,"slot","map")},m(s,c){A(s,e,c),B(n,e,null),m(e,t),B(o,e,null),m(e,l),B(i,e,null),a=!0},p(s,c){const u={};c&16&&(u.data=de(s[4].jats)),c&536870913&&(u.$$scope={dirty:c,ctx:s}),o.$set(u);const f={};c&1&&(f.junctionIdx=s[0]),c&2&&(f.mode=s[1]),c&4&&(f.hoveringSidebar=s[2]),i.$set(f)},i(s){a||(k(n.$$.fragment,s),k(o.$$.fragment,s),k(i.$$.fragment,s),a=!0)},o(s){y(n.$$.fragment,s),y(o.$$.fragment,s),y(i.$$.fragment,s),a=!1},d(s){s&&C(e),E(n),E(o),E(i)}}}function ma(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[pa],sidebar:[fa]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J(ia,"keydown",r[9]),t=!0)},p(l,[i]){const a={};i&536870975&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function _r(r){return String.fromCharCode(r+"A".charCodeAt(0))}function hr(r){return r.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function ga(r,e,n){let t,o;ee(r,H,q=>n(4,t=q)),ee(r,W,q=>n(5,o=q));let{junctionIdx:l}=e,i={mode:"select"},a=null,s=null,c;async function u(q){a=c.scrollTop,n(1,i={mode:"editing",id:q}),n(2,s=null),await xe(),n(3,c.scrollTop=0,c)}async function f(){n(1,i={mode:"select"}),a!=null&&(await xe(),n(3,c.scrollTop=a,c),a=null)}function d(){i.mode=="editing"&&window.confirm(`Delete this ${i.id.kind}?`)&&(i.id.kind=="movement"?(t.jats[l].properties.details.movements.splice(i.id.idx,1),H.set(t)):(t.jats[l].properties.details.arms.splice(i.id.idx,1),H.set(t)),f())}function p(q){if(i.mode!="editing")return;let V=q.target.tagName,T=V=="INPUT"||V=="TEXTAREA";q.key=="Escape"||q.key=="Enter"&&!T?(q.stopPropagation(),f()):q.key=="Delete"&&!T&&(q.stopPropagation(),d())}let _={0:Ze.red,1:Ze.amber,2:Ze.green,X:Ze.critical};function j(){if(t.jats[l].properties.details.movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let q=t.jats[l].properties.details.movements.filter(V=>V.kind=="walking & wheeling");X(H,t.jats[l].properties.details.movements=[...q,...Ts(t.jats[l].properties.details.arms)],t)}const D=()=>X(W,o={kind:"edit-jat",idx:l},o),g=q=>u({kind:"arm",idx:q}),$=q=>n(2,s={kind:"arm",idx:q}),h=()=>n(2,s=null),b=q=>u({kind:"movement",idx:q}),S=q=>n(2,s={kind:"movement",idx:q}),w=()=>n(2,s=null),z=()=>n(1,i={mode:"select"});function N(){t.jats[l].properties.details.arms[i.id.idx].name=this.value,H.set(t)}function P(q){fe[q?"unshift":"push"](()=>{c=q,n(3,c)})}return r.$$set=q=>{"junctionIdx"in q&&n(0,l=q.junctionIdx)},[l,i,s,c,t,o,u,f,d,p,_,j,D,g,$,h,b,S,w,z,N,P]}class _a extends oe{constructor(e){super(),le(this,e,ga,ma,ne,{junctionIdx:0})}}const{window:ha}=at;function $a(r){let e,n,t,o,l,i,a,s,c,u,f,d;return{c(){e=v("div"),n=v("button"),n.textContent="Done",t=M(),o=v("button"),o.textContent="Delete JAT",l=M(),i=v("label"),a=I(`Name:
      `),s=v("input"),c=M(),u=v("button"),u.textContent="Fill out JAT",F(s,"type","text"),F(e,"slot","sidebar")},m(p,_){A(p,e,_),m(e,n),m(e,t),m(e,o),m(e,l),m(e,i),m(i,a),m(i,s),$e(s,r[1].jats[r[0]].properties.name),m(e,c),m(e,u),f||(d=[J(n,"click",r[6]),J(o,"click",r[4]),J(s,"input",r[7]),J(u,"click",r[8])],f=!0)},p(p,_){_&3&&s.value!==p[1].jats[p[0]].properties.name&&$e(s,p[1].jats[p[0]].properties.name)},d(p){p&&C(e),f=!1,Ae(d)}}}function ba(r){let e,n;return e=new Ve({props:{filter:["!=",["id"],r[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ka(r){let e,n,t,o,l,i,a,s;n=new Ue({props:{except:"jats"}}),o=new we({props:{data:de(r[1].jats),generateId:!0,$$slots:{default:[ba]},$$scope:{ctx:r}}});function c(f){r[5](f)}let u={radius:"50px",outline:!0,color:r[1].jats[r[0]].properties.color};return r[1].jats[r[0]].geometry.coordinates!==void 0&&(u.lngLat=r[1].jats[r[0]].geometry.coordinates),i=new en({props:u}),fe.push(()=>me(i,"lngLat",c)),{c(){e=v("div"),L(n.$$.fragment),t=M(),L(o.$$.fragment),l=M(),L(i.$$.fragment),F(e,"slot","map")},m(f,d){A(f,e,d),B(n,e,null),m(e,t),B(o,e,null),m(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].jats)),d&513&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const _={};d&3&&(_.color=f[1].jats[f[0]].properties.color),!a&&d&3&&(a=!0,_.lngLat=f[1].jats[f[0]].geometry.coordinates,ge(()=>a=!1)),i.$set(_)},i(f){s||(k(n.$$.fragment,f),k(o.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(n.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&C(e),E(n),E(o),E(i)}}}function wa(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[ka],sidebar:[$a]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J(ha,"keydown",r[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function va(r,e,n){let t,o;ee(r,H,d=>n(1,t=d)),ee(r,W,d=>n(2,o=d));let{idx:l}=e;function i(d){d.key=="Escape"&&X(W,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this JAT?")&&(X(W,o={kind:"neutral"},o),await xe(),t.jats.splice(l,1),H.set(t))}function s(d){r.$$.not_equal(t.jats[l].geometry.coordinates,d)&&(t.jats[l].geometry.coordinates=d,H.set(t))}const c=()=>X(W,o={kind:"neutral"},o);function u(){t.jats[l].properties.name=this.value,H.set(t)}const f=()=>X(W,o={kind:"edit-jat-detail",idx:l},o);return r.$$set=d=>{"idx"in d&&n(0,l=d.idx)},[l,t,o,i,a,s,c,u,f]}class ya extends oe{constructor(e){super(),le(this,e,va,wa,ne,{idx:0})}}function $r(r,e,n){const t=r.slice();return t[5]=e[n],t[6]=e,t[7]=n,t}function Aa(r){let e,n;return{c(){e=v("span"),n=M(),F(e,"class","dot svelte-jgyhla")},m(t,o){A(t,e,o),A(t,n,o)},p:ie,d(t){t&&(C(e),C(n))}}}function br(r){let e,n,t;function o(a){r[3](a,r[5],r[6],r[7])}function l(){return r[4](r[7])}let i={draggable:!0,$$slots:{default:[Aa]},$$scope:{ctx:r}};return r[5]!==void 0&&(i.lngLat=r[5]),e=new Xe({props:i}),fe.push(()=>me(e,"lngLat",o)),e.$on("contextmenu",l),{c(){L(e.$$.fragment)},m(a,s){B(e,a,s),t=!0},p(a,s){r=a;const c={};s&256&&(c.$$scope={dirty:s,ctx:r}),!n&&s&1&&(n=!0,c.lngLat=r[5],ge(()=>n=!1)),e.$set(c)},i(a){t||(k(e.$$.fragment,a),t=!0)},o(a){y(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function Ca(r){let e,n,t,o;e=new qt({}),e.$on("click",r[1]);let l=x(r[0].geometry.coordinates),i=[];for(let s=0;s<l.length;s+=1)i[s]=br($r(r,l,s));const a=s=>y(i[s],1,1,()=>{i[s]=null});return{c(){L(e.$$.fragment),n=M();for(let s=0;s<i.length;s+=1)i[s].c();t=qe()},m(s,c){B(e,s,c),A(s,n,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(s,c);A(s,t,c),o=!0},p(s,[c]){if(c&5){l=x(s[0].geometry.coordinates);let u;for(u=0;u<l.length;u+=1){const f=$r(s,l,u);i[u]?(i[u].p(f,c),k(i[u],1)):(i[u]=br(f),i[u].c(),k(i[u],1),i[u].m(t.parentNode,t))}for(ae(),u=l.length;u<i.length;u+=1)a(u);ce()}},i(s){if(!o){k(e.$$.fragment,s);for(let c=0;c<l.length;c+=1)k(i[c]);o=!0}},o(s){y(e.$$.fragment,s),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)y(i[c]);o=!1},d(s){s&&(C(n),C(t)),E(e,s),pe(i,s)}}}function ja(r,e,n){let{f:t}=e;function o(s){t.geometry.coordinates.push(s.detail.lngLat.toArray()),n(0,t)}function l(s){t.geometry.coordinates.splice(s,1),n(0,t)}function i(s,c,u,f){u[f]=s,n(0,t)}const a=s=>l(s);return r.$$set=s=>{"f"in s&&n(0,t=s.f)},[t,o,l,i,a]}class go extends oe{constructor(e){super(),le(this,e,ja,Ca,ne,{f:0})}}const{window:Sa}=at;function kr(r,e,n){const t=r.slice();return t[13]=e[n],t[14]=e,t[15]=n,t}function wr(r){let e;return{c(){e=v("p"),e.textContent="A link needs at least two points"},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function za(r){let e,n,t;function o(){return r[10](r[13])}return{c(){e=v("button"),e.textContent="?",F(e,"class","outline")},m(l,i){A(l,e,i),n||(t=J(e,"click",o),n=!0)},p(l,i){r=l},d(l){l&&C(e),n=!1,t()}}}function Ma(r){let e=r[13].name+"",n,t,o=r[13].description+"",l,i,a,s=Qe[r[13].name]&&za(r);return{c(){n=I(e),t=I(": "),l=I(o),i=M(),s&&s.c(),a=M()},m(c,u){A(c,n,u),A(c,t,u),A(c,l,u),A(c,i,u),s&&s.m(c,u),A(c,a,u)},p(c,u){Qe[c[13].name]&&s.p(c,u)},d(c){c&&(C(n),C(t),C(l),C(i),C(a)),s&&s.d(c)}}}function vr(r){let e,n,t;function o(i){r[11](i,r[15])}let l={k:"horiz-radio",choices:r[13].choices,$$slots:{default:[Ma]},$$scope:{ctx:r}};return r[1].links[r[0]].properties.answers[r[15]]!==void 0&&(l.value=r[1].links[r[0]].properties.answers[r[15]]),e=new Le({props:l}),fe.push(()=>me(e,"value",o)),{c(){L(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,a){r=i;const s={};a&65540&&(s.$$scope={dirty:a,ctx:r}),!n&&a&3&&(n=!0,s.value=r[1].links[r[0]].properties.answers[r[15]],ge(()=>n=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function La(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j,D=!r[3]&&wr(),g=x(je),$=[];for(let b=0;b<g.length;b+=1)$[b]=vr(kr(r,g,b));const h=b=>y($[b],1,1,()=>{$[b]=null});return{c(){e=v("div"),n=v("button"),t=I("Done"),l=M(),i=v("button"),i.textContent="Delete link",a=M(),D&&D.c(),s=M(),c=v("label"),u=I(`Name:
      `),f=v("input"),d=M();for(let b=0;b<$.length;b+=1)$[b].c();n.disabled=o=!r[3],F(f,"type","text"),F(e,"slot","sidebar")},m(b,S){A(b,e,S),m(e,n),m(n,t),m(e,l),m(e,i),m(e,a),D&&D.m(e,null),m(e,s),m(e,c),m(c,u),m(c,f),$e(f,r[1].links[r[0]].properties.name),m(e,d);for(let w=0;w<$.length;w+=1)$[w]&&$[w].m(e,null);p=!0,_||(j=[J(n,"click",r[8]),J(i,"click",r[6]),J(f,"input",r[9])],_=!0)},p(b,S){if((!p||S&8&&o!==(o=!b[3]))&&(n.disabled=o),b[3]?D&&(D.d(1),D=null):D||(D=wr(),D.c(),D.m(e,s)),S&3&&f.value!==b[1].links[b[0]].properties.name&&$e(f,b[1].links[b[0]].properties.name),S&7){g=x(je);let w;for(w=0;w<g.length;w+=1){const z=kr(b,g,w);$[w]?($[w].p(z,S),k($[w],1)):($[w]=vr(z),$[w].c(),k($[w],1),$[w].m(e,null))}for(ae(),w=g.length;w<$.length;w+=1)h(w);ce()}},i(b){if(!p){for(let S=0;S<g.length;S+=1)k($[S]);p=!0}},o(b){$=$.filter(Boolean);for(let S=0;S<$.length;S+=1)y($[S]);p=!1},d(b){b&&C(e),D&&D.d(),pe($,b),_=!1,Ae(j)}}}function Ba(r){let e,n;return e=new Me({props:{paint:{"line-color":["case",["==",["id"],r[0]],["get","color"],"black"],"line-width":6}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Ea(r){let e,n,t,o,l,i,a,s;n=new Ue({props:{except:"links"}}),o=new we({props:{data:de(r[1].links),generateId:!0,$$slots:{default:[Ba]},$$scope:{ctx:r}}});function c(f){r[7](f)}let u={};return r[1].links[r[0]]!==void 0&&(u.f=r[1].links[r[0]]),i=new go({props:u}),fe.push(()=>me(i,"f",c)),{c(){e=v("div"),L(n.$$.fragment),t=M(),L(o.$$.fragment),l=M(),L(i.$$.fragment),F(e,"slot","map")},m(f,d){A(f,e,d),B(n,e,null),m(e,t),B(o,e,null),m(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].links)),d&65537&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const _={};!a&&d&3&&(a=!0,_.f=f[1].links[f[0]],ge(()=>a=!1)),i.$set(_)},i(f){s||(k(n.$$.fragment,f),k(o.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(n.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&C(e),E(n),E(o),E(i)}}}function yr(r){let e,n;return e=new Ut({props:{$$slots:{default:[Da]},$$scope:{ctx:r}}}),e.$on("close",r[12]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&65540&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Da(r){let e,n=r[2].description+"",t,o,l,i;return l=new tt({props:{metric:r[2]}}),{c(){e=v("p"),t=I(n),o=M(),L(l.$$.fragment)},m(a,s){A(a,e,s),m(e,t),A(a,o,s),B(l,a,s),i=!0},p(a,s){(!i||s&4)&&n!==(n=a[2].description+"")&&re(t,n);const c={};s&4&&(c.metric=a[2]),l.$set(c)},i(a){i||(k(l.$$.fragment,a),i=!0)},o(a){y(l.$$.fragment,a),i=!1},d(a){a&&(C(e),C(o)),E(l,a)}}}function Ta(r){let e,n,t,o,l,i;e=new Be({props:{$$slots:{map:[Ea],sidebar:[La]},$$scope:{ctx:r}}});let a=r[2]&&yr(r);return{c(){L(e.$$.fragment),n=M(),a&&a.c(),t=qe()},m(s,c){B(e,s,c),A(s,n,c),a&&a.m(s,c),A(s,t,c),o=!0,l||(i=J(Sa,"keydown",r[5]),l=!0)},p(s,[c]){const u={};c&65567&&(u.$$scope={dirty:c,ctx:s}),e.$set(u),s[2]?a?(a.p(s,c),c&4&&k(a,1)):(a=yr(s),a.c(),k(a,1),a.m(t.parentNode,t)):a&&(ae(),y(a,1,1,()=>{a=null}),ce())},i(s){o||(k(e.$$.fragment,s),k(a),o=!0)},o(s){y(e.$$.fragment,s),y(a),o=!1},d(s){s&&(C(n),C(t)),E(e,s),a&&a.d(s),l=!1,i()}}}function Na(r,e,n){let t,o,l;ee(r,H,D=>n(1,o=D)),ee(r,W,D=>n(4,l=D));let{idx:i}=e,a=null;function s(D){D.key=="Escape"&&t&&X(W,l={kind:"neutral"},l)}async function c(){window.confirm("Really delete this link?")&&(X(W,l={kind:"neutral"},l),await xe(),o.links.splice(i,1),H.set(o))}function u(D){r.$$.not_equal(o.links[i],D)&&(o.links[i]=D,H.set(o))}const f=()=>X(W,l={kind:"neutral"},l);function d(){o.links[i].properties.name=this.value,H.set(o)}const p=D=>n(2,a=Qe[D.name]);function _(D,g){r.$$.not_equal(o.links[i].properties.answers[g],D)&&(o.links[i].properties.answers[g]=D,H.set(o))}const j=()=>n(2,a=null);return r.$$set=D=>{"idx"in D&&n(0,i=D.idx)},r.$$.update=()=>{r.$$.dirty&3&&n(3,t=o.links[i].geometry.coordinates.length>=2)},[i,o,a,t,l,s,c,u,f,d,p,_,j]}class Ia extends oe{constructor(e){super(),le(this,e,Na,Ta,ne,{idx:0})}}function Ar(r,e,n){const t=r.slice();return t[7]=e[n],t[8]=e,t[9]=n,t}function Oa(r){let e;return{c(){e=v("p"),e.textContent=`${r[3].description}`},m(n,t){A(n,e,t)},p:ie,d(n){n&&C(e)}}}function Cr(r){let e,n,t=r[7].properties.name+"",o,l,i,a,s,c;function u(d){r[6](d,r[7])}let f={k:"horiz-radio",choices:je[r[0]].choices};return r[7].properties.answers[r[0]]!==void 0&&(f.value=r[7].properties.answers[r[0]]),i=new Le({props:f}),fe.push(()=>me(i,"value",u)),{c(){e=v("li"),n=v("span"),o=I(t),l=M(),L(i.$$.fragment),s=M(),Y(n,"color",r[7].properties.color)},m(d,p){A(d,e,p),m(e,n),m(n,o),m(e,l),B(i,e,null),m(e,s),c=!0},p(d,p){r=d,(!c||p&4)&&t!==(t=r[7].properties.name+"")&&re(o,t),p&4&&Y(n,"color",r[7].properties.color);const _={};p&1&&(_.choices=je[r[0]].choices),!a&&p&5&&(a=!0,_.value=r[7].properties.answers[r[0]],ge(()=>a=!1)),i.$set(_)},i(d){c||(k(i.$$.fragment,d),c=!0)},o(d){y(i.$$.fragment,d),c=!1},d(d){d&&C(e),E(i)}}}function Fa(r){let e,n;return e=new tt({props:{metric:r[3]}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Pa(r){let e,n,t,o,l=je[r[0]].name+"",i,a,s=je[r[0]].description+"",c,u,f,d,p,_,j,D,g=r[3]&&Oa(r),$=x(r[2].links),h=[];for(let w=0;w<$.length;w+=1)h[w]=Cr(Ar(r,$,w));const b=w=>y(h[w],1,1,()=>{h[w]=null});let S=r[3]&&Fa(r);return{c(){e=v("div"),n=v("button"),n.textContent="Done",t=M(),o=v("h2"),i=I(l),a=I(": "),c=I(s),u=M(),g&&g.c(),f=M(),d=v("ol");for(let w=0;w<h.length;w+=1)h[w].c();p=M(),S&&S.c(),F(e,"slot","sidebar")},m(w,z){A(w,e,z),m(e,n),m(e,t),m(e,o),m(o,i),m(o,a),m(o,c),m(e,u),g&&g.m(e,null),m(e,f),m(e,d);for(let N=0;N<h.length;N+=1)h[N]&&h[N].m(d,null);m(e,p),S&&S.m(e,null),_=!0,j||(D=J(n,"click",r[5]),j=!0)},p(w,z){if((!_||z&1)&&l!==(l=je[w[0]].name+"")&&re(i,l),(!_||z&1)&&s!==(s=je[w[0]].description+"")&&re(c,s),w[3]&&g.p(w,z),z&5){$=x(w[2].links);let N;for(N=0;N<$.length;N+=1){const P=Ar(w,$,N);h[N]?(h[N].p(P,z),k(h[N],1)):(h[N]=Cr(P),h[N].c(),k(h[N],1),h[N].m(d,null))}for(ae(),N=$.length;N<h.length;N+=1)b(N);ce()}w[3]&&S.p(w,z)},i(w){if(!_){for(let z=0;z<$.length;z+=1)k(h[z]);k(S),_=!0}},o(w){h=h.filter(Boolean);for(let z=0;z<h.length;z+=1)y(h[z]);y(S),_=!1},d(w){w&&C(e),g&&g.d(),pe(h,w),S&&S.d(),j=!1,D()}}}function qa(r){let e,n,t;return n=new Ue({props:{showColor:"links",except:"",showMissingProperty:["at",r[0],["get","answers"]]}}),{c(){e=v("div"),L(n.$$.fragment),F(e,"slot","map")},m(o,l){A(o,e,l),B(n,e,null),t=!0},p(o,l){const i={};l&1&&(i.showMissingProperty=["at",o[0],["get","answers"]]),n.$set(i)},i(o){t||(k(n.$$.fragment,o),t=!0)},o(o){y(n.$$.fragment,o),t=!1},d(o){o&&C(e),E(n)}}}function Ua(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[qa],sidebar:[Pa]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J(window,"keydown",r[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function Ra(r,e,n){let t,o;ee(r,W,u=>n(1,t=u)),ee(r,H,u=>n(2,o=u));let{qIdx:l}=e,i=Qe[je[l].name];function a(u){u.key=="Escape"&&X(W,t={kind:"neutral"},t)}const s=()=>X(W,t={kind:"neutral"},t);function c(u,f){r.$$.not_equal(f.properties.answers[l],u)&&(f.properties.answers[l]=u,H.set(o))}return r.$$set=u=>{"qIdx"in u&&n(0,l=u.qIdx)},[l,t,o,i,a,s,c]}class Ga extends oe{constructor(e){super(),le(this,e,Ra,Ua,ne,{qIdx:0})}}function Ja(r){let e,n,t,o;const l=r[2].default,i=De(l,r,r[1],null);return{c(){e=v("a"),i&&i.c(),F(e,"href","#"),Y(e,"color",r[0])},m(a,s){A(a,e,s),i&&i.m(e,null),n=!0,t||(o=J(e,"click",No(r[3])),t=!0)},p(a,[s]){i&&i.p&&(!n||s&2)&&Te(i,l,a,a[1],n?Ie(l,a[1],s,null):Ne(a[1]),null),s&1&&Y(e,"color",a[0])},i(a){n||(k(i,a),n=!0)},o(a){y(i,a),n=!1},d(a){a&&C(e),i&&i.d(a),t=!1,o()}}}function Qa(r,e,n){let{$$slots:t={},$$scope:o}=e,{color:l=void 0}=e;function i(a){Ce.call(this,r,a)}return r.$$set=a=>{"color"in a&&n(0,l=a.color),"$$scope"in a&&n(1,o=a.$$scope)},[l,o,t,i]}class Ke extends oe{constructor(e){super(),le(this,e,Qa,Ja,ne,{color:0})}}function jr(r,e,n){const t=r.slice();return t[5]=e[n],t[7]=n,t}function Ka(r){let e;return{c(){e=I(`ST20
  `)},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Ha(r){let e=r[5].properties.name+"",n;return{c(){n=I(e)},m(t,o){A(t,n,o)},p(t,o){o&2&&e!==(e=t[5].properties.name+"")&&re(n,e)},d(t){t&&C(n)}}}function Sr(r){let e,n,t,o;function l(){return r[4](r[7])}return n=new Ke({props:{color:r[5].properties.color,$$slots:{default:[Ha]},$$scope:{ctx:r}}}),n.$on("click",l),{c(){e=v("li"),L(n.$$.fragment),t=M()},m(i,a){A(i,e,a),B(n,e,null),m(e,t),o=!0},p(i,a){r=i;const s={};a&2&&(s.color=r[5].properties.color),a&258&&(s.$$scope={dirty:a,ctx:r}),n.$set(s)},i(i){o||(k(n.$$.fragment,i),o=!0)},o(i){y(n.$$.fragment,i),o=!1},d(i){i&&C(e),E(n)}}}function Wa(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j;i=new Ke({props:{$$slots:{default:[Ka]},$$scope:{ctx:r}}}),i.$on("click",r[3]);let D=x(r[1].bus_stops),g=[];for(let h=0;h<D.length;h+=1)g[h]=Sr(jr(r,D,h));const $=h=>y(g[h],1,1,()=>{g[h]=null});return{c(){e=I(`Bus stops:

`),n=v("div"),t=v("button"),t.textContent="New bus stop",o=M(),l=v("div"),L(i.$$.fragment),a=I(`:
  `),s=v("progress"),f=M(),d=v("ol");for(let h=0;h<g.length;h+=1)g[h].c();s.value=c=r[1].bus_stops.filter(zr).length,F(s,"max",u=r[1].bus_stops.length),F(s,"class","svelte-zadug4")},m(h,b){A(h,e,b),A(h,n,b),m(n,t),A(h,o,b),A(h,l,b),B(i,l,null),m(l,a),m(l,s),A(h,f,b),A(h,d,b);for(let S=0;S<g.length;S+=1)g[S]&&g[S].m(d,null);p=!0,_||(j=J(t,"click",r[2]),_=!0)},p(h,[b]){const S={};if(b&256&&(S.$$scope={dirty:b,ctx:h}),i.$set(S),(!p||b&2&&c!==(c=h[1].bus_stops.filter(zr).length))&&(s.value=c),(!p||b&2&&u!==(u=h[1].bus_stops.length))&&F(s,"max",u),b&3){D=x(h[1].bus_stops);let w;for(w=0;w<D.length;w+=1){const z=jr(h,D,w);g[w]?(g[w].p(z,b),k(g[w],1)):(g[w]=Sr(z),g[w].c(),k(g[w],1),g[w].m(d,null))}for(ae(),w=D.length;w<g.length;w+=1)$(w);ce()}},i(h){if(!p){k(i.$$.fragment,h);for(let b=0;b<D.length;b+=1)k(g[b]);p=!0}},o(h){y(i.$$.fragment,h),g=g.filter(Boolean);for(let b=0;b<g.length;b+=1)y(g[b]);p=!1},d(h){h&&(C(e),C(n),C(o),C(l),C(f),C(d)),E(i),pe(g,h),_=!1,j()}}}const zr=r=>r.properties.st20!="";function Za(r,e,n){let t,o;return ee(r,W,s=>n(0,t=s)),ee(r,H,s=>n(1,o=s)),[t,o,()=>X(W,t={kind:"new-point",obj:"bus stop"},t),()=>X(W,t={kind:"bus-stop-questions"},t),s=>X(W,t={kind:"edit-bus-stop",idx:s},t)]}let Xa=class extends oe{constructor(e){super(),le(this,e,Za,Wa,ne,{})}};function Mr(r,e,n){const t=r.slice();return t[5]=e[n],t[7]=n,t}function Va(r){let e;return{c(){e=I(`SA10
  `)},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Ya(r){let e=r[5].properties.name+"",n;return{c(){n=I(e)},m(t,o){A(t,n,o)},p(t,o){o&2&&e!==(e=t[5].properties.name+"")&&re(n,e)},d(t){t&&C(n)}}}function Lr(r){let e,n,t,o;function l(){return r[4](r[7])}return n=new Ke({props:{color:r[5].properties.color,$$slots:{default:[Ya]},$$scope:{ctx:r}}}),n.$on("click",l),{c(){e=v("li"),L(n.$$.fragment),t=M()},m(i,a){A(i,e,a),B(n,e,null),m(e,t),o=!0},p(i,a){r=i;const s={};a&2&&(s.color=r[5].properties.color),a&258&&(s.$$scope={dirty:a,ctx:r}),n.$set(s)},i(i){o||(k(n.$$.fragment,i),o=!0)},o(i){y(n.$$.fragment,i),o=!1},d(i){i&&C(e),E(n)}}}function xa(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j;i=new Ke({props:{$$slots:{default:[Va]},$$scope:{ctx:r}}}),i.$on("click",r[3]);let D=x(r[1].crossings),g=[];for(let h=0;h<D.length;h+=1)g[h]=Lr(Mr(r,D,h));const $=h=>y(g[h],1,1,()=>{g[h]=null});return{c(){e=I(`Crossings:

`),n=v("div"),t=v("button"),t.textContent="New crossing",o=M(),l=v("div"),L(i.$$.fragment),a=I(`:
  `),s=v("progress"),f=M(),d=v("ol");for(let h=0;h<g.length;h+=1)g[h].c();s.value=c=r[1].crossings.filter(Br).length,F(s,"max",u=r[1].crossings.length)},m(h,b){A(h,e,b),A(h,n,b),m(n,t),A(h,o,b),A(h,l,b),B(i,l,null),m(l,a),m(l,s),A(h,f,b),A(h,d,b);for(let S=0;S<g.length;S+=1)g[S]&&g[S].m(d,null);p=!0,_||(j=J(t,"click",r[2]),_=!0)},p(h,[b]){const S={};if(b&256&&(S.$$scope={dirty:b,ctx:h}),i.$set(S),(!p||b&2&&c!==(c=h[1].crossings.filter(Br).length))&&(s.value=c),(!p||b&2&&u!==(u=h[1].crossings.length))&&F(s,"max",u),b&3){D=x(h[1].crossings);let w;for(w=0;w<D.length;w+=1){const z=Mr(h,D,w);g[w]?(g[w].p(z,b),k(g[w],1)):(g[w]=Lr(z),g[w].c(),k(g[w],1),g[w].m(d,null))}for(ae(),w=D.length;w<g.length;w+=1)$(w);ce()}},i(h){if(!p){k(i.$$.fragment,h);for(let b=0;b<D.length;b+=1)k(g[b]);p=!0}},o(h){y(i.$$.fragment,h),g=g.filter(Boolean);for(let b=0;b<g.length;b+=1)y(g[b]);p=!1},d(h){h&&(C(e),C(n),C(o),C(l),C(f),C(d)),E(i),pe(g,h),_=!1,j()}}}const Br=r=>r.properties.sa10!="";function ec(r,e,n){let t,o;return ee(r,W,s=>n(0,t=s)),ee(r,H,s=>n(1,o=s)),[t,o,()=>X(W,t={kind:"new-point",obj:"crossing"},t),()=>X(W,t={kind:"crossing-questions"},t),s=>X(W,t={kind:"edit-crossing",idx:s},t)]}let tc=class extends oe{constructor(e){super(),le(this,e,ec,xa,ne,{})}};function Er(r,e,n){const t=r.slice();return t[4]=e[n],t[6]=n,t}function nc(r){let e=r[4].properties.name+"",n;return{c(){n=I(e)},m(t,o){A(t,n,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&re(n,e)},d(t){t&&C(n)}}}function Dr(r){let e,n,t,o;function l(){return r[3](r[6])}return n=new Ke({props:{color:r[4].properties.color,$$slots:{default:[nc]},$$scope:{ctx:r}}}),n.$on("click",l),{c(){e=v("li"),L(n.$$.fragment),t=M()},m(i,a){A(i,e,a),B(n,e,null),m(e,t),o=!0},p(i,a){r=i;const s={};a&2&&(s.color=r[4].properties.color),a&130&&(s.$$scope={dirty:a,ctx:r}),n.$set(s)},i(i){o||(k(n.$$.fragment,i),o=!0)},o(i){y(n.$$.fragment,i),o=!1},d(i){i&&C(e),E(n)}}}function rc(r){let e,n,t,o,l,i,a,s,c=x(r[1].jats),u=[];for(let d=0;d<c.length;d+=1)u[d]=Dr(Er(r,c,d));const f=d=>y(u[d],1,1,()=>{u[d]=null});return{c(){e=I(`JATs:

`),n=v("div"),t=v("button"),t.textContent="New JAT",o=M(),l=v("ol");for(let d=0;d<u.length;d+=1)u[d].c()},m(d,p){A(d,e,p),A(d,n,p),m(n,t),A(d,o,p),A(d,l,p);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(l,null);i=!0,a||(s=J(t,"click",r[2]),a=!0)},p(d,[p]){if(p&3){c=x(d[1].jats);let _;for(_=0;_<c.length;_+=1){const j=Er(d,c,_);u[_]?(u[_].p(j,p),k(u[_],1)):(u[_]=Dr(j),u[_].c(),k(u[_],1),u[_].m(l,null))}for(ae(),_=c.length;_<u.length;_+=1)f(_);ce()}},i(d){if(!i){for(let p=0;p<c.length;p+=1)k(u[p]);i=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)y(u[p]);i=!1},d(d){d&&(C(e),C(n),C(o),C(l)),pe(u,d),a=!1,s()}}}function oc(r,e,n){let t,o;return ee(r,W,a=>n(0,t=a)),ee(r,H,a=>n(1,o=a)),[t,o,()=>X(W,t={kind:"new-point",obj:"jat"},t),a=>X(W,t={kind:"edit-jat",idx:a},t)]}let lc=class extends oe{constructor(e){super(),le(this,e,oc,rc,ne,{})}};function Tr(r,e,n){const t=r.slice();return t[2]=e[n],t[4]=n,t}function Nr(r,e,n){const t=r.slice();t[5]=e[n];const o=t[5].properties.answers[t[4]];return t[6]=o,t}function Ir(r,e,n){const t=r.slice();return t[5]=e[n],t}function Or(r){let e,n=r[5].properties.name+"",t;return{c(){e=v("th"),t=I(n),Y(e,"color",r[5].properties.color)},m(o,l){A(o,e,l),m(e,t)},p(o,l){l&1&&n!==(n=o[5].properties.name+"")&&re(t,n),l&1&&Y(e,"color",o[5].properties.color)},d(o){o&&C(e)}}}function Fr(r){let e,n=r[6]+"",t;return{c(){e=v("td"),t=I(n),Y(e,"background",r[6]==""?"red":"green")},m(o,l){A(o,e,l),m(e,t)},p(o,l){l&1&&n!==(n=o[6]+"")&&re(t,n),l&1&&Y(e,"background",o[6]==""?"red":"green")},d(o){o&&C(e)}}}function Pr(r){let e,n,t,o,l=x(r[0].links),i=[];for(let a=0;a<l.length;a+=1)i[a]=Fr(Nr(r,l,a));return{c(){e=v("tr"),n=v("th"),n.textContent=`${r[2].name}`,t=M();for(let a=0;a<i.length;a+=1)i[a].c();o=M()},m(a,s){A(a,e,s),m(e,n),m(e,t);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);m(e,o)},p(a,s){if(s&1){l=x(a[0].links);let c;for(c=0;c<l.length;c+=1){const u=Nr(a,l,c);i[c]?i[c].p(u,s):(i[c]=Fr(u),i[c].c(),i[c].m(e,o))}for(;c<i.length;c+=1)i[c].d(1);i.length=l.length}},d(a){a&&C(e),pe(i,a)}}}function ic(r){let e,n,t,o,l,i,a,s=x(r[0].links),c=[];for(let d=0;d<s.length;d+=1)c[d]=Or(Ir(r,s,d));let u=x(je),f=[];for(let d=0;d<u.length;d+=1)f[d]=Pr(Tr(r,u,d));return{c(){e=v("table"),n=v("thead"),t=v("tr"),o=v("th"),l=M();for(let d=0;d<c.length;d+=1)c[d].c();i=M(),a=v("tbody");for(let d=0;d<f.length;d+=1)f[d].c()},m(d,p){A(d,e,p),m(e,n),m(n,t),m(t,o),m(t,l);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(t,null);m(e,i),m(e,a);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(a,null)},p(d,p){if(p&1){s=x(d[0].links);let _;for(_=0;_<s.length;_+=1){const j=Ir(d,s,_);c[_]?c[_].p(j,p):(c[_]=Or(j),c[_].c(),c[_].m(t,null))}for(;_<c.length;_+=1)c[_].d(1);c.length=s.length}if(p&1){u=x(je);let _;for(_=0;_<u.length;_+=1){const j=Tr(d,u,_);f[_]?f[_].p(j,p):(f[_]=Pr(j),f[_].c(),f[_].m(a,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=u.length}},d(d){d&&C(e),pe(c,d),pe(f,d)}}}function sc(r){let e,n;return e=new Ut({props:{$$slots:{default:[ic]},$$scope:{ctx:r}}}),e.$on("close",r[1]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,[o]){const l={};o&2049&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ac(r,e,n){let t;ee(r,H,l=>n(0,t=l));function o(l){Ce.call(this,r,l)}return[t,o]}class cc extends oe{constructor(e){super(),le(this,e,ac,sc,ne,{})}}function qr(r,e,n){const t=r.slice();return t[9]=e[n],t[11]=n,t}function Ur(r,e,n){const t=r.slice();return t[12]=e[n],t[11]=n,t}function Rr(r){let e,n;return e=new cc({}),e.$on("close",r[4]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function uc(r){let e=r[12].properties.name+"",n;return{c(){n=I(e)},m(t,o){A(t,n,o)},p(t,o){o&2&&e!==(e=t[12].properties.name+"")&&re(n,e)},d(t){t&&C(n)}}}function Gr(r){let e,n,t,o;function l(){return r[6](r[11])}return n=new Ke({props:{color:r[12].properties.color,$$slots:{default:[uc]},$$scope:{ctx:r}}}),n.$on("click",l),{c(){e=v("li"),L(n.$$.fragment),t=M()},m(i,a){A(i,e,a),B(n,e,null),m(e,t),o=!0},p(i,a){r=i;const s={};a&2&&(s.color=r[12].properties.color),a&16386&&(s.$$scope={dirty:a,ctx:r}),n.$set(s)},i(i){o||(k(n.$$.fragment,i),o=!0)},o(i){y(n.$$.fragment,i),o=!1},d(i){i&&C(e),E(n)}}}function fc(r){let e=r[9].name+"",n,t;return{c(){n=I(e),t=M()},m(o,l){A(o,n,l),A(o,t,l)},p:ie,d(o){o&&(C(n),C(t))}}}function Jr(r){let e,n,t,o,l,i,a,s;function c(){return r[7](r[11])}n=new Ke({props:{$$slots:{default:[fc]},$$scope:{ctx:r}}}),n.$on("click",c);function u(...f){return r[8](r[11],...f)}return{c(){e=v("li"),L(n.$$.fragment),t=I(`:
      `),o=v("progress"),a=M(),o.value=l=r[1].links.filter(u).length,F(o,"max",i=r[1].links.length),F(o,"class","svelte-zadug4")},m(f,d){A(f,e,d),B(n,e,null),m(e,t),m(e,o),m(e,a),s=!0},p(f,d){r=f;const p={};d&16384&&(p.$$scope={dirty:d,ctx:r}),n.$set(p),(!s||d&2&&l!==(l=r[1].links.filter(u).length))&&(o.value=l),(!s||d&2&&i!==(i=r[1].links.length))&&F(o,"max",i)},i(f){s||(k(n.$$.fragment,f),s=!0)},o(f){y(n.$$.fragment,f),s=!1},d(f){f&&C(e),E(n)}}}function dc(r){let e,n,t,o,l,i,a,s,c,u,f,d,p=r[0]&&Rr(r),_=x(r[1].links),j=[];for(let b=0;b<_.length;b+=1)j[b]=Gr(Ur(r,_,b));const D=b=>y(j[b],1,1,()=>{j[b]=null});let g=x(je),$=[];for(let b=0;b<g.length;b+=1)$[b]=Jr(qr(r,g,b));const h=b=>y($[b],1,1,()=>{$[b]=null});return{c(){p&&p.c(),e=M(),n=v("div"),t=v("button"),t.textContent="New link",o=M(),l=v("button"),l.textContent="Table of questions",i=I(`

Links:
`),a=v("ol");for(let b=0;b<j.length;b+=1)j[b].c();s=I(`

Questions:
`),c=v("ol");for(let b=0;b<$.length;b+=1)$[b].c()},m(b,S){p&&p.m(b,S),A(b,e,S),A(b,n,S),m(n,t),m(n,o),m(n,l),A(b,i,S),A(b,a,S);for(let w=0;w<j.length;w+=1)j[w]&&j[w].m(a,null);A(b,s,S),A(b,c,S);for(let w=0;w<$.length;w+=1)$[w]&&$[w].m(c,null);u=!0,f||(d=[J(t,"click",r[3]),J(l,"click",r[5])],f=!0)},p(b,[S]){if(b[0]?p?(p.p(b,S),S&1&&k(p,1)):(p=Rr(b),p.c(),k(p,1),p.m(e.parentNode,e)):p&&(ae(),y(p,1,1,()=>{p=null}),ce()),S&6){_=x(b[1].links);let w;for(w=0;w<_.length;w+=1){const z=Ur(b,_,w);j[w]?(j[w].p(z,S),k(j[w],1)):(j[w]=Gr(z),j[w].c(),k(j[w],1),j[w].m(a,null))}for(ae(),w=_.length;w<j.length;w+=1)D(w);ce()}if(S&6){g=x(je);let w;for(w=0;w<g.length;w+=1){const z=qr(b,g,w);$[w]?($[w].p(z,S),k($[w],1)):($[w]=Jr(z),$[w].c(),k($[w],1),$[w].m(c,null))}for(ae(),w=g.length;w<$.length;w+=1)h(w);ce()}},i(b){if(!u){k(p);for(let S=0;S<_.length;S+=1)k(j[S]);for(let S=0;S<g.length;S+=1)k($[S]);u=!0}},o(b){y(p),j=j.filter(Boolean);for(let S=0;S<j.length;S+=1)y(j[S]);$=$.filter(Boolean);for(let S=0;S<$.length;S+=1)y($[S]);u=!1},d(b){b&&(C(e),C(n),C(i),C(a),C(s),C(c)),p&&p.d(b),pe(j,b),pe($,b),f=!1,Ae(d)}}}function pc(r,e,n){let t,o;ee(r,H,d=>n(1,t=d)),ee(r,W,d=>n(2,o=d));let l=!1;function i(){let d=co(t.links.length);X(H,t.links=[...t.links,d],t),X(W,o={kind:"edit-link",idx:t.links.length-1},o)}return[l,t,o,i,()=>n(0,l=!1),()=>n(0,l=!0),d=>X(W,o={kind:"edit-link",idx:d},o),d=>X(W,o={kind:"link-questions",idx:d},o),(d,p)=>p.properties.answers[d]!=""]}let mc=class extends oe{constructor(e){super(),le(this,e,pc,dc,ne,{})}};function Qr(r,e,n){const t=r.slice();return t[5]=e[n],t[7]=n,t}function gc(r){let e;return{c(){e=I(`SA01
  `)},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function _c(r){let e=r[5].properties.name+"",n;return{c(){n=I(e)},m(t,o){A(t,n,o)},p(t,o){o&1&&e!==(e=t[5].properties.name+"")&&re(n,e)},d(t){t&&C(n)}}}function Kr(r){let e,n,t,o;function l(){return r[4](r[7])}return n=new Ke({props:{color:r[5].properties.color,$$slots:{default:[_c]},$$scope:{ctx:r}}}),n.$on("click",l),{c(){e=v("li"),L(n.$$.fragment),t=M()},m(i,a){A(i,e,a),B(n,e,null),m(e,t),o=!0},p(i,a){r=i;const s={};a&1&&(s.color=r[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:r}),n.$set(s)},i(i){o||(k(n.$$.fragment,i),o=!0)},o(i){y(n.$$.fragment,i),o=!1},d(i){i&&C(e),E(n)}}}function hc(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j;i=new Ke({props:{$$slots:{default:[gc]},$$scope:{ctx:r}}}),i.$on("click",r[3]);let D=x(r[0].side_roads),g=[];for(let h=0;h<D.length;h+=1)g[h]=Kr(Qr(r,D,h));const $=h=>y(g[h],1,1,()=>{g[h]=null});return{c(){e=I(`Side roads:

`),n=v("div"),t=v("button"),t.textContent="New side road",o=M(),l=v("div"),L(i.$$.fragment),a=I(`:
  `),s=v("progress"),f=M(),d=v("ol");for(let h=0;h<g.length;h+=1)g[h].c();s.value=c=r[0].side_roads.filter(Hr).length,F(s,"max",u=r[0].side_roads.length),F(s,"class","svelte-zadug4")},m(h,b){A(h,e,b),A(h,n,b),m(n,t),A(h,o,b),A(h,l,b),B(i,l,null),m(l,a),m(l,s),A(h,f,b),A(h,d,b);for(let S=0;S<g.length;S+=1)g[S]&&g[S].m(d,null);p=!0,_||(j=J(t,"click",r[2]),_=!0)},p(h,[b]){const S={};if(b&256&&(S.$$scope={dirty:b,ctx:h}),i.$set(S),(!p||b&1&&c!==(c=h[0].side_roads.filter(Hr).length))&&(s.value=c),(!p||b&1&&u!==(u=h[0].side_roads.length))&&F(s,"max",u),b&3){D=x(h[0].side_roads);let w;for(w=0;w<D.length;w+=1){const z=Qr(h,D,w);g[w]?(g[w].p(z,b),k(g[w],1)):(g[w]=Kr(z),g[w].c(),k(g[w],1),g[w].m(d,null))}for(ae(),w=D.length;w<g.length;w+=1)$(w);ce()}},i(h){if(!p){k(i.$$.fragment,h);for(let b=0;b<D.length;b+=1)k(g[b]);p=!0}},o(h){y(i.$$.fragment,h),g=g.filter(Boolean);for(let b=0;b<g.length;b+=1)y(g[b]);p=!1},d(h){h&&(C(e),C(n),C(o),C(l),C(f),C(d)),E(i),pe(g,h),_=!1,j()}}}const Hr=r=>r.properties.sa01!="";function $c(r,e,n){let t,o;ee(r,H,s=>n(0,t=s)),ee(r,W,s=>n(1,o=s));function l(){let s=uo(t.side_roads.length);X(H,t.side_roads=[...t.side_roads,s],t),X(W,o={kind:"edit-side-road",idx:t.side_roads.length-1},o)}return[t,o,l,()=>X(W,o={kind:"side-road-questions"},o),s=>X(W,o={kind:"edit-side-road",idx:s},o)]}class bc extends oe{constructor(e){super(),le(this,e,$c,hc,ne,{})}}function kc(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j,D,g,$,h,b,S,w,z,N,P,q,V,T,G,K,Q,O;return p=new mc({}),g=new lc({}),S=new Xa({}),P=new tc({}),G=new bc({}),{c(){e=v("div"),n=v("div"),t=v("button"),t.textContent="Load file",o=M(),l=v("button"),l.textContent="Download",i=M(),a=v("button"),a.textContent="Clear",s=M(),c=v("button"),c.textContent="Draw an entire route",u=M(),f=v("hr"),d=M(),L(p.$$.fragment),_=M(),j=v("hr"),D=M(),L(g.$$.fragment),$=M(),h=v("hr"),b=M(),L(S.$$.fragment),w=M(),z=v("hr"),N=M(),L(P.$$.fragment),q=M(),V=v("hr"),T=M(),L(G.$$.fragment),F(t,"class","secondary"),F(l,"class","secondary"),F(a,"class","secondary"),F(e,"slot","sidebar")},m(U,_e){A(U,e,_e),m(e,n),m(n,t),m(n,o),m(n,l),m(n,i),m(n,a),m(e,s),m(e,c),m(e,u),m(e,f),m(e,d),B(p,e,null),m(e,_),m(e,j),m(e,D),B(g,e,null),m(e,$),m(e,h),m(e,b),B(S,e,null),m(e,w),m(e,z),m(e,N),B(P,e,null),m(e,q),m(e,V),m(e,T),B(G,e,null),K=!0,Q||(O=[J(t,"click",r[12]),J(l,"click",r[13]),J(a,"click",r[5]),J(c,"click",r[6])],Q=!0)},p:ie,i(U){K||(k(p.$$.fragment,U),k(g.$$.fragment,U),k(S.$$.fragment,U),k(P.$$.fragment,U),k(G.$$.fragment,U),K=!0)},o(U){y(p.$$.fragment,U),y(g.$$.fragment,U),y(S.$$.fragment,U),y(P.$$.fragment,U),y(G.$$.fragment,U),K=!1},d(U){U&&C(e),E(p),E(g),E(S),E(P),E(G),Q=!1,Ae(O)}}}function wc(r){let e,n;return e=new Me({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":wt(6,9)},hoverCursor:"pointer"}}),e.$on("click",r[7]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function vc(r){let e,n;return e=new Ve({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":wt(20,25)},hoverCursor:"pointer"}}),e.$on("click",r[8]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function yc(r){let e,n;return e=new et({props:{manageHoverState:!0,layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",r[9]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Ac(r){let e,n;return e=new et({props:{manageHoverState:!0,layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",r[10]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Cc(r){let e,n;return e=new Me({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":wt(3,6)},hoverCursor:"pointer"}}),e.$on("click",r[11]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function jc(r){let e,n,t,o,l,i,a,s,c,u,f;return n=new we({props:{data:de(r[2].links),generateId:!0,$$slots:{default:[wc]},$$scope:{ctx:r}}}),o=new we({props:{data:de(r[2].jats),generateId:!0,$$slots:{default:[vc]},$$scope:{ctx:r}}}),i=new we({props:{data:de(r[2].bus_stops),generateId:!0,$$slots:{default:[yc]},$$scope:{ctx:r}}}),s=new we({props:{data:de(r[2].crossings),generateId:!0,$$slots:{default:[Ac]},$$scope:{ctx:r}}}),u=new we({props:{data:de(r[2].side_roads),generateId:!0,$$slots:{default:[Cc]},$$scope:{ctx:r}}}),{c(){e=v("div"),L(n.$$.fragment),t=M(),L(o.$$.fragment),l=M(),L(i.$$.fragment),a=M(),L(s.$$.fragment),c=M(),L(u.$$.fragment),F(e,"slot","map")},m(d,p){A(d,e,p),B(n,e,null),m(e,t),B(o,e,null),m(e,l),B(i,e,null),m(e,a),B(s,e,null),m(e,c),B(u,e,null),f=!0},p(d,p){const _={};p&4&&(_.data=de(d[2].links)),p&131080&&(_.$$scope={dirty:p,ctx:d}),n.$set(_);const j={};p&4&&(j.data=de(d[2].jats)),p&131080&&(j.$$scope={dirty:p,ctx:d}),o.$set(j);const D={};p&4&&(D.data=de(d[2].bus_stops)),p&131080&&(D.$$scope={dirty:p,ctx:d}),i.$set(D);const g={};p&4&&(g.data=de(d[2].crossings)),p&131080&&(g.$$scope={dirty:p,ctx:d}),s.$set(g);const $={};p&4&&($.data=de(d[2].side_roads)),p&131080&&($.$$scope={dirty:p,ctx:d}),u.$set($)},i(d){f||(k(n.$$.fragment,d),k(o.$$.fragment,d),k(i.$$.fragment,d),k(s.$$.fragment,d),k(u.$$.fragment,d),f=!0)},o(d){y(n.$$.fragment,d),y(o.$$.fragment,d),y(i.$$.fragment,d),y(s.$$.fragment,d),y(u.$$.fragment,d),f=!1},d(d){d&&C(e),E(n),E(o),E(i),E(s),E(u)}}}function Wr(r){let e,n;return e=new Ut({props:{$$slots:{default:[Sc]},$$scope:{ctx:r}}}),e.$on("close",r[15]),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&131074&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Sc(r){let e,n,t,o,l;return{c(){e=v("h1"),e.textContent="Load a file previously downloaded from this tool",n=M(),t=v("input"),F(t,"type","file")},m(i,a){A(i,e,a),A(i,n,a),A(i,t,a),r[14](t),o||(l=J(t,"change",r[4]),o=!0)},p:ie,d(i){i&&(C(e),C(n),C(t)),r[14](null),o=!1,l()}}}function zc(r){let e,n,t,o;e=new Be({props:{$$slots:{map:[jc],sidebar:[kc]},$$scope:{ctx:r}}});let l=r[0]&&Wr(r);return{c(){L(e.$$.fragment),n=M(),l&&l.c(),t=qe()},m(i,a){B(e,i,a),A(i,n,a),l&&l.m(i,a),A(i,t,a),o=!0},p(i,[a]){const s={};a&131085&&(s.$$scope={dirty:a,ctx:i}),e.$set(s),i[0]?l?(l.p(i,a),a&1&&k(l,1)):(l=Wr(i),l.c(),k(l,1),l.m(t.parentNode,t)):l&&(ae(),y(l,1,1,()=>{l=null}),ce())},i(i){o||(k(e.$$.fragment,i),k(l),o=!0)},o(i){y(e.$$.fragment,i),y(l),o=!1},d(i){i&&(C(n),C(t)),E(e,i),l&&l.d(i)}}}function Mc(r,e,n){let t,o,l;ee(r,It,b=>n(16,t=b)),ee(r,H,b=>n(2,o=b)),ee(r,W,b=>n(3,l=b));let i=!1,a;async function s(b){try{let S=JSON.parse(await a.files[0].text());if(lo(S)){X(H,o=S,o),n(0,i=!1);return}}catch{}window.alert("Something's wrong with that file")}function c(){X(H,o.links=[],o),X(H,o.jats=[],o),X(H,o.bus_stops=[],o),X(H,o.crossings=[],o),X(H,o.side_roads=[],o)}async function u(){await Gi(t)}const f=b=>X(W,l={kind:"edit-link",idx:b.detail.features[0].id},l),d=b=>X(W,l={kind:"edit-jat",idx:b.detail.features[0].id},l),p=b=>X(W,l={kind:"edit-bus-stop",idx:b.detail.features[0].id},l),_=b=>X(W,l={kind:"edit-crossing",idx:b.detail.features[0].id},l),j=b=>X(W,l={kind:"edit-side-road",idx:b.detail.features[0].id},l),D=()=>n(0,i=!0),g=()=>Hl("rcv2.geojson",JSON.stringify(o));function $(b){fe[b?"unshift":"push"](()=>{a=b,n(1,a)})}return[i,a,o,l,s,c,u,f,d,p,_,j,D,g,$,()=>n(0,i=!1)]}class Lc extends oe{constructor(e){super(),le(this,e,Mc,zc,ne,{})}}function Bc(r,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Ge[r%Ge.length],st20:""}}}function Ec(r,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:Ge[r%Ge.length],sa10:""}}}function Dc(r){let e,n,t,o,l,i,a,s;return{c(){e=v("div"),n=v("h1"),t=I("Click map to create new "),o=I(r[0]),l=M(),i=v("button"),i.textContent="Cancel",F(e,"slot","sidebar")},m(c,u){A(c,e,u),m(e,n),m(n,t),m(n,o),m(e,l),m(e,i),a||(s=J(i,"click",r[3]),a=!0)},p(c,u){u&1&&re(o,c[0])},d(c){c&&C(e),a=!1,s()}}}function Tc(r){let e,n,t;return n=new Ue({props:{except:""}}),{c(){e=v("div"),L(n.$$.fragment),F(e,"slot","map")},m(o,l){A(o,e,l),B(n,e,null),t=!0},p:ie,i(o){t||(k(n.$$.fragment,o),t=!0)},o(o){y(n.$$.fragment,o),t=!1},d(o){o&&C(e),E(n)}}}function Nc(r){let e,n,t,o;return e=new qt({}),e.$on("click",r[2]),t=new Be({props:{$$slots:{map:[Tc],sidebar:[Dc]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),n=M(),L(t.$$.fragment)},m(l,i){B(e,l,i),A(l,n,i),B(t,l,i),o=!0},p(l,[i]){const a={};i&35&&(a.$$scope={dirty:i,ctx:l}),t.$set(a)},i(l){o||(k(e.$$.fragment,l),k(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&C(n),E(e,l),E(t,l)}}}function Ic(r,e,n){let t,o;ee(r,H,s=>n(4,t=s)),ee(r,W,s=>n(1,o=s));let{obj:l}=e;function i(s){let c=s.detail.lngLat.toArray();if(l=="jat"){let u=ao(t.jats.length,c);X(H,t.jats=[...t.jats,u],t),X(W,o={kind:"edit-jat",idx:t.jats.length-1},o)}else if(l=="crossing"){let u=Ec(t.crossings.length,c);X(H,t.crossings=[...t.crossings,u],t),X(W,o={kind:"edit-crossing",idx:t.crossings.length-1},o)}else if(l=="bus stop"){let u=Bc(t.bus_stops.length,c);X(H,t.bus_stops=[...t.bus_stops,u],t),X(W,o={kind:"edit-bus-stop",idx:t.bus_stops.length-1},o)}}const a=()=>X(W,o={kind:"neutral"},o);return r.$$set=s=>{"obj"in s&&n(0,l=s.obj)},[l,o,i,a]}class Oc extends oe{constructor(e){super(),le(this,e,Ic,Nc,ne,{obj:0})}}const{window:Fc}=at;function Zr(r){let e;return{c(){e=v("p"),e.textContent="A side road needs at least two points"},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function Pc(r){let e;return{c(){e=I("SA01: conflict at side roads and priority junctions")},m(n,t){A(n,e,t)},d(n){n&&C(e)}}}function qc(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_,j,D,g,$,h,b,S,w=!r[2]&&Zr();function z(P){r[10](P)}let N={k:"horiz-radio",choices:ye(),$$slots:{default:[Pc]},$$scope:{ctx:r}};return r[1].side_roads[r[0]].properties.sa01!==void 0&&(N.value=r[1].side_roads[r[0]].properties.sa01),p=new Le({props:N}),fe.push(()=>me(p,"value",z)),$=new tt({props:{metric:r[4]}}),{c(){e=v("div"),n=v("button"),t=I("Done"),l=M(),i=v("button"),i.textContent="Delete side road",a=M(),w&&w.c(),s=M(),c=v("label"),u=I(`Name:
      `),f=v("input"),d=M(),L(p.$$.fragment),j=M(),D=v("p"),D.textContent=`${r[4].description}`,g=M(),L($.$$.fragment),n.disabled=o=!r[2],F(f,"type","text"),F(e,"slot","sidebar")},m(P,q){A(P,e,q),m(e,n),m(n,t),m(e,l),m(e,i),m(e,a),w&&w.m(e,null),m(e,s),m(e,c),m(c,u),m(c,f),$e(f,r[1].side_roads[r[0]].properties.name),m(e,d),B(p,e,null),m(e,j),m(e,D),m(e,g),B($,e,null),h=!0,b||(S=[J(n,"click",r[8]),J(i,"click",r[6]),J(f,"input",r[9])],b=!0)},p(P,q){(!h||q&4&&o!==(o=!P[2]))&&(n.disabled=o),P[2]?w&&(w.d(1),w=null):w||(w=Zr(),w.c(),w.m(e,s)),q&3&&f.value!==P[1].side_roads[P[0]].properties.name&&$e(f,P[1].side_roads[P[0]].properties.name);const V={};q&2048&&(V.$$scope={dirty:q,ctx:P}),!_&&q&3&&(_=!0,V.value=P[1].side_roads[P[0]].properties.sa01,ge(()=>_=!1)),p.$set(V)},i(P){h||(k(p.$$.fragment,P),k($.$$.fragment,P),h=!0)},o(P){y(p.$$.fragment,P),y($.$$.fragment,P),h=!1},d(P){P&&C(e),w&&w.d(),E(p),E($),b=!1,Ae(S)}}}function Uc(r){let e,n;return e=new Me({props:{paint:{"line-color":["case",["==",["id"],r[0]],["get","color"],"black"],"line-width":3}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":3}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Rc(r){let e,n,t,o,l,i,a,s;n=new Ue({props:{except:"side_roads"}}),o=new we({props:{data:de(r[1].side_roads),generateId:!0,$$slots:{default:[Uc]},$$scope:{ctx:r}}});function c(f){r[7](f)}let u={};return r[1].side_roads[r[0]]!==void 0&&(u.f=r[1].side_roads[r[0]]),i=new go({props:u}),fe.push(()=>me(i,"f",c)),{c(){e=v("div"),L(n.$$.fragment),t=M(),L(o.$$.fragment),l=M(),L(i.$$.fragment),F(e,"slot","map")},m(f,d){A(f,e,d),B(n,e,null),m(e,t),B(o,e,null),m(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].side_roads)),d&2049&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const _={};!a&&d&3&&(a=!0,_.f=f[1].side_roads[f[0]],ge(()=>a=!1)),i.$set(_)},i(f){s||(k(n.$$.fragment,f),k(o.$$.fragment,f),k(i.$$.fragment,f),s=!0)},o(f){y(n.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&C(e),E(n),E(o),E(i)}}}function Gc(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[Rc],sidebar:[qc]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J(Fc,"keydown",r[5]),t=!0)},p(l,[i]){const a={};i&2063&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function Jc(r,e,n){let t,o,l;ee(r,H,_=>n(1,o=_)),ee(r,W,_=>n(3,l=_));let{idx:i}=e,a=Qe.SA01;function s(_){_.key=="Escape"&&X(W,l={kind:"neutral"},l)}async function c(){window.confirm("Really delete this side road?")&&(X(W,l={kind:"neutral"},l),await xe(),o.side_roads.splice(i,1),H.set(o))}function u(_){r.$$.not_equal(o.side_roads[i],_)&&(o.side_roads[i]=_,H.set(o))}const f=()=>X(W,l={kind:"neutral"},l);function d(){o.side_roads[i].properties.name=this.value,H.set(o)}function p(_){r.$$.not_equal(o.side_roads[i].properties.sa01,_)&&(o.side_roads[i].properties.sa01=_,H.set(o))}return r.$$set=_=>{"idx"in _&&n(0,i=_.idx)},r.$$.update=()=>{r.$$.dirty&3&&n(2,t=o.side_roads[i].geometry.coordinates.length>=2)},[i,o,t,l,a,s,c,u,f,d,p]}class Qc extends oe{constructor(e){super(),le(this,e,Jc,Gc,ne,{idx:0})}}function Xr(r,e,n){const t=r.slice();return t[6]=e[n],t[7]=e,t[8]=n,t}function Vr(r){let e,n,t=r[6].properties.name+"",o,l,i,a,s,c;function u(d){r[5](d,r[6])}let f={k:"horiz-radio",choices:ye()};return r[6].properties.sa01!==void 0&&(f.value=r[6].properties.sa01),i=new Le({props:f}),fe.push(()=>me(i,"value",u)),{c(){e=v("li"),n=v("span"),o=I(t),l=M(),L(i.$$.fragment),s=M(),Y(n,"color",r[6].properties.color)},m(d,p){A(d,e,p),m(e,n),m(n,o),m(e,l),B(i,e,null),m(e,s),c=!0},p(d,p){r=d,(!c||p&2)&&t!==(t=r[6].properties.name+"")&&re(o,t),p&2&&Y(n,"color",r[6].properties.color);const _={};!a&&p&2&&(a=!0,_.value=r[6].properties.sa01,ge(()=>a=!1)),i.$set(_)},i(d){c||(k(i.$$.fragment,d),c=!0)},o(d){y(i.$$.fragment,d),c=!1},d(d){d&&C(e),E(i)}}}function Kc(r){let e,n,t,o,l,i,a,s,c,u,f,d,p,_=x(r[1].side_roads),j=[];for(let g=0;g<_.length;g+=1)j[g]=Vr(Xr(r,_,g));const D=g=>y(j[g],1,1,()=>{j[g]=null});return u=new tt({props:{metric:r[2]}}),{c(){e=v("div"),n=v("button"),n.textContent="Done",t=M(),o=v("h2"),o.textContent="SA01: Conflict at Side Roads and Priority Junctions",l=M(),i=v("p"),i.textContent=`${r[2].description}`,a=M(),s=v("ol");for(let g=0;g<j.length;g+=1)j[g].c();c=M(),L(u.$$.fragment),F(e,"slot","sidebar")},m(g,$){A(g,e,$),m(e,n),m(e,t),m(e,o),m(e,l),m(e,i),m(e,a),m(e,s);for(let h=0;h<j.length;h+=1)j[h]&&j[h].m(s,null);m(e,c),B(u,e,null),f=!0,d||(p=J(n,"click",r[4]),d=!0)},p(g,$){if($&2){_=x(g[1].side_roads);let h;for(h=0;h<_.length;h+=1){const b=Xr(g,_,h);j[h]?(j[h].p(b,$),k(j[h],1)):(j[h]=Vr(b),j[h].c(),k(j[h],1),j[h].m(s,null))}for(ae(),h=_.length;h<j.length;h+=1)D(h);ce()}},i(g){if(!f){for(let $=0;$<_.length;$+=1)k(j[$]);k(u.$$.fragment,g),f=!0}},o(g){j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)y(j[$]);y(u.$$.fragment,g),f=!1},d(g){g&&C(e),pe(j,g),E(u),d=!1,p()}}}function Hc(r){let e,n,t;return n=new Ue({props:{showColor:"side_roads",except:"",showMissingProperty:["get","sa01"]}}),{c(){e=v("div"),L(n.$$.fragment),F(e,"slot","map")},m(o,l){A(o,e,l),B(n,e,null),t=!0},p:ie,i(o){t||(k(n.$$.fragment,o),t=!0)},o(o){y(n.$$.fragment,o),t=!1},d(o){o&&C(e),E(n)}}}function Wc(r){let e,n,t,o;return e=new Be({props:{$$slots:{map:[Hc],sidebar:[Kc]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(l,i){B(e,l,i),n=!0,t||(o=J(window,"keydown",r[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){y(e.$$.fragment,l),n=!1},d(l){E(e,l),t=!1,o()}}}function Zc(r,e,n){let t,o;ee(r,W,c=>n(0,t=c)),ee(r,H,c=>n(1,o=c));let l=Qe.SA01;function i(c){c.key=="Escape"&&X(W,t={kind:"neutral"},t)}const a=()=>X(W,t={kind:"neutral"},t);function s(c,u){r.$$.not_equal(u.properties.sa01,c)&&(u.properties.sa01=c,H.set(o))}return[t,o,l,i,a,s]}class Xc extends oe{constructor(e){super(),le(this,e,Zc,Wc,ne,{})}}function Vc(r){let e,n;return{c(){e=v("div"),n=v("div"),F(e,"slot","left")},m(t,o){A(t,e,o),m(e,n),r[13](n)},p:ie,d(t){t&&C(e),r[13](null)}}}function Yr(r){let e,n,t;function o(i){r[12](i)}let l={style:r[2],standardControls:!0,hash:!0,images:[{id:"bus_stop",url:ro,options:{sdf:!0}},{id:"crossing",url:oo,options:{sdf:!0}}],$$slots:{default:[fu]},$$scope:{ctx:r}};return r[3]!==void 0&&(l.map=r[3]),e=new Fo({props:l}),fe.push(()=>me(e,"map",o)),{c(){L(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,a){const s={};a&4&&(s.style=i[2]),a&32794&&(s.$$scope={dirty:a,ctx:i}),!n&&a&8&&(n=!0,s.map=i[3],ge(()=>n=!1)),e.$set(s)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Yc(r){let e,n;return e=new rs({props:{graph:r[4].graph,map:r[3],editingExisting:!1,finish:r[10],cancel:r[11]}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.graph=t[4].graph),o&8&&(l.map=t[3]),o&16&&(l.finish=t[10]),o&16&&(l.cancel=t[11]),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function xc(r){let e,n;return e=new bl({}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function eu(r){let e,n;return e=new Xc({}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function tu(r){let e,n;return e=new Ga({props:{qIdx:r[4].idx}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.qIdx=t[4].idx),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function nu(r){let e,n;return e=new Qc({props:{idx:r[4].idx}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.idx=t[4].idx),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ru(r){let e,n;return e=new hi({}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ou(r){let e,n;return e=new ji({props:{idx:r[4].idx}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.idx=t[4].idx),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function lu(r){let e,n;return e=new Bl({props:{idx:r[4].idx}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.idx=t[4].idx),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function iu(r){let e,n;return e=new _a({props:{junctionIdx:r[4].idx}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.junctionIdx=t[4].idx),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function su(r){let e,n;return e=new ya({props:{idx:r[4].idx}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.idx=t[4].idx),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function au(r){let e,n;return e=new Ia({props:{idx:r[4].idx}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.idx=t[4].idx),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function cu(r){let e,n;return e=new Oc({props:{obj:r[4].obj}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.obj=t[4].obj),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function uu(r){let e,n;return e=new Lc({}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p:ie,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function fu(r){let e,n,t,o,l,i,a;const s=[uu,cu,au,su,iu,lu,ou,ru,nu,tu,eu,xc,Yc],c=[];function u(f,d){return f[4].kind=="neutral"?0:f[4].kind=="new-point"?1:f[4].kind=="edit-link"?2:f[4].kind=="edit-jat"?3:f[4].kind=="edit-jat-detail"?4:f[4].kind=="edit-bus-stop"?5:f[4].kind=="edit-crossing"?6:f[4].kind=="crossing-questions"?7:f[4].kind=="edit-side-road"?8:f[4].kind=="link-questions"?9:f[4].kind=="side-road-questions"?10:f[4].kind=="bus-stop-questions"?11:f[4].kind=="draw-route"&&f[3]?12:-1}return~(t=u(r))&&(o=c[t]=s[t](r)),i=new di({}),{c(){e=v("div"),n=M(),o&&o.c(),l=M(),L(i.$$.fragment)},m(f,d){A(f,e,d),r[9](e),A(f,n,d),~t&&c[t].m(f,d),A(f,l,d),B(i,f,d),a=!0},p(f,d){let p=t;t=u(f),t===p?~t&&c[t].p(f,d):(o&&(ae(),y(c[p],1,1,()=>{c[p]=null}),ce()),~t?(o=c[t],o?o.p(f,d):(o=c[t]=s[t](f),o.c()),k(o,1),o.m(l.parentNode,l)):o=null)},i(f){a||(k(o),k(i.$$.fragment,f),a=!0)},o(f){y(o),y(i.$$.fragment,f),a=!1},d(f){f&&(C(e),C(n),C(l)),r[9](null),~t&&c[t].d(f),E(i,f)}}}function du(r){let e,n,t=r[2]&&Yr(r);return{c(){e=v("div"),t&&t.c(),F(e,"slot","main"),Y(e,"position","relative"),Y(e,"width","100%"),Y(e,"height","100vh")},m(o,l){A(o,e,l),t&&t.m(e,null),n=!0},p(o,l){o[2]?t?(t.p(o,l),l&4&&k(t,1)):(t=Yr(o),t.c(),k(t,1),t.m(e,null)):t&&(ae(),y(t,1,1,()=>{t=null}),ce())},i(o){n||(k(t),n=!0)},o(o){y(t),n=!1},d(o){o&&C(e),t&&t.d()}}}function pu(r){let e,n;return e=new Io({props:{$$slots:{main:[du],left:[Vc]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,o){B(e,t,o),n=!0},p(t,[o]){const l={};o&32799&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function mu(r,e,n){let t,o,l,i,a,s;ee(r,Yt,$=>n(5,t=$)),ee(r,Vt,$=>n(6,o=$)),ee(r,Xt,$=>n(7,l=$)),ee(r,H,$=>n(8,i=$)),ee(r,It,$=>n(3,a=$)),ee(r,W,$=>n(4,s=$));let c,u,f=null;Oo(async()=>{n(2,f=await dn(t))});async function d($){n(2,f=await dn($))}function p($){fe[$?"unshift":"push"](()=>{u=$,n(1,u),n(6,o)})}const _=()=>Ji(s.graph),j=()=>X(W,s={kind:"neutral"},s);function D($){a=$,It.set(a)}function g($){fe[$?"unshift":"push"](()=>{c=$,n(0,c),n(7,l)})}return r.$$.update=()=>{r.$$.dirty&256&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(i)),r.$$.dirty&129&&c&&l&&(n(0,c.innerHTML="",c),c.appendChild(l)),r.$$.dirty&66&&u&&o&&(n(1,u.innerHTML="",u),u.appendChild(o)),r.$$.dirty&32&&d(t)},[c,u,f,a,s,t,o,l,i,p,_,j,D,g]}class gu extends oe{constructor(e){super(),le(this,e,mu,pu,ne,{})}}new gu({target:document.getElementById("app")});
