import{X as oo,Y as io,Z as St,v as fe,e as w,w as de,t as _,$ as lo,S as ae,i as ce,s as le,h as De,z as h,B as P,a0 as Ae,r as $,u as Ne,j as Ie,k as Oe,x as k,a1 as Pr,a2 as oe,a3 as Ot,b as me,a4 as xt,Q as g,R as G,l as Se,a5 as so,L as ao,a as ke,c as M,m as B,d as we,f as E,g as qr,q as Qe,a6 as en,a7 as co,a8 as uo,a9 as W,aa as fo,ab as po,C as Y,ac as mo,A as z,ad as Ge,M as Ve,V as x,ae as go,p as ee,af as _o,ag as tn,y as be,T as je,H as F,O as ve,N as Ht,G as Ce,E as Fe,F as tt,ah as ct,ai as et,aj as bt,I as ie,ak as ho,P as wt,al as bo,am as nn,an as $o,ao as zt,_ as ko,ap as wo,n as Et,aq as Kt,ar as vo,as as Rt,D as $t,at as yo,J as Ao,U as Co}from"./Layout-b52eedc9.js";function jo(n,e){const r=e.token={};function t(o,i,l,s){if(e.token!==r)return;e.resolved=s;let a=e.ctx;l!==void 0&&(a=a.slice(),a[l]=s);const u=o&&(e.current=o)(a);let c=!1;e.block&&(e.blocks?e.blocks.forEach((f,d)=>{d!==i&&f&&(fe(),w(f,1,1,()=>{e.blocks[d]===f&&(e.blocks[d]=null)}),de())}):e.block.d(1),u.c(),_(u,1),u.m(e.mount(),e.anchor),c=!0),e.block=u,e.blocks&&(e.blocks[i]=u),c&&lo()}if(oo(n)){const o=io();if(n.then(i=>{St(o),t(e.then,1,e.value,i),St(null)},i=>{if(St(o),t(e.catch,2,e.error,i),St(null),!e.hasCatch)throw i}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function So(n,e,r){const t=e.slice(),{resolved:o}=n;n.current===n.then&&(t[n.value]=o),n.current===n.catch&&(t[n.error]=o),n.block.p(t,r)}function zo(n){let e,r;const t=n[7].default,o=De(t,n,n[6],null);return{c(){e=h("div"),o&&o.c(),P(e,"class",n[1]),Ae(e,"maplibregl-ctrl",n[0])},m(i,l){$(i,e,l),o&&o.m(e,null),n[8](e),r=!0},p(i,[l]){o&&o.p&&(!r||l&64)&&Ne(o,t,i,i[6],r?Oe(t,i[6],l,null):Ie(i[6]),null),(!r||l&2)&&P(e,"class",i[1]),(!r||l&3)&&Ae(e,"maplibregl-ctrl",i[0])},i(i){r||(_(o,i),r=!0)},o(i){w(o,i),r=!1},d(i){i&&k(e),o&&o.d(i),n[8](null)}}}function Lo(n,e,r){let t,{$$slots:o={},$$scope:i}=e,{defaultStyling:l=!0}=e,{position:s="top-right"}=e,{class:a=void 0}=e;const{map:u}=Pr();oe(n,u,m=>r(5,t=m));let c,f={onAdd(){return c},onRemove(){var m;(m=c==null?void 0:c.parentNode)==null||m.removeChild(c)}};Ot(()=>{t==null||t.removeControl(f)});function d(m){me[m?"unshift":"push"](()=>{c=m,r(2,c)})}return n.$$set=m=>{"defaultStyling"in m&&r(0,l=m.defaultStyling),"position"in m&&r(4,s=m.position),"class"in m&&r(1,a=m.class),"$$scope"in m&&r(6,i=m.$$scope)},n.$$.update=()=>{n.$$.dirty&52&&t&&c&&t.addControl(f,s)},[l,a,c,u,s,t,i,o,d]}class Mo extends ae{constructor(e){super(),ce(this,e,Lo,zo,le,{defaultStyling:0,position:4,class:1})}}function Bo(n){let e,r,t,o,i,l;const s=n[4].default,a=De(s,n,n[3],null);return{c(){e=h("button"),r=h("div"),a&&a.c(),P(r,"class",t=xt(n[2])+" svelte-1s83zbq"),Ae(r,"maplibregl-ctrl-icon",n[0]),Ae(r,"ctrl-btn-center",n[1]),P(e,"type","button")},m(u,c){$(u,e,c),g(e,r),a&&a.m(r,null),o=!0,i||(l=G(e,"click",n[5]),i=!0)},p(u,[c]){a&&a.p&&(!o||c&8)&&Ne(a,s,u,u[3],o?Oe(s,u[3],c,null):Ie(u[3]),null),(!o||c&4&&t!==(t=xt(u[2])+" svelte-1s83zbq"))&&P(r,"class",t),(!o||c&5)&&Ae(r,"maplibregl-ctrl-icon",u[0]),(!o||c&6)&&Ae(r,"ctrl-btn-center",u[1])},i(u){o||(_(a,u),o=!0)},o(u){w(a,u),o=!1},d(u){u&&k(e),a&&a.d(u),i=!1,l()}}}function Eo(n,e,r){let{$$slots:t={},$$scope:o}=e,{icon:i=!0}=e,{center:l=!0}=e,{class:s=void 0}=e;function a(u){Se.call(this,n,u)}return n.$$set=u=>{"icon"in u&&r(0,i=u.icon),"center"in u&&r(1,l=u.center),"class"in u&&r(2,s=u.class),"$$scope"in u&&r(3,o=u.$$scope)},[i,l,s,o,t,a]}class Rr extends ae{constructor(e){super(),ce(this,e,Eo,Bo,le,{icon:0,center:1,class:2})}}function To(n,e,r){let t;const o=so();let{layer:i=void 0}=e;const{map:l}=Pr();oe(n,l,c=>r(2,t=c));function s(c){o(c.type,{...c,map:l})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Ot(()=>{if(t)if(i)for(const c of a)t.off(c,i,s);else for(const c of u)t.off(c,s)}),n.$$set=c=>{"layer"in c&&r(1,i=c.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(i)for(const c of a)t.on(c,i,s);else for(const c of u)t.on(c,s)},[l,i,t]}class Ft extends ae{constructor(e){super(),ce(this,e,To,null,le,{layer:1})}}function Do(n){let e;const r=n[16].default,t=De(r,n,n[24],null);return{c(){t&&t.c()},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&16777216)&&Ne(t,r,o,o[24],e?Oe(r,o[24],i,null):Ie(o[24]),null)},i(o){e||(_(t,o),e=!0)},o(o){w(t,o),e=!1},d(o){t&&t.d(o)}}}function No(n){let e,r,t;function o(l){n[17](l)}let i={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Do]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.hovered=n[0]),e=new ao({props:i}),me.push(()=>ke(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,[s]){const a={};s&2&&(a.id=l[1]),s&4&&(a.source=l[2]),s&8&&(a.sourceLayer=l[3]),s&16&&(a.beforeId=l[4]),s&32&&(a.beforeLayerType=l[5]),s&64&&(a.paint=l[6]),s&128&&(a.layout=l[7]),s&256&&(a.filter=l[8]),s&512&&(a.applyToClusters=l[9]),s&1024&&(a.minzoom=l[10]),s&2048&&(a.maxzoom=l[11]),s&4096&&(a.hoverCursor=l[12]),s&8192&&(a.manageHoverState=l[13]),s&16384&&(a.eventsIfTopMost=l[14]),s&32768&&(a.interactive=l[15]),s&16777216&&(a.$$scope={dirty:s,ctx:l}),!r&&s&1&&(r=!0,a.hovered=l[0],we(()=>r=!1)),e.$set(a)},i(l){t||(_(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Io(n,e,r){let{$$slots:t={},$$scope:o}=e,{id:i=qr("symbol")}=e,{source:l=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:f=void 0}=e,{filter:d=void 0}=e,{applyToClusters:m=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:j=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:v=!1}=e,{hovered:A=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:b=!0}=e;function C(T){A=T,r(0,A)}function y(T){Se.call(this,n,T)}function S(T){Se.call(this,n,T)}function D(T){Se.call(this,n,T)}function I(T){Se.call(this,n,T)}function K(T){Se.call(this,n,T)}function V(T){Se.call(this,n,T)}return n.$$set=T=>{"id"in T&&r(1,i=T.id),"source"in T&&r(2,l=T.source),"sourceLayer"in T&&r(3,s=T.sourceLayer),"beforeId"in T&&r(4,a=T.beforeId),"beforeLayerType"in T&&r(5,u=T.beforeLayerType),"paint"in T&&r(6,c=T.paint),"layout"in T&&r(7,f=T.layout),"filter"in T&&r(8,d=T.filter),"applyToClusters"in T&&r(9,m=T.applyToClusters),"minzoom"in T&&r(10,p=T.minzoom),"maxzoom"in T&&r(11,j=T.maxzoom),"hoverCursor"in T&&r(12,L=T.hoverCursor),"manageHoverState"in T&&r(13,v=T.manageHoverState),"hovered"in T&&r(0,A=T.hovered),"eventsIfTopMost"in T&&r(14,O=T.eventsIfTopMost),"interactive"in T&&r(15,b=T.interactive),"$$scope"in T&&r(24,o=T.$$scope)},[A,i,l,s,a,u,c,f,d,m,p,j,L,v,O,b,t,C,y,S,D,I,K,V,o]}class nt extends ae{constructor(e){super(),ce(this,e,Io,No,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function rn(n){let e=n[0],r,t,o=on(n);return{c(){o.c(),r=Qe()},m(i,l){o.m(i,l),$(i,r,l),t=!0},p(i,l){l&1&&le(e,e=i[0])?(fe(),w(o,1,1,Y),de(),o=on(i),o.c(),_(o,1),o.m(r.parentNode,r)):o.p(i,l)},i(i){t||(_(o),t=!0)},o(i){w(o),t=!1},d(i){i&&k(r),o.d(i)}}}function on(n){let e;const r=n[15].default,t=De(r,n,n[14],null);return{c(){t&&t.c()},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&16384)&&Ne(t,r,o,o[14],e?Oe(r,o[14],i,null):Ie(o[14]),null)},i(o){e||(_(t,o),e=!0)},o(o){w(t,o),e=!1},d(o){t&&t.d(o)}}}function Oo(n){let e,r,t=n[0]&&rn(n);return{c(){t&&t.c(),e=Qe()},m(o,i){t&&t.m(o,i),$(o,e,i),r=!0},p(o,[i]){o[0]?t?(t.p(o,i),i&1&&_(t,1)):(t=rn(o),t.c(),_(t,1),t.m(e.parentNode,e)):t&&(fe(),w(t,1,1,()=>{t=null}),de())},i(o){r||(_(t),r=!0)},o(o){w(t),r=!1},d(o){o&&k(e),t&&t.d(o)}}}function Fo(n,e,r){let t,o,{$$slots:i={},$$scope:l}=e,{id:s=qr("vector")}=e,{url:a=null}=e,{tiles:u=null}=e,{promoteId:c=null}=e,{bounds:f=null}=e,{scheme:d=null}=e,{attribution:m=null}=e,{minzoom:p=null}=e,{maxzoom:j=null}=e,{volatile:L=null}=e;if(a&&a.includes("pmtiles://")&&!en.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let b=new mo;en.addProtocol("pmtiles",b.tile)}const{map:v,self:A}=co();oe(n,v,b=>r(13,o=b)),oe(n,A,b=>r(0,t=b));let O;return Ot(()=>{t&&o&&(uo(v,t,O),W(A,t=null,t),O=void 0)}),n.$$set=b=>{"id"in b&&r(3,s=b.id),"url"in b&&r(4,a=b.url),"tiles"in b&&r(5,u=b.tiles),"promoteId"in b&&r(6,c=b.promoteId),"bounds"in b&&r(7,f=b.bounds),"scheme"in b&&r(8,d=b.scheme),"attribution"in b&&r(9,m=b.attribution),"minzoom"in b&&r(10,p=b.minzoom),"maxzoom"in b&&r(11,j=b.maxzoom),"volatile"in b&&r(12,L=b.volatile),"$$scope"in b&&r(14,l=b.$$scope)},n.$$.update=()=>{n.$$.dirty&16377&&o&&t!==s&&(W(A,t=s,t),fo(o,t,po({type:"vector",url:a,tiles:u,promoteId:c,bounds:f,scheme:d,attribution:m,minzoom:p,maxzoom:j,volatile:L}),b=>o&&b===t,()=>{t&&(O=o==null?void 0:o.getSource(t))})),n.$$.dirty&8200&&(o==null||o.on("style.load",()=>{O=o==null?void 0:o.getSource(s)}))},[t,v,A,s,a,u,c,f,d,m,p,j,L,o,l,i]}class Gr extends ae{constructor(e){super(),ce(this,e,Fo,Oo,le,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const Uo=n=>({}),ln=n=>({}),Po=n=>({}),sn=n=>({});function qo(n){let e,r,t,o;const i=n[3].sidebar,l=De(i,n,n[2],sn),s=n[3].map,a=De(s,n,n[2],ln);return{c(){e=h("div"),l&&l.c(),r=z(),t=h("div"),a&&a.c()},m(u,c){$(u,e,c),l&&l.m(e,null),n[4](e),$(u,r,c),$(u,t,c),a&&a.m(t,null),n[5](t),o=!0},p(u,[c]){l&&l.p&&(!o||c&4)&&Ne(l,i,u,u[2],o?Oe(i,u[2],c,Po):Ie(u[2]),sn),a&&a.p&&(!o||c&4)&&Ne(a,s,u,u[2],o?Oe(s,u[2],c,Uo):Ie(u[2]),ln)},i(u){o||(_(l,u),_(a,u),o=!0)},o(u){w(l,u),w(a,u),o=!1},d(u){u&&(k(e),k(r),k(t)),l&&l.d(u),n[4](null),a&&a.d(u),n[5](null)}}}function Ro(n,e,r){let t,o;oe(n,Wt,u=>r(0,t=u)),oe(n,Zt,u=>r(1,o=u));let{$$slots:i={},$$scope:l}=e;function s(u){me[u?"unshift":"push"](()=>{t=u,Wt.set(t)})}function a(u){me[u?"unshift":"push"](()=>{o=u,Zt.set(o)})}return n.$$set=u=>{"$$scope"in u&&r(2,l=u.$$scope)},[t,o,l,i,s,a]}class He extends ae{constructor(e){super(),ce(this,e,Ro,qo,le,{})}}let Wt=Ge(null),Zt=Ge(null);const Jr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAACmlBMVEXo6uzn6e3o6u7n6ezn6uzm6Ozn6evo6ezm6evo6e3p6u7p6+3p6u3o6u3n6u3n6evn6evn6ezo6uzo6u3n6evn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezo6uzo6uzo6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezo6+3n6ezn6ezn6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6ezn6e3n6e3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6e3o6u3o6uzo6uzo6u3o6u3o6u3n6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6uzn6ezn6e3o6u3o6u3o6u3o6u3o6u3n6u3n6ezo6u3o6u3o6uzn6uzn6ezo6ezo6uzn6ezo6u3o6u3o6u3n6u3n6Ozm6ezn6ezo6u3o6u3o6uzo6u3n6u3o6e3o6u3o6u3o6u3n6u3n6ezo6uzo6u3o6u3n6+3o6uzo6u3o6u3o6uzo6uzn6uzn6uzn6ezn6ezn6ezn6ezo6u3n6ezo6ezn6ezn6ezn6ezn6ezn6e3o6u3o6e3n6ezn6ezo6uzn6evo6uzo6uzn6evn6ezo6u3n6ezn6uzo6u3n6ezn6ezo6u3n6u3n6ezo6u3o6u3n6ezn6u3o6u3o6u3n6ezo6u3n6u3n6ezn6ezo6u3n6ezo6u3n6e3n6uzn6ezn6ezn6ezn6ezn6ezn6ezo6u3o6u3n6ezn6ezo6u3o6e3o6u3n6e3o6u3n6u3n6uzo6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6evo6u3o6u3o6u3n6uvn6ezo6u3n6uzn6ezn6ezn6ezo6u3n6uzn6uzo6u3n6u3n6uzo6+zm6uzjK5F0AAAA3nRSTlMAAAAAAAAAAAAAAAAAAAAIDxIUFBMDKEVdbn2IjpOWlpCJb15HKgUACXqjwtrt/P/u3MSmSg0gc7vz4dnSz83U5fT3vnciCnPV8MCdg2JYUk5LU1pmdoyoy/rYdApBt31IIyMjIyyI0LY/AABh366lq19s6GnraXg8PHsAAwOEeF0MKiEiCymqnFmeqXsncN6sOTuuDYzPTlCJCHhyOjyxcGfmkhotgqFcrYIrHONkymEKEC8mLg9jzMhNmr1XVVi/mCSz79ddrI6v3FooDSsAQ6OCFReFoi48GTwtAAD3GpCFAAADBklEQVR4nKWUh1IUQRCGZ+nx8JRZMcspoiKekfbMomDABAaSCbNwxhPMgmLOCTFnxZxzzlkxY86+i927BxzeUmWVf+1O1c5+09Pd09NCaJoWAFJCOQAb0GuzQSAPAOXppVlhD6hQMUgIJpUECUxpviCAxoOuKlRUShikMmYMk5WCK1epWi24UgloDwhSBOqKSTtNVa9Rs1aIo3ad0LphofXqOxqEN4xoxLDBKaGcTiU0pRo3bNK0WfMWkehVZEtXq9aONm1Ne0oXQHuT0XbtO3Sk3y2jOnWOjomJ7tK8azf67B7boydTJMFeBIpevftgXHzffiH9ByQkJiUlJqcMHDR4yNBUHDZ8hG5IlCMBjByF0aPHjE1Loyfd7U5Lc7vd6eOSx0/AiZN0jSUmTyaTnikZmDnVQtPQNZ0ou10JMy8zWmAZmjmLIyeLdkMExloKZ8/x+lgEpmZlz/XXvMjZc3IM+YA2ofxkDVqQ/wn+69bzF/jLClxoqUi/9JSVcD+LGGUpfzB10WILzfPfmqKGJUuXcXkaguURK0BYgysdq1avCTRQCSlr163PVdbghjzEjZvoflJJbd6C6ArRLcGt2yjI7TvMq7qzM33s2u0DFtVj6h7YG4WYuY8sKoD9+YgZB2A9gdKQFzx4CA8fOXos8/gJ8+g0CD9+8tTpM2F49hyAAZotYedQPH/h4qXLV6D4mHOvXltx/QbevMX/PR4vmHsb8U7W3XuldD/rAeLDR5wrqixza0h+jPjk6V+KQ8xPgKLUeslneVYn7Uqhm2UD7lFgNizFYMHzUnqB+PIVJ4uyYGdQY98ZXPX6jY/eFpggo+yjt64NsIZPceuni0GW6WehzfbufXzsh48l2ZGeT59j47+MNHowg4WFheahff327Ts5UwQScCT7x0/JfYdbrDA8oBauSUkhUUP1ngx4aJEOimbNJsVBM6dLyUFpmtcesHFdCiWVMkGbzNFB1xWBupPnDFzzcDJotXJKJ22kCeJyqFupXyaoVCAw+JuzrGi5cOqSurf2B4tMU69Bi01ZAAAAAElFTkSuQmCC",Qr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMA/1uRIrUAAAjuSURBVHic7dxLlqM2FAZgCOdEGUUZZtCntZPWlrKCiKwgW2IpZAdkxoBAbJCEHle27r3UoxNr0KdMoc9Y/HoArm6aV3mVV/m/lHYbeIDaFh6wbVvPqd/dgJEDyBswcwB9A1YOYG7AxgHu9Tmt2O3ASAfEDkx0QO4A4zSwAbUDjDDrHWAEYY8BJwhs4KhPT1JrgeHDgM4C4/cLCAuQe9PHA9IC5O74Al7AC/hswHc8IrGBj58XPn5ydUBPBdgLjE+wRtJ7fcYyT+0AY6HJXuqyV+vs64WWF8SGf8nDv+hSvLN4wYUn+9KXffHNv/xvmAfwKq/yKq/yKv+p0rImxua+TBt4B8Ccm++LLNZN4X15wAI0c4nVMBd5xzKRscw8Vrqc06CYS+1jlcg4jy33ckNwr5gUF9DMq0Z30UcG2FfOkgso7t0DwwTclTcZEFzANQG5O2ousDGBjgtILqC5gGECPkZUQHABFQK/EAATAr8SgC0EvuDrdxHwFQ/ICFB4QMdAjwa2GBiw9dsEGLGASAD0oKQSAB1GkwDoNcLGBLoUwC4yRApgFxk50OMAmQEDDlAZMOIAnQHIJOUAMkkmA5BByAFkEHIAGYQtB3ouMHCBkQvgggAAqCC4EfGfAEAFwQF/BwAqCA74KwBQQXDAHyHQ44G1DYEBD8wRMCIAO6aOEYAJggX6CMAE4QDWJgIwQehsvQjABME9mokATBCOaaFPgB4JrE0CDEhgSYERCcwpgAgCDCCCAAOIIEgQQAQBBhBBkLbNEqDnAgMXGLlAfRDUGwH1SXLRT4D6JBWA+iQVgPok6QLQc4GBC4woYAgAu/StDkIGCPcDFbBTVXUQTAq46ZoMuEUTHTC4IBi78wloXBByAJmkHJC4JG0ZILhAh4uiO2Un0HKBBpdlADBcQGOAFgAUF0B9KWevt8aA4AIdF2gxQAcADRswXEBjgSUBFBdwiw4yIBCAgIBdHRlAiwXO9Nimu/80cADDBe5B6DnAPQh19c/HlBEg6yfXFFjccdVO7z500aze1o/qKWA/ev3ElAH9vllXz+4ZMOybu+olkoKB+uIBt7IZKcAYANj72jIFsPe1T8CESWIA2NvSJ6CjJOGA4f6TipJUXUQGDFSA+OC480ctuIB7TIBMUmsb/iffGbBJsqf+i48iNkm2yhdyksxx0N/ISdJHs2lykuRx4kzvgzDgAHHUuP1DTFJ7fOgbQP0DBnNMKyM1Se44JnKS9tIFF4yk7+OIezVikiywkpO0F3mvRkySA8hJ2ovagiCMBEBvzCDsXYoTBLO/LyMIW3jngAiwktQe1ehJsmMzPUl2dqAnyU5w9CSJoxo9SXaxR0+SWzGTk6Q2ZhD0FgWBCARBQANmi4PQ04AzCAMWcNWo39BrXTVqkvy9K2qSOn/gxCR1vumISRIe0LQgSH/2iUk6AWKSlH9bYpK0bzlikk7ABQGZJHOefA5w3sRCRzGopClRDG/jqg8Bzr7kk4TrDGdf8knCASIAXJJQwNkV0jshBAD7gGQvKqxjCN1Rhe2mCYAOAUUAgr7kG2QgA4IARB0wjCUOsENAiweSZyp4IDloE3HvAiTtrqlAb1+q8JxUFRkD+D97jvqSOyDMmBb1JdemGEBzARPXaGPvPYCoL9GBKXldXz97PokFsgEgzhUBMEggG8OIwFlBJ+CzIrlA0pcuAFTSqM9K0peoQND7VBKsZ8WkgEQCSV+6AEA9NYae9dOAMQWqx7R8NkYOivl6gAb0KVA9pmV9CTsoZl2BDyAHxawv0YCozbNWeViyvoQdFLOucBkw1NWHvjejCcBIBqCVrco3lQu0tr4IqBzT8r6EHBQlkFsUAPQl3KAI9KV3BoC+hBsUDfBuKADoS6hRFfwOGmZQBK/RMAB8lQhko1Tg69T3BKC+hBoUob6EAqC+hBpVoa6AGhTZANSXUIMi1JdQANSXMEDh+5zlQbENT7BeQkAFvcIB7q813d95JIBZwr6UA3MjZxiwh2Pm8EZgCIgE6IqAYAG3Dxn0pRBwg6JYQMDl7rZzJdAWAVurIQH3/9b7qLWmgBsUuxUElhPQdUBTBMzmNxzWET+br6dAH/alEGgeA/7k9sBN9RjwkXkMTBlwHNlt98dA1BkBoC8AvotFExsM9Me+ugCEN9UjQL8tMB4b5er/qq4MDMe+qgCIEqBwQIMEhgRYc0AmgIQA9RTYv6FTASxFoIOB/jkgEkBAgF794FkGphpgygE7ihaABgTMFhxOCnQQYFwSxwJwG1TDZwY5sJWB9hGwpsCQA83xowfah0BfAO4T1yNgcwMKBBgLLACwpEADAHpvGxXsDAH9OVyngNrb5iHQPgTk/tF08HlPYA4Ac4IxIOx3Os4Wh4BjbpwhoLXfKnkAdJudnUHg9nLatwHAGe9jfTCBwP4fOZyx1QVA+iRnT6x/O/YuA+L+U+eTDD3y7rYtmBg8MAZA8B6PAQUCc9jOR/1o4S5gYPC/Xe6/mMqAPAGZA3LfWfjLCgDQ0d4AANyBiwADA+dBAfcAI2CLPnAKqC2+sMuBcCItAMNDQBSA5gTGh4AKgC4H9BnKArBHa3oIzI+AY8TNgTUA0iaPNqkQaGFgKwPdn9sTwARnGQLs6zkDlhAYa4GmAMxFIP12Vg4cv38KLBkwRxV8ElyFtQCYApBVqAZKFUqvT2CiAboEpI3mB5m3A8ZjQ1cJnL3/8wDDsUHUAv3xUpaAuQSYNwP8hkrAv+HnAZoYmEqAjoEuBVQC+P9uKwXGq4GVCLQpoGuB6WpgSX4/loD0M6aAqQXmq4GZCpirAbf/8AxYEmCqBWQC6IuBthpYE2CkAupiwO/f29+LFEg3OGB4BpRE+WmA/tn+pQ3irYCmBKQf0gHuE9UDrtU+C5BOCxXAeLxuYWAtAu0bAQsZaGJA1wPTtcBMB36PAGN/66/yfDAGt8VtmK8FJjrwLQK2emC5FhjpwFcQmMtA2kwR0CKANQIGOvDzpUCHALYI6BNgKgM6AX68FBAYoA+Bhg78cCkgM0C5LeNDIHu/sQz4LUPzKq/yKq9yefkXR6tlrDrSxQ4AAAAASUVORK5CYII=";function ze(){return["","2","1","0","Critical"]}let Je=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"];function Go(n){let e,r;const t=n[4].default,o=De(t,n,n[6],null);return{c(){e=h("span"),o&&o.c(),P(e,"class","dot svelte-117v9mi"),Ae(e,"outline",n[3]),x(e,"background-color",n[3]?void 0:n[1]),x(e,"border-color",n[3]?n[1]:void 0),x(e,"width",n[2]),x(e,"height",n[2])},m(i,l){$(i,e,l),o&&o.m(e,null),r=!0},p(i,l){o&&o.p&&(!r||l&64)&&Ne(o,t,i,i[6],r?Oe(t,i[6],l,null):Ie(i[6]),null),(!r||l&8)&&Ae(e,"outline",i[3]),l&10&&x(e,"background-color",i[3]?void 0:i[1]),l&10&&x(e,"border-color",i[3]?i[1]:void 0),l&4&&x(e,"width",i[2]),l&4&&x(e,"height",i[2])},i(i){r||(_(o,i),r=!0)},o(i){w(o,i),r=!1},d(i){i&&k(e),o&&o.d(i)}}}function Jo(n){let e,r,t;function o(l){n[5](l)}let i={draggable:!0,$$slots:{default:[Go]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.lngLat=n[0]),e=new Ve({props:i}),me.push(()=>ke(e,"lngLat",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,[s]){const a={};s&78&&(a.$$scope={dirty:s,ctx:l}),!r&&s&1&&(r=!0,a.lngLat=l[0],we(()=>r=!1)),e.$set(a)},i(l){t||(_(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Qo(n,e,r){let{$$slots:t={},$$scope:o}=e,{lngLat:i}=e,{color:l}=e,{radius:s="30px"}=e,{outline:a=!1}=e;function u(c){i=c,r(0,i)}return n.$$set=c=>{"lngLat"in c&&r(0,i=c.lngLat),"color"in c&&r(1,l=c.color),"radius"in c&&r(2,s=c.radius),"outline"in c&&r(3,a=c.outline),"$$scope"in c&&r(6,o=c.$$scope)},[i,l,s,a,t,u,o]}class Vt extends ae{constructor(e){super(),ce(this,e,Qo,Jo,le,{lngLat:0,color:1,radius:2,outline:3})}}function an(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function cn(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function Ho(n){let e,r,t,o,i,l;const s=n[5].default,a=De(s,n,n[4],null);let u=ee(n[2]),c=[];for(let f=0;f<u.length;f+=1)c[f]=un(an(n,u,f));return{c(){e=h("label"),a&&a.c(),r=z(),t=h("select");for(let f=0;f<c.length;f+=1)c[f].c();n[0]===void 0&&_o(()=>n[10].call(t))},m(f,d){$(f,e,d),a&&a.m(e,null),g(e,r),g(e,t);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(t,null);tn(t,n[0],!0),o=!0,i||(l=[G(t,"change",n[10]),G(t,"change",n[7])],i=!0)},p(f,d){if(a&&a.p&&(!o||d&16)&&Ne(a,s,f,f[4],o?Oe(s,f[4],d,null):Ie(f[4]),null),d&4){u=ee(f[2]);let m;for(m=0;m<u.length;m+=1){const p=an(f,u,m);c[m]?c[m].p(p,d):(c[m]=un(p),c[m].c(),c[m].m(t,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=u.length}d&5&&tn(t,f[0])},i(f){o||(_(a,f),o=!0)},o(f){w(a,f),o=!1},d(f){f&&k(e),a&&a.d(f),be(c,f),i=!1,je(l)}}}function Ko(n){let e,r,t,o;const i=n[5].default,l=De(i,n,n[4],null);let s=ee(n[2]),a=[];for(let u=0;u<s.length;u+=1)a[u]=fn(cn(n,s,u));return{c(){e=h("fieldset"),l&&l.c(),r=z(),t=h("div");for(let u=0;u<a.length;u+=1)a[u].c();P(t,"class","svelte-1vb210n"),Ae(t,"horiz_radio",n[1]=="horiz-radio")},m(u,c){$(u,e,c),l&&l.m(e,null),g(e,r),g(e,t);for(let f=0;f<a.length;f+=1)a[f]&&a[f].m(t,null);o=!0},p(u,c){if(l&&l.p&&(!o||c&16)&&Ne(l,i,u,u[4],o?Oe(i,u[4],c,null):Ie(u[4]),null),c&5){s=ee(u[2]);let f;for(f=0;f<s.length;f+=1){const d=cn(u,s,f);a[f]?a[f].p(d,c):(a[f]=fn(d),a[f].c(),a[f].m(t,null))}for(;f<a.length;f+=1)a[f].d(1);a.length=s.length}(!o||c&2)&&Ae(t,"horiz_radio",u[1]=="horiz-radio")},i(u){o||(_(l,u),o=!0)},o(u){w(l,u),o=!1},d(u){u&&k(e),l&&l.d(u),be(a,u)}}}function un(n){let e,r=n[12]+"",t;return{c(){e=h("option"),t=F(r),e.__value=n[11],ve(e,e.__value)},m(o,i){$(o,e,i),g(e,t)},p:Y,d(o){o&&k(e)}}}function fn(n){let e,r,t,o=n[12]+"",i,l,s,a,u;return s=Ht(n[9][0]),{c(){e=h("label"),r=h("input"),t=z(),i=F(o),l=z(),P(r,"type","radio"),r.__value=n[11],ve(r,r.__value),s.p(r)},m(c,f){$(c,e,f),g(e,r),r.checked=r.__value===n[0],g(e,t),g(e,i),g(e,l),a||(u=[G(r,"change",n[8]),G(r,"change",n[6])],a=!0)},p(c,f){f&5&&(r.checked=r.__value===c[0])},d(c){c&&k(e),s.r(),a=!1,je(u)}}}function Wo(n){let e,r,t,o;const i=[Ko,Ho],l=[];function s(a,u){return a[1]=="horiz-radio"||a[1]=="vert-radio"?0:a[1]=="dropdown"?1:-1}return~(e=s(n))&&(r=l[e]=i[e](n)),{c(){r&&r.c(),t=Qe()},m(a,u){~e&&l[e].m(a,u),$(a,t,u),o=!0},p(a,[u]){let c=e;e=s(a),e===c?~e&&l[e].p(a,u):(r&&(fe(),w(l[c],1,1,()=>{l[c]=null}),de()),~e?(r=l[e],r?r.p(a,u):(r=l[e]=i[e](a),r.c()),_(r,1),r.m(t.parentNode,t)):r=null)},i(a){o||(_(r),o=!0)},o(a){w(r),o=!1},d(a){a&&k(t),~e&&l[e].d(a)}}}function Zo(n,e,r){let{$$slots:t={},$$scope:o}=e,{k:i}=e,{value:l}=e,{choices:s}=e,a=s[0].length==2?s:s.map(p=>[p,p]);const u=[[]];function c(p){Se.call(this,n,p)}function f(p){Se.call(this,n,p)}function d(){l=this.__value,r(0,l),r(2,a)}function m(){l=go(this),r(0,l),r(2,a)}return n.$$set=p=>{"k"in p&&r(1,i=p.k),"value"in p&&r(0,l=p.value),"choices"in p&&r(3,s=p.choices),"$$scope"in p&&r(4,o=p.$$scope)},[l,i,a,s,o,t,c,f,d,u,m]}class We extends ae{constructor(e){super(),ce(this,e,Zo,Wo,le,{k:1,value:0,choices:3})}}let Dt=Ge(void 0),Q=Ge(Xo());function pe(n){return{type:"FeatureCollection",features:n}}let X=Ge({kind:"neutral"});function Hr(n){return"links"in n&&"jats"in n&&"bus_stops"&&"crossings"in n&&"side_roads"in n}function Xo(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if(Hr(n))return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[],side_roads:[]}}function dn(n){let e,r;return e=new Ce({props:{data:pe(n[2].links),$$slots:{default:[Vo]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&4&&(i.data=pe(t[2].links)),o&10&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Vo(n){let e,r;return e=new Fe({props:{paint:{"line-color":n[1]?["get","color"]:"black","line-width":6}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&2&&(i.paint={"line-color":t[1]?["get","color"]:"black","line-width":6}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function pn(n){let e,r;return e=new Ce({props:{data:pe(n[2].bus_stops),$$slots:{default:[Yo]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&4&&(i.data=pe(t[2].bus_stops)),o&8&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Yo(n){let e,r;return e=new nt({props:{layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function mn(n){let e,r;return e=new Ce({props:{data:pe(n[2].crossings),$$slots:{default:[xo]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&4&&(i.data=pe(t[2].crossings)),o&8&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function xo(n){let e,r;return e=new nt({props:{layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function gn(n){let e,r;return e=new Ce({props:{data:pe(n[2].jats),$$slots:{default:[ei]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&4&&(i.data=pe(t[2].jats)),o&8&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ei(n){let e,r;return e=new tt({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function _n(n){let e,r;return e=new Ce({props:{data:pe(n[2].side_roads),$$slots:{default:[ti]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&4&&(i.data=pe(t[2].side_roads)),o&8&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ti(n){let e,r;return e=new Fe({props:{paint:{"line-color":"black","line-width":3}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ni(n){let e,r,t,o,i,l,s=n[0]!="links"&&dn(n),a=n[0]!="bus_stops"&&pn(n),u=n[0]!="crossings"&&mn(n),c=n[0]!="jats"&&gn(n),f=n[0]!="side_roads"&&_n(n);return{c(){s&&s.c(),e=z(),a&&a.c(),r=z(),u&&u.c(),t=z(),c&&c.c(),o=z(),f&&f.c(),i=Qe()},m(d,m){s&&s.m(d,m),$(d,e,m),a&&a.m(d,m),$(d,r,m),u&&u.m(d,m),$(d,t,m),c&&c.m(d,m),$(d,o,m),f&&f.m(d,m),$(d,i,m),l=!0},p(d,[m]){d[0]!="links"?s?(s.p(d,m),m&1&&_(s,1)):(s=dn(d),s.c(),_(s,1),s.m(e.parentNode,e)):s&&(fe(),w(s,1,1,()=>{s=null}),de()),d[0]!="bus_stops"?a?(a.p(d,m),m&1&&_(a,1)):(a=pn(d),a.c(),_(a,1),a.m(r.parentNode,r)):a&&(fe(),w(a,1,1,()=>{a=null}),de()),d[0]!="crossings"?u?(u.p(d,m),m&1&&_(u,1)):(u=mn(d),u.c(),_(u,1),u.m(t.parentNode,t)):u&&(fe(),w(u,1,1,()=>{u=null}),de()),d[0]!="jats"?c?(c.p(d,m),m&1&&_(c,1)):(c=gn(d),c.c(),_(c,1),c.m(o.parentNode,o)):c&&(fe(),w(c,1,1,()=>{c=null}),de()),d[0]!="side_roads"?f?(f.p(d,m),m&1&&_(f,1)):(f=_n(d),f.c(),_(f,1),f.m(i.parentNode,i)):f&&(fe(),w(f,1,1,()=>{f=null}),de())},i(d){l||(_(s),_(a),_(u),_(c),_(f),l=!0)},o(d){w(s),w(a),w(u),w(c),w(f),l=!1},d(d){d&&(k(e),k(r),k(t),k(o),k(i)),s&&s.d(d),a&&a.d(d),u&&u.d(d),c&&c.d(d),f&&f.d(d)}}}function ri(n,e,r){let t;oe(n,Q,l=>r(2,t=l));let{except:o}=e,{showLinkColor:i=!1}=e;return n.$$set=l=>{"except"in l&&r(0,o=l.except),"showLinkColor"in l&&r(1,i=l.showLinkColor)},[o,i,t]}class Ye extends ae{constructor(e){super(),ce(this,e,ri,ni,le,{except:0,showLinkColor:1})}}const{window:oi}=ct;function ii(n){let e;return{c(){e=F("ST20: bus stops")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function li(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p;function j(v){n[8](v)}let L={k:"horiz-radio",choices:ze(),$$slots:{default:[ii]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].properties.st20!==void 0&&(L.value=n[1].bus_stops[n[0]].properties.st20),c=new We({props:L}),me.push(()=>ke(c,"value",j)),{c(){e=h("div"),r=h("button"),r.textContent="Done",t=z(),o=h("button"),o.textContent="Delete bus stop",i=z(),l=h("label"),s=F(`Name:
      `),a=h("input"),u=z(),M(c.$$.fragment),P(a,"type","text"),P(e,"slot","sidebar")},m(v,A){$(v,e,A),g(e,r),g(e,t),g(e,o),g(e,i),g(e,l),g(l,s),g(l,a),ve(a,n[1].bus_stops[n[0]].properties.name),g(e,u),B(c,e,null),d=!0,m||(p=[G(r,"click",n[6]),G(o,"click",n[4]),G(a,"input",n[7])],m=!0)},p(v,A){A&3&&a.value!==v[1].bus_stops[v[0]].properties.name&&ve(a,v[1].bus_stops[v[0]].properties.name);const O={};A&512&&(O.$$scope={dirty:A,ctx:v}),!f&&A&3&&(f=!0,O.value=v[1].bus_stops[v[0]].properties.st20,we(()=>f=!1)),c.$set(O)},i(v){d||(_(c.$$.fragment,v),d=!0)},o(v){w(c.$$.fragment,v),d=!1},d(v){v&&k(e),E(c),m=!1,je(p)}}}function si(n){let e,r;return e=new nt({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.filter=["!=",["id"],t[0]]),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ai(n){let e,r;return{c(){e=h("img"),bt(e.src,r=Jr)||P(e,"src",r)},m(t,o){$(t,e,o)},p:Y,d(t){t&&k(e)}}}function ci(n){let e,r,t,o,i,l,s,a;r=new Ye({props:{except:"bus_stops"}}),o=new Ce({props:{data:pe(n[1].bus_stops),generateId:!0,$$slots:{default:[si]},$$scope:{ctx:n}}});function u(f){n[5](f)}let c={color:n[1].bus_stops[n[0]].properties.color,$$slots:{default:[ai]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),l=new Vt({props:c}),me.push(()=>ke(l,"lngLat",u)),{c(){e=h("div"),M(r.$$.fragment),t=z(),M(o.$$.fragment),i=z(),M(l.$$.fragment),P(e,"slot","map")},m(f,d){$(f,e,d),B(r,e,null),g(e,t),B(o,e,null),g(e,i),B(l,e,null),a=!0},p(f,d){const m={};d&2&&(m.data=pe(f[1].bus_stops)),d&513&&(m.$$scope={dirty:d,ctx:f}),o.$set(m);const p={};d&3&&(p.color=f[1].bus_stops[f[0]].properties.color),d&512&&(p.$$scope={dirty:d,ctx:f}),!s&&d&3&&(s=!0,p.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,we(()=>s=!1)),l.$set(p)},i(f){a||(_(r.$$.fragment,f),_(o.$$.fragment,f),_(l.$$.fragment,f),a=!0)},o(f){w(r.$$.fragment,f),w(o.$$.fragment,f),w(l.$$.fragment,f),a=!1},d(f){f&&k(e),E(r),E(o),E(l)}}}function ui(n){let e,r,t,o;return e=new He({props:{$$slots:{map:[ci],sidebar:[li]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=G(oi,"keydown",n[3]),t=!0)},p(i,[l]){const s={};l&519&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function fi(n,e,r){let t,o;oe(n,Q,d=>r(1,t=d)),oe(n,X,d=>r(2,o=d));let{idx:i}=e;function l(d){d.key=="Escape"&&W(X,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this bus stop?")&&(W(X,o={kind:"neutral"},o),await et(),t.bus_stops.splice(i,1),Q.set(t))}function a(d){n.$$.not_equal(t.bus_stops[i].geometry.coordinates,d)&&(t.bus_stops[i].geometry.coordinates=d,Q.set(t))}const u=()=>W(X,o={kind:"neutral"},o);function c(){t.bus_stops[i].properties.name=this.value,Q.set(t)}function f(d){n.$$.not_equal(t.bus_stops[i].properties.st20,d)&&(t.bus_stops[i].properties.st20=d,Q.set(t))}return n.$$set=d=>{"idx"in d&&r(0,i=d.idx)},[i,t,o,l,s,a,u,c,f]}class di extends ae{constructor(e){super(),ce(this,e,fi,ui,le,{idx:0})}}function hn(n,e,r){const t=n.slice();return t[1]=e[r][0],t[2]=e[r][1],t}function bn(n){let e,r,t,o=n[1]+"",i,l;return{c(){e=h("li"),r=h("span"),t=z(),i=F(o),l=z(),P(r,"class","svelte-kzgqtg"),x(r,"background",n[2])},m(s,a){$(s,e,a),g(e,r),g(e,t),g(e,i),g(e,l)},p(s,a){a&1&&x(r,"background",s[2]),a&1&&o!==(o=s[1]+"")&&ie(i,o)},d(s){s&&k(e)}}}function pi(n){let e,r=ee(n[0]),t=[];for(let o=0;o<r.length;o+=1)t[o]=bn(hn(n,r,o));return{c(){e=h("ul");for(let o=0;o<t.length;o+=1)t[o].c()},m(o,i){$(o,e,i);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(o,[i]){if(i&1){r=ee(o[0]);let l;for(l=0;l<r.length;l+=1){const s=hn(o,r,l);t[l]?t[l].p(s,i):(t[l]=bn(s),t[l].c(),t[l].m(e,null))}for(;l<t.length;l+=1)t[l].d(1);t.length=r.length}},i:Y,o:Y,d(o){o&&k(e),be(t,o)}}}function mi(n,e,r){let{rows:t}=e;return n.$$set=o=>{"rows"in o&&r(0,t=o.rows)},[t]}class gi extends ae{constructor(e){super(),ce(this,e,mi,pi,le,{rows:0})}}const _i=n=>({dialog:n&1}),$n=n=>({dialog:n[0]});function hi(n){let e,r,t,o,i;const l=n[4].default,s=De(l,n,n[3],$n);return{c(){e=h("dialog"),r=h("article"),s&&s.c(),e.open=!0},m(a,u){$(a,e,u),g(e,r),s&&s.m(r,null),n[6](e),t=!0,o||(i=[G(window,"click",n[1]),G(window,"keydown",n[2]),G(e,"close",n[5])],o=!0)},p(a,[u]){s&&s.p&&(!t||u&9)&&Ne(s,l,a,a[3],t?Oe(l,a[3],u,_i):Ie(a[3]),$n)},i(a){t||(_(s,a),t=!0)},o(a){w(s,a),t=!1},d(a){a&&k(e),s&&s.d(a),n[6](null),o=!1,je(i)}}}function bi(n,e,r){let{$$slots:t={},$$scope:o}=e,i;function l(c){i.open&&c.target==i&&i.close()}function s(c){(c.key=="Escape"||c.key=="Enter")&&(c.stopPropagation(),i.close())}function a(c){Se.call(this,n,c)}function u(c){me[c?"unshift":"push"](()=>{i=c,r(0,i)})}return n.$$set=c=>{"$$scope"in c&&r(3,o=c.$$scope)},[i,l,s,o,t,a,u]}class Ut extends ae{constructor(e){super(),ce(this,e,bi,hi,le,{})}}function kn(n,e,r){const t=n.slice();return t[3]=e[r],t}function wn(n,e,r){const t=n.slice();return t[6]=e[r],t}function vn(n){let e,r;return{c(){e=h("span"),r=F(` 
    `),x(e,"background",n[6]),x(e,"width","100%"),x(e,"border","1px solid black")},m(t,o){$(t,e,o),g(e,r)},p(t,o){o&1&&x(e,"background",t[6])},d(t){t&&k(e)}}}function $i(n){let e,r=n[3]+"",t;return{c(){e=h("span"),t=F(r)},m(o,i){$(o,e,i),g(e,t)},p(o,i){i&2&&r!==(r=o[3]+"")&&ie(t,r)},d(o){o&&k(e)}}}function ki(n){let e,r=n[3].toFixed(n[2])+"",t;return{c(){e=h("span"),t=F(r)},m(o,i){$(o,e,i),g(e,t)},p(o,i){i&6&&r!==(r=o[3].toFixed(o[2])+"")&&ie(t,r)},d(o){o&&k(e)}}}function yn(n){let e;function r(i,l){return i[2]>0?ki:$i}let t=r(n),o=t(n);return{c(){o.c(),e=Qe()},m(i,l){o.m(i,l),$(i,e,l)},p(i,l){t===(t=r(i))&&o?o.p(i,l):(o.d(1),o=t(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){i&&k(e),o.d(i)}}}function wi(n){let e,r,t,o=ee(n[0]),i=[];for(let a=0;a<o.length;a+=1)i[a]=vn(wn(n,o,a));let l=ee(n[1]),s=[];for(let a=0;a<l.length;a+=1)s[a]=yn(kn(n,l,a));return{c(){e=h("div");for(let a=0;a<i.length;a+=1)i[a].c();r=z(),t=h("div");for(let a=0;a<s.length;a+=1)s[a].c();x(e,"display","flex"),x(t,"display","flex"),x(t,"justify-content","space-between")},m(a,u){$(a,e,u);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);$(a,r,u),$(a,t,u);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(t,null)},p(a,[u]){if(u&1){o=ee(a[0]);let c;for(c=0;c<o.length;c+=1){const f=wn(a,o,c);i[c]?i[c].p(f,u):(i[c]=vn(f),i[c].c(),i[c].m(e,null))}for(;c<i.length;c+=1)i[c].d(1);i.length=o.length}if(u&6){l=ee(a[1]);let c;for(c=0;c<l.length;c+=1){const f=kn(a,l,c);s[c]?s[c].p(f,u):(s[c]=yn(f),s[c].c(),s[c].m(t,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=l.length}},i:Y,o:Y,d(a){a&&(k(e),k(r),k(t)),be(i,a),be(s,a)}}}function vi(n,e,r){let{colorScale:t}=e,{limits:o}=e,{decimalPlaces:i=0}=e;return n.$$set=l=>{"colorScale"in l&&r(0,t=l.colorScale),"limits"in l&&r(1,o=l.limits),"decimalPlaces"in l&&r(2,i=l.decimalPlaces)},[t,o,i]}class yi extends ae{constructor(e){super(),ce(this,e,vi,wi,le,{colorScale:0,limits:1,decimalPlaces:2})}}function Ai(n,e){let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function Ci(n){let e;return{c(){e=F("Bus stops")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function An(n){let e,r,t,o,i;return o=new yi({props:{colorScale:n[1],limits:n[2]}}),{c(){e=h("div"),r=h("p"),r.textContent="Peak hourly frequency:",t=z(),M(o.$$.fragment),P(e,"class","svelte-yxmabo")},m(l,s){$(l,e,s),g(e,r),g(e,t),B(o,e,null),i=!0},p:Y,i(l){i||(_(o.$$.fragment,l),i=!0)},o(l){w(o.$$.fragment,l),i=!1},d(l){l&&k(e),E(o)}}}function ji(n){let e,r,t,o=n[4].stop_name+"",i,l,s,a,u,c=n[4].peak+"",f,d,m,p,j,L=n[4].peak_description+"",v,A,O,b,C,y=n[4].total+"",S,D,I=n[4].total_description+"",K,V;return{c(){e=h("p"),r=F("Stop name: "),t=h("b"),i=F(o),l=z(),s=h("p"),a=F("Peak: "),u=h("b"),f=F(c),d=F(`
        buses during the busiest hour of any day`),m=z(),p=h("p"),j=F("The peak hour is "),v=F(L),A=z(),O=h("p"),b=F("Total buses per day: "),C=h("b"),S=F(y),D=F(`
        (for `),K=F(I),V=F(", the busiest day of the week)")},m(T,J){$(T,e,J),g(e,r),g(e,t),g(t,i),$(T,l,J),$(T,s,J),g(s,a),g(s,u),g(u,f),g(s,d),$(T,m,J),$(T,p,J),g(p,j),g(p,v),$(T,A,J),$(T,O,J),g(O,b),g(O,C),g(C,S),g(O,D),g(O,K),g(O,V)},p(T,J){J&16&&o!==(o=T[4].stop_name+"")&&ie(i,o),J&16&&c!==(c=T[4].peak+"")&&ie(f,c),J&16&&L!==(L=T[4].peak_description+"")&&ie(v,L),J&16&&y!==(y=T[4].total+"")&&ie(S,y),J&16&&I!==(I=T[4].total_description+"")&&ie(K,I)},d(T){T&&(k(e),k(l),k(s),k(m),k(p),k(A),k(O))}}}function Si(n){let e,r;return e=new wt({props:{$$slots:{default:[ji,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&48&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function zi(n){let e,r;return e=new tt({props:{sourceLayer:"bus_stops",paint:{"circle-color":ho(["get","peak"],n[2],n[1]),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},manageHoverState:!0,$$slots:{default:[Si]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.layout={visibility:t[0]?"visible":"none"}),o&32&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Li(n){let e,r,t,o,i;e=new Rr({props:{$$slots:{default:[Ci]},$$scope:{ctx:n}}}),e.$on("click",n[3]);let l=n[0]&&An(n);return o=new Gr({props:{url:"pmtiles://http://atip.uk/layers/v1/bus_stops.pmtiles",$$slots:{default:[zi]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=z(),l&&l.c(),t=z(),M(o.$$.fragment)},m(s,a){B(e,s,a),$(s,r,a),l&&l.m(s,a),$(s,t,a),B(o,s,a),i=!0},p(s,[a]){const u={};a&32&&(u.$$scope={dirty:a,ctx:s}),e.$set(u),s[0]?l?(l.p(s,a),a&1&&_(l,1)):(l=An(s),l.c(),_(l,1),l.m(t.parentNode,t)):l&&(fe(),w(l,1,1,()=>{l=null}),de());const c={};a&33&&(c.$$scope={dirty:a,ctx:s}),o.$set(c)},i(s){i||(_(e.$$.fragment,s),_(l),_(o.$$.fragment,s),i=!0)},o(s){w(e.$$.fragment,s),w(l),w(o.$$.fragment,s),i=!1},d(s){s&&(k(r),k(t)),E(e,s),l&&l.d(s),E(o,s)}}}function Mi(n,e,r){let t=!1;return[t,["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],[0,3,10,20,30,100],()=>r(0,t=!t)]}class Bi extends ae{constructor(e){super(),ce(this,e,Mi,Li,le,{})}}function Ei(n){let e;return{c(){e=F("Crossings")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function Cn(n){let e,r,t;return r=new gi({props:{rows:n[1]}}),{c(){e=h("div"),M(r.$$.fragment),P(e,"class","svelte-yxmabo")},m(o,i){$(o,e,i),B(r,e,null),t=!0},p:Y,i(o){t||(_(r.$$.fragment,o),t=!0)},o(o){w(r.$$.fragment,o),t=!1},d(o){o&&k(e),E(r)}}}function Ti(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=h("p"),t=F(r),o=F(" crossing")},m(i,l){$(i,e,l),g(e,t),g(e,o)},p(i,l){l&8&&r!==(r=(i[3].class||"Unknown")+"")&&ie(t,r)},d(i){i&&k(e)}}}function Di(n){let e,r;return e=new wt({props:{$$slots:{default:[Ti,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&24&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ni(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=h("p"),t=F(r),o=F(" crossing")},m(i,l){$(i,e,l),g(e,t),g(e,o)},p(i,l){l&8&&r!==(r=(i[3].class||"Unknown")+"")&&ie(t,r)},d(i){i&&k(e)}}}function Ii(n){let e,r;return e=new wt({props:{$$slots:{default:[Ni,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&24&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Oi(n){let e,r,t,o;return e=new Fe({props:{sourceLayer:"crossings",filter:bo,paint:{"line-color":nn(["get","class"],Object.fromEntries(n[1]),"red"),"line-width":3},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[Di]},$$scope:{ctx:n}}}),e.$on("click",jn),t=new tt({props:{sourceLayer:"crossings",filter:$o,paint:{"circle-color":nn(["get","class"],Object.fromEntries(n[1]),"red"),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[Ii]},$$scope:{ctx:n}}}),t.$on("click",jn),{c(){M(e.$$.fragment),r=z(),M(t.$$.fragment)},m(i,l){B(e,i,l),$(i,r,l),B(t,i,l),o=!0},p(i,l){const s={};l&1&&(s.layout={visibility:i[0]?"visible":"none"}),l&16&&(s.$$scope={dirty:l,ctx:i}),e.$set(s);const a={};l&1&&(a.layout={visibility:i[0]?"visible":"none"}),l&16&&(a.$$scope={dirty:l,ctx:i}),t.$set(a)},i(i){o||(_(e.$$.fragment,i),_(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&k(r),E(e,i),E(t,i)}}}function Fi(n){let e,r,t,o,i;e=new Rr({props:{$$slots:{default:[Ei]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let l=n[0]&&Cn(n);return o=new Gr({props:{url:"pmtiles://http://atip.uk/layers/v1/crossings.pmtiles",$$slots:{default:[Oi]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=z(),l&&l.c(),t=z(),M(o.$$.fragment)},m(s,a){B(e,s,a),$(s,r,a),l&&l.m(s,a),$(s,t,a),B(o,s,a),i=!0},p(s,[a]){const u={};a&16&&(u.$$scope={dirty:a,ctx:s}),e.$set(u),s[0]?l?(l.p(s,a),a&1&&_(l,1)):(l=Cn(s),l.c(),_(l,1),l.m(t.parentNode,t)):l&&(fe(),w(l,1,1,()=>{l=null}),de());const c={};a&17&&(c.$$scope={dirty:a,ctx:s}),o.$set(c)},i(s){i||(_(e.$$.fragment,s),_(l),_(o.$$.fragment,s),i=!0)},o(s){w(e.$$.fragment,s),w(l),w(o.$$.fragment,s),i=!1},d(s){s&&(k(r),k(t)),E(e,s),l&&l.d(s),E(o,s)}}}function jn(n){window.open(`https://www.openstreetmap.org/${n.detail.features[0].properties.osm}`,"_blank")}function Ui(n,e,r){let t=!1;return[t,[["Zebra","#66C5CC"],["Parallel","#F6CF71"],["Pelican","#F89C74"],["Puffin","#DCB0F2"],["Toucan","#87C55F"],["Pegasus","#9EB9F3"],["Uncontrolled","#FE88B1"],["Signalised","#C9DB74"],["Unknown","red"]],()=>r(0,t=!t)]}class Pi extends ae{constructor(e){super(),ce(this,e,Ui,Fi,le,{})}}function qi(n){let e,r,t,o,i;return r=new Bi({}),o=new Pi({}),{c(){e=h("div"),M(r.$$.fragment),t=z(),M(o.$$.fragment),x(e,"display","flex"),x(e,"flex-direction","column")},m(l,s){$(l,e,s),B(r,e,null),g(e,t),B(o,e,null),i=!0},p:Y,i(l){i||(_(r.$$.fragment,l),_(o.$$.fragment,l),i=!0)},o(l){w(r.$$.fragment,l),w(o.$$.fragment,l),i=!1},d(l){l&&k(e),E(r),E(o)}}}function Ri(n){let e,r;return e=new Mo({props:{$$slots:{default:[qi]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,[o]){const i={};o&1&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}class Gi extends ae{constructor(e){super(),ce(this,e,null,Ri,le,{})}}let at={SA01:{description:"Pedestrian and cyclist conflict with motor traffic at side roads/priority junctions",green:"Side roads/priority junctions have entry treatments that offer greater protection for  pedestrian and cycle movements (e.g. exit only, continuous footways, zebra/parallel crossings as appropriate to context).",amber:"<2,500vpd cut across main walking, wheeling or cycling streams and side roads and priority junctions have entry treatments. ",red:"<2,500vpd cut across main walking, wheeling or cycling streams, but side roads and priority junctions are untreated.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA02:{description:"Pedestrian and cyclist conflict with motor traffic at roundabouts and signal-controlled junctions",green:"All pedestrian and cyclist movements are separated from all motor traffic movements at roundabouts and/or signal controlled junctions.",amber:"The principal pedestrian and cyclist movements are separated from motor traffic movements at roundabouts and/or signal controlled junctions.",red:"The principal pedestrian and/or cyclist movements are in conflict with motor traffic movements at roundabouts and/or signal controlled junctions.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA03:{description:"Effect of lane widths on conflict between cyclists and motor traffic",green:"Cyclists are protected from motor traffic or off-road entirely.",amber:`Cyclists are in cycle lanes with light protection or stepped cycle tracks under 1.8m wide (single direction).

Or, cyclists are in a protected bidirectional cycle facility under 2.5m wide.

Or, cyclists are mixed with traffic on quiet urban streets with no centre line.`,red:`Cyclists are mixed with traffic in lanes less than 3.25m wide or over 3.9m wide.

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is under 3.25m or over 3.9m. 

Or cyclists are mixed with traffic on busy urban streets with no centre line.

Or, there are speed cushions present.`,critical:`Cyclists are mixed with traffic in lanes between 3.25m and 3.9m wide. 

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is between 3.25m and 3.9m.`},SA04:{description:"Risk of pedestrians tripping due to hazards",green:"No trip hazards, level clear surface.",amber:"Few trip hazards.",red:"Many trip hazards.",critical:"There are level differences of greater than 13mm with no tactile information and colour contrast to help identify them."},SA05:{description:"Cyclist conflict with kerbside activity, including risk of 'dooring' ",green:"Kerbside activity is well-managed with no or minimal conflict with cyclists. ",amber:"Less frequent kerbside activity, and conflict with cyclists is well-managed.",red:"Frequent kerbside activity for cyclists to contend with. Conflict with cyclists is not well-managed.",critical:`Cycle facility next to parking/loading facility, without a buffer of at least 0.5m.

Or, an unprotected cycle lane is next to a frequently-used bus layby.`},SA06:{description:"Ability of pedestrians to cross the street safely on desire lines",green:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 50-100m. 

On quieter streets (<8,000vpd), there are controlled crossings or only one lane of traffic to cross.`,amber:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 100-200m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross on desire lines.`,red:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 200-400m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross.`,critical:`On very busy streets (>8,000vpd) controlled crossings (including zebra crossings) are not present or more than 400m apart.

On quieter streets (<8,000vpd), desire lines are blocked by parking and loading. `},SA07:{description:"Suitability of pedestrian crossings in context",green:`On very busy streets (>8,000vpd), signal crossings rest on green for pedestrians or have rapid response.

On quieter streets (<8,000vpd), crossing points are controlled crossings.`,amber:`On very busy streets (>8,000vpd), signal crossings are provided for pedestrians.

On quieter streets (<8,000vpd), crossing points have effective implied priority for pedestrians.`,red:`On very busy streets (>8,000vpd), there are uncontrolled crossings or zebra/parallel crossings.

On quieter streets (<8,000vpd), crossing points have no implied priority or there are no crossing points.`,critical:`On very busy streets (>8,000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic.

At signal junctions there are arms with dropped kerbs and tactile paving but no green pedestrian symbol.`},SA08:{description:"85th percentile speed of motor traffic (where cyclists are not protected or pedestrians are crossing uncontrolled)",green:`85th percentile speed is under 20mph.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:"85th percentile speed is between 20mph and 25mph.",red:"85th percentile speed is over 25mph.",critical:"85th percentile speed is over 30mph."},SA09:{description:"Volume of motor traffic at the busiest hour (where cyclists are not protected or pedestrians cross uncontrolled)",green:`<200 vehicles in the busiest hour.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:`200-499 vehicles in the busiest hour.

And, less than 2% of traffic is HGVs.`,red:`500-1,000 vehicles in the busiest hour.

Or, 2-5% of traffic is HGVs where there are 200-499 vehicles in the busiest hour.`,critical:`>1,000 vehicles in the busiest hour.

Or, over 5% of traffic is HGVs where there are over 500 vehicles in the busiest hour.`},SA10:{description:"Required crossing speed at signal crossings (risk of pedestrians coming into conflict with traffic).",green:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1m/s.",amber:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1.2m/s.",red:"There are no detectors to extend crossing times, but pedestrians who start crossing at the end of the 'invitation to cross' can cross at a speed of 1.2m/s and get across the whole crossing in time.",critical:"Pedestrians who start crossing at the end of the 'invitation to cross' must cross at a speed of over 1.2m/s to get across the whole crossing in time."},SA11:{description:"Clear walking and wheeling spaces free of permanent obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",green:">3m clear footway width and pedestrian comfort is good (PCL of A-C).",amber:`Where the footway is next to the carriageway, there is:
• 2m-3m clear footway width and pedestrian comfort is good (PCL of A-C).
• >3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is 1.5m-3m.`,red:`Where the footway is next to the carriageway, there is:
• <2m clear footway width but pedestrian comfort is good (PCL of A-C)
• 2m-3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is <1.5m.`,critical:`Where the footway is next to the carriageway, there is:
• <1m clear footway width on any footway
• <1.5m clear footway width for over 6m
• 1m-2m clear footway width with a Pedestrian Comfort Level of D-E

Or there is no footway.`},SA12:{description:"Effective width next to tram line on a straight run or a curve",green:"Physical protection is provided for cyclists.",amber:">2.4m from tramline edge to kerb.",red:"2.4m from tramline edge to kerb.",critical:`<2.4m from tramline edge to kerb on a straight run.

Insufficient clearance on a curve.`},SA13:{description:"Crossing angle (between cyclist desire line and tram or train rails).",green:"Crossing angle between 80 and 90 degrees with track filler creating a smooth crossing for cyclists.",amber:"Crossing angle between 80 and 90 degrees (or between 60 and 80 degrees with track filler creating a smooth crossing for cyclists).",red:"Crossing angle between 60 and 80 degrees.",critical:"Crossing angle less than 60 degrees."},SA14:{description:`Cycling surface and maintenance defects:
• sharp gradients (≥12.5%)
• non cycle friendly ironworks
• raised/sunken covers or gullies
• potholes
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA15:{description:`Walking/wheeling surface and maintenance defects:
• steep camber (horizontal gradient >2.5% )
• steep longitudinal gradients (≥8% if under 1m, ≥5% if 1m or over) 
• missing dropped kerbs
• non flush tables
• misleading tactile information
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation
`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA16:{description:"Presence of guard railing",green:"No guard railing anywhere on the route.",amber:"Minimal guard railing, used to address a clear safety issue such as a level difference.",red:"Guard railing used to control behaviour in complex environments.",critical:"Guard railing used as standard without consideration of inherent safety risks."}};function Ji(n){let e,r,t,o=n[0].green+"",i,l,s,a,u,c=n[0].amber+"",f,d,m,p,j,L=n[0].red+"",v,A,O,b,C,y=n[0].critical+"",S;return{c(){e=h("p"),r=h("b"),r.textContent="2",t=F(`
  : `),i=F(o),l=z(),s=h("p"),a=h("b"),a.textContent="1",u=F(`
  : `),f=F(c),d=z(),m=h("p"),p=h("b"),p.textContent="0",j=F(`
  : `),v=F(L),A=z(),O=h("p"),b=h("b"),b.textContent="Critical",C=F(`
  : `),S=F(y)},m(D,I){$(D,e,I),g(e,r),g(e,t),g(e,i),$(D,l,I),$(D,s,I),g(s,a),g(s,u),g(s,f),$(D,d,I),$(D,m,I),g(m,p),g(m,j),g(m,v),$(D,A,I),$(D,O,I),g(O,b),g(O,C),g(O,S)},p(D,[I]){I&1&&o!==(o=D[0].green+"")&&ie(i,o),I&1&&c!==(c=D[0].amber+"")&&ie(f,c),I&1&&L!==(L=D[0].red+"")&&ie(v,L),I&1&&y!==(y=D[0].critical+"")&&ie(S,y)},i:Y,o:Y,d(D){D&&(k(e),k(l),k(s),k(d),k(m),k(A),k(O))}}}function Qi(n,e,r){let{metric:t}=e;return n.$$set=o=>{"metric"in o&&r(0,t=o.metric)},[t]}class Pt extends ae{constructor(e){super(),ce(this,e,Qi,Ji,le,{metric:0})}}const{window:Hi}=ct;function Ki(n){let e;return{c(){e=F("SA10: pedestrian crossing speed")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function Wi(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p,j,L,v,A;function O(C){n[9](C)}let b={k:"horiz-radio",choices:ze(),$$slots:{default:[Ki]},$$scope:{ctx:n}};return n[1].crossings[n[0]].properties.sa10!==void 0&&(b.value=n[1].crossings[n[0]].properties.sa10),c=new We({props:b}),me.push(()=>ke(c,"value",O)),j=new Pt({props:{metric:n[3]}}),{c(){e=h("div"),r=h("button"),r.textContent="Done",t=z(),o=h("button"),o.textContent="Delete crossing",i=z(),l=h("label"),s=F(`Name:
      `),a=h("input"),u=z(),M(c.$$.fragment),d=z(),m=h("p"),m.textContent=`${n[3].description}`,p=z(),M(j.$$.fragment),P(a,"type","text"),P(e,"slot","sidebar")},m(C,y){$(C,e,y),g(e,r),g(e,t),g(e,o),g(e,i),g(e,l),g(l,s),g(l,a),ve(a,n[1].crossings[n[0]].properties.name),g(e,u),B(c,e,null),g(e,d),g(e,m),g(e,p),B(j,e,null),L=!0,v||(A=[G(r,"click",n[7]),G(o,"click",n[5]),G(a,"input",n[8])],v=!0)},p(C,y){y&3&&a.value!==C[1].crossings[C[0]].properties.name&&ve(a,C[1].crossings[C[0]].properties.name);const S={};y&1024&&(S.$$scope={dirty:y,ctx:C}),!f&&y&3&&(f=!0,S.value=C[1].crossings[C[0]].properties.sa10,we(()=>f=!1)),c.$set(S)},i(C){L||(_(c.$$.fragment,C),_(j.$$.fragment,C),L=!0)},o(C){w(c.$$.fragment,C),w(j.$$.fragment,C),L=!1},d(C){C&&k(e),E(c),E(j),v=!1,je(A)}}}function Zi(n){let e,r;return e=new nt({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.filter=["!=",["id"],t[0]]),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Xi(n){let e,r;return{c(){e=h("img"),bt(e.src,r=Qr)||P(e,"src",r)},m(t,o){$(t,e,o)},p:Y,d(t){t&&k(e)}}}function Vi(n){let e,r,t,o,i,l,s,a;r=new Ye({props:{except:"crossings"}}),o=new Ce({props:{data:pe(n[1].crossings),generateId:!0,$$slots:{default:[Zi]},$$scope:{ctx:n}}});function u(f){n[6](f)}let c={color:n[1].crossings[n[0]].properties.color,$$slots:{default:[Xi]},$$scope:{ctx:n}};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].crossings[n[0]].geometry.coordinates),l=new Vt({props:c}),me.push(()=>ke(l,"lngLat",u)),{c(){e=h("div"),M(r.$$.fragment),t=z(),M(o.$$.fragment),i=z(),M(l.$$.fragment),P(e,"slot","map")},m(f,d){$(f,e,d),B(r,e,null),g(e,t),B(o,e,null),g(e,i),B(l,e,null),a=!0},p(f,d){const m={};d&2&&(m.data=pe(f[1].crossings)),d&1025&&(m.$$scope={dirty:d,ctx:f}),o.$set(m);const p={};d&3&&(p.color=f[1].crossings[f[0]].properties.color),d&1024&&(p.$$scope={dirty:d,ctx:f}),!s&&d&3&&(s=!0,p.lngLat=f[1].crossings[f[0]].geometry.coordinates,we(()=>s=!1)),l.$set(p)},i(f){a||(_(r.$$.fragment,f),_(o.$$.fragment,f),_(l.$$.fragment,f),a=!0)},o(f){w(r.$$.fragment,f),w(o.$$.fragment,f),w(l.$$.fragment,f),a=!1},d(f){f&&k(e),E(r),E(o),E(l)}}}function Yi(n){let e,r,t,o;return e=new He({props:{$$slots:{map:[Vi],sidebar:[Wi]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=G(Hi,"keydown",n[4]),t=!0)},p(i,[l]){const s={};l&1031&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function xi(n,e,r){let t,o;oe(n,Q,m=>r(1,t=m)),oe(n,X,m=>r(2,o=m));let{idx:i}=e,l=at.SA10;function s(m){m.key=="Escape"&&W(X,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this crossing?")&&(W(X,o={kind:"neutral"},o),await et(),t.crossings.splice(i,1),Q.set(t))}function u(m){n.$$.not_equal(t.crossings[i].geometry.coordinates,m)&&(t.crossings[i].geometry.coordinates=m,Q.set(t))}const c=()=>W(X,o={kind:"neutral"},o);function f(){t.crossings[i].properties.name=this.value,Q.set(t)}function d(m){n.$$.not_equal(t.crossings[i].properties.sa10,m)&&(t.crossings[i].properties.sa10=m,Q.set(t))}return n.$$set=m=>{"idx"in m&&r(0,i=m.idx)},[i,t,o,l,s,a,u,c,f,d]}class el extends ae{constructor(e){super(),ce(this,e,xi,Yi,le,{idx:0})}}let H;const Kr=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Kr.decode();let pt=null;function _t(){return(pt===null||pt.byteLength===0)&&(pt=new Uint8Array(H.memory.buffer)),pt}function Te(n,e){return n=n>>>0,Kr.decode(_t().subarray(n,n+e))}const Ke=new Array(128).fill(void 0);Ke.push(void 0,null,!0,!1);let ht=Ke.length;function ye(n){ht===Ke.length&&Ke.push(Ke.length+1);const e=ht;return ht=Ke[e],Ke[e]=n,e}function se(n){return Ke[n]}function tl(n){n<132||(Ke[n]=ht,ht=n)}function it(n){const e=se(n);return tl(n),e}function Gt(n){return n==null}let mt=null;function nl(){return(mt===null||mt.byteLength===0)&&(mt=new Float64Array(H.memory.buffer)),mt}let gt=null;function ue(){return(gt===null||gt.byteLength===0)&&(gt=new Int32Array(H.memory.buffer)),gt}let Ze=0;const Tt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},rl=typeof Tt.encodeInto=="function"?function(n,e){return Tt.encodeInto(n,e)}:function(n,e){const r=Tt.encode(n);return e.set(r),{read:n.length,written:r.length}};function Lt(n,e,r){if(r===void 0){const s=Tt.encode(n),a=e(s.length,1)>>>0;return _t().subarray(a,a+s.length).set(s),Ze=s.length,a}let t=n.length,o=e(t,1)>>>0;const i=_t();let l=0;for(;l<t;l++){const s=n.charCodeAt(l);if(s>127)break;i[o+l]=s}if(l!==t){l!==0&&(n=n.slice(l)),o=r(o,t,t=l+n.length*3,1)>>>0;const s=_t().subarray(o+l,o+t),a=rl(n,s);l+=a.written}return Ze=l,o}function Xt(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let i="[";o>0&&(i+=Xt(n[0]));for(let l=1;l<o;l++)i+=", "+Xt(n[l]);return i+="]",i}const r=/\[object ([^\]]+)\]/.exec(toString.call(n));let t;if(r.length>1)t=r[1];else return toString.call(n);if(t=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:t}function ol(n,e){const r=e(n.length*1,1)>>>0;return _t().set(n,r/1),Ze=n.length,r}function Jt(n,e){try{return n.apply(this,e)}catch(r){H.__wbindgen_exn_store(ye(r))}}class Nt{static __wrap(e){e=e>>>0;const r=Object.create(Nt.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();H.__wbg_jsroutesnapper_free(e)}constructor(e){try{const i=H.__wbindgen_add_to_stack_pointer(-16),l=ol(e,H.__wbindgen_malloc),s=Ze;H.jsroutesnapper_new(i,l,s);var r=ue()[i/4+0],t=ue()[i/4+1],o=ue()[i/4+2];if(o)throw it(t);return Nt.__wrap(r)}finally{H.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){H.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ye(e))}setAreaMode(){H.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,r;try{const i=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_getConfig(i,this.__wbg_ptr);var t=ue()[i/4+0],o=ue()[i/4+1];return e=t,r=o,Te(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}toFinalFeature(){try{const t=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=ue()[t/4+0],r=ue()[t/4+1];let o;return e!==0&&(o=Te(e,r).slice(),H.__wbindgen_free(e,r*1)),o}finally{H.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,r;try{const i=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_renderGeojson(i,this.__wbg_ptr);var t=ue()[i/4+0],o=ue()[i/4+1];return e=t,r=o,Te(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}toggleSnapMode(){H.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,r,t){return H.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,r,t)!==0}onClick(){H.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return H.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return H.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){H.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_editExisting(o,this.__wbg_ptr,ye(e));var r=ue()[o/4+0],t=ue()[o/4+1];if(t)throw it(r)}finally{H.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,r;try{const i=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_debugRenderGraph(i,this.__wbg_ptr);var t=ue()[i/4+0],o=ue()[i/4+1];return e=t,r=o,Te(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}debugSnappableNodes(){let e,r;try{const i=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_debugSnappableNodes(i,this.__wbg_ptr);var t=ue()[i/4+0],o=ue()[i/4+1];return e=t,r=o,Te(t,o)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,r,1)}}routeNameForWaypoints(e){let r,t;try{const c=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_routeNameForWaypoints(c,this.__wbg_ptr,ye(e));var o=ue()[c/4+0],i=ue()[c/4+1],l=ue()[c/4+2],s=ue()[c/4+3],a=o,u=i;if(s)throw a=0,u=0,it(l);return r=a,t=u,Te(a,u)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(r,t,1)}}addSnappedWaypoint(e,r){H.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,r)}undo(){H.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let r,t;try{const c=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_calculateRoute(c,this.__wbg_ptr,ye(e));var o=ue()[c/4+0],i=ue()[c/4+1],l=ue()[c/4+2],s=ue()[c/4+3],a=o,u=i;if(s)throw a=0,u=0,it(l);return r=a,t=u,Te(a,u)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(r,t,1)}}getExtraNodes(e,r){let t,o;try{const f=H.__wbindgen_add_to_stack_pointer(-16);H.jsroutesnapper_getExtraNodes(f,this.__wbg_ptr,ye(e),ye(r));var i=ue()[f/4+0],l=ue()[f/4+1],s=ue()[f/4+2],a=ue()[f/4+3],u=i,c=l;if(a)throw u=0,c=0,it(s);return t=u,o=c,Te(u,c)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(t,o,1)}}}async function il(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(t){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function ll(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,r){const t=Te(e,r);return ye(t)},n.wbg.__wbindgen_object_drop_ref=function(e){it(e)},n.wbg.__wbindgen_error_new=function(e,r){const t=new Error(Te(e,r));return ye(t)},n.wbg.__wbindgen_number_get=function(e,r){const t=se(r),o=typeof t=="number"?t:void 0;nl()[e/8+1]=Gt(o)?0:o,ue()[e/4+0]=!Gt(o)},n.wbg.__wbindgen_is_object=function(e){const r=se(e);return typeof r=="object"&&r!==null},n.wbg.__wbindgen_is_undefined=function(e){return se(e)===void 0},n.wbg.__wbindgen_in=function(e,r){return se(e)in se(r)},n.wbg.__wbindgen_boolean_get=function(e){const r=se(e);return typeof r=="boolean"?r?1:0:2},n.wbg.__wbindgen_jsval_loose_eq=function(e,r){return se(e)==se(r)},n.wbg.__wbindgen_string_get=function(e,r){const t=se(r),o=typeof t=="string"?t:void 0;var i=Gt(o)?0:Lt(o,H.__wbindgen_malloc,H.__wbindgen_realloc),l=Ze;ue()[e/4+1]=l,ue()[e/4+0]=i},n.wbg.__wbg_String_4370c5505c674d30=function(e,r){const t=String(se(r)),o=Lt(t,H.__wbindgen_malloc,H.__wbindgen_realloc),i=Ze;ue()[e/4+1]=i,ue()[e/4+0]=o},n.wbg.__wbindgen_object_clone_ref=function(e){const r=se(e);return ye(r)},n.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,r){const t=se(e)[se(r)];return ye(t)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ye(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,r){const t=se(r).stack,o=Lt(t,H.__wbindgen_malloc,H.__wbindgen_realloc),i=Ze;ue()[e/4+1]=i,ue()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,r){let t,o;try{t=e,o=r,console.error(Te(e,r))}finally{H.__wbindgen_free(t,o,1)}},n.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(se(e))},n.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(se(e))},n.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(se(e))},n.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(se(e))},n.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(se(e))},n.wbg.__wbg_get_44be0491f933a435=function(e,r){const t=se(e)[r>>>0];return ye(t)},n.wbg.__wbg_length_fff51ee6522a1a18=function(e){return se(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof se(e)=="function"},n.wbg.__wbg_next_526fc47e980da008=function(e){const r=se(e).next;return ye(r)},n.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Jt(function(e){const r=se(e).next();return ye(r)},arguments)},n.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return se(e).done},n.wbg.__wbg_value_1695675138684bd5=function(e){const r=se(e).value;return ye(r)},n.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ye(Symbol.iterator)},n.wbg.__wbg_get_97b561fb56f034b5=function(){return Jt(function(e,r){const t=Reflect.get(se(e),se(r));return ye(t)},arguments)},n.wbg.__wbg_call_cb65541d95d71282=function(){return Jt(function(e,r){const t=se(e).call(se(r));return ye(t)},arguments)},n.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(se(e))},n.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let r;try{r=se(e)instanceof ArrayBuffer}catch{r=!1}return r},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const r=se(e).buffer;return ye(r)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const r=new Uint8Array(se(e));return ye(r)},n.wbg.__wbg_set_5cf90238115182c3=function(e,r,t){se(e).set(se(r),t>>>0)},n.wbg.__wbg_length_72e2208bbc0efc61=function(e){return se(e).length},n.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let r;try{r=se(e)instanceof Uint8Array}catch{r=!1}return r},n.wbg.__wbindgen_debug_string=function(e,r){const t=Xt(se(r)),o=Lt(t,H.__wbindgen_malloc,H.__wbindgen_realloc),i=Ze;ue()[e/4+1]=i,ue()[e/4+0]=o},n.wbg.__wbindgen_throw=function(e,r){throw new Error(Te(e,r))},n.wbg.__wbindgen_memory=function(){const e=H.memory;return ye(e)},n}function sl(n,e){return H=n.exports,Wr.__wbindgen_wasm_module=e,mt=null,gt=null,pt=null,H}async function Wr(n){if(H!==void 0)return H;typeof n>"u"&&(n="/route-element/assets/route_snapper_bg.wasm");const e=ll();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:t}=await il(await n,e);return sl(r,t)}const al=30;class cl{constructor(e,r,t,o,i){this.onMouseMove=l=>{if(!this.active)return;const s=[l.point.x-al,l.point.y],a=this.map.unproject(l.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(l.lngLat.lng,l.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=l=>{this.active&&(l.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=l=>{if(!this.active)return;let s=l.target.tagName;s=="INPUT"||s=="TEXTAREA"||l.key=="Escape"&&(l.stopPropagation(),this.cancel())},this.onKeyPress=l=>{if(!this.active)return;let s=l.target.tagName;s=="INPUT"||s=="TEXTAREA"||(l.key=="Enter"?(l.stopPropagation(),this.finish()):l.key=="s"||l.key=="S"?(l.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):l.key=="z"&&l.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Nt(r),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=i,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersSuccess)r(JSON.parse(e));else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersUpdated)r(JSON.parse(e))}}function Zr(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Je[n%Je.length],answers:Array(Le.length).fill("")}}}let Le=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:ze()},{name:"SA04",description:"trip hazards",choices:ze()},{name:"SA05",description:"kerbside activity",choices:ze()},{name:"SA08",description:"motor traffic speed",choices:ze()},{name:"SA09",description:"motor traffic volume",choices:ze()},{name:"SA11",description:"footway widths",choices:ze()},{name:"SA12",description:"effective width next to tram lines",choices:ze()},{name:"SA13",description:"crossing angle of tram/train rails",choices:ze()},{name:"SA14",description:"cycling surface and maintenance defects",choices:ze()},{name:"SA15",description:"WW surface and maintenance defects",choices:ze()},{name:"SA16",description:"guard railing",choices:ze()}],Yt=Ge(null);const qe=Ge([]);async function ul(n){await ko(),await Wr();let e="https://assets.od2net.org/route-element",r=n.getBounds();try{let t=await wo(e,r.getEast(),r.getNorth(),r.getWest(),r.getSouth());Yt.set(new cl(n,t,Ge(Et()),Ge(!0),Ge(0))),X.set({kind:"draw-route"})}catch(t){window.alert(t)}}function fl(){try{let n=JSON.parse(zt(Yt).inner.calculateRoute(zt(qe)));if(!n){window.alert("No route drawn");return}let e=Zr(zt(Q).links.length);e.geometry=n.geometry,e.properties.name=n.properties.route_name,Q.update(r=>(r.links.push(e),r)),X.set({kind:"edit-link",idx:zt(Q).links.length-1})}catch(n){window.alert(`Bug: ${n}`)}qe.set([]),X.set({kind:"neutral"})}function Sn(n,e,r){const t=n.slice();return t[46]=e[r],t[47]=e,t[48]=r,t}function zn(n,e,r){const t=n.slice();return t[49]=e[r],t[50]=e,t[51]=r,t}function dl(n){let e;return{c(){e=h("h2"),e.textContent="Drawing a new route"},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function pl(n){let e;return{c(){e=h("h2"),e.textContent="Editing a route"},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function ml(n){let e,r=n[10].length+"",t,o;return{c(){e=F("Undo ("),t=F(r),o=F(")")},m(i,l){$(i,e,l),$(i,t,l),$(i,o,l)},p(i,l){l[0]&1024&&r!==(r=i[10].length+"")&&ie(t,r)},d(i){i&&(k(e),k(t),k(o))}}}function gl(n){let e;return{c(){e=F("Undo")},m(r,t){$(r,e,t)},p:Y,d(r){r&&k(e)}}}function _l(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p,j,L,v,A,O,b,C,y,S,D,I,K,V,T,J,N,ge,_e,U,Z,$e,he,q,ne,re,Ue,ft,vt;function yt(R,te){return R[2]?pl:dl}let rt=yt(n),Re=rt(n);function At(R,te){return R[10].length==0?gl:ml}let ot=At(n),Ee=ot(n);return re=Ht(n[37][0]),Ue=Ht(n[37][1]),{c(){e=h("div"),Re.c(),r=z(),t=h("button"),o=F("Finish"),l=z(),s=h("button"),Ee.c(),u=z(),c=h("button"),c.textContent="Cancel",f=z(),d=h("fieldset"),m=h("label"),p=h("input"),j=F(`
        Snap to roads`),L=z(),v=h("label"),A=h("input"),O=F(`
        Draw anywhere`),b=z(),C=h("fieldset"),y=h("label"),S=h("input"),D=F(`
        Extend from start (
        `),I=h("b"),I.textContent="1",K=F(`
        )`),V=z(),T=h("label"),J=h("input"),N=F(`
        Extend from end (
        `),ge=h("b"),ge.textContent="2",_e=F(`
        )`),U=z(),Z=h("label"),$e=h("input"),he=F(`
        Adjust middle points (
        `),q=h("b"),q.textContent="3",ne=F(`
        )`),t.disabled=i=n[7].length<2,P(s,"class","secondary"),s.disabled=a=n[10].length==0,P(c,"class","secondary"),P(p,"type","radio"),p.__value="snap",ve(p,p.__value),P(A,"type","radio"),A.__value="free",ve(A,A.__value),P(S,"type","radio"),S.__value="append-start",ve(S,S.__value),P(J,"type","radio"),J.__value="append-end",ve(J,J.__value),P($e,"type","radio"),$e.__value="adjust",ve($e,$e.__value),P(e,"slot","sidebar"),re.p(S,J,$e),Ue.p(p,A)},m(R,te){$(R,e,te),Re.m(e,null),g(e,r),g(e,t),g(t,o),g(e,l),g(e,s),Ee.m(s,null),g(e,u),g(e,c),g(e,f),g(e,d),g(d,m),g(m,p),p.checked=p.__value===n[9],g(m,j),g(d,L),g(d,v),g(v,A),A.checked=A.__value===n[9],g(v,O),g(e,b),g(e,C),g(C,y),g(y,S),S.checked=S.__value===n[3],g(y,D),g(y,I),g(y,K),g(C,V),g(C,T),g(T,J),J.checked=J.__value===n[3],g(T,N),g(T,ge),g(T,_e),g(C,U),g(C,Z),g(Z,$e),$e.checked=$e.__value===n[3],g(Z,he),g(Z,q),g(Z,ne),ft||(vt=[G(t,"click",function(){Kt(n[0])&&n[0].apply(this,arguments)}),G(s,"click",n[13]),G(c,"click",function(){Kt(n[1])&&n[1].apply(this,arguments)}),G(p,"change",n[36]),G(p,"change",n[14]),G(A,"change",n[38]),G(A,"change",n[14]),G(S,"change",n[39]),G(J,"change",n[40]),G($e,"change",n[41])],ft=!0)},p(R,te){n=R,rt!==(rt=yt(n))&&(Re.d(1),Re=rt(n),Re&&(Re.c(),Re.m(e,r))),te[0]&128&&i!==(i=n[7].length<2)&&(t.disabled=i),ot===(ot=At(n))&&Ee?Ee.p(n,te):(Ee.d(1),Ee=ot(n),Ee&&(Ee.c(),Ee.m(s,null))),te[0]&1024&&a!==(a=n[10].length==0)&&(s.disabled=a),te[0]&512&&(p.checked=p.__value===n[9]),te[0]&512&&(A.checked=A.__value===n[9]),te[0]&8&&(S.checked=S.__value===n[3]),te[0]&8&&(J.checked=J.__value===n[3]),te[0]&8&&($e.checked=$e.__value===n[3])},d(R){R&&k(e),Re.d(),Ee.d(),re.r(),Ue.r(),ft=!1,je(vt)}}}function hl(n){let e;return{c(){e=h("span"),P(e,"class","dot svelte-1cj4rwq"),Ae(e,"snapped-node",n[49].snapped),Ae(e,"free-node",!n[49].snapped),Ae(e,"hide",n[6])},m(r,t){$(r,e,t)},p(r,t){t[0]&2048&&Ae(e,"snapped-node",r[49].snapped),t[0]&2048&&Ae(e,"free-node",!r[49].snapped),t[0]&64&&Ae(e,"hide",r[6])},d(r){r&&k(e)}}}function Ln(n){let e,r,t;function o(a){n[27](a,n[49])}function i(){return n[28](n[49])}function l(){return n[29](n[49])}let s={draggable:!0,zIndex:0,$$slots:{default:[hl]},$$scope:{ctx:n}};return n[49].point!==void 0&&(s.lngLat=n[49].point),e=new Ve({props:s}),me.push(()=>ke(e,"lngLat",o)),e.$on("dragstart",i),e.$on("drag",l),e.$on("dragend",n[22]),{c(){M(e.$$.fragment)},m(a,u){B(e,a,u),t=!0},p(a,u){n=a;const c={};u[0]&2112|u[1]&2097152&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&2048&&(r=!0,c.lngLat=n[49].point,we(()=>r=!1)),e.$set(c)},i(a){t||(_(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function bl(n){let e;return{c(){e=h("span"),e.textContent=`${n[48]+1}`,P(e,"class","dot svelte-1cj4rwq"),Ae(e,"snapped",n[46].snapped)},m(r,t){$(r,e,t)},p(r,t){t[0]&128&&Ae(e,"snapped",r[46].snapped)},d(r){r&&k(e)}}}function Mn(n){let e,r,t;function o(a){n[30](a,n[46])}function i(){return n[31](n[48])}function l(){return n[32](n[48])}let s={draggable:!0,zIndex:1,$$slots:{default:[bl]},$$scope:{ctx:n}};return n[46].point!==void 0&&(s.lngLat=n[46].point),e=new Ve({props:s}),me.push(()=>ke(e,"lngLat",o)),e.$on("click",i),e.$on("contextmenu",l),e.$on("mouseenter",n[33]),e.$on("mouseleave",n[34]),e.$on("dragstart",n[24]),e.$on("dragend",n[35]),{c(){M(e.$$.fragment)},m(a,u){B(e,a,u),t=!0},p(a,u){n=a;const c={};u[0]&128|u[1]&2097152&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&128&&(r=!0,c.lngLat=n[46].point,we(()=>r=!1)),e.$set(c)},i(a){t||(_(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function $l(n){let e,r;return e=new Fe({props:{paint:{"line-color":"black","line-width":10}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function kl(n){let e,r;return e=new Fe({props:{paint:{"line-color":"black","line-width":3}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function wl(n){let e,r,t,o,i,l,s,a,u;r=new Ft({}),r.$on("click",n[15]),r.$on("mousemove",n[16]);let c=ee(n[11]),f=[];for(let L=0;L<c.length;L+=1)f[L]=Ln(zn(n,c,L));const d=L=>w(f[L],1,1,()=>{f[L]=null});let m=ee(n[7]),p=[];for(let L=0;L<m.length;L+=1)p[L]=Mn(Sn(n,m,L));const j=L=>w(p[L],1,1,()=>{p[L]=null});return l=new Ce({props:{data:n[19](n[8],n[7]),generateId:!0,$$slots:{default:[$l]},$$scope:{ctx:n}}}),a=new Ce({props:{data:n[12],$$slots:{default:[kl]},$$scope:{ctx:n}}}),{c(){e=h("div"),M(r.$$.fragment),t=z();for(let L=0;L<f.length;L+=1)f[L].c();o=z();for(let L=0;L<p.length;L+=1)p[L].c();i=z(),M(l.$$.fragment),s=z(),M(a.$$.fragment),P(e,"slot","map")},m(L,v){$(L,e,v),B(r,e,null),g(e,t);for(let A=0;A<f.length;A+=1)f[A]&&f[A].m(e,null);g(e,o);for(let A=0;A<p.length;A+=1)p[A]&&p[A].m(e,null);g(e,i),B(l,e,null),g(e,s),B(a,e,null),u=!0},p(L,v){if(v[0]&7342144){c=ee(L[11]);let b;for(b=0;b<c.length;b+=1){const C=zn(L,c,b);f[b]?(f[b].p(C,v),_(f[b],1)):(f[b]=Ln(C),f[b].c(),_(f[b],1),f[b].m(e,o))}for(fe(),b=c.length;b<f.length;b+=1)d(b);de()}if(v[0]&17170608){m=ee(L[7]);let b;for(b=0;b<m.length;b+=1){const C=Sn(L,m,b);p[b]?(p[b].p(C,v),_(p[b],1)):(p[b]=Mn(C),p[b].c(),_(p[b],1),p[b].m(e,i))}for(fe(),b=m.length;b<p.length;b+=1)j(b);de()}const A={};v[0]&384&&(A.data=L[19](L[8],L[7])),v[1]&2097152&&(A.$$scope={dirty:v,ctx:L}),l.$set(A);const O={};v[0]&4096&&(O.data=L[12]),v[1]&2097152&&(O.$$scope={dirty:v,ctx:L}),a.$set(O)},i(L){if(!u){_(r.$$.fragment,L);for(let v=0;v<c.length;v+=1)_(f[v]);for(let v=0;v<m.length;v+=1)_(p[v]);_(l.$$.fragment,L),_(a.$$.fragment,L),u=!0}},o(L){w(r.$$.fragment,L),f=f.filter(Boolean);for(let v=0;v<f.length;v+=1)w(f[v]);p=p.filter(Boolean);for(let v=0;v<p.length;v+=1)w(p[v]);w(l.$$.fragment,L),w(a.$$.fragment,L),u=!1},d(L){L&&k(e),E(r),be(f,L),be(p,L),E(l),E(a)}}}function vl(n){let e,r,t,o;return e=new He({props:{$$slots:{map:[wl],sidebar:[_l]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=G(window,"keydown",n[23]),t=!0)},p(i,l){const s={};l[0]&8191|l[1]&2097152&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function yl(n,e,r){let t,o,i;oe(n,qe,R=>r(7,o=R)),oe(n,Yt,R=>r(8,i=R));let{map:l}=e,{finish:s}=e,{cancel:a}=e,{editingExisting:u}=e;Ot(()=>{W(qe,o=[],o),i==null||i.stop(),l.getCanvas().style.cursor="inherit"});let c=u?"adjust":"append-end",f="snap",d=[],m=[],p=null,j=!1,L=!1,v=!1;function A(R){let te=R.length==0?"crosshair":"inherit";l.getCanvas().style.cursor=te}function O(){let R=d.pop();r(10,d),R&&W(qe,o=R,o)}function b(){d.length==100&&d.shift(),r(10,d=[...d,JSON.parse(JSON.stringify(o))])}function C(){r(9,f=f=="snap"?"free":"snap"),p&&r(26,p.snapped=f=="snap",p)}function y(R){b(),qe.update(te=>(c=="append-start"?te.splice(0,0,{point:R.detail.lngLat.toArray(),snapped:f=="snap"}):c=="append-end"&&te.push({point:R.detail.lngLat.toArray(),snapped:f=="snap"}),te))}function S(R){r(26,p={point:R.detail.lngLat.toArray(),snapped:f=="snap"})}function D(R){b(),qe.update(te=>(te[R].snapped=!te[R].snapped,te))}function I(R){b(),qe.update(te=>(te.splice(R,1),te)),r(4,j=!1)}function K(R,te){try{if(R)return JSON.parse(R.inner.calculateRoute(te))}catch{}return Et()}function V(R,te,Pe,dt,Ct){if(Ct)return Et();try{if(R&&te.length>0&&dt){if(Pe=="append-start")return JSON.parse(R.inner.calculateRoute([dt,te[0]]));if(Pe=="append-end")return JSON.parse(R.inner.calculateRoute([te[te.length-1],dt]))}}catch{}return Et()}function T(R,te,Pe,dt){if(dt)return;if(!R||Pe!="adjust"){r(11,m=[]);return}let Ct=[],qt=1;for(let jt=0;jt<te.length-1;jt++){let eo=JSON.parse(R.inner.getExtraNodes(te[jt],te[jt+1]));for(let[to,no,ro]of eo)Ct.push({point:[to,no],snapped:ro,insertIdx:qt});qt++}r(11,m=Ct)}function J(R){b(),qe.update(te=>(te.splice(R.insertIdx,0,{point:R.point,snapped:R.snapped}),te)),r(6,v=!0)}function N(R){qe.update(te=>(te[R.insertIdx].point=R.point,te))}function ge(){r(6,v=!1)}function _e(R){let te=R.target.tagName,Pe=te=="INPUT"||te=="TEXTAREA";R.key==="Enter"&&!Pe?(R.stopPropagation(),o.length>=2&&s()):R.key==="Escape"?(R.stopPropagation(),a()):R.key=="s"&&!Pe?C():R.key=="1"&&!Pe?r(3,c="append-start"):R.key=="2"&&!Pe?r(3,c="append-end"):R.key=="3"&&!Pe?r(3,c="adjust"):R.key=="z"&&R.ctrlKey&&(R.stopPropagation(),O())}function U(){b(),r(5,L=!0)}const Z=[[],[]];function $e(R,te){n.$$.not_equal(te.point,R)&&(te.point=R,r(11,m))}const he=R=>J(R),q=R=>N(R);function ne(R,te){n.$$.not_equal(te.point,R)&&(te.point=R,qe.set(o))}const re=R=>D(R),Ue=R=>I(R),ft=()=>r(4,j=!0),vt=()=>r(4,j=!1),yt=()=>r(5,L=!1);function rt(){f=this.__value,r(9,f)}function Re(){f=this.__value,r(9,f)}function At(){c=this.__value,r(3,c)}function ot(){c=this.__value,r(3,c)}function Ee(){c=this.__value,r(3,c)}return n.$$set=R=>{"map"in R&&r(25,l=R.map),"finish"in R&&r(0,s=R.finish),"cancel"in R&&r(1,a=R.cancel),"editingExisting"in R&&r(2,u=R.editingExisting)},n.$$.update=()=>{n.$$.dirty[0]&456&&T(i,o,c,v),n.$$.dirty[0]&67109304&&r(12,t=V(i,o,c,p,j||L)),n.$$.dirty[0]&128&&A(o)},[s,a,u,c,j,L,v,o,i,f,d,m,t,O,C,y,S,D,I,K,J,N,ge,_e,U,l,p,$e,he,q,ne,re,Ue,ft,vt,yt,rt,Z,Re,At,ot,Ee]}class Al extends ae{constructor(e){super(),ce(this,e,yl,vl,le,{map:25,finish:0,cancel:1,editingExisting:2},null,[-1,-1])}}let Bn="MZEJTanw3WpxRvt7qDfo";async function Cl(n){return n?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await jl(n)}&key=${n}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${Bn}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${Bn}`}async function jl(n){try{let r=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB"})})).json();return"session"in r?r.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(r)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}const Sl="/route-element/assets/right-arrow-d8c7892c.svg";function En(n){let e,r;const t=n[4].default,o=De(t,n,n[3],null);return{c(){e=h("div"),o&&o.c(),P(e,"class","section svelte-zax3q3")},m(i,l){$(i,e,l),o&&o.m(e,null),r=!0},p(i,l){o&&o.p&&(!r||l&8)&&Ne(o,t,i,i[3],r?Oe(t,i[3],l,null):Ie(i[3]),null)},i(i){r||(_(o,i),r=!0)},o(i){w(o,i),r=!1},d(i){i&&k(e),o&&o.d(i)}}}function zl(n){let e,r,t,o,i,l,s,a,u,c,f,d,m=n[2]&&En(n);return{c(){e=h("button"),r=h("div"),t=h("span"),o=F(n[0]),i=z(),l=h("img"),u=z(),m&&m.c(),P(l,"class","arrow svelte-zax3q3"),bt(l.src,s=Sl)||P(l,"src",s),P(l,"alt",a="Select "+n[0]),P(r,"class","top-section section svelte-zax3q3"),Ae(r,"bordered",n[2]),P(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m(p,j){$(p,e,j),g(e,r),g(r,t),g(t,o),g(r,i),g(r,l),g(e,u),m&&m.m(e,null),c=!0,f||(d=[G(e,"click",n[5]),G(e,"mouseenter",n[6]),G(e,"mouseleave",n[7])],f=!0)},p(p,[j]){(!c||j&1)&&ie(o,p[0]),(!c||j&1&&a!==(a="Select "+p[0]))&&P(l,"alt",a),(!c||j&4)&&Ae(r,"bordered",p[2]),p[2]?m?(m.p(p,j),j&4&&_(m,1)):(m=En(p),m.c(),_(m,1),m.m(e,null)):m&&(fe(),w(m,1,1,()=>{m=null}),de()),(!c||j&2)&&(e.disabled=p[1])},i(p){c||(_(m),c=!0)},o(p){w(m),c=!1},d(p){p&&k(e),m&&m.d(),f=!1,je(d)}}}function Ll(n,e,r){let{$$slots:t={},$$scope:o}=e,{name:i}=e,{disabled:l=!1}=e,{hasSlot:s=!0}=e;function a(f){Se.call(this,n,f)}function u(f){Se.call(this,n,f)}function c(f){Se.call(this,n,f)}return n.$$set=f=>{"name"in f&&r(0,i=f.name),"disabled"in f&&r(1,l=f.disabled),"hasSlot"in f&&r(2,s=f.hasSlot),"$$scope"in f&&r(3,o=f.$$scope)},[i,l,s,o,t,a,u,c]}class Xr extends ae{constructor(e){super(),ce(this,e,Ll,zl,le,{name:0,disabled:1,hasSlot:2})}}let Xe={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const lt={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},Vr=Object.keys(lt);function It(n){return Object.keys(lt[n])}const xe="All movements";function Tn(n,e){let r=[],t=lt[n][e];t&&r.push({junctionType:n,movementType:e,...t});let o=lt[n][xe];if(o&&e!=xe&&r.push({junctionType:n,movementType:xe,...o}),n=="Crossroads"){let i=lt["Simple priority T-junction"][xe];i&&r.push({junctionType:"Simple priority T-junction",movementType:xe,...i})}if(n!="Any type of junction"){let i=lt["Any type of junction"][xe];i&&r.push({junctionType:"Any type of junction",movementType:xe,...i})}return r}function Dn(n,e,r){const t=n.slice();return t[9]=e[r],t}function Nn(n,e,r){const t=n.slice();return t[12]=e[r],t}function In(n,e,r){const t=n.slice();return t[12]=e[r],t}function On(n,e,r){const t=n.slice();return t[12]=e[r],t}function Fn(n){let e,r;return e=new Ut({props:{$$slots:{default:[El]},$$scope:{ctx:n}}}),e.$on("close",n[8]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&524295&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ml(n){let e;return{c(){e=F("Type of junction")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function Bl(n){let e;return{c(){e=F("Type of movement")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function Un(n){let e,r,t;function o(l){n[6](l)}let i={k:"vert-radio",choices:It(n[1]),$$slots:{default:[Bl]},$$scope:{ctx:n}};return n[2]!==void 0&&(i.value=n[2]),e=new We({props:i}),me.push(()=>ke(e,"value",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,s){const a={};s&2&&(a.choices=It(l[1])),s&524288&&(a.$$scope={dirty:s,ctx:l}),!r&&s&4&&(r=!0,a.value=l[2],we(()=>r=!1)),e.$set(a)},i(l){t||(_(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Pn(n){let e,r=n[12]+"",t;return{c(){e=h("li"),t=F(r)},m(o,i){$(o,e,i),g(e,t)},p(o,i){i&6&&r!==(r=o[12]+"")&&ie(t,r)},d(o){o&&k(e)}}}function qn(n){let e,r=n[12]+"",t;return{c(){e=h("li"),t=F(r)},m(o,i){$(o,e,i),g(e,t)},p(o,i){i&6&&r!==(r=o[12]+"")&&ie(t,r)},d(o){o&&k(e)}}}function Rn(n){let e,r=n[12]+"",t;return{c(){e=h("li"),t=F(r)},m(o,i){$(o,e,i),g(e,t)},p(o,i){i&6&&r!==(r=o[12]+"")&&ie(t,r)},d(o){o&&k(e)}}}function Gn(n){let e,r,t=n[9].junctionType+"",o,i,l,s,a,u,c=n[9].movementType+"",f,d,m,p,j,L,v,A,O,b,C,y=ee(n[9].scoreZero),S=[];for(let T=0;T<y.length;T+=1)S[T]=Pn(On(n,y,T));let D=ee(n[9].scoreOne),I=[];for(let T=0;T<D.length;T+=1)I[T]=qn(In(n,D,T));let K=ee(n[9].scoreTwo),V=[];for(let T=0;T<K.length;T+=1)V[T]=Rn(Nn(n,K,T));return{c(){e=h("tr"),r=h("td"),o=F(t),i=z(),l=h("br"),s=z(),a=h("br"),u=z(),f=F(c),d=z(),m=h("td"),p=h("ul");for(let T=0;T<S.length;T+=1)S[T].c();j=z(),L=h("td"),v=h("ul");for(let T=0;T<I.length;T+=1)I[T].c();A=z(),O=h("td"),b=h("ul");for(let T=0;T<V.length;T+=1)V[T].c();C=z(),P(r,"class","type-row svelte-k4kgn3"),P(m,"class","score-zero svelte-k4kgn3"),P(L,"class","score-one svelte-k4kgn3"),P(O,"class","score-two svelte-k4kgn3")},m(T,J){$(T,e,J),g(e,r),g(r,o),g(r,i),g(r,l),g(r,s),g(r,a),g(r,u),g(r,f),g(e,d),g(e,m),g(m,p);for(let N=0;N<S.length;N+=1)S[N]&&S[N].m(p,null);g(e,j),g(e,L),g(L,v);for(let N=0;N<I.length;N+=1)I[N]&&I[N].m(v,null);g(e,A),g(e,O),g(O,b);for(let N=0;N<V.length;N+=1)V[N]&&V[N].m(b,null);g(e,C)},p(T,J){if(J&6&&t!==(t=T[9].junctionType+"")&&ie(o,t),J&6&&c!==(c=T[9].movementType+"")&&ie(f,c),J&6){y=ee(T[9].scoreZero);let N;for(N=0;N<y.length;N+=1){const ge=On(T,y,N);S[N]?S[N].p(ge,J):(S[N]=Pn(ge),S[N].c(),S[N].m(p,null))}for(;N<S.length;N+=1)S[N].d(1);S.length=y.length}if(J&6){D=ee(T[9].scoreOne);let N;for(N=0;N<D.length;N+=1){const ge=In(T,D,N);I[N]?I[N].p(ge,J):(I[N]=qn(ge),I[N].c(),I[N].m(v,null))}for(;N<I.length;N+=1)I[N].d(1);I.length=D.length}if(J&6){K=ee(T[9].scoreTwo);let N;for(N=0;N<K.length;N+=1){const ge=Nn(T,K,N);V[N]?V[N].p(ge,J):(V[N]=Rn(ge),V[N].c(),V[N].m(b,null))}for(;N<V.length;N+=1)V[N].d(1);V.length=K.length}},d(T){T&&k(e),be(S,T),be(I,T),be(V,T)}}}function El(n){let e,r,t,o,i,l,s,a,u=n[1],c,f,d,m,p,j,L,v,A;function O(D){n[5](D)}let b={k:"vert-radio",choices:Vr,$$slots:{default:[Ml]},$$scope:{ctx:n}};n[1]!==void 0&&(b.value=n[1]),l=new We({props:b}),me.push(()=>ke(l,"value",O)),l.$on("change",n[3]);let C=Un(n),y=ee(Tn(n[1],n[2])),S=[];for(let D=0;D<y.length;D+=1)S[D]=Gn(Dn(n,y,D));return{c(){e=h("h1"),e.textContent="LTN 1/20 scoring guidance",r=z(),t=h("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,o=z(),i=h("div"),M(l.$$.fragment),a=z(),C.c(),c=z(),f=h("table"),d=h("tr"),d.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,m=z();for(let D=0;D<S.length;D+=1)S[D].c();p=z(),j=h("button"),j.textContent="OK",x(i,"display","flex"),x(i,"justify-content","space-between")},m(D,I){$(D,e,I),$(D,r,I),$(D,t,I),$(D,o,I),$(D,i,I),B(l,i,null),g(i,a),C.m(i,null),$(D,c,I),$(D,f,I),g(f,d),g(f,m);for(let K=0;K<S.length;K+=1)S[K]&&S[K].m(f,null);$(D,p,I),$(D,j,I),L=!0,v||(A=G(j,"click",n[7]),v=!0)},p(D,I){const K={};if(I&524288&&(K.$$scope={dirty:I,ctx:D}),!s&&I&2&&(s=!0,K.value=D[1],we(()=>s=!1)),l.$set(K),I&2&&le(u,u=D[1])?(fe(),w(C,1,1,Y),de(),C=Un(D),C.c(),_(C,1),C.m(i,null)):C.p(D,I),I&6){y=ee(Tn(D[1],D[2]));let V;for(V=0;V<y.length;V+=1){const T=Dn(D,y,V);S[V]?S[V].p(T,I):(S[V]=Gn(T),S[V].c(),S[V].m(f,null))}for(;V<S.length;V+=1)S[V].d(1);S.length=y.length}},i(D){L||(_(l.$$.fragment,D),_(C),L=!0)},o(D){w(l.$$.fragment,D),w(C),L=!1},d(D){D&&(k(e),k(r),k(t),k(o),k(i),k(c),k(f),k(p),k(j)),E(l),C.d(D),be(S,D),v=!1,A()}}}function Tl(n){let e,r,t,o,i,l,s=n[0]&&Fn(n);return{c(){e=h("button"),e.textContent="LTN 1/20 scoring guidance",r=z(),s&&s.c(),t=Qe(),P(e,"class","secondary")},m(a,u){$(a,e,u),$(a,r,u),s&&s.m(a,u),$(a,t,u),o=!0,i||(l=G(e,"click",n[4]),i=!0)},p(a,[u]){a[0]?s?(s.p(a,u),u&1&&_(s,1)):(s=Fn(a),s.c(),_(s,1),s.m(t.parentNode,t)):s&&(fe(),w(s,1,1,()=>{s=null}),de())},i(a){o||(_(s),o=!0)},o(a){w(s),o=!1},d(a){a&&(k(e),k(r),k(t)),s&&s.d(a),i=!1,l()}}}function Dl(n,e,r){let t=!1,o=Vr[0],i=It(o)[0];function l(){r(2,i=It(o)[0])}const s=()=>r(0,t=!0);function a(d){o=d,r(1,o)}function u(d){i=d,r(2,i)}return[t,o,i,l,s,a,u,()=>r(0,t=!1),()=>r(0,t=!1)]}class Nl extends ae{constructor(e){super(),ce(this,e,Dl,Tl,le,{})}}function Il(n){let e;return{c(){e=F("User")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function Jn(n){let e,r;return e=new Nl({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ol(n){let e;return{c(){e=F("Score")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function Fl(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p,j,L,v;function A(S){n[6](S)}let O={k:"horiz-radio",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]],$$slots:{default:[Il]},$$scope:{ctx:n}};n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind!==void 0&&(O.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind),i=new We({props:O}),me.push(()=>ke(i,"value",A));let b=n[3].jats[n[0]].properties[n[1]].movements[n[2]].kind=="cycling"&&Jn();function C(S){n[7](S)}let y={k:"horiz-radio",choices:n[4],$$slots:{default:[Ol]},$$scope:{ctx:n}};return n[3].jats[n[0]].properties[n[1]].movements[n[2]].score!==void 0&&(y.value=n[3].jats[n[0]].properties[n[1]].movements[n[2]].score),u=new We({props:y}),me.push(()=>ke(u,"value",C)),{c(){e=h("label"),r=F(`Name
  `),t=h("input"),o=z(),M(i.$$.fragment),s=z(),b&&b.c(),a=z(),M(u.$$.fragment),f=z(),d=h("label"),m=F(`Comments
  `),p=h("textarea"),P(t,"type","text")},m(S,D){$(S,e,D),g(e,r),g(e,t),ve(t,n[3].jats[n[0]].properties[n[1]].movements[n[2]].name),$(S,o,D),B(i,S,D),$(S,s,D),b&&b.m(S,D),$(S,a,D),B(u,S,D),$(S,f,D),$(S,d,D),g(d,m),g(d,p),ve(p,n[3].jats[n[0]].properties[n[1]].movements[n[2]].notes),j=!0,L||(v=[G(t,"input",n[5]),G(p,"input",n[8])],L=!0)},p(S,[D]){D&15&&t.value!==S[3].jats[S[0]].properties[S[1]].movements[S[2]].name&&ve(t,S[3].jats[S[0]].properties[S[1]].movements[S[2]].name);const I={};D&512&&(I.$$scope={dirty:D,ctx:S}),!l&&D&15&&(l=!0,I.value=S[3].jats[S[0]].properties[S[1]].movements[S[2]].kind,we(()=>l=!1)),i.$set(I),S[3].jats[S[0]].properties[S[1]].movements[S[2]].kind=="cycling"?b?D&15&&_(b,1):(b=Jn(),b.c(),_(b,1),b.m(a.parentNode,a)):b&&(fe(),w(b,1,1,()=>{b=null}),de());const K={};D&512&&(K.$$scope={dirty:D,ctx:S}),!c&&D&15&&(c=!0,K.value=S[3].jats[S[0]].properties[S[1]].movements[S[2]].score,we(()=>c=!1)),u.$set(K),D&15&&ve(p,S[3].jats[S[0]].properties[S[1]].movements[S[2]].notes)},i(S){j||(_(i.$$.fragment,S),_(b),_(u.$$.fragment,S),j=!0)},o(S){w(i.$$.fragment,S),w(b),w(u.$$.fragment,S),j=!1},d(S){S&&(k(e),k(o),k(s),k(a),k(f),k(d)),E(i,S),b&&b.d(S),E(u,S),L=!1,je(v)}}}function Ul(n,e,r){let t;oe(n,Q,d=>r(3,t=d));let{junctionIdx:o}=e,{stage:i}=e,{idx:l}=e,s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function a(){t.jats[o].properties[i].movements[l].name=this.value,Q.set(t)}function u(d){n.$$.not_equal(t.jats[o].properties[i].movements[l].kind,d)&&(t.jats[o].properties[i].movements[l].kind=d,Q.set(t))}function c(d){n.$$.not_equal(t.jats[o].properties[i].movements[l].score,d)&&(t.jats[o].properties[i].movements[l].score=d,Q.set(t))}function f(){t.jats[o].properties[i].movements[l].notes=this.value,Q.set(t)}return n.$$set=d=>{"junctionIdx"in d&&r(0,o=d.junctionIdx),"stage"in d&&r(1,i=d.stage),"idx"in d&&r(2,l=d.idx)},[o,i,l,t,s,a,u,c,f]}class Pl extends ae{constructor(e){super(),ce(this,e,Ul,Fl,le,{junctionIdx:0,stage:1,idx:2})}}function ql(n){return n%(2*Math.PI)*180/Math.PI}function Mt(n){return n%360*Math.PI/180}function Qn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Yr(n,e,r={}){if(r.final===!0)return Rl(n,e);const t=Qn(n),o=Qn(e),i=Mt(t[0]),l=Mt(o[0]),s=Mt(t[1]),a=Mt(o[1]),u=Math.sin(l-i)*Math.cos(a),c=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(l-i);return ql(Math.atan2(u,c))}function Rl(n,e){let r=Yr(e,n);return r=(r+180)%360,r}var st=Yr;function Gl(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function Jl(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Hn(n[0])||!Hn(n[1]))throw new Error("coordinates must contain numbers");return Gl({type:"Point",coordinates:n},e,r)}function Hn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Ql(n,e={}){const r=vo(n),t=(r[0]+r[2])/2,o=(r[1]+r[3])/2;return Jl([t,o],e.properties,e)}var Hl=Ql,Me=63710088e-1,Kl={centimeters:Me*100,centimetres:Me*100,degrees:360/(2*Math.PI),feet:Me*3.28084,inches:Me*39.37,kilometers:Me/1e3,kilometres:Me/1e3,meters:Me,metres:Me,miles:Me/1609.344,millimeters:Me*1e3,millimetres:Me*1e3,nauticalmiles:Me/1852,radians:1,yards:Me*1.0936};function Wl(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function Zl(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wn(n[0])||!Wn(n[1]))throw new Error("coordinates must contain numbers");return Wl({type:"Point",coordinates:n},e,r)}function Xl(n,e="kilometers"){const r=Kl[e];if(!r)throw new Error(e+" units is invalid");return n/r}function Kn(n){return n%(2*Math.PI)*180/Math.PI}function Qt(n){return n%360*Math.PI/180}function Wn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Vl(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Yl(n,e,r,t={}){const o=Vl(n),i=Qt(o[0]),l=Qt(o[1]),s=Qt(r),a=Xl(e,t.units),u=Math.asin(Math.sin(l)*Math.cos(a)+Math.cos(l)*Math.sin(a)*Math.cos(s)),c=i+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(l),Math.cos(a)-Math.sin(l)*Math.sin(u)),f=Kn(c),d=Kn(u);return Zl([f,d],t.properties)}var kt=Yl,Be=63710088e-1,xl={centimeters:Be*100,centimetres:Be*100,degrees:360/(2*Math.PI),feet:Be*3.28084,inches:Be*39.37,kilometers:Be/1e3,kilometres:Be/1e3,meters:Be,metres:Be,miles:Be/1609.344,millimeters:Be*1e3,millimetres:Be*1e3,nauticalmiles:Be/1852,radians:1,yards:Be*1.0936};function es(n,e="kilometers"){const r=xl[e];if(!r)throw new Error(e+" units is invalid");return n*r}function Bt(n){return n%360*Math.PI/180}function Zn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ts(n,e,r={}){var t=Zn(n),o=Zn(e),i=Bt(o[1]-t[1]),l=Bt(o[0]-t[0]),s=Bt(t[1]),a=Bt(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(s)*Math.cos(a);return es(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)}var ns=ts;function rs(n){let e=Hl({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,o)=>Xn(st(e,o.point))-Xn(st(e,t.point)));let r=[];for(let t=0;t<n.length;t++){let o=n[t],i=st(o.point,e),l=1;for(let s of is(t,n.length)){let a=n[s],u=st(e,a.point),c=os(o.point,e,l++),f=ns(o.point,e),d=kt(c,.5*f,i).geometry.coordinates,m=kt(d,.2*f,u).geometry.coordinates;r.push({point1:c,point2:d,point3:m,kind:"cycling",score:"X",name:`${o.name} to ${a.name}`,notes:""})}}return r}function os(n,e,r){let t=.003,i=st(n,e)-90,l=t*r;return kt(n,l,i).geometry.coordinates}function Xn(n){return(n+360)%360}function is(n,e){let r=[];for(let t=n+1;t<e;t++)r.push(t);for(let t=0;t<n;t++)r.push(t);return r}const ls="/route-element/assets/movement-aa45473c.svg",ss="/route-element/assets/pan-fbcec4cd.svg";function Vn(n,e,r){const t=n.slice();return t[31]=e[r],t[32]=e,t[33]=r,t}function Yn(n,e,r){const t=n.slice();return t[34]=e[r],t[35]=e,t[33]=r,t}function xn(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p,j,L,v,A,O;function b(J,N){return J[0].mode=="select"?cs:as}let C=b(n),y=C(n);function S(J,N){return J[0].mode=="new-arm"?fs:us}let D=S(n),I=D(n);function K(J,N){return J[0].mode=="new-movement"?ps:ds}let V=K(n),T=V(n);return{c(){e=h("div"),r=h("button"),t=h("img"),i=z(),y.c(),l=z(),s=h("button"),a=Rt("svg"),u=Rt("circle"),c=Rt("text"),f=F("A"),d=z(),I.c(),m=z(),p=h("button"),j=h("img"),v=z(),T.c(),bt(t.src,o=ss)||P(t,"src",o),P(t,"alt","Move map"),x(t,"vertical-align","middle"),P(r,"class","outline"),P(u,"cx","12"),P(u,"cy","12"),P(u,"r","12"),P(u,"fill","white"),P(c,"x","6"),P(c,"y","16"),P(c,"fill","#4472c4"),P(a,"width","24"),P(a,"height","24"),P(a,"xmlns","http://www.w3.org/2000/svg"),x(a,"vertical-align","middle"),P(s,"class","outline"),bt(j.src,L=ls)||P(j,"src",L),P(j,"alt","New movement"),x(j,"vertical-align","middle"),P(p,"class","outline"),P(e,"class","control-panel svelte-l1e6xi")},m(J,N){$(J,e,N),g(e,r),g(r,t),g(r,i),y.m(r,null),g(e,l),g(e,s),g(s,a),g(a,u),g(a,c),g(c,f),g(s,d),I.m(s,null),g(e,m),g(e,p),g(p,j),g(p,v),T.m(p,null),A||(O=[G(r,"click",function(){Kt(n[4])&&n[4].apply(this,arguments)}),G(s,"click",n[12]),G(p,"click",n[13])],A=!0)},p(J,N){n=J,C!==(C=b(n))&&(y.d(1),y=C(n),y&&(y.c(),y.m(r,null))),D!==(D=S(n))&&(I.d(1),I=D(n),I&&(I.c(),I.m(s,null))),V!==(V=K(n))&&(T.d(1),T=V(n),T&&(T.c(),T.m(p,null)))},d(J){J&&k(e),y.d(),I.d(),T.d(),A=!1,je(O)}}}function as(n){let e;return{c(){e=F("Move map")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function cs(n){let e;return{c(){e=h("b"),e.textContent="Move map"},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function us(n){let e;return{c(){e=F("New arm")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function fs(n){let e;return{c(){e=h("b"),e.textContent="New arm"},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function ds(n){let e;return{c(){e=F("New movement")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function ps(n){let e;return{c(){e=h("b"),e.textContent="New movement"},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function ms(n){let e;return{c(){e=h("span"),e.textContent=`${js(n[33])}`,P(e,"class","dot svelte-l1e6xi"),x(e,"color","#4472c4"),x(e,"background-color","white")},m(r,t){$(r,e,t)},p:Y,d(r){r&&k(e)}}}function er(n){let e,r,t;function o(a){n[14](a,n[34])}function i(){return n[15](n[33])}function l(){return n[16](n[33])}let s={draggable:!0,$$slots:{default:[ms]},$$scope:{ctx:n}};return n[34].point!==void 0&&(s.lngLat=n[34].point),e=new Ve({props:s}),me.push(()=>ke(e,"lngLat",o)),e.$on("dragend",i),e.$on("click",l),{c(){M(e.$$.fragment)},m(a,u){B(e,a,u),t=!0},p(a,u){n=a;const c={};u[1]&32&&(c.$$scope={dirty:u,ctx:n}),!r&&u[0]&38&&(r=!0,c.lngLat=n[34].point,we(()=>r=!1)),e.$set(c)},i(a){t||(_(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function gs(n){let e;return{c(){e=h("span"),P(e,"class","dot svelte-l1e6xi"),x(e,"background-color",n[7][n[31].score]),x(e,"opacity",n[31].kind=="walking & wheeling"?"0%":"100%")},m(r,t){$(r,e,t)},p(r,t){t[0]&38&&x(e,"background-color",r[7][r[31].score]),t[0]&38&&x(e,"opacity",r[31].kind=="walking & wheeling"?"0%":"100%")},d(r){r&&k(e)}}}function _s(n){let e;return{c(){e=h("span"),P(e,"class","dot svelte-l1e6xi"),x(e,"background-color",n[7][n[31].score])},m(r,t){$(r,e,t)},p(r,t){t[0]&38&&x(e,"background-color",r[7][r[31].score])},d(r){r&&k(e)}}}function hs(n){let e;return{c(){e=h("span"),P(e,"class","dot svelte-l1e6xi"),x(e,"background-color",n[7][n[31].score]),x(e,"opacity","0%")},m(r,t){$(r,e,t)},p(r,t){t[0]&38&&x(e,"background-color",r[7][r[31].score])},d(r){r&&k(e)}}}function tr(n){let e,r,t,o,i,l,s,a,u;function c(y){n[17](y,n[31])}function f(){return n[18](n[33])}function d(){return n[19](n[33])}let m={draggable:!0,$$slots:{default:[gs]},$$scope:{ctx:n}};n[31].point1!==void 0&&(m.lngLat=n[31].point1),e=new Ve({props:m}),me.push(()=>ke(e,"lngLat",c)),e.$on("dragend",f),e.$on("click",d);function p(y){n[20](y,n[31])}function j(){return n[21](n[33])}function L(){return n[22](n[33])}let v={draggable:!0,$$slots:{default:[_s]},$$scope:{ctx:n}};n[31].point2!==void 0&&(v.lngLat=n[31].point2),o=new Ve({props:v}),me.push(()=>ke(o,"lngLat",p)),o.$on("dragend",j),o.$on("click",L);function A(y){n[23](y,n[31])}function O(){return n[24](n[33])}function b(){return n[25](n[33])}let C={draggable:!0,$$slots:{default:[hs]},$$scope:{ctx:n}};return n[31].point3!==void 0&&(C.lngLat=n[31].point3),s=new Ve({props:C}),me.push(()=>ke(s,"lngLat",A)),s.$on("dragend",O),s.$on("click",b),{c(){M(e.$$.fragment),t=z(),M(o.$$.fragment),l=z(),M(s.$$.fragment)},m(y,S){B(e,y,S),$(y,t,S),B(o,y,S),$(y,l,S),B(s,y,S),u=!0},p(y,S){n=y;const D={};S[0]&38|S[1]&32&&(D.$$scope={dirty:S,ctx:n}),!r&&S[0]&38&&(r=!0,D.lngLat=n[31].point1,we(()=>r=!1)),e.$set(D);const I={};S[0]&38|S[1]&32&&(I.$$scope={dirty:S,ctx:n}),!i&&S[0]&38&&(i=!0,I.lngLat=n[31].point2,we(()=>i=!1)),o.$set(I);const K={};S[0]&38|S[1]&32&&(K.$$scope={dirty:S,ctx:n}),!a&&S[0]&38&&(a=!0,K.lngLat=n[31].point3,we(()=>a=!1)),s.$set(K)},i(y){u||(_(e.$$.fragment,y),_(o.$$.fragment,y),_(s.$$.fragment,y),u=!0)},o(y){w(e.$$.fragment,y),w(o.$$.fragment,y),w(s.$$.fragment,y),u=!1},d(y){y&&(k(t),k(l)),E(e,y),E(o,y),E(s,y)}}}function bs(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=F(e)},m(t,o){$(t,r,o)},p(t,o){o[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&ie(r,e)},d(t){t&&k(r)}}}function $s(n){let e,r;return e=new wt({props:{$$slots:{default:[bs,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o[0]&1073741824|o[1]&32&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ks(n){let e=(n[30].name||"Untitled movement")+"",r;return{c(){r=F(e)},m(t,o){$(t,r,o)},p(t,o){o[0]&1073741824&&e!==(e=(t[30].name||"Untitled movement")+"")&&ie(r,e)},d(t){t&&k(r)}}}function ws(n){let e,r;return e=new wt({props:{$$slots:{default:[ks,({props:t})=>({30:t}),({props:t})=>[t?1073741824:0]]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o[0]&1073741824|o[1]&32&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function vs(n){let e,r,t,o,i,l;return e=new Fe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":$t(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[$s]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Fe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":$t(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[ws]},$$scope:{ctx:n}}}),t.$on("click",n[9]),i=new nt({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){M(e.$$.fragment),r=z(),M(t.$$.fragment),o=z(),M(i.$$.fragment)},m(s,a){B(e,s,a),$(s,r,a),B(t,s,a),$(s,o,a),B(i,s,a),l=!0},p(s,a){const u={};a[1]&32&&(u.$$scope={dirty:a,ctx:s}),e.$set(u);const c={};a[1]&32&&(c.$$scope={dirty:a,ctx:s}),t.$set(c)},i(s){l||(_(e.$$.fragment,s),_(t.$$.fragment,s),_(i.$$.fragment,s),l=!0)},o(s){w(e.$$.fragment,s),w(t.$$.fragment,s),w(i.$$.fragment,s),l=!1},d(s){s&&(k(r),k(o)),E(e,s),E(t,s),E(i,s)}}}function ys(n){let e,r,t,o;return e=new Fe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new tt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){M(e.$$.fragment),r=z(),M(t.$$.fragment)},m(i,l){B(e,i,l),$(i,r,l),B(t,i,l),o=!0},p:Y,i(i){o||(_(e.$$.fragment,i),_(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&k(r),E(e,i),E(t,i)}}}function As(n){let e,r,t,o,i,l,s,a,u;e=new Ft({}),e.$on("click",n[8]);let c=n[0].mode!="editing"&&xn(n),f=ee(n[5].jats[n[1]].properties[n[2]].arms),d=[];for(let v=0;v<f.length;v+=1)d[v]=er(Yn(n,f,v));const m=v=>w(d[v],1,1,()=>{d[v]=null});let p=ee(n[5].jats[n[1]].properties[n[2]].movements),j=[];for(let v=0;v<p.length;v+=1)j[v]=tr(Vn(n,p,v));const L=v=>w(j[v],1,1,()=>{j[v]=null});return l=new Ce({props:{data:n[10](n[5]),$$slots:{default:[vs]},$$scope:{ctx:n}}}),a=new Ce({props:{data:n[6],$$slots:{default:[ys]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=z(),c&&c.c(),t=z();for(let v=0;v<d.length;v+=1)d[v].c();o=z();for(let v=0;v<j.length;v+=1)j[v].c();i=z(),M(l.$$.fragment),s=z(),M(a.$$.fragment)},m(v,A){B(e,v,A),$(v,r,A),c&&c.m(v,A),$(v,t,A);for(let O=0;O<d.length;O+=1)d[O]&&d[O].m(v,A);$(v,o,A);for(let O=0;O<j.length;O+=1)j[O]&&j[O].m(v,A);$(v,i,A),B(l,v,A),$(v,s,A),B(a,v,A),u=!0},p(v,A){if(v[0].mode!="editing"?c?c.p(v,A):(c=xn(v),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),A[0]&46){f=ee(v[5].jats[v[1]].properties[v[2]].arms);let C;for(C=0;C<f.length;C+=1){const y=Yn(v,f,C);d[C]?(d[C].p(y,A),_(d[C],1)):(d[C]=er(y),d[C].c(),_(d[C],1),d[C].m(o.parentNode,o))}for(fe(),C=f.length;C<d.length;C+=1)m(C);de()}if(A[0]&174){p=ee(v[5].jats[v[1]].properties[v[2]].movements);let C;for(C=0;C<p.length;C+=1){const y=Vn(v,p,C);j[C]?(j[C].p(y,A),_(j[C],1)):(j[C]=tr(y),j[C].c(),_(j[C],1),j[C].m(i.parentNode,i))}for(fe(),C=p.length;C<j.length;C+=1)L(C);de()}const O={};A[0]&32&&(O.data=v[10](v[5])),A[1]&32&&(O.$$scope={dirty:A,ctx:v}),l.$set(O);const b={};A[0]&64&&(b.data=v[6]),A[1]&32&&(b.$$scope={dirty:A,ctx:v}),a.$set(b)},i(v){if(!u){_(e.$$.fragment,v);for(let A=0;A<f.length;A+=1)_(d[A]);for(let A=0;A<p.length;A+=1)_(j[A]);_(l.$$.fragment,v),_(a.$$.fragment,v),u=!0}},o(v){w(e.$$.fragment,v),d=d.filter(Boolean);for(let A=0;A<d.length;A+=1)w(d[A]);j=j.filter(Boolean);for(let A=0;A<j.length;A+=1)w(j[A]);w(l.$$.fragment,v),w(a.$$.fragment,v),u=!1},d(v){v&&(k(r),k(t),k(o),k(i),k(s)),E(e,v),c&&c.d(v),be(d,v),be(j,v),E(l,v),E(a,v)}}}function Cs(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function js(n){return String.fromCharCode(n+"A".charCodeAt(0))}function Ss(n,e,r){let t,o,i;oe(n,Q,U=>r(5,o=U)),oe(n,Dt,U=>r(26,i=U));let{junctionIdx:l}=e,{stage:s}=e,{mode:a}=e,{hoveringSidebar:u}=e,{select:c}=e,{stopEditing:f}=e,d={0:Xe.red.background,1:Xe.amber.background,2:Xe.green.background,X:Xe.critical.background};function m(U,Z,$e){let he={type:"FeatureCollection",features:[]},q=Z.mode=="editing"?Z.id:$e;return q!=null&&(q.kind=="arm"?he.features.push(Cs(U.jats[l].properties[s].arms[q.idx],q.idx)):he.features.push(v(U.jats[l].properties[s].movements[q.idx],q.idx))),he}async function p(U){if(i){for(let Z of i.queryRenderedFeatures(U.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a.mode!="select"){if(a.mode=="editing"){await f();return}a.mode=="new-arm"?(W(Q,o.jats[l].properties[s].arms=[...o.jats[l].properties[s].arms,{point:U.detail.lngLat.toArray(),name:""}],o),await c({kind:"arm",idx:o.jats[l].properties[s].arms.length-1})):(W(Q,o.jats[l].properties[s].movements=[...o.jats[l].properties[s].movements,{point1:U.detail.lngLat.toArray(),point2:kt(U.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:kt(U.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await c({kind:"movement",idx:o.jats[l].properties[s].movements.length-1}))}}}async function j(U){await c({kind:"movement",idx:U.detail.features[0].id})}function L(U){let Z={type:"FeatureCollection",features:U.jats[l].properties[s].movements.map(($e,he)=>v($e,he))};for(let $e of U.jats[l].properties[s].movements)if(Z.features.push(A($e,Z.features.length)),$e.kind=="walking & wheeling"){let he={...$e,point1:$e.point3,point3:$e.point1};Z.features.push(A(he,Z.features.length))}return Z}function v(U,Z){return{type:"Feature",id:Z,properties:{name:U.name,kind:U.kind,color:d[U.score]},geometry:{type:"LineString",coordinates:[U.point1,U.point2,U.point3]}}}function A(U,Z){return{type:"Feature",id:Z,properties:{kind:U.kind,color:d[U.score],angle:st(U.point2,U.point3)},geometry:{type:"Point",coordinates:U.point3}}}const O=()=>r(0,a={mode:"new-arm"}),b=()=>r(0,a={mode:"new-movement"});function C(U,Z){n.$$.not_equal(Z.point,U)&&(Z.point=U,Q.set(o))}const y=U=>c({kind:"arm",idx:U}),S=U=>c({kind:"arm",idx:U});function D(U,Z){n.$$.not_equal(Z.point1,U)&&(Z.point1=U,Q.set(o))}const I=U=>c({kind:"movement",idx:U}),K=U=>c({kind:"movement",idx:U});function V(U,Z){n.$$.not_equal(Z.point2,U)&&(Z.point2=U,Q.set(o))}const T=U=>c({kind:"movement",idx:U}),J=U=>c({kind:"movement",idx:U});function N(U,Z){n.$$.not_equal(Z.point3,U)&&(Z.point3=U,Q.set(o))}const ge=U=>c({kind:"movement",idx:U}),_e=U=>c({kind:"movement",idx:U});return n.$$set=U=>{"junctionIdx"in U&&r(1,l=U.junctionIdx),"stage"in U&&r(2,s=U.stage),"mode"in U&&r(0,a=U.mode),"hoveringSidebar"in U&&r(11,u=U.hoveringSidebar),"select"in U&&r(3,c=U.select),"stopEditing"in U&&r(4,f=U.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&2081&&r(6,t=m(o,a,u))},[a,l,s,c,f,o,t,d,p,j,L,u,O,b,C,y,S,D,I,K,V,T,J,N,ge,_e]}class zs extends ae{constructor(e){super(),ce(this,e,Ss,As,le,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:11,select:3,stopEditing:4},null,[-1,-1])}}function nr(n){if(n.movements.length==0)return"No movements added";let e=0,r=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],r+=2;let t=e/r*100;return`${Math.round(t)}%`}const{window:Ls}=ct;function rr(n,e,r){const t=n.slice();t[27]=e[r],t[30]=r;const o=t[14][t[27].score];return t[28]=o,t}function or(n,e,r){const t=n.slice();return t[31]=e[r],t[30]=r,t}function Ms(n){let e,r,t,o,i,l,s,a,u;return{c(){e=h("button"),e.textContent="Done",r=z(),t=h("button"),t.textContent="Delete",o=z(),i=h("label"),l=F(`Arm name
        `),s=h("input"),P(s,"type","text")},m(c,f){$(c,e,f),$(c,r,f),$(c,t,f),$(c,o,f),$(c,i,f),g(i,l),g(i,s),ve(s,n[5].jats[n[0]].properties[n[1]].arms[n[2].id.idx].name),a||(u=[G(e,"click",n[23]),G(t,"click",n[10]),G(s,"input",n[24])],a=!0)},p(c,f){f[0]&39&&s.value!==c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name&&ve(s,c[5].jats[c[0]].properties[c[1]].arms[c[2].id.idx].name)},i:Y,o:Y,d(c){c&&(k(e),k(r),k(t),k(o),k(i)),a=!1,je(u)}}}function Bs(n){let e,r,t,o,i,l,s,a;return e=new Pl({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),{c(){M(e.$$.fragment),r=z(),t=h("button"),t.textContent="Save",o=z(),i=h("button"),i.textContent="Delete"},m(u,c){B(e,u,c),$(u,r,c),$(u,t,c),$(u,o,c),$(u,i,c),l=!0,s||(a=[G(t,"click",n[9]),G(i,"click",n[10])],s=!0)},p(u,c){const f={};c[0]&1&&(f.junctionIdx=u[0]),c[0]&2&&(f.stage=u[1]),c[0]&4&&(f.idx=u[2].id.idx),e.$set(f)},i(u){l||(_(e.$$.fragment,u),l=!0)},o(u){w(e.$$.fragment,u),l=!1},d(u){u&&(k(r),k(t),k(o),k(i)),E(e,u),s=!1,je(a)}}}function Es(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p=n[5].jats[n[0]].properties.name+"",j,L,v=nr(n[5].jats[n[0]].properties[n[1]])+"",A,O,b,C,y,S,D,I,K,V,T,J=ee(n[5].jats[n[0]].properties[n[1]].arms),N=[];for(let q=0;q<J.length;q+=1)N[q]=ir(or(n,J,q));const ge=q=>w(N[q],1,1,()=>{N[q]=null});let _e=n[5].jats[n[0]].properties[n[7]].arms.length>0&&lr(n),U=ee(n[5].jats[n[0]].properties[n[1]].movements),Z=[];for(let q=0;q<U.length;q+=1)Z[q]=sr(rr(n,U,q));const $e=q=>w(Z[q],1,1,()=>{Z[q]=null});let he=n[5].jats[n[0]].properties[n[7]].movements.length>0&&ar(n);return{c(){e=h("button"),e.textContent="Done",r=z(),t=h("h3"),t.textContent="Arms",o=z();for(let q=0;q<N.length;q+=1)N[q].c();i=z(),_e&&_e.c(),l=z(),s=h("h3"),s.textContent="Movements",a=z(),u=h("p"),c=F("Total JAT score for "),f=F(n[1]),d=F(` junction
        `),m=h("i"),j=F(p),L=F(`
        : `),A=F(v),O=z(),b=h("button"),C=F("Generate cycling movements between all arms"),S=z();for(let q=0;q<Z.length;q+=1)Z[q].c();D=z(),he&&he.c(),I=Qe(),P(b,"class","secondary"),b.disabled=y=n[5].jats[n[0]].properties[n[1]].arms.length<2},m(q,ne){$(q,e,ne),$(q,r,ne),$(q,t,ne),$(q,o,ne);for(let re=0;re<N.length;re+=1)N[re]&&N[re].m(q,ne);$(q,i,ne),_e&&_e.m(q,ne),$(q,l,ne),$(q,s,ne),$(q,a,ne),$(q,u,ne),g(u,c),g(u,f),g(u,d),g(u,m),g(m,j),g(u,L),g(u,A),$(q,O,ne),$(q,b,ne),g(b,C),$(q,S,ne);for(let re=0;re<Z.length;re+=1)Z[re]&&Z[re].m(q,ne);$(q,D,ne),he&&he.m(q,ne),$(q,I,ne),K=!0,V||(T=[G(e,"click",n[16]),G(b,"click",n[15])],V=!0)},p(q,ne){if(ne[0]&299){J=ee(q[5].jats[q[0]].properties[q[1]].arms);let re;for(re=0;re<J.length;re+=1){const Ue=or(q,J,re);N[re]?(N[re].p(Ue,ne),_(N[re],1)):(N[re]=ir(Ue),N[re].c(),_(N[re],1),N[re].m(i.parentNode,i))}for(fe(),re=J.length;re<N.length;re+=1)ge(re);de()}if(q[5].jats[q[0]].properties[q[7]].arms.length>0?_e?_e.p(q,ne):(_e=lr(q),_e.c(),_e.m(l.parentNode,l)):_e&&(_e.d(1),_e=null),(!K||ne[0]&2)&&ie(f,q[1]),(!K||ne[0]&33)&&p!==(p=q[5].jats[q[0]].properties.name+"")&&ie(j,p),(!K||ne[0]&35)&&v!==(v=nr(q[5].jats[q[0]].properties[q[1]])+"")&&ie(A,v),(!K||ne[0]&35&&y!==(y=q[5].jats[q[0]].properties[q[1]].arms.length<2))&&(b.disabled=y),ne[0]&16683){U=ee(q[5].jats[q[0]].properties[q[1]].movements);let re;for(re=0;re<U.length;re+=1){const Ue=rr(q,U,re);Z[re]?(Z[re].p(Ue,ne),_(Z[re],1)):(Z[re]=sr(Ue),Z[re].c(),_(Z[re],1),Z[re].m(D.parentNode,D))}for(fe(),re=U.length;re<Z.length;re+=1)$e(re);de()}q[5].jats[q[0]].properties[q[7]].movements.length>0?he?he.p(q,ne):(he=ar(q),he.c(),he.m(I.parentNode,I)):he&&(he.d(1),he=null)},i(q){if(!K){for(let ne=0;ne<J.length;ne+=1)_(N[ne]);for(let ne=0;ne<U.length;ne+=1)_(Z[ne]);K=!0}},o(q){N=N.filter(Boolean);for(let ne=0;ne<N.length;ne+=1)w(N[ne]);Z=Z.filter(Boolean);for(let ne=0;ne<Z.length;ne+=1)w(Z[ne]);K=!1},d(q){q&&(k(e),k(r),k(t),k(o),k(i),k(l),k(s),k(a),k(u),k(O),k(b),k(S),k(D),k(I)),be(N,q),_e&&_e.d(q),be(Z,q),he&&he.d(q),V=!1,je(T)}}}function ir(n){let e,r;function t(){return n[17](n[30])}function o(){return n[18](n[30])}return e=new Xr({props:{name:`${cr(n[30])} - ${n[31].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[19]),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0},p(i,l){n=i;const s={};l[0]&35&&(s.name=`${cr(n[30])} - ${n[31].name||"Unnamed arm"}`),e.$set(s)},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){E(e,i)}}}function lr(n){let e,r,t;return{c(){e=h("button"),e.textContent=`Copy arms from ${n[7]}`,P(e,"class","secondary")},m(o,i){$(o,e,i),r||(t=G(e,"click",n[12]),r=!0)},p:Y,d(o){o&&k(e),r=!1,t()}}}function Ts(n){let e,r,t,o=n[27].score+"",i,l,s,a=ur(n[27].kind)+"",u;return{c(){e=h("div"),r=h("span"),t=F("Score: "),i=F(o),l=z(),s=h("span"),u=F(a),x(r,"padding","4px"),x(r,"color",n[28].font),x(r,"background-color",n[28].background),x(e,"width","100%"),x(e,"display","flex"),x(e,"justify-content","space-between")},m(c,f){$(c,e,f),g(e,r),g(r,t),g(r,i),g(e,l),g(e,s),g(s,u)},p(c,f){f[0]&35&&o!==(o=c[27].score+"")&&ie(i,o),f[0]&35&&x(r,"color",c[28].font),f[0]&35&&x(r,"background-color",c[28].background),f[0]&35&&a!==(a=ur(c[27].kind)+"")&&ie(u,a)},d(c){c&&k(e)}}}function sr(n){let e,r;function t(){return n[20](n[30])}function o(){return n[21](n[30])}return e=new Xr({props:{name:n[27].name||"Unnamed movement",$$slots:{default:[Ts]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[22]),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0},p(i,l){n=i;const s={};l[0]&35&&(s.name=n[27].name||"Unnamed movement"),l[0]&35|l[1]&4&&(s.$$scope={dirty:l,ctx:n}),e.$set(s)},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){E(e,i)}}}function ar(n){let e,r,t;return{c(){e=h("button"),e.textContent=`Copy movements from ${n[7]}`,P(e,"class","secondary")},m(o,i){$(o,e,i),r||(t=G(e,"click",n[13]),r=!0)},p:Y,d(o){o&&k(e),r=!1,t()}}}function Ds(n){let e,r,t,o,i=n[5].jats[n[0]].properties.name+"",l,s,a,u,c;const f=[Es,Bs,Ms],d=[];function m(p,j){return p[2].mode!="editing"?0:p[2].id.kind=="movement"?1:2}return a=m(n),u=d[a]=f[a](n),{c(){e=h("div"),r=h("h2"),t=F(n[1]),o=F(" JAT for "),l=F(i),s=z(),u.c(),P(e,"slot","sidebar")},m(p,j){$(p,e,j),g(e,r),g(r,t),g(r,o),g(r,l),g(e,s),d[a].m(e,null),n[25](e),c=!0},p(p,j){(!c||j[0]&2)&&ie(t,p[1]),(!c||j[0]&33)&&i!==(i=p[5].jats[p[0]].properties.name+"")&&ie(l,i);let L=a;a=m(p),a===L?d[a].p(p,j):(fe(),w(d[L],1,1,()=>{d[L]=null}),de(),u=d[a],u?u.p(p,j):(u=d[a]=f[a](p),u.c()),_(u,1),u.m(e,null))},i(p){c||(_(u),c=!0)},o(p){w(u),c=!1},d(p){p&&k(e),d[a].d(),n[25](null)}}}function Ns(n){let e,r;return e=new tt({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o[0]&1&&(i.filter=["!=",["id"],t[0]]),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Is(n){let e,r,t,o,i,l,s;return r=new Ye({props:{except:"jats"}}),o=new Ce({props:{data:pe(n[5].jats),generateId:!0,$$slots:{default:[Ns]},$$scope:{ctx:n}}}),l=new zs({props:{junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],select:n[8],stopEditing:n[9]}}),{c(){e=h("div"),M(r.$$.fragment),t=z(),M(o.$$.fragment),i=z(),M(l.$$.fragment),P(e,"slot","map")},m(a,u){$(a,e,u),B(r,e,null),g(e,t),B(o,e,null),g(e,i),B(l,e,null),s=!0},p(a,u){const c={};u[0]&32&&(c.data=pe(a[5].jats)),u[0]&1|u[1]&4&&(c.$$scope={dirty:u,ctx:a}),o.$set(c);const f={};u[0]&1&&(f.junctionIdx=a[0]),u[0]&2&&(f.stage=a[1]),u[0]&4&&(f.mode=a[2]),u[0]&8&&(f.hoveringSidebar=a[3]),l.$set(f)},i(a){s||(_(r.$$.fragment,a),_(o.$$.fragment,a),_(l.$$.fragment,a),s=!0)},o(a){w(r.$$.fragment,a),w(o.$$.fragment,a),w(l.$$.fragment,a),s=!1},d(a){a&&k(e),E(r),E(o),E(l)}}}function Os(n){let e,r,t,o;return e=new He({props:{$$slots:{map:[Is],sidebar:[Ds]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=G(Ls,"keydown",n[11]),t=!0)},p(i,l){const s={};l[0]&127|l[1]&4&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function cr(n){return String.fromCharCode(n+"A".charCodeAt(0))}function ur(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function Fs(n,e,r){let t,o;oe(n,Q,N=>r(5,t=N)),oe(n,X,N=>r(6,o=N));let{junctionIdx:i}=e,{stage:l}=e,s=l=="existing"?"proposed":"existing",a={mode:"select"},u=null,c=null,f;async function d(N){u=f.scrollTop,r(2,a={mode:"editing",id:N}),r(3,c=null),await et(),r(4,f.scrollTop=0,f)}async function m(){r(2,a={mode:"select"}),u!=null&&(await et(),r(4,f.scrollTop=u,f),u=null)}function p(){a.mode=="editing"&&window.confirm(`Delete this ${a.id.kind}?`)&&(a.id.kind=="movement"?(t.jats[i].properties[l].movements.splice(a.id.idx,1),Q.set(t)):(t.jats[i].properties[l].arms.splice(a.id.idx,1),Q.set(t)),m())}function j(N){if(a.mode!="editing")return;let ge=N.target.tagName,_e=ge=="INPUT"||ge=="TEXTAREA";N.key=="Escape"||N.key=="Enter"&&!_e?(N.stopPropagation(),m()):N.key=="Delete"&&!_e&&(N.stopPropagation(),p())}function L(){t.jats[i].properties[l].arms.length>0&&!window.confirm("Overwrite arms?")||(W(Q,t.jats[i].properties[l].arms=JSON.parse(JSON.stringify(t.jats[i].properties[s].arms)),t),Q.set(t))}function v(){t.jats[i].properties[l].movements.length>0&&!window.confirm("Overwrite movements?")||(W(Q,t.jats[i].properties[l].movements=JSON.parse(JSON.stringify(t.jats[i].properties[s].movements)),t),Q.set(t))}let A={0:Xe.red,1:Xe.amber,2:Xe.green,X:Xe.critical};function O(){if(t.jats[i].properties[l].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let N=t.jats[i].properties[l].movements.filter(ge=>ge.kind=="walking & wheeling");W(Q,t.jats[i].properties[l].movements=[...N,...rs(t.jats[i].properties[l].arms)],t)}const b=()=>W(X,o={kind:"edit-jat",idx:i},o),C=N=>d({kind:"arm",idx:N}),y=N=>r(3,c={kind:"arm",idx:N}),S=()=>r(3,c=null),D=N=>d({kind:"movement",idx:N}),I=N=>r(3,c={kind:"movement",idx:N}),K=()=>r(3,c=null),V=()=>r(2,a={mode:"select"});function T(){t.jats[i].properties[l].arms[a.id.idx].name=this.value,Q.set(t)}function J(N){me[N?"unshift":"push"](()=>{f=N,r(4,f)})}return n.$$set=N=>{"junctionIdx"in N&&r(0,i=N.junctionIdx),"stage"in N&&r(1,l=N.stage)},[i,l,a,c,f,t,o,s,d,m,p,j,L,v,A,O,b,C,y,S,D,I,K,V,T,J]}class Us extends ae{constructor(e){super(),ce(this,e,Fs,Os,le,{junctionIdx:0,stage:1},null,[-1,-1])}}const{window:Ps}=ct;function qs(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p;return{c(){e=h("div"),r=h("button"),r.textContent="Done",t=z(),o=h("button"),o.textContent="Delete JAT",i=z(),l=h("label"),s=F(`Name:
      `),a=h("input"),u=z(),c=h("button"),c.textContent="Existing",f=z(),d=h("button"),d.textContent="Proposed",P(a,"type","text"),P(e,"slot","sidebar")},m(j,L){$(j,e,L),g(e,r),g(e,t),g(e,o),g(e,i),g(e,l),g(l,s),g(l,a),ve(a,n[1].jats[n[0]].properties.name),g(e,u),g(e,c),g(e,f),g(e,d),m||(p=[G(r,"click",n[6]),G(o,"click",n[4]),G(a,"input",n[7]),G(c,"click",n[8]),G(d,"click",n[9])],m=!0)},p(j,L){L&3&&a.value!==j[1].jats[j[0]].properties.name&&ve(a,j[1].jats[j[0]].properties.name)},d(j){j&&k(e),m=!1,je(p)}}}function Rs(n){let e,r;return e=new tt({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.filter=["!=",["id"],t[0]]),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Gs(n){let e,r,t,o,i,l,s,a;r=new Ye({props:{except:"jats"}}),o=new Ce({props:{data:pe(n[1].jats),generateId:!0,$$slots:{default:[Rs]},$$scope:{ctx:n}}});function u(f){n[5](f)}let c={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(c.lngLat=n[1].jats[n[0]].geometry.coordinates),l=new Vt({props:c}),me.push(()=>ke(l,"lngLat",u)),{c(){e=h("div"),M(r.$$.fragment),t=z(),M(o.$$.fragment),i=z(),M(l.$$.fragment),P(e,"slot","map")},m(f,d){$(f,e,d),B(r,e,null),g(e,t),B(o,e,null),g(e,i),B(l,e,null),a=!0},p(f,d){const m={};d&2&&(m.data=pe(f[1].jats)),d&1025&&(m.$$scope={dirty:d,ctx:f}),o.$set(m);const p={};d&3&&(p.color=f[1].jats[f[0]].properties.color),!s&&d&3&&(s=!0,p.lngLat=f[1].jats[f[0]].geometry.coordinates,we(()=>s=!1)),l.$set(p)},i(f){a||(_(r.$$.fragment,f),_(o.$$.fragment,f),_(l.$$.fragment,f),a=!0)},o(f){w(r.$$.fragment,f),w(o.$$.fragment,f),w(l.$$.fragment,f),a=!1},d(f){f&&k(e),E(r),E(o),E(l)}}}function Js(n){let e,r,t,o;return e=new He({props:{$$slots:{map:[Gs],sidebar:[qs]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=G(Ps,"keydown",n[3]),t=!0)},p(i,[l]){const s={};l&1031&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function Qs(n,e,r){let t,o;oe(n,Q,m=>r(1,t=m)),oe(n,X,m=>r(2,o=m));let{idx:i}=e;function l(m){m.key=="Escape"&&W(X,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this JAT?")&&(W(X,o={kind:"neutral"},o),await et(),t.jats.splice(i,1),Q.set(t))}function a(m){n.$$.not_equal(t.jats[i].geometry.coordinates,m)&&(t.jats[i].geometry.coordinates=m,Q.set(t))}const u=()=>W(X,o={kind:"neutral"},o);function c(){t.jats[i].properties.name=this.value,Q.set(t)}const f=()=>W(X,o={kind:"edit-jat-detail",idx:i,stage:"existing"},o),d=()=>W(X,o={kind:"edit-jat-detail",idx:i,stage:"proposed"},o);return n.$$set=m=>{"idx"in m&&r(0,i=m.idx)},[i,t,o,l,s,a,u,c,f,d]}class Hs extends ae{constructor(e){super(),ce(this,e,Qs,Js,le,{idx:0})}}function fr(n,e,r){const t=n.slice();return t[3]=e[r],t[4]=e,t[5]=r,t}function Ks(n){let e,r;return{c(){e=h("span"),r=z(),P(e,"class","dot svelte-jgyhla")},m(t,o){$(t,e,o),$(t,r,o)},p:Y,d(t){t&&(k(e),k(r))}}}function dr(n){let e,r,t;function o(l){n[2](l,n[3],n[4],n[5])}let i={draggable:!0,$$slots:{default:[Ks]},$$scope:{ctx:n}};return n[3]!==void 0&&(i.lngLat=n[3]),e=new Ve({props:i}),me.push(()=>ke(e,"lngLat",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,s){n=l;const a={};s&64&&(a.$$scope={dirty:s,ctx:n}),!r&&s&1&&(r=!0,a.lngLat=n[3],we(()=>r=!1)),e.$set(a)},i(l){t||(_(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Ws(n){let e,r,t,o;e=new Ft({}),e.$on("click",n[1]);let i=ee(n[0].geometry.coordinates),l=[];for(let a=0;a<i.length;a+=1)l[a]=dr(fr(n,i,a));const s=a=>w(l[a],1,1,()=>{l[a]=null});return{c(){M(e.$$.fragment),r=z();for(let a=0;a<l.length;a+=1)l[a].c();t=Qe()},m(a,u){B(e,a,u),$(a,r,u);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(a,u);$(a,t,u),o=!0},p(a,[u]){if(u&1){i=ee(a[0].geometry.coordinates);let c;for(c=0;c<i.length;c+=1){const f=fr(a,i,c);l[c]?(l[c].p(f,u),_(l[c],1)):(l[c]=dr(f),l[c].c(),_(l[c],1),l[c].m(t.parentNode,t))}for(fe(),c=i.length;c<l.length;c+=1)s(c);de()}},i(a){if(!o){_(e.$$.fragment,a);for(let u=0;u<i.length;u+=1)_(l[u]);o=!0}},o(a){w(e.$$.fragment,a),l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)w(l[u]);o=!1},d(a){a&&(k(r),k(t)),E(e,a),be(l,a)}}}function Zs(n,e,r){let{f:t}=e;function o(l){t.geometry.coordinates.push(l.detail.lngLat.toArray()),r(0,t)}function i(l,s,a,u){a[u]=l,r(0,t)}return n.$$set=l=>{"f"in l&&r(0,t=l.f)},[t,o,i]}class xr extends ae{constructor(e){super(),ce(this,e,Zs,Ws,le,{f:0})}}const{window:Xs}=ct;function pr(n,e,r){const t=n.slice();return t[13]=e[r],t[14]=e,t[15]=r,t}function mr(n){let e;return{c(){e=h("p"),e.textContent="A link needs at least two points"},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function Vs(n){let e,r,t;function o(){return n[10](n[13])}return{c(){e=h("button"),e.textContent="?",P(e,"class","outline")},m(i,l){$(i,e,l),r||(t=G(e,"click",o),r=!0)},p(i,l){n=i},d(i){i&&k(e),r=!1,t()}}}function Ys(n){let e=n[13].name+"",r,t,o=n[13].description+"",i,l,s,a=at[n[13].name]&&Vs(n);return{c(){r=F(e),t=F(": "),i=F(o),l=z(),a&&a.c(),s=z()},m(u,c){$(u,r,c),$(u,t,c),$(u,i,c),$(u,l,c),a&&a.m(u,c),$(u,s,c)},p(u,c){at[u[13].name]&&a.p(u,c)},d(u){u&&(k(r),k(t),k(i),k(l),k(s)),a&&a.d(u)}}}function gr(n){let e,r,t;function o(l){n[11](l,n[15])}let i={k:"horiz-radio",choices:n[13].choices,$$slots:{default:[Ys]},$$scope:{ctx:n}};return n[1].links[n[0]].properties.answers[n[15]]!==void 0&&(i.value=n[1].links[n[0]].properties.answers[n[15]]),e=new We({props:i}),me.push(()=>ke(e,"value",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,s){n=l;const a={};s&65540&&(a.$$scope={dirty:s,ctx:n}),!r&&s&3&&(r=!0,a.value=n[1].links[n[0]].properties.answers[n[15]],we(()=>r=!1)),e.$set(a)},i(l){t||(_(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function xs(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p,j,L=!n[3]&&mr(),v=ee(Le),A=[];for(let b=0;b<v.length;b+=1)A[b]=gr(pr(n,v,b));const O=b=>w(A[b],1,1,()=>{A[b]=null});return{c(){e=h("div"),r=h("button"),t=F("Done"),i=z(),l=h("button"),l.textContent="Delete link",s=z(),L&&L.c(),a=z(),u=h("label"),c=F(`Name:
      `),f=h("input"),d=z();for(let b=0;b<A.length;b+=1)A[b].c();r.disabled=o=!n[3],P(f,"type","text"),P(e,"slot","sidebar")},m(b,C){$(b,e,C),g(e,r),g(r,t),g(e,i),g(e,l),g(e,s),L&&L.m(e,null),g(e,a),g(e,u),g(u,c),g(u,f),ve(f,n[1].links[n[0]].properties.name),g(e,d);for(let y=0;y<A.length;y+=1)A[y]&&A[y].m(e,null);m=!0,p||(j=[G(r,"click",n[8]),G(l,"click",n[6]),G(f,"input",n[9])],p=!0)},p(b,C){if((!m||C&8&&o!==(o=!b[3]))&&(r.disabled=o),b[3]?L&&(L.d(1),L=null):L||(L=mr(),L.c(),L.m(e,a)),C&3&&f.value!==b[1].links[b[0]].properties.name&&ve(f,b[1].links[b[0]].properties.name),C&7){v=ee(Le);let y;for(y=0;y<v.length;y+=1){const S=pr(b,v,y);A[y]?(A[y].p(S,C),_(A[y],1)):(A[y]=gr(S),A[y].c(),_(A[y],1),A[y].m(e,null))}for(fe(),y=v.length;y<A.length;y+=1)O(y);de()}},i(b){if(!m){for(let C=0;C<v.length;C+=1)_(A[C]);m=!0}},o(b){A=A.filter(Boolean);for(let C=0;C<A.length;C+=1)w(A[C]);m=!1},d(b){b&&k(e),L&&L.d(),be(A,b),p=!1,je(j)}}}function ea(n){let e,r;return e=new Fe({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ta(n){let e,r,t,o,i,l,s,a;r=new Ye({props:{except:"links"}}),o=new Ce({props:{data:pe(n[1].links),generateId:!0,$$slots:{default:[ea]},$$scope:{ctx:n}}});function u(f){n[7](f)}let c={};return n[1].links[n[0]]!==void 0&&(c.f=n[1].links[n[0]]),l=new xr({props:c}),me.push(()=>ke(l,"f",u)),{c(){e=h("div"),M(r.$$.fragment),t=z(),M(o.$$.fragment),i=z(),M(l.$$.fragment),P(e,"slot","map")},m(f,d){$(f,e,d),B(r,e,null),g(e,t),B(o,e,null),g(e,i),B(l,e,null),a=!0},p(f,d){const m={};d&2&&(m.data=pe(f[1].links)),d&65537&&(m.$$scope={dirty:d,ctx:f}),o.$set(m);const p={};!s&&d&3&&(s=!0,p.f=f[1].links[f[0]],we(()=>s=!1)),l.$set(p)},i(f){a||(_(r.$$.fragment,f),_(o.$$.fragment,f),_(l.$$.fragment,f),a=!0)},o(f){w(r.$$.fragment,f),w(o.$$.fragment,f),w(l.$$.fragment,f),a=!1},d(f){f&&k(e),E(r),E(o),E(l)}}}function _r(n){let e,r;return e=new Ut({props:{$$slots:{default:[na]},$$scope:{ctx:n}}}),e.$on("close",n[12]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&65540&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function na(n){let e,r=n[2].description+"",t,o,i,l;return i=new Pt({props:{metric:n[2]}}),{c(){e=h("p"),t=F(r),o=z(),M(i.$$.fragment)},m(s,a){$(s,e,a),g(e,t),$(s,o,a),B(i,s,a),l=!0},p(s,a){(!l||a&4)&&r!==(r=s[2].description+"")&&ie(t,r);const u={};a&4&&(u.metric=s[2]),i.$set(u)},i(s){l||(_(i.$$.fragment,s),l=!0)},o(s){w(i.$$.fragment,s),l=!1},d(s){s&&(k(e),k(o)),E(i,s)}}}function ra(n){let e,r,t,o,i,l;e=new He({props:{$$slots:{map:[ta],sidebar:[xs]},$$scope:{ctx:n}}});let s=n[2]&&_r(n);return{c(){M(e.$$.fragment),r=z(),s&&s.c(),t=Qe()},m(a,u){B(e,a,u),$(a,r,u),s&&s.m(a,u),$(a,t,u),o=!0,i||(l=G(Xs,"keydown",n[5]),i=!0)},p(a,[u]){const c={};u&65567&&(c.$$scope={dirty:u,ctx:a}),e.$set(c),a[2]?s?(s.p(a,u),u&4&&_(s,1)):(s=_r(a),s.c(),_(s,1),s.m(t.parentNode,t)):s&&(fe(),w(s,1,1,()=>{s=null}),de())},i(a){o||(_(e.$$.fragment,a),_(s),o=!0)},o(a){w(e.$$.fragment,a),w(s),o=!1},d(a){a&&(k(r),k(t)),E(e,a),s&&s.d(a),i=!1,l()}}}function oa(n,e,r){let t,o,i;oe(n,Q,L=>r(1,o=L)),oe(n,X,L=>r(4,i=L));let{idx:l}=e,s=null;function a(L){L.key=="Escape"&&t&&W(X,i={kind:"neutral"},i)}async function u(){window.confirm("Really delete this link?")&&(W(X,i={kind:"neutral"},i),await et(),o.links.splice(l,1),Q.set(o))}function c(L){n.$$.not_equal(o.links[l],L)&&(o.links[l]=L,Q.set(o))}const f=()=>W(X,i={kind:"neutral"},i);function d(){o.links[l].properties.name=this.value,Q.set(o)}const m=L=>r(2,s=at[L.name]);function p(L,v){n.$$.not_equal(o.links[l].properties.answers[v],L)&&(o.links[l].properties.answers[v]=L,Q.set(o))}const j=()=>r(2,s=null);return n.$$set=L=>{"idx"in L&&r(0,l=L.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(3,t=o.links[l].geometry.coordinates.length>=2)},[l,o,s,t,i,a,u,c,f,d,m,p,j]}class ia extends ae{constructor(e){super(),ce(this,e,oa,ra,le,{idx:0})}}function hr(n,e,r){const t=n.slice();return t[7]=e[r],t[8]=e,t[9]=r,t}function la(n){let e;return{c(){e=h("p"),e.textContent=`${n[3].description}`},m(r,t){$(r,e,t)},p:Y,d(r){r&&k(e)}}}function br(n){let e,r,t=n[7].properties.name+"",o,i,l,s,a,u;function c(d){n[6](d,n[7])}let f={k:"horiz-radio",choices:Le[n[0]].choices};return n[7].properties.answers[n[0]]!==void 0&&(f.value=n[7].properties.answers[n[0]]),l=new We({props:f}),me.push(()=>ke(l,"value",c)),{c(){e=h("li"),r=h("span"),o=F(t),i=z(),M(l.$$.fragment),a=z(),x(r,"color",n[7].properties.color)},m(d,m){$(d,e,m),g(e,r),g(r,o),g(e,i),B(l,e,null),g(e,a),u=!0},p(d,m){n=d,(!u||m&4)&&t!==(t=n[7].properties.name+"")&&ie(o,t),m&4&&x(r,"color",n[7].properties.color);const p={};m&1&&(p.choices=Le[n[0]].choices),!s&&m&5&&(s=!0,p.value=n[7].properties.answers[n[0]],we(()=>s=!1)),l.$set(p)},i(d){u||(_(l.$$.fragment,d),u=!0)},o(d){w(l.$$.fragment,d),u=!1},d(d){d&&k(e),E(l)}}}function sa(n){let e,r;return e=new Pt({props:{metric:n[3]}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function aa(n){let e,r,t,o,i=Le[n[0]].name+"",l,s,a=Le[n[0]].description+"",u,c,f,d,m,p,j,L,v=n[3]&&la(n),A=ee(n[2].links),O=[];for(let y=0;y<A.length;y+=1)O[y]=br(hr(n,A,y));const b=y=>w(O[y],1,1,()=>{O[y]=null});let C=n[3]&&sa(n);return{c(){e=h("div"),r=h("button"),r.textContent="Done",t=z(),o=h("h2"),l=F(i),s=F(": "),u=F(a),c=z(),v&&v.c(),f=z(),d=h("ol");for(let y=0;y<O.length;y+=1)O[y].c();m=z(),C&&C.c(),P(e,"slot","sidebar")},m(y,S){$(y,e,S),g(e,r),g(e,t),g(e,o),g(o,l),g(o,s),g(o,u),g(e,c),v&&v.m(e,null),g(e,f),g(e,d);for(let D=0;D<O.length;D+=1)O[D]&&O[D].m(d,null);g(e,m),C&&C.m(e,null),p=!0,j||(L=G(r,"click",n[5]),j=!0)},p(y,S){if((!p||S&1)&&i!==(i=Le[y[0]].name+"")&&ie(l,i),(!p||S&1)&&a!==(a=Le[y[0]].description+"")&&ie(u,a),y[3]&&v.p(y,S),S&5){A=ee(y[2].links);let D;for(D=0;D<A.length;D+=1){const I=hr(y,A,D);O[D]?(O[D].p(I,S),_(O[D],1)):(O[D]=br(I),O[D].c(),_(O[D],1),O[D].m(d,null))}for(fe(),D=A.length;D<O.length;D+=1)b(D);de()}y[3]&&C.p(y,S)},i(y){if(!p){for(let S=0;S<A.length;S+=1)_(O[S]);_(C),p=!0}},o(y){O=O.filter(Boolean);for(let S=0;S<O.length;S+=1)w(O[S]);w(C),p=!1},d(y){y&&k(e),v&&v.d(),be(O,y),C&&C.d(),j=!1,L()}}}function ca(n){let e,r,t;return r=new Ye({props:{showLinkColor:!0,except:""}}),{c(){e=h("div"),M(r.$$.fragment),P(e,"slot","map")},m(o,i){$(o,e,i),B(r,e,null),t=!0},p:Y,i(o){t||(_(r.$$.fragment,o),t=!0)},o(o){w(r.$$.fragment,o),t=!1},d(o){o&&k(e),E(r)}}}function ua(n){let e,r,t,o;return e=new He({props:{$$slots:{map:[ca],sidebar:[aa]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=G(window,"keydown",n[4]),t=!0)},p(i,[l]){const s={};l&1031&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function fa(n,e,r){let t,o;oe(n,X,c=>r(1,t=c)),oe(n,Q,c=>r(2,o=c));let{qIdx:i}=e,l=at[Le[i].name];function s(c){c.key=="Escape"&&W(X,t={kind:"neutral"},t)}const a=()=>W(X,t={kind:"neutral"},t);function u(c,f){n.$$.not_equal(f.properties.answers[i],c)&&(f.properties.answers[i]=c,Q.set(o))}return n.$$set=c=>{"qIdx"in c&&r(0,i=c.qIdx)},[i,t,o,l,s,a,u]}class da extends ae{constructor(e){super(),ce(this,e,fa,ua,le,{qIdx:0})}}function pa(n){let e,r,t,o;const i=n[2].default,l=De(i,n,n[1],null);return{c(){e=h("a"),l&&l.c(),P(e,"href","#"),x(e,"color",n[0])},m(s,a){$(s,e,a),l&&l.m(e,null),r=!0,t||(o=G(e,"click",yo(n[3])),t=!0)},p(s,[a]){l&&l.p&&(!r||a&2)&&Ne(l,i,s,s[1],r?Oe(i,s[1],a,null):Ie(s[1]),null),a&1&&x(e,"color",s[0])},i(s){r||(_(l,s),r=!0)},o(s){w(l,s),r=!1},d(s){s&&k(e),l&&l.d(s),t=!1,o()}}}function ma(n,e,r){let{$$slots:t={},$$scope:o}=e,{color:i=void 0}=e;function l(s){Se.call(this,n,s)}return n.$$set=s=>{"color"in s&&r(0,i=s.color),"$$scope"in s&&r(1,o=s.$$scope)},[i,o,t,l]}class ut extends ae{constructor(e){super(),ce(this,e,ma,pa,le,{color:0})}}function $r(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function ga(n){let e=n[4].properties.name+"",r;return{c(){r=F(e)},m(t,o){$(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&ie(r,e)},d(t){t&&k(r)}}}function kr(n){let e,r,t,o;function i(){return n[3](n[6])}return r=new ut({props:{color:n[4].properties.color,$$slots:{default:[ga]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){e=h("li"),M(r.$$.fragment),t=z()},m(l,s){$(l,e,s),B(r,e,null),g(e,t),o=!0},p(l,s){n=l;const a={};s&2&&(a.color=n[4].properties.color),s&130&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(l){o||(_(r.$$.fragment,l),o=!0)},o(l){w(r.$$.fragment,l),o=!1},d(l){l&&k(e),E(r)}}}function _a(n){let e,r,t,o,i,l,s,a,u=ee(n[1].bus_stops),c=[];for(let d=0;d<u.length;d+=1)c[d]=kr($r(n,u,d));const f=d=>w(c[d],1,1,()=>{c[d]=null});return{c(){e=F(`Bus stops:

`),r=h("div"),t=h("button"),t.textContent="New bus stop",o=z(),i=h("ol");for(let d=0;d<c.length;d+=1)c[d].c()},m(d,m){$(d,e,m),$(d,r,m),g(r,t),$(d,o,m),$(d,i,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);l=!0,s||(a=G(t,"click",n[2]),s=!0)},p(d,[m]){if(m&3){u=ee(d[1].bus_stops);let p;for(p=0;p<u.length;p+=1){const j=$r(d,u,p);c[p]?(c[p].p(j,m),_(c[p],1)):(c[p]=kr(j),c[p].c(),_(c[p],1),c[p].m(i,null))}for(fe(),p=u.length;p<c.length;p+=1)f(p);de()}},i(d){if(!l){for(let m=0;m<u.length;m+=1)_(c[m]);l=!0}},o(d){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)w(c[m]);l=!1},d(d){d&&(k(e),k(r),k(o),k(i)),be(c,d),s=!1,a()}}}function ha(n,e,r){let t,o;return oe(n,X,s=>r(0,t=s)),oe(n,Q,s=>r(1,o=s)),[t,o,()=>W(X,t={kind:"new-point",obj:"bus stop"},t),s=>W(X,t={kind:"edit-bus-stop",idx:s},t)]}let ba=class extends ae{constructor(e){super(),ce(this,e,ha,_a,le,{})}};function wr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function $a(n){let e=n[4].properties.name+"",r;return{c(){r=F(e)},m(t,o){$(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&ie(r,e)},d(t){t&&k(r)}}}function vr(n){let e,r,t,o;function i(){return n[3](n[6])}return r=new ut({props:{color:n[4].properties.color,$$slots:{default:[$a]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){e=h("li"),M(r.$$.fragment),t=z()},m(l,s){$(l,e,s),B(r,e,null),g(e,t),o=!0},p(l,s){n=l;const a={};s&2&&(a.color=n[4].properties.color),s&130&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(l){o||(_(r.$$.fragment,l),o=!0)},o(l){w(r.$$.fragment,l),o=!1},d(l){l&&k(e),E(r)}}}function ka(n){let e,r,t,o,i,l,s,a,u=ee(n[1].crossings),c=[];for(let d=0;d<u.length;d+=1)c[d]=vr(wr(n,u,d));const f=d=>w(c[d],1,1,()=>{c[d]=null});return{c(){e=F(`Crossings:

`),r=h("div"),t=h("button"),t.textContent="New crossing",o=z(),i=h("ol");for(let d=0;d<c.length;d+=1)c[d].c()},m(d,m){$(d,e,m),$(d,r,m),g(r,t),$(d,o,m),$(d,i,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);l=!0,s||(a=G(t,"click",n[2]),s=!0)},p(d,[m]){if(m&3){u=ee(d[1].crossings);let p;for(p=0;p<u.length;p+=1){const j=wr(d,u,p);c[p]?(c[p].p(j,m),_(c[p],1)):(c[p]=vr(j),c[p].c(),_(c[p],1),c[p].m(i,null))}for(fe(),p=u.length;p<c.length;p+=1)f(p);de()}},i(d){if(!l){for(let m=0;m<u.length;m+=1)_(c[m]);l=!0}},o(d){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)w(c[m]);l=!1},d(d){d&&(k(e),k(r),k(o),k(i)),be(c,d),s=!1,a()}}}function wa(n,e,r){let t,o;return oe(n,X,s=>r(0,t=s)),oe(n,Q,s=>r(1,o=s)),[t,o,()=>W(X,t={kind:"new-point",obj:"crossing"},t),s=>W(X,t={kind:"edit-crossing",idx:s},t)]}let va=class extends ae{constructor(e){super(),ce(this,e,wa,ka,le,{})}};function yr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function ya(n){let e=n[4].properties.name+"",r;return{c(){r=F(e)},m(t,o){$(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&ie(r,e)},d(t){t&&k(r)}}}function Ar(n){let e,r,t,o;function i(){return n[3](n[6])}return r=new ut({props:{color:n[4].properties.color,$$slots:{default:[ya]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){e=h("li"),M(r.$$.fragment),t=z()},m(l,s){$(l,e,s),B(r,e,null),g(e,t),o=!0},p(l,s){n=l;const a={};s&2&&(a.color=n[4].properties.color),s&130&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(l){o||(_(r.$$.fragment,l),o=!0)},o(l){w(r.$$.fragment,l),o=!1},d(l){l&&k(e),E(r)}}}function Aa(n){let e,r,t,o,i,l,s,a,u=ee(n[1].jats),c=[];for(let d=0;d<u.length;d+=1)c[d]=Ar(yr(n,u,d));const f=d=>w(c[d],1,1,()=>{c[d]=null});return{c(){e=F(`JATs:

`),r=h("div"),t=h("button"),t.textContent="New JAT",o=z(),i=h("ol");for(let d=0;d<c.length;d+=1)c[d].c()},m(d,m){$(d,e,m),$(d,r,m),g(r,t),$(d,o,m),$(d,i,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);l=!0,s||(a=G(t,"click",n[2]),s=!0)},p(d,[m]){if(m&3){u=ee(d[1].jats);let p;for(p=0;p<u.length;p+=1){const j=yr(d,u,p);c[p]?(c[p].p(j,m),_(c[p],1)):(c[p]=Ar(j),c[p].c(),_(c[p],1),c[p].m(i,null))}for(fe(),p=u.length;p<c.length;p+=1)f(p);de()}},i(d){if(!l){for(let m=0;m<u.length;m+=1)_(c[m]);l=!0}},o(d){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)w(c[m]);l=!1},d(d){d&&(k(e),k(r),k(o),k(i)),be(c,d),s=!1,a()}}}function Ca(n,e,r){let t,o;return oe(n,X,s=>r(0,t=s)),oe(n,Q,s=>r(1,o=s)),[t,o,()=>W(X,t={kind:"new-point",obj:"jat"},t),s=>W(X,t={kind:"edit-jat",idx:s},t)]}let ja=class extends ae{constructor(e){super(),ce(this,e,Ca,Aa,le,{})}};function Cr(n,e,r){const t=n.slice();return t[2]=e[r],t[4]=r,t}function jr(n,e,r){const t=n.slice();t[5]=e[r];const o=t[5].properties.answers[t[4]];return t[6]=o,t}function Sr(n,e,r){const t=n.slice();return t[5]=e[r],t}function zr(n){let e,r=n[5].properties.name+"",t;return{c(){e=h("th"),t=F(r),x(e,"color",n[5].properties.color)},m(o,i){$(o,e,i),g(e,t)},p(o,i){i&1&&r!==(r=o[5].properties.name+"")&&ie(t,r),i&1&&x(e,"color",o[5].properties.color)},d(o){o&&k(e)}}}function Lr(n){let e,r=n[6]+"",t;return{c(){e=h("td"),t=F(r),x(e,"background",n[6]==""?"red":"green")},m(o,i){$(o,e,i),g(e,t)},p(o,i){i&1&&r!==(r=o[6]+"")&&ie(t,r),i&1&&x(e,"background",o[6]==""?"red":"green")},d(o){o&&k(e)}}}function Mr(n){let e,r,t,o,i=ee(n[0].links),l=[];for(let s=0;s<i.length;s+=1)l[s]=Lr(jr(n,i,s));return{c(){e=h("tr"),r=h("th"),r.textContent=`${n[2].name}`,t=z();for(let s=0;s<l.length;s+=1)l[s].c();o=z()},m(s,a){$(s,e,a),g(e,r),g(e,t);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);g(e,o)},p(s,a){if(a&1){i=ee(s[0].links);let u;for(u=0;u<i.length;u+=1){const c=jr(s,i,u);l[u]?l[u].p(c,a):(l[u]=Lr(c),l[u].c(),l[u].m(e,o))}for(;u<l.length;u+=1)l[u].d(1);l.length=i.length}},d(s){s&&k(e),be(l,s)}}}function Sa(n){let e,r,t,o,i,l,s,a=ee(n[0].links),u=[];for(let d=0;d<a.length;d+=1)u[d]=zr(Sr(n,a,d));let c=ee(Le),f=[];for(let d=0;d<c.length;d+=1)f[d]=Mr(Cr(n,c,d));return{c(){e=h("table"),r=h("thead"),t=h("tr"),o=h("th"),i=z();for(let d=0;d<u.length;d+=1)u[d].c();l=z(),s=h("tbody");for(let d=0;d<f.length;d+=1)f[d].c()},m(d,m){$(d,e,m),g(e,r),g(r,t),g(t,o),g(t,i);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(t,null);g(e,l),g(e,s);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(s,null)},p(d,m){if(m&1){a=ee(d[0].links);let p;for(p=0;p<a.length;p+=1){const j=Sr(d,a,p);u[p]?u[p].p(j,m):(u[p]=zr(j),u[p].c(),u[p].m(t,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=a.length}if(m&1){c=ee(Le);let p;for(p=0;p<c.length;p+=1){const j=Cr(d,c,p);f[p]?f[p].p(j,m):(f[p]=Mr(j),f[p].c(),f[p].m(s,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=c.length}},d(d){d&&k(e),be(u,d),be(f,d)}}}function za(n){let e,r;return e=new Ut({props:{$$slots:{default:[Sa]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,[o]){const i={};o&2049&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function La(n,e,r){let t;oe(n,Q,i=>r(0,t=i));function o(i){Se.call(this,n,i)}return[t,o]}class Ma extends ae{constructor(e){super(),ce(this,e,La,za,le,{})}}function Br(n,e,r){const t=n.slice();return t[9]=e[r],t[11]=r,t}function Er(n,e,r){const t=n.slice();return t[12]=e[r],t[11]=r,t}function Tr(n){let e,r;return e=new Ma({}),e.$on("close",n[4]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ba(n){let e=n[12].properties.name+"",r;return{c(){r=F(e)},m(t,o){$(t,r,o)},p(t,o){o&2&&e!==(e=t[12].properties.name+"")&&ie(r,e)},d(t){t&&k(r)}}}function Dr(n){let e,r,t,o;function i(){return n[6](n[11])}return r=new ut({props:{color:n[12].properties.color,$$slots:{default:[Ba]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){e=h("li"),M(r.$$.fragment),t=z()},m(l,s){$(l,e,s),B(r,e,null),g(e,t),o=!0},p(l,s){n=l;const a={};s&2&&(a.color=n[12].properties.color),s&16386&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(l){o||(_(r.$$.fragment,l),o=!0)},o(l){w(r.$$.fragment,l),o=!1},d(l){l&&k(e),E(r)}}}function Ea(n){let e=n[9].name+"",r,t;return{c(){r=F(e),t=z()},m(o,i){$(o,r,i),$(o,t,i)},p:Y,d(o){o&&(k(r),k(t))}}}function Nr(n){let e,r,t,o,i,l,s,a;function u(){return n[7](n[11])}r=new ut({props:{$$slots:{default:[Ea]},$$scope:{ctx:n}}}),r.$on("click",u);function c(...f){return n[8](n[11],...f)}return{c(){e=h("li"),M(r.$$.fragment),t=F(`:
      `),o=h("progress"),s=z(),o.value=i=n[1].links.filter(c).length,P(o,"max",l=n[1].links.length),P(o,"class","svelte-zadug4")},m(f,d){$(f,e,d),B(r,e,null),g(e,t),g(e,o),g(e,s),a=!0},p(f,d){n=f;const m={};d&16384&&(m.$$scope={dirty:d,ctx:n}),r.$set(m),(!a||d&2&&i!==(i=n[1].links.filter(c).length))&&(o.value=i),(!a||d&2&&l!==(l=n[1].links.length))&&P(o,"max",l)},i(f){a||(_(r.$$.fragment,f),a=!0)},o(f){w(r.$$.fragment,f),a=!1},d(f){f&&k(e),E(r)}}}function Ta(n){let e,r,t,o,i,l,s,a,u,c,f,d,m=n[0]&&Tr(n),p=ee(n[1].links),j=[];for(let b=0;b<p.length;b+=1)j[b]=Dr(Er(n,p,b));const L=b=>w(j[b],1,1,()=>{j[b]=null});let v=ee(Le),A=[];for(let b=0;b<v.length;b+=1)A[b]=Nr(Br(n,v,b));const O=b=>w(A[b],1,1,()=>{A[b]=null});return{c(){m&&m.c(),e=z(),r=h("div"),t=h("button"),t.textContent="New link",o=z(),i=h("button"),i.textContent="Table of questions",l=F(`

Links:
`),s=h("ol");for(let b=0;b<j.length;b+=1)j[b].c();a=F(`

Questions:
`),u=h("ol");for(let b=0;b<A.length;b+=1)A[b].c()},m(b,C){m&&m.m(b,C),$(b,e,C),$(b,r,C),g(r,t),g(r,o),g(r,i),$(b,l,C),$(b,s,C);for(let y=0;y<j.length;y+=1)j[y]&&j[y].m(s,null);$(b,a,C),$(b,u,C);for(let y=0;y<A.length;y+=1)A[y]&&A[y].m(u,null);c=!0,f||(d=[G(t,"click",n[3]),G(i,"click",n[5])],f=!0)},p(b,[C]){if(b[0]?m?(m.p(b,C),C&1&&_(m,1)):(m=Tr(b),m.c(),_(m,1),m.m(e.parentNode,e)):m&&(fe(),w(m,1,1,()=>{m=null}),de()),C&6){p=ee(b[1].links);let y;for(y=0;y<p.length;y+=1){const S=Er(b,p,y);j[y]?(j[y].p(S,C),_(j[y],1)):(j[y]=Dr(S),j[y].c(),_(j[y],1),j[y].m(s,null))}for(fe(),y=p.length;y<j.length;y+=1)L(y);de()}if(C&6){v=ee(Le);let y;for(y=0;y<v.length;y+=1){const S=Br(b,v,y);A[y]?(A[y].p(S,C),_(A[y],1)):(A[y]=Nr(S),A[y].c(),_(A[y],1),A[y].m(u,null))}for(fe(),y=v.length;y<A.length;y+=1)O(y);de()}},i(b){if(!c){_(m);for(let C=0;C<p.length;C+=1)_(j[C]);for(let C=0;C<v.length;C+=1)_(A[C]);c=!0}},o(b){w(m),j=j.filter(Boolean);for(let C=0;C<j.length;C+=1)w(j[C]);A=A.filter(Boolean);for(let C=0;C<A.length;C+=1)w(A[C]);c=!1},d(b){b&&(k(e),k(r),k(l),k(s),k(a),k(u)),m&&m.d(b),be(j,b),be(A,b),f=!1,je(d)}}}function Da(n,e,r){let t,o;oe(n,Q,d=>r(1,t=d)),oe(n,X,d=>r(2,o=d));let i=!1;function l(){let d=Zr(t.links.length);W(Q,t.links=[...t.links,d],t),W(X,o={kind:"edit-link",idx:t.links.length-1},o)}return[i,t,o,l,()=>r(0,i=!1),()=>r(0,i=!0),d=>W(X,o={kind:"edit-link",idx:d},o),d=>W(X,o={kind:"edit-question",idx:d},o),(d,m)=>m.properties.answers[d]!=""]}let Na=class extends ae{constructor(e){super(),ce(this,e,Da,Ta,le,{})}};function Ia(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled side road",color:Je[n%Je.length],sa01:""}}}function Ir(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Oa(n){let e=n[4].properties.name+"",r;return{c(){r=F(e)},m(t,o){$(t,r,o)},p(t,o){o&1&&e!==(e=t[4].properties.name+"")&&ie(r,e)},d(t){t&&k(r)}}}function Or(n){let e,r,t,o;function i(){return n[3](n[6])}return r=new ut({props:{color:n[4].properties.color,$$slots:{default:[Oa]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){e=h("li"),M(r.$$.fragment),t=z()},m(l,s){$(l,e,s),B(r,e,null),g(e,t),o=!0},p(l,s){n=l;const a={};s&1&&(a.color=n[4].properties.color),s&129&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(l){o||(_(r.$$.fragment,l),o=!0)},o(l){w(r.$$.fragment,l),o=!1},d(l){l&&k(e),E(r)}}}function Fa(n){let e,r,t,o,i,l,s,a,u=ee(n[0].side_roads),c=[];for(let d=0;d<u.length;d+=1)c[d]=Or(Ir(n,u,d));const f=d=>w(c[d],1,1,()=>{c[d]=null});return{c(){e=F(`Side roads:

`),r=h("div"),t=h("button"),t.textContent="New side road",o=z(),i=h("ol");for(let d=0;d<c.length;d+=1)c[d].c()},m(d,m){$(d,e,m),$(d,r,m),g(r,t),$(d,o,m),$(d,i,m);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);l=!0,s||(a=G(t,"click",n[2]),s=!0)},p(d,[m]){if(m&3){u=ee(d[0].side_roads);let p;for(p=0;p<u.length;p+=1){const j=Ir(d,u,p);c[p]?(c[p].p(j,m),_(c[p],1)):(c[p]=Or(j),c[p].c(),_(c[p],1),c[p].m(i,null))}for(fe(),p=u.length;p<c.length;p+=1)f(p);de()}},i(d){if(!l){for(let m=0;m<u.length;m+=1)_(c[m]);l=!0}},o(d){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)w(c[m]);l=!1},d(d){d&&(k(e),k(r),k(o),k(i)),be(c,d),s=!1,a()}}}function Ua(n,e,r){let t,o;oe(n,Q,s=>r(0,t=s)),oe(n,X,s=>r(1,o=s));function i(){let s=Ia(t.side_roads.length);W(Q,t.side_roads=[...t.side_roads,s],t),W(X,o={kind:"edit-side-road",idx:t.side_roads.length-1},o)}return[t,o,i,s=>W(X,o={kind:"edit-side-road",idx:s},o)]}class Pa extends ae{constructor(e){super(),ce(this,e,Ua,Fa,le,{})}}function qa(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p,j,L,v,A,O,b,C,y,S,D,I,K,V,T,J,N,ge,_e;return m=new Na({}),v=new ja({}),C=new ba({}),I=new va({}),J=new Pa({}),{c(){e=h("div"),r=h("div"),t=h("button"),t.textContent="Load file",o=z(),i=h("button"),i.textContent="Download",l=z(),s=h("button"),s.textContent="Clear",a=z(),u=h("button"),u.textContent="Draw an entire route",c=z(),f=h("hr"),d=z(),M(m.$$.fragment),p=z(),j=h("hr"),L=z(),M(v.$$.fragment),A=z(),O=h("hr"),b=z(),M(C.$$.fragment),y=z(),S=h("hr"),D=z(),M(I.$$.fragment),K=z(),V=h("hr"),T=z(),M(J.$$.fragment),P(t,"class","secondary"),P(i,"class","secondary"),P(s,"class","secondary"),P(u,"class","secondary"),P(e,"slot","sidebar")},m(U,Z){$(U,e,Z),g(e,r),g(r,t),g(r,o),g(r,i),g(r,l),g(r,s),g(e,a),g(e,u),g(e,c),g(e,f),g(e,d),B(m,e,null),g(e,p),g(e,j),g(e,L),B(v,e,null),g(e,A),g(e,O),g(e,b),B(C,e,null),g(e,y),g(e,S),g(e,D),B(I,e,null),g(e,K),g(e,V),g(e,T),B(J,e,null),N=!0,ge||(_e=[G(t,"click",n[12]),G(i,"click",n[13]),G(s,"click",n[5]),G(u,"click",n[6])],ge=!0)},p:Y,i(U){N||(_(m.$$.fragment,U),_(v.$$.fragment,U),_(C.$$.fragment,U),_(I.$$.fragment,U),_(J.$$.fragment,U),N=!0)},o(U){w(m.$$.fragment,U),w(v.$$.fragment,U),w(C.$$.fragment,U),w(I.$$.fragment,U),w(J.$$.fragment,U),N=!1},d(U){U&&k(e),E(m),E(v),E(C),E(I),E(J),ge=!1,je(_e)}}}function Ra(n){let e,r;return e=new Fe({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":$t(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[7]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ga(n){let e,r;return e=new tt({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":$t(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[8]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ja(n){let e,r;return e=new nt({props:{manageHoverState:!0,layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[9]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Qa(n){let e,r;return e=new nt({props:{manageHoverState:!0,layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[10]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ha(n){let e,r;return e=new Fe({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":$t(3,6)},hoverCursor:"pointer"}}),e.$on("click",n[11]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ka(n){let e,r,t,o,i,l,s,a,u,c,f;return r=new Ce({props:{data:pe(n[2].links),generateId:!0,$$slots:{default:[Ra]},$$scope:{ctx:n}}}),o=new Ce({props:{data:pe(n[2].jats),generateId:!0,$$slots:{default:[Ga]},$$scope:{ctx:n}}}),l=new Ce({props:{data:pe(n[2].bus_stops),generateId:!0,$$slots:{default:[Ja]},$$scope:{ctx:n}}}),a=new Ce({props:{data:pe(n[2].crossings),generateId:!0,$$slots:{default:[Qa]},$$scope:{ctx:n}}}),c=new Ce({props:{data:pe(n[2].side_roads),generateId:!0,$$slots:{default:[Ha]},$$scope:{ctx:n}}}),{c(){e=h("div"),M(r.$$.fragment),t=z(),M(o.$$.fragment),i=z(),M(l.$$.fragment),s=z(),M(a.$$.fragment),u=z(),M(c.$$.fragment),P(e,"slot","map")},m(d,m){$(d,e,m),B(r,e,null),g(e,t),B(o,e,null),g(e,i),B(l,e,null),g(e,s),B(a,e,null),g(e,u),B(c,e,null),f=!0},p(d,m){const p={};m&4&&(p.data=pe(d[2].links)),m&131080&&(p.$$scope={dirty:m,ctx:d}),r.$set(p);const j={};m&4&&(j.data=pe(d[2].jats)),m&131080&&(j.$$scope={dirty:m,ctx:d}),o.$set(j);const L={};m&4&&(L.data=pe(d[2].bus_stops)),m&131080&&(L.$$scope={dirty:m,ctx:d}),l.$set(L);const v={};m&4&&(v.data=pe(d[2].crossings)),m&131080&&(v.$$scope={dirty:m,ctx:d}),a.$set(v);const A={};m&4&&(A.data=pe(d[2].side_roads)),m&131080&&(A.$$scope={dirty:m,ctx:d}),c.$set(A)},i(d){f||(_(r.$$.fragment,d),_(o.$$.fragment,d),_(l.$$.fragment,d),_(a.$$.fragment,d),_(c.$$.fragment,d),f=!0)},o(d){w(r.$$.fragment,d),w(o.$$.fragment,d),w(l.$$.fragment,d),w(a.$$.fragment,d),w(c.$$.fragment,d),f=!1},d(d){d&&k(e),E(r),E(o),E(l),E(a),E(c)}}}function Fr(n){let e,r;return e=new Ut({props:{$$slots:{default:[Wa]},$$scope:{ctx:n}}}),e.$on("close",n[15]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&131074&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Wa(n){let e,r,t,o,i;return{c(){e=h("h1"),e.textContent="Load a file previously downloaded from this tool",r=z(),t=h("input"),P(t,"type","file")},m(l,s){$(l,e,s),$(l,r,s),$(l,t,s),n[14](t),o||(i=G(t,"change",n[4]),o=!0)},p:Y,d(l){l&&(k(e),k(r),k(t)),n[14](null),o=!1,i()}}}function Za(n){let e,r,t,o;e=new He({props:{$$slots:{map:[Ka],sidebar:[qa]},$$scope:{ctx:n}}});let i=n[0]&&Fr(n);return{c(){M(e.$$.fragment),r=z(),i&&i.c(),t=Qe()},m(l,s){B(e,l,s),$(l,r,s),i&&i.m(l,s),$(l,t,s),o=!0},p(l,[s]){const a={};s&131085&&(a.$$scope={dirty:s,ctx:l}),e.$set(a),l[0]?i?(i.p(l,s),s&1&&_(i,1)):(i=Fr(l),i.c(),_(i,1),i.m(t.parentNode,t)):i&&(fe(),w(i,1,1,()=>{i=null}),de())},i(l){o||(_(e.$$.fragment,l),_(i),o=!0)},o(l){w(e.$$.fragment,l),w(i),o=!1},d(l){l&&(k(r),k(t)),E(e,l),i&&i.d(l)}}}function Xa(n,e,r){let t,o,i;oe(n,Dt,b=>r(16,t=b)),oe(n,Q,b=>r(2,o=b)),oe(n,X,b=>r(3,i=b));let l=!1,s;async function a(b){try{let C=JSON.parse(await s.files[0].text());if(Hr(C)){W(Q,o=C,o),r(0,l=!1);return}}catch{}window.alert("Something's wrong with that file")}function u(){W(Q,o.links=[],o),W(Q,o.jats=[],o),W(Q,o.bus_stops=[],o),W(Q,o.crossings=[],o),W(Q,o.side_roads=[],o)}async function c(){await ul(t)}const f=b=>W(X,i={kind:"edit-link",idx:b.detail.features[0].id},i),d=b=>W(X,i={kind:"edit-jat",idx:b.detail.features[0].id},i),m=b=>W(X,i={kind:"edit-bus-stop",idx:b.detail.features[0].id},i),p=b=>W(X,i={kind:"edit-crossing",idx:b.detail.features[0].id},i),j=b=>W(X,i={kind:"edit-side-road",idx:b.detail.features[0].id},i),L=()=>r(0,l=!0),v=()=>Ai("rcv2.geojson",JSON.stringify(o));function A(b){me[b?"unshift":"push"](()=>{s=b,r(1,s)})}return[l,s,o,i,a,u,c,f,d,m,p,j,L,v,A,()=>r(0,l=!1)]}class Va extends ae{constructor(e){super(),ce(this,e,Xa,Za,le,{})}}function Ya(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Je[n%Je.length],st20:""}}}function xa(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:Je[n%Je.length],sa10:""}}}function ec(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Je[n%Je.length],existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}}}function tc(n){let e,r,t,o,i,l,s,a;return{c(){e=h("div"),r=h("h1"),t=F("Click map to create new "),o=F(n[0]),i=z(),l=h("button"),l.textContent="Cancel",P(e,"slot","sidebar")},m(u,c){$(u,e,c),g(e,r),g(r,t),g(r,o),g(e,i),g(e,l),s||(a=G(l,"click",n[3]),s=!0)},p(u,c){c&1&&ie(o,u[0])},d(u){u&&k(e),s=!1,a()}}}function nc(n){let e,r,t;return r=new Ye({props:{except:""}}),{c(){e=h("div"),M(r.$$.fragment),P(e,"slot","map")},m(o,i){$(o,e,i),B(r,e,null),t=!0},p:Y,i(o){t||(_(r.$$.fragment,o),t=!0)},o(o){w(r.$$.fragment,o),t=!1},d(o){o&&k(e),E(r)}}}function rc(n){let e,r,t,o;return e=new Ft({}),e.$on("click",n[2]),t=new He({props:{$$slots:{map:[nc],sidebar:[tc]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=z(),M(t.$$.fragment)},m(i,l){B(e,i,l),$(i,r,l),B(t,i,l),o=!0},p(i,[l]){const s={};l&35&&(s.$$scope={dirty:l,ctx:i}),t.$set(s)},i(i){o||(_(e.$$.fragment,i),_(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&k(r),E(e,i),E(t,i)}}}function oc(n,e,r){let t,o;oe(n,Q,a=>r(4,t=a)),oe(n,X,a=>r(1,o=a));let{obj:i}=e;function l(a){let u=a.detail.lngLat.toArray();if(i=="jat"){let c=ec(t.jats.length,u);W(Q,t.jats=[...t.jats,c],t),W(X,o={kind:"edit-jat",idx:t.jats.length-1},o)}else if(i=="crossing"){let c=xa(t.crossings.length,u);W(Q,t.crossings=[...t.crossings,c],t),W(X,o={kind:"edit-crossing",idx:t.crossings.length-1},o)}else if(i=="bus stop"){let c=Ya(t.bus_stops.length,u);W(Q,t.bus_stops=[...t.bus_stops,c],t),W(X,o={kind:"edit-bus-stop",idx:t.bus_stops.length-1},o)}}const s=()=>W(X,o={kind:"neutral"},o);return n.$$set=a=>{"obj"in a&&r(0,i=a.obj)},[i,o,l,s]}class ic extends ae{constructor(e){super(),ce(this,e,oc,rc,le,{obj:0})}}const{window:lc}=ct;function Ur(n){let e;return{c(){e=h("p"),e.textContent="A side road needs at least two points"},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function sc(n){let e;return{c(){e=F("SA01: conflict at side roads and priority junctions")},m(r,t){$(r,e,t)},d(r){r&&k(e)}}}function ac(n){let e,r,t,o,i,l,s,a,u,c,f,d,m,p,j,L,v,A,O,b,C,y=!n[2]&&Ur();function S(I){n[10](I)}let D={k:"horiz-radio",choices:ze(),$$slots:{default:[sc]},$$scope:{ctx:n}};return n[1].side_roads[n[0]].properties.sa01!==void 0&&(D.value=n[1].side_roads[n[0]].properties.sa01),m=new We({props:D}),me.push(()=>ke(m,"value",S)),A=new Pt({props:{metric:n[4]}}),{c(){e=h("div"),r=h("button"),t=F("Done"),i=z(),l=h("button"),l.textContent="Delete side road",s=z(),y&&y.c(),a=z(),u=h("label"),c=F(`Name:
      `),f=h("input"),d=z(),M(m.$$.fragment),j=z(),L=h("p"),L.textContent=`${n[4].description}`,v=z(),M(A.$$.fragment),r.disabled=o=!n[2],P(f,"type","text"),P(e,"slot","sidebar")},m(I,K){$(I,e,K),g(e,r),g(r,t),g(e,i),g(e,l),g(e,s),y&&y.m(e,null),g(e,a),g(e,u),g(u,c),g(u,f),ve(f,n[1].side_roads[n[0]].properties.name),g(e,d),B(m,e,null),g(e,j),g(e,L),g(e,v),B(A,e,null),O=!0,b||(C=[G(r,"click",n[8]),G(l,"click",n[6]),G(f,"input",n[9])],b=!0)},p(I,K){(!O||K&4&&o!==(o=!I[2]))&&(r.disabled=o),I[2]?y&&(y.d(1),y=null):y||(y=Ur(),y.c(),y.m(e,a)),K&3&&f.value!==I[1].side_roads[I[0]].properties.name&&ve(f,I[1].side_roads[I[0]].properties.name);const V={};K&2048&&(V.$$scope={dirty:K,ctx:I}),!p&&K&3&&(p=!0,V.value=I[1].side_roads[I[0]].properties.sa01,we(()=>p=!1)),m.$set(V)},i(I){O||(_(m.$$.fragment,I),_(A.$$.fragment,I),O=!0)},o(I){w(m.$$.fragment,I),w(A.$$.fragment,I),O=!1},d(I){I&&k(e),y&&y.d(),E(m),E(A),b=!1,je(C)}}}function cc(n){let e,r;return e=new Fe({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":3}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":3}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function uc(n){let e,r,t,o,i,l,s,a;r=new Ye({props:{except:"side_roads"}}),o=new Ce({props:{data:pe(n[1].side_roads),generateId:!0,$$slots:{default:[cc]},$$scope:{ctx:n}}});function u(f){n[7](f)}let c={};return n[1].side_roads[n[0]]!==void 0&&(c.f=n[1].side_roads[n[0]]),l=new xr({props:c}),me.push(()=>ke(l,"f",u)),{c(){e=h("div"),M(r.$$.fragment),t=z(),M(o.$$.fragment),i=z(),M(l.$$.fragment),P(e,"slot","map")},m(f,d){$(f,e,d),B(r,e,null),g(e,t),B(o,e,null),g(e,i),B(l,e,null),a=!0},p(f,d){const m={};d&2&&(m.data=pe(f[1].side_roads)),d&2049&&(m.$$scope={dirty:d,ctx:f}),o.$set(m);const p={};!s&&d&3&&(s=!0,p.f=f[1].side_roads[f[0]],we(()=>s=!1)),l.$set(p)},i(f){a||(_(r.$$.fragment,f),_(o.$$.fragment,f),_(l.$$.fragment,f),a=!0)},o(f){w(r.$$.fragment,f),w(o.$$.fragment,f),w(l.$$.fragment,f),a=!1},d(f){f&&k(e),E(r),E(o),E(l)}}}function fc(n){let e,r,t,o;return e=new He({props:{$$slots:{map:[uc],sidebar:[ac]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(i,l){B(e,i,l),r=!0,t||(o=G(lc,"keydown",n[5]),t=!0)},p(i,[l]){const s={};l&2063&&(s.$$scope={dirty:l,ctx:i}),e.$set(s)},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){E(e,i),t=!1,o()}}}function dc(n,e,r){let t,o,i;oe(n,Q,p=>r(1,o=p)),oe(n,X,p=>r(3,i=p));let{idx:l}=e,s=at.SA01;function a(p){p.key=="Escape"&&W(X,i={kind:"neutral"},i)}async function u(){window.confirm("Really delete this side road?")&&(W(X,i={kind:"neutral"},i),await et(),o.side_roads.splice(l,1),Q.set(o))}function c(p){n.$$.not_equal(o.side_roads[l],p)&&(o.side_roads[l]=p,Q.set(o))}const f=()=>W(X,i={kind:"neutral"},i);function d(){o.side_roads[l].properties.name=this.value,Q.set(o)}function m(p){n.$$.not_equal(o.side_roads[l].properties.sa01,p)&&(o.side_roads[l].properties.sa01=p,Q.set(o))}return n.$$set=p=>{"idx"in p&&r(0,l=p.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(2,t=o.side_roads[l].geometry.coordinates.length>=2)},[l,o,t,i,s,a,u,c,f,d,m]}class pc extends ae{constructor(e){super(),ce(this,e,dc,fc,le,{idx:0})}}function mc(n){let e,r;return{c(){e=h("div"),r=h("div"),P(e,"slot","left")},m(t,o){$(t,e,o),g(e,r),n[10](r)},p:Y,d(t){t&&k(e),n[10](null)}}}function gc(n){return{c:Y,m:Y,p:Y,i:Y,o:Y,d:Y}}function _c(n){let e,r,t;function o(l){n[9](l)}let i={style:n[11],standardControls:!0,hash:!0,images:[{id:"bus_stop",url:Jr,options:{sdf:!0}},{id:"crossing",url:Qr,options:{sdf:!0}}],$$slots:{default:[Sc]},$$scope:{ctx:n}};return n[2]!==void 0&&(i.map=n[2]),e=new Co({props:i}),me.push(()=>ke(e,"map",o)),{c(){M(e.$$.fragment)},m(l,s){B(e,l,s),t=!0},p(l,s){const a={};s&4110&&(a.$$scope={dirty:s,ctx:l}),!r&&s&4&&(r=!0,a.map=l[2],we(()=>r=!1)),e.$set(a)},i(l){t||(_(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function hc(n){let e,r;return e=new Al({props:{map:n[2],editingExisting:!1,finish:fl,cancel:n[8]}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&4&&(i.map=t[2]),o&8&&(i.cancel=t[8]),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function bc(n){let e,r;return e=new da({props:{qIdx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.qIdx=t[3].idx),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function $c(n){let e,r;return e=new pc({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.idx=t[3].idx),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function kc(n){let e,r;return e=new el({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.idx=t[3].idx),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function wc(n){let e,r;return e=new di({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.idx=t[3].idx),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function vc(n){let e,r;return e=new Us({props:{junctionIdx:n[3].idx,stage:n[3].stage}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.junctionIdx=t[3].idx),o&8&&(i.stage=t[3].stage),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function yc(n){let e,r;return e=new Hs({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.idx=t[3].idx),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ac(n){let e,r;return e=new ia({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.idx=t[3].idx),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Cc(n){let e,r;return e=new ic({props:{obj:n[3].obj}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.obj=t[3].obj),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function jc(n){let e,r;return e=new Va({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:Y,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Sc(n){let e,r,t,o,i,l,s;const a=[jc,Cc,Ac,yc,vc,wc,kc,$c,bc,hc],u=[];function c(f,d){return f[3].kind=="neutral"?0:f[3].kind=="new-point"?1:f[3].kind=="edit-link"?2:f[3].kind=="edit-jat"?3:f[3].kind=="edit-jat-detail"?4:f[3].kind=="edit-bus-stop"?5:f[3].kind=="edit-crossing"?6:f[3].kind=="edit-side-road"?7:f[3].kind=="edit-question"?8:f[3].kind=="draw-route"&&f[2]?9:-1}return~(t=c(n))&&(o=u[t]=a[t](n)),l=new Gi({}),{c(){e=h("div"),r=z(),o&&o.c(),i=z(),M(l.$$.fragment)},m(f,d){$(f,e,d),n[7](e),$(f,r,d),~t&&u[t].m(f,d),$(f,i,d),B(l,f,d),s=!0},p(f,d){let m=t;t=c(f),t===m?~t&&u[t].p(f,d):(o&&(fe(),w(u[m],1,1,()=>{u[m]=null}),de()),~t?(o=u[t],o?o.p(f,d):(o=u[t]=a[t](f),o.c()),_(o,1),o.m(i.parentNode,i)):o=null)},i(f){s||(_(o),_(l.$$.fragment,f),s=!0)},o(f){w(o),w(l.$$.fragment,f),s=!1},d(f){f&&(k(e),k(r),k(i)),n[7](null),~t&&u[t].d(f),E(l,f)}}}function zc(n){return{c:Y,m:Y,p:Y,i:Y,o:Y,d:Y}}function Lc(n){let e,r,t={ctx:n,current:null,token:null,hasCatch:!1,pending:zc,then:_c,catch:gc,value:11,blocks:[,,,]};return jo(Cl(new URLSearchParams(window.location.search).get("google")||""),t),{c(){e=h("div"),t.block.c(),P(e,"slot","main"),x(e,"position","relative"),x(e,"width","100%"),x(e,"height","100vh")},m(o,i){$(o,e,i),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,r=!0},p(o,i){n=o,So(t,n,i)},i(o){r||(_(t.block),r=!0)},o(o){for(let i=0;i<3;i+=1){const l=t.blocks[i];w(l)}r=!1},d(o){o&&k(e),t.block.d(),t.token=null,t=null}}}function Mc(n){let e,r;return e=new Ao({props:{$$slots:{main:[Lc],left:[mc]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,[o]){const i={};o&4111&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Bc(n,e,r){let t,o,i,l,s;oe(n,Zt,p=>r(4,t=p)),oe(n,Wt,p=>r(5,o=p)),oe(n,Q,p=>r(6,i=p)),oe(n,Dt,p=>r(2,l=p)),oe(n,X,p=>r(3,s=p));let a,u;function c(p){me[p?"unshift":"push"](()=>{u=p,r(1,u),r(4,t)})}const f=()=>W(X,s={kind:"neutral"},s);function d(p){l=p,Dt.set(l)}function m(p){me[p?"unshift":"push"](()=>{a=p,r(0,a),r(5,o)})}return n.$$.update=()=>{n.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(i)),n.$$.dirty&33&&a&&o&&(r(0,a.innerHTML="",a),a.appendChild(o)),n.$$.dirty&18&&u&&t&&(r(1,u.innerHTML="",u),u.appendChild(t))},[a,u,l,s,t,o,i,c,f,d,m]}class Ec extends ae{constructor(e){super(),ce(this,e,Bc,Mc,le,{})}}new Ec({target:document.getElementById("app")});
