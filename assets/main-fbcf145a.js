import{S as le,i as ie,s as oe,c as Be,e as k,a as I,t as we,b as w,u as Te,g as Ee,d as Oe,f as b,h as y,j as v,m as oo,k as te,o as Rt,l as ue,n as rn,p as _,q,r as Ae,v as Eo,L as Oo,w as me,x as B,y as T,z as _e,A as E,B as lo,C as Ce,D as se,E as ae,F as on,G as Do,H as No,I as x,J as Io,K as Fo,M as ee,P as Po,N as M,O as Ie,Q as N,R as re,T as Uo,U as V,V as io,W as ln,X as de,Y as ye,Z as pe,_ as it,$ as ve,a0 as qe,a1 as Ze,a2 as X,a3 as Ke,a4 as wt,a5 as st,a6 as $t,a7 as qo,a8 as at,a9 as Ro,aa as sn,ab as Go,ac as Jt,ad as Jo,ae as Qo,af as Nt,ag as Zt,ah as Ho,ai as Qt,aj as Ft,ak as Ko,al as so,am as an,an as Wo,ao as Zo,ap as Xo}from"./index-46d4e443.js";function Vo(n){let e,r;const t=n[7].default,o=Be(t,n,n[6],null);return{c(){e=k("div"),o&&o.c(),I(e,"class",n[1]),we(e,"maplibregl-ctrl",n[0])},m(l,i){w(l,e,i),o&&o.m(e,null),n[8](e),r=!0},p(l,[i]){o&&o.p&&(!r||i&64)&&Te(o,t,l,l[6],r?Oe(t,l[6],i,null):Ee(l[6]),null),(!r||i&2)&&I(e,"class",l[1]),(!r||i&3)&&we(e,"maplibregl-ctrl",l[0])},i(l){r||(b(o,l),r=!0)},o(l){y(o,l),r=!1},d(l){l&&v(e),o&&o.d(l),n[8](null)}}}function Yo(n,e,r){let t,{$$slots:o={},$$scope:l}=e,{defaultStyling:i=!0}=e,{position:a="top-right"}=e,{class:s=void 0}=e;const{map:c}=oo();te(n,c,d=>r(5,t=d));let u,f={onAdd(){return u},onRemove(){var d;(d=u==null?void 0:u.parentNode)==null||d.removeChild(u)}};Rt(()=>{t==null||t.removeControl(f)});function p(d){ue[d?"unshift":"push"](()=>{u=d,r(2,u)})}return n.$$set=d=>{"defaultStyling"in d&&r(0,i=d.defaultStyling),"position"in d&&r(4,a=d.position),"class"in d&&r(1,s=d.class),"$$scope"in d&&r(6,l=d.$$scope)},n.$$.update=()=>{n.$$.dirty&52&&t&&u&&t.addControl(f,a)},[i,s,u,c,a,t,l,o,p]}class xo extends le{constructor(e){super(),ie(this,e,Yo,Vo,oe,{defaultStyling:0,position:4,class:1})}}function el(n){let e,r,t,o,l,i;const a=n[4].default,s=Be(a,n,n[3],null);return{c(){e=k("button"),r=k("div"),s&&s.c(),I(r,"class",t=rn(n[2])+" svelte-1s83zbq"),we(r,"maplibregl-ctrl-icon",n[0]),we(r,"ctrl-btn-center",n[1]),I(e,"type","button")},m(c,u){w(c,e,u),_(e,r),s&&s.m(r,null),o=!0,l||(i=q(e,"click",n[5]),l=!0)},p(c,[u]){s&&s.p&&(!o||u&8)&&Te(s,a,c,c[3],o?Oe(a,c[3],u,null):Ee(c[3]),null),(!o||u&4&&t!==(t=rn(c[2])+" svelte-1s83zbq"))&&I(r,"class",t),(!o||u&5)&&we(r,"maplibregl-ctrl-icon",c[0]),(!o||u&6)&&we(r,"ctrl-btn-center",c[1])},i(c){o||(b(s,c),o=!0)},o(c){y(s,c),o=!1},d(c){c&&v(e),s&&s.d(c),l=!1,i()}}}function tl(n,e,r){let{$$slots:t={},$$scope:o}=e,{icon:l=!0}=e,{center:i=!0}=e,{class:a=void 0}=e;function s(c){Ae.call(this,n,c)}return n.$$set=c=>{"icon"in c&&r(0,l=c.icon),"center"in c&&r(1,i=c.center),"class"in c&&r(2,a=c.class),"$$scope"in c&&r(3,o=c.$$scope)},[l,i,a,o,t,s]}class ao extends le{constructor(e){super(),ie(this,e,tl,el,oe,{icon:0,center:1,class:2})}}function nl(n,e,r){let t;const o=Eo();let{layer:l=void 0}=e;const{map:i}=oo();te(n,i,u=>r(2,t=u));function a(u){o(u.type,{...u,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],c=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Rt(()=>{if(t)if(l)for(const u of s)t.off(u,l,a);else for(const u of c)t.off(u,a)}),n.$$set=u=>{"layer"in u&&r(1,l=u.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(l)for(const u of s)t.on(u,l,a);else for(const u of c)t.on(u,a)},[i,l,t]}class vt extends le{constructor(e){super(),ie(this,e,nl,null,oe,{layer:1})}}function rl(n){let e;const r=n[16].default,t=Be(r,n,n[24],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16777216)&&Te(t,r,o,o[24],e?Oe(r,o[24],l,null):Ee(o[24]),null)},i(o){e||(b(t,o),e=!0)},o(o){y(t,o),e=!1},d(o){t&&t.d(o)}}}function ol(n){let e,r,t;function o(i){n[17](i)}let l={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[rl]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.hovered=n[0]),e=new Oo({props:l}),ue.push(()=>me(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){B(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.hovered=i[0],_e(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function ll(n,e,r){let{$$slots:t={},$$scope:o}=e,{id:l=lo("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:u=void 0}=e,{layout:f=void 0}=e,{filter:p=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:g=void 0}=e,{maxzoom:j=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:m=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:A=!1}=e,{interactive:C=!0}=e;function S(O){h=O,r(0,h)}function $(O){Ae.call(this,n,O)}function z(O){Ae.call(this,n,O)}function D(O){Ae.call(this,n,O)}function G(O){Ae.call(this,n,O)}function P(O){Ae.call(this,n,O)}function Z(O){Ae.call(this,n,O)}return n.$$set=O=>{"id"in O&&r(1,l=O.id),"source"in O&&r(2,i=O.source),"sourceLayer"in O&&r(3,a=O.sourceLayer),"beforeId"in O&&r(4,s=O.beforeId),"beforeLayerType"in O&&r(5,c=O.beforeLayerType),"paint"in O&&r(6,u=O.paint),"layout"in O&&r(7,f=O.layout),"filter"in O&&r(8,p=O.filter),"applyToClusters"in O&&r(9,d=O.applyToClusters),"minzoom"in O&&r(10,g=O.minzoom),"maxzoom"in O&&r(11,j=O.maxzoom),"hoverCursor"in O&&r(12,L=O.hoverCursor),"manageHoverState"in O&&r(13,m=O.manageHoverState),"hovered"in O&&r(0,h=O.hovered),"eventsIfTopMost"in O&&r(14,A=O.eventsIfTopMost),"interactive"in O&&r(15,C=O.interactive),"$$scope"in O&&r(24,o=O.$$scope)},[h,l,i,a,s,c,u,f,p,d,g,j,L,m,A,C,t,S,$,z,D,G,P,Z,o]}class Ye extends le{constructor(e){super(),ie(this,e,ll,ol,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function cn(n){let e=n[0],r,t,o=un(n);return{c(){o.c(),r=Ce()},m(l,i){o.m(l,i),w(l,r,i),t=!0},p(l,i){i&1&&oe(e,e=l[0])?(se(),y(o,1,1,ee),ae(),o=un(l),o.c(),b(o,1),o.m(r.parentNode,r)):o.p(l,i)},i(l){t||(b(o),t=!0)},o(l){y(o),t=!1},d(l){l&&v(r),o.d(l)}}}function un(n){let e;const r=n[15].default,t=Be(r,n,n[14],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16384)&&Te(t,r,o,o[14],e?Oe(r,o[14],l,null):Ee(o[14]),null)},i(o){e||(b(t,o),e=!0)},o(o){y(t,o),e=!1},d(o){t&&t.d(o)}}}function il(n){let e,r,t=n[0]&&cn(n);return{c(){t&&t.c(),e=Ce()},m(o,l){t&&t.m(o,l),w(o,e,l),r=!0},p(o,[l]){o[0]?t?(t.p(o,l),l&1&&b(t,1)):(t=cn(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(se(),y(t,1,1,()=>{t=null}),ae())},i(o){r||(b(t),r=!0)},o(o){y(t),r=!1},d(o){o&&v(e),t&&t.d(o)}}}function sl(n,e,r){let t,o,{$$slots:l={},$$scope:i}=e,{id:a=lo("vector")}=e,{url:s=null}=e,{tiles:c=null}=e,{promoteId:u=null}=e,{bounds:f=null}=e,{scheme:p=null}=e,{attribution:d=null}=e,{minzoom:g=null}=e,{maxzoom:j=null}=e,{volatile:L=null}=e;if(s&&s.includes("pmtiles://")&&!on.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let C=new Po;on.addProtocol("pmtiles",C.tile)}const{map:m,self:h}=Do();te(n,m,C=>r(13,o=C)),te(n,h,C=>r(0,t=C));let A;return Rt(()=>{t&&o&&(No(m,t,A),x(h,t=null,t),A=void 0)}),n.$$set=C=>{"id"in C&&r(3,a=C.id),"url"in C&&r(4,s=C.url),"tiles"in C&&r(5,c=C.tiles),"promoteId"in C&&r(6,u=C.promoteId),"bounds"in C&&r(7,f=C.bounds),"scheme"in C&&r(8,p=C.scheme),"attribution"in C&&r(9,d=C.attribution),"minzoom"in C&&r(10,g=C.minzoom),"maxzoom"in C&&r(11,j=C.maxzoom),"volatile"in C&&r(12,L=C.volatile),"$$scope"in C&&r(14,i=C.$$scope)},n.$$.update=()=>{n.$$.dirty&16377&&o&&t!==a&&(x(h,t=a,t),Io(o,t,Fo({type:"vector",url:s,tiles:c,promoteId:u,bounds:f,scheme:p,attribution:d,minzoom:g,maxzoom:j,volatile:L}),C=>o&&C===t,()=>{t&&(A=o==null?void 0:o.getSource(t))})),n.$$.dirty&8200&&(o==null||o.on("style.load",()=>{A=o==null?void 0:o.getSource(a)}))},[t,m,h,a,s,c,u,f,p,d,g,j,L,o,i,l]}class co extends le{constructor(e){super(),ie(this,e,sl,il,oe,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const al=n=>({}),fn=n=>({}),cl=n=>({}),pn=n=>({});function ul(n){let e,r,t,o;const l=n[3].sidebar,i=Be(l,n,n[2],pn),a=n[3].map,s=Be(a,n,n[2],fn);return{c(){e=k("div"),i&&i.c(),r=M(),t=k("div"),s&&s.c()},m(c,u){w(c,e,u),i&&i.m(e,null),n[4](e),w(c,r,u),w(c,t,u),s&&s.m(t,null),n[5](t),o=!0},p(c,[u]){i&&i.p&&(!o||u&4)&&Te(i,l,c,c[2],o?Oe(l,c[2],u,cl):Ee(c[2]),pn),s&&s.p&&(!o||u&4)&&Te(s,a,c,c[2],o?Oe(a,c[2],u,al):Ee(c[2]),fn)},i(c){o||(b(i,c),b(s,c),o=!0)},o(c){y(i,c),y(s,c),o=!1},d(c){c&&(v(e),v(r),v(t)),i&&i.d(c),n[4](null),s&&s.d(c),n[5](null)}}}function fl(n,e,r){let t,o;te(n,Xt,c=>r(0,t=c)),te(n,Vt,c=>r(1,o=c));let{$$slots:l={},$$scope:i}=e;function a(c){ue[c?"unshift":"push"](()=>{t=c,Xt.set(t)})}function s(c){ue[c?"unshift":"push"](()=>{o=c,Vt.set(o)})}return n.$$set=c=>{"$$scope"in c&&r(2,i=c.$$scope)},[t,o,i,l,a,s]}class Pe extends le{constructor(e){super(),ie(this,e,fl,ul,oe,{})}}let Xt=Ie(null),Vt=Ie(null);const uo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAACmlBMVEXo6uzn6e3o6u7n6ezn6uzm6Ozn6evo6ezm6evo6e3p6u7p6+3p6u3o6u3n6u3n6evn6evn6ezo6uzo6u3n6evn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezo6uzo6uzo6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezo6+3n6ezn6ezn6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6ezn6e3n6e3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6e3o6u3o6uzo6uzo6u3o6u3o6u3n6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6uzn6ezn6e3o6u3o6u3o6u3o6u3o6u3n6u3n6ezo6u3o6u3o6uzn6uzn6ezo6ezo6uzn6ezo6u3o6u3o6u3n6u3n6Ozm6ezn6ezo6u3o6u3o6uzo6u3n6u3o6e3o6u3o6u3o6u3n6u3n6ezo6uzo6u3o6u3n6+3o6uzo6u3o6u3o6uzo6uzn6uzn6uzn6ezn6ezn6ezn6ezo6u3n6ezo6ezn6ezn6ezn6ezn6ezn6e3o6u3o6e3n6ezn6ezo6uzn6evo6uzo6uzn6evn6ezo6u3n6ezn6uzo6u3n6ezn6ezo6u3n6u3n6ezo6u3o6u3n6ezn6u3o6u3o6u3n6ezo6u3n6u3n6ezn6ezo6u3n6ezo6u3n6e3n6uzn6ezn6ezn6ezn6ezn6ezn6ezo6u3o6u3n6ezn6ezo6u3o6e3o6u3n6e3o6u3n6u3n6uzo6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6evo6u3o6u3o6u3n6uvn6ezo6u3n6uzn6ezn6ezn6ezo6u3n6uzn6uzo6u3n6u3n6uzo6+zm6uzjK5F0AAAA3nRSTlMAAAAAAAAAAAAAAAAAAAAIDxIUFBMDKEVdbn2IjpOWlpCJb15HKgUACXqjwtrt/P/u3MSmSg0gc7vz4dnSz83U5fT3vnciCnPV8MCdg2JYUk5LU1pmdoyoy/rYdApBt31IIyMjIyyI0LY/AABh366lq19s6GnraXg8PHsAAwOEeF0MKiEiCymqnFmeqXsncN6sOTuuDYzPTlCJCHhyOjyxcGfmkhotgqFcrYIrHONkymEKEC8mLg9jzMhNmr1XVVi/mCSz79ddrI6v3FooDSsAQ6OCFReFoi48GTwtAAD3GpCFAAADBklEQVR4nKWUh1IUQRCGZ+nx8JRZMcspoiKekfbMomDABAaSCbNwxhPMgmLOCTFnxZxzzlkxY86+i927BxzeUmWVf+1O1c5+09Pd09NCaJoWAFJCOQAb0GuzQSAPAOXppVlhD6hQMUgIJpUECUxpviCAxoOuKlRUShikMmYMk5WCK1epWi24UgloDwhSBOqKSTtNVa9Rs1aIo3ad0LphofXqOxqEN4xoxLDBKaGcTiU0pRo3bNK0WfMWkehVZEtXq9aONm1Ne0oXQHuT0XbtO3Sk3y2jOnWOjomJ7tK8azf67B7boydTJMFeBIpevftgXHzffiH9ByQkJiUlJqcMHDR4yNBUHDZ8hG5IlCMBjByF0aPHjE1Loyfd7U5Lc7vd6eOSx0/AiZN0jSUmTyaTnikZmDnVQtPQNZ0ou10JMy8zWmAZmjmLIyeLdkMExloKZ8/x+lgEpmZlz/XXvMjZc3IM+YA2ofxkDVqQ/wn+69bzF/jLClxoqUi/9JSVcD+LGGUpfzB10WILzfPfmqKGJUuXcXkaguURK0BYgysdq1avCTRQCSlr163PVdbghjzEjZvoflJJbd6C6ArRLcGt2yjI7TvMq7qzM33s2u0DFtVj6h7YG4WYuY8sKoD9+YgZB2A9gdKQFzx4CA8fOXos8/gJ8+g0CD9+8tTpM2F49hyAAZotYedQPH/h4qXLV6D4mHOvXltx/QbevMX/PR4vmHsb8U7W3XuldD/rAeLDR5wrqixza0h+jPjk6V+KQ8xPgKLUeslneVYn7Uqhm2UD7lFgNizFYMHzUnqB+PIVJ4uyYGdQY98ZXPX6jY/eFpggo+yjt64NsIZPceuni0GW6WehzfbufXzsh48l2ZGeT59j47+MNHowg4WFheahff327Ts5UwQScCT7x0/JfYdbrDA8oBauSUkhUUP1ngx4aJEOimbNJsVBM6dLyUFpmtcesHFdCiWVMkGbzNFB1xWBupPnDFzzcDJotXJKJ22kCeJyqFupXyaoVCAw+JuzrGi5cOqSurf2B4tMU69Bi01ZAAAAAElFTkSuQmCC",fo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMA/1uRIrUAAAjuSURBVHic7dxLlqM2FAZgCOdEGUUZZtCntZPWlrKCiKwgW2IpZAdkxoBAbJCEHle27r3UoxNr0KdMoc9Y/HoArm6aV3mVV/m/lHYbeIDaFh6wbVvPqd/dgJEDyBswcwB9A1YOYG7AxgHu9Tmt2O3ASAfEDkx0QO4A4zSwAbUDjDDrHWAEYY8BJwhs4KhPT1JrgeHDgM4C4/cLCAuQe9PHA9IC5O74Al7AC/hswHc8IrGBj58XPn5ydUBPBdgLjE+wRtJ7fcYyT+0AY6HJXuqyV+vs64WWF8SGf8nDv+hSvLN4wYUn+9KXffHNv/xvmAfwKq/yKq/yKv+p0rImxua+TBt4B8Ccm++LLNZN4X15wAI0c4nVMBd5xzKRscw8Vrqc06CYS+1jlcg4jy33ckNwr5gUF9DMq0Z30UcG2FfOkgso7t0DwwTclTcZEFzANQG5O2ousDGBjgtILqC5gGECPkZUQHABFQK/EAATAr8SgC0EvuDrdxHwFQ/ICFB4QMdAjwa2GBiw9dsEGLGASAD0oKQSAB1GkwDoNcLGBLoUwC4yRApgFxk50OMAmQEDDlAZMOIAnQHIJOUAMkkmA5BByAFkEHIAGYQtB3ouMHCBkQvgggAAqCC4EfGfAEAFwQF/BwAqCA74KwBQQXDAHyHQ44G1DYEBD8wRMCIAO6aOEYAJggX6CMAE4QDWJgIwQehsvQjABME9mokATBCOaaFPgB4JrE0CDEhgSYERCcwpgAgCDCCCAAOIIEgQQAQBBhBBkLbNEqDnAgMXGLlAfRDUGwH1SXLRT4D6JBWA+iQVgPok6QLQc4GBC4woYAgAu/StDkIGCPcDFbBTVXUQTAq46ZoMuEUTHTC4IBi78wloXBByAJmkHJC4JG0ZILhAh4uiO2Un0HKBBpdlADBcQGOAFgAUF0B9KWevt8aA4AIdF2gxQAcADRswXEBjgSUBFBdwiw4yIBCAgIBdHRlAiwXO9Nimu/80cADDBe5B6DnAPQh19c/HlBEg6yfXFFjccdVO7z500aze1o/qKWA/ev3ElAH9vllXz+4ZMOybu+olkoKB+uIBt7IZKcAYANj72jIFsPe1T8CESWIA2NvSJ6CjJOGA4f6TipJUXUQGDFSA+OC480ctuIB7TIBMUmsb/iffGbBJsqf+i48iNkm2yhdyksxx0N/ISdJHs2lykuRx4kzvgzDgAHHUuP1DTFJ7fOgbQP0DBnNMKyM1Se44JnKS9tIFF4yk7+OIezVikiywkpO0F3mvRkySA8hJ2ovagiCMBEBvzCDsXYoTBLO/LyMIW3jngAiwktQe1ehJsmMzPUl2dqAnyU5w9CSJoxo9SXaxR0+SWzGTk6Q2ZhD0FgWBCARBQANmi4PQ04AzCAMWcNWo39BrXTVqkvy9K2qSOn/gxCR1vumISRIe0LQgSH/2iUk6AWKSlH9bYpK0bzlikk7ABQGZJHOefA5w3sRCRzGopClRDG/jqg8Bzr7kk4TrDGdf8knCASIAXJJQwNkV0jshBAD7gGQvKqxjCN1Rhe2mCYAOAUUAgr7kG2QgA4IARB0wjCUOsENAiweSZyp4IDloE3HvAiTtrqlAb1+q8JxUFRkD+D97jvqSOyDMmBb1JdemGEBzARPXaGPvPYCoL9GBKXldXz97PokFsgEgzhUBMEggG8OIwFlBJ+CzIrlA0pcuAFTSqM9K0peoQND7VBKsZ8WkgEQCSV+6AEA9NYae9dOAMQWqx7R8NkYOivl6gAb0KVA9pmV9CTsoZl2BDyAHxawv0YCozbNWeViyvoQdFLOucBkw1NWHvjejCcBIBqCVrco3lQu0tr4IqBzT8r6EHBQlkFsUAPQl3KAI9KV3BoC+hBsUDfBuKADoS6hRFfwOGmZQBK/RMAB8lQhko1Tg69T3BKC+hBoUob6EAqC+hBpVoa6AGhTZANSXUIMi1JdQANSXMEDh+5zlQbENT7BeQkAFvcIB7q813d95JIBZwr6UA3MjZxiwh2Pm8EZgCIgE6IqAYAG3Dxn0pRBwg6JYQMDl7rZzJdAWAVurIQH3/9b7qLWmgBsUuxUElhPQdUBTBMzmNxzWET+br6dAH/alEGgeA/7k9sBN9RjwkXkMTBlwHNlt98dA1BkBoC8AvotFExsM9Me+ugCEN9UjQL8tMB4b5er/qq4MDMe+qgCIEqBwQIMEhgRYc0AmgIQA9RTYv6FTASxFoIOB/jkgEkBAgF794FkGphpgygE7ihaABgTMFhxOCnQQYFwSxwJwG1TDZwY5sJWB9hGwpsCQA83xowfah0BfAO4T1yNgcwMKBBgLLACwpEADAHpvGxXsDAH9OVyngNrb5iHQPgTk/tF08HlPYA4Ac4IxIOx3Os4Wh4BjbpwhoLXfKnkAdJudnUHg9nLatwHAGe9jfTCBwP4fOZyx1QVA+iRnT6x/O/YuA+L+U+eTDD3y7rYtmBg8MAZA8B6PAQUCc9jOR/1o4S5gYPC/Xe6/mMqAPAGZA3LfWfjLCgDQ0d4AANyBiwADA+dBAfcAI2CLPnAKqC2+sMuBcCItAMNDQBSA5gTGh4AKgC4H9BnKArBHa3oIzI+AY8TNgTUA0iaPNqkQaGFgKwPdn9sTwARnGQLs6zkDlhAYa4GmAMxFIP12Vg4cv38KLBkwRxV8ElyFtQCYApBVqAZKFUqvT2CiAboEpI3mB5m3A8ZjQ1cJnL3/8wDDsUHUAv3xUpaAuQSYNwP8hkrAv+HnAZoYmEqAjoEuBVQC+P9uKwXGq4GVCLQpoGuB6WpgSX4/loD0M6aAqQXmq4GZCpirAbf/8AxYEmCqBWQC6IuBthpYE2CkAupiwO/f29+LFEg3OGB4BpRE+WmA/tn+pQ3irYCmBKQf0gHuE9UDrtU+C5BOCxXAeLxuYWAtAu0bAQsZaGJA1wPTtcBMB36PAGN/66/yfDAGt8VtmK8FJjrwLQK2emC5FhjpwFcQmMtA2kwR0CKANQIGOvDzpUCHALYI6BNgKgM6AX68FBAYoA+Bhg78cCkgM0C5LeNDIHu/sQz4LUPzKq/yKq9yefkXR6tlrDrSxQ4AAAAASUVORK5CYII=";let dn="MZEJTanw3WpxRvt7qDfo";async function mn(n){if(n!="google")return`https://api.maptiler.com/maps/${n}/style.json?key=${dn}`;let e=new URLSearchParams(window.location.search).get("google")||"";return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await pl(e)}&key=${e}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${dn}`}}async function pl(n){try{let r=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB",layerTypes:["layerRoadmap"],overlay:!1})})).json();return"session"in r?r.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(r)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}function je(){return["","2","1","0","Critical"]}let We=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],Ve={SA01:{description:"Pedestrian and cyclist conflict with motor traffic at side roads/priority junctions",green:"Side roads/priority junctions have entry treatments that offer greater protection for  pedestrian and cycle movements (e.g. exit only, continuous footways, zebra/parallel crossings as appropriate to context).",amber:"<2,500vpd cut across main walking, wheeling or cycling streams and side roads and priority junctions have entry treatments. ",red:"<2,500vpd cut across main walking, wheeling or cycling streams, but side roads and priority junctions are untreated.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA02:{description:"Pedestrian and cyclist conflict with motor traffic at roundabouts and signal-controlled junctions",green:"All pedestrian and cyclist movements are separated from all motor traffic movements at roundabouts and/or signal controlled junctions.",amber:"The principal pedestrian and cyclist movements are separated from motor traffic movements at roundabouts and/or signal controlled junctions.",red:"The principal pedestrian and/or cyclist movements are in conflict with motor traffic movements at roundabouts and/or signal controlled junctions.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA03:{description:"Effect of lane widths on conflict between cyclists and motor traffic",green:"Cyclists are protected from motor traffic or off-road entirely.",amber:`Cyclists are in cycle lanes with light protection or stepped cycle tracks under 1.8m wide (single direction).

Or, cyclists are in a protected bidirectional cycle facility under 2.5m wide.

Or, cyclists are mixed with traffic on quiet urban streets with no centre line.`,red:`Cyclists are mixed with traffic in lanes less than 3.25m wide or over 3.9m wide.

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is under 3.25m or over 3.9m. 

Or cyclists are mixed with traffic on busy urban streets with no centre line.

Or, there are speed cushions present.`,critical:`Cyclists are mixed with traffic in lanes between 3.25m and 3.9m wide. 

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is between 3.25m and 3.9m.`},SA04:{description:"Risk of pedestrians tripping due to hazards",green:"No trip hazards, level clear surface.",amber:"Few trip hazards.",red:"Many trip hazards.",critical:"There are level differences of greater than 13mm with no tactile information and colour contrast to help identify them."},SA05:{description:"Cyclist conflict with kerbside activity, including risk of 'dooring' ",green:"Kerbside activity is well-managed with no or minimal conflict with cyclists. ",amber:"Less frequent kerbside activity, and conflict with cyclists is well-managed.",red:"Frequent kerbside activity for cyclists to contend with. Conflict with cyclists is not well-managed.",critical:`Cycle facility next to parking/loading facility, without a buffer of at least 0.5m.

Or, an unprotected cycle lane is next to a frequently-used bus layby.`},SA06:{description:"Ability of pedestrians to cross the street safely on desire lines",green:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 50-100m. 

On quieter streets (<8,000vpd), there are controlled crossings or only one lane of traffic to cross.`,amber:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 100-200m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross on desire lines.`,red:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 200-400m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross.`,critical:`On very busy streets (>8,000vpd) controlled crossings (including zebra crossings) are not present or more than 400m apart.

On quieter streets (<8,000vpd), desire lines are blocked by parking and loading. `},SA07:{description:"Suitability of pedestrian crossings in context",green:`On very busy streets (>8,000vpd), signal crossings rest on green for pedestrians or have rapid response.

On quieter streets (<8,000vpd), crossing points are controlled crossings.`,amber:`On very busy streets (>8,000vpd), signal crossings are provided for pedestrians.

On quieter streets (<8,000vpd), crossing points have effective implied priority for pedestrians.`,red:`On very busy streets (>8,000vpd), there are uncontrolled crossings or zebra/parallel crossings.

On quieter streets (<8,000vpd), crossing points have no implied priority or there are no crossing points.`,critical:`On very busy streets (>8,000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic.

At signal junctions there are arms with dropped kerbs and tactile paving but no green pedestrian symbol.`},SA08:{description:"85th percentile speed of motor traffic (where cyclists are not protected or pedestrians are crossing uncontrolled)",green:`85th percentile speed is under 20mph.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:"85th percentile speed is between 20mph and 25mph.",red:"85th percentile speed is over 25mph.",critical:"85th percentile speed is over 30mph."},SA09:{description:"Volume of motor traffic at the busiest hour (where cyclists are not protected or pedestrians cross uncontrolled)",green:`<200 vehicles in the busiest hour.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:`200-499 vehicles in the busiest hour.

And, less than 2% of traffic is HGVs.`,red:`500-1,000 vehicles in the busiest hour.

Or, 2-5% of traffic is HGVs where there are 200-499 vehicles in the busiest hour.`,critical:`>1,000 vehicles in the busiest hour.

Or, over 5% of traffic is HGVs where there are over 500 vehicles in the busiest hour.`},SA10:{description:"Required crossing speed at signal crossings (risk of pedestrians coming into conflict with traffic).",green:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1m/s.",amber:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1.2m/s.",red:"There are no detectors to extend crossing times, but pedestrians who start crossing at the end of the 'invitation to cross' can cross at a speed of 1.2m/s and get across the whole crossing in time.",critical:"Pedestrians who start crossing at the end of the 'invitation to cross' must cross at a speed of over 1.2m/s to get across the whole crossing in time."},SA11:{description:"Clear walking and wheeling spaces free of permanent obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",green:">3m clear footway width and pedestrian comfort is good (PCL of A-C).",amber:`Where the footway is next to the carriageway, there is:
• 2m-3m clear footway width and pedestrian comfort is good (PCL of A-C).
• >3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is 1.5m-3m.`,red:`Where the footway is next to the carriageway, there is:
• <2m clear footway width but pedestrian comfort is good (PCL of A-C)
• 2m-3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is <1.5m.`,critical:`Where the footway is next to the carriageway, there is:
• <1m clear footway width on any footway
• <1.5m clear footway width for over 6m
• 1m-2m clear footway width with a Pedestrian Comfort Level of D-E

Or there is no footway.`},SA12:{description:"Effective width next to tram line on a straight run or a curve",green:"Physical protection is provided for cyclists.",amber:">2.4m from tramline edge to kerb.",red:"2.4m from tramline edge to kerb.",critical:`<2.4m from tramline edge to kerb on a straight run.

Insufficient clearance on a curve.`},SA13:{description:"Crossing angle (between cyclist desire line and tram or train rails).",green:"Crossing angle between 80 and 90 degrees with track filler creating a smooth crossing for cyclists.",amber:"Crossing angle between 80 and 90 degrees (or between 60 and 80 degrees with track filler creating a smooth crossing for cyclists).",red:"Crossing angle between 60 and 80 degrees.",critical:"Crossing angle less than 60 degrees."},SA14:{description:`Cycling surface and maintenance defects:
• sharp gradients (≥12.5%)
• non cycle friendly ironworks
• raised/sunken covers or gullies
• potholes
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA15:{description:`Walking/wheeling surface and maintenance defects:
• steep camber (horizontal gradient >2.5% )
• steep longitudinal gradients (≥8% if under 1m, ≥5% if 1m or over) 
• missing dropped kerbs
• non flush tables
• misleading tactile information
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation
`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA16:{description:"Presence of guard railing",green:"No guard railing anywhere on the route.",amber:"Minimal guard railing, used to address a clear safety issue such as a level difference.",red:"Guard railing used to control behaviour in complex environments.",critical:"Guard railing used as standard without consideration of inherent safety risks."},ST20:{description:"Interactions at bus stops.",green:"At bus stops, cyclists are protected from buses and traffic and interactions between pedestrians and cyclists are likely to be low-level.",amber:"At bus stops, cyclists are protected from buses and traffic, but there are likely to be medium-level interactions between pedestrians and cyclists.",red:"At bus stops, cyclists regularly have to wait behind buses or overtake them in general traffic lanes. Or, there are likely to be high-level interactions between pedestrians and cyclists.",critical:""}};function _n(n){let e,r,t,o=n[0].critical+"",l;return{c(){e=k("p"),r=k("b"),r.textContent="Critical",t=N(`
    : `),l=N(o)},m(i,a){w(i,e,a),_(e,r),_(e,t),_(e,l)},p(i,a){a&1&&o!==(o=i[0].critical+"")&&re(l,o)},d(i){i&&v(e)}}}function dl(n){let e,r,t,o=n[0].green+"",l,i,a,s,c,u=n[0].amber+"",f,p,d,g,j,L=n[0].red+"",m,h,A,C=n[0].critical&&_n(n);return{c(){e=k("p"),r=k("b"),r.textContent="2",t=N(`
  : `),l=N(o),i=M(),a=k("p"),s=k("b"),s.textContent="1",c=N(`
  : `),f=N(u),p=M(),d=k("p"),g=k("b"),g.textContent="0",j=N(`
  : `),m=N(L),h=M(),C&&C.c(),A=Ce()},m(S,$){w(S,e,$),_(e,r),_(e,t),_(e,l),w(S,i,$),w(S,a,$),_(a,s),_(a,c),_(a,f),w(S,p,$),w(S,d,$),_(d,g),_(d,j),_(d,m),w(S,h,$),C&&C.m(S,$),w(S,A,$)},p(S,[$]){$&1&&o!==(o=S[0].green+"")&&re(l,o),$&1&&u!==(u=S[0].amber+"")&&re(f,u),$&1&&L!==(L=S[0].red+"")&&re(m,L),S[0].critical?C?C.p(S,$):(C=_n(S),C.c(),C.m(A.parentNode,A)):C&&(C.d(1),C=null)},i:ee,o:ee,d(S){S&&(v(e),v(i),v(a),v(p),v(d),v(h),v(A)),C&&C.d(S)}}}function ml(n,e,r){let{metric:t}=e;return n.$$set=o=>{"metric"in o&&r(0,t=o.metric)},[t]}class yt extends le{constructor(e){super(),ie(this,e,ml,dl,oe,{metric:0})}}function gn(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function hn(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function _l(n){let e,r,t,o,l,i;const a=n[5].default,s=Be(a,n,n[4],null);let c=V(n[2]),u=[];for(let f=0;f<c.length;f+=1)u[f]=bn(gn(n,c,f));return{c(){e=k("label"),s&&s.c(),r=M(),t=k("select");for(let f=0;f<u.length;f+=1)u[f].c();n[0]===void 0&&io(()=>n[10].call(t))},m(f,p){w(f,e,p),s&&s.m(e,null),_(e,r),_(e,t);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(t,null);ln(t,n[0],!0),o=!0,l||(i=[q(t,"change",n[10]),q(t,"change",n[7])],l=!0)},p(f,p){if(s&&s.p&&(!o||p&16)&&Te(s,a,f,f[4],o?Oe(a,f[4],p,null):Ee(f[4]),null),p&4){c=V(f[2]);let d;for(d=0;d<c.length;d+=1){const g=gn(f,c,d);u[d]?u[d].p(g,p):(u[d]=bn(g),u[d].c(),u[d].m(t,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=c.length}p&5&&ln(t,f[0])},i(f){o||(b(s,f),o=!0)},o(f){y(s,f),o=!1},d(f){f&&v(e),s&&s.d(f),de(u,f),l=!1,ye(i)}}}function gl(n){let e,r,t,o;const l=n[5].default,i=Be(l,n,n[4],null);let a=V(n[2]),s=[];for(let c=0;c<a.length;c+=1)s[c]=$n(hn(n,a,c));return{c(){e=k("fieldset"),i&&i.c(),r=M(),t=k("div");for(let c=0;c<s.length;c+=1)s[c].c();I(t,"class","svelte-1vb210n"),we(t,"horiz_radio",n[1]=="horiz-radio")},m(c,u){w(c,e,u),i&&i.m(e,null),_(e,r),_(e,t);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(t,null);o=!0},p(c,u){if(i&&i.p&&(!o||u&16)&&Te(i,l,c,c[4],o?Oe(l,c[4],u,null):Ee(c[4]),null),u&5){a=V(c[2]);let f;for(f=0;f<a.length;f+=1){const p=hn(c,a,f);s[f]?s[f].p(p,u):(s[f]=$n(p),s[f].c(),s[f].m(t,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=a.length}(!o||u&2)&&we(t,"horiz_radio",c[1]=="horiz-radio")},i(c){o||(b(i,c),o=!0)},o(c){y(i,c),o=!1},d(c){c&&v(e),i&&i.d(c),de(s,c)}}}function bn(n){let e,r=n[12]+"",t;return{c(){e=k("option"),t=N(r),e.__value=n[11],pe(e,e.__value)},m(o,l){w(o,e,l),_(e,t)},p:ee,d(o){o&&v(e)}}}function $n(n){let e,r,t,o=n[12]+"",l,i,a,s,c;return a=it(n[9][0]),{c(){e=k("label"),r=k("input"),t=M(),l=N(o),i=M(),I(r,"type","radio"),r.__value=n[11],pe(r,r.__value),a.p(r)},m(u,f){w(u,e,f),_(e,r),r.checked=r.__value===n[0],_(e,t),_(e,l),_(e,i),s||(c=[q(r,"change",n[8]),q(r,"change",n[6])],s=!0)},p(u,f){f&5&&(r.checked=r.__value===u[0])},d(u){u&&v(e),a.r(),s=!1,ye(c)}}}function hl(n){let e,r,t,o;const l=[gl,_l],i=[];function a(s,c){return s[1]=="horiz-radio"||s[1]=="vert-radio"?0:s[1]=="dropdown"?1:-1}return~(e=a(n))&&(r=i[e]=l[e](n)),{c(){r&&r.c(),t=Ce()},m(s,c){~e&&i[e].m(s,c),w(s,t,c),o=!0},p(s,[c]){let u=e;e=a(s),e===u?~e&&i[e].p(s,c):(r&&(se(),y(i[u],1,1,()=>{i[u]=null}),ae()),~e?(r=i[e],r?r.p(s,c):(r=i[e]=l[e](s),r.c()),b(r,1),r.m(t.parentNode,t)):r=null)},i(s){o||(b(r),o=!0)},o(s){y(r),o=!1},d(s){s&&v(t),~e&&i[e].d(s)}}}function bl(n,e,r){let{$$slots:t={},$$scope:o}=e,{k:l}=e,{value:i}=e,{choices:a}=e,s=a[0].length==2?a:a.map(g=>[g,g]);const c=[[]];function u(g){Ae.call(this,n,g)}function f(g){Ae.call(this,n,g)}function p(){i=this.__value,r(0,i),r(2,s)}function d(){i=Uo(this),r(0,i),r(2,s)}return n.$$set=g=>{"k"in g&&r(1,l=g.k),"value"in g&&r(0,i=g.value),"choices"in g&&r(3,a=g.choices),"$$scope"in g&&r(4,o=g.$$scope)},[i,l,s,a,o,t,u,f,p,c,d]}class Fe extends le{constructor(e){super(),ie(this,e,bl,hl,oe,{k:1,value:0,choices:3})}}let Pt=Ie(void 0),W=Ie($l());function ge(n){return{type:"FeatureCollection",features:n}}let Y=Ie({kind:"neutral"}),Yt=Ie(new URLSearchParams(window.location.search).has("google")?"google":"dataviz");function po(n){return"links"in n&&"jats"in n&&"bus_stops"&&"crossings"in n}function $l(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if(po(n))return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[]}}function kn(n){let e,r;return e=new ve({props:{data:ge(n[3].links),$$slots:{default:[kl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.data=ge(t[3].links)),o&22&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function kl(n){let e,r;return e=new qe({props:{paint:{"line-color":n[1]=="links"?["get","color"]:"black","line-width":n[1]=="links"&&n[2]?["case",["to-boolean",n[2]],6,15]:6}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&6&&(l.paint={"line-color":t[1]=="links"?["get","color"]:"black","line-width":t[1]=="links"&&t[2]?["case",["to-boolean",t[2]],6,15]:6}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function wn(n){let e,r;return e=new ve({props:{data:ge(n[3].bus_stops),$$slots:{default:[wl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.data=ge(t[3].bus_stops)),o&22&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function wl(n){let e,r;return e=new Ye({props:{layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":n[1]=="bus_stops"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":n[1]=="bus_stops"&&n[2]?["case",["to-boolean",n[2]],0,5]:0}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&6&&(l.paint={"icon-color":t[1]=="bus_stops"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":t[1]=="bus_stops"&&t[2]?["case",["to-boolean",t[2]],0,5]:0}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function vn(n){let e,r;return e=new ve({props:{data:ge(n[3].crossings),$$slots:{default:[vl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.data=ge(t[3].crossings)),o&22&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function vl(n){let e,r;return e=new Ye({props:{layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":n[1]=="crossings"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":n[1]=="crossings"&&n[2]?["case",["to-boolean",n[2]],0,5]:0}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&6&&(l.paint={"icon-color":t[1]=="crossings"?["get","color"]:"black","icon-halo-color":"black","icon-halo-width":t[1]=="crossings"&&t[2]?["case",["to-boolean",t[2]],0,5]:0}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function yn(n){let e,r;return e=new ve({props:{data:ge(n[3].jats),$$slots:{default:[yl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.data=ge(t[3].jats)),o&18&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function yl(n){let e,r;return e=new Ze({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-color":n[1]=="jats"?["get","color"]:"black","circle-radius":20}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"circle-color":"rgba(0,0,0,0)","circle-stroke-color":t[1]=="jats"?["get","color"]:"black","circle-radius":20}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Al(n){let e,r,t,o,l,i=n[0]!="links"&&kn(n),a=n[0]!="bus_stops"&&wn(n),s=n[0]!="crossings"&&vn(n),c=n[0]!="jats"&&yn(n);return{c(){i&&i.c(),e=M(),a&&a.c(),r=M(),s&&s.c(),t=M(),c&&c.c(),o=Ce()},m(u,f){i&&i.m(u,f),w(u,e,f),a&&a.m(u,f),w(u,r,f),s&&s.m(u,f),w(u,t,f),c&&c.m(u,f),w(u,o,f),l=!0},p(u,[f]){u[0]!="links"?i?(i.p(u,f),f&1&&b(i,1)):(i=kn(u),i.c(),b(i,1),i.m(e.parentNode,e)):i&&(se(),y(i,1,1,()=>{i=null}),ae()),u[0]!="bus_stops"?a?(a.p(u,f),f&1&&b(a,1)):(a=wn(u),a.c(),b(a,1),a.m(r.parentNode,r)):a&&(se(),y(a,1,1,()=>{a=null}),ae()),u[0]!="crossings"?s?(s.p(u,f),f&1&&b(s,1)):(s=vn(u),s.c(),b(s,1),s.m(t.parentNode,t)):s&&(se(),y(s,1,1,()=>{s=null}),ae()),u[0]!="jats"?c?(c.p(u,f),f&1&&b(c,1)):(c=yn(u),c.c(),b(c,1),c.m(o.parentNode,o)):c&&(se(),y(c,1,1,()=>{c=null}),ae())},i(u){l||(b(i),b(a),b(s),b(c),l=!0)},o(u){y(i),y(a),y(s),y(c),l=!1},d(u){u&&(v(e),v(r),v(t),v(o)),i&&i.d(u),a&&a.d(u),s&&s.d(u),c&&c.d(u)}}}function Cl(n,e,r){let t;te(n,W,a=>r(3,t=a));let{except:o}=e,{showColor:l=""}=e,{showMissingProperty:i=null}=e;return n.$$set=a=>{"except"in a&&r(0,o=a.except),"showColor"in a&&r(1,l=a.showColor),"showMissingProperty"in a&&r(2,i=a.showMissingProperty)},[o,l,i,t]}class Ge extends le{constructor(e){super(),ie(this,e,Cl,Al,oe,{except:0,showColor:1,showMissingProperty:2})}}function An(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function Cn(n){let e,r,t=n[6].properties.name+"",o,l,i,a,s,c;function u(p){n[5](p,n[6])}let f={k:"horiz-radio",choices:je()};return n[6].properties.st20!==void 0&&(f.value=n[6].properties.st20),i=new Fe({props:f}),ue.push(()=>me(i,"value",u)),{c(){e=k("li"),r=k("span"),o=N(t),l=M(),B(i.$$.fragment),s=M(),X(r,"color",n[6].properties.color)},m(p,d){w(p,e,d),_(e,r),_(r,o),_(e,l),T(i,e,null),_(e,s),c=!0},p(p,d){n=p,(!c||d&2)&&t!==(t=n[6].properties.name+"")&&re(o,t),d&2&&X(r,"color",n[6].properties.color);const g={};!a&&d&2&&(a=!0,g.value=n[6].properties.st20,_e(()=>a=!1)),i.$set(g)},i(p){c||(b(i.$$.fragment,p),c=!0)},o(p){y(i.$$.fragment,p),c=!1},d(p){p&&v(e),E(i)}}}function jl(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g=V(n[1].bus_stops),j=[];for(let m=0;m<g.length;m+=1)j[m]=Cn(An(n,g,m));const L=m=>y(j[m],1,1,()=>{j[m]=null});return u=new yt({props:{metric:n[2]}}),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=M(),o=k("h2"),o.textContent="ST20: bus stops",l=M(),i=k("p"),i.textContent=`${n[2].description}`,a=M(),s=k("ol");for(let m=0;m<j.length;m+=1)j[m].c();c=M(),B(u.$$.fragment),I(e,"slot","sidebar")},m(m,h){w(m,e,h),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(e,a),_(e,s);for(let A=0;A<j.length;A+=1)j[A]&&j[A].m(s,null);_(e,c),T(u,e,null),f=!0,p||(d=q(r,"click",n[4]),p=!0)},p(m,h){if(h&2){g=V(m[1].bus_stops);let A;for(A=0;A<g.length;A+=1){const C=An(m,g,A);j[A]?(j[A].p(C,h),b(j[A],1)):(j[A]=Cn(C),j[A].c(),b(j[A],1),j[A].m(s,null))}for(se(),A=g.length;A<j.length;A+=1)L(A);ae()}},i(m){if(!f){for(let h=0;h<g.length;h+=1)b(j[h]);b(u.$$.fragment,m),f=!0}},o(m){j=j.filter(Boolean);for(let h=0;h<j.length;h+=1)y(j[h]);y(u.$$.fragment,m),f=!1},d(m){m&&v(e),de(j,m),E(u),p=!1,d()}}}function Sl(n){let e,r,t;return r=new Ge({props:{showColor:"bus_stops",except:"",showMissingProperty:["get","st20"]}}),{c(){e=k("div"),B(r.$$.fragment),I(e,"slot","map")},m(o,l){w(o,e,l),T(r,e,null),t=!0},p:ee,i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&v(e),E(r)}}}function Ll(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Sl],sidebar:[jl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=q(window,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function zl(n,e,r){let t,o;te(n,Y,c=>r(0,t=c)),te(n,W,c=>r(1,o=c));let l=Ve.ST20;function i(c){c.key=="Escape"&&x(Y,t={kind:"neutral"},t)}const a=()=>x(Y,t={kind:"neutral"},t);function s(c,u){n.$$.not_equal(u.properties.st20,c)&&(u.properties.st20=c,W.set(o))}return[t,o,l,i,a,s]}class Ml extends le{constructor(e){super(),ie(this,e,zl,Ll,oe,{})}}function Bl(n){let e,r;const t=n[4].default,o=Be(t,n,n[6],null);return{c(){e=k("span"),o&&o.c(),I(e,"class","dot svelte-117v9mi"),we(e,"outline",n[3]),X(e,"background-color",n[3]?void 0:n[1]),X(e,"border-color",n[3]?n[1]:void 0),X(e,"width",n[2]),X(e,"height",n[2])},m(l,i){w(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&64)&&Te(o,t,l,l[6],r?Oe(t,l[6],i,null):Ee(l[6]),null),(!r||i&8)&&we(e,"outline",l[3]),i&10&&X(e,"background-color",l[3]?void 0:l[1]),i&10&&X(e,"border-color",l[3]?l[1]:void 0),i&4&&X(e,"width",l[2]),i&4&&X(e,"height",l[2])},i(l){r||(b(o,l),r=!0)},o(l){y(o,l),r=!1},d(l){l&&v(e),o&&o.d(l)}}}function Tl(n){let e,r,t;function o(i){n[5](i)}let l={draggable:!0,$$slots:{default:[Bl]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.lngLat=n[0]),e=new Ke({props:l}),ue.push(()=>me(e,"lngLat",o)),{c(){B(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,[a]){const s={};a&78&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.lngLat=i[0],_e(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function El(n,e,r){let{$$slots:t={},$$scope:o}=e,{lngLat:l}=e,{color:i}=e,{radius:a="30px"}=e,{outline:s=!1}=e;function c(u){l=u,r(0,l)}return n.$$set=u=>{"lngLat"in u&&r(0,l=u.lngLat),"color"in u&&r(1,i=u.color),"radius"in u&&r(2,a=u.radius),"outline"in u&&r(3,s=u.outline),"$$scope"in u&&r(6,o=u.$$scope)},[l,i,a,s,t,c,o]}class en extends le{constructor(e){super(),ie(this,e,El,Tl,oe,{lngLat:0,color:1,radius:2,outline:3})}}const{window:Ol}=wt;function Dl(n){let e;return{c(){e=N("ST20: bus stops")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function Nl(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g;function j(m){n[8](m)}let L={k:"horiz-radio",choices:je(),$$slots:{default:[Dl]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].properties.st20!==void 0&&(L.value=n[1].bus_stops[n[0]].properties.st20),u=new Fe({props:L}),ue.push(()=>me(u,"value",j)),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=M(),o=k("button"),o.textContent="Delete bus stop",l=M(),i=k("label"),a=N(`Name:
      `),s=k("input"),c=M(),B(u.$$.fragment),I(s,"type","text"),I(e,"slot","sidebar")},m(m,h){w(m,e,h),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(i,a),_(i,s),pe(s,n[1].bus_stops[n[0]].properties.name),_(e,c),T(u,e,null),p=!0,d||(g=[q(r,"click",n[6]),q(o,"click",n[4]),q(s,"input",n[7])],d=!0)},p(m,h){h&3&&s.value!==m[1].bus_stops[m[0]].properties.name&&pe(s,m[1].bus_stops[m[0]].properties.name);const A={};h&512&&(A.$$scope={dirty:h,ctx:m}),!f&&h&3&&(f=!0,A.value=m[1].bus_stops[m[0]].properties.st20,_e(()=>f=!1)),u.$set(A)},i(m){p||(b(u.$$.fragment,m),p=!0)},o(m){y(u.$$.fragment,m),p=!1},d(m){m&&v(e),E(u),d=!1,ye(g)}}}function Il(n){let e,r;return e=new Ye({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Fl(n){let e,r;return{c(){e=k("img"),$t(e.src,r=uo)||I(e,"src",r),I(e,"alt","")},m(t,o){w(t,e,o)},p:ee,d(t){t&&v(e)}}}function Pl(n){let e,r,t,o,l,i,a,s;r=new Ge({props:{except:"bus_stops"}}),o=new ve({props:{data:ge(n[1].bus_stops),generateId:!0,$$slots:{default:[Il]},$$scope:{ctx:n}}});function c(f){n[5](f)}let u={color:n[1].bus_stops[n[0]].properties.color,$$slots:{default:[Fl]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(u.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),i=new en({props:u}),ue.push(()=>me(i,"lngLat",c)),{c(){e=k("div"),B(r.$$.fragment),t=M(),B(o.$$.fragment),l=M(),B(i.$$.fragment),I(e,"slot","map")},m(f,p){w(f,e,p),T(r,e,null),_(e,t),T(o,e,null),_(e,l),T(i,e,null),s=!0},p(f,p){const d={};p&2&&(d.data=ge(f[1].bus_stops)),p&513&&(d.$$scope={dirty:p,ctx:f}),o.$set(d);const g={};p&3&&(g.color=f[1].bus_stops[f[0]].properties.color),p&512&&(g.$$scope={dirty:p,ctx:f}),!a&&p&3&&(a=!0,g.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,_e(()=>a=!1)),i.$set(g)},i(f){s||(b(r.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),E(r),E(o),E(i)}}}function Ul(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Pl],sidebar:[Nl]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=q(Ol,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function ql(n,e,r){let t,o;te(n,W,p=>r(1,t=p)),te(n,Y,p=>r(2,o=p));let{idx:l}=e;function i(p){p.key=="Escape"&&x(Y,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this bus stop?")&&(x(Y,o={kind:"neutral"},o),await st(),t.bus_stops.splice(l,1),W.set(t))}function s(p){n.$$.not_equal(t.bus_stops[l].geometry.coordinates,p)&&(t.bus_stops[l].geometry.coordinates=p,W.set(t))}const c=()=>x(Y,o={kind:"neutral"},o);function u(){t.bus_stops[l].properties.name=this.value,W.set(t)}function f(p){n.$$.not_equal(t.bus_stops[l].properties.st20,p)&&(t.bus_stops[l].properties.st20=p,W.set(t))}return n.$$set=p=>{"idx"in p&&r(0,l=p.idx)},[l,t,o,i,a,s,c,u,f]}class Rl extends le{constructor(e){super(),ie(this,e,ql,Ul,oe,{idx:0})}}function Gl(n){let e,r,t;function o(i){n[1](i)}let l={k:"dropdown",choices:Jl()};return n[0]!==void 0&&(l.value=n[0]),e=new Fe({props:l}),ue.push(()=>me(e,"value",o)),{c(){B(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,[a]){const s={};!r&&a&1&&(r=!0,s.value=i[0],_e(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Jl(){let n=[["streets","MapTiler Streets"],["dataviz","MapTiler Dataviz"],["uk-openzoomstack-light","OS Open Zoomstack"],["openstreetmap","OpenStreetMap"]];return new URLSearchParams(window.location.search).has("google")&&n.splice(0,1,["google","Google satellite"]),n}function Ql(n,e,r){let t;te(n,Yt,l=>r(0,t=l));function o(l){t=l,Yt.set(t)}return[t,o]}class Hl extends le{constructor(e){super(),ie(this,e,Ql,Gl,oe,{})}}function jn(n,e,r){const t=n.slice();return t[1]=e[r][0],t[2]=e[r][1],t}function Sn(n){let e,r,t,o=n[1]+"",l,i;return{c(){e=k("li"),r=k("span"),t=M(),l=N(o),i=M(),I(r,"class","svelte-kzgqtg"),X(r,"background",n[2])},m(a,s){w(a,e,s),_(e,r),_(e,t),_(e,l),_(e,i)},p(a,s){s&1&&X(r,"background",a[2]),s&1&&o!==(o=a[1]+"")&&re(l,o)},d(a){a&&v(e)}}}function Kl(n){let e,r=V(n[0]),t=[];for(let o=0;o<r.length;o+=1)t[o]=Sn(jn(n,r,o));return{c(){e=k("ul");for(let o=0;o<t.length;o+=1)t[o].c()},m(o,l){w(o,e,l);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(o,[l]){if(l&1){r=V(o[0]);let i;for(i=0;i<r.length;i+=1){const a=jn(o,r,i);t[i]?t[i].p(a,l):(t[i]=Sn(a),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=r.length}},i:ee,o:ee,d(o){o&&v(e),de(t,o)}}}function Wl(n,e,r){let{rows:t}=e;return n.$$set=o=>{"rows"in o&&r(0,t=o.rows)},[t]}class Zl extends le{constructor(e){super(),ie(this,e,Wl,Kl,oe,{rows:0})}}const Xl=n=>({dialog:n&1}),Ln=n=>({dialog:n[0]});function Vl(n){let e,r,t,o,l;const i=n[4].default,a=Be(i,n,n[3],Ln);return{c(){e=k("dialog"),r=k("article"),a&&a.c(),e.open=!0},m(s,c){w(s,e,c),_(e,r),a&&a.m(r,null),n[6](e),t=!0,o||(l=[q(window,"click",n[1]),q(window,"keydown",n[2]),q(e,"close",n[5])],o=!0)},p(s,[c]){a&&a.p&&(!t||c&9)&&Te(a,i,s,s[3],t?Oe(i,s[3],c,Xl):Ee(s[3]),Ln)},i(s){t||(b(a,s),t=!0)},o(s){y(a,s),t=!1},d(s){s&&v(e),a&&a.d(s),n[6](null),o=!1,ye(l)}}}function Yl(n,e,r){let{$$slots:t={},$$scope:o}=e,l;function i(u){l.open&&u.target==l&&l.close()}function a(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),l.close())}function s(u){Ae.call(this,n,u)}function c(u){ue[u?"unshift":"push"](()=>{l=u,r(0,l)})}return n.$$set=u=>{"$$scope"in u&&r(3,o=u.$$scope)},[l,i,a,o,t,s,c]}class At extends le{constructor(e){super(),ie(this,e,Yl,Vl,oe,{})}}function zn(n,e,r){const t=n.slice();return t[3]=e[r],t}function Mn(n,e,r){const t=n.slice();return t[6]=e[r],t}function Bn(n){let e,r;return{c(){e=k("span"),r=N(` 
    `),X(e,"background",n[6]),X(e,"width","100%"),X(e,"border","1px solid black")},m(t,o){w(t,e,o),_(e,r)},p(t,o){o&1&&X(e,"background",t[6])},d(t){t&&v(e)}}}function xl(n){let e,r=n[3]+"",t;return{c(){e=k("span"),t=N(r)},m(o,l){w(o,e,l),_(e,t)},p(o,l){l&2&&r!==(r=o[3]+"")&&re(t,r)},d(o){o&&v(e)}}}function ei(n){let e,r=n[3].toFixed(n[2])+"",t;return{c(){e=k("span"),t=N(r)},m(o,l){w(o,e,l),_(e,t)},p(o,l){l&6&&r!==(r=o[3].toFixed(o[2])+"")&&re(t,r)},d(o){o&&v(e)}}}function Tn(n){let e;function r(l,i){return l[2]>0?ei:xl}let t=r(n),o=t(n);return{c(){o.c(),e=Ce()},m(l,i){o.m(l,i),w(l,e,i)},p(l,i){t===(t=r(l))&&o?o.p(l,i):(o.d(1),o=t(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&v(e),o.d(l)}}}function ti(n){let e,r,t,o=V(n[0]),l=[];for(let s=0;s<o.length;s+=1)l[s]=Bn(Mn(n,o,s));let i=V(n[1]),a=[];for(let s=0;s<i.length;s+=1)a[s]=Tn(zn(n,i,s));return{c(){e=k("div");for(let s=0;s<l.length;s+=1)l[s].c();r=M(),t=k("div");for(let s=0;s<a.length;s+=1)a[s].c();X(e,"display","flex"),X(t,"display","flex"),X(t,"justify-content","space-between")},m(s,c){w(s,e,c);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);w(s,r,c),w(s,t,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(t,null)},p(s,[c]){if(c&1){o=V(s[0]);let u;for(u=0;u<o.length;u+=1){const f=Mn(s,o,u);l[u]?l[u].p(f,c):(l[u]=Bn(f),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=o.length}if(c&6){i=V(s[1]);let u;for(u=0;u<i.length;u+=1){const f=zn(s,i,u);a[u]?a[u].p(f,c):(a[u]=Tn(f),a[u].c(),a[u].m(t,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=i.length}},i:ee,o:ee,d(s){s&&(v(e),v(r),v(t)),de(l,s),de(a,s)}}}function ni(n,e,r){let{colorScale:t}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return n.$$set=i=>{"colorScale"in i&&r(0,t=i.colorScale),"limits"in i&&r(1,o=i.limits),"decimalPlaces"in i&&r(2,l=i.decimalPlaces)},[t,o,l]}class ri extends le{constructor(e){super(),ie(this,e,ni,ti,oe,{colorScale:0,limits:1,decimalPlaces:2})}}function oi(n,e){let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function li(n){let e;return{c(){e=N("Bus stops")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function En(n){let e,r,t,o,l;return o=new ri({props:{colorScale:n[1],limits:n[2]}}),{c(){e=k("div"),r=k("p"),r.textContent="Peak hourly frequency:",t=M(),B(o.$$.fragment),I(e,"class","svelte-yxmabo")},m(i,a){w(i,e,a),_(e,r),_(e,t),T(o,e,null),l=!0},p:ee,i(i){l||(b(o.$$.fragment,i),l=!0)},o(i){y(o.$$.fragment,i),l=!1},d(i){i&&v(e),E(o)}}}function ii(n){let e,r,t,o=n[4].stop_name+"",l,i,a,s,c,u=n[4].peak+"",f,p,d,g,j,L=n[4].peak_description+"",m,h,A,C,S,$=n[4].total+"",z,D,G=n[4].total_description+"",P,Z;return{c(){e=k("p"),r=N("Stop name: "),t=k("b"),l=N(o),i=M(),a=k("p"),s=N("Peak: "),c=k("b"),f=N(u),p=N(`
        buses during the busiest hour of any day`),d=M(),g=k("p"),j=N("The peak hour is "),m=N(L),h=M(),A=k("p"),C=N("Total buses per day: "),S=k("b"),z=N($),D=N(`
        (for `),P=N(G),Z=N(", the busiest day of the week)")},m(O,J){w(O,e,J),_(e,r),_(e,t),_(t,l),w(O,i,J),w(O,a,J),_(a,s),_(a,c),_(c,f),_(a,p),w(O,d,J),w(O,g,J),_(g,j),_(g,m),w(O,h,J),w(O,A,J),_(A,C),_(A,S),_(S,z),_(A,D),_(A,P),_(A,Z)},p(O,J){J&16&&o!==(o=O[4].stop_name+"")&&re(l,o),J&16&&u!==(u=O[4].peak+"")&&re(f,u),J&16&&L!==(L=O[4].peak_description+"")&&re(m,L),J&16&&$!==($=O[4].total+"")&&re(z,$),J&16&&G!==(G=O[4].total_description+"")&&re(P,G)},d(O){O&&(v(e),v(i),v(a),v(d),v(g),v(h),v(A))}}}function si(n){let e,r;return e=new at({props:{$$slots:{default:[ii,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&48&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ai(n){let e,r;return e=new Ze({props:{sourceLayer:"bus_stops",paint:{"circle-color":qo(["get","peak"],n[2],n[1]),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},manageHoverState:!0,$$slots:{default:[si]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),o&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ci(n){let e,r,t,o,l;e=new ao({props:{$$slots:{default:[li]},$$scope:{ctx:n}}}),e.$on("click",n[3]);let i=n[0]&&En(n);return o=new co({props:{url:"pmtiles://https://atip.uk/layers/v1/bus_stops.pmtiles",$$slots:{default:[ai]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=M(),i&&i.c(),t=M(),B(o.$$.fragment)},m(a,s){T(e,a,s),w(a,r,s),i&&i.m(a,s),w(a,t,s),T(o,a,s),l=!0},p(a,[s]){const c={};s&32&&(c.$$scope={dirty:s,ctx:a}),e.$set(c),a[0]?i?(i.p(a,s),s&1&&b(i,1)):(i=En(a),i.c(),b(i,1),i.m(t.parentNode,t)):i&&(se(),y(i,1,1,()=>{i=null}),ae());const u={};s&33&&(u.$$scope={dirty:s,ctx:a}),o.$set(u)},i(a){l||(b(e.$$.fragment,a),b(i),b(o.$$.fragment,a),l=!0)},o(a){y(e.$$.fragment,a),y(i),y(o.$$.fragment,a),l=!1},d(a){a&&(v(r),v(t)),E(e,a),i&&i.d(a),E(o,a)}}}function ui(n,e,r){let t=!1;return[t,["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],[0,3,10,20,30,100],()=>r(0,t=!t)]}class fi extends le{constructor(e){super(),ie(this,e,ui,ci,oe,{})}}function pi(n){let e;return{c(){e=N("Crossings")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function On(n){let e,r,t;return r=new Zl({props:{rows:n[1]}}),{c(){e=k("div"),B(r.$$.fragment),I(e,"class","svelte-yxmabo")},m(o,l){w(o,e,l),T(r,e,null),t=!0},p:ee,i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&v(e),E(r)}}}function di(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=k("p"),t=N(r),o=N(" crossing")},m(l,i){w(l,e,i),_(e,t),_(e,o)},p(l,i){i&8&&r!==(r=(l[3].class||"Unknown")+"")&&re(t,r)},d(l){l&&v(e)}}}function mi(n){let e,r;return e=new at({props:{$$slots:{default:[di,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function _i(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=k("p"),t=N(r),o=N(" crossing")},m(l,i){w(l,e,i),_(e,t),_(e,o)},p(l,i){i&8&&r!==(r=(l[3].class||"Unknown")+"")&&re(t,r)},d(l){l&&v(e)}}}function gi(n){let e,r;return e=new at({props:{$$slots:{default:[_i,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function hi(n){let e,r,t,o;return e=new qe({props:{sourceLayer:"crossings",filter:Ro,paint:{"line-color":sn(["get","class"],Object.fromEntries(n[1]),"red"),"line-width":3},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[mi]},$$scope:{ctx:n}}}),e.$on("click",Dn),t=new Ze({props:{sourceLayer:"crossings",filter:Go,paint:{"circle-color":sn(["get","class"],Object.fromEntries(n[1]),"red"),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[gi]},$$scope:{ctx:n}}}),t.$on("click",Dn),{c(){B(e.$$.fragment),r=M(),B(t.$$.fragment)},m(l,i){T(e,l,i),w(l,r,i),T(t,l,i),o=!0},p(l,i){const a={};i&1&&(a.layout={visibility:l[0]?"visible":"none"}),i&16&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&1&&(s.layout={visibility:l[0]?"visible":"none"}),i&16&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&v(r),E(e,l),E(t,l)}}}function bi(n){let e,r,t,o,l;e=new ao({props:{$$slots:{default:[pi]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let i=n[0]&&On(n);return o=new co({props:{url:"pmtiles://https://atip.uk/layers/v1/crossings.pmtiles",$$slots:{default:[hi]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=M(),i&&i.c(),t=M(),B(o.$$.fragment)},m(a,s){T(e,a,s),w(a,r,s),i&&i.m(a,s),w(a,t,s),T(o,a,s),l=!0},p(a,[s]){const c={};s&16&&(c.$$scope={dirty:s,ctx:a}),e.$set(c),a[0]?i?(i.p(a,s),s&1&&b(i,1)):(i=On(a),i.c(),b(i,1),i.m(t.parentNode,t)):i&&(se(),y(i,1,1,()=>{i=null}),ae());const u={};s&17&&(u.$$scope={dirty:s,ctx:a}),o.$set(u)},i(a){l||(b(e.$$.fragment,a),b(i),b(o.$$.fragment,a),l=!0)},o(a){y(e.$$.fragment,a),y(i),y(o.$$.fragment,a),l=!1},d(a){a&&(v(r),v(t)),E(e,a),i&&i.d(a),E(o,a)}}}function Dn(n){window.open(`https://www.openstreetmap.org/${n.detail.features[0].properties.osm}`,"_blank")}function $i(n,e,r){let t=!1;return[t,[["Zebra","#66C5CC"],["Parallel","#F6CF71"],["Pelican","#F89C74"],["Puffin","#DCB0F2"],["Toucan","#87C55F"],["Pegasus","#9EB9F3"],["Uncontrolled","#FE88B1"],["Signalised","#C9DB74"],["Unknown","red"]],()=>r(0,t=!t)]}class ki extends le{constructor(e){super(),ie(this,e,$i,bi,oe,{})}}function wi(n){let e,r;return e=new vt({}),e.$on("contextmenu",vi),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function vi(n){let e=n.detail.lngLat.lng,r=n.detail.lngLat.lat;window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${r},${e}&cbp=11,0,0,0,0`,"_blank")}class yi extends le{constructor(e){super(),ie(this,e,null,wi,oe,{})}}function Ai(n){let e,r,t,o,l,i,a;return r=new fi({}),o=new ki({}),i=new Hl({}),{c(){e=k("div"),B(r.$$.fragment),t=M(),B(o.$$.fragment),l=M(),B(i.$$.fragment),X(e,"display","flex"),X(e,"flex-direction","column")},m(s,c){w(s,e,c),T(r,e,null),_(e,t),T(o,e,null),_(e,l),T(i,e,null),a=!0},p:ee,i(s){a||(b(r.$$.fragment,s),b(o.$$.fragment,s),b(i.$$.fragment,s),a=!0)},o(s){y(r.$$.fragment,s),y(o.$$.fragment,s),y(i.$$.fragment,s),a=!1},d(s){s&&v(e),E(r),E(o),E(i)}}}function Ci(n){let e,r,t,o;return e=new yi({}),t=new xo({props:{$$slots:{default:[Ai]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=M(),B(t.$$.fragment)},m(l,i){T(e,l,i),w(l,r,i),T(t,l,i),o=!0},p(l,[i]){const a={};i&1&&(a.$$scope={dirty:i,ctx:l}),t.$set(a)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&v(r),E(e,l),E(t,l)}}}class ji extends le{constructor(e){super(),ie(this,e,null,Ci,oe,{})}}function Nn(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function In(n){let e,r,t=n[6].properties.name+"",o,l,i,a,s,c;function u(p){n[5](p,n[6])}let f={k:"horiz-radio",choices:je()};return n[6].properties.sa10!==void 0&&(f.value=n[6].properties.sa10),i=new Fe({props:f}),ue.push(()=>me(i,"value",u)),{c(){e=k("li"),r=k("span"),o=N(t),l=M(),B(i.$$.fragment),s=M(),X(r,"color",n[6].properties.color)},m(p,d){w(p,e,d),_(e,r),_(r,o),_(e,l),T(i,e,null),_(e,s),c=!0},p(p,d){n=p,(!c||d&2)&&t!==(t=n[6].properties.name+"")&&re(o,t),d&2&&X(r,"color",n[6].properties.color);const g={};!a&&d&2&&(a=!0,g.value=n[6].properties.sa10,_e(()=>a=!1)),i.$set(g)},i(p){c||(b(i.$$.fragment,p),c=!0)},o(p){y(i.$$.fragment,p),c=!1},d(p){p&&v(e),E(i)}}}function Si(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g=V(n[1].crossings),j=[];for(let m=0;m<g.length;m+=1)j[m]=In(Nn(n,g,m));const L=m=>y(j[m],1,1,()=>{j[m]=null});return u=new yt({props:{metric:n[2]}}),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=M(),o=k("h2"),o.textContent="SA10: pedestrian crossing speed",l=M(),i=k("p"),i.textContent=`${n[2].description}`,a=M(),s=k("ol");for(let m=0;m<j.length;m+=1)j[m].c();c=M(),B(u.$$.fragment),I(e,"slot","sidebar")},m(m,h){w(m,e,h),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(e,a),_(e,s);for(let A=0;A<j.length;A+=1)j[A]&&j[A].m(s,null);_(e,c),T(u,e,null),f=!0,p||(d=q(r,"click",n[4]),p=!0)},p(m,h){if(h&2){g=V(m[1].crossings);let A;for(A=0;A<g.length;A+=1){const C=Nn(m,g,A);j[A]?(j[A].p(C,h),b(j[A],1)):(j[A]=In(C),j[A].c(),b(j[A],1),j[A].m(s,null))}for(se(),A=g.length;A<j.length;A+=1)L(A);ae()}},i(m){if(!f){for(let h=0;h<g.length;h+=1)b(j[h]);b(u.$$.fragment,m),f=!0}},o(m){j=j.filter(Boolean);for(let h=0;h<j.length;h+=1)y(j[h]);y(u.$$.fragment,m),f=!1},d(m){m&&v(e),de(j,m),E(u),p=!1,d()}}}function Li(n){let e,r,t;return r=new Ge({props:{showColor:"crossings",except:"",showMissingProperty:["get","sa10"]}}),{c(){e=k("div"),B(r.$$.fragment),I(e,"slot","map")},m(o,l){w(o,e,l),T(r,e,null),t=!0},p:ee,i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&v(e),E(r)}}}function zi(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Li],sidebar:[Si]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=q(window,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function Mi(n,e,r){let t,o;te(n,Y,c=>r(0,t=c)),te(n,W,c=>r(1,o=c));let l=Ve.SA10;function i(c){c.key=="Escape"&&x(Y,t={kind:"neutral"},t)}const a=()=>x(Y,t={kind:"neutral"},t);function s(c,u){n.$$.not_equal(u.properties.sa10,c)&&(u.properties.sa10=c,W.set(o))}return[t,o,l,i,a,s]}class Bi extends le{constructor(e){super(),ie(this,e,Mi,zi,oe,{})}}const{window:Ti}=wt;function Ei(n){let e;return{c(){e=N("SA10: pedestrian crossing speed")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function Oi(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g,j,L,m,h;function A(S){n[9](S)}let C={k:"horiz-radio",choices:je(),$$slots:{default:[Ei]},$$scope:{ctx:n}};return n[1].crossings[n[0]].properties.sa10!==void 0&&(C.value=n[1].crossings[n[0]].properties.sa10),u=new Fe({props:C}),ue.push(()=>me(u,"value",A)),j=new yt({props:{metric:n[3]}}),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=M(),o=k("button"),o.textContent="Delete crossing",l=M(),i=k("label"),a=N(`Name:
      `),s=k("input"),c=M(),B(u.$$.fragment),p=M(),d=k("p"),d.textContent=`${n[3].description}`,g=M(),B(j.$$.fragment),I(s,"type","text"),I(e,"slot","sidebar")},m(S,$){w(S,e,$),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(i,a),_(i,s),pe(s,n[1].crossings[n[0]].properties.name),_(e,c),T(u,e,null),_(e,p),_(e,d),_(e,g),T(j,e,null),L=!0,m||(h=[q(r,"click",n[7]),q(o,"click",n[5]),q(s,"input",n[8])],m=!0)},p(S,$){$&3&&s.value!==S[1].crossings[S[0]].properties.name&&pe(s,S[1].crossings[S[0]].properties.name);const z={};$&1024&&(z.$$scope={dirty:$,ctx:S}),!f&&$&3&&(f=!0,z.value=S[1].crossings[S[0]].properties.sa10,_e(()=>f=!1)),u.$set(z)},i(S){L||(b(u.$$.fragment,S),b(j.$$.fragment,S),L=!0)},o(S){y(u.$$.fragment,S),y(j.$$.fragment,S),L=!1},d(S){S&&v(e),E(u),E(j),m=!1,ye(h)}}}function Di(n){let e,r;return e=new Ye({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":"black"}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ni(n){let e,r;return{c(){e=k("img"),$t(e.src,r=fo)||I(e,"src",r),I(e,"alt","")},m(t,o){w(t,e,o)},p:ee,d(t){t&&v(e)}}}function Ii(n){let e,r,t,o,l,i,a,s;r=new Ge({props:{except:"crossings",showMissingProperty:["get","sa10"]}}),o=new ve({props:{data:ge(n[1].crossings),generateId:!0,$$slots:{default:[Di]},$$scope:{ctx:n}}});function c(f){n[6](f)}let u={color:n[1].crossings[n[0]].properties.color,$$slots:{default:[Ni]},$$scope:{ctx:n}};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(u.lngLat=n[1].crossings[n[0]].geometry.coordinates),i=new en({props:u}),ue.push(()=>me(i,"lngLat",c)),{c(){e=k("div"),B(r.$$.fragment),t=M(),B(o.$$.fragment),l=M(),B(i.$$.fragment),I(e,"slot","map")},m(f,p){w(f,e,p),T(r,e,null),_(e,t),T(o,e,null),_(e,l),T(i,e,null),s=!0},p(f,p){const d={};p&2&&(d.data=ge(f[1].crossings)),p&1025&&(d.$$scope={dirty:p,ctx:f}),o.$set(d);const g={};p&3&&(g.color=f[1].crossings[f[0]].properties.color),p&1024&&(g.$$scope={dirty:p,ctx:f}),!a&&p&3&&(a=!0,g.lngLat=f[1].crossings[f[0]].geometry.coordinates,_e(()=>a=!1)),i.$set(g)},i(f){s||(b(r.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),E(r),E(o),E(i)}}}function Fi(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Ii],sidebar:[Oi]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=q(Ti,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function Pi(n,e,r){let t,o;te(n,W,d=>r(1,t=d)),te(n,Y,d=>r(2,o=d));let{idx:l}=e,i=Ve.SA10;function a(d){d.key=="Escape"&&x(Y,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this crossing?")&&(x(Y,o={kind:"neutral"},o),await st(),t.crossings.splice(l,1),W.set(t))}function c(d){n.$$.not_equal(t.crossings[l].geometry.coordinates,d)&&(t.crossings[l].geometry.coordinates=d,W.set(t))}const u=()=>x(Y,o={kind:"neutral"},o);function f(){t.crossings[l].properties.name=this.value,W.set(t)}function p(d){n.$$.not_equal(t.crossings[l].properties.sa10,d)&&(t.crossings[l].properties.sa10=d,W.set(t))}return n.$$set=d=>{"idx"in d&&r(0,l=d.idx)},[l,t,o,i,a,s,c,u,f,p]}class Ui extends le{constructor(e){super(),ie(this,e,Pi,Fi,oe,{idx:0})}}let K;const mo=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&mo.decode();let mt=null;function ht(){return(mt===null||mt.byteLength===0)&&(mt=new Uint8Array(K.memory.buffer)),mt}function Me(n,e){return n=n>>>0,mo.decode(ht().subarray(n,n+e))}const Re=new Array(128).fill(void 0);Re.push(void 0,null,!0,!1);let bt=Re.length;function ke(n){bt===Re.length&&Re.push(Re.length+1);const e=bt;return bt=Re[e],Re[e]=n,e}function ce(n){return Re[n]}function qi(n){n<132||(Re[n]=bt,bt=n)}function rt(n){const e=ce(n);return qi(n),e}function Ht(n){return n==null}let _t=null;function Ri(){return(_t===null||_t.byteLength===0)&&(_t=new Float64Array(K.memory.buffer)),_t}let gt=null;function fe(){return(gt===null||gt.byteLength===0)&&(gt=new Int32Array(K.memory.buffer)),gt}let Qe=0;const It=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Gi=typeof It.encodeInto=="function"?function(n,e){return It.encodeInto(n,e)}:function(n,e){const r=It.encode(n);return e.set(r),{read:n.length,written:r.length}};function Et(n,e,r){if(r===void 0){const a=It.encode(n),s=e(a.length,1)>>>0;return ht().subarray(s,s+a.length).set(a),Qe=a.length,s}let t=n.length,o=e(t,1)>>>0;const l=ht();let i=0;for(;i<t;i++){const a=n.charCodeAt(i);if(a>127)break;l[o+i]=a}if(i!==t){i!==0&&(n=n.slice(i)),o=r(o,t,t=i+n.length*3,1)>>>0;const a=ht().subarray(o+i,o+t),s=Gi(n,a);i+=s.written}return Qe=i,o}function xt(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let l="[";o>0&&(l+=xt(n[0]));for(let i=1;i<o;i++)l+=", "+xt(n[i]);return l+="]",l}const r=/\[object ([^\]]+)\]/.exec(toString.call(n));let t;if(r.length>1)t=r[1];else return toString.call(n);if(t=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:t}function Ji(n,e){const r=e(n.length*1,1)>>>0;return ht().set(n,r/1),Qe=n.length,r}function Kt(n,e){try{return n.apply(this,e)}catch(r){K.__wbindgen_exn_store(ke(r))}}class Ut{static __wrap(e){e=e>>>0;const r=Object.create(Ut.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();K.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=K.__wbindgen_add_to_stack_pointer(-16),i=Ji(e,K.__wbindgen_malloc),a=Qe;K.jsroutesnapper_new(l,i,a);var r=fe()[l/4+0],t=fe()[l/4+1],o=fe()[l/4+2];if(o)throw rt(t);return Ut.__wrap(r)}finally{K.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){K.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ke(e))}setAreaMode(){K.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,r;try{const l=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_getConfig(l,this.__wbg_ptr);var t=fe()[l/4+0],o=fe()[l/4+1];return e=t,r=o,Me(t,o)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(e,r,1)}}toFinalFeature(){try{const t=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=fe()[t/4+0],r=fe()[t/4+1];let o;return e!==0&&(o=Me(e,r).slice(),K.__wbindgen_free(e,r*1)),o}finally{K.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,r;try{const l=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var t=fe()[l/4+0],o=fe()[l/4+1];return e=t,r=o,Me(t,o)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(e,r,1)}}toggleSnapMode(){K.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,r,t){return K.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,r,t)!==0}onClick(){K.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return K.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return K.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){K.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_editExisting(o,this.__wbg_ptr,ke(e));var r=fe()[o/4+0],t=fe()[o/4+1];if(t)throw rt(r)}finally{K.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,r;try{const l=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var t=fe()[l/4+0],o=fe()[l/4+1];return e=t,r=o,Me(t,o)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(e,r,1)}}debugSnappableNodes(){let e,r;try{const l=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var t=fe()[l/4+0],o=fe()[l/4+1];return e=t,r=o,Me(t,o)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(e,r,1)}}routeNameForWaypoints(e){let r,t;try{const u=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,ke(e));var o=fe()[u/4+0],l=fe()[u/4+1],i=fe()[u/4+2],a=fe()[u/4+3],s=o,c=l;if(a)throw s=0,c=0,rt(i);return r=s,t=c,Me(s,c)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(r,t,1)}}addSnappedWaypoint(e,r){K.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,r)}undo(){K.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let r,t;try{const u=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,ke(e));var o=fe()[u/4+0],l=fe()[u/4+1],i=fe()[u/4+2],a=fe()[u/4+3],s=o,c=l;if(a)throw s=0,c=0,rt(i);return r=s,t=c,Me(s,c)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(r,t,1)}}getExtraNodes(e,r){let t,o;try{const f=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_getExtraNodes(f,this.__wbg_ptr,ke(e),ke(r));var l=fe()[f/4+0],i=fe()[f/4+1],a=fe()[f/4+2],s=fe()[f/4+3],c=l,u=i;if(s)throw c=0,u=0,rt(a);return t=c,o=u,Me(c,u)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,o,1)}}}async function Qi(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(t){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function Hi(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,r){const t=Me(e,r);return ke(t)},n.wbg.__wbindgen_object_drop_ref=function(e){rt(e)},n.wbg.__wbindgen_error_new=function(e,r){const t=new Error(Me(e,r));return ke(t)},n.wbg.__wbindgen_number_get=function(e,r){const t=ce(r),o=typeof t=="number"?t:void 0;Ri()[e/8+1]=Ht(o)?0:o,fe()[e/4+0]=!Ht(o)},n.wbg.__wbindgen_is_object=function(e){const r=ce(e);return typeof r=="object"&&r!==null},n.wbg.__wbindgen_is_undefined=function(e){return ce(e)===void 0},n.wbg.__wbindgen_in=function(e,r){return ce(e)in ce(r)},n.wbg.__wbindgen_boolean_get=function(e){const r=ce(e);return typeof r=="boolean"?r?1:0:2},n.wbg.__wbindgen_jsval_loose_eq=function(e,r){return ce(e)==ce(r)},n.wbg.__wbindgen_string_get=function(e,r){const t=ce(r),o=typeof t=="string"?t:void 0;var l=Ht(o)?0:Et(o,K.__wbindgen_malloc,K.__wbindgen_realloc),i=Qe;fe()[e/4+1]=i,fe()[e/4+0]=l},n.wbg.__wbg_String_4370c5505c674d30=function(e,r){const t=String(ce(r)),o=Et(t,K.__wbindgen_malloc,K.__wbindgen_realloc),l=Qe;fe()[e/4+1]=l,fe()[e/4+0]=o},n.wbg.__wbindgen_object_clone_ref=function(e){const r=ce(e);return ke(r)},n.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,r){const t=ce(e)[ce(r)];return ke(t)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ke(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,r){const t=ce(r).stack,o=Et(t,K.__wbindgen_malloc,K.__wbindgen_realloc),l=Qe;fe()[e/4+1]=l,fe()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,r){let t,o;try{t=e,o=r,console.error(Me(e,r))}finally{K.__wbindgen_free(t,o,1)}},n.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(ce(e))},n.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(ce(e))},n.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(ce(e))},n.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(ce(e))},n.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(ce(e))},n.wbg.__wbg_get_44be0491f933a435=function(e,r){const t=ce(e)[r>>>0];return ke(t)},n.wbg.__wbg_length_fff51ee6522a1a18=function(e){return ce(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof ce(e)=="function"},n.wbg.__wbg_next_526fc47e980da008=function(e){const r=ce(e).next;return ke(r)},n.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Kt(function(e){const r=ce(e).next();return ke(r)},arguments)},n.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return ce(e).done},n.wbg.__wbg_value_1695675138684bd5=function(e){const r=ce(e).value;return ke(r)},n.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ke(Symbol.iterator)},n.wbg.__wbg_get_97b561fb56f034b5=function(){return Kt(function(e,r){const t=Reflect.get(ce(e),ce(r));return ke(t)},arguments)},n.wbg.__wbg_call_cb65541d95d71282=function(){return Kt(function(e,r){const t=ce(e).call(ce(r));return ke(t)},arguments)},n.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(ce(e))},n.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let r;try{r=ce(e)instanceof ArrayBuffer}catch{r=!1}return r},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const r=ce(e).buffer;return ke(r)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const r=new Uint8Array(ce(e));return ke(r)},n.wbg.__wbg_set_5cf90238115182c3=function(e,r,t){ce(e).set(ce(r),t>>>0)},n.wbg.__wbg_length_72e2208bbc0efc61=function(e){return ce(e).length},n.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let r;try{r=ce(e)instanceof Uint8Array}catch{r=!1}return r},n.wbg.__wbindgen_debug_string=function(e,r){const t=xt(ce(r)),o=Et(t,K.__wbindgen_malloc,K.__wbindgen_realloc),l=Qe;fe()[e/4+1]=l,fe()[e/4+0]=o},n.wbg.__wbindgen_throw=function(e,r){throw new Error(Me(e,r))},n.wbg.__wbindgen_memory=function(){const e=K.memory;return ke(e)},n}function Ki(n,e){return K=n.exports,_o.__wbindgen_wasm_module=e,_t=null,gt=null,mt=null,K}async function _o(n){if(K!==void 0)return K;typeof n>"u"&&(n="/route-element/assets/route_snapper_bg.wasm");const e=Hi();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:t}=await Qi(await n,e);return Ki(r,t)}const Wi=30;class Zi{constructor(e,r,t,o,l){this.onMouseMove=i=>{if(!this.active)return;const a=[i.point.x-Wi,i.point.y],s=this.map.unproject(i.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,s)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Ut(r),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersSuccess)r(JSON.parse(e));else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersUpdated)r(JSON.parse(e))}}function Xi(n){let e=n[4].road_classification+"",r;return{c(){r=N(e)},m(t,o){w(t,r,o)},p(t,o){o&16&&e!==(e=t[4].road_classification+"")&&re(r,e)},d(t){t&&v(r)}}}function Vi(n){let e,r;return e=new at({props:{openOn:"hover",$$slots:{default:[Xi,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&48&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Yi(n){let e,r;return e=new qe({props:{layout:{visibility:n[0]?"visible":"none"},paint:{"line-width":3,"line-color":"black"},$$slots:{default:[Vi]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),o&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function xi(n){let e,r;return e=new Ze({props:{manageHoverState:!0,layout:{visibility:n[0]?"visible":"none"},paint:{"circle-color":["case",["get","traffic_signals"],"green","black"],"circle-radius":5}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function es(n){let e,r,t,o;return e=new ve({props:{data:n[1].os_links,$$slots:{default:[Yi]},$$scope:{ctx:n}}}),t=new ve({props:{data:n[1].os_nodes,$$slots:{default:[xi]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=M(),B(t.$$.fragment)},m(l,i){T(e,l,i),w(l,r,i),T(t,l,i),o=!0},p(l,[i]){const a={};i&33&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&33&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&v(r),E(e,l),E(t,l)}}}function ts(n,e,r){let{graph:t}=e,{showDebug:o}=e;function l(){let a=JSON.parse(t.debugNetwork());return{os_nodes:JSON.parse(a.os_nodes),os_links:JSON.parse(a.os_links)}}let i=l();return n.$$set=a=>{"graph"in a&&r(2,t=a.graph),"showDebug"in a&&r(0,o=a.showDebug)},[o,i,t]}class ns extends le{constructor(e){super(),ie(this,e,ts,es,oe,{graph:2,showDebug:0})}}function go(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:We[n%We.length],sa10:""}}}function ho(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:We[n%We.length],details:{arms:[],movements:[],notes:""}}}}function bo(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:We[n%We.length],answers:Array(Se.length).fill("")}}}let Se=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:je()},{name:"SA04",description:"trip hazards",choices:je()},{name:"SA05",description:"kerbside activity",choices:je()},{name:"SA08",description:"motor traffic speed",choices:je()},{name:"SA09",description:"motor traffic volume",choices:je()},{name:"SA11",description:"footway widths",choices:je()},{name:"SA12",description:"effective width next to tram lines",choices:je()},{name:"SA13",description:"crossing angle of tram/train rails",choices:je()},{name:"SA14",description:"cycling surface and maintenance defects",choices:je()},{name:"SA15",description:"WW surface and maintenance defects",choices:je()},{name:"SA16",description:"guard railing",choices:je()}],tn=Ie(null);const Ne=Ie([]);async function rs(n){await Jo(),await _o();let e="https://assets.od2net.org/route-element",r=n.getBounds();try{let t=await new Qo(e,r.getEast(),r.getNorth(),r.getWest(),r.getSouth());tn.set(new Zi(n,t.getRouteSnapper(),Ie(Nt()),Ie(!0),Ie(0))),Y.set({kind:"draw-route",graph:t})}catch(t){window.alert(t)}}function os(n){try{let e=JSON.parse(Jt(tn).inner.calculateRoute(Jt(Ne)));if(!e){window.alert("No route drawn");return}W.update(r=>{for(let t of JSON.parse(n.splitLinks(e,e.properties.full_path)).features){let o=bo(r.links.length);o.geometry=t.geometry,o.properties.name=e.properties.route_name,r.links.push(o)}for(let t of JSON.parse(n.getSideRoadCrossings(e.properties.full_path)).features)r.crossings.push(go(r.crossings.length,t.geometry.coordinates));for(let t of JSON.parse(n.getSignalizedJunctions(e.properties.full_path))){let o=ho(r.jats.length,Fn(t.pt));o.properties.details.arms=t.arms.map(([l,i])=>({point:Fn(i),name:l})),r.jats.push(o)}return r}),Y.set({kind:"edit-link",idx:Jt(W).links.length-1})}catch(e){window.alert(`Bug: ${e}`)}Ne.set([]),Y.set({kind:"neutral"})}function Fn(n){return[n.x,n.y]}function Pn(n,e,r){const t=n.slice();return t[49]=e[r],t[50]=e,t[51]=r,t}function Un(n,e,r){const t=n.slice();return t[52]=e[r],t[53]=e,t[54]=r,t}function ls(n){let e;return{c(){e=k("h2"),e.textContent="Drawing a new route"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function is(n){let e;return{c(){e=k("h2"),e.textContent="Editing a route"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function ss(n){let e,r=n[12].length+"",t,o;return{c(){e=N("Undo ("),t=N(r),o=N(")")},m(l,i){w(l,e,i),w(l,t,i),w(l,o,i)},p(l,i){i[0]&4096&&r!==(r=l[12].length+"")&&re(t,r)},d(l){l&&(v(e),v(t),v(o))}}}function as(n){let e;return{c(){e=N("Undo")},m(r,t){w(r,e,t)},p:ee,d(r){r&&v(e)}}}function cs(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g,j,L,m,h,A,C,S,$,z,D,G,P,Z,O,J,H,U,F,Q,be,$e,De,ct,Ct,jt,et,Je,St,ut,ft,pt,Lt;function zt(ne,he){return ne[3]?is:ls}let tt=zt(n),Ue=tt(n);function Mt(ne,he){return ne[12].length==0?as:ss}let nt=Mt(n),R=nt(n);return ut=it(n[39][0]),ft=it(n[39][1]),{c(){e=k("div"),Ue.c(),r=M(),t=k("button"),o=N("Finish"),i=M(),a=k("button"),R.c(),c=M(),u=k("button"),u.textContent="Cancel",f=M(),p=k("fieldset"),d=k("label"),g=k("input"),j=N(`
        Snap to roads`),L=M(),m=k("label"),h=k("input"),A=N(`
        Draw anywhere`),C=M(),S=k("fieldset"),$=k("label"),z=k("input"),D=N(`
        Extend from start (
        `),G=k("b"),G.textContent="1",P=N(`
        )`),Z=M(),O=k("label"),J=k("input"),H=N(`
        Extend from end (
        `),U=k("b"),U.textContent="2",F=N(`
        )`),Q=M(),be=k("label"),$e=k("input"),De=N(`
        Adjust middle points (
        `),ct=k("b"),ct.textContent="3",Ct=N(`
        )`),jt=M(),et=k("label"),Je=k("input"),St=N(`
      Debug the network`),t.disabled=l=n[8].length<2,I(a,"class","secondary"),a.disabled=s=n[12].length==0,I(u,"class","secondary"),I(g,"type","radio"),g.__value="snap",pe(g,g.__value),I(h,"type","radio"),h.__value="free",pe(h,h.__value),I(z,"type","radio"),z.__value="append-start",pe(z,z.__value),I(J,"type","radio"),J.__value="append-end",pe(J,J.__value),I($e,"type","radio"),$e.__value="adjust",pe($e,$e.__value),I(Je,"type","checkbox"),I(e,"slot","sidebar"),ut.p(z,J,$e),ft.p(g,h)},m(ne,he){w(ne,e,he),Ue.m(e,null),_(e,r),_(e,t),_(t,o),_(e,i),_(e,a),R.m(a,null),_(e,c),_(e,u),_(e,f),_(e,p),_(p,d),_(d,g),g.checked=g.__value===n[11],_(d,j),_(p,L),_(p,m),_(m,h),h.checked=h.__value===n[11],_(m,A),_(e,C),_(e,S),_(S,$),_($,z),z.checked=z.__value===n[4],_($,D),_($,G),_($,P),_(S,Z),_(S,O),_(O,J),J.checked=J.__value===n[4],_(O,H),_(O,U),_(O,F),_(S,Q),_(S,be),_(be,$e),$e.checked=$e.__value===n[4],_(be,De),_(be,ct),_(be,Ct),_(e,jt),_(e,et),_(et,Je),Je.checked=n[10],_(et,St),pt||(Lt=[q(t,"click",function(){Zt(n[1])&&n[1].apply(this,arguments)}),q(a,"click",n[15]),q(u,"click",function(){Zt(n[2])&&n[2].apply(this,arguments)}),q(g,"change",n[38]),q(g,"change",n[16]),q(h,"change",n[40]),q(h,"change",n[16]),q(z,"change",n[41]),q(J,"change",n[42]),q($e,"change",n[43]),q(Je,"change",n[44])],pt=!0)},p(ne,he){n=ne,tt!==(tt=zt(n))&&(Ue.d(1),Ue=tt(n),Ue&&(Ue.c(),Ue.m(e,r))),he[0]&256&&l!==(l=n[8].length<2)&&(t.disabled=l),nt===(nt=Mt(n))&&R?R.p(n,he):(R.d(1),R=nt(n),R&&(R.c(),R.m(a,null))),he[0]&4096&&s!==(s=n[12].length==0)&&(a.disabled=s),he[0]&2048&&(g.checked=g.__value===n[11]),he[0]&2048&&(h.checked=h.__value===n[11]),he[0]&16&&(z.checked=z.__value===n[4]),he[0]&16&&(J.checked=J.__value===n[4]),he[0]&16&&($e.checked=$e.__value===n[4]),he[0]&1024&&(Je.checked=n[10])},d(ne){ne&&v(e),Ue.d(),R.d(),ut.r(),ft.r(),pt=!1,ye(Lt)}}}function us(n){let e;return{c(){e=k("span"),I(e,"class","dot svelte-1cj4rwq"),we(e,"snapped-node",n[52].snapped),we(e,"free-node",!n[52].snapped),we(e,"hide",n[7])},m(r,t){w(r,e,t)},p(r,t){t[0]&8192&&we(e,"snapped-node",r[52].snapped),t[0]&8192&&we(e,"free-node",!r[52].snapped),t[0]&128&&we(e,"hide",r[7])},d(r){r&&v(e)}}}function qn(n){let e,r,t;function o(s){n[29](s,n[52])}function l(){return n[30](n[52])}function i(){return n[31](n[52])}let a={draggable:!0,zIndex:0,$$slots:{default:[us]},$$scope:{ctx:n}};return n[52].point!==void 0&&(a.lngLat=n[52].point),e=new Ke({props:a}),ue.push(()=>me(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",n[24]),{c(){B(e.$$.fragment)},m(s,c){T(e,s,c),t=!0},p(s,c){n=s;const u={};c[0]&8320|c[1]&16777216&&(u.$$scope={dirty:c,ctx:n}),!r&&c[0]&8192&&(r=!0,u.lngLat=n[52].point,_e(()=>r=!1)),e.$set(u)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function fs(n){let e;return{c(){e=k("span"),e.textContent=`${n[51]+1}`,I(e,"class","dot svelte-1cj4rwq"),we(e,"snapped",n[49].snapped)},m(r,t){w(r,e,t)},p(r,t){t[0]&256&&we(e,"snapped",r[49].snapped)},d(r){r&&v(e)}}}function Rn(n){let e,r,t;function o(s){n[32](s,n[49])}function l(){return n[33](n[51])}function i(){return n[34](n[51])}let a={draggable:!0,zIndex:1,$$slots:{default:[fs]},$$scope:{ctx:n}};return n[49].point!==void 0&&(a.lngLat=n[49].point),e=new Ke({props:a}),ue.push(()=>me(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",n[35]),e.$on("mouseleave",n[36]),e.$on("dragstart",n[26]),e.$on("dragend",n[37]),{c(){B(e.$$.fragment)},m(s,c){T(e,s,c),t=!0},p(s,c){n=s;const u={};c[0]&256|c[1]&16777216&&(u.$$scope={dirty:c,ctx:n}),!r&&c[0]&256&&(r=!0,u.lngLat=n[49].point,_e(()=>r=!1)),e.$set(u)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function ps(n){let e,r;return e=new qe({props:{paint:{"line-color":"black","line-width":10}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ds(n){let e,r;return e=new qe({props:{paint:{"line-color":"black","line-width":3}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ms(n){let e,r,t,o,l,i,a,s,c,u,f;r=new vt({}),r.$on("click",n[17]),r.$on("mousemove",n[18]),o=new ns({props:{showDebug:n[10],graph:n[0]}});let p=V(n[13]),d=[];for(let h=0;h<p.length;h+=1)d[h]=qn(Un(n,p,h));const g=h=>y(d[h],1,1,()=>{d[h]=null});let j=V(n[8]),L=[];for(let h=0;h<j.length;h+=1)L[h]=Rn(Pn(n,j,h));const m=h=>y(L[h],1,1,()=>{L[h]=null});return s=new ve({props:{data:n[21](n[9],n[8]),generateId:!0,$$slots:{default:[ps]},$$scope:{ctx:n}}}),u=new ve({props:{data:n[14],$$slots:{default:[ds]},$$scope:{ctx:n}}}),{c(){e=k("div"),B(r.$$.fragment),t=M(),B(o.$$.fragment),l=M();for(let h=0;h<d.length;h+=1)d[h].c();i=M();for(let h=0;h<L.length;h+=1)L[h].c();a=M(),B(s.$$.fragment),c=M(),B(u.$$.fragment),I(e,"slot","map")},m(h,A){w(h,e,A),T(r,e,null),_(e,t),T(o,e,null),_(e,l);for(let C=0;C<d.length;C+=1)d[C]&&d[C].m(e,null);_(e,i);for(let C=0;C<L.length;C+=1)L[C]&&L[C].m(e,null);_(e,a),T(s,e,null),_(e,c),T(u,e,null),f=!0},p(h,A){const C={};if(A[0]&1024&&(C.showDebug=h[10]),A[0]&1&&(C.graph=h[0]),o.$set(C),A[0]&29368448){p=V(h[13]);let z;for(z=0;z<p.length;z+=1){const D=Un(h,p,z);d[z]?(d[z].p(D,A),b(d[z],1)):(d[z]=qn(D),d[z].c(),b(d[z],1),d[z].m(e,i))}for(se(),z=p.length;z<d.length;z+=1)g(z);ae()}if(A[0]&68682080){j=V(h[8]);let z;for(z=0;z<j.length;z+=1){const D=Pn(h,j,z);L[z]?(L[z].p(D,A),b(L[z],1)):(L[z]=Rn(D),L[z].c(),b(L[z],1),L[z].m(e,a))}for(se(),z=j.length;z<L.length;z+=1)m(z);ae()}const S={};A[0]&768&&(S.data=h[21](h[9],h[8])),A[1]&16777216&&(S.$$scope={dirty:A,ctx:h}),s.$set(S);const $={};A[0]&16384&&($.data=h[14]),A[1]&16777216&&($.$$scope={dirty:A,ctx:h}),u.$set($)},i(h){if(!f){b(r.$$.fragment,h),b(o.$$.fragment,h);for(let A=0;A<p.length;A+=1)b(d[A]);for(let A=0;A<j.length;A+=1)b(L[A]);b(s.$$.fragment,h),b(u.$$.fragment,h),f=!0}},o(h){y(r.$$.fragment,h),y(o.$$.fragment,h),d=d.filter(Boolean);for(let A=0;A<d.length;A+=1)y(d[A]);L=L.filter(Boolean);for(let A=0;A<L.length;A+=1)y(L[A]);y(s.$$.fragment,h),y(u.$$.fragment,h),f=!1},d(h){h&&v(e),E(r),E(o),de(d,h),de(L,h),E(s),E(u)}}}function _s(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[ms],sidebar:[cs]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=q(window,"keydown",n[25]),t=!0)},p(l,i){const a={};i[0]&32767|i[1]&16777216&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function gs(n,e,r){let t,o,l;te(n,Ne,R=>r(8,o=R)),te(n,tn,R=>r(9,l=R));let{graph:i}=e,{map:a}=e,{finish:s}=e,{cancel:c}=e,{editingExisting:u}=e;Rt(()=>{x(Ne,o=[],o),l==null||l.stop(),a.getCanvas().style.cursor="inherit"});let f=!0,p=u?"adjust":"append-end",d="snap",g=[],j=[],L=null,m=!1,h=!1,A=!1;function C(R){let ne=R.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=ne}function S(){let R=g.pop();r(12,g),R&&x(Ne,o=R,o)}function $(){g.length==100&&g.shift(),r(12,g=[...g,JSON.parse(JSON.stringify(o))])}function z(){r(11,d=d=="snap"?"free":"snap"),L&&r(28,L.snapped=d=="snap",L)}function D(R){$(),Ne.update(ne=>(p=="append-start"?ne.splice(0,0,{point:R.detail.lngLat.toArray(),snapped:d=="snap"}):p=="append-end"&&ne.push({point:R.detail.lngLat.toArray(),snapped:d=="snap"}),ne))}function G(R){r(28,L={point:R.detail.lngLat.toArray(),snapped:d=="snap"})}function P(R){$(),Ne.update(ne=>(ne[R].snapped=!ne[R].snapped,ne))}function Z(R){$(),Ne.update(ne=>(ne.splice(R,1),ne)),r(5,m=!1)}function O(R,ne){try{if(R)return JSON.parse(R.inner.calculateRoute(ne))}catch{}return Nt()}function J(R,ne,he,dt,Bt){if(Bt)return Nt();try{if(R&&ne.length>0&&dt){if(he=="append-start")return JSON.parse(R.inner.calculateRoute([dt,ne[0]]));if(he=="append-end")return JSON.parse(R.inner.calculateRoute([ne[ne.length-1],dt]))}}catch{}return Nt()}function H(R,ne,he,dt){if(dt)return;if(!R||he!="adjust"){r(13,j=[]);return}let Bt=[],Gt=1;for(let Tt=0;Tt<ne.length-1;Tt++){let zo=JSON.parse(R.inner.getExtraNodes(ne[Tt],ne[Tt+1]));for(let[Mo,Bo,To]of zo)Bt.push({point:[Mo,Bo],snapped:To,insertIdx:Gt});Gt++}r(13,j=Bt)}function U(R){$(),Ne.update(ne=>(ne.splice(R.insertIdx,0,{point:R.point,snapped:R.snapped}),ne)),r(7,A=!0)}function F(R){Ne.update(ne=>(ne[R.insertIdx].point=R.point,ne))}function Q(){r(7,A=!1)}function be(R){let ne=R.target.tagName,he=ne=="INPUT"||ne=="TEXTAREA";R.key==="Enter"&&!he?(R.stopPropagation(),o.length>=2&&s()):R.key==="Escape"?(R.stopPropagation(),c()):R.key=="s"&&!he?z():R.key=="1"&&!he?r(4,p="append-start"):R.key=="2"&&!he?r(4,p="append-end"):R.key=="3"&&!he?r(4,p="adjust"):R.key=="z"&&R.ctrlKey&&(R.stopPropagation(),S())}function $e(){$(),r(6,h=!0)}const De=[[],[]];function ct(R,ne){n.$$.not_equal(ne.point,R)&&(ne.point=R,r(13,j))}const Ct=R=>U(R),jt=R=>F(R);function et(R,ne){n.$$.not_equal(ne.point,R)&&(ne.point=R,Ne.set(o))}const Je=R=>P(R),St=R=>Z(R),ut=()=>r(5,m=!0),ft=()=>r(5,m=!1),pt=()=>r(6,h=!1);function Lt(){d=this.__value,r(11,d)}function zt(){d=this.__value,r(11,d)}function tt(){p=this.__value,r(4,p)}function Ue(){p=this.__value,r(4,p)}function Mt(){p=this.__value,r(4,p)}function nt(){f=this.checked,r(10,f)}return n.$$set=R=>{"graph"in R&&r(0,i=R.graph),"map"in R&&r(27,a=R.map),"finish"in R&&r(1,s=R.finish),"cancel"in R&&r(2,c=R.cancel),"editingExisting"in R&&r(3,u=R.editingExisting)},n.$$.update=()=>{n.$$.dirty[0]&912&&H(l,o,p,A),n.$$.dirty[0]&268436336&&r(14,t=J(l,o,p,L,m||h)),n.$$.dirty[0]&256&&C(o)},[i,s,c,u,p,m,h,A,o,l,f,d,g,j,t,S,z,D,G,P,Z,O,U,F,Q,be,$e,a,L,ct,Ct,jt,et,Je,St,ut,ft,pt,Lt,De,zt,tt,Ue,Mt,nt]}class hs extends le{constructor(e){super(),ie(this,e,gs,_s,oe,{graph:0,map:27,finish:1,cancel:2,editingExisting:3},null,[-1,-1])}}const bs="/route-element/assets/right-arrow-d8c7892c.svg";function Gn(n){let e,r;const t=n[4].default,o=Be(t,n,n[3],null);return{c(){e=k("div"),o&&o.c(),I(e,"class","section svelte-zax3q3")},m(l,i){w(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&8)&&Te(o,t,l,l[3],r?Oe(t,l[3],i,null):Ee(l[3]),null)},i(l){r||(b(o,l),r=!0)},o(l){y(o,l),r=!1},d(l){l&&v(e),o&&o.d(l)}}}function $s(n){let e,r,t,o,l,i,a,s,c,u,f,p,d=n[2]&&Gn(n);return{c(){e=k("button"),r=k("div"),t=k("span"),o=N(n[0]),l=M(),i=k("img"),c=M(),d&&d.c(),I(i,"class","arrow svelte-zax3q3"),$t(i.src,a=bs)||I(i,"src",a),I(i,"alt",s="Select "+n[0]),I(r,"class","top-section section svelte-zax3q3"),we(r,"bordered",n[2]),I(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m(g,j){w(g,e,j),_(e,r),_(r,t),_(t,o),_(r,l),_(r,i),_(e,c),d&&d.m(e,null),u=!0,f||(p=[q(e,"click",n[5]),q(e,"mouseenter",n[6]),q(e,"mouseleave",n[7])],f=!0)},p(g,[j]){(!u||j&1)&&re(o,g[0]),(!u||j&1&&s!==(s="Select "+g[0]))&&I(i,"alt",s),(!u||j&4)&&we(r,"bordered",g[2]),g[2]?d?(d.p(g,j),j&4&&b(d,1)):(d=Gn(g),d.c(),b(d,1),d.m(e,null)):d&&(se(),y(d,1,1,()=>{d=null}),ae()),(!u||j&2)&&(e.disabled=g[1])},i(g){u||(b(d),u=!0)},o(g){y(d),u=!1},d(g){g&&v(e),d&&d.d(),f=!1,ye(p)}}}function ks(n,e,r){let{$$slots:t={},$$scope:o}=e,{name:l}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(f){Ae.call(this,n,f)}function c(f){Ae.call(this,n,f)}function u(f){Ae.call(this,n,f)}return n.$$set=f=>{"name"in f&&r(0,l=f.name),"disabled"in f&&r(1,i=f.disabled),"hasSlot"in f&&r(2,a=f.hasSlot),"$$scope"in f&&r(3,o=f.$$scope)},[l,i,a,o,t,s,c,u]}class $o extends le{constructor(e){super(),ie(this,e,ks,$s,oe,{name:0,disabled:1,hasSlot:2})}}let He={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const ot={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},ko=Object.keys(ot);function qt(n){return Object.keys(ot[n])}const Xe="All movements";function Jn(n,e){let r=[],t=ot[n][e];t&&r.push({junctionType:n,movementType:e,...t});let o=ot[n][Xe];if(o&&e!=Xe&&r.push({junctionType:n,movementType:Xe,...o}),n=="Crossroads"){let l=ot["Simple priority T-junction"][Xe];l&&r.push({junctionType:"Simple priority T-junction",movementType:Xe,...l})}if(n!="Any type of junction"){let l=ot["Any type of junction"][Xe];l&&r.push({junctionType:"Any type of junction",movementType:Xe,...l})}return r}function Qn(n,e,r){const t=n.slice();return t[9]=e[r],t}function Hn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Kn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Wn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Zn(n){let e,r;return e=new At({props:{$$slots:{default:[ys]},$$scope:{ctx:n}}}),e.$on("close",n[8]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&524295&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ws(n){let e;return{c(){e=N("Type of junction")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function vs(n){let e;return{c(){e=N("Type of movement")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function Xn(n){let e,r,t;function o(i){n[6](i)}let l={k:"vert-radio",choices:qt(n[1]),$$slots:{default:[vs]},$$scope:{ctx:n}};return n[2]!==void 0&&(l.value=n[2]),e=new Fe({props:l}),ue.push(()=>me(e,"value",o)),{c(){B(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,a){const s={};a&2&&(s.choices=qt(i[1])),a&524288&&(s.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,s.value=i[2],_e(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Vn(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=N(r)},m(o,l){w(o,e,l),_(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&re(t,r)},d(o){o&&v(e)}}}function Yn(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=N(r)},m(o,l){w(o,e,l),_(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&re(t,r)},d(o){o&&v(e)}}}function xn(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=N(r)},m(o,l){w(o,e,l),_(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&re(t,r)},d(o){o&&v(e)}}}function er(n){let e,r,t=n[9].junctionType+"",o,l,i,a,s,c,u=n[9].movementType+"",f,p,d,g,j,L,m,h,A,C,S,$=V(n[9].scoreZero),z=[];for(let O=0;O<$.length;O+=1)z[O]=Vn(Wn(n,$,O));let D=V(n[9].scoreOne),G=[];for(let O=0;O<D.length;O+=1)G[O]=Yn(Kn(n,D,O));let P=V(n[9].scoreTwo),Z=[];for(let O=0;O<P.length;O+=1)Z[O]=xn(Hn(n,P,O));return{c(){e=k("tr"),r=k("td"),o=N(t),l=M(),i=k("br"),a=M(),s=k("br"),c=M(),f=N(u),p=M(),d=k("td"),g=k("ul");for(let O=0;O<z.length;O+=1)z[O].c();j=M(),L=k("td"),m=k("ul");for(let O=0;O<G.length;O+=1)G[O].c();h=M(),A=k("td"),C=k("ul");for(let O=0;O<Z.length;O+=1)Z[O].c();S=M(),I(r,"class","type-row svelte-k4kgn3"),I(d,"class","score-zero svelte-k4kgn3"),I(L,"class","score-one svelte-k4kgn3"),I(A,"class","score-two svelte-k4kgn3")},m(O,J){w(O,e,J),_(e,r),_(r,o),_(r,l),_(r,i),_(r,a),_(r,s),_(r,c),_(r,f),_(e,p),_(e,d),_(d,g);for(let H=0;H<z.length;H+=1)z[H]&&z[H].m(g,null);_(e,j),_(e,L),_(L,m);for(let H=0;H<G.length;H+=1)G[H]&&G[H].m(m,null);_(e,h),_(e,A),_(A,C);for(let H=0;H<Z.length;H+=1)Z[H]&&Z[H].m(C,null);_(e,S)},p(O,J){if(J&6&&t!==(t=O[9].junctionType+"")&&re(o,t),J&6&&u!==(u=O[9].movementType+"")&&re(f,u),J&6){$=V(O[9].scoreZero);let H;for(H=0;H<$.length;H+=1){const U=Wn(O,$,H);z[H]?z[H].p(U,J):(z[H]=Vn(U),z[H].c(),z[H].m(g,null))}for(;H<z.length;H+=1)z[H].d(1);z.length=$.length}if(J&6){D=V(O[9].scoreOne);let H;for(H=0;H<D.length;H+=1){const U=Kn(O,D,H);G[H]?G[H].p(U,J):(G[H]=Yn(U),G[H].c(),G[H].m(m,null))}for(;H<G.length;H+=1)G[H].d(1);G.length=D.length}if(J&6){P=V(O[9].scoreTwo);let H;for(H=0;H<P.length;H+=1){const U=Hn(O,P,H);Z[H]?Z[H].p(U,J):(Z[H]=xn(U),Z[H].c(),Z[H].m(C,null))}for(;H<Z.length;H+=1)Z[H].d(1);Z.length=P.length}},d(O){O&&v(e),de(z,O),de(G,O),de(Z,O)}}}function ys(n){let e,r,t,o,l,i,a,s,c=n[1],u,f,p,d,g,j,L,m,h;function A(D){n[5](D)}let C={k:"vert-radio",choices:ko,$$slots:{default:[ws]},$$scope:{ctx:n}};n[1]!==void 0&&(C.value=n[1]),i=new Fe({props:C}),ue.push(()=>me(i,"value",A)),i.$on("change",n[3]);let S=Xn(n),$=V(Jn(n[1],n[2])),z=[];for(let D=0;D<$.length;D+=1)z[D]=er(Qn(n,$,D));return{c(){e=k("h1"),e.textContent="LTN 1/20 scoring guidance",r=M(),t=k("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,o=M(),l=k("div"),B(i.$$.fragment),s=M(),S.c(),u=M(),f=k("table"),p=k("tr"),p.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,d=M();for(let D=0;D<z.length;D+=1)z[D].c();g=M(),j=k("button"),j.textContent="OK",X(l,"display","flex"),X(l,"justify-content","space-between")},m(D,G){w(D,e,G),w(D,r,G),w(D,t,G),w(D,o,G),w(D,l,G),T(i,l,null),_(l,s),S.m(l,null),w(D,u,G),w(D,f,G),_(f,p),_(f,d);for(let P=0;P<z.length;P+=1)z[P]&&z[P].m(f,null);w(D,g,G),w(D,j,G),L=!0,m||(h=q(j,"click",n[7]),m=!0)},p(D,G){const P={};if(G&524288&&(P.$$scope={dirty:G,ctx:D}),!a&&G&2&&(a=!0,P.value=D[1],_e(()=>a=!1)),i.$set(P),G&2&&oe(c,c=D[1])?(se(),y(S,1,1,ee),ae(),S=Xn(D),S.c(),b(S,1),S.m(l,null)):S.p(D,G),G&6){$=V(Jn(D[1],D[2]));let Z;for(Z=0;Z<$.length;Z+=1){const O=Qn(D,$,Z);z[Z]?z[Z].p(O,G):(z[Z]=er(O),z[Z].c(),z[Z].m(f,null))}for(;Z<z.length;Z+=1)z[Z].d(1);z.length=$.length}},i(D){L||(b(i.$$.fragment,D),b(S),L=!0)},o(D){y(i.$$.fragment,D),y(S),L=!1},d(D){D&&(v(e),v(r),v(t),v(o),v(l),v(u),v(f),v(g),v(j)),E(i),S.d(D),de(z,D),m=!1,h()}}}function As(n){let e,r,t,o,l,i,a=n[0]&&Zn(n);return{c(){e=k("button"),e.textContent="LTN 1/20 scoring guidance",r=M(),a&&a.c(),t=Ce(),I(e,"class","secondary")},m(s,c){w(s,e,c),w(s,r,c),a&&a.m(s,c),w(s,t,c),o=!0,l||(i=q(e,"click",n[4]),l=!0)},p(s,[c]){s[0]?a?(a.p(s,c),c&1&&b(a,1)):(a=Zn(s),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(se(),y(a,1,1,()=>{a=null}),ae())},i(s){o||(b(a),o=!0)},o(s){y(a),o=!1},d(s){s&&(v(e),v(r),v(t)),a&&a.d(s),l=!1,i()}}}function Cs(n,e,r){let t=!1,o=ko[0],l=qt(o)[0];function i(){r(2,l=qt(o)[0])}const a=()=>r(0,t=!0);function s(p){o=p,r(1,o)}function c(p){l=p,r(2,l)}return[t,o,l,i,a,s,c,()=>r(0,t=!1),()=>r(0,t=!1)]}class js extends le{constructor(e){super(),ie(this,e,Cs,As,oe,{})}}function Ss(n){let e;return{c(){e=N("User")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function tr(n){let e,r;return e=new js({}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ls(n){let e;return{c(){e=N("Score")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function zs(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g,j,L,m;function h(z){n[5](z)}let A={k:"horiz-radio",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]],$$slots:{default:[Ss]},$$scope:{ctx:n}};n[2].jats[n[0]].properties.details.movements[n[1]].kind!==void 0&&(A.value=n[2].jats[n[0]].properties.details.movements[n[1]].kind),l=new Fe({props:A}),ue.push(()=>me(l,"value",h));let C=n[2].jats[n[0]].properties.details.movements[n[1]].kind=="cycling"&&tr();function S(z){n[6](z)}let $={k:"horiz-radio",choices:n[3],$$slots:{default:[Ls]},$$scope:{ctx:n}};return n[2].jats[n[0]].properties.details.movements[n[1]].score!==void 0&&($.value=n[2].jats[n[0]].properties.details.movements[n[1]].score),c=new Fe({props:$}),ue.push(()=>me(c,"value",S)),{c(){e=k("label"),r=N(`Name
  `),t=k("input"),o=M(),B(l.$$.fragment),a=M(),C&&C.c(),s=M(),B(c.$$.fragment),f=M(),p=k("label"),d=N(`Comments
  `),g=k("textarea"),I(t,"type","text")},m(z,D){w(z,e,D),_(e,r),_(e,t),pe(t,n[2].jats[n[0]].properties.details.movements[n[1]].name),w(z,o,D),T(l,z,D),w(z,a,D),C&&C.m(z,D),w(z,s,D),T(c,z,D),w(z,f,D),w(z,p,D),_(p,d),_(p,g),pe(g,n[2].jats[n[0]].properties.details.movements[n[1]].notes),j=!0,L||(m=[q(t,"input",n[4]),q(g,"input",n[7])],L=!0)},p(z,[D]){D&7&&t.value!==z[2].jats[z[0]].properties.details.movements[z[1]].name&&pe(t,z[2].jats[z[0]].properties.details.movements[z[1]].name);const G={};D&256&&(G.$$scope={dirty:D,ctx:z}),!i&&D&7&&(i=!0,G.value=z[2].jats[z[0]].properties.details.movements[z[1]].kind,_e(()=>i=!1)),l.$set(G),z[2].jats[z[0]].properties.details.movements[z[1]].kind=="cycling"?C?D&7&&b(C,1):(C=tr(),C.c(),b(C,1),C.m(s.parentNode,s)):C&&(se(),y(C,1,1,()=>{C=null}),ae());const P={};D&256&&(P.$$scope={dirty:D,ctx:z}),!u&&D&7&&(u=!0,P.value=z[2].jats[z[0]].properties.details.movements[z[1]].score,_e(()=>u=!1)),c.$set(P),D&7&&pe(g,z[2].jats[z[0]].properties.details.movements[z[1]].notes)},i(z){j||(b(l.$$.fragment,z),b(C),b(c.$$.fragment,z),j=!0)},o(z){y(l.$$.fragment,z),y(C),y(c.$$.fragment,z),j=!1},d(z){z&&(v(e),v(o),v(a),v(s),v(f),v(p)),E(l,z),C&&C.d(z),E(c,z),L=!1,ye(m)}}}function Ms(n,e,r){let t;te(n,W,f=>r(2,t=f));let{junctionIdx:o}=e,{idx:l}=e,i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function a(){t.jats[o].properties.details.movements[l].name=this.value,W.set(t)}function s(f){n.$$.not_equal(t.jats[o].properties.details.movements[l].kind,f)&&(t.jats[o].properties.details.movements[l].kind=f,W.set(t))}function c(f){n.$$.not_equal(t.jats[o].properties.details.movements[l].score,f)&&(t.jats[o].properties.details.movements[l].score=f,W.set(t))}function u(){t.jats[o].properties.details.movements[l].notes=this.value,W.set(t)}return n.$$set=f=>{"junctionIdx"in f&&r(0,o=f.junctionIdx),"idx"in f&&r(1,l=f.idx)},[o,l,t,i,a,s,c,u]}class Bs extends le{constructor(e){super(),ie(this,e,Ms,zs,oe,{junctionIdx:0,idx:1})}}function Ts(n){return n%(2*Math.PI)*180/Math.PI}function Ot(n){return n%360*Math.PI/180}function nr(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function wo(n,e,r={}){if(r.final===!0)return Es(n,e);const t=nr(n),o=nr(e),l=Ot(t[0]),i=Ot(o[0]),a=Ot(t[1]),s=Ot(o[1]),c=Math.sin(i-l)*Math.cos(s),u=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return Ts(Math.atan2(c,u))}function Es(n,e){let r=wo(e,n);return r=(r+180)%360,r}var lt=wo;function Os(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function Ds(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!rr(n[0])||!rr(n[1]))throw new Error("coordinates must contain numbers");return Os({type:"Point",coordinates:n},e,r)}function rr(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Ns(n,e={}){const r=Ho(n),t=(r[0]+r[2])/2,o=(r[1]+r[3])/2;return Ds([t,o],e.properties,e)}var Is=Ns,Le=63710088e-1,Fs={centimeters:Le*100,centimetres:Le*100,degrees:360/(2*Math.PI),feet:Le*3.28084,inches:Le*39.37,kilometers:Le/1e3,kilometres:Le/1e3,meters:Le,metres:Le,miles:Le/1609.344,millimeters:Le*1e3,millimetres:Le*1e3,nauticalmiles:Le/1852,radians:1,yards:Le*1.0936};function Ps(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function Us(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!lr(n[0])||!lr(n[1]))throw new Error("coordinates must contain numbers");return Ps({type:"Point",coordinates:n},e,r)}function qs(n,e="kilometers"){const r=Fs[e];if(!r)throw new Error(e+" units is invalid");return n/r}function or(n){return n%(2*Math.PI)*180/Math.PI}function Wt(n){return n%360*Math.PI/180}function lr(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Rs(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Gs(n,e,r,t={}){const o=Rs(n),l=Wt(o[0]),i=Wt(o[1]),a=Wt(r),s=qs(e,t.units),c=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),u=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(c)),f=or(u),p=or(c);return Us([f,p],t.properties)}var kt=Gs,ze=63710088e-1,Js={centimeters:ze*100,centimetres:ze*100,degrees:360/(2*Math.PI),feet:ze*3.28084,inches:ze*39.37,kilometers:ze/1e3,kilometres:ze/1e3,meters:ze,metres:ze,miles:ze/1609.344,millimeters:ze*1e3,millimetres:ze*1e3,nauticalmiles:ze/1852,radians:1,yards:ze*1.0936};function Qs(n,e="kilometers"){const r=Js[e];if(!r)throw new Error(e+" units is invalid");return n*r}function Dt(n){return n%360*Math.PI/180}function ir(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Hs(n,e,r={}){var t=ir(n),o=ir(e),l=Dt(o[1]-t[1]),i=Dt(o[0]-t[0]),a=Dt(t[1]),s=Dt(o[1]),c=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return Qs(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),r.units)}var Ks=Hs;function Ws(n){let e=Is({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,o)=>sr(lt(e,o.point))-sr(lt(e,t.point)));let r=[];for(let t=0;t<n.length;t++){let o=n[t],l=lt(o.point,e),i=1;for(let a of Xs(t,n.length)){let s=n[a],c=lt(e,s.point),u=Zs(o.point,e,i++),f=Ks(o.point,e),p=kt(u,.5*f,l).geometry.coordinates,d=kt(p,.2*f,c).geometry.coordinates;r.push({point1:u,point2:p,point3:d,kind:"cycling",score:"X",name:`${o.name} to ${s.name}`,notes:""})}}return r}function Zs(n,e,r){let t=.003,l=lt(n,e)-90,i=t*r;return kt(n,i,l).geometry.coordinates}function sr(n){return(n+360)%360}function Xs(n,e){let r=[];for(let t=n+1;t<e;t++)r.push(t);for(let t=0;t<n;t++)r.push(t);return r}const Vs="/route-element/assets/movement-aa45473c.svg",Ys="/route-element/assets/pan-fbcec4cd.svg";function ar(n,e,r){const t=n.slice();return t[30]=e[r],t[31]=e,t[32]=r,t}function cr(n,e,r){const t=n.slice();return t[33]=e[r],t[34]=e,t[32]=r,t}function ur(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g,j,L,m,h,A;function C(J,H){return J[0].mode=="select"?ea:xs}let S=C(n),$=S(n);function z(J,H){return J[0].mode=="new-arm"?na:ta}let D=z(n),G=D(n);function P(J,H){return J[0].mode=="new-movement"?oa:ra}let Z=P(n),O=Z(n);return{c(){e=k("div"),r=k("button"),t=k("img"),l=M(),$.c(),i=M(),a=k("button"),s=Qt("svg"),c=Qt("circle"),u=Qt("text"),f=N("A"),p=M(),G.c(),d=M(),g=k("button"),j=k("img"),m=M(),O.c(),$t(t.src,o=Ys)||I(t,"src",o),I(t,"alt","Move map"),X(t,"vertical-align","middle"),I(r,"class","outline"),I(c,"cx","12"),I(c,"cy","12"),I(c,"r","12"),I(c,"fill","white"),I(u,"x","6"),I(u,"y","16"),I(u,"fill","#4472c4"),I(s,"width","24"),I(s,"height","24"),I(s,"xmlns","http://www.w3.org/2000/svg"),X(s,"vertical-align","middle"),I(a,"class","outline"),$t(j.src,L=Vs)||I(j,"src",L),I(j,"alt","New movement"),X(j,"vertical-align","middle"),I(g,"class","outline"),I(e,"class","control-panel svelte-l1e6xi")},m(J,H){w(J,e,H),_(e,r),_(r,t),_(r,l),$.m(r,null),_(e,i),_(e,a),_(a,s),_(s,c),_(s,u),_(u,f),_(a,p),G.m(a,null),_(e,d),_(e,g),_(g,j),_(g,m),O.m(g,null),h||(A=[q(r,"click",function(){Zt(n[3])&&n[3].apply(this,arguments)}),q(a,"click",n[11]),q(g,"click",n[12])],h=!0)},p(J,H){n=J,S!==(S=C(n))&&($.d(1),$=S(n),$&&($.c(),$.m(r,null))),D!==(D=z(n))&&(G.d(1),G=D(n),G&&(G.c(),G.m(a,null))),Z!==(Z=P(n))&&(O.d(1),O=Z(n),O&&(O.c(),O.m(g,null)))},d(J){J&&v(e),$.d(),G.d(),O.d(),h=!1,ye(A)}}}function xs(n){let e;return{c(){e=N("Move map")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function ea(n){let e;return{c(){e=k("b"),e.textContent="Move map"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function ta(n){let e;return{c(){e=N("New arm")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function na(n){let e;return{c(){e=k("b"),e.textContent="New arm"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function ra(n){let e;return{c(){e=N("New movement")},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function oa(n){let e;return{c(){e=k("b"),e.textContent="New movement"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function la(n){let e;return{c(){e=k("span"),e.textContent=`${ha(n[32])}`,I(e,"class","dot svelte-l1e6xi"),X(e,"color","#4472c4"),X(e,"background-color","white")},m(r,t){w(r,e,t)},p:ee,d(r){r&&v(e)}}}function fr(n){let e,r,t;function o(s){n[13](s,n[33])}function l(){return n[14](n[32])}function i(){return n[15](n[32])}let a={draggable:!0,$$slots:{default:[la]},$$scope:{ctx:n}};return n[33].point!==void 0&&(a.lngLat=n[33].point),e=new Ke({props:a}),ue.push(()=>me(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){B(e.$$.fragment)},m(s,c){T(e,s,c),t=!0},p(s,c){n=s;const u={};c[1]&16&&(u.$$scope={dirty:c,ctx:n}),!r&&c[0]&18&&(r=!0,u.lngLat=n[33].point,_e(()=>r=!1)),e.$set(u)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){y(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function ia(n){let e;return{c(){e=k("span"),I(e,"class","dot svelte-l1e6xi"),X(e,"background-color",n[6][n[30].score]),X(e,"opacity",n[30].kind=="walking & wheeling"?"0%":"100%")},m(r,t){w(r,e,t)},p(r,t){t[0]&18&&X(e,"background-color",r[6][r[30].score]),t[0]&18&&X(e,"opacity",r[30].kind=="walking & wheeling"?"0%":"100%")},d(r){r&&v(e)}}}function sa(n){let e;return{c(){e=k("span"),I(e,"class","dot svelte-l1e6xi"),X(e,"background-color",n[6][n[30].score])},m(r,t){w(r,e,t)},p(r,t){t[0]&18&&X(e,"background-color",r[6][r[30].score])},d(r){r&&v(e)}}}function aa(n){let e;return{c(){e=k("span"),I(e,"class","dot svelte-l1e6xi"),X(e,"background-color",n[6][n[30].score]),X(e,"opacity","0%")},m(r,t){w(r,e,t)},p(r,t){t[0]&18&&X(e,"background-color",r[6][r[30].score])},d(r){r&&v(e)}}}function pr(n){let e,r,t,o,l,i,a,s,c;function u($){n[16]($,n[30])}function f(){return n[17](n[32])}function p(){return n[18](n[32])}let d={draggable:!0,$$slots:{default:[ia]},$$scope:{ctx:n}};n[30].point1!==void 0&&(d.lngLat=n[30].point1),e=new Ke({props:d}),ue.push(()=>me(e,"lngLat",u)),e.$on("dragend",f),e.$on("click",p);function g($){n[19]($,n[30])}function j(){return n[20](n[32])}function L(){return n[21](n[32])}let m={draggable:!0,$$slots:{default:[sa]},$$scope:{ctx:n}};n[30].point2!==void 0&&(m.lngLat=n[30].point2),o=new Ke({props:m}),ue.push(()=>me(o,"lngLat",g)),o.$on("dragend",j),o.$on("click",L);function h($){n[22]($,n[30])}function A(){return n[23](n[32])}function C(){return n[24](n[32])}let S={draggable:!0,$$slots:{default:[aa]},$$scope:{ctx:n}};return n[30].point3!==void 0&&(S.lngLat=n[30].point3),a=new Ke({props:S}),ue.push(()=>me(a,"lngLat",h)),a.$on("dragend",A),a.$on("click",C),{c(){B(e.$$.fragment),t=M(),B(o.$$.fragment),i=M(),B(a.$$.fragment)},m($,z){T(e,$,z),w($,t,z),T(o,$,z),w($,i,z),T(a,$,z),c=!0},p($,z){n=$;const D={};z[0]&18|z[1]&16&&(D.$$scope={dirty:z,ctx:n}),!r&&z[0]&18&&(r=!0,D.lngLat=n[30].point1,_e(()=>r=!1)),e.$set(D);const G={};z[0]&18|z[1]&16&&(G.$$scope={dirty:z,ctx:n}),!l&&z[0]&18&&(l=!0,G.lngLat=n[30].point2,_e(()=>l=!1)),o.$set(G);const P={};z[0]&18|z[1]&16&&(P.$$scope={dirty:z,ctx:n}),!s&&z[0]&18&&(s=!0,P.lngLat=n[30].point3,_e(()=>s=!1)),a.$set(P)},i($){c||(b(e.$$.fragment,$),b(o.$$.fragment,$),b(a.$$.fragment,$),c=!0)},o($){y(e.$$.fragment,$),y(o.$$.fragment,$),y(a.$$.fragment,$),c=!1},d($){$&&(v(t),v(i)),E(e,$),E(o,$),E(a,$)}}}function ca(n){let e=(n[29].name||"Untitled movement")+"",r;return{c(){r=N(e)},m(t,o){w(t,r,o)},p(t,o){o[0]&536870912&&e!==(e=(t[29].name||"Untitled movement")+"")&&re(r,e)},d(t){t&&v(r)}}}function ua(n){let e,r;return e=new at({props:{$$slots:{default:[ca,({props:t})=>({29:t}),({props:t})=>[t?536870912:0]]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o[0]&536870912|o[1]&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function fa(n){let e=(n[29].name||"Untitled movement")+"",r;return{c(){r=N(e)},m(t,o){w(t,r,o)},p(t,o){o[0]&536870912&&e!==(e=(t[29].name||"Untitled movement")+"")&&re(r,e)},d(t){t&&v(r)}}}function pa(n){let e,r;return e=new at({props:{$$slots:{default:[fa,({props:t})=>({29:t}),({props:t})=>[t?536870912:0]]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o[0]&536870912|o[1]&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function da(n){let e,r,t,o,l,i;return e=new qe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Ft(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[ua]},$$scope:{ctx:n}}}),e.$on("click",n[8]),t=new qe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Ft(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[pa]},$$scope:{ctx:n}}}),t.$on("click",n[8]),l=new Ye({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){B(e.$$.fragment),r=M(),B(t.$$.fragment),o=M(),B(l.$$.fragment)},m(a,s){T(e,a,s),w(a,r,s),T(t,a,s),w(a,o,s),T(l,a,s),i=!0},p(a,s){const c={};s[1]&16&&(c.$$scope={dirty:s,ctx:a}),e.$set(c);const u={};s[1]&16&&(u.$$scope={dirty:s,ctx:a}),t.$set(u)},i(a){i||(b(e.$$.fragment,a),b(t.$$.fragment,a),b(l.$$.fragment,a),i=!0)},o(a){y(e.$$.fragment,a),y(t.$$.fragment,a),y(l.$$.fragment,a),i=!1},d(a){a&&(v(r),v(o)),E(e,a),E(t,a),E(l,a)}}}function ma(n){let e,r,t,o;return e=new qe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Ze({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){B(e.$$.fragment),r=M(),B(t.$$.fragment)},m(l,i){T(e,l,i),w(l,r,i),T(t,l,i),o=!0},p:ee,i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&v(r),E(e,l),E(t,l)}}}function _a(n){let e,r,t,o,l,i,a,s,c;e=new vt({}),e.$on("click",n[7]);let u=n[0].mode!="editing"&&ur(n),f=V(n[4].jats[n[1]].properties.details.arms),p=[];for(let m=0;m<f.length;m+=1)p[m]=fr(cr(n,f,m));const d=m=>y(p[m],1,1,()=>{p[m]=null});let g=V(n[4].jats[n[1]].properties.details.movements),j=[];for(let m=0;m<g.length;m+=1)j[m]=pr(ar(n,g,m));const L=m=>y(j[m],1,1,()=>{j[m]=null});return i=new ve({props:{data:n[9](n[4]),$$slots:{default:[da]},$$scope:{ctx:n}}}),s=new ve({props:{data:n[5],$$slots:{default:[ma]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=M(),u&&u.c(),t=M();for(let m=0;m<p.length;m+=1)p[m].c();o=M();for(let m=0;m<j.length;m+=1)j[m].c();l=M(),B(i.$$.fragment),a=M(),B(s.$$.fragment)},m(m,h){T(e,m,h),w(m,r,h),u&&u.m(m,h),w(m,t,h);for(let A=0;A<p.length;A+=1)p[A]&&p[A].m(m,h);w(m,o,h);for(let A=0;A<j.length;A+=1)j[A]&&j[A].m(m,h);w(m,l,h),T(i,m,h),w(m,a,h),T(s,m,h),c=!0},p(m,h){if(m[0].mode!="editing"?u?u.p(m,h):(u=ur(m),u.c(),u.m(t.parentNode,t)):u&&(u.d(1),u=null),h[0]&22){f=V(m[4].jats[m[1]].properties.details.arms);let S;for(S=0;S<f.length;S+=1){const $=cr(m,f,S);p[S]?(p[S].p($,h),b(p[S],1)):(p[S]=fr($),p[S].c(),b(p[S],1),p[S].m(o.parentNode,o))}for(se(),S=f.length;S<p.length;S+=1)d(S);ae()}if(h[0]&86){g=V(m[4].jats[m[1]].properties.details.movements);let S;for(S=0;S<g.length;S+=1){const $=ar(m,g,S);j[S]?(j[S].p($,h),b(j[S],1)):(j[S]=pr($),j[S].c(),b(j[S],1),j[S].m(l.parentNode,l))}for(se(),S=g.length;S<j.length;S+=1)L(S);ae()}const A={};h[0]&16&&(A.data=m[9](m[4])),h[1]&16&&(A.$$scope={dirty:h,ctx:m}),i.$set(A);const C={};h[0]&32&&(C.data=m[5]),h[1]&16&&(C.$$scope={dirty:h,ctx:m}),s.$set(C)},i(m){if(!c){b(e.$$.fragment,m);for(let h=0;h<f.length;h+=1)b(p[h]);for(let h=0;h<g.length;h+=1)b(j[h]);b(i.$$.fragment,m),b(s.$$.fragment,m),c=!0}},o(m){y(e.$$.fragment,m),p=p.filter(Boolean);for(let h=0;h<p.length;h+=1)y(p[h]);j=j.filter(Boolean);for(let h=0;h<j.length;h+=1)y(j[h]);y(i.$$.fragment,m),y(s.$$.fragment,m),c=!1},d(m){m&&(v(r),v(t),v(o),v(l),v(a)),E(e,m),u&&u.d(m),de(p,m),de(j,m),E(i,m),E(s,m)}}}function ga(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function ha(n){return String.fromCharCode(n+"A".charCodeAt(0))}function ba(n,e,r){let t,o,l;te(n,W,F=>r(4,o=F)),te(n,Pt,F=>r(25,l=F));let{junctionIdx:i}=e,{mode:a}=e,{hoveringSidebar:s}=e,{select:c}=e,{stopEditing:u}=e,f={0:He.red.background,1:He.amber.background,2:He.green.background,X:He.critical.background};function p(F,Q,be){let $e={type:"FeatureCollection",features:[]},De=Q.mode=="editing"?Q.id:be;return De!=null&&(De.kind=="arm"?$e.features.push(ga(F.jats[i].properties.details.arms[De.idx],De.idx)):$e.features.push(L(F.jats[i].properties.details.movements[De.idx],De.idx))),$e}async function d(F){if(l){for(let Q of l.queryRenderedFeatures(F.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a.mode!="select"){if(a.mode=="editing"){await u();return}a.mode=="new-arm"?(x(W,o.jats[i].properties.details.arms=[...o.jats[i].properties.details.arms,{point:F.detail.lngLat.toArray(),name:""}],o),await c({kind:"arm",idx:o.jats[i].properties.details.arms.length-1})):(x(W,o.jats[i].properties.details.movements=[...o.jats[i].properties.details.movements,{point1:F.detail.lngLat.toArray(),point2:kt(F.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:kt(F.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await c({kind:"movement",idx:o.jats[i].properties.details.movements.length-1}))}}}async function g(F){await c({kind:"movement",idx:F.detail.features[0].id})}function j(F){let Q={type:"FeatureCollection",features:F.jats[i].properties.details.movements.map((be,$e)=>L(be,$e))};for(let be of F.jats[i].properties.details.movements)if(Q.features.push(m(be,Q.features.length)),be.kind=="walking & wheeling"){let $e={...be,point1:be.point3,point3:be.point1};Q.features.push(m($e,Q.features.length))}return Q}function L(F,Q){return{type:"Feature",id:Q,properties:{name:F.name,kind:F.kind,color:f[F.score]},geometry:{type:"LineString",coordinates:[F.point1,F.point2,F.point3]}}}function m(F,Q){return{type:"Feature",id:Q,properties:{kind:F.kind,color:f[F.score],angle:lt(F.point2,F.point3)},geometry:{type:"Point",coordinates:F.point3}}}const h=()=>r(0,a={mode:"new-arm"}),A=()=>r(0,a={mode:"new-movement"});function C(F,Q){n.$$.not_equal(Q.point,F)&&(Q.point=F,W.set(o))}const S=F=>c({kind:"arm",idx:F}),$=F=>c({kind:"arm",idx:F});function z(F,Q){n.$$.not_equal(Q.point1,F)&&(Q.point1=F,W.set(o))}const D=F=>c({kind:"movement",idx:F}),G=F=>c({kind:"movement",idx:F});function P(F,Q){n.$$.not_equal(Q.point2,F)&&(Q.point2=F,W.set(o))}const Z=F=>c({kind:"movement",idx:F}),O=F=>c({kind:"movement",idx:F});function J(F,Q){n.$$.not_equal(Q.point3,F)&&(Q.point3=F,W.set(o))}const H=F=>c({kind:"movement",idx:F}),U=F=>c({kind:"movement",idx:F});return n.$$set=F=>{"junctionIdx"in F&&r(1,i=F.junctionIdx),"mode"in F&&r(0,a=F.mode),"hoveringSidebar"in F&&r(10,s=F.hoveringSidebar),"select"in F&&r(2,c=F.select),"stopEditing"in F&&r(3,u=F.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&1041&&r(5,t=p(o,a,s))},[a,i,c,u,o,t,f,d,g,j,s,h,A,C,S,$,z,D,G,P,Z,O,J,H,U]}class $a extends le{constructor(e){super(),ie(this,e,ba,_a,oe,{junctionIdx:1,mode:0,hoveringSidebar:10,select:2,stopEditing:3},null,[-1,-1])}}function dr(n){if(n.movements.length==0)return"No movements added";let e=0,r=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],r+=2;let t=e/r*100;return`${Math.round(t)}%`}const{window:ka}=wt;function mr(n,e,r){const t=n.slice();t[23]=e[r],t[26]=r;const o=t[10][t[23].score];return t[24]=o,t}function _r(n,e,r){const t=n.slice();return t[27]=e[r],t[26]=r,t}function wa(n){let e,r,t,o,l,i,a,s,c;return{c(){e=k("button"),e.textContent="Done",r=M(),t=k("button"),t.textContent="Delete",o=M(),l=k("label"),i=N(`Arm name
        `),a=k("input"),I(a,"type","text")},m(u,f){w(u,e,f),w(u,r,f),w(u,t,f),w(u,o,f),w(u,l,f),_(l,i),_(l,a),pe(a,n[4].jats[n[0]].properties.details.arms[n[1].id.idx].name),s||(c=[q(e,"click",n[19]),q(t,"click",n[8]),q(a,"input",n[20])],s=!0)},p(u,f){f&19&&a.value!==u[4].jats[u[0]].properties.details.arms[u[1].id.idx].name&&pe(a,u[4].jats[u[0]].properties.details.arms[u[1].id.idx].name)},i:ee,o:ee,d(u){u&&(v(e),v(r),v(t),v(o),v(l)),s=!1,ye(c)}}}function va(n){let e,r,t,o,l,i,a,s;return e=new Bs({props:{junctionIdx:n[0],idx:n[1].id.idx}}),{c(){B(e.$$.fragment),r=M(),t=k("button"),t.textContent="Save",o=M(),l=k("button"),l.textContent="Delete"},m(c,u){T(e,c,u),w(c,r,u),w(c,t,u),w(c,o,u),w(c,l,u),i=!0,a||(s=[q(t,"click",n[7]),q(l,"click",n[8])],a=!0)},p(c,u){const f={};u&1&&(f.junctionIdx=c[0]),u&2&&(f.idx=c[1].id.idx),e.$set(f)},i(c){i||(b(e.$$.fragment,c),i=!0)},o(c){y(e.$$.fragment,c),i=!1},d(c){c&&(v(r),v(t),v(o),v(l)),E(e,c),a=!1,ye(s)}}}function ya(n){let e,r,t,o,l,i,a,s,c,u,f=n[4].jats[n[0]].properties.name+"",p,d,g=dr(n[4].jats[n[0]].properties.details)+"",j,L,m,h,A,C,S,$,z,D,G=V(n[4].jats[n[0]].properties.details.arms),P=[];for(let U=0;U<G.length;U+=1)P[U]=gr(_r(n,G,U));const Z=U=>y(P[U],1,1,()=>{P[U]=null});let O=V(n[4].jats[n[0]].properties.details.movements),J=[];for(let U=0;U<O.length;U+=1)J[U]=hr(mr(n,O,U));const H=U=>y(J[U],1,1,()=>{J[U]=null});return{c(){e=k("button"),e.textContent="Done",r=M(),t=k("h3"),t.textContent="Arms",o=M();for(let U=0;U<P.length;U+=1)P[U].c();l=M(),i=k("h3"),i.textContent="Movements",a=M(),s=k("p"),c=N(`Total JAT score
        `),u=k("i"),p=N(f),d=N(`
        : `),j=N(g),L=M(),m=k("button"),h=N("Generate cycling movements between all arms"),C=M();for(let U=0;U<J.length;U+=1)J[U].c();S=Ce(),I(m,"class","secondary"),m.disabled=A=n[4].jats[n[0]].properties.details.arms.length<2},m(U,F){w(U,e,F),w(U,r,F),w(U,t,F),w(U,o,F);for(let Q=0;Q<P.length;Q+=1)P[Q]&&P[Q].m(U,F);w(U,l,F),w(U,i,F),w(U,a,F),w(U,s,F),_(s,c),_(s,u),_(u,p),_(s,d),_(s,j),w(U,L,F),w(U,m,F),_(m,h),w(U,C,F);for(let Q=0;Q<J.length;Q+=1)J[Q]&&J[Q].m(U,F);w(U,S,F),$=!0,z||(D=[q(e,"click",n[12]),q(m,"click",n[11])],z=!0)},p(U,F){if(F&85){G=V(U[4].jats[U[0]].properties.details.arms);let Q;for(Q=0;Q<G.length;Q+=1){const be=_r(U,G,Q);P[Q]?(P[Q].p(be,F),b(P[Q],1)):(P[Q]=gr(be),P[Q].c(),b(P[Q],1),P[Q].m(l.parentNode,l))}for(se(),Q=G.length;Q<P.length;Q+=1)Z(Q);ae()}if((!$||F&17)&&f!==(f=U[4].jats[U[0]].properties.name+"")&&re(p,f),(!$||F&17)&&g!==(g=dr(U[4].jats[U[0]].properties.details)+"")&&re(j,g),(!$||F&17&&A!==(A=U[4].jats[U[0]].properties.details.arms.length<2))&&(m.disabled=A),F&1109){O=V(U[4].jats[U[0]].properties.details.movements);let Q;for(Q=0;Q<O.length;Q+=1){const be=mr(U,O,Q);J[Q]?(J[Q].p(be,F),b(J[Q],1)):(J[Q]=hr(be),J[Q].c(),b(J[Q],1),J[Q].m(S.parentNode,S))}for(se(),Q=O.length;Q<J.length;Q+=1)H(Q);ae()}},i(U){if(!$){for(let F=0;F<G.length;F+=1)b(P[F]);for(let F=0;F<O.length;F+=1)b(J[F]);$=!0}},o(U){P=P.filter(Boolean);for(let F=0;F<P.length;F+=1)y(P[F]);J=J.filter(Boolean);for(let F=0;F<J.length;F+=1)y(J[F]);$=!1},d(U){U&&(v(e),v(r),v(t),v(o),v(l),v(i),v(a),v(s),v(L),v(m),v(C),v(S)),de(P,U),de(J,U),z=!1,ye(D)}}}function gr(n){let e,r;function t(){return n[13](n[26])}function o(){return n[14](n[26])}return e=new $o({props:{name:`${br(n[26])} - ${n[27].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[15]),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0},p(l,i){n=l;const a={};i&17&&(a.name=`${br(n[26])} - ${n[27].name||"Unnamed arm"}`),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l)}}}function Aa(n){let e,r,t,o=n[23].score+"",l,i,a,s=$r(n[23].kind)+"",c,u;return{c(){e=k("div"),r=k("span"),t=N("Score: "),l=N(o),i=M(),a=k("span"),c=N(s),u=M(),X(r,"padding","4px"),X(r,"color",n[24].font),X(r,"background-color",n[24].background),X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(f,p){w(f,e,p),_(e,r),_(r,t),_(r,l),_(e,i),_(e,a),_(a,c),w(f,u,p)},p(f,p){p&17&&o!==(o=f[23].score+"")&&re(l,o),p&17&&X(r,"color",f[24].font),p&17&&X(r,"background-color",f[24].background),p&17&&s!==(s=$r(f[23].kind)+"")&&re(c,s)},d(f){f&&(v(e),v(u))}}}function hr(n){let e,r;function t(){return n[16](n[26])}function o(){return n[17](n[26])}return e=new $o({props:{name:n[23].name||"Unnamed movement",$$slots:{default:[Aa]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[18]),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0},p(l,i){n=l;const a={};i&17&&(a.name=n[23].name||"Unnamed movement"),i&536870929&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l)}}}function Ca(n){let e,r,t,o=n[4].jats[n[0]].properties.name+"",l,i,a,s,c;const u=[ya,va,wa],f=[];function p(d,g){return d[1].mode!="editing"?0:d[1].id.kind=="movement"?1:2}return a=p(n),s=f[a]=u[a](n),{c(){e=k("div"),r=k("h2"),t=N("JAT for "),l=N(o),i=M(),s.c(),I(e,"slot","sidebar")},m(d,g){w(d,e,g),_(e,r),_(r,t),_(r,l),_(e,i),f[a].m(e,null),n[21](e),c=!0},p(d,g){(!c||g&17)&&o!==(o=d[4].jats[d[0]].properties.name+"")&&re(l,o);let j=a;a=p(d),a===j?f[a].p(d,g):(se(),y(f[j],1,1,()=>{f[j]=null}),ae(),s=f[a],s?s.p(d,g):(s=f[a]=u[a](d),s.c()),b(s,1),s.m(e,null))},i(d){c||(b(s),c=!0)},o(d){y(s),c=!1},d(d){d&&v(e),f[a].d(),n[21](null)}}}function ja(n){let e,r;return e=new Ze({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Sa(n){let e,r,t,o,l,i,a;return r=new Ge({props:{except:"jats"}}),o=new ve({props:{data:ge(n[4].jats),generateId:!0,$$slots:{default:[ja]},$$scope:{ctx:n}}}),i=new $a({props:{junctionIdx:n[0],mode:n[1],hoveringSidebar:n[2],select:n[6],stopEditing:n[7]}}),{c(){e=k("div"),B(r.$$.fragment),t=M(),B(o.$$.fragment),l=M(),B(i.$$.fragment),I(e,"slot","map")},m(s,c){w(s,e,c),T(r,e,null),_(e,t),T(o,e,null),_(e,l),T(i,e,null),a=!0},p(s,c){const u={};c&16&&(u.data=ge(s[4].jats)),c&536870913&&(u.$$scope={dirty:c,ctx:s}),o.$set(u);const f={};c&1&&(f.junctionIdx=s[0]),c&2&&(f.mode=s[1]),c&4&&(f.hoveringSidebar=s[2]),i.$set(f)},i(s){a||(b(r.$$.fragment,s),b(o.$$.fragment,s),b(i.$$.fragment,s),a=!0)},o(s){y(r.$$.fragment,s),y(o.$$.fragment,s),y(i.$$.fragment,s),a=!1},d(s){s&&v(e),E(r),E(o),E(i)}}}function La(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Sa],sidebar:[Ca]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=q(ka,"keydown",n[9]),t=!0)},p(l,[i]){const a={};i&536870975&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function br(n){return String.fromCharCode(n+"A".charCodeAt(0))}function $r(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function za(n,e,r){let t,o;te(n,W,P=>r(4,t=P)),te(n,Y,P=>r(5,o=P));let{junctionIdx:l}=e,i={mode:"select"},a=null,s=null,c;async function u(P){a=c.scrollTop,r(1,i={mode:"editing",id:P}),r(2,s=null),await st(),r(3,c.scrollTop=0,c)}async function f(){r(1,i={mode:"select"}),a!=null&&(await st(),r(3,c.scrollTop=a,c),a=null)}function p(){i.mode=="editing"&&window.confirm(`Delete this ${i.id.kind}?`)&&(i.id.kind=="movement"?(t.jats[l].properties.details.movements.splice(i.id.idx,1),W.set(t)):(t.jats[l].properties.details.arms.splice(i.id.idx,1),W.set(t)),f())}function d(P){if(i.mode!="editing")return;let Z=P.target.tagName,O=Z=="INPUT"||Z=="TEXTAREA";P.key=="Escape"||P.key=="Enter"&&!O?(P.stopPropagation(),f()):P.key=="Delete"&&!O&&(P.stopPropagation(),p())}let g={0:He.red,1:He.amber,2:He.green,X:He.critical};function j(){if(t.jats[l].properties.details.movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let P=t.jats[l].properties.details.movements.filter(Z=>Z.kind=="walking & wheeling");x(W,t.jats[l].properties.details.movements=[...P,...Ws(t.jats[l].properties.details.arms)],t)}const L=()=>x(Y,o={kind:"edit-jat",idx:l},o),m=P=>u({kind:"arm",idx:P}),h=P=>r(2,s={kind:"arm",idx:P}),A=()=>r(2,s=null),C=P=>u({kind:"movement",idx:P}),S=P=>r(2,s={kind:"movement",idx:P}),$=()=>r(2,s=null),z=()=>r(1,i={mode:"select"});function D(){t.jats[l].properties.details.arms[i.id.idx].name=this.value,W.set(t)}function G(P){ue[P?"unshift":"push"](()=>{c=P,r(3,c)})}return n.$$set=P=>{"junctionIdx"in P&&r(0,l=P.junctionIdx)},[l,i,s,c,t,o,u,f,p,d,g,j,L,m,h,A,C,S,$,z,D,G]}class Ma extends le{constructor(e){super(),ie(this,e,za,La,oe,{junctionIdx:0})}}const{window:Ba}=wt;function Ta(n){let e,r,t,o,l,i,a,s,c,u,f,p;return{c(){e=k("div"),r=k("button"),r.textContent="Done",t=M(),o=k("button"),o.textContent="Delete JAT",l=M(),i=k("label"),a=N(`Name:
      `),s=k("input"),c=M(),u=k("button"),u.textContent="Fill out JAT",I(s,"type","text"),I(e,"slot","sidebar")},m(d,g){w(d,e,g),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(i,a),_(i,s),pe(s,n[1].jats[n[0]].properties.name),_(e,c),_(e,u),f||(p=[q(r,"click",n[6]),q(o,"click",n[4]),q(s,"input",n[7]),q(u,"click",n[8])],f=!0)},p(d,g){g&3&&s.value!==d[1].jats[d[0]].properties.name&&pe(s,d[1].jats[d[0]].properties.name)},d(d){d&&v(e),f=!1,ye(p)}}}function Ea(n){let e,r;return e=new Ze({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Oa(n){let e,r,t,o,l,i,a,s;r=new Ge({props:{except:"jats"}}),o=new ve({props:{data:ge(n[1].jats),generateId:!0,$$slots:{default:[Ea]},$$scope:{ctx:n}}});function c(f){n[5](f)}let u={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(u.lngLat=n[1].jats[n[0]].geometry.coordinates),i=new en({props:u}),ue.push(()=>me(i,"lngLat",c)),{c(){e=k("div"),B(r.$$.fragment),t=M(),B(o.$$.fragment),l=M(),B(i.$$.fragment),I(e,"slot","map")},m(f,p){w(f,e,p),T(r,e,null),_(e,t),T(o,e,null),_(e,l),T(i,e,null),s=!0},p(f,p){const d={};p&2&&(d.data=ge(f[1].jats)),p&513&&(d.$$scope={dirty:p,ctx:f}),o.$set(d);const g={};p&3&&(g.color=f[1].jats[f[0]].properties.color),!a&&p&3&&(a=!0,g.lngLat=f[1].jats[f[0]].geometry.coordinates,_e(()=>a=!1)),i.$set(g)},i(f){s||(b(r.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),E(r),E(o),E(i)}}}function Da(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[Oa],sidebar:[Ta]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=q(Ba,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function Na(n,e,r){let t,o;te(n,W,p=>r(1,t=p)),te(n,Y,p=>r(2,o=p));let{idx:l}=e;function i(p){p.key=="Escape"&&x(Y,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this JAT?")&&(x(Y,o={kind:"neutral"},o),await st(),t.jats.splice(l,1),W.set(t))}function s(p){n.$$.not_equal(t.jats[l].geometry.coordinates,p)&&(t.jats[l].geometry.coordinates=p,W.set(t))}const c=()=>x(Y,o={kind:"neutral"},o);function u(){t.jats[l].properties.name=this.value,W.set(t)}const f=()=>x(Y,o={kind:"edit-jat-detail",idx:l},o);return n.$$set=p=>{"idx"in p&&r(0,l=p.idx)},[l,t,o,i,a,s,c,u,f]}class Ia extends le{constructor(e){super(),ie(this,e,Na,Da,oe,{idx:0})}}function kr(n,e,r){const t=n.slice();return t[5]=e[r],t[6]=e,t[7]=r,t}function Fa(n){let e,r;return{c(){e=k("span"),r=M(),I(e,"class","dot svelte-jgyhla")},m(t,o){w(t,e,o),w(t,r,o)},p:ee,d(t){t&&(v(e),v(r))}}}function wr(n){let e,r,t;function o(a){n[3](a,n[5],n[6],n[7])}function l(){return n[4](n[7])}let i={draggable:!0,$$slots:{default:[Fa]},$$scope:{ctx:n}};return n[5]!==void 0&&(i.lngLat=n[5]),e=new Ke({props:i}),ue.push(()=>me(e,"lngLat",o)),e.$on("contextmenu",l),{c(){B(e.$$.fragment)},m(a,s){T(e,a,s),t=!0},p(a,s){n=a;const c={};s&256&&(c.$$scope={dirty:s,ctx:n}),!r&&s&1&&(r=!0,c.lngLat=n[5],_e(()=>r=!1)),e.$set(c)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){y(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function Pa(n){let e,r,t,o;e=new vt({}),e.$on("click",n[1]);let l=V(n[0].geometry.coordinates),i=[];for(let s=0;s<l.length;s+=1)i[s]=wr(kr(n,l,s));const a=s=>y(i[s],1,1,()=>{i[s]=null});return{c(){B(e.$$.fragment),r=M();for(let s=0;s<i.length;s+=1)i[s].c();t=Ce()},m(s,c){T(e,s,c),w(s,r,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(s,c);w(s,t,c),o=!0},p(s,[c]){if(c&5){l=V(s[0].geometry.coordinates);let u;for(u=0;u<l.length;u+=1){const f=kr(s,l,u);i[u]?(i[u].p(f,c),b(i[u],1)):(i[u]=wr(f),i[u].c(),b(i[u],1),i[u].m(t.parentNode,t))}for(se(),u=l.length;u<i.length;u+=1)a(u);ae()}},i(s){if(!o){b(e.$$.fragment,s);for(let c=0;c<l.length;c+=1)b(i[c]);o=!0}},o(s){y(e.$$.fragment,s),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)y(i[c]);o=!1},d(s){s&&(v(r),v(t)),E(e,s),de(i,s)}}}function Ua(n,e,r){let{f:t}=e;function o(s){t.geometry.coordinates.push(s.detail.lngLat.toArray()),r(0,t)}function l(s){t.geometry.coordinates.splice(s,1),r(0,t)}function i(s,c,u,f){u[f]=s,r(0,t)}const a=s=>l(s);return n.$$set=s=>{"f"in s&&r(0,t=s.f)},[t,o,l,i,a]}class qa extends le{constructor(e){super(),ie(this,e,Ua,Pa,oe,{f:0})}}const{window:Ra}=wt;function vr(n,e,r){const t=n.slice();return t[13]=e[r],t[14]=e,t[15]=r,t}function yr(n){let e;return{c(){e=k("p"),e.textContent="A link needs at least two points"},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function Ga(n){let e,r,t;function o(){return n[10](n[13])}return{c(){e=k("button"),e.textContent="?",I(e,"class","outline")},m(l,i){w(l,e,i),r||(t=q(e,"click",o),r=!0)},p(l,i){n=l},d(l){l&&v(e),r=!1,t()}}}function Ja(n){let e=n[13].name+"",r,t,o=n[13].description+"",l,i,a,s=Ve[n[13].name]&&Ga(n);return{c(){r=N(e),t=N(": "),l=N(o),i=M(),s&&s.c(),a=M()},m(c,u){w(c,r,u),w(c,t,u),w(c,l,u),w(c,i,u),s&&s.m(c,u),w(c,a,u)},p(c,u){Ve[c[13].name]&&s.p(c,u)},d(c){c&&(v(r),v(t),v(l),v(i),v(a)),s&&s.d(c)}}}function Ar(n){let e,r,t;function o(i){n[11](i,n[15])}let l={k:"horiz-radio",choices:n[13].choices,$$slots:{default:[Ja]},$$scope:{ctx:n}};return n[1].links[n[0]].properties.answers[n[15]]!==void 0&&(l.value=n[1].links[n[0]].properties.answers[n[15]]),e=new Fe({props:l}),ue.push(()=>me(e,"value",o)),{c(){B(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,a){n=i;const s={};a&65540&&(s.$$scope={dirty:a,ctx:n}),!r&&a&3&&(r=!0,s.value=n[1].links[n[0]].properties.answers[n[15]],_e(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Qa(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g,j,L=!n[3]&&yr(),m=V(Se),h=[];for(let C=0;C<m.length;C+=1)h[C]=Ar(vr(n,m,C));const A=C=>y(h[C],1,1,()=>{h[C]=null});return{c(){e=k("div"),r=k("button"),t=N("Done"),l=M(),i=k("button"),i.textContent="Delete link",a=M(),L&&L.c(),s=M(),c=k("label"),u=N(`Name:
      `),f=k("input"),p=M();for(let C=0;C<h.length;C+=1)h[C].c();r.disabled=o=!n[3],I(f,"type","text"),I(e,"slot","sidebar")},m(C,S){w(C,e,S),_(e,r),_(r,t),_(e,l),_(e,i),_(e,a),L&&L.m(e,null),_(e,s),_(e,c),_(c,u),_(c,f),pe(f,n[1].links[n[0]].properties.name),_(e,p);for(let $=0;$<h.length;$+=1)h[$]&&h[$].m(e,null);d=!0,g||(j=[q(r,"click",n[8]),q(i,"click",n[6]),q(f,"input",n[9])],g=!0)},p(C,S){if((!d||S&8&&o!==(o=!C[3]))&&(r.disabled=o),C[3]?L&&(L.d(1),L=null):L||(L=yr(),L.c(),L.m(e,s)),S&3&&f.value!==C[1].links[C[0]].properties.name&&pe(f,C[1].links[C[0]].properties.name),S&7){m=V(Se);let $;for($=0;$<m.length;$+=1){const z=vr(C,m,$);h[$]?(h[$].p(z,S),b(h[$],1)):(h[$]=Ar(z),h[$].c(),b(h[$],1),h[$].m(e,null))}for(se(),$=m.length;$<h.length;$+=1)A($);ae()}},i(C){if(!d){for(let S=0;S<m.length;S+=1)b(h[S]);d=!0}},o(C){h=h.filter(Boolean);for(let S=0;S<h.length;S+=1)y(h[S]);d=!1},d(C){C&&v(e),L&&L.d(),de(h,C),g=!1,ye(j)}}}function Ha(n){let e,r;return e=new qe({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ka(n){let e,r,t,o,l,i,a,s;r=new Ge({props:{except:"links"}}),o=new ve({props:{data:ge(n[1].links),generateId:!0,$$slots:{default:[Ha]},$$scope:{ctx:n}}});function c(f){n[7](f)}let u={};return n[1].links[n[0]]!==void 0&&(u.f=n[1].links[n[0]]),i=new qa({props:u}),ue.push(()=>me(i,"f",c)),{c(){e=k("div"),B(r.$$.fragment),t=M(),B(o.$$.fragment),l=M(),B(i.$$.fragment),I(e,"slot","map")},m(f,p){w(f,e,p),T(r,e,null),_(e,t),T(o,e,null),_(e,l),T(i,e,null),s=!0},p(f,p){const d={};p&2&&(d.data=ge(f[1].links)),p&65537&&(d.$$scope={dirty:p,ctx:f}),o.$set(d);const g={};!a&&p&3&&(a=!0,g.f=f[1].links[f[0]],_e(()=>a=!1)),i.$set(g)},i(f){s||(b(r.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),y(o.$$.fragment,f),y(i.$$.fragment,f),s=!1},d(f){f&&v(e),E(r),E(o),E(i)}}}function Cr(n){let e,r;return e=new At({props:{$$slots:{default:[Wa]},$$scope:{ctx:n}}}),e.$on("close",n[12]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&65540&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Wa(n){let e,r=n[2].description+"",t,o,l,i;return l=new yt({props:{metric:n[2]}}),{c(){e=k("p"),t=N(r),o=M(),B(l.$$.fragment)},m(a,s){w(a,e,s),_(e,t),w(a,o,s),T(l,a,s),i=!0},p(a,s){(!i||s&4)&&r!==(r=a[2].description+"")&&re(t,r);const c={};s&4&&(c.metric=a[2]),l.$set(c)},i(a){i||(b(l.$$.fragment,a),i=!0)},o(a){y(l.$$.fragment,a),i=!1},d(a){a&&(v(e),v(o)),E(l,a)}}}function Za(n){let e,r,t,o,l,i;e=new Pe({props:{$$slots:{map:[Ka],sidebar:[Qa]},$$scope:{ctx:n}}});let a=n[2]&&Cr(n);return{c(){B(e.$$.fragment),r=M(),a&&a.c(),t=Ce()},m(s,c){T(e,s,c),w(s,r,c),a&&a.m(s,c),w(s,t,c),o=!0,l||(i=q(Ra,"keydown",n[5]),l=!0)},p(s,[c]){const u={};c&65567&&(u.$$scope={dirty:c,ctx:s}),e.$set(u),s[2]?a?(a.p(s,c),c&4&&b(a,1)):(a=Cr(s),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(se(),y(a,1,1,()=>{a=null}),ae())},i(s){o||(b(e.$$.fragment,s),b(a),o=!0)},o(s){y(e.$$.fragment,s),y(a),o=!1},d(s){s&&(v(r),v(t)),E(e,s),a&&a.d(s),l=!1,i()}}}function Xa(n,e,r){let t,o,l;te(n,W,L=>r(1,o=L)),te(n,Y,L=>r(4,l=L));let{idx:i}=e,a=null;function s(L){L.key=="Escape"&&t&&x(Y,l={kind:"neutral"},l)}async function c(){window.confirm("Really delete this link?")&&(x(Y,l={kind:"neutral"},l),await st(),o.links.splice(i,1),W.set(o))}function u(L){n.$$.not_equal(o.links[i],L)&&(o.links[i]=L,W.set(o))}const f=()=>x(Y,l={kind:"neutral"},l);function p(){o.links[i].properties.name=this.value,W.set(o)}const d=L=>r(2,a=Ve[L.name]);function g(L,m){n.$$.not_equal(o.links[i].properties.answers[m],L)&&(o.links[i].properties.answers[m]=L,W.set(o))}const j=()=>r(2,a=null);return n.$$set=L=>{"idx"in L&&r(0,i=L.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(3,t=o.links[i].geometry.coordinates.length>=2)},[i,o,a,t,l,s,c,u,f,p,d,g,j]}class Va extends le{constructor(e){super(),ie(this,e,Xa,Za,oe,{idx:0})}}function jr(n,e,r){const t=n.slice();return t[7]=e[r],t[8]=e,t[9]=r,t}function Ya(n){let e;return{c(){e=k("p"),e.textContent=`${n[3].description}`},m(r,t){w(r,e,t)},p:ee,d(r){r&&v(e)}}}function Sr(n){let e,r,t=n[7].properties.name+"",o,l,i,a,s,c;function u(p){n[6](p,n[7])}let f={k:"horiz-radio",choices:Se[n[0]].choices};return n[7].properties.answers[n[0]]!==void 0&&(f.value=n[7].properties.answers[n[0]]),i=new Fe({props:f}),ue.push(()=>me(i,"value",u)),{c(){e=k("li"),r=k("span"),o=N(t),l=M(),B(i.$$.fragment),s=M(),X(r,"color",n[7].properties.color)},m(p,d){w(p,e,d),_(e,r),_(r,o),_(e,l),T(i,e,null),_(e,s),c=!0},p(p,d){n=p,(!c||d&4)&&t!==(t=n[7].properties.name+"")&&re(o,t),d&4&&X(r,"color",n[7].properties.color);const g={};d&1&&(g.choices=Se[n[0]].choices),!a&&d&5&&(a=!0,g.value=n[7].properties.answers[n[0]],_e(()=>a=!1)),i.$set(g)},i(p){c||(b(i.$$.fragment,p),c=!0)},o(p){y(i.$$.fragment,p),c=!1},d(p){p&&v(e),E(i)}}}function xa(n){let e,r;return e=new yt({props:{metric:n[3]}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ec(n){let e,r,t,o,l=Se[n[0]].name+"",i,a,s=Se[n[0]].description+"",c,u,f,p,d,g,j,L,m=n[3]&&Ya(n),h=V(n[2].links),A=[];for(let $=0;$<h.length;$+=1)A[$]=Sr(jr(n,h,$));const C=$=>y(A[$],1,1,()=>{A[$]=null});let S=n[3]&&xa(n);return{c(){e=k("div"),r=k("button"),r.textContent="Done",t=M(),o=k("h2"),i=N(l),a=N(": "),c=N(s),u=M(),m&&m.c(),f=M(),p=k("ol");for(let $=0;$<A.length;$+=1)A[$].c();d=M(),S&&S.c(),I(e,"slot","sidebar")},m($,z){w($,e,z),_(e,r),_(e,t),_(e,o),_(o,i),_(o,a),_(o,c),_(e,u),m&&m.m(e,null),_(e,f),_(e,p);for(let D=0;D<A.length;D+=1)A[D]&&A[D].m(p,null);_(e,d),S&&S.m(e,null),g=!0,j||(L=q(r,"click",n[5]),j=!0)},p($,z){if((!g||z&1)&&l!==(l=Se[$[0]].name+"")&&re(i,l),(!g||z&1)&&s!==(s=Se[$[0]].description+"")&&re(c,s),$[3]&&m.p($,z),z&5){h=V($[2].links);let D;for(D=0;D<h.length;D+=1){const G=jr($,h,D);A[D]?(A[D].p(G,z),b(A[D],1)):(A[D]=Sr(G),A[D].c(),b(A[D],1),A[D].m(p,null))}for(se(),D=h.length;D<A.length;D+=1)C(D);ae()}$[3]&&S.p($,z)},i($){if(!g){for(let z=0;z<h.length;z+=1)b(A[z]);b(S),g=!0}},o($){A=A.filter(Boolean);for(let z=0;z<A.length;z+=1)y(A[z]);y(S),g=!1},d($){$&&v(e),m&&m.d(),de(A,$),S&&S.d(),j=!1,L()}}}function tc(n){let e,r,t;return r=new Ge({props:{showColor:"links",except:"",showMissingProperty:["at",n[0],["get","answers"]]}}),{c(){e=k("div"),B(r.$$.fragment),I(e,"slot","map")},m(o,l){w(o,e,l),T(r,e,null),t=!0},p(o,l){const i={};l&1&&(i.showMissingProperty=["at",o[0],["get","answers"]]),r.$set(i)},i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&v(e),E(r)}}}function nc(n){let e,r,t,o;return e=new Pe({props:{$$slots:{map:[tc],sidebar:[ec]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(l,i){T(e,l,i),r=!0,t||(o=q(window,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){y(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function rc(n,e,r){let t,o;te(n,Y,u=>r(1,t=u)),te(n,W,u=>r(2,o=u));let{qIdx:l}=e,i=Ve[Se[l].name];function a(u){u.key=="Escape"&&x(Y,t={kind:"neutral"},t)}const s=()=>x(Y,t={kind:"neutral"},t);function c(u,f){n.$$.not_equal(f.properties.answers[l],u)&&(f.properties.answers[l]=u,W.set(o))}return n.$$set=u=>{"qIdx"in u&&r(0,l=u.qIdx)},[l,t,o,i,a,s,c]}class oc extends le{constructor(e){super(),ie(this,e,rc,nc,oe,{qIdx:0})}}function lc(n){let e,r,t,o;const l=n[2].default,i=Be(l,n,n[1],null);return{c(){e=k("a"),i&&i.c(),I(e,"href","#"),X(e,"color",n[0])},m(a,s){w(a,e,s),i&&i.m(e,null),r=!0,t||(o=q(e,"click",Ko(n[3])),t=!0)},p(a,[s]){i&&i.p&&(!r||s&2)&&Te(i,l,a,a[1],r?Oe(l,a[1],s,null):Ee(a[1]),null),s&1&&X(e,"color",a[0])},i(a){r||(b(i,a),r=!0)},o(a){y(i,a),r=!1},d(a){a&&v(e),i&&i.d(a),t=!1,o()}}}function ic(n,e,r){let{$$slots:t={},$$scope:o}=e,{color:l=void 0}=e;function i(a){Ae.call(this,n,a)}return n.$$set=a=>{"color"in a&&r(0,l=a.color),"$$scope"in a&&r(1,o=a.$$scope)},[l,o,t,i]}class xe extends le{constructor(e){super(),ie(this,e,ic,lc,oe,{color:0})}}function Lr(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function sc(n){let e;return{c(){e=N(`ST20
  `)},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function ac(n){let e=n[5].properties.name+"",r;return{c(){r=N(e)},m(t,o){w(t,r,o)},p(t,o){o&2&&e!==(e=t[5].properties.name+"")&&re(r,e)},d(t){t&&v(r)}}}function zr(n){let e,r,t,o;function l(){return n[4](n[7])}return r=new xe({props:{color:n[5].properties.color,$$slots:{default:[ac]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),B(r.$$.fragment),t=M()},m(i,a){w(i,e,a),T(r,e,null),_(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[5].properties.color),a&258&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){y(r.$$.fragment,i),o=!1},d(i){i&&v(e),E(r)}}}function cc(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g,j;i=new xe({props:{$$slots:{default:[sc]},$$scope:{ctx:n}}}),i.$on("click",n[3]);let L=V(n[1].bus_stops),m=[];for(let A=0;A<L.length;A+=1)m[A]=zr(Lr(n,L,A));const h=A=>y(m[A],1,1,()=>{m[A]=null});return{c(){e=N(`Bus stops:

`),r=k("div"),t=k("button"),t.textContent="New bus stop",o=M(),l=k("div"),B(i.$$.fragment),a=N(`:
  `),s=k("progress"),f=M(),p=k("ol");for(let A=0;A<m.length;A+=1)m[A].c();s.value=c=n[1].bus_stops.filter(Mr).length,I(s,"max",u=n[1].bus_stops.length),I(s,"class","svelte-zadug4")},m(A,C){w(A,e,C),w(A,r,C),_(r,t),w(A,o,C),w(A,l,C),T(i,l,null),_(l,a),_(l,s),w(A,f,C),w(A,p,C);for(let S=0;S<m.length;S+=1)m[S]&&m[S].m(p,null);d=!0,g||(j=q(t,"click",n[2]),g=!0)},p(A,[C]){const S={};if(C&256&&(S.$$scope={dirty:C,ctx:A}),i.$set(S),(!d||C&2&&c!==(c=A[1].bus_stops.filter(Mr).length))&&(s.value=c),(!d||C&2&&u!==(u=A[1].bus_stops.length))&&I(s,"max",u),C&3){L=V(A[1].bus_stops);let $;for($=0;$<L.length;$+=1){const z=Lr(A,L,$);m[$]?(m[$].p(z,C),b(m[$],1)):(m[$]=zr(z),m[$].c(),b(m[$],1),m[$].m(p,null))}for(se(),$=L.length;$<m.length;$+=1)h($);ae()}},i(A){if(!d){b(i.$$.fragment,A);for(let C=0;C<L.length;C+=1)b(m[C]);d=!0}},o(A){y(i.$$.fragment,A),m=m.filter(Boolean);for(let C=0;C<m.length;C+=1)y(m[C]);d=!1},d(A){A&&(v(e),v(r),v(o),v(l),v(f),v(p)),E(i),de(m,A),g=!1,j()}}}const Mr=n=>n.properties.st20!="";function uc(n,e,r){let t,o;return te(n,Y,s=>r(0,t=s)),te(n,W,s=>r(1,o=s)),[t,o,()=>x(Y,t={kind:"new-point",obj:"bus stop"},t),()=>x(Y,t={kind:"bus-stop-questions"},t),s=>x(Y,t={kind:"edit-bus-stop",idx:s},t)]}let fc=class extends le{constructor(e){super(),ie(this,e,uc,cc,oe,{})}};function Br(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function pc(n){let e;return{c(){e=N(`SA10
  `)},m(r,t){w(r,e,t)},d(r){r&&v(e)}}}function dc(n){let e=n[5].properties.name+"",r;return{c(){r=N(e)},m(t,o){w(t,r,o)},p(t,o){o&2&&e!==(e=t[5].properties.name+"")&&re(r,e)},d(t){t&&v(r)}}}function Tr(n){let e,r,t,o;function l(){return n[4](n[7])}return r=new xe({props:{color:n[5].properties.color,$$slots:{default:[dc]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),B(r.$$.fragment),t=M()},m(i,a){w(i,e,a),T(r,e,null),_(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[5].properties.color),a&258&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){y(r.$$.fragment,i),o=!1},d(i){i&&v(e),E(r)}}}function mc(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g,j;i=new xe({props:{$$slots:{default:[pc]},$$scope:{ctx:n}}}),i.$on("click",n[3]);let L=V(n[1].crossings),m=[];for(let A=0;A<L.length;A+=1)m[A]=Tr(Br(n,L,A));const h=A=>y(m[A],1,1,()=>{m[A]=null});return{c(){e=N(`Crossings:

`),r=k("div"),t=k("button"),t.textContent="New crossing",o=M(),l=k("div"),B(i.$$.fragment),a=N(`:
  `),s=k("progress"),f=M(),p=k("ol");for(let A=0;A<m.length;A+=1)m[A].c();s.value=c=n[1].crossings.filter(Er).length,I(s,"max",u=n[1].crossings.length)},m(A,C){w(A,e,C),w(A,r,C),_(r,t),w(A,o,C),w(A,l,C),T(i,l,null),_(l,a),_(l,s),w(A,f,C),w(A,p,C);for(let S=0;S<m.length;S+=1)m[S]&&m[S].m(p,null);d=!0,g||(j=q(t,"click",n[2]),g=!0)},p(A,[C]){const S={};if(C&256&&(S.$$scope={dirty:C,ctx:A}),i.$set(S),(!d||C&2&&c!==(c=A[1].crossings.filter(Er).length))&&(s.value=c),(!d||C&2&&u!==(u=A[1].crossings.length))&&I(s,"max",u),C&3){L=V(A[1].crossings);let $;for($=0;$<L.length;$+=1){const z=Br(A,L,$);m[$]?(m[$].p(z,C),b(m[$],1)):(m[$]=Tr(z),m[$].c(),b(m[$],1),m[$].m(p,null))}for(se(),$=L.length;$<m.length;$+=1)h($);ae()}},i(A){if(!d){b(i.$$.fragment,A);for(let C=0;C<L.length;C+=1)b(m[C]);d=!0}},o(A){y(i.$$.fragment,A),m=m.filter(Boolean);for(let C=0;C<m.length;C+=1)y(m[C]);d=!1},d(A){A&&(v(e),v(r),v(o),v(l),v(f),v(p)),E(i),de(m,A),g=!1,j()}}}const Er=n=>n.properties.sa10!="";function _c(n,e,r){let t,o;return te(n,Y,s=>r(0,t=s)),te(n,W,s=>r(1,o=s)),[t,o,()=>x(Y,t={kind:"new-point",obj:"crossing"},t),()=>x(Y,t={kind:"crossing-questions"},t),s=>x(Y,t={kind:"edit-crossing",idx:s},t)]}let gc=class extends le{constructor(e){super(),ie(this,e,_c,mc,oe,{})}};const hc=(n,e)=>(n=n.replace(new RegExp("((?<![\\p{Uppercase_Letter}\\d])[\\p{Uppercase_Letter}\\d](?![\\p{Uppercase_Letter}\\d]))","gu"),r=>r.toLowerCase()),n.replace(/(\p{Uppercase_Letter}+)(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,(r,t,o)=>t+e+o.toLowerCase()));function bc(n,{separator:e="_",preserveConsecutiveUppercase:r=!1}={}){if(!(typeof n=="string"&&typeof e=="string"))throw new TypeError("The `text` and `separator` arguments should be of type `string`");if(n.length<2)return r?n:n.toLowerCase();const t=`$1${e}$2`,o=n.replace(/([\p{Lowercase_Letter}\d])(\p{Uppercase_Letter})/gu,t);return r?hc(o,e):o.replace(/(\p{Uppercase_Letter})(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,t).toLowerCase()}function Or(n){if(typeof n!="string")throw new TypeError("Expected a string");return n=bc(n),n=n.toLowerCase().replace(/[_-]+/g," ").replace(/\s{2,}/g," ").trim(),n=n.charAt(0).toUpperCase()+n.slice(1),n}function $c(n){const e=n-1;return e*e*e+1}function Dr(n,{delay:e=0,duration:r=400,easing:t=$c,axis:o="y"}={}){const l=getComputedStyle(n),i=+l.opacity,a=o==="y"?"height":"width",s=parseFloat(l[a]),c=o==="y"?["top","bottom"]:["left","right"],u=c.map(m=>`${m[0].toUpperCase()}${m.slice(1)}`),f=parseFloat(l[`padding${u[0]}`]),p=parseFloat(l[`padding${u[1]}`]),d=parseFloat(l[`margin${u[0]}`]),g=parseFloat(l[`margin${u[1]}`]),j=parseFloat(l[`border${u[0]}Width`]),L=parseFloat(l[`border${u[1]}Width`]);return{delay:e,duration:r,easing:t,css:m=>`overflow: hidden;opacity: ${Math.min(m*20,1)*i};${a}: ${m*s}px;padding-${c[0]}: ${m*f}px;padding-${c[1]}: ${m*p}px;margin-${c[0]}: ${m*d}px;margin-${c[1]}: ${m*g}px;border-${c[0]}-width: ${m*j}px;border-${c[1]}-width: ${m*L}px;`}}function vo(n){return"members"in n}function yo(n){return"oneOf"in n}function Ao(n){return typeof n=="string"}function Co(n){return typeof n=="object"&&"value"in n}function kc(n){return"type"in n&&n.type=="number"}function jo(n){return"type"in n&&n.type=="one-liner"}function So(n){return"type"in n&&n.type=="textbox"}function Lo(n){return"type"in n&&n.type=="checkbox"}function Nr(n,e,r){const t=n.slice();return t[15]=e[r],t[18]=e,t[19]=r,t}function Ir(n,e,r){const t=n.slice();return t[15]=e[r],t[16]=e,t[17]=r,t}function Fr(n){let e,r=n[1].description+"",t;return{c(){e=k("p"),t=N(r),I(e,"class","svelte-1b72l00")},m(o,l){w(o,e,l),_(e,t)},p(o,l){l&2&&r!==(r=o[1].description+"")&&re(t,r)},d(o){o&&v(e)}}}function wc(n){let e,r,t;return{c(){e=k("input"),I(e,"type","checkbox")},m(o,l){w(o,e,l),e.checked=n[0],r||(t=q(e,"change",n[14]),r=!0)},p(o,l){l&1&&(e.checked=o[0])},i:ee,o:ee,d(o){o&&v(e),r=!1,t()}}}function vc(n){let e,r,t;return{c(){e=k("textarea"),X(e,"width","100%"),I(e,"rows","5"),I(e,"class","svelte-1b72l00")},m(o,l){w(o,e,l),pe(e,n[0]),r||(t=q(e,"input",n[13]),r=!0)},p(o,l){l&1&&pe(e,o[0])},i:ee,o:ee,d(o){o&&v(e),r=!1,t()}}}function yc(n){let e,r,t;return{c(){e=k("input"),I(e,"type","text"),X(e,"width","100%")},m(o,l){w(o,e,l),pe(e,n[0]),r||(t=q(e,"input",n[12]),r=!0)},p(o,l){l&1&&e.value!==o[0]&&pe(e,o[0])},i:ee,o:ee,d(o){o&&v(e),r=!1,t()}}}function Ac(n){let e,r,t;return{c(){e=k("input"),I(e,"type","number")},m(o,l){w(o,e,l),pe(e,n[0]),r||(t=q(e,"input",n[11]),r=!0)},p(o,l){l&1&&so(e.value)!==o[0]&&pe(e,o[0])},i:ee,o:ee,d(o){o&&v(e),r=!1,t()}}}function Cc(n){let e,r,t=V(n[1].oneOf),o=[];for(let i=0;i<t.length;i+=1)o[i]=Ur(Nr(n,t,i));const l=i=>y(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=Ce()},m(i,a){for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(i,a);w(i,e,a),r=!0},p(i,a){if(a&31){t=V(i[1].oneOf);let s;for(s=0;s<t.length;s+=1){const c=Nr(i,t,s);o[s]?(o[s].p(c,a),b(o[s],1)):(o[s]=Ur(c),o[s].c(),b(o[s],1),o[s].m(e.parentNode,e))}for(se(),s=t.length;s<o.length;s+=1)l(s);ae()}},i(i){if(!r){for(let a=0;a<t.length;a+=1)b(o[a]);r=!0}},o(i){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)y(o[a]);r=!1},d(i){i&&v(e),de(o,i)}}}function jc(n){let e,r,t=V(n[1].members),o=[];for(let i=0;i<t.length;i+=1)o[i]=qr(Ir(n,t,i));const l=i=>y(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=Ce()},m(i,a){for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(i,a);w(i,e,a),r=!0},p(i,a){if(a&3){t=V(i[1].members);let s;for(s=0;s<t.length;s+=1){const c=Ir(i,t,s);o[s]?(o[s].p(c,a),b(o[s],1)):(o[s]=qr(c),o[s].c(),b(o[s],1),o[s].m(e.parentNode,e))}for(se(),s=t.length;s<o.length;s+=1)l(s);ae()}},i(i){if(!r){for(let a=0;a<t.length;a+=1)b(o[a]);r=!0}},o(i){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)y(o[a]);r=!1},d(i){i&&v(e),de(o,i)}}}function Sc(n){let e,r,t,o=!1,l,i=n[15].name+"",a,s,c,u,f,p,d,g,j,L=n[2]==n[15].name&&typeof n[0]=="object"&&Pr(n);return d=it(n[7][0]),{c(){e=k("label"),r=k("input"),l=M(),a=N(i),s=M(),c=k("br"),u=M(),L&&L.c(),f=Ce(),I(r,"type","radio"),r.__value=t=n[15].name,pe(r,r.__value),d.p(r)},m(m,h){w(m,e,h),_(e,r),r.checked=r.__value===n[2],_(e,l),_(e,a),_(e,s),_(e,c),w(m,u,h),L&&L.m(m,h),w(m,f,h),p=!0,g||(j=[q(r,"change",n[9]),q(r,"change",n[4])],g=!0)},p(m,h){(!p||h&2&&t!==(t=m[15].name))&&(r.__value=t,pe(r,r.__value),o=!0),(o||h&6)&&(r.checked=r.__value===m[2]),(!p||h&2)&&i!==(i=m[15].name+"")&&re(a,i),m[2]==m[15].name&&typeof m[0]=="object"?L?(L.p(m,h),h&7&&b(L,1)):(L=Pr(m),L.c(),b(L,1),L.m(f.parentNode,f)):L&&(se(),y(L,1,1,()=>{L=null}),ae())},i(m){p||(b(L),p=!0)},o(m){y(L),p=!1},d(m){m&&(v(e),v(u),v(f)),L&&L.d(m),d.r(),g=!1,ye(j)}}}function Lc(n){let e,r,t,o=!1,l,i=n[15].value+"",a,s,c,u,f,p;function d(L,m){return L[15].description?Bc:Mc}let g=d(n),j=g(n);return u=it(n[7][0]),{c(){e=k("label"),r=k("input"),l=M(),a=N(i),s=M(),j.c(),c=M(),I(r,"type","radio"),r.__value=t=n[15].value,pe(r,r.__value),u.p(r)},m(L,m){w(L,e,m),_(e,r),r.checked=r.__value===n[2],_(e,l),_(e,a),_(e,s),j.m(e,null),_(e,c),f||(p=[q(r,"change",n[8]),q(r,"change",n[3])],f=!0)},p(L,m){m&2&&t!==(t=L[15].value)&&(r.__value=t,pe(r,r.__value),o=!0),(o||m&6)&&(r.checked=r.__value===L[2]),m&2&&i!==(i=L[15].value+"")&&re(a,i),g===(g=d(L))&&j?j.p(L,m):(j.d(1),j=g(L),j&&(j.c(),j.m(e,c)))},i:ee,o:ee,d(L){L&&v(e),j.d(),u.r(),f=!1,ye(p)}}}function zc(n){let e,r,t,o=!1,l,i=n[15]+"",a,s,c,u,f,p,d;return f=it(n[7][0]),{c(){e=k("label"),r=k("input"),l=M(),a=N(i),s=M(),c=k("br"),u=M(),I(r,"type","radio"),r.__value=t=n[15],pe(r,r.__value),f.p(r)},m(g,j){w(g,e,j),_(e,r),r.checked=r.__value===n[2],_(e,l),_(e,a),_(e,s),_(e,c),_(e,u),p||(d=[q(r,"change",n[6]),q(r,"change",n[3])],p=!0)},p(g,j){j&2&&t!==(t=g[15])&&(r.__value=t,pe(r,r.__value),o=!0),(o||j&6)&&(r.checked=r.__value===g[2]),j&2&&i!==(i=g[15]+"")&&re(a,i)},i:ee,o:ee,d(g){g&&v(e),f.r(),p=!1,ye(d)}}}function Pr(n){let e,r,t,o,l,i;function a(c){n[10](c,n[15])}let s={spec:n[15]};return n[0][n[15].name]!==void 0&&(s.value=n[0][n[15].name]),r=new nn({props:s}),ue.push(()=>me(r,"value",a)),{c(){e=k("div"),B(r.$$.fragment),o=M(),I(e,"class","svelte-1b72l00")},m(c,u){w(c,e,u),T(r,e,null),_(e,o),i=!0},p(c,u){n=c;const f={};u&2&&(f.spec=n[15]),!t&&u&3&&(t=!0,f.value=n[0][n[15].name],_e(()=>t=!1)),r.$set(f)},i(c){i||(b(r.$$.fragment,c),c&&io(()=>{i&&(l||(l=an(e,Dr,{duration:500},!0)),l.run(1))}),i=!0)},o(c){y(r.$$.fragment,c),c&&(l||(l=an(e,Dr,{duration:500},!1)),l.run(0)),i=!1},d(c){c&&v(e),E(r),c&&l&&l.end()}}}function Mc(n){let e;return{c(){e=k("br")},m(r,t){w(r,e,t)},p:ee,d(r){r&&v(e)}}}function Bc(n){let e,r,t=n[15].description+"",o,l;return{c(){e=k("p"),r=N("("),o=N(t),l=N(")"),I(e,"class","svelte-1b72l00")},m(i,a){w(i,e,a),_(e,r),_(e,o),_(e,l)},p(i,a){a&2&&t!==(t=i[15].description+"")&&re(o,t)},d(i){i&&v(e)}}}function Ur(n){let e,r,t,o,l,i;const a=[zc,Lc,Sc],s=[];function c(u,f){return f&2&&(e=null),f&2&&(r=null),e==null&&(e=!!Ao(u[15])),e?0:(r==null&&(r=!!Co(u[15])),r?1:2)}return t=c(n,-1),o=s[t]=a[t](n),{c(){o.c(),l=Ce()},m(u,f){s[t].m(u,f),w(u,l,f),i=!0},p(u,f){let p=t;t=c(u,f),t===p?s[t].p(u,f):(se(),y(s[p],1,1,()=>{s[p]=null}),ae(),o=s[t],o?o.p(u,f):(o=s[t]=a[t](u),o.c()),b(o,1),o.m(l.parentNode,l))},i(u){i||(b(o),i=!0)},o(u){y(o),i=!1},d(u){u&&v(l),s[t].d(u)}}}function qr(n){let e,r,t=Or(n[15].name)+"",o,l,i,a,s,c;function u(p){n[5](p,n[15])}let f={spec:n[15]};return n[0][n[15].name]!==void 0&&(f.value=n[0][n[15].name]),i=new nn({props:f}),ue.push(()=>me(i,"value",u)),{c(){e=k("div"),r=k("h3"),o=N(t),l=M(),B(i.$$.fragment),s=M(),I(e,"class","svelte-1b72l00")},m(p,d){w(p,e,d),_(e,r),_(r,o),_(e,l),T(i,e,null),_(e,s),c=!0},p(p,d){n=p,(!c||d&2)&&t!==(t=Or(n[15].name)+"")&&re(o,t);const g={};d&2&&(g.spec=n[15]),!a&&d&3&&(a=!0,g.value=n[0][n[15].name],_e(()=>a=!1)),i.$set(g)},i(p){c||(b(i.$$.fragment,p),c=!0)},o(p){y(i.$$.fragment,p),c=!1},d(p){p&&v(e),E(i)}}}function Tc(n){let e,r,t,o,l,i,a,s,c,u,f,p=n[1].description&&Fr(n);const d=[jc,Cc,Ac,yc,vc,wc],g=[];function j(L,m){return m&2&&(r=null),m&2&&(t=null),m&2&&(o=null),m&2&&(l=null),m&2&&(i=null),m&2&&(a=null),r==null&&(r=!!vo(L[1])),r?0:(t==null&&(t=!!yo(L[1])),t?1:(o==null&&(o=!!kc(L[1])),o?2:(l==null&&(l=!!jo(L[1])),l?3:(i==null&&(i=!!So(L[1])),i?4:(a==null&&(a=!!Lo(L[1])),a?5:-1)))))}return~(s=j(n,-1))&&(c=g[s]=d[s](n)),{c(){p&&p.c(),e=M(),c&&c.c(),u=Ce()},m(L,m){p&&p.m(L,m),w(L,e,m),~s&&g[s].m(L,m),w(L,u,m),f=!0},p(L,[m]){L[1].description?p?p.p(L,m):(p=Fr(L),p.c(),p.m(e.parentNode,e)):p&&(p.d(1),p=null);let h=s;s=j(L,m),s===h?~s&&g[s].p(L,m):(c&&(se(),y(g[h],1,1,()=>{g[h]=null}),ae()),~s?(c=g[s],c?c.p(L,m):(c=g[s]=d[s](L),c.c()),b(c,1),c.m(u.parentNode,u)):c=null)},i(L){f||(b(c),f=!0)},o(L){y(c),f=!1},d(L){L&&(v(e),v(u)),p&&p.d(L),~s&&g[s].d(L)}}}function Ec(n,e,r){var h,A,C;let{spec:t}=e,{value:o}=e,l="";if(vo(t)){o||(o={});for(let S of t.members)jo(S)||So(S)?o[h=S.name]||(o[h]=""):Lo(S)?o[A=S.name]||(o[A]=!1):o[C=S.name]||(o[C]={})}else yo(t)&&(o||(o={}),Ao(o)?l=o:Co(o)?l=o.value:l=Object.keys(o)[0]||"");function i(){r(0,o=l)}function a(){r(0,o={}),r(0,o[l]={},o)}const s=[[]];function c(S,$){n.$$.not_equal(o[$.name],S)&&(o[$.name]=S,r(0,o))}function u(){l=this.__value,r(2,l)}function f(){l=this.__value,r(2,l)}function p(){l=this.__value,r(2,l)}function d(S,$){n.$$.not_equal(o[$.name],S)&&(o[$.name]=S,r(0,o))}function g(){o=so(this.value),r(0,o)}function j(){o=this.value,r(0,o)}function L(){o=this.value,r(0,o)}function m(){o=this.checked,r(0,o)}return n.$$set=S=>{"spec"in S&&r(1,t=S.spec),"value"in S&&r(0,o=S.value)},[o,t,l,i,a,c,u,s,f,p,d,g,j,L,m]}class nn extends le{constructor(e){super(),ie(this,e,Ec,Tc,oe,{spec:1,value:0})}}const Oc="Intervention",Dc=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Nc={name:Oc,oneOf:Dc};function Ic(n){let e,r,t;function o(i){n[2](i)}let l={spec:n[1]};return n[0]!==void 0&&(l.value=n[0]),e=new nn({props:l}),ue.push(()=>me(e,"value",o)),{c(){B(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,[a]){const s={};!r&&a&1&&(r=!0,s.value=i[0],_e(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Fc(n,e,r){let{props:t}=e,o=Nc;function l(i){t=i,r(0,t)}return n.$$set=i=>{"props"in i&&r(0,t=i.props)},[t,o,l]}class Pc extends le{constructor(e){super(),ie(this,e,Fc,Ic,oe,{props:0})}}function Uc(n){let e,r,t,o,l,i;function a(c){n[1](c)}let s={};return n[0]!==void 0&&(s.props=n[0]),e=new Pc({props:s}),ue.push(()=>me(e,"props",a)),{c(){B(e.$$.fragment),t=M(),o=k("textarea"),o.disabled=!0,o.value=l=JSON.stringify(n[0],null,"  ")},m(c,u){T(e,c,u),w(c,t,u),w(c,o,u),i=!0},p(c,u){const f={};!r&&u&1&&(r=!0,f.props=c[0],_e(()=>r=!1)),e.$set(f),(!i||u&1&&l!==(l=JSON.stringify(c[0],null,"  ")))&&(o.value=l)},i(c){i||(b(e.$$.fragment,c),i=!0)},o(c){y(e.$$.fragment,c),i=!1},d(c){c&&(v(t),v(o)),E(e,c)}}}function qc(n){let e,r;return e=new At({props:{$$slots:{default:[Uc]},$$scope:{ctx:n}}}),e.$on("close",n[2]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,[o]){const l={};o&9&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Rc(n,e,r){let t={};function o(i){t=i,r(0,t)}function l(i){Ae.call(this,n,i)}return[t,o,l]}class Gc extends le{constructor(e){super(),ie(this,e,Rc,qc,oe,{})}}function Rr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Jc(n){let e=n[4].properties.name+"",r;return{c(){r=N(e)},m(t,o){w(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&re(r,e)},d(t){t&&v(r)}}}function Gr(n){let e,r,t,o;function l(){return n[3](n[6])}return r=new xe({props:{color:n[4].properties.color,$$slots:{default:[Jc]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),B(r.$$.fragment),t=M()},m(i,a){w(i,e,a),T(r,e,null),_(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[4].properties.color),a&130&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){y(r.$$.fragment,i),o=!1},d(i){i&&v(e),E(r)}}}function Qc(n){let e,r,t,o,l,i,a,s,c=V(n[1].jats),u=[];for(let p=0;p<c.length;p+=1)u[p]=Gr(Rr(n,c,p));const f=p=>y(u[p],1,1,()=>{u[p]=null});return{c(){e=N(`JATs:

`),r=k("div"),t=k("button"),t.textContent="New JAT",o=M(),l=k("ol");for(let p=0;p<u.length;p+=1)u[p].c()},m(p,d){w(p,e,d),w(p,r,d),_(r,t),w(p,o,d),w(p,l,d);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(l,null);i=!0,a||(s=q(t,"click",n[2]),a=!0)},p(p,[d]){if(d&3){c=V(p[1].jats);let g;for(g=0;g<c.length;g+=1){const j=Rr(p,c,g);u[g]?(u[g].p(j,d),b(u[g],1)):(u[g]=Gr(j),u[g].c(),b(u[g],1),u[g].m(l,null))}for(se(),g=c.length;g<u.length;g+=1)f(g);ae()}},i(p){if(!i){for(let d=0;d<c.length;d+=1)b(u[d]);i=!0}},o(p){u=u.filter(Boolean);for(let d=0;d<u.length;d+=1)y(u[d]);i=!1},d(p){p&&(v(e),v(r),v(o),v(l)),de(u,p),a=!1,s()}}}function Hc(n,e,r){let t,o;return te(n,Y,a=>r(0,t=a)),te(n,W,a=>r(1,o=a)),[t,o,()=>x(Y,t={kind:"new-point",obj:"jat"},t),a=>x(Y,t={kind:"edit-jat",idx:a},t)]}let Kc=class extends le{constructor(e){super(),ie(this,e,Hc,Qc,oe,{})}};function Jr(n,e,r){const t=n.slice();return t[2]=e[r],t[4]=r,t}function Qr(n,e,r){const t=n.slice();t[5]=e[r];const o=t[5].properties.answers[t[4]];return t[6]=o,t}function Hr(n,e,r){const t=n.slice();return t[5]=e[r],t}function Kr(n){let e,r=n[5].properties.name+"",t;return{c(){e=k("th"),t=N(r),X(e,"color",n[5].properties.color)},m(o,l){w(o,e,l),_(e,t)},p(o,l){l&1&&r!==(r=o[5].properties.name+"")&&re(t,r),l&1&&X(e,"color",o[5].properties.color)},d(o){o&&v(e)}}}function Wr(n){let e,r=n[6]+"",t;return{c(){e=k("td"),t=N(r),X(e,"background",n[6]==""?"red":"green")},m(o,l){w(o,e,l),_(e,t)},p(o,l){l&1&&r!==(r=o[6]+"")&&re(t,r),l&1&&X(e,"background",o[6]==""?"red":"green")},d(o){o&&v(e)}}}function Zr(n){let e,r,t,o,l=V(n[0].links),i=[];for(let a=0;a<l.length;a+=1)i[a]=Wr(Qr(n,l,a));return{c(){e=k("tr"),r=k("th"),r.textContent=`${n[2].name}`,t=M();for(let a=0;a<i.length;a+=1)i[a].c();o=M()},m(a,s){w(a,e,s),_(e,r),_(e,t);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);_(e,o)},p(a,s){if(s&1){l=V(a[0].links);let c;for(c=0;c<l.length;c+=1){const u=Qr(a,l,c);i[c]?i[c].p(u,s):(i[c]=Wr(u),i[c].c(),i[c].m(e,o))}for(;c<i.length;c+=1)i[c].d(1);i.length=l.length}},d(a){a&&v(e),de(i,a)}}}function Wc(n){let e,r,t,o,l,i,a,s=V(n[0].links),c=[];for(let p=0;p<s.length;p+=1)c[p]=Kr(Hr(n,s,p));let u=V(Se),f=[];for(let p=0;p<u.length;p+=1)f[p]=Zr(Jr(n,u,p));return{c(){e=k("table"),r=k("thead"),t=k("tr"),o=k("th"),l=M();for(let p=0;p<c.length;p+=1)c[p].c();i=M(),a=k("tbody");for(let p=0;p<f.length;p+=1)f[p].c()},m(p,d){w(p,e,d),_(e,r),_(r,t),_(t,o),_(t,l);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(t,null);_(e,i),_(e,a);for(let g=0;g<f.length;g+=1)f[g]&&f[g].m(a,null)},p(p,d){if(d&1){s=V(p[0].links);let g;for(g=0;g<s.length;g+=1){const j=Hr(p,s,g);c[g]?c[g].p(j,d):(c[g]=Kr(j),c[g].c(),c[g].m(t,null))}for(;g<c.length;g+=1)c[g].d(1);c.length=s.length}if(d&1){u=V(Se);let g;for(g=0;g<u.length;g+=1){const j=Jr(p,u,g);f[g]?f[g].p(j,d):(f[g]=Zr(j),f[g].c(),f[g].m(a,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=u.length}},d(p){p&&v(e),de(c,p),de(f,p)}}}function Zc(n){let e,r;return e=new At({props:{$$slots:{default:[Wc]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,[o]){const l={};o&2049&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Xc(n,e,r){let t;te(n,W,l=>r(0,t=l));function o(l){Ae.call(this,n,l)}return[t,o]}class Vc extends le{constructor(e){super(),ie(this,e,Xc,Zc,oe,{})}}function Xr(n,e,r){const t=n.slice();return t[9]=e[r],t[11]=r,t}function Vr(n,e,r){const t=n.slice();return t[12]=e[r],t[11]=r,t}function Yr(n){let e,r;return e=new Vc({}),e.$on("close",n[4]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Yc(n){let e=n[12].properties.name+"",r;return{c(){r=N(e)},m(t,o){w(t,r,o)},p(t,o){o&2&&e!==(e=t[12].properties.name+"")&&re(r,e)},d(t){t&&v(r)}}}function xr(n){let e,r,t,o;function l(){return n[6](n[11])}return r=new xe({props:{color:n[12].properties.color,$$slots:{default:[Yc]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),B(r.$$.fragment),t=M()},m(i,a){w(i,e,a),T(r,e,null),_(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[12].properties.color),a&16386&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){y(r.$$.fragment,i),o=!1},d(i){i&&v(e),E(r)}}}function xc(n){let e=n[9].name+"",r,t;return{c(){r=N(e),t=M()},m(o,l){w(o,r,l),w(o,t,l)},p:ee,d(o){o&&(v(r),v(t))}}}function eo(n){let e,r,t,o,l,i,a,s;function c(){return n[7](n[11])}r=new xe({props:{$$slots:{default:[xc]},$$scope:{ctx:n}}}),r.$on("click",c);function u(...f){return n[8](n[11],...f)}return{c(){e=k("li"),B(r.$$.fragment),t=N(`:
      `),o=k("progress"),a=M(),o.value=l=n[1].links.filter(u).length,I(o,"max",i=n[1].links.length),I(o,"class","svelte-zadug4")},m(f,p){w(f,e,p),T(r,e,null),_(e,t),_(e,o),_(e,a),s=!0},p(f,p){n=f;const d={};p&16384&&(d.$$scope={dirty:p,ctx:n}),r.$set(d),(!s||p&2&&l!==(l=n[1].links.filter(u).length))&&(o.value=l),(!s||p&2&&i!==(i=n[1].links.length))&&I(o,"max",i)},i(f){s||(b(r.$$.fragment,f),s=!0)},o(f){y(r.$$.fragment,f),s=!1},d(f){f&&v(e),E(r)}}}function eu(n){let e,r,t,o,l,i,a,s,c,u,f,p,d=n[0]&&Yr(n),g=V(n[1].links),j=[];for(let C=0;C<g.length;C+=1)j[C]=xr(Vr(n,g,C));const L=C=>y(j[C],1,1,()=>{j[C]=null});let m=V(Se),h=[];for(let C=0;C<m.length;C+=1)h[C]=eo(Xr(n,m,C));const A=C=>y(h[C],1,1,()=>{h[C]=null});return{c(){d&&d.c(),e=M(),r=k("div"),t=k("button"),t.textContent="New link",o=M(),l=k("button"),l.textContent="Table of questions",i=N(`

Links:
`),a=k("ol");for(let C=0;C<j.length;C+=1)j[C].c();s=N(`

Questions:
`),c=k("ol");for(let C=0;C<h.length;C+=1)h[C].c()},m(C,S){d&&d.m(C,S),w(C,e,S),w(C,r,S),_(r,t),_(r,o),_(r,l),w(C,i,S),w(C,a,S);for(let $=0;$<j.length;$+=1)j[$]&&j[$].m(a,null);w(C,s,S),w(C,c,S);for(let $=0;$<h.length;$+=1)h[$]&&h[$].m(c,null);u=!0,f||(p=[q(t,"click",n[3]),q(l,"click",n[5])],f=!0)},p(C,[S]){if(C[0]?d?(d.p(C,S),S&1&&b(d,1)):(d=Yr(C),d.c(),b(d,1),d.m(e.parentNode,e)):d&&(se(),y(d,1,1,()=>{d=null}),ae()),S&6){g=V(C[1].links);let $;for($=0;$<g.length;$+=1){const z=Vr(C,g,$);j[$]?(j[$].p(z,S),b(j[$],1)):(j[$]=xr(z),j[$].c(),b(j[$],1),j[$].m(a,null))}for(se(),$=g.length;$<j.length;$+=1)L($);ae()}if(S&6){m=V(Se);let $;for($=0;$<m.length;$+=1){const z=Xr(C,m,$);h[$]?(h[$].p(z,S),b(h[$],1)):(h[$]=eo(z),h[$].c(),b(h[$],1),h[$].m(c,null))}for(se(),$=m.length;$<h.length;$+=1)A($);ae()}},i(C){if(!u){b(d);for(let S=0;S<g.length;S+=1)b(j[S]);for(let S=0;S<m.length;S+=1)b(h[S]);u=!0}},o(C){y(d),j=j.filter(Boolean);for(let S=0;S<j.length;S+=1)y(j[S]);h=h.filter(Boolean);for(let S=0;S<h.length;S+=1)y(h[S]);u=!1},d(C){C&&(v(e),v(r),v(i),v(a),v(s),v(c)),d&&d.d(C),de(j,C),de(h,C),f=!1,ye(p)}}}function tu(n,e,r){let t,o;te(n,W,p=>r(1,t=p)),te(n,Y,p=>r(2,o=p));let l=!1;function i(){let p=bo(t.links.length);x(W,t.links=[...t.links,p],t),x(Y,o={kind:"edit-link",idx:t.links.length-1},o)}return[l,t,o,i,()=>r(0,l=!1),()=>r(0,l=!0),p=>x(Y,o={kind:"edit-link",idx:p},o),p=>x(Y,o={kind:"link-questions",idx:p},o),(p,d)=>d.properties.answers[p]!=""]}class nu extends le{constructor(e){super(),ie(this,e,tu,eu,oe,{})}}function ru(n){let e,r,t,o,l,i,a,s,c,u,f,p,d,g,j,L,m,h,A,C,S,$,z,D,G,P,Z,O,J,H;return j=new nu({}),A=new Kc({}),z=new fc({}),Z=new gc({}),{c(){e=k("div"),r=k("div"),t=k("button"),t.textContent="Load file",o=M(),l=k("button"),l.textContent="Download",i=M(),a=k("button"),a.textContent="Clear",s=M(),c=k("button"),c.textContent="Draw an entire route",u=M(),f=k("button"),f.textContent="Try new form",p=M(),d=k("hr"),g=M(),B(j.$$.fragment),L=M(),m=k("hr"),h=M(),B(A.$$.fragment),C=M(),S=k("hr"),$=M(),B(z.$$.fragment),D=M(),G=k("hr"),P=M(),B(Z.$$.fragment),I(t,"class","secondary"),I(l,"class","secondary"),I(a,"class","secondary"),I(e,"slot","sidebar")},m(U,F){w(U,e,F),_(e,r),_(r,t),_(r,o),_(r,l),_(r,i),_(r,a),_(e,s),_(e,c),_(e,u),_(e,f),_(e,p),_(e,d),_(e,g),T(j,e,null),_(e,L),_(e,m),_(e,h),T(A,e,null),_(e,C),_(e,S),_(e,$),T(z,e,null),_(e,D),_(e,G),_(e,P),T(Z,e,null),O=!0,J||(H=[q(t,"click",n[12]),q(l,"click",n[13]),q(a,"click",n[6]),q(c,"click",n[7]),q(f,"click",n[14])],J=!0)},p:ee,i(U){O||(b(j.$$.fragment,U),b(A.$$.fragment,U),b(z.$$.fragment,U),b(Z.$$.fragment,U),O=!0)},o(U){y(j.$$.fragment,U),y(A.$$.fragment,U),y(z.$$.fragment,U),y(Z.$$.fragment,U),O=!1},d(U){U&&v(e),E(j),E(A),E(z),E(Z),J=!1,ye(H)}}}function ou(n){let e,r;return e=new qe({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":Ft(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[8]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function lu(n){let e,r;return e=new Ze({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":Ft(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[9]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function iu(n){let e,r;return e=new Ye({props:{manageHoverState:!0,layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[10]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function su(n){let e,r;return e=new Ye({props:{manageHoverState:!0,layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[11]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function au(n){let e,r,t,o,l,i,a,s,c;return r=new ve({props:{data:ge(n[3].links),generateId:!0,$$slots:{default:[ou]},$$scope:{ctx:n}}}),o=new ve({props:{data:ge(n[3].jats),generateId:!0,$$slots:{default:[lu]},$$scope:{ctx:n}}}),i=new ve({props:{data:ge(n[3].bus_stops),generateId:!0,$$slots:{default:[iu]},$$scope:{ctx:n}}}),s=new ve({props:{data:ge(n[3].crossings),generateId:!0,$$slots:{default:[su]},$$scope:{ctx:n}}}),{c(){e=k("div"),B(r.$$.fragment),t=M(),B(o.$$.fragment),l=M(),B(i.$$.fragment),a=M(),B(s.$$.fragment),I(e,"slot","map")},m(u,f){w(u,e,f),T(r,e,null),_(e,t),T(o,e,null),_(e,l),T(i,e,null),_(e,a),T(s,e,null),c=!0},p(u,f){const p={};f&8&&(p.data=ge(u[3].links)),f&524304&&(p.$$scope={dirty:f,ctx:u}),r.$set(p);const d={};f&8&&(d.data=ge(u[3].jats)),f&524304&&(d.$$scope={dirty:f,ctx:u}),o.$set(d);const g={};f&8&&(g.data=ge(u[3].bus_stops)),f&524304&&(g.$$scope={dirty:f,ctx:u}),i.$set(g);const j={};f&8&&(j.data=ge(u[3].crossings)),f&524304&&(j.$$scope={dirty:f,ctx:u}),s.$set(j)},i(u){c||(b(r.$$.fragment,u),b(o.$$.fragment,u),b(i.$$.fragment,u),b(s.$$.fragment,u),c=!0)},o(u){y(r.$$.fragment,u),y(o.$$.fragment,u),y(i.$$.fragment,u),y(s.$$.fragment,u),c=!1},d(u){u&&v(e),E(r),E(o),E(i),E(s)}}}function to(n){let e,r;return e=new At({props:{$$slots:{default:[cu]},$$scope:{ctx:n}}}),e.$on("close",n[16]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&524290&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function cu(n){let e,r,t,o,l;return{c(){e=k("h1"),e.textContent="Load a file previously downloaded from this tool",r=M(),t=k("input"),I(t,"type","file")},m(i,a){w(i,e,a),w(i,r,a),w(i,t,a),n[15](t),o||(l=q(t,"change",n[5]),o=!0)},p:ee,d(i){i&&(v(e),v(r),v(t)),n[15](null),o=!1,l()}}}function no(n){let e,r;return e=new Gc({}),e.$on("close",n[17]),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function uu(n){let e,r,t,o,l;e=new Pe({props:{$$slots:{map:[au],sidebar:[ru]},$$scope:{ctx:n}}});let i=n[0]&&to(n),a=n[2]&&no(n);return{c(){B(e.$$.fragment),r=M(),i&&i.c(),t=M(),a&&a.c(),o=Ce()},m(s,c){T(e,s,c),w(s,r,c),i&&i.m(s,c),w(s,t,c),a&&a.m(s,c),w(s,o,c),l=!0},p(s,[c]){const u={};c&524317&&(u.$$scope={dirty:c,ctx:s}),e.$set(u),s[0]?i?(i.p(s,c),c&1&&b(i,1)):(i=to(s),i.c(),b(i,1),i.m(t.parentNode,t)):i&&(se(),y(i,1,1,()=>{i=null}),ae()),s[2]?a?(a.p(s,c),c&4&&b(a,1)):(a=no(s),a.c(),b(a,1),a.m(o.parentNode,o)):a&&(se(),y(a,1,1,()=>{a=null}),ae())},i(s){l||(b(e.$$.fragment,s),b(i),b(a),l=!0)},o(s){y(e.$$.fragment,s),y(i),y(a),l=!1},d(s){s&&(v(r),v(t),v(o)),E(e,s),i&&i.d(s),a&&a.d(s)}}}function fu(n,e,r){let t,o,l;te(n,Pt,$=>r(18,t=$)),te(n,W,$=>r(3,o=$)),te(n,Y,$=>r(4,l=$));let i=!1,a;async function s($){try{let z=JSON.parse(await a.files[0].text());if(po(z)){x(W,o=z,o),r(0,i=!1);return}}catch{}window.alert("Something's wrong with that file")}function c(){x(W,o.links=[],o),x(W,o.jats=[],o),x(W,o.bus_stops=[],o),x(W,o.crossings=[],o)}async function u(){await rs(t)}let f=!1;const p=$=>x(Y,l={kind:"edit-link",idx:$.detail.features[0].id},l),d=$=>x(Y,l={kind:"edit-jat",idx:$.detail.features[0].id},l),g=$=>x(Y,l={kind:"edit-bus-stop",idx:$.detail.features[0].id},l),j=$=>x(Y,l={kind:"edit-crossing",idx:$.detail.features[0].id},l),L=()=>r(0,i=!0),m=()=>oi("rcv2.geojson",JSON.stringify(o)),h=()=>r(2,f=!0);function A($){ue[$?"unshift":"push"](()=>{a=$,r(1,a)})}return[i,a,f,o,l,s,c,u,p,d,g,j,L,m,h,A,()=>r(0,i=!1),()=>r(2,f=!1)]}class pu extends le{constructor(e){super(),ie(this,e,fu,uu,oe,{})}}function du(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:We[n%We.length],st20:""}}}function mu(n){let e,r,t,o,l,i,a,s;return{c(){e=k("div"),r=k("h1"),t=N("Click map to create new "),o=N(n[0]),l=M(),i=k("button"),i.textContent="Cancel",I(e,"slot","sidebar")},m(c,u){w(c,e,u),_(e,r),_(r,t),_(r,o),_(e,l),_(e,i),a||(s=q(i,"click",n[3]),a=!0)},p(c,u){u&1&&re(o,c[0])},d(c){c&&v(e),a=!1,s()}}}function _u(n){let e,r,t;return r=new Ge({props:{except:""}}),{c(){e=k("div"),B(r.$$.fragment),I(e,"slot","map")},m(o,l){w(o,e,l),T(r,e,null),t=!0},p:ee,i(o){t||(b(r.$$.fragment,o),t=!0)},o(o){y(r.$$.fragment,o),t=!1},d(o){o&&v(e),E(r)}}}function gu(n){let e,r,t,o;return e=new vt({}),e.$on("click",n[2]),t=new Pe({props:{$$slots:{map:[_u],sidebar:[mu]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment),r=M(),B(t.$$.fragment)},m(l,i){T(e,l,i),w(l,r,i),T(t,l,i),o=!0},p(l,[i]){const a={};i&35&&(a.$$scope={dirty:i,ctx:l}),t.$set(a)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){y(e.$$.fragment,l),y(t.$$.fragment,l),o=!1},d(l){l&&v(r),E(e,l),E(t,l)}}}function hu(n,e,r){let t,o;te(n,W,s=>r(4,t=s)),te(n,Y,s=>r(1,o=s));let{obj:l}=e;function i(s){let c=s.detail.lngLat.toArray();if(l=="jat"){let u=ho(t.jats.length,c);x(W,t.jats=[...t.jats,u],t),x(Y,o={kind:"edit-jat",idx:t.jats.length-1},o)}else if(l=="crossing"){let u=go(t.crossings.length,c);x(W,t.crossings=[...t.crossings,u],t),x(Y,o={kind:"edit-crossing",idx:t.crossings.length-1},o)}else if(l=="bus stop"){let u=du(t.bus_stops.length,c);x(W,t.bus_stops=[...t.bus_stops,u],t),x(Y,o={kind:"edit-bus-stop",idx:t.bus_stops.length-1},o)}}const a=()=>x(Y,o={kind:"neutral"},o);return n.$$set=s=>{"obj"in s&&r(0,l=s.obj)},[l,o,i,a]}class bu extends le{constructor(e){super(),ie(this,e,hu,gu,oe,{obj:0})}}function $u(n){let e,r;return{c(){e=k("div"),r=k("div"),I(e,"slot","left")},m(t,o){w(t,e,o),_(e,r),n[13](r)},p:ee,d(t){t&&v(e),n[13](null)}}}function ro(n){let e,r,t;function o(i){n[12](i)}let l={style:n[2],standardControls:!0,hash:!0,images:[{id:"bus_stop",url:uo,options:{sdf:!0}},{id:"crossing",url:fo,options:{sdf:!0}}],$$slots:{default:[Bu]},$$scope:{ctx:n}};return n[3]!==void 0&&(l.map=n[3]),e=new Xo({props:l}),ue.push(()=>me(e,"map",o)),{c(){B(e.$$.fragment)},m(i,a){T(e,i,a),t=!0},p(i,a){const s={};a&4&&(s.style=i[2]),a&32794&&(s.$$scope={dirty:a,ctx:i}),!r&&a&8&&(r=!0,s.map=i[3],_e(()=>r=!1)),e.$set(s)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){y(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function ku(n){let e,r;return e=new hs({props:{graph:n[4].graph,map:n[3],editingExisting:!1,finish:n[10],cancel:n[11]}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&16&&(l.graph=t[4].graph),o&8&&(l.map=t[3]),o&16&&(l.finish=t[10]),o&16&&(l.cancel=t[11]),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function wu(n){let e,r;return e=new Ml({}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function vu(n){let e,r;return e=new oc({props:{qIdx:n[4].idx}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&16&&(l.qIdx=t[4].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function yu(n){let e,r;return e=new Bi({}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Au(n){let e,r;return e=new Ui({props:{idx:n[4].idx}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&16&&(l.idx=t[4].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Cu(n){let e,r;return e=new Rl({props:{idx:n[4].idx}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&16&&(l.idx=t[4].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ju(n){let e,r;return e=new Ma({props:{junctionIdx:n[4].idx}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&16&&(l.junctionIdx=t[4].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Su(n){let e,r;return e=new Ia({props:{idx:n[4].idx}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&16&&(l.idx=t[4].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Lu(n){let e,r;return e=new Va({props:{idx:n[4].idx}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&16&&(l.idx=t[4].idx),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function zu(n){let e,r;return e=new bu({props:{obj:n[4].obj}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,o){const l={};o&16&&(l.obj=t[4].obj),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Mu(n){let e,r;return e=new pu({}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p:ee,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Bu(n){let e,r,t,o,l,i,a;const s=[Mu,zu,Lu,Su,ju,Cu,Au,yu,vu,wu,ku],c=[];function u(f,p){return f[4].kind=="neutral"?0:f[4].kind=="new-point"?1:f[4].kind=="edit-link"?2:f[4].kind=="edit-jat"?3:f[4].kind=="edit-jat-detail"?4:f[4].kind=="edit-bus-stop"?5:f[4].kind=="edit-crossing"?6:f[4].kind=="crossing-questions"?7:f[4].kind=="link-questions"?8:f[4].kind=="bus-stop-questions"?9:f[4].kind=="draw-route"&&f[3]?10:-1}return~(t=u(n))&&(o=c[t]=s[t](n)),i=new ji({}),{c(){e=k("div"),r=M(),o&&o.c(),l=M(),B(i.$$.fragment)},m(f,p){w(f,e,p),n[9](e),w(f,r,p),~t&&c[t].m(f,p),w(f,l,p),T(i,f,p),a=!0},p(f,p){let d=t;t=u(f),t===d?~t&&c[t].p(f,p):(o&&(se(),y(c[d],1,1,()=>{c[d]=null}),ae()),~t?(o=c[t],o?o.p(f,p):(o=c[t]=s[t](f),o.c()),b(o,1),o.m(l.parentNode,l)):o=null)},i(f){a||(b(o),b(i.$$.fragment,f),a=!0)},o(f){y(o),y(i.$$.fragment,f),a=!1},d(f){f&&(v(e),v(r),v(l)),n[9](null),~t&&c[t].d(f),E(i,f)}}}function Tu(n){let e,r,t=n[2]&&ro(n);return{c(){e=k("div"),t&&t.c(),I(e,"slot","main"),X(e,"position","relative"),X(e,"width","100%"),X(e,"height","100vh")},m(o,l){w(o,e,l),t&&t.m(e,null),r=!0},p(o,l){o[2]?t?(t.p(o,l),l&4&&b(t,1)):(t=ro(o),t.c(),b(t,1),t.m(e,null)):t&&(se(),y(t,1,1,()=>{t=null}),ae())},i(o){r||(b(t),r=!0)},o(o){y(t),r=!1},d(o){o&&v(e),t&&t.d()}}}function Eu(n){let e,r;return e=new Wo({props:{$$slots:{main:[Tu],left:[$u]},$$scope:{ctx:n}}}),{c(){B(e.$$.fragment)},m(t,o){T(e,t,o),r=!0},p(t,[o]){const l={};o&32799&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){y(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ou(n,e,r){let t,o,l,i,a,s;te(n,Yt,h=>r(5,t=h)),te(n,Vt,h=>r(6,o=h)),te(n,Xt,h=>r(7,l=h)),te(n,W,h=>r(8,i=h)),te(n,Pt,h=>r(3,a=h)),te(n,Y,h=>r(4,s=h));let c,u,f=null;Zo(async()=>{r(2,f=await mn(t))});async function p(h){r(2,f=await mn(h))}function d(h){ue[h?"unshift":"push"](()=>{u=h,r(1,u),r(6,o)})}const g=()=>os(s.graph),j=()=>x(Y,s={kind:"neutral"},s);function L(h){a=h,Pt.set(a)}function m(h){ue[h?"unshift":"push"](()=>{c=h,r(0,c),r(7,l)})}return n.$$.update=()=>{n.$$.dirty&256&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(i)),n.$$.dirty&129&&c&&l&&(r(0,c.innerHTML="",c),c.appendChild(l)),n.$$.dirty&66&&u&&o&&(r(1,u.innerHTML="",u),u.appendChild(o)),n.$$.dirty&32&&p(t)},[c,u,f,a,s,t,o,l,i,d,g,j,L,m]}class Du extends le{constructor(e){super(),ie(this,e,Ou,Eu,oe,{})}}new Du({target:document.getElementById("app")});
