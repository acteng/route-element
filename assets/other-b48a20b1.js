import{X as mo,Y as _o,Z as Mt,v as ae,e as v,w as ce,t as h,$ as go,S as le,i as ie,s as re,h as Ee,z as k,B as F,a0 as ve,r as y,u as De,j as Te,k as Ne,x as A,a1 as Kr,a2 as te,a3 as qt,b as fe,a4 as tn,Q as _,R as J,l as je,a5 as ho,L as bo,a as _e,c as M,m as B,d as ge,f as E,g as Wr,q as Pe,a6 as nn,a7 as $o,a8 as ko,a9 as X,aa as wo,ab as vo,C as ee,ac as yo,A as L,ad as Re,H as I,I as oe,ae as Ao,p as x,af as Co,ag as rn,y as pe,T as Ae,O as he,N as Wt,G as ke,E as Me,F as Ve,V as Y,M as Ze,ah as st,ai as et,aj as $t,ak as jo,P as at,al as So,am as on,an as zo,ao as Lo,ap as Gt,aq as Mo,ar as Bo,as as Eo,_ as Do,at as To,n as Tt,au as Zt,av as No,aw as Jt,D as kt,ax as Io,J as Oo,U as Fo}from"./Layout-15292bf0.js";function qo(n,e){const r=e.token={};function t(o,l,i,a){if(e.token!==r)return;e.resolved=a;let s=e.ctx;i!==void 0&&(s=s.slice(),s[i]=a);const c=o&&(e.current=o)(s);let u=!1;e.block&&(e.blocks?e.blocks.forEach((f,d)=>{d!==l&&f&&(ae(),v(f,1,1,()=>{e.blocks[d]===f&&(e.blocks[d]=null)}),ce())}):e.block.d(1),c.c(),h(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[l]=c),u&&go()}if(mo(n)){const o=_o();if(n.then(l=>{Mt(o),t(e.then,1,e.value,l),Mt(null)},l=>{if(Mt(o),t(e.catch,2,e.error,l),Mt(null),!e.hasCatch)throw l}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function Po(n,e,r){const t=e.slice(),{resolved:o}=n;n.current===n.then&&(t[n.value]=o),n.current===n.catch&&(t[n.error]=o),n.block.p(t,r)}function Uo(n){let e,r;const t=n[7].default,o=Ee(t,n,n[6],null);return{c(){e=k("div"),o&&o.c(),F(e,"class",n[1]),ve(e,"maplibregl-ctrl",n[0])},m(l,i){y(l,e,i),o&&o.m(e,null),n[8](e),r=!0},p(l,[i]){o&&o.p&&(!r||i&64)&&De(o,t,l,l[6],r?Ne(t,l[6],i,null):Te(l[6]),null),(!r||i&2)&&F(e,"class",l[1]),(!r||i&3)&&ve(e,"maplibregl-ctrl",l[0])},i(l){r||(h(o,l),r=!0)},o(l){v(o,l),r=!1},d(l){l&&A(e),o&&o.d(l),n[8](null)}}}function Ro(n,e,r){let t,{$$slots:o={},$$scope:l}=e,{defaultStyling:i=!0}=e,{position:a="top-right"}=e,{class:s=void 0}=e;const{map:c}=Kr();te(n,c,p=>r(5,t=p));let u,f={onAdd(){return u},onRemove(){var p;(p=u==null?void 0:u.parentNode)==null||p.removeChild(u)}};qt(()=>{t==null||t.removeControl(f)});function d(p){fe[p?"unshift":"push"](()=>{u=p,r(2,u)})}return n.$$set=p=>{"defaultStyling"in p&&r(0,i=p.defaultStyling),"position"in p&&r(4,a=p.position),"class"in p&&r(1,s=p.class),"$$scope"in p&&r(6,l=p.$$scope)},n.$$.update=()=>{n.$$.dirty&52&&t&&u&&t.addControl(f,a)},[i,s,u,c,a,t,l,o,d]}class Go extends le{constructor(e){super(),ie(this,e,Ro,Uo,re,{defaultStyling:0,position:4,class:1})}}function Jo(n){let e,r,t,o,l,i;const a=n[4].default,s=Ee(a,n,n[3],null);return{c(){e=k("button"),r=k("div"),s&&s.c(),F(r,"class",t=tn(n[2])+" svelte-1s83zbq"),ve(r,"maplibregl-ctrl-icon",n[0]),ve(r,"ctrl-btn-center",n[1]),F(e,"type","button")},m(c,u){y(c,e,u),_(e,r),s&&s.m(r,null),o=!0,l||(i=J(e,"click",n[5]),l=!0)},p(c,[u]){s&&s.p&&(!o||u&8)&&De(s,a,c,c[3],o?Ne(a,c[3],u,null):Te(c[3]),null),(!o||u&4&&t!==(t=tn(c[2])+" svelte-1s83zbq"))&&F(r,"class",t),(!o||u&5)&&ve(r,"maplibregl-ctrl-icon",c[0]),(!o||u&6)&&ve(r,"ctrl-btn-center",c[1])},i(c){o||(h(s,c),o=!0)},o(c){v(s,c),o=!1},d(c){c&&A(e),s&&s.d(c),l=!1,i()}}}function Qo(n,e,r){let{$$slots:t={},$$scope:o}=e,{icon:l=!0}=e,{center:i=!0}=e,{class:a=void 0}=e;function s(c){je.call(this,n,c)}return n.$$set=c=>{"icon"in c&&r(0,l=c.icon),"center"in c&&r(1,i=c.center),"class"in c&&r(2,a=c.class),"$$scope"in c&&r(3,o=c.$$scope)},[l,i,a,o,t,s]}class Zr extends le{constructor(e){super(),ie(this,e,Qo,Jo,re,{icon:0,center:1,class:2})}}function Ho(n,e,r){let t;const o=ho();let{layer:l=void 0}=e;const{map:i}=Kr();te(n,i,u=>r(2,t=u));function a(u){o(u.type,{...u,map:i})}const s=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],c=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return qt(()=>{if(t)if(l)for(const u of s)t.off(u,l,a);else for(const u of c)t.off(u,a)}),n.$$set=u=>{"layer"in u&&r(1,l=u.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&t)if(l)for(const u of s)t.on(u,l,a);else for(const u of c)t.on(u,a)},[i,l,t]}class Pt extends le{constructor(e){super(),ie(this,e,Ho,null,re,{layer:1})}}function Ko(n){let e;const r=n[16].default,t=Ee(r,n,n[24],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16777216)&&De(t,r,o,o[24],e?Ne(r,o[24],l,null):Te(o[24]),null)},i(o){e||(h(t,o),e=!0)},o(o){v(t,o),e=!1},d(o){t&&t.d(o)}}}function Wo(n){let e,r,t;function o(i){n[17](i)}let l={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Ko]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.hovered=n[0]),e=new bo({props:l}),fe.push(()=>_e(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){M(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.hovered=i[0],ge(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){v(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Zo(n,e,r){let{$$slots:t={},$$scope:o}=e,{id:l=Wr("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:u=void 0}=e,{layout:f=void 0}=e,{filter:d=void 0}=e,{applyToClusters:p=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:S=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:g=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:C=!1}=e,{interactive:b=!0}=e;function j(T){$=T,r(0,$)}function w(T){je.call(this,n,T)}function z(T){je.call(this,n,T)}function N(T){je.call(this,n,T)}function q(T){je.call(this,n,T)}function P(T){je.call(this,n,T)}function V(T){je.call(this,n,T)}return n.$$set=T=>{"id"in T&&r(1,l=T.id),"source"in T&&r(2,i=T.source),"sourceLayer"in T&&r(3,a=T.sourceLayer),"beforeId"in T&&r(4,s=T.beforeId),"beforeLayerType"in T&&r(5,c=T.beforeLayerType),"paint"in T&&r(6,u=T.paint),"layout"in T&&r(7,f=T.layout),"filter"in T&&r(8,d=T.filter),"applyToClusters"in T&&r(9,p=T.applyToClusters),"minzoom"in T&&r(10,m=T.minzoom),"maxzoom"in T&&r(11,S=T.maxzoom),"hoverCursor"in T&&r(12,D=T.hoverCursor),"manageHoverState"in T&&r(13,g=T.manageHoverState),"hovered"in T&&r(0,$=T.hovered),"eventsIfTopMost"in T&&r(14,C=T.eventsIfTopMost),"interactive"in T&&r(15,b=T.interactive),"$$scope"in T&&r(24,o=T.$$scope)},[$,l,i,a,s,c,u,f,d,p,m,S,D,g,C,b,t,j,w,z,N,q,P,V,o]}class tt extends le{constructor(e){super(),ie(this,e,Zo,Wo,re,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function ln(n){let e=n[0],r,t,o=sn(n);return{c(){o.c(),r=Pe()},m(l,i){o.m(l,i),y(l,r,i),t=!0},p(l,i){i&1&&re(e,e=l[0])?(ae(),v(o,1,1,ee),ce(),o=sn(l),o.c(),h(o,1),o.m(r.parentNode,r)):o.p(l,i)},i(l){t||(h(o),t=!0)},o(l){v(o),t=!1},d(l){l&&A(r),o.d(l)}}}function sn(n){let e;const r=n[15].default,t=Ee(r,n,n[14],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16384)&&De(t,r,o,o[14],e?Ne(r,o[14],l,null):Te(o[14]),null)},i(o){e||(h(t,o),e=!0)},o(o){v(t,o),e=!1},d(o){t&&t.d(o)}}}function Xo(n){let e,r,t=n[0]&&ln(n);return{c(){t&&t.c(),e=Pe()},m(o,l){t&&t.m(o,l),y(o,e,l),r=!0},p(o,[l]){o[0]?t?(t.p(o,l),l&1&&h(t,1)):(t=ln(o),t.c(),h(t,1),t.m(e.parentNode,e)):t&&(ae(),v(t,1,1,()=>{t=null}),ce())},i(o){r||(h(t),r=!0)},o(o){v(t),r=!1},d(o){o&&A(e),t&&t.d(o)}}}function Vo(n,e,r){let t,o,{$$slots:l={},$$scope:i}=e,{id:a=Wr("vector")}=e,{url:s=null}=e,{tiles:c=null}=e,{promoteId:u=null}=e,{bounds:f=null}=e,{scheme:d=null}=e,{attribution:p=null}=e,{minzoom:m=null}=e,{maxzoom:S=null}=e,{volatile:D=null}=e;if(s&&s.includes("pmtiles://")&&!nn.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let b=new yo;nn.addProtocol("pmtiles",b.tile)}const{map:g,self:$}=$o();te(n,g,b=>r(13,o=b)),te(n,$,b=>r(0,t=b));let C;return qt(()=>{t&&o&&(ko(g,t,C),X($,t=null,t),C=void 0)}),n.$$set=b=>{"id"in b&&r(3,a=b.id),"url"in b&&r(4,s=b.url),"tiles"in b&&r(5,c=b.tiles),"promoteId"in b&&r(6,u=b.promoteId),"bounds"in b&&r(7,f=b.bounds),"scheme"in b&&r(8,d=b.scheme),"attribution"in b&&r(9,p=b.attribution),"minzoom"in b&&r(10,m=b.minzoom),"maxzoom"in b&&r(11,S=b.maxzoom),"volatile"in b&&r(12,D=b.volatile),"$$scope"in b&&r(14,i=b.$$scope)},n.$$.update=()=>{n.$$.dirty&16377&&o&&t!==a&&(X($,t=a,t),wo(o,t,vo({type:"vector",url:s,tiles:c,promoteId:u,bounds:f,scheme:d,attribution:p,minzoom:m,maxzoom:S,volatile:D}),b=>o&&b===t,()=>{t&&(C=o==null?void 0:o.getSource(t))})),n.$$.dirty&8200&&(o==null||o.on("style.load",()=>{C=o==null?void 0:o.getSource(a)}))},[t,g,$,a,s,c,u,f,d,p,m,S,D,o,i,l]}class Xr extends le{constructor(e){super(),ie(this,e,Vo,Xo,re,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const Yo=n=>({}),an=n=>({}),xo=n=>({}),cn=n=>({});function el(n){let e,r,t,o;const l=n[3].sidebar,i=Ee(l,n,n[2],cn),a=n[3].map,s=Ee(a,n,n[2],an);return{c(){e=k("div"),i&&i.c(),r=L(),t=k("div"),s&&s.c()},m(c,u){y(c,e,u),i&&i.m(e,null),n[4](e),y(c,r,u),y(c,t,u),s&&s.m(t,null),n[5](t),o=!0},p(c,[u]){i&&i.p&&(!o||u&4)&&De(i,l,c,c[2],o?Ne(l,c[2],u,xo):Te(c[2]),cn),s&&s.p&&(!o||u&4)&&De(s,a,c,c[2],o?Ne(a,c[2],u,Yo):Te(c[2]),an)},i(c){o||(h(i,c),h(s,c),o=!0)},o(c){v(i,c),v(s,c),o=!1},d(c){c&&(A(e),A(r),A(t)),i&&i.d(c),n[4](null),s&&s.d(c),n[5](null)}}}function tl(n,e,r){let t,o;te(n,Xt,c=>r(0,t=c)),te(n,Vt,c=>r(1,o=c));let{$$slots:l={},$$scope:i}=e;function a(c){fe[c?"unshift":"push"](()=>{t=c,Xt.set(t)})}function s(c){fe[c?"unshift":"push"](()=>{o=c,Vt.set(o)})}return n.$$set=c=>{"$$scope"in c&&r(2,i=c.$$scope)},[t,o,i,l,a,s]}class Ie extends le{constructor(e){super(),ie(this,e,tl,el,re,{})}}let Xt=Re(null),Vt=Re(null);const Vr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAACmlBMVEXo6uzn6e3o6u7n6ezn6uzm6Ozn6evo6ezm6evo6e3p6u7p6+3p6u3o6u3n6u3n6evn6evn6ezo6uzo6u3n6evn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezo6uzo6uzo6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezo6+3n6ezn6ezn6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6ezn6e3n6e3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6u3o6e3o6u3o6uzo6uzo6u3o6u3o6u3n6u3n6ezn6ezn6ezn6ezn6ezn6ezn6ezn6ezn6uzn6ezn6e3o6u3o6u3o6u3o6u3o6u3n6u3n6ezo6u3o6u3o6uzn6uzn6ezo6ezo6uzn6ezo6u3o6u3o6u3n6u3n6Ozm6ezn6ezo6u3o6u3o6uzo6u3n6u3o6e3o6u3o6u3o6u3n6u3n6ezo6uzo6u3o6u3n6+3o6uzo6u3o6u3o6uzo6uzn6uzn6uzn6ezn6ezn6ezn6ezo6u3n6ezo6ezn6ezn6ezn6ezn6ezn6e3o6u3o6e3n6ezn6ezo6uzn6evo6uzo6uzn6evn6ezo6u3n6ezn6uzo6u3n6ezn6ezo6u3n6u3n6ezo6u3o6u3n6ezn6u3o6u3o6u3n6ezo6u3n6u3n6ezn6ezo6u3n6ezo6u3n6e3n6uzn6ezn6ezn6ezn6ezn6ezn6ezo6u3o6u3n6ezn6ezo6u3o6e3o6u3n6e3o6u3n6u3n6uzo6u3o6u3o6u3o6u3o6u3o6u3o6u3n6ezn6evo6u3o6u3o6u3n6uvn6ezo6u3n6uzn6ezn6ezn6ezo6u3n6uzn6uzo6u3n6u3n6uzo6+zm6uzjK5F0AAAA3nRSTlMAAAAAAAAAAAAAAAAAAAAIDxIUFBMDKEVdbn2IjpOWlpCJb15HKgUACXqjwtrt/P/u3MSmSg0gc7vz4dnSz83U5fT3vnciCnPV8MCdg2JYUk5LU1pmdoyoy/rYdApBt31IIyMjIyyI0LY/AABh366lq19s6GnraXg8PHsAAwOEeF0MKiEiCymqnFmeqXsncN6sOTuuDYzPTlCJCHhyOjyxcGfmkhotgqFcrYIrHONkymEKEC8mLg9jzMhNmr1XVVi/mCSz79ddrI6v3FooDSsAQ6OCFReFoi48GTwtAAD3GpCFAAADBklEQVR4nKWUh1IUQRCGZ+nx8JRZMcspoiKekfbMomDABAaSCbNwxhPMgmLOCTFnxZxzzlkxY86+i927BxzeUmWVf+1O1c5+09Pd09NCaJoWAFJCOQAb0GuzQSAPAOXppVlhD6hQMUgIJpUECUxpviCAxoOuKlRUShikMmYMk5WCK1epWi24UgloDwhSBOqKSTtNVa9Rs1aIo3ad0LphofXqOxqEN4xoxLDBKaGcTiU0pRo3bNK0WfMWkehVZEtXq9aONm1Ne0oXQHuT0XbtO3Sk3y2jOnWOjomJ7tK8azf67B7boydTJMFeBIpevftgXHzffiH9ByQkJiUlJqcMHDR4yNBUHDZ8hG5IlCMBjByF0aPHjE1Loyfd7U5Lc7vd6eOSx0/AiZN0jSUmTyaTnikZmDnVQtPQNZ0ou10JMy8zWmAZmjmLIyeLdkMExloKZ8/x+lgEpmZlz/XXvMjZc3IM+YA2ofxkDVqQ/wn+69bzF/jLClxoqUi/9JSVcD+LGGUpfzB10WILzfPfmqKGJUuXcXkaguURK0BYgysdq1avCTRQCSlr163PVdbghjzEjZvoflJJbd6C6ArRLcGt2yjI7TvMq7qzM33s2u0DFtVj6h7YG4WYuY8sKoD9+YgZB2A9gdKQFzx4CA8fOXos8/gJ8+g0CD9+8tTpM2F49hyAAZotYedQPH/h4qXLV6D4mHOvXltx/QbevMX/PR4vmHsb8U7W3XuldD/rAeLDR5wrqixza0h+jPjk6V+KQ8xPgKLUeslneVYn7Uqhm2UD7lFgNizFYMHzUnqB+PIVJ4uyYGdQY98ZXPX6jY/eFpggo+yjt64NsIZPceuni0GW6WehzfbufXzsh48l2ZGeT59j47+MNHowg4WFheahff327Ts5UwQScCT7x0/JfYdbrDA8oBauSUkhUUP1ngx4aJEOimbNJsVBM6dLyUFpmtcesHFdCiWVMkGbzNFB1xWBupPnDFzzcDJotXJKJ22kCeJyqFupXyaoVCAw+JuzrGi5cOqSurf2B4tMU69Bi01ZAAAAAElFTkSuQmCC",Yr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMA/1uRIrUAAAjuSURBVHic7dxLlqM2FAZgCOdEGUUZZtCntZPWlrKCiKwgW2IpZAdkxoBAbJCEHle27r3UoxNr0KdMoc9Y/HoArm6aV3mVV/m/lHYbeIDaFh6wbVvPqd/dgJEDyBswcwB9A1YOYG7AxgHu9Tmt2O3ASAfEDkx0QO4A4zSwAbUDjDDrHWAEYY8BJwhs4KhPT1JrgeHDgM4C4/cLCAuQe9PHA9IC5O74Al7AC/hswHc8IrGBj58XPn5ydUBPBdgLjE+wRtJ7fcYyT+0AY6HJXuqyV+vs64WWF8SGf8nDv+hSvLN4wYUn+9KXffHNv/xvmAfwKq/yKq/yKv+p0rImxua+TBt4B8Ccm++LLNZN4X15wAI0c4nVMBd5xzKRscw8Vrqc06CYS+1jlcg4jy33ckNwr5gUF9DMq0Z30UcG2FfOkgso7t0DwwTclTcZEFzANQG5O2ousDGBjgtILqC5gGECPkZUQHABFQK/EAATAr8SgC0EvuDrdxHwFQ/ICFB4QMdAjwa2GBiw9dsEGLGASAD0oKQSAB1GkwDoNcLGBLoUwC4yRApgFxk50OMAmQEDDlAZMOIAnQHIJOUAMkkmA5BByAFkEHIAGYQtB3ouMHCBkQvgggAAqCC4EfGfAEAFwQF/BwAqCA74KwBQQXDAHyHQ44G1DYEBD8wRMCIAO6aOEYAJggX6CMAE4QDWJgIwQehsvQjABME9mokATBCOaaFPgB4JrE0CDEhgSYERCcwpgAgCDCCCAAOIIEgQQAQBBhBBkLbNEqDnAgMXGLlAfRDUGwH1SXLRT4D6JBWA+iQVgPok6QLQc4GBC4woYAgAu/StDkIGCPcDFbBTVXUQTAq46ZoMuEUTHTC4IBi78wloXBByAJmkHJC4JG0ZILhAh4uiO2Un0HKBBpdlADBcQGOAFgAUF0B9KWevt8aA4AIdF2gxQAcADRswXEBjgSUBFBdwiw4yIBCAgIBdHRlAiwXO9Nimu/80cADDBe5B6DnAPQh19c/HlBEg6yfXFFjccdVO7z500aze1o/qKWA/ev3ElAH9vllXz+4ZMOybu+olkoKB+uIBt7IZKcAYANj72jIFsPe1T8CESWIA2NvSJ6CjJOGA4f6TipJUXUQGDFSA+OC480ctuIB7TIBMUmsb/iffGbBJsqf+i48iNkm2yhdyksxx0N/ISdJHs2lykuRx4kzvgzDgAHHUuP1DTFJ7fOgbQP0DBnNMKyM1Se44JnKS9tIFF4yk7+OIezVikiywkpO0F3mvRkySA8hJ2ovagiCMBEBvzCDsXYoTBLO/LyMIW3jngAiwktQe1ehJsmMzPUl2dqAnyU5w9CSJoxo9SXaxR0+SWzGTk6Q2ZhD0FgWBCARBQANmi4PQ04AzCAMWcNWo39BrXTVqkvy9K2qSOn/gxCR1vumISRIe0LQgSH/2iUk6AWKSlH9bYpK0bzlikk7ABQGZJHOefA5w3sRCRzGopClRDG/jqg8Bzr7kk4TrDGdf8knCASIAXJJQwNkV0jshBAD7gGQvKqxjCN1Rhe2mCYAOAUUAgr7kG2QgA4IARB0wjCUOsENAiweSZyp4IDloE3HvAiTtrqlAb1+q8JxUFRkD+D97jvqSOyDMmBb1JdemGEBzARPXaGPvPYCoL9GBKXldXz97PokFsgEgzhUBMEggG8OIwFlBJ+CzIrlA0pcuAFTSqM9K0peoQND7VBKsZ8WkgEQCSV+6AEA9NYae9dOAMQWqx7R8NkYOivl6gAb0KVA9pmV9CTsoZl2BDyAHxawv0YCozbNWeViyvoQdFLOucBkw1NWHvjejCcBIBqCVrco3lQu0tr4IqBzT8r6EHBQlkFsUAPQl3KAI9KV3BoC+hBsUDfBuKADoS6hRFfwOGmZQBK/RMAB8lQhko1Tg69T3BKC+hBoUob6EAqC+hBpVoa6AGhTZANSXUIMi1JdQANSXMEDh+5zlQbENT7BeQkAFvcIB7q813d95JIBZwr6UA3MjZxiwh2Pm8EZgCIgE6IqAYAG3Dxn0pRBwg6JYQMDl7rZzJdAWAVurIQH3/9b7qLWmgBsUuxUElhPQdUBTBMzmNxzWET+br6dAH/alEGgeA/7k9sBN9RjwkXkMTBlwHNlt98dA1BkBoC8AvotFExsM9Me+ugCEN9UjQL8tMB4b5er/qq4MDMe+qgCIEqBwQIMEhgRYc0AmgIQA9RTYv6FTASxFoIOB/jkgEkBAgF794FkGphpgygE7ihaABgTMFhxOCnQQYFwSxwJwG1TDZwY5sJWB9hGwpsCQA83xowfah0BfAO4T1yNgcwMKBBgLLACwpEADAHpvGxXsDAH9OVyngNrb5iHQPgTk/tF08HlPYA4Ac4IxIOx3Os4Wh4BjbpwhoLXfKnkAdJudnUHg9nLatwHAGe9jfTCBwP4fOZyx1QVA+iRnT6x/O/YuA+L+U+eTDD3y7rYtmBg8MAZA8B6PAQUCc9jOR/1o4S5gYPC/Xe6/mMqAPAGZA3LfWfjLCgDQ0d4AANyBiwADA+dBAfcAI2CLPnAKqC2+sMuBcCItAMNDQBSA5gTGh4AKgC4H9BnKArBHa3oIzI+AY8TNgTUA0iaPNqkQaGFgKwPdn9sTwARnGQLs6zkDlhAYa4GmAMxFIP12Vg4cv38KLBkwRxV8ElyFtQCYApBVqAZKFUqvT2CiAboEpI3mB5m3A8ZjQ1cJnL3/8wDDsUHUAv3xUpaAuQSYNwP8hkrAv+HnAZoYmEqAjoEuBVQC+P9uKwXGq4GVCLQpoGuB6WpgSX4/loD0M6aAqQXmq4GZCpirAbf/8AxYEmCqBWQC6IuBthpYE2CkAupiwO/f29+LFEg3OGB4BpRE+WmA/tn+pQ3irYCmBKQf0gHuE9UDrtU+C5BOCxXAeLxuYWAtAu0bAQsZaGJA1wPTtcBMB36PAGN/66/yfDAGt8VtmK8FJjrwLQK2emC5FhjpwFcQmMtA2kwR0CKANQIGOvDzpUCHALYI6BNgKgM6AX68FBAYoA+Bhg78cCkgM0C5LeNDIHu/sQz4LUPzKq/yKq9yefkXR6tlrDrSxQ4AAAAASUVORK5CYII=";function Ce(){return["","2","1","0","Critical"]}let Ge=["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],Xe={SA01:{description:"Pedestrian and cyclist conflict with motor traffic at side roads/priority junctions",green:"Side roads/priority junctions have entry treatments that offer greater protection for  pedestrian and cycle movements (e.g. exit only, continuous footways, zebra/parallel crossings as appropriate to context).",amber:"<2,500vpd cut across main walking, wheeling or cycling streams and side roads and priority junctions have entry treatments. ",red:"<2,500vpd cut across main walking, wheeling or cycling streams, but side roads and priority junctions are untreated.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA02:{description:"Pedestrian and cyclist conflict with motor traffic at roundabouts and signal-controlled junctions",green:"All pedestrian and cyclist movements are separated from all motor traffic movements at roundabouts and/or signal controlled junctions.",amber:"The principal pedestrian and cyclist movements are separated from motor traffic movements at roundabouts and/or signal controlled junctions.",red:"The principal pedestrian and/or cyclist movements are in conflict with motor traffic movements at roundabouts and/or signal controlled junctions.",critical:">2,500vpd cut across main walking, wheeling or cycling streams."},SA03:{description:"Effect of lane widths on conflict between cyclists and motor traffic",green:"Cyclists are protected from motor traffic or off-road entirely.",amber:`Cyclists are in cycle lanes with light protection or stepped cycle tracks under 1.8m wide (single direction).

Or, cyclists are in a protected bidirectional cycle facility under 2.5m wide.

Or, cyclists are mixed with traffic on quiet urban streets with no centre line.`,red:`Cyclists are mixed with traffic in lanes less than 3.25m wide or over 3.9m wide.

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is under 3.25m or over 3.9m. 

Or cyclists are mixed with traffic on busy urban streets with no centre line.

Or, there are speed cushions present.`,critical:`Cyclists are mixed with traffic in lanes between 3.25m and 3.9m wide. 

Or, cyclists are in unprotected cycle lanes and the combined width of the cycle lane and adjacent traffic lane is between 3.25m and 3.9m.`},SA04:{description:"Risk of pedestrians tripping due to hazards",green:"No trip hazards, level clear surface.",amber:"Few trip hazards.",red:"Many trip hazards.",critical:"There are level differences of greater than 13mm with no tactile information and colour contrast to help identify them."},SA05:{description:"Cyclist conflict with kerbside activity, including risk of 'dooring' ",green:"Kerbside activity is well-managed with no or minimal conflict with cyclists. ",amber:"Less frequent kerbside activity, and conflict with cyclists is well-managed.",red:"Frequent kerbside activity for cyclists to contend with. Conflict with cyclists is not well-managed.",critical:`Cycle facility next to parking/loading facility, without a buffer of at least 0.5m.

Or, an unprotected cycle lane is next to a frequently-used bus layby.`},SA06:{description:"Ability of pedestrians to cross the street safely on desire lines",green:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 50-100m. 

On quieter streets (<8,000vpd), there are controlled crossings or only one lane of traffic to cross.`,amber:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 100-200m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross on desire lines.`,red:`On very busy streets (>8,000vpd), controlled crossings (including zebra crossings) are provided every 200-400m.

On quieter streets (<8,000vpd), loading/parking is formalised with gaps for pedestrians to cross.`,critical:`On very busy streets (>8,000vpd) controlled crossings (including zebra crossings) are not present or more than 400m apart.

On quieter streets (<8,000vpd), desire lines are blocked by parking and loading. `},SA07:{description:"Suitability of pedestrian crossings in context",green:`On very busy streets (>8,000vpd), signal crossings rest on green for pedestrians or have rapid response.

On quieter streets (<8,000vpd), crossing points are controlled crossings.`,amber:`On very busy streets (>8,000vpd), signal crossings are provided for pedestrians.

On quieter streets (<8,000vpd), crossing points have effective implied priority for pedestrians.`,red:`On very busy streets (>8,000vpd), there are uncontrolled crossings or zebra/parallel crossings.

On quieter streets (<8,000vpd), crossing points have no implied priority or there are no crossing points.`,critical:`On very busy streets (>8,000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic.

At signal junctions there are arms with dropped kerbs and tactile paving but no green pedestrian symbol.`},SA08:{description:"85th percentile speed of motor traffic (where cyclists are not protected or pedestrians are crossing uncontrolled)",green:`85th percentile speed is under 20mph.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:"85th percentile speed is between 20mph and 25mph.",red:"85th percentile speed is over 25mph.",critical:"85th percentile speed is over 30mph."},SA09:{description:"Volume of motor traffic at the busiest hour (where cyclists are not protected or pedestrians cross uncontrolled)",green:`<200 vehicles in the busiest hour.

Or, cyclists are protected from motor traffic or off-road entirely and controlled crossings are provided for pedestrians wherever needed.`,amber:`200-499 vehicles in the busiest hour.

And, less than 2% of traffic is HGVs.`,red:`500-1,000 vehicles in the busiest hour.

Or, 2-5% of traffic is HGVs where there are 200-499 vehicles in the busiest hour.`,critical:`>1,000 vehicles in the busiest hour.

Or, over 5% of traffic is HGVs where there are over 500 vehicles in the busiest hour.`},SA10:{description:"Required crossing speed at signal crossings (risk of pedestrians coming into conflict with traffic).",green:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1m/s.",amber:"There are detectors present on the crossing which extend crossing times based on a crossing speed of 1.2m/s.",red:"There are no detectors to extend crossing times, but pedestrians who start crossing at the end of the 'invitation to cross' can cross at a speed of 1.2m/s and get across the whole crossing in time.",critical:"Pedestrians who start crossing at the end of the 'invitation to cross' must cross at a speed of over 1.2m/s to get across the whole crossing in time."},SA11:{description:"Clear walking and wheeling spaces free of permanent obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",green:">3m clear footway width and pedestrian comfort is good (PCL of A-C).",amber:`Where the footway is next to the carriageway, there is:
• 2m-3m clear footway width and pedestrian comfort is good (PCL of A-C).
• >3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is 1.5m-3m.`,red:`Where the footway is next to the carriageway, there is:
• <2m clear footway width but pedestrian comfort is good (PCL of A-C)
• 2m-3m clear footway width and pedestrian comfort is poor (PCL of D-E).

Where the footway is not next to the carriageway, the clear footway width is <1.5m.`,critical:`Where the footway is next to the carriageway, there is:
• <1m clear footway width on any footway
• <1.5m clear footway width for over 6m
• 1m-2m clear footway width with a Pedestrian Comfort Level of D-E

Or there is no footway.`},SA12:{description:"Effective width next to tram line on a straight run or a curve",green:"Physical protection is provided for cyclists.",amber:">2.4m from tramline edge to kerb.",red:"2.4m from tramline edge to kerb.",critical:`<2.4m from tramline edge to kerb on a straight run.

Insufficient clearance on a curve.`},SA13:{description:"Crossing angle (between cyclist desire line and tram or train rails).",green:"Crossing angle between 80 and 90 degrees with track filler creating a smooth crossing for cyclists.",amber:"Crossing angle between 80 and 90 degrees (or between 60 and 80 degrees with track filler creating a smooth crossing for cyclists).",red:"Crossing angle between 60 and 80 degrees.",critical:"Crossing angle less than 60 degrees."},SA14:{description:`Cycling surface and maintenance defects:
• sharp gradients (≥12.5%)
• non cycle friendly ironworks
• raised/sunken covers or gullies
• potholes
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA15:{description:`Walking/wheeling surface and maintenance defects:
• steep camber (horizontal gradient >2.5% )
• steep longitudinal gradients (≥8% if under 1m, ≥5% if 1m or over) 
• missing dropped kerbs
• non flush tables
• misleading tactile information
• loose/cracked surfaces
• poor drainage or slip risks
• overgrown vegetation
`,green:"No defects.",amber:"Few minor defects.",red:"Many minor defects.",critical:"Major defects."},SA16:{description:"Presence of guard railing",green:"No guard railing anywhere on the route.",amber:"Minimal guard railing, used to address a clear safety issue such as a level difference.",red:"Guard railing used to control behaviour in complex environments.",critical:"Guard railing used as standard without consideration of inherent safety risks."},ST20:{description:"Interactions at bus stops.",green:"At bus stops, cyclists are protected from buses and traffic and interactions between pedestrians and cyclists are likely to be low-level.",amber:"At bus stops, cyclists are protected from buses and traffic, but there are likely to be medium-level interactions between pedestrians and cyclists.",red:"At bus stops, cyclists regularly have to wait behind buses or overtake them in general traffic lanes. Or, there are likely to be high-level interactions between pedestrians and cyclists.",critical:""}};function un(n){let e,r,t,o=n[0].critical+"",l;return{c(){e=k("p"),r=k("b"),r.textContent="Critical",t=I(`
    : `),l=I(o)},m(i,a){y(i,e,a),_(e,r),_(e,t),_(e,l)},p(i,a){a&1&&o!==(o=i[0].critical+"")&&oe(l,o)},d(i){i&&A(e)}}}function nl(n){let e,r,t,o=n[0].green+"",l,i,a,s,c,u=n[0].amber+"",f,d,p,m,S,D=n[0].red+"",g,$,C,b=n[0].critical&&un(n);return{c(){e=k("p"),r=k("b"),r.textContent="2",t=I(`
  : `),l=I(o),i=L(),a=k("p"),s=k("b"),s.textContent="1",c=I(`
  : `),f=I(u),d=L(),p=k("p"),m=k("b"),m.textContent="0",S=I(`
  : `),g=I(D),$=L(),b&&b.c(),C=Pe()},m(j,w){y(j,e,w),_(e,r),_(e,t),_(e,l),y(j,i,w),y(j,a,w),_(a,s),_(a,c),_(a,f),y(j,d,w),y(j,p,w),_(p,m),_(p,S),_(p,g),y(j,$,w),b&&b.m(j,w),y(j,C,w)},p(j,[w]){w&1&&o!==(o=j[0].green+"")&&oe(l,o),w&1&&u!==(u=j[0].amber+"")&&oe(f,u),w&1&&D!==(D=j[0].red+"")&&oe(g,D),j[0].critical?b?b.p(j,w):(b=un(j),b.c(),b.m(C.parentNode,C)):b&&(b.d(1),b=null)},i:ee,o:ee,d(j){j&&(A(e),A(i),A(a),A(d),A(p),A($),A(C)),b&&b.d(j)}}}function rl(n,e,r){let{metric:t}=e;return n.$$set=o=>{"metric"in o&&r(0,t=o.metric)},[t]}class ct extends le{constructor(e){super(),ie(this,e,rl,nl,re,{metric:0})}}function fn(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function dn(n,e,r){const t=n.slice();return t[11]=e[r][0],t[12]=e[r][1],t}function ol(n){let e,r,t,o,l,i;const a=n[5].default,s=Ee(a,n,n[4],null);let c=x(n[2]),u=[];for(let f=0;f<c.length;f+=1)u[f]=pn(fn(n,c,f));return{c(){e=k("label"),s&&s.c(),r=L(),t=k("select");for(let f=0;f<u.length;f+=1)u[f].c();n[0]===void 0&&Co(()=>n[10].call(t))},m(f,d){y(f,e,d),s&&s.m(e,null),_(e,r),_(e,t);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(t,null);rn(t,n[0],!0),o=!0,l||(i=[J(t,"change",n[10]),J(t,"change",n[7])],l=!0)},p(f,d){if(s&&s.p&&(!o||d&16)&&De(s,a,f,f[4],o?Ne(a,f[4],d,null):Te(f[4]),null),d&4){c=x(f[2]);let p;for(p=0;p<c.length;p+=1){const m=fn(f,c,p);u[p]?u[p].p(m,d):(u[p]=pn(m),u[p].c(),u[p].m(t,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=c.length}d&5&&rn(t,f[0])},i(f){o||(h(s,f),o=!0)},o(f){v(s,f),o=!1},d(f){f&&A(e),s&&s.d(f),pe(u,f),l=!1,Ae(i)}}}function ll(n){let e,r,t,o;const l=n[5].default,i=Ee(l,n,n[4],null);let a=x(n[2]),s=[];for(let c=0;c<a.length;c+=1)s[c]=mn(dn(n,a,c));return{c(){e=k("fieldset"),i&&i.c(),r=L(),t=k("div");for(let c=0;c<s.length;c+=1)s[c].c();F(t,"class","svelte-1vb210n"),ve(t,"horiz_radio",n[1]=="horiz-radio")},m(c,u){y(c,e,u),i&&i.m(e,null),_(e,r),_(e,t);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(t,null);o=!0},p(c,u){if(i&&i.p&&(!o||u&16)&&De(i,l,c,c[4],o?Ne(l,c[4],u,null):Te(c[4]),null),u&5){a=x(c[2]);let f;for(f=0;f<a.length;f+=1){const d=dn(c,a,f);s[f]?s[f].p(d,u):(s[f]=mn(d),s[f].c(),s[f].m(t,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=a.length}(!o||u&2)&&ve(t,"horiz_radio",c[1]=="horiz-radio")},i(c){o||(h(i,c),o=!0)},o(c){v(i,c),o=!1},d(c){c&&A(e),i&&i.d(c),pe(s,c)}}}function pn(n){let e,r=n[12]+"",t;return{c(){e=k("option"),t=I(r),e.__value=n[11],he(e,e.__value)},m(o,l){y(o,e,l),_(e,t)},p:ee,d(o){o&&A(e)}}}function mn(n){let e,r,t,o=n[12]+"",l,i,a,s,c;return a=Wt(n[9][0]),{c(){e=k("label"),r=k("input"),t=L(),l=I(o),i=L(),F(r,"type","radio"),r.__value=n[11],he(r,r.__value),a.p(r)},m(u,f){y(u,e,f),_(e,r),r.checked=r.__value===n[0],_(e,t),_(e,l),_(e,i),s||(c=[J(r,"change",n[8]),J(r,"change",n[6])],s=!0)},p(u,f){f&5&&(r.checked=r.__value===u[0])},d(u){u&&A(e),a.r(),s=!1,Ae(c)}}}function il(n){let e,r,t,o;const l=[ll,ol],i=[];function a(s,c){return s[1]=="horiz-radio"||s[1]=="vert-radio"?0:s[1]=="dropdown"?1:-1}return~(e=a(n))&&(r=i[e]=l[e](n)),{c(){r&&r.c(),t=Pe()},m(s,c){~e&&i[e].m(s,c),y(s,t,c),o=!0},p(s,[c]){let u=e;e=a(s),e===u?~e&&i[e].p(s,c):(r&&(ae(),v(i[u],1,1,()=>{i[u]=null}),ce()),~e?(r=i[e],r?r.p(s,c):(r=i[e]=l[e](s),r.c()),h(r,1),r.m(t.parentNode,t)):r=null)},i(s){o||(h(r),o=!0)},o(s){v(r),o=!1},d(s){s&&A(t),~e&&i[e].d(s)}}}function sl(n,e,r){let{$$slots:t={},$$scope:o}=e,{k:l}=e,{value:i}=e,{choices:a}=e,s=a[0].length==2?a:a.map(m=>[m,m]);const c=[[]];function u(m){je.call(this,n,m)}function f(m){je.call(this,n,m)}function d(){i=this.__value,r(0,i),r(2,s)}function p(){i=Ao(this),r(0,i),r(2,s)}return n.$$set=m=>{"k"in m&&r(1,l=m.k),"value"in m&&r(0,i=m.value),"choices"in m&&r(3,a=m.choices),"$$scope"in m&&r(4,o=m.$$scope)},[i,l,s,a,o,t,u,f,d,c,p]}class qe extends le{constructor(e){super(),ie(this,e,sl,il,re,{k:1,value:0,choices:3})}}let It=Re(void 0),K=Re(al());function de(n){return{type:"FeatureCollection",features:n}}let Z=Re({kind:"neutral"});function xr(n){return"links"in n&&"jats"in n&&"bus_stops"&&"crossings"in n&&"side_roads"in n}function al(){try{let n=JSON.parse(window.localStorage.getItem("tmp-rcv2")||"");if(xr(n))return n}catch{}return{links:[],jats:[],bus_stops:[],crossings:[],side_roads:[]}}function _n(n){let e,r;return e=new ke({props:{data:de(n[2].links),$$slots:{default:[cl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=de(t[2].links)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function cl(n){let e,r;return e=new Me({props:{paint:{"line-color":n[1]=="links"?["get","color"]:"black","line-width":6}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"line-color":t[1]=="links"?["get","color"]:"black","line-width":6}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function gn(n){let e,r;return e=new ke({props:{data:de(n[2].bus_stops),$$slots:{default:[ul]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=de(t[2].bus_stops)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ul(n){let e,r;return e=new tt({props:{layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":n[1]=="bus_stops"?["get","color"]:"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"icon-color":t[1]=="bus_stops"?["get","color"]:"black"}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function hn(n){let e,r;return e=new ke({props:{data:de(n[2].crossings),$$slots:{default:[fl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=de(t[2].crossings)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function fl(n){let e,r;return e=new tt({props:{layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":n[1]=="crossings"?["get","color"]:"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"icon-color":t[1]=="crossings"?["get","color"]:"black"}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function bn(n){let e,r;return e=new ke({props:{data:de(n[2].jats),$$slots:{default:[dl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=de(t[2].jats)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function dl(n){let e,r;return e=new Ve({props:{paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":n[1]=="jats"?["get","color"]:"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":t[1]=="jats"?["get","color"]:"black","circle-radius":20}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function $n(n){let e,r;return e=new ke({props:{data:de(n[2].side_roads),$$slots:{default:[pl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.data=de(t[2].side_roads)),o&10&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function pl(n){let e,r;return e=new Me({props:{paint:{"line-color":n[1]=="side_roads"?["get","color"]:"black","line-width":3}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&2&&(l.paint={"line-color":t[1]=="side_roads"?["get","color"]:"black","line-width":3}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ml(n){let e,r,t,o,l,i,a=n[0]!="links"&&_n(n),s=n[0]!="bus_stops"&&gn(n),c=n[0]!="crossings"&&hn(n),u=n[0]!="jats"&&bn(n),f=n[0]!="side_roads"&&$n(n);return{c(){a&&a.c(),e=L(),s&&s.c(),r=L(),c&&c.c(),t=L(),u&&u.c(),o=L(),f&&f.c(),l=Pe()},m(d,p){a&&a.m(d,p),y(d,e,p),s&&s.m(d,p),y(d,r,p),c&&c.m(d,p),y(d,t,p),u&&u.m(d,p),y(d,o,p),f&&f.m(d,p),y(d,l,p),i=!0},p(d,[p]){d[0]!="links"?a?(a.p(d,p),p&1&&h(a,1)):(a=_n(d),a.c(),h(a,1),a.m(e.parentNode,e)):a&&(ae(),v(a,1,1,()=>{a=null}),ce()),d[0]!="bus_stops"?s?(s.p(d,p),p&1&&h(s,1)):(s=gn(d),s.c(),h(s,1),s.m(r.parentNode,r)):s&&(ae(),v(s,1,1,()=>{s=null}),ce()),d[0]!="crossings"?c?(c.p(d,p),p&1&&h(c,1)):(c=hn(d),c.c(),h(c,1),c.m(t.parentNode,t)):c&&(ae(),v(c,1,1,()=>{c=null}),ce()),d[0]!="jats"?u?(u.p(d,p),p&1&&h(u,1)):(u=bn(d),u.c(),h(u,1),u.m(o.parentNode,o)):u&&(ae(),v(u,1,1,()=>{u=null}),ce()),d[0]!="side_roads"?f?(f.p(d,p),p&1&&h(f,1)):(f=$n(d),f.c(),h(f,1),f.m(l.parentNode,l)):f&&(ae(),v(f,1,1,()=>{f=null}),ce())},i(d){i||(h(a),h(s),h(c),h(u),h(f),i=!0)},o(d){v(a),v(s),v(c),v(u),v(f),i=!1},d(d){d&&(A(e),A(r),A(t),A(o),A(l)),a&&a.d(d),s&&s.d(d),c&&c.d(d),u&&u.d(d),f&&f.d(d)}}}function _l(n,e,r){let t;te(n,K,i=>r(2,t=i));let{except:o}=e,{showColor:l=""}=e;return n.$$set=i=>{"except"in i&&r(0,o=i.except),"showColor"in i&&r(1,l=i.showColor)},[o,l,t]}class Je extends le{constructor(e){super(),ie(this,e,_l,ml,re,{except:0,showColor:1})}}function kn(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function wn(n){let e,r,t=n[6].properties.name+"",o,l,i,a,s,c;function u(d){n[5](d,n[6])}let f={k:"horiz-radio",choices:Ce()};return n[6].properties.st20!==void 0&&(f.value=n[6].properties.st20),i=new qe({props:f}),fe.push(()=>_e(i,"value",u)),{c(){e=k("li"),r=k("span"),o=I(t),l=L(),M(i.$$.fragment),s=L(),Y(r,"color",n[6].properties.color)},m(d,p){y(d,e,p),_(e,r),_(r,o),_(e,l),B(i,e,null),_(e,s),c=!0},p(d,p){n=d,(!c||p&2)&&t!==(t=n[6].properties.name+"")&&oe(o,t),p&2&&Y(r,"color",n[6].properties.color);const m={};!a&&p&2&&(a=!0,m.value=n[6].properties.st20,ge(()=>a=!1)),i.$set(m)},i(d){c||(h(i.$$.fragment,d),c=!0)},o(d){v(i.$$.fragment,d),c=!1},d(d){d&&A(e),E(i)}}}function gl(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m=x(n[1].bus_stops),S=[];for(let g=0;g<m.length;g+=1)S[g]=wn(kn(n,m,g));const D=g=>v(S[g],1,1,()=>{S[g]=null});return u=new ct({props:{metric:n[2]}}),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("h2"),o.textContent="ST20: bus stops",l=L(),i=k("p"),i.textContent=`${n[2].description}`,a=L(),s=k("ol");for(let g=0;g<S.length;g+=1)S[g].c();c=L(),M(u.$$.fragment),F(e,"slot","sidebar")},m(g,$){y(g,e,$),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(e,a),_(e,s);for(let C=0;C<S.length;C+=1)S[C]&&S[C].m(s,null);_(e,c),B(u,e,null),f=!0,d||(p=J(r,"click",n[4]),d=!0)},p(g,$){if($&2){m=x(g[1].bus_stops);let C;for(C=0;C<m.length;C+=1){const b=kn(g,m,C);S[C]?(S[C].p(b,$),h(S[C],1)):(S[C]=wn(b),S[C].c(),h(S[C],1),S[C].m(s,null))}for(ae(),C=m.length;C<S.length;C+=1)D(C);ce()}},i(g){if(!f){for(let $=0;$<m.length;$+=1)h(S[$]);h(u.$$.fragment,g),f=!0}},o(g){S=S.filter(Boolean);for(let $=0;$<S.length;$+=1)v(S[$]);v(u.$$.fragment,g),f=!1},d(g){g&&A(e),pe(S,g),E(u),d=!1,p()}}}function hl(n){let e,r,t;return r=new Je({props:{showColor:"bus_stops",except:""}}),{c(){e=k("div"),M(r.$$.fragment),F(e,"slot","map")},m(o,l){y(o,e,l),B(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){v(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function bl(n){let e,r,t,o;return e=new Ie({props:{$$slots:{map:[hl],sidebar:[gl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0,t||(o=J(window,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function $l(n,e,r){let t,o;te(n,Z,c=>r(0,t=c)),te(n,K,c=>r(1,o=c));let l=Xe.ST20;function i(c){c.key=="Escape"&&X(Z,t={kind:"neutral"},t)}const a=()=>X(Z,t={kind:"neutral"},t);function s(c,u){n.$$.not_equal(u.properties.st20,c)&&(u.properties.st20=c,K.set(o))}return[t,o,l,i,a,s]}class kl extends le{constructor(e){super(),ie(this,e,$l,bl,re,{})}}function wl(n){let e,r;const t=n[4].default,o=Ee(t,n,n[6],null);return{c(){e=k("span"),o&&o.c(),F(e,"class","dot svelte-117v9mi"),ve(e,"outline",n[3]),Y(e,"background-color",n[3]?void 0:n[1]),Y(e,"border-color",n[3]?n[1]:void 0),Y(e,"width",n[2]),Y(e,"height",n[2])},m(l,i){y(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&64)&&De(o,t,l,l[6],r?Ne(t,l[6],i,null):Te(l[6]),null),(!r||i&8)&&ve(e,"outline",l[3]),i&10&&Y(e,"background-color",l[3]?void 0:l[1]),i&10&&Y(e,"border-color",l[3]?l[1]:void 0),i&4&&Y(e,"width",l[2]),i&4&&Y(e,"height",l[2])},i(l){r||(h(o,l),r=!0)},o(l){v(o,l),r=!1},d(l){l&&A(e),o&&o.d(l)}}}function vl(n){let e,r,t;function o(i){n[5](i)}let l={draggable:!0,$$slots:{default:[wl]},$$scope:{ctx:n}};return n[0]!==void 0&&(l.lngLat=n[0]),e=new Ze({props:l}),fe.push(()=>_e(e,"lngLat",o)),{c(){M(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,[a]){const s={};a&78&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.lngLat=i[0],ge(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){v(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function yl(n,e,r){let{$$slots:t={},$$scope:o}=e,{lngLat:l}=e,{color:i}=e,{radius:a="30px"}=e,{outline:s=!1}=e;function c(u){l=u,r(0,l)}return n.$$set=u=>{"lngLat"in u&&r(0,l=u.lngLat),"color"in u&&r(1,i=u.color),"radius"in u&&r(2,a=u.radius),"outline"in u&&r(3,s=u.outline),"$$scope"in u&&r(6,o=u.$$scope)},[l,i,a,s,t,c,o]}class xt extends le{constructor(e){super(),ie(this,e,yl,vl,re,{lngLat:0,color:1,radius:2,outline:3})}}const{window:Al}=st;function Cl(n){let e;return{c(){e=I("ST20: bus stops")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function jl(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m;function S(g){n[8](g)}let D={k:"horiz-radio",choices:Ce(),$$slots:{default:[Cl]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].properties.st20!==void 0&&(D.value=n[1].bus_stops[n[0]].properties.st20),u=new qe({props:D}),fe.push(()=>_e(u,"value",S)),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("button"),o.textContent="Delete bus stop",l=L(),i=k("label"),a=I(`Name:
      `),s=k("input"),c=L(),M(u.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(g,$){y(g,e,$),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(i,a),_(i,s),he(s,n[1].bus_stops[n[0]].properties.name),_(e,c),B(u,e,null),d=!0,p||(m=[J(r,"click",n[6]),J(o,"click",n[4]),J(s,"input",n[7])],p=!0)},p(g,$){$&3&&s.value!==g[1].bus_stops[g[0]].properties.name&&he(s,g[1].bus_stops[g[0]].properties.name);const C={};$&512&&(C.$$scope={dirty:$,ctx:g}),!f&&$&3&&(f=!0,C.value=g[1].bus_stops[g[0]].properties.st20,ge(()=>f=!1)),u.$set(C)},i(g){d||(h(u.$$.fragment,g),d=!0)},o(g){v(u.$$.fragment,g),d=!1},d(g){g&&A(e),E(u),p=!1,Ae(m)}}}function Sl(n){let e,r;return e=new tt({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function zl(n){let e,r;return{c(){e=k("img"),$t(e.src,r=Vr)||F(e,"src",r),F(e,"alt","")},m(t,o){y(t,e,o)},p:ee,d(t){t&&A(e)}}}function Ll(n){let e,r,t,o,l,i,a,s;r=new Je({props:{except:"bus_stops"}}),o=new ke({props:{data:de(n[1].bus_stops),generateId:!0,$$slots:{default:[Sl]},$$scope:{ctx:n}}});function c(f){n[5](f)}let u={color:n[1].bus_stops[n[0]].properties.color,$$slots:{default:[zl]},$$scope:{ctx:n}};return n[1].bus_stops[n[0]].geometry.coordinates!==void 0&&(u.lngLat=n[1].bus_stops[n[0]].geometry.coordinates),i=new xt({props:u}),fe.push(()=>_e(i,"lngLat",c)),{c(){e=k("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),l=L(),M(i.$$.fragment),F(e,"slot","map")},m(f,d){y(f,e,d),B(r,e,null),_(e,t),B(o,e,null),_(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].bus_stops)),d&513&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};d&3&&(m.color=f[1].bus_stops[f[0]].properties.color),d&512&&(m.$$scope={dirty:d,ctx:f}),!a&&d&3&&(a=!0,m.lngLat=f[1].bus_stops[f[0]].geometry.coordinates,ge(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){v(r.$$.fragment,f),v(o.$$.fragment,f),v(i.$$.fragment,f),s=!1},d(f){f&&A(e),E(r),E(o),E(i)}}}function Ml(n){let e,r,t,o;return e=new Ie({props:{$$slots:{map:[Ll],sidebar:[jl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0,t||(o=J(Al,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function Bl(n,e,r){let t,o;te(n,K,d=>r(1,t=d)),te(n,Z,d=>r(2,o=d));let{idx:l}=e;function i(d){d.key=="Escape"&&X(Z,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this bus stop?")&&(X(Z,o={kind:"neutral"},o),await et(),t.bus_stops.splice(l,1),K.set(t))}function s(d){n.$$.not_equal(t.bus_stops[l].geometry.coordinates,d)&&(t.bus_stops[l].geometry.coordinates=d,K.set(t))}const c=()=>X(Z,o={kind:"neutral"},o);function u(){t.bus_stops[l].properties.name=this.value,K.set(t)}function f(d){n.$$.not_equal(t.bus_stops[l].properties.st20,d)&&(t.bus_stops[l].properties.st20=d,K.set(t))}return n.$$set=d=>{"idx"in d&&r(0,l=d.idx)},[l,t,o,i,a,s,c,u,f]}class El extends le{constructor(e){super(),ie(this,e,Bl,Ml,re,{idx:0})}}function vn(n,e,r){const t=n.slice();return t[1]=e[r][0],t[2]=e[r][1],t}function yn(n){let e,r,t,o=n[1]+"",l,i;return{c(){e=k("li"),r=k("span"),t=L(),l=I(o),i=L(),F(r,"class","svelte-kzgqtg"),Y(r,"background",n[2])},m(a,s){y(a,e,s),_(e,r),_(e,t),_(e,l),_(e,i)},p(a,s){s&1&&Y(r,"background",a[2]),s&1&&o!==(o=a[1]+"")&&oe(l,o)},d(a){a&&A(e)}}}function Dl(n){let e,r=x(n[0]),t=[];for(let o=0;o<r.length;o+=1)t[o]=yn(vn(n,r,o));return{c(){e=k("ul");for(let o=0;o<t.length;o+=1)t[o].c()},m(o,l){y(o,e,l);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(o,[l]){if(l&1){r=x(o[0]);let i;for(i=0;i<r.length;i+=1){const a=vn(o,r,i);t[i]?t[i].p(a,l):(t[i]=yn(a),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=r.length}},i:ee,o:ee,d(o){o&&A(e),pe(t,o)}}}function Tl(n,e,r){let{rows:t}=e;return n.$$set=o=>{"rows"in o&&r(0,t=o.rows)},[t]}class Nl extends le{constructor(e){super(),ie(this,e,Tl,Dl,re,{rows:0})}}const Il=n=>({dialog:n&1}),An=n=>({dialog:n[0]});function Ol(n){let e,r,t,o,l;const i=n[4].default,a=Ee(i,n,n[3],An);return{c(){e=k("dialog"),r=k("article"),a&&a.c(),e.open=!0},m(s,c){y(s,e,c),_(e,r),a&&a.m(r,null),n[6](e),t=!0,o||(l=[J(window,"click",n[1]),J(window,"keydown",n[2]),J(e,"close",n[5])],o=!0)},p(s,[c]){a&&a.p&&(!t||c&9)&&De(a,i,s,s[3],t?Ne(i,s[3],c,Il):Te(s[3]),An)},i(s){t||(h(a,s),t=!0)},o(s){v(a,s),t=!1},d(s){s&&A(e),a&&a.d(s),n[6](null),o=!1,Ae(l)}}}function Fl(n,e,r){let{$$slots:t={},$$scope:o}=e,l;function i(u){l.open&&u.target==l&&l.close()}function a(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),l.close())}function s(u){je.call(this,n,u)}function c(u){fe[u?"unshift":"push"](()=>{l=u,r(0,l)})}return n.$$set=u=>{"$$scope"in u&&r(3,o=u.$$scope)},[l,i,a,o,t,s,c]}class Ut extends le{constructor(e){super(),ie(this,e,Fl,Ol,re,{})}}function Cn(n,e,r){const t=n.slice();return t[3]=e[r],t}function jn(n,e,r){const t=n.slice();return t[6]=e[r],t}function Sn(n){let e,r;return{c(){e=k("span"),r=I(` 
    `),Y(e,"background",n[6]),Y(e,"width","100%"),Y(e,"border","1px solid black")},m(t,o){y(t,e,o),_(e,r)},p(t,o){o&1&&Y(e,"background",t[6])},d(t){t&&A(e)}}}function ql(n){let e,r=n[3]+"",t;return{c(){e=k("span"),t=I(r)},m(o,l){y(o,e,l),_(e,t)},p(o,l){l&2&&r!==(r=o[3]+"")&&oe(t,r)},d(o){o&&A(e)}}}function Pl(n){let e,r=n[3].toFixed(n[2])+"",t;return{c(){e=k("span"),t=I(r)},m(o,l){y(o,e,l),_(e,t)},p(o,l){l&6&&r!==(r=o[3].toFixed(o[2])+"")&&oe(t,r)},d(o){o&&A(e)}}}function zn(n){let e;function r(l,i){return l[2]>0?Pl:ql}let t=r(n),o=t(n);return{c(){o.c(),e=Pe()},m(l,i){o.m(l,i),y(l,e,i)},p(l,i){t===(t=r(l))&&o?o.p(l,i):(o.d(1),o=t(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&A(e),o.d(l)}}}function Ul(n){let e,r,t,o=x(n[0]),l=[];for(let s=0;s<o.length;s+=1)l[s]=Sn(jn(n,o,s));let i=x(n[1]),a=[];for(let s=0;s<i.length;s+=1)a[s]=zn(Cn(n,i,s));return{c(){e=k("div");for(let s=0;s<l.length;s+=1)l[s].c();r=L(),t=k("div");for(let s=0;s<a.length;s+=1)a[s].c();Y(e,"display","flex"),Y(t,"display","flex"),Y(t,"justify-content","space-between")},m(s,c){y(s,e,c);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);y(s,r,c),y(s,t,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(t,null)},p(s,[c]){if(c&1){o=x(s[0]);let u;for(u=0;u<o.length;u+=1){const f=jn(s,o,u);l[u]?l[u].p(f,c):(l[u]=Sn(f),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=o.length}if(c&6){i=x(s[1]);let u;for(u=0;u<i.length;u+=1){const f=Cn(s,i,u);a[u]?a[u].p(f,c):(a[u]=zn(f),a[u].c(),a[u].m(t,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=i.length}},i:ee,o:ee,d(s){s&&(A(e),A(r),A(t)),pe(l,s),pe(a,s)}}}function Rl(n,e,r){let{colorScale:t}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return n.$$set=i=>{"colorScale"in i&&r(0,t=i.colorScale),"limits"in i&&r(1,o=i.limits),"decimalPlaces"in i&&r(2,l=i.decimalPlaces)},[t,o,l]}class Gl extends le{constructor(e){super(),ie(this,e,Rl,Ul,re,{colorScale:0,limits:1,decimalPlaces:2})}}function Jl(n,e){let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function Ql(n){let e;return{c(){e=I("Bus stops")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Ln(n){let e,r,t,o,l;return o=new Gl({props:{colorScale:n[1],limits:n[2]}}),{c(){e=k("div"),r=k("p"),r.textContent="Peak hourly frequency:",t=L(),M(o.$$.fragment),F(e,"class","svelte-yxmabo")},m(i,a){y(i,e,a),_(e,r),_(e,t),B(o,e,null),l=!0},p:ee,i(i){l||(h(o.$$.fragment,i),l=!0)},o(i){v(o.$$.fragment,i),l=!1},d(i){i&&A(e),E(o)}}}function Hl(n){let e,r,t,o=n[4].stop_name+"",l,i,a,s,c,u=n[4].peak+"",f,d,p,m,S,D=n[4].peak_description+"",g,$,C,b,j,w=n[4].total+"",z,N,q=n[4].total_description+"",P,V;return{c(){e=k("p"),r=I("Stop name: "),t=k("b"),l=I(o),i=L(),a=k("p"),s=I("Peak: "),c=k("b"),f=I(u),d=I(`
        buses during the busiest hour of any day`),p=L(),m=k("p"),S=I("The peak hour is "),g=I(D),$=L(),C=k("p"),b=I("Total buses per day: "),j=k("b"),z=I(w),N=I(`
        (for `),P=I(q),V=I(", the busiest day of the week)")},m(T,R){y(T,e,R),_(e,r),_(e,t),_(t,l),y(T,i,R),y(T,a,R),_(a,s),_(a,c),_(c,f),_(a,d),y(T,p,R),y(T,m,R),_(m,S),_(m,g),y(T,$,R),y(T,C,R),_(C,b),_(C,j),_(j,z),_(C,N),_(C,P),_(C,V)},p(T,R){R&16&&o!==(o=T[4].stop_name+"")&&oe(l,o),R&16&&u!==(u=T[4].peak+"")&&oe(f,u),R&16&&D!==(D=T[4].peak_description+"")&&oe(g,D),R&16&&w!==(w=T[4].total+"")&&oe(z,w),R&16&&q!==(q=T[4].total_description+"")&&oe(P,q)},d(T){T&&(A(e),A(i),A(a),A(p),A(m),A($),A(C))}}}function Kl(n){let e,r;return e=new at({props:{$$slots:{default:[Hl,({props:t})=>({4:t}),({props:t})=>t?16:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&48&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Wl(n){let e,r;return e=new Ve({props:{sourceLayer:"bus_stops",paint:{"circle-color":jo(["get","peak"],n[2],n[1]),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},manageHoverState:!0,$$slots:{default:[Kl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),o&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Zl(n){let e,r,t,o,l;e=new Zr({props:{$$slots:{default:[Ql]},$$scope:{ctx:n}}}),e.$on("click",n[3]);let i=n[0]&&Ln(n);return o=new Xr({props:{url:"pmtiles://https://atip.uk/layers/v1/bus_stops.pmtiles",$$slots:{default:[Wl]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),i&&i.c(),t=L(),M(o.$$.fragment)},m(a,s){B(e,a,s),y(a,r,s),i&&i.m(a,s),y(a,t,s),B(o,a,s),l=!0},p(a,[s]){const c={};s&32&&(c.$$scope={dirty:s,ctx:a}),e.$set(c),a[0]?i?(i.p(a,s),s&1&&h(i,1)):(i=Ln(a),i.c(),h(i,1),i.m(t.parentNode,t)):i&&(ae(),v(i,1,1,()=>{i=null}),ce());const u={};s&33&&(u.$$scope={dirty:s,ctx:a}),o.$set(u)},i(a){l||(h(e.$$.fragment,a),h(i),h(o.$$.fragment,a),l=!0)},o(a){v(e.$$.fragment,a),v(i),v(o.$$.fragment,a),l=!1},d(a){a&&(A(r),A(t)),E(e,a),i&&i.d(a),E(o,a)}}}function Xl(n,e,r){let t=!1;return[t,["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],[0,3,10,20,30,100],()=>r(0,t=!t)]}class Vl extends le{constructor(e){super(),ie(this,e,Xl,Zl,re,{})}}function Yl(n){let e;return{c(){e=I("Crossings")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Mn(n){let e,r,t;return r=new Nl({props:{rows:n[1]}}),{c(){e=k("div"),M(r.$$.fragment),F(e,"class","svelte-yxmabo")},m(o,l){y(o,e,l),B(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){v(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function xl(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=k("p"),t=I(r),o=I(" crossing")},m(l,i){y(l,e,i),_(e,t),_(e,o)},p(l,i){i&8&&r!==(r=(l[3].class||"Unknown")+"")&&oe(t,r)},d(l){l&&A(e)}}}function ei(n){let e,r;return e=new at({props:{$$slots:{default:[xl,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ti(n){let e,r=(n[3].class||"Unknown")+"",t,o;return{c(){e=k("p"),t=I(r),o=I(" crossing")},m(l,i){y(l,e,i),_(e,t),_(e,o)},p(l,i){i&8&&r!==(r=(l[3].class||"Unknown")+"")&&oe(t,r)},d(l){l&&A(e)}}}function ni(n){let e,r;return e=new at({props:{$$slots:{default:[ti,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ri(n){let e,r,t,o;return e=new Me({props:{sourceLayer:"crossings",filter:So,paint:{"line-color":on(["get","class"],Object.fromEntries(n[1]),"red"),"line-width":3},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[ei]},$$scope:{ctx:n}}}),e.$on("click",Bn),t=new Ve({props:{sourceLayer:"crossings",filter:zo,paint:{"circle-color":on(["get","class"],Object.fromEntries(n[1]),"red"),"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,10]},layout:{visibility:n[0]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[ni]},$$scope:{ctx:n}}}),t.$on("click",Bn),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment)},m(l,i){B(e,l,i),y(l,r,i),B(t,l,i),o=!0},p(l,i){const a={};i&1&&(a.layout={visibility:l[0]?"visible":"none"}),i&16&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&1&&(s.layout={visibility:l[0]?"visible":"none"}),i&16&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(h(e.$$.fragment,l),h(t.$$.fragment,l),o=!0)},o(l){v(e.$$.fragment,l),v(t.$$.fragment,l),o=!1},d(l){l&&A(r),E(e,l),E(t,l)}}}function oi(n){let e,r,t,o,l;e=new Zr({props:{$$slots:{default:[Yl]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let i=n[0]&&Mn(n);return o=new Xr({props:{url:"pmtiles://https://atip.uk/layers/v1/crossings.pmtiles",$$slots:{default:[ri]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),i&&i.c(),t=L(),M(o.$$.fragment)},m(a,s){B(e,a,s),y(a,r,s),i&&i.m(a,s),y(a,t,s),B(o,a,s),l=!0},p(a,[s]){const c={};s&16&&(c.$$scope={dirty:s,ctx:a}),e.$set(c),a[0]?i?(i.p(a,s),s&1&&h(i,1)):(i=Mn(a),i.c(),h(i,1),i.m(t.parentNode,t)):i&&(ae(),v(i,1,1,()=>{i=null}),ce());const u={};s&17&&(u.$$scope={dirty:s,ctx:a}),o.$set(u)},i(a){l||(h(e.$$.fragment,a),h(i),h(o.$$.fragment,a),l=!0)},o(a){v(e.$$.fragment,a),v(i),v(o.$$.fragment,a),l=!1},d(a){a&&(A(r),A(t)),E(e,a),i&&i.d(a),E(o,a)}}}function Bn(n){window.open(`https://www.openstreetmap.org/${n.detail.features[0].properties.osm}`,"_blank")}function li(n,e,r){let t=!1;return[t,[["Zebra","#66C5CC"],["Parallel","#F6CF71"],["Pelican","#F89C74"],["Puffin","#DCB0F2"],["Toucan","#87C55F"],["Pegasus","#9EB9F3"],["Uncontrolled","#FE88B1"],["Signalised","#C9DB74"],["Unknown","red"]],()=>r(0,t=!t)]}class ii extends le{constructor(e){super(),ie(this,e,li,oi,re,{})}}function si(n){let e,r,t,o,l;return r=new Vl({}),o=new ii({}),{c(){e=k("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),Y(e,"display","flex"),Y(e,"flex-direction","column")},m(i,a){y(i,e,a),B(r,e,null),_(e,t),B(o,e,null),l=!0},p:ee,i(i){l||(h(r.$$.fragment,i),h(o.$$.fragment,i),l=!0)},o(i){v(r.$$.fragment,i),v(o.$$.fragment,i),l=!1},d(i){i&&A(e),E(r),E(o)}}}function ai(n){let e,r;return e=new Go({props:{$$slots:{default:[si]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,[o]){const l={};o&1&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}class ci extends le{constructor(e){super(),ie(this,e,null,ai,re,{})}}const{window:ui}=st;function fi(n){let e;return{c(){e=I("SA10: pedestrian crossing speed")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function di(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m,S,D,g,$;function C(j){n[9](j)}let b={k:"horiz-radio",choices:Ce(),$$slots:{default:[fi]},$$scope:{ctx:n}};return n[1].crossings[n[0]].properties.sa10!==void 0&&(b.value=n[1].crossings[n[0]].properties.sa10),u=new qe({props:b}),fe.push(()=>_e(u,"value",C)),S=new ct({props:{metric:n[3]}}),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("button"),o.textContent="Delete crossing",l=L(),i=k("label"),a=I(`Name:
      `),s=k("input"),c=L(),M(u.$$.fragment),d=L(),p=k("p"),p.textContent=`${n[3].description}`,m=L(),M(S.$$.fragment),F(s,"type","text"),F(e,"slot","sidebar")},m(j,w){y(j,e,w),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(i,a),_(i,s),he(s,n[1].crossings[n[0]].properties.name),_(e,c),B(u,e,null),_(e,d),_(e,p),_(e,m),B(S,e,null),D=!0,g||($=[J(r,"click",n[7]),J(o,"click",n[5]),J(s,"input",n[8])],g=!0)},p(j,w){w&3&&s.value!==j[1].crossings[j[0]].properties.name&&he(s,j[1].crossings[j[0]].properties.name);const z={};w&1024&&(z.$$scope={dirty:w,ctx:j}),!f&&w&3&&(f=!0,z.value=j[1].crossings[j[0]].properties.sa10,ge(()=>f=!1)),u.$set(z)},i(j){D||(h(u.$$.fragment,j),h(S.$$.fragment,j),D=!0)},o(j){v(u.$$.fragment,j),v(S.$$.fragment,j),D=!1},d(j){j&&A(e),E(u),E(S),g=!1,Ae($)}}}function pi(n){let e,r;return e=new tt({props:{filter:["!=",["id"],n[0]],layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":"black"}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function mi(n){let e,r;return{c(){e=k("img"),$t(e.src,r=Yr)||F(e,"src",r),F(e,"alt","")},m(t,o){y(t,e,o)},p:ee,d(t){t&&A(e)}}}function _i(n){let e,r,t,o,l,i,a,s;r=new Je({props:{except:"crossings"}}),o=new ke({props:{data:de(n[1].crossings),generateId:!0,$$slots:{default:[pi]},$$scope:{ctx:n}}});function c(f){n[6](f)}let u={color:n[1].crossings[n[0]].properties.color,$$slots:{default:[mi]},$$scope:{ctx:n}};return n[1].crossings[n[0]].geometry.coordinates!==void 0&&(u.lngLat=n[1].crossings[n[0]].geometry.coordinates),i=new xt({props:u}),fe.push(()=>_e(i,"lngLat",c)),{c(){e=k("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),l=L(),M(i.$$.fragment),F(e,"slot","map")},m(f,d){y(f,e,d),B(r,e,null),_(e,t),B(o,e,null),_(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].crossings)),d&1025&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};d&3&&(m.color=f[1].crossings[f[0]].properties.color),d&1024&&(m.$$scope={dirty:d,ctx:f}),!a&&d&3&&(a=!0,m.lngLat=f[1].crossings[f[0]].geometry.coordinates,ge(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){v(r.$$.fragment,f),v(o.$$.fragment,f),v(i.$$.fragment,f),s=!1},d(f){f&&A(e),E(r),E(o),E(i)}}}function gi(n){let e,r,t,o;return e=new Ie({props:{$$slots:{map:[_i],sidebar:[di]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0,t||(o=J(ui,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function hi(n,e,r){let t,o;te(n,K,p=>r(1,t=p)),te(n,Z,p=>r(2,o=p));let{idx:l}=e,i=Xe.SA10;function a(p){p.key=="Escape"&&X(Z,o={kind:"neutral"},o)}async function s(){window.confirm("Really delete this crossing?")&&(X(Z,o={kind:"neutral"},o),await et(),t.crossings.splice(l,1),K.set(t))}function c(p){n.$$.not_equal(t.crossings[l].geometry.coordinates,p)&&(t.crossings[l].geometry.coordinates=p,K.set(t))}const u=()=>X(Z,o={kind:"neutral"},o);function f(){t.crossings[l].properties.name=this.value,K.set(t)}function d(p){n.$$.not_equal(t.crossings[l].properties.sa10,p)&&(t.crossings[l].properties.sa10=p,K.set(t))}return n.$$set=p=>{"idx"in p&&r(0,l=p.idx)},[l,t,o,i,a,s,c,u,f,d]}class bi extends le{constructor(e){super(),ie(this,e,hi,gi,re,{idx:0})}}let W;const eo=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&eo.decode();let mt=null;function ht(){return(mt===null||mt.byteLength===0)&&(mt=new Uint8Array(W.memory.buffer)),mt}function Be(n,e){return n=n>>>0,eo.decode(ht().subarray(n,n+e))}const Qe=new Array(128).fill(void 0);Qe.push(void 0,null,!0,!1);let bt=Qe.length;function $e(n){bt===Qe.length&&Qe.push(Qe.length+1);const e=bt;return bt=Qe[e],Qe[e]=n,e}function se(n){return Qe[n]}function $i(n){n<132||(Qe[n]=bt,bt=n)}function ot(n){const e=se(n);return $i(n),e}function Qt(n){return n==null}let _t=null;function ki(){return(_t===null||_t.byteLength===0)&&(_t=new Float64Array(W.memory.buffer)),_t}let gt=null;function ue(){return(gt===null||gt.byteLength===0)&&(gt=new Int32Array(W.memory.buffer)),gt}let Ke=0;const Nt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},wi=typeof Nt.encodeInto=="function"?function(n,e){return Nt.encodeInto(n,e)}:function(n,e){const r=Nt.encode(n);return e.set(r),{read:n.length,written:r.length}};function Bt(n,e,r){if(r===void 0){const a=Nt.encode(n),s=e(a.length,1)>>>0;return ht().subarray(s,s+a.length).set(a),Ke=a.length,s}let t=n.length,o=e(t,1)>>>0;const l=ht();let i=0;for(;i<t;i++){const a=n.charCodeAt(i);if(a>127)break;l[o+i]=a}if(i!==t){i!==0&&(n=n.slice(i)),o=r(o,t,t=i+n.length*3,1)>>>0;const a=ht().subarray(o+i,o+t),s=wi(n,a);i+=s.written}return Ke=i,o}function Yt(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let l="[";o>0&&(l+=Yt(n[0]));for(let i=1;i<o;i++)l+=", "+Yt(n[i]);return l+="]",l}const r=/\[object ([^\]]+)\]/.exec(toString.call(n));let t;if(r.length>1)t=r[1];else return toString.call(n);if(t=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:t}function vi(n,e){const r=e(n.length*1,1)>>>0;return ht().set(n,r/1),Ke=n.length,r}function Ht(n,e){try{return n.apply(this,e)}catch(r){W.__wbindgen_exn_store($e(r))}}class Ot{static __wrap(e){e=e>>>0;const r=Object.create(Ot.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();W.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=W.__wbindgen_add_to_stack_pointer(-16),i=vi(e,W.__wbindgen_malloc),a=Ke;W.jsroutesnapper_new(l,i,a);var r=ue()[l/4+0],t=ue()[l/4+1],o=ue()[l/4+2];if(o)throw ot(t);return Ot.__wrap(r)}finally{W.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){W.jsroutesnapper_setRouteConfig(this.__wbg_ptr,$e(e))}setAreaMode(){W.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,r;try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_getConfig(l,this.__wbg_ptr);var t=ue()[l/4+0],o=ue()[l/4+1];return e=t,r=o,Be(t,o)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,r,1)}}toFinalFeature(){try{const t=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=ue()[t/4+0],r=ue()[t/4+1];let o;return e!==0&&(o=Be(e,r).slice(),W.__wbindgen_free(e,r*1)),o}finally{W.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,r;try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var t=ue()[l/4+0],o=ue()[l/4+1];return e=t,r=o,Be(t,o)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,r,1)}}toggleSnapMode(){W.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,r,t){return W.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,r,t)!==0}onClick(){W.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return W.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return W.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){W.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_editExisting(o,this.__wbg_ptr,$e(e));var r=ue()[o/4+0],t=ue()[o/4+1];if(t)throw ot(r)}finally{W.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,r;try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var t=ue()[l/4+0],o=ue()[l/4+1];return e=t,r=o,Be(t,o)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,r,1)}}debugSnappableNodes(){let e,r;try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var t=ue()[l/4+0],o=ue()[l/4+1];return e=t,r=o,Be(t,o)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,r,1)}}routeNameForWaypoints(e){let r,t;try{const u=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,$e(e));var o=ue()[u/4+0],l=ue()[u/4+1],i=ue()[u/4+2],a=ue()[u/4+3],s=o,c=l;if(a)throw s=0,c=0,ot(i);return r=s,t=c,Be(s,c)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(r,t,1)}}addSnappedWaypoint(e,r){W.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,r)}undo(){W.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let r,t;try{const u=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,$e(e));var o=ue()[u/4+0],l=ue()[u/4+1],i=ue()[u/4+2],a=ue()[u/4+3],s=o,c=l;if(a)throw s=0,c=0,ot(i);return r=s,t=c,Be(s,c)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(r,t,1)}}getExtraNodes(e,r){let t,o;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_getExtraNodes(f,this.__wbg_ptr,$e(e),$e(r));var l=ue()[f/4+0],i=ue()[f/4+1],a=ue()[f/4+2],s=ue()[f/4+3],c=l,u=i;if(s)throw c=0,u=0,ot(a);return t=c,o=u,Be(c,u)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(t,o,1)}}}async function yi(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(t){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function Ai(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,r){const t=Be(e,r);return $e(t)},n.wbg.__wbindgen_object_drop_ref=function(e){ot(e)},n.wbg.__wbindgen_error_new=function(e,r){const t=new Error(Be(e,r));return $e(t)},n.wbg.__wbindgen_number_get=function(e,r){const t=se(r),o=typeof t=="number"?t:void 0;ki()[e/8+1]=Qt(o)?0:o,ue()[e/4+0]=!Qt(o)},n.wbg.__wbindgen_is_object=function(e){const r=se(e);return typeof r=="object"&&r!==null},n.wbg.__wbindgen_is_undefined=function(e){return se(e)===void 0},n.wbg.__wbindgen_in=function(e,r){return se(e)in se(r)},n.wbg.__wbindgen_boolean_get=function(e){const r=se(e);return typeof r=="boolean"?r?1:0:2},n.wbg.__wbindgen_jsval_loose_eq=function(e,r){return se(e)==se(r)},n.wbg.__wbindgen_string_get=function(e,r){const t=se(r),o=typeof t=="string"?t:void 0;var l=Qt(o)?0:Bt(o,W.__wbindgen_malloc,W.__wbindgen_realloc),i=Ke;ue()[e/4+1]=i,ue()[e/4+0]=l},n.wbg.__wbg_String_4370c5505c674d30=function(e,r){const t=String(se(r)),o=Bt(t,W.__wbindgen_malloc,W.__wbindgen_realloc),l=Ke;ue()[e/4+1]=l,ue()[e/4+0]=o},n.wbg.__wbindgen_object_clone_ref=function(e){const r=se(e);return $e(r)},n.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,r){const t=se(e)[se(r)];return $e(t)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return $e(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,r){const t=se(r).stack,o=Bt(t,W.__wbindgen_malloc,W.__wbindgen_realloc),l=Ke;ue()[e/4+1]=l,ue()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,r){let t,o;try{t=e,o=r,console.error(Be(e,r))}finally{W.__wbindgen_free(t,o,1)}},n.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(se(e))},n.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(se(e))},n.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(se(e))},n.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(se(e))},n.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(se(e))},n.wbg.__wbg_get_44be0491f933a435=function(e,r){const t=se(e)[r>>>0];return $e(t)},n.wbg.__wbg_length_fff51ee6522a1a18=function(e){return se(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof se(e)=="function"},n.wbg.__wbg_next_526fc47e980da008=function(e){const r=se(e).next;return $e(r)},n.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Ht(function(e){const r=se(e).next();return $e(r)},arguments)},n.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return se(e).done},n.wbg.__wbg_value_1695675138684bd5=function(e){const r=se(e).value;return $e(r)},n.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return $e(Symbol.iterator)},n.wbg.__wbg_get_97b561fb56f034b5=function(){return Ht(function(e,r){const t=Reflect.get(se(e),se(r));return $e(t)},arguments)},n.wbg.__wbg_call_cb65541d95d71282=function(){return Ht(function(e,r){const t=se(e).call(se(r));return $e(t)},arguments)},n.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(se(e))},n.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let r;try{r=se(e)instanceof ArrayBuffer}catch{r=!1}return r},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const r=se(e).buffer;return $e(r)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const r=new Uint8Array(se(e));return $e(r)},n.wbg.__wbg_set_5cf90238115182c3=function(e,r,t){se(e).set(se(r),t>>>0)},n.wbg.__wbg_length_72e2208bbc0efc61=function(e){return se(e).length},n.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let r;try{r=se(e)instanceof Uint8Array}catch{r=!1}return r},n.wbg.__wbindgen_debug_string=function(e,r){const t=Yt(se(r)),o=Bt(t,W.__wbindgen_malloc,W.__wbindgen_realloc),l=Ke;ue()[e/4+1]=l,ue()[e/4+0]=o},n.wbg.__wbindgen_throw=function(e,r){throw new Error(Be(e,r))},n.wbg.__wbindgen_memory=function(){const e=W.memory;return $e(e)},n}function Ci(n,e){return W=n.exports,to.__wbindgen_wasm_module=e,_t=null,gt=null,mt=null,W}async function to(n){if(W!==void 0)return W;typeof n>"u"&&(n="/route-element/assets/route_snapper_bg.wasm");const e=Ai();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:t}=await yi(await n,e);return Ci(r,t)}const ji=30;class Si{constructor(e,r,t,o,l){this.onMouseMove=i=>{if(!this.active)return;const a=[i.point.x-ji,i.point.y],s=this.map.unproject(i.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,s)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let a=i.target.tagName;a=="INPUT"||a=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Ot(r),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersSuccess)r(JSON.parse(e));else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersUpdated)r(JSON.parse(e))}}function zi(n){let e=n[3].road_classification+"",r;return{c(){r=I(e)},m(t,o){y(t,r,o)},p(t,o){o&8&&e!==(e=t[3].road_classification+"")&&oe(r,e)},d(t){t&&A(r)}}}function Li(n){let e,r;return e=new at({props:{openOn:"hover",$$slots:{default:[zi,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Mi(n){let e,r;return e=new Me({props:{layout:{visibility:n[0]?"visible":"none"},paint:{"line-width":3,"line-color":"black"},$$slots:{default:[Li]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),o&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Bi(n){let e,r;return e=new Ve({props:{manageHoverState:!0,layout:{visibility:n[0]?"visible":"none"},paint:{"circle-color":["case",["get","traffic_signals"],"green","black"],"circle-radius":5}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"visible":"none"}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ei(n){let e,r,t,o;return e=new ke({props:{data:n[1].os_links,$$slots:{default:[Mi]},$$scope:{ctx:n}}}),t=new ke({props:{data:n[1].os_nodes,$$slots:{default:[Bi]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment)},m(l,i){B(e,l,i),y(l,r,i),B(t,l,i),o=!0},p(l,[i]){const a={};i&17&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&17&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(h(e.$$.fragment,l),h(t.$$.fragment,l),o=!0)},o(l){v(e.$$.fragment,l),v(t.$$.fragment,l),o=!1},d(l){l&&A(r),E(e,l),E(t,l)}}}function Di(n,e,r){let{showDebug:t}=e;function o(){let i=JSON.parse(Lo());return{os_nodes:JSON.parse(i.os_nodes),os_links:JSON.parse(i.os_links)}}let l=o();return n.$$set=i=>{"showDebug"in i&&r(0,t=i.showDebug)},[t,l]}class Ti extends le{constructor(e){super(),ie(this,e,Di,Ei,re,{showDebug:0})}}function no(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled JAT",color:Ge[n%Ge.length],details:{arms:[],movements:[],notes:""}}}}function ro(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled link",color:Ge[n%Ge.length],answers:Array(Se.length).fill("")}}}let Se=[{name:"Street or path check",description:"Is this on-carriageway or a traffic-free path?",choices:["","Street check","Path check"]},{name:"SA03",description:"lane widths",choices:Ce()},{name:"SA04",description:"trip hazards",choices:Ce()},{name:"SA05",description:"kerbside activity",choices:Ce()},{name:"SA08",description:"motor traffic speed",choices:Ce()},{name:"SA09",description:"motor traffic volume",choices:Ce()},{name:"SA11",description:"footway widths",choices:Ce()},{name:"SA12",description:"effective width next to tram lines",choices:Ce()},{name:"SA13",description:"crossing angle of tram/train rails",choices:Ce()},{name:"SA14",description:"cycling surface and maintenance defects",choices:Ce()},{name:"SA15",description:"WW surface and maintenance defects",choices:Ce()},{name:"SA16",description:"guard railing",choices:Ce()}];function oo(n){return{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{name:"Untitled side road",color:Ge[n%Ge.length],sa01:""}}}let en=Re(null);const Fe=Re([]);async function Ni(n){await Do(),await to();let e="https://assets.od2net.org/route-element",r=n.getBounds();try{let t=await To(e,r.getEast(),r.getNorth(),r.getWest(),r.getSouth());en.set(new Si(n,t,Re(Tt()),Re(!0),Re(0))),Z.set({kind:"draw-route"})}catch(t){window.alert(t)}}function Ii(){try{let n=JSON.parse(Gt(en).inner.calculateRoute(Gt(Fe)));if(!n){window.alert("No route drawn");return}K.update(e=>{for(let r of JSON.parse(Mo(n,n.properties.full_path)).features){let t=ro(e.links.length);t.geometry=r.geometry,t.properties.name=n.properties.route_name,e.links.push(t)}for(let r of JSON.parse(Bo(n.properties.full_path)).features)r.properties=oo(e.side_roads.length).properties,e.side_roads.push(r);for(let r of JSON.parse(Eo(n.properties.full_path)).features)e.jats.push(no(e.jats.length,r.geometry.coordinates));return e}),Z.set({kind:"edit-link",idx:Gt(K).links.length-1})}catch(n){window.alert(`Bug: ${n}`)}Fe.set([]),Z.set({kind:"neutral"})}function En(n,e,r){const t=n.slice();return t[48]=e[r],t[49]=e,t[50]=r,t}function Dn(n,e,r){const t=n.slice();return t[51]=e[r],t[52]=e,t[53]=r,t}function Oi(n){let e;return{c(){e=k("h2"),e.textContent="Drawing a new route"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Fi(n){let e;return{c(){e=k("h2"),e.textContent="Editing a route"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function qi(n){let e,r=n[11].length+"",t,o;return{c(){e=I("Undo ("),t=I(r),o=I(")")},m(l,i){y(l,e,i),y(l,t,i),y(l,o,i)},p(l,i){i[0]&2048&&r!==(r=l[11].length+"")&&oe(t,r)},d(l){l&&(A(e),A(t),A(o))}}}function Pi(n){let e;return{c(){e=I("Undo")},m(r,t){y(r,e,t)},p:ee,d(r){r&&A(e)}}}function Ui(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m,S,D,g,$,C,b,j,w,z,N,q,P,V,T,R,H,G,O,U,me,be,Oe,ut,vt,yt,nt,He,At,ft,dt,pt,Ct;function jt(we,ye){return we[2]?Fi:Oi}let rt=jt(n),Ue=rt(n);function St(we,ye){return we[11].length==0?Pi:qi}let Q=St(n),ne=Q(n);return ft=Wt(n[38][0]),dt=Wt(n[38][1]),{c(){e=k("div"),Ue.c(),r=L(),t=k("button"),o=I("Finish"),i=L(),a=k("button"),ne.c(),c=L(),u=k("button"),u.textContent="Cancel",f=L(),d=k("fieldset"),p=k("label"),m=k("input"),S=I(`
        Snap to roads`),D=L(),g=k("label"),$=k("input"),C=I(`
        Draw anywhere`),b=L(),j=k("fieldset"),w=k("label"),z=k("input"),N=I(`
        Extend from start (
        `),q=k("b"),q.textContent="1",P=I(`
        )`),V=L(),T=k("label"),R=k("input"),H=I(`
        Extend from end (
        `),G=k("b"),G.textContent="2",O=I(`
        )`),U=L(),me=k("label"),be=k("input"),Oe=I(`
        Adjust middle points (
        `),ut=k("b"),ut.textContent="3",vt=I(`
        )`),yt=L(),nt=k("label"),He=k("input"),At=I(`
      Debug the network`),t.disabled=l=n[7].length<2,F(a,"class","secondary"),a.disabled=s=n[11].length==0,F(u,"class","secondary"),F(m,"type","radio"),m.__value="snap",he(m,m.__value),F($,"type","radio"),$.__value="free",he($,$.__value),F(z,"type","radio"),z.__value="append-start",he(z,z.__value),F(R,"type","radio"),R.__value="append-end",he(R,R.__value),F(be,"type","radio"),be.__value="adjust",he(be,be.__value),F(He,"type","checkbox"),F(e,"slot","sidebar"),ft.p(z,R,be),dt.p(m,$)},m(we,ye){y(we,e,ye),Ue.m(e,null),_(e,r),_(e,t),_(t,o),_(e,i),_(e,a),ne.m(a,null),_(e,c),_(e,u),_(e,f),_(e,d),_(d,p),_(p,m),m.checked=m.__value===n[10],_(p,S),_(d,D),_(d,g),_(g,$),$.checked=$.__value===n[10],_(g,C),_(e,b),_(e,j),_(j,w),_(w,z),z.checked=z.__value===n[3],_(w,N),_(w,q),_(w,P),_(j,V),_(j,T),_(T,R),R.checked=R.__value===n[3],_(T,H),_(T,G),_(T,O),_(j,U),_(j,me),_(me,be),be.checked=be.__value===n[3],_(me,Oe),_(me,ut),_(me,vt),_(e,yt),_(e,nt),_(nt,He),He.checked=n[9],_(nt,At),pt||(Ct=[J(t,"click",function(){Zt(n[0])&&n[0].apply(this,arguments)}),J(a,"click",n[14]),J(u,"click",function(){Zt(n[1])&&n[1].apply(this,arguments)}),J(m,"change",n[37]),J(m,"change",n[15]),J($,"change",n[39]),J($,"change",n[15]),J(z,"change",n[40]),J(R,"change",n[41]),J(be,"change",n[42]),J(He,"change",n[43])],pt=!0)},p(we,ye){n=we,rt!==(rt=jt(n))&&(Ue.d(1),Ue=rt(n),Ue&&(Ue.c(),Ue.m(e,r))),ye[0]&128&&l!==(l=n[7].length<2)&&(t.disabled=l),Q===(Q=St(n))&&ne?ne.p(n,ye):(ne.d(1),ne=Q(n),ne&&(ne.c(),ne.m(a,null))),ye[0]&2048&&s!==(s=n[11].length==0)&&(a.disabled=s),ye[0]&1024&&(m.checked=m.__value===n[10]),ye[0]&1024&&($.checked=$.__value===n[10]),ye[0]&8&&(z.checked=z.__value===n[3]),ye[0]&8&&(R.checked=R.__value===n[3]),ye[0]&8&&(be.checked=be.__value===n[3]),ye[0]&512&&(He.checked=n[9])},d(we){we&&A(e),Ue.d(),ne.d(),ft.r(),dt.r(),pt=!1,Ae(Ct)}}}function Ri(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-1cj4rwq"),ve(e,"snapped-node",n[51].snapped),ve(e,"free-node",!n[51].snapped),ve(e,"hide",n[6])},m(r,t){y(r,e,t)},p(r,t){t[0]&4096&&ve(e,"snapped-node",r[51].snapped),t[0]&4096&&ve(e,"free-node",!r[51].snapped),t[0]&64&&ve(e,"hide",r[6])},d(r){r&&A(e)}}}function Tn(n){let e,r,t;function o(s){n[28](s,n[51])}function l(){return n[29](n[51])}function i(){return n[30](n[51])}let a={draggable:!0,zIndex:0,$$slots:{default:[Ri]},$$scope:{ctx:n}};return n[51].point!==void 0&&(a.lngLat=n[51].point),e=new Ze({props:a}),fe.push(()=>_e(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",n[23]),{c(){M(e.$$.fragment)},m(s,c){B(e,s,c),t=!0},p(s,c){n=s;const u={};c[0]&4160|c[1]&8388608&&(u.$$scope={dirty:c,ctx:n}),!r&&c[0]&4096&&(r=!0,u.lngLat=n[51].point,ge(()=>r=!1)),e.$set(u)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){v(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function Gi(n){let e;return{c(){e=k("span"),e.textContent=`${n[50]+1}`,F(e,"class","dot svelte-1cj4rwq"),ve(e,"snapped",n[48].snapped)},m(r,t){y(r,e,t)},p(r,t){t[0]&128&&ve(e,"snapped",r[48].snapped)},d(r){r&&A(e)}}}function Nn(n){let e,r,t;function o(s){n[31](s,n[48])}function l(){return n[32](n[50])}function i(){return n[33](n[50])}let a={draggable:!0,zIndex:1,$$slots:{default:[Gi]},$$scope:{ctx:n}};return n[48].point!==void 0&&(a.lngLat=n[48].point),e=new Ze({props:a}),fe.push(()=>_e(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",n[34]),e.$on("mouseleave",n[35]),e.$on("dragstart",n[25]),e.$on("dragend",n[36]),{c(){M(e.$$.fragment)},m(s,c){B(e,s,c),t=!0},p(s,c){n=s;const u={};c[0]&128|c[1]&8388608&&(u.$$scope={dirty:c,ctx:n}),!r&&c[0]&128&&(r=!0,u.lngLat=n[48].point,ge(()=>r=!1)),e.$set(u)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){v(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function Ji(n){let e,r;return e=new Me({props:{paint:{"line-color":"black","line-width":10}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Qi(n){let e,r;return e=new Me({props:{paint:{"line-color":"black","line-width":3}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Hi(n){let e,r,t,o,l,i,a,s,c,u,f;r=new Pt({}),r.$on("click",n[16]),r.$on("mousemove",n[17]),o=new Ti({props:{showDebug:n[9]}});let d=x(n[12]),p=[];for(let $=0;$<d.length;$+=1)p[$]=Tn(Dn(n,d,$));const m=$=>v(p[$],1,1,()=>{p[$]=null});let S=x(n[7]),D=[];for(let $=0;$<S.length;$+=1)D[$]=Nn(En(n,S,$));const g=$=>v(D[$],1,1,()=>{D[$]=null});return s=new ke({props:{data:n[20](n[8],n[7]),generateId:!0,$$slots:{default:[Ji]},$$scope:{ctx:n}}}),u=new ke({props:{data:n[13],$$slots:{default:[Qi]},$$scope:{ctx:n}}}),{c(){e=k("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),l=L();for(let $=0;$<p.length;$+=1)p[$].c();i=L();for(let $=0;$<D.length;$+=1)D[$].c();a=L(),M(s.$$.fragment),c=L(),M(u.$$.fragment),F(e,"slot","map")},m($,C){y($,e,C),B(r,e,null),_(e,t),B(o,e,null),_(e,l);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(e,null);_(e,i);for(let b=0;b<D.length;b+=1)D[b]&&D[b].m(e,null);_(e,a),B(s,e,null),_(e,c),B(u,e,null),f=!0},p($,C){const b={};if(C[0]&512&&(b.showDebug=$[9]),o.$set(b),C[0]&14684224){d=x($[12]);let z;for(z=0;z<d.length;z+=1){const N=Dn($,d,z);p[z]?(p[z].p(N,C),h(p[z],1)):(p[z]=Tn(N),p[z].c(),h(p[z],1),p[z].m(e,i))}for(ae(),z=d.length;z<p.length;z+=1)m(z);ce()}if(C[0]&34341040){S=x($[7]);let z;for(z=0;z<S.length;z+=1){const N=En($,S,z);D[z]?(D[z].p(N,C),h(D[z],1)):(D[z]=Nn(N),D[z].c(),h(D[z],1),D[z].m(e,a))}for(ae(),z=S.length;z<D.length;z+=1)g(z);ce()}const j={};C[0]&384&&(j.data=$[20]($[8],$[7])),C[1]&8388608&&(j.$$scope={dirty:C,ctx:$}),s.$set(j);const w={};C[0]&8192&&(w.data=$[13]),C[1]&8388608&&(w.$$scope={dirty:C,ctx:$}),u.$set(w)},i($){if(!f){h(r.$$.fragment,$),h(o.$$.fragment,$);for(let C=0;C<d.length;C+=1)h(p[C]);for(let C=0;C<S.length;C+=1)h(D[C]);h(s.$$.fragment,$),h(u.$$.fragment,$),f=!0}},o($){v(r.$$.fragment,$),v(o.$$.fragment,$),p=p.filter(Boolean);for(let C=0;C<p.length;C+=1)v(p[C]);D=D.filter(Boolean);for(let C=0;C<D.length;C+=1)v(D[C]);v(s.$$.fragment,$),v(u.$$.fragment,$),f=!1},d($){$&&A(e),E(r),E(o),pe(p,$),pe(D,$),E(s),E(u)}}}function Ki(n){let e,r,t,o;return e=new Ie({props:{$$slots:{map:[Hi],sidebar:[Ui]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0,t||(o=J(window,"keydown",n[24]),t=!0)},p(l,i){const a={};i[0]&16383|i[1]&8388608&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function Wi(n,e,r){let t,o,l;te(n,Fe,Q=>r(7,o=Q)),te(n,en,Q=>r(8,l=Q));let{map:i}=e,{finish:a}=e,{cancel:s}=e,{editingExisting:c}=e;qt(()=>{X(Fe,o=[],o),l==null||l.stop(),i.getCanvas().style.cursor="inherit"});let u=!0,f=c?"adjust":"append-end",d="snap",p=[],m=[],S=null,D=!1,g=!1,$=!1;function C(Q){let ne=Q.length==0?"crosshair":"inherit";i.getCanvas().style.cursor=ne}function b(){let Q=p.pop();r(11,p),Q&&X(Fe,o=Q,o)}function j(){p.length==100&&p.shift(),r(11,p=[...p,JSON.parse(JSON.stringify(o))])}function w(){r(10,d=d=="snap"?"free":"snap"),S&&r(27,S.snapped=d=="snap",S)}function z(Q){j(),Fe.update(ne=>(f=="append-start"?ne.splice(0,0,{point:Q.detail.lngLat.toArray(),snapped:d=="snap"}):f=="append-end"&&ne.push({point:Q.detail.lngLat.toArray(),snapped:d=="snap"}),ne))}function N(Q){r(27,S={point:Q.detail.lngLat.toArray(),snapped:d=="snap"})}function q(Q){j(),Fe.update(ne=>(ne[Q].snapped=!ne[Q].snapped,ne))}function P(Q){j(),Fe.update(ne=>(ne.splice(Q,1),ne)),r(4,D=!1)}function V(Q,ne){try{if(Q)return JSON.parse(Q.inner.calculateRoute(ne))}catch{}return Tt()}function T(Q,ne,we,ye,zt){if(zt)return Tt();try{if(Q&&ne.length>0&&ye){if(we=="append-start")return JSON.parse(Q.inner.calculateRoute([ye,ne[0]]));if(we=="append-end")return JSON.parse(Q.inner.calculateRoute([ne[ne.length-1],ye]))}}catch{}return Tt()}function R(Q,ne,we,ye){if(ye)return;if(!Q||we!="adjust"){r(12,m=[]);return}let zt=[],Rt=1;for(let Lt=0;Lt<ne.length-1;Lt++){let co=JSON.parse(Q.inner.getExtraNodes(ne[Lt],ne[Lt+1]));for(let[uo,fo,po]of co)zt.push({point:[uo,fo],snapped:po,insertIdx:Rt});Rt++}r(12,m=zt)}function H(Q){j(),Fe.update(ne=>(ne.splice(Q.insertIdx,0,{point:Q.point,snapped:Q.snapped}),ne)),r(6,$=!0)}function G(Q){Fe.update(ne=>(ne[Q.insertIdx].point=Q.point,ne))}function O(){r(6,$=!1)}function U(Q){let ne=Q.target.tagName,we=ne=="INPUT"||ne=="TEXTAREA";Q.key==="Enter"&&!we?(Q.stopPropagation(),o.length>=2&&a()):Q.key==="Escape"?(Q.stopPropagation(),s()):Q.key=="s"&&!we?w():Q.key=="1"&&!we?r(3,f="append-start"):Q.key=="2"&&!we?r(3,f="append-end"):Q.key=="3"&&!we?r(3,f="adjust"):Q.key=="z"&&Q.ctrlKey&&(Q.stopPropagation(),b())}function me(){j(),r(5,g=!0)}const be=[[],[]];function Oe(Q,ne){n.$$.not_equal(ne.point,Q)&&(ne.point=Q,r(12,m))}const ut=Q=>H(Q),vt=Q=>G(Q);function yt(Q,ne){n.$$.not_equal(ne.point,Q)&&(ne.point=Q,Fe.set(o))}const nt=Q=>q(Q),He=Q=>P(Q),At=()=>r(4,D=!0),ft=()=>r(4,D=!1),dt=()=>r(5,g=!1);function pt(){d=this.__value,r(10,d)}function Ct(){d=this.__value,r(10,d)}function jt(){f=this.__value,r(3,f)}function rt(){f=this.__value,r(3,f)}function Ue(){f=this.__value,r(3,f)}function St(){u=this.checked,r(9,u)}return n.$$set=Q=>{"map"in Q&&r(26,i=Q.map),"finish"in Q&&r(0,a=Q.finish),"cancel"in Q&&r(1,s=Q.cancel),"editingExisting"in Q&&r(2,c=Q.editingExisting)},n.$$.update=()=>{n.$$.dirty[0]&456&&R(l,o,f,$),n.$$.dirty[0]&134218168&&r(13,t=T(l,o,f,S,D||g)),n.$$.dirty[0]&128&&C(o)},[a,s,c,f,D,g,$,o,l,u,d,p,m,t,b,w,z,N,q,P,V,H,G,O,U,me,i,S,Oe,ut,vt,yt,nt,He,At,ft,dt,pt,be,Ct,jt,rt,Ue,St]}class Zi extends le{constructor(e){super(),ie(this,e,Wi,Ki,re,{map:26,finish:0,cancel:1,editingExisting:2},null,[-1,-1])}}let In="MZEJTanw3WpxRvt7qDfo";async function Xi(n){return n?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[`https://tile.googleapis.com/v1/2dtiles/{z}/{x}/{y}?session=${await Vi(n)}&key=${n}`],tileSize:256,attribution:"Google (detailed attributions not wired up)"}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${In}`}:`https://api.maptiler.com/maps/dataviz/style.json?key=${In}`}async function Vi(n){try{let r=await(await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify({mapType:"satellite",language:"en-GB",region:"GB",layerTypes:["layerRoadmap"],overlay:!1})})).json();return"session"in r?r.session:(console.error(`Couldn't get Google tile session key: ${JSON.stringify(r)}`),"")}catch(e){return console.error(`Couldn't get Google tile session key: ${e}`),""}}const Yi="/route-element/assets/right-arrow-d8c7892c.svg";function On(n){let e,r;const t=n[4].default,o=Ee(t,n,n[3],null);return{c(){e=k("div"),o&&o.c(),F(e,"class","section svelte-zax3q3")},m(l,i){y(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&8)&&De(o,t,l,l[3],r?Ne(t,l[3],i,null):Te(l[3]),null)},i(l){r||(h(o,l),r=!0)},o(l){v(o,l),r=!1},d(l){l&&A(e),o&&o.d(l)}}}function xi(n){let e,r,t,o,l,i,a,s,c,u,f,d,p=n[2]&&On(n);return{c(){e=k("button"),r=k("div"),t=k("span"),o=I(n[0]),l=L(),i=k("img"),c=L(),p&&p.c(),F(i,"class","arrow svelte-zax3q3"),$t(i.src,a=Yi)||F(i,"src",a),F(i,"alt",s="Select "+n[0]),F(r,"class","top-section section svelte-zax3q3"),ve(r,"bordered",n[2]),F(e,"class","clickable-card svelte-zax3q3"),e.disabled=n[1]},m(m,S){y(m,e,S),_(e,r),_(r,t),_(t,o),_(r,l),_(r,i),_(e,c),p&&p.m(e,null),u=!0,f||(d=[J(e,"click",n[5]),J(e,"mouseenter",n[6]),J(e,"mouseleave",n[7])],f=!0)},p(m,[S]){(!u||S&1)&&oe(o,m[0]),(!u||S&1&&s!==(s="Select "+m[0]))&&F(i,"alt",s),(!u||S&4)&&ve(r,"bordered",m[2]),m[2]?p?(p.p(m,S),S&4&&h(p,1)):(p=On(m),p.c(),h(p,1),p.m(e,null)):p&&(ae(),v(p,1,1,()=>{p=null}),ce()),(!u||S&2)&&(e.disabled=m[1])},i(m){u||(h(p),u=!0)},o(m){v(p),u=!1},d(m){m&&A(e),p&&p.d(),f=!1,Ae(d)}}}function es(n,e,r){let{$$slots:t={},$$scope:o}=e,{name:l}=e,{disabled:i=!1}=e,{hasSlot:a=!0}=e;function s(f){je.call(this,n,f)}function c(f){je.call(this,n,f)}function u(f){je.call(this,n,f)}return n.$$set=f=>{"name"in f&&r(0,l=f.name),"disabled"in f&&r(1,i=f.disabled),"hasSlot"in f&&r(2,a=f.hasSlot),"$$scope"in f&&r(3,o=f.$$scope)},[l,i,a,o,t,s,c,u]}class lo extends le{constructor(e){super(),ie(this,e,es,xi,re,{name:0,disabled:1,hasSlot:2})}}let We={critical:{background:"#232323",font:"white"},red:{background:"#b73d25",font:"white"},amber:{background:"#ffd833",font:"black"},green:{background:"#006853",font:"white"},notApplicable:{background:"white",font:"black"}};const lt={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},io=Object.keys(lt);function Ft(n){return Object.keys(lt[n])}const xe="All movements";function Fn(n,e){let r=[],t=lt[n][e];t&&r.push({junctionType:n,movementType:e,...t});let o=lt[n][xe];if(o&&e!=xe&&r.push({junctionType:n,movementType:xe,...o}),n=="Crossroads"){let l=lt["Simple priority T-junction"][xe];l&&r.push({junctionType:"Simple priority T-junction",movementType:xe,...l})}if(n!="Any type of junction"){let l=lt["Any type of junction"][xe];l&&r.push({junctionType:"Any type of junction",movementType:xe,...l})}return r}function qn(n,e,r){const t=n.slice();return t[9]=e[r],t}function Pn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Un(n,e,r){const t=n.slice();return t[12]=e[r],t}function Rn(n,e,r){const t=n.slice();return t[12]=e[r],t}function Gn(n){let e,r;return e=new Ut({props:{$$slots:{default:[rs]},$$scope:{ctx:n}}}),e.$on("close",n[8]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&524295&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ts(n){let e;return{c(){e=I("Type of junction")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function ns(n){let e;return{c(){e=I("Type of movement")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Jn(n){let e,r,t;function o(i){n[6](i)}let l={k:"vert-radio",choices:Ft(n[1]),$$slots:{default:[ns]},$$scope:{ctx:n}};return n[2]!==void 0&&(l.value=n[2]),e=new qe({props:l}),fe.push(()=>_e(e,"value",o)),{c(){M(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,a){const s={};a&2&&(s.choices=Ft(i[1])),a&524288&&(s.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,s.value=i[2],ge(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){v(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Qn(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=I(r)},m(o,l){y(o,e,l),_(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&oe(t,r)},d(o){o&&A(e)}}}function Hn(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=I(r)},m(o,l){y(o,e,l),_(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&oe(t,r)},d(o){o&&A(e)}}}function Kn(n){let e,r=n[12]+"",t;return{c(){e=k("li"),t=I(r)},m(o,l){y(o,e,l),_(e,t)},p(o,l){l&6&&r!==(r=o[12]+"")&&oe(t,r)},d(o){o&&A(e)}}}function Wn(n){let e,r,t=n[9].junctionType+"",o,l,i,a,s,c,u=n[9].movementType+"",f,d,p,m,S,D,g,$,C,b,j,w=x(n[9].scoreZero),z=[];for(let T=0;T<w.length;T+=1)z[T]=Qn(Rn(n,w,T));let N=x(n[9].scoreOne),q=[];for(let T=0;T<N.length;T+=1)q[T]=Hn(Un(n,N,T));let P=x(n[9].scoreTwo),V=[];for(let T=0;T<P.length;T+=1)V[T]=Kn(Pn(n,P,T));return{c(){e=k("tr"),r=k("td"),o=I(t),l=L(),i=k("br"),a=L(),s=k("br"),c=L(),f=I(u),d=L(),p=k("td"),m=k("ul");for(let T=0;T<z.length;T+=1)z[T].c();S=L(),D=k("td"),g=k("ul");for(let T=0;T<q.length;T+=1)q[T].c();$=L(),C=k("td"),b=k("ul");for(let T=0;T<V.length;T+=1)V[T].c();j=L(),F(r,"class","type-row svelte-k4kgn3"),F(p,"class","score-zero svelte-k4kgn3"),F(D,"class","score-one svelte-k4kgn3"),F(C,"class","score-two svelte-k4kgn3")},m(T,R){y(T,e,R),_(e,r),_(r,o),_(r,l),_(r,i),_(r,a),_(r,s),_(r,c),_(r,f),_(e,d),_(e,p),_(p,m);for(let H=0;H<z.length;H+=1)z[H]&&z[H].m(m,null);_(e,S),_(e,D),_(D,g);for(let H=0;H<q.length;H+=1)q[H]&&q[H].m(g,null);_(e,$),_(e,C),_(C,b);for(let H=0;H<V.length;H+=1)V[H]&&V[H].m(b,null);_(e,j)},p(T,R){if(R&6&&t!==(t=T[9].junctionType+"")&&oe(o,t),R&6&&u!==(u=T[9].movementType+"")&&oe(f,u),R&6){w=x(T[9].scoreZero);let H;for(H=0;H<w.length;H+=1){const G=Rn(T,w,H);z[H]?z[H].p(G,R):(z[H]=Qn(G),z[H].c(),z[H].m(m,null))}for(;H<z.length;H+=1)z[H].d(1);z.length=w.length}if(R&6){N=x(T[9].scoreOne);let H;for(H=0;H<N.length;H+=1){const G=Un(T,N,H);q[H]?q[H].p(G,R):(q[H]=Hn(G),q[H].c(),q[H].m(g,null))}for(;H<q.length;H+=1)q[H].d(1);q.length=N.length}if(R&6){P=x(T[9].scoreTwo);let H;for(H=0;H<P.length;H+=1){const G=Pn(T,P,H);V[H]?V[H].p(G,R):(V[H]=Kn(G),V[H].c(),V[H].m(b,null))}for(;H<V.length;H+=1)V[H].d(1);V.length=P.length}},d(T){T&&A(e),pe(z,T),pe(q,T),pe(V,T)}}}function rs(n){let e,r,t,o,l,i,a,s,c=n[1],u,f,d,p,m,S,D,g,$;function C(N){n[5](N)}let b={k:"vert-radio",choices:io,$$slots:{default:[ts]},$$scope:{ctx:n}};n[1]!==void 0&&(b.value=n[1]),i=new qe({props:b}),fe.push(()=>_e(i,"value",C)),i.$on("change",n[3]);let j=Jn(n),w=x(Fn(n[1],n[2])),z=[];for(let N=0;N<w.length;N+=1)z[N]=Wn(qn(n,w,N));return{c(){e=k("h1"),e.textContent="LTN 1/20 scoring guidance",r=L(),t=k("p"),t.innerHTML=`Guidance from <a target="_blank" href="https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf">LTN 1/20 appendix B</a>
      .`,o=L(),l=k("div"),M(i.$$.fragment),s=L(),j.c(),u=L(),f=k("table"),d=k("tr"),d.innerHTML=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
            some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
            types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
            problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
            management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
            standard of safety for cyclists</p></th>`,p=L();for(let N=0;N<z.length;N+=1)z[N].c();m=L(),S=k("button"),S.textContent="OK",Y(l,"display","flex"),Y(l,"justify-content","space-between")},m(N,q){y(N,e,q),y(N,r,q),y(N,t,q),y(N,o,q),y(N,l,q),B(i,l,null),_(l,s),j.m(l,null),y(N,u,q),y(N,f,q),_(f,d),_(f,p);for(let P=0;P<z.length;P+=1)z[P]&&z[P].m(f,null);y(N,m,q),y(N,S,q),D=!0,g||($=J(S,"click",n[7]),g=!0)},p(N,q){const P={};if(q&524288&&(P.$$scope={dirty:q,ctx:N}),!a&&q&2&&(a=!0,P.value=N[1],ge(()=>a=!1)),i.$set(P),q&2&&re(c,c=N[1])?(ae(),v(j,1,1,ee),ce(),j=Jn(N),j.c(),h(j,1),j.m(l,null)):j.p(N,q),q&6){w=x(Fn(N[1],N[2]));let V;for(V=0;V<w.length;V+=1){const T=qn(N,w,V);z[V]?z[V].p(T,q):(z[V]=Wn(T),z[V].c(),z[V].m(f,null))}for(;V<z.length;V+=1)z[V].d(1);z.length=w.length}},i(N){D||(h(i.$$.fragment,N),h(j),D=!0)},o(N){v(i.$$.fragment,N),v(j),D=!1},d(N){N&&(A(e),A(r),A(t),A(o),A(l),A(u),A(f),A(m),A(S)),E(i),j.d(N),pe(z,N),g=!1,$()}}}function os(n){let e,r,t,o,l,i,a=n[0]&&Gn(n);return{c(){e=k("button"),e.textContent="LTN 1/20 scoring guidance",r=L(),a&&a.c(),t=Pe(),F(e,"class","secondary")},m(s,c){y(s,e,c),y(s,r,c),a&&a.m(s,c),y(s,t,c),o=!0,l||(i=J(e,"click",n[4]),l=!0)},p(s,[c]){s[0]?a?(a.p(s,c),c&1&&h(a,1)):(a=Gn(s),a.c(),h(a,1),a.m(t.parentNode,t)):a&&(ae(),v(a,1,1,()=>{a=null}),ce())},i(s){o||(h(a),o=!0)},o(s){v(a),o=!1},d(s){s&&(A(e),A(r),A(t)),a&&a.d(s),l=!1,i()}}}function ls(n,e,r){let t=!1,o=io[0],l=Ft(o)[0];function i(){r(2,l=Ft(o)[0])}const a=()=>r(0,t=!0);function s(d){o=d,r(1,o)}function c(d){l=d,r(2,l)}return[t,o,l,i,a,s,c,()=>r(0,t=!1),()=>r(0,t=!1)]}class is extends le{constructor(e){super(),ie(this,e,ls,os,re,{})}}function ss(n){let e;return{c(){e=I("User")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Zn(n){let e,r;return e=new is({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function as(n){let e;return{c(){e=I("Score")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function cs(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m,S,D,g;function $(z){n[5](z)}let C={k:"horiz-radio",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]],$$slots:{default:[ss]},$$scope:{ctx:n}};n[2].jats[n[0]].properties.details.movements[n[1]].kind!==void 0&&(C.value=n[2].jats[n[0]].properties.details.movements[n[1]].kind),l=new qe({props:C}),fe.push(()=>_e(l,"value",$));let b=n[2].jats[n[0]].properties.details.movements[n[1]].kind=="cycling"&&Zn();function j(z){n[6](z)}let w={k:"horiz-radio",choices:n[3],$$slots:{default:[as]},$$scope:{ctx:n}};return n[2].jats[n[0]].properties.details.movements[n[1]].score!==void 0&&(w.value=n[2].jats[n[0]].properties.details.movements[n[1]].score),c=new qe({props:w}),fe.push(()=>_e(c,"value",j)),{c(){e=k("label"),r=I(`Name
  `),t=k("input"),o=L(),M(l.$$.fragment),a=L(),b&&b.c(),s=L(),M(c.$$.fragment),f=L(),d=k("label"),p=I(`Comments
  `),m=k("textarea"),F(t,"type","text")},m(z,N){y(z,e,N),_(e,r),_(e,t),he(t,n[2].jats[n[0]].properties.details.movements[n[1]].name),y(z,o,N),B(l,z,N),y(z,a,N),b&&b.m(z,N),y(z,s,N),B(c,z,N),y(z,f,N),y(z,d,N),_(d,p),_(d,m),he(m,n[2].jats[n[0]].properties.details.movements[n[1]].notes),S=!0,D||(g=[J(t,"input",n[4]),J(m,"input",n[7])],D=!0)},p(z,[N]){N&7&&t.value!==z[2].jats[z[0]].properties.details.movements[z[1]].name&&he(t,z[2].jats[z[0]].properties.details.movements[z[1]].name);const q={};N&256&&(q.$$scope={dirty:N,ctx:z}),!i&&N&7&&(i=!0,q.value=z[2].jats[z[0]].properties.details.movements[z[1]].kind,ge(()=>i=!1)),l.$set(q),z[2].jats[z[0]].properties.details.movements[z[1]].kind=="cycling"?b?N&7&&h(b,1):(b=Zn(),b.c(),h(b,1),b.m(s.parentNode,s)):b&&(ae(),v(b,1,1,()=>{b=null}),ce());const P={};N&256&&(P.$$scope={dirty:N,ctx:z}),!u&&N&7&&(u=!0,P.value=z[2].jats[z[0]].properties.details.movements[z[1]].score,ge(()=>u=!1)),c.$set(P),N&7&&he(m,z[2].jats[z[0]].properties.details.movements[z[1]].notes)},i(z){S||(h(l.$$.fragment,z),h(b),h(c.$$.fragment,z),S=!0)},o(z){v(l.$$.fragment,z),v(b),v(c.$$.fragment,z),S=!1},d(z){z&&(A(e),A(o),A(a),A(s),A(f),A(d)),E(l,z),b&&b.d(z),E(c,z),D=!1,Ae(g)}}}function us(n,e,r){let t;te(n,K,f=>r(2,t=f));let{junctionIdx:o}=e,{idx:l}=e,i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function a(){t.jats[o].properties.details.movements[l].name=this.value,K.set(t)}function s(f){n.$$.not_equal(t.jats[o].properties.details.movements[l].kind,f)&&(t.jats[o].properties.details.movements[l].kind=f,K.set(t))}function c(f){n.$$.not_equal(t.jats[o].properties.details.movements[l].score,f)&&(t.jats[o].properties.details.movements[l].score=f,K.set(t))}function u(){t.jats[o].properties.details.movements[l].notes=this.value,K.set(t)}return n.$$set=f=>{"junctionIdx"in f&&r(0,o=f.junctionIdx),"idx"in f&&r(1,l=f.idx)},[o,l,t,i,a,s,c,u]}class fs extends le{constructor(e){super(),ie(this,e,us,cs,re,{junctionIdx:0,idx:1})}}function ds(n){return n%(2*Math.PI)*180/Math.PI}function Et(n){return n%360*Math.PI/180}function Xn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function so(n,e,r={}){if(r.final===!0)return ps(n,e);const t=Xn(n),o=Xn(e),l=Et(t[0]),i=Et(o[0]),a=Et(t[1]),s=Et(o[1]),c=Math.sin(i-l)*Math.cos(s),u=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return ds(Math.atan2(c,u))}function ps(n,e){let r=so(e,n);return r=(r+180)%360,r}var it=so;function ms(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function _s(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Vn(n[0])||!Vn(n[1]))throw new Error("coordinates must contain numbers");return ms({type:"Point",coordinates:n},e,r)}function Vn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function gs(n,e={}){const r=No(n),t=(r[0]+r[2])/2,o=(r[1]+r[3])/2;return _s([t,o],e.properties,e)}var hs=gs,ze=63710088e-1,bs={centimeters:ze*100,centimetres:ze*100,degrees:360/(2*Math.PI),feet:ze*3.28084,inches:ze*39.37,kilometers:ze/1e3,kilometres:ze/1e3,meters:ze,metres:ze,miles:ze/1609.344,millimeters:ze*1e3,millimetres:ze*1e3,nauticalmiles:ze/1852,radians:1,yards:ze*1.0936};function $s(n,e,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function ks(n,e,r={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!xn(n[0])||!xn(n[1]))throw new Error("coordinates must contain numbers");return $s({type:"Point",coordinates:n},e,r)}function ws(n,e="kilometers"){const r=bs[e];if(!r)throw new Error(e+" units is invalid");return n/r}function Yn(n){return n%(2*Math.PI)*180/Math.PI}function Kt(n){return n%360*Math.PI/180}function xn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function vs(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ys(n,e,r,t={}){const o=vs(n),l=Kt(o[0]),i=Kt(o[1]),a=Kt(r),s=ws(e,t.units),c=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),u=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(c)),f=Yn(u),d=Yn(c);return ks([f,d],t.properties)}var wt=ys,Le=63710088e-1,As={centimeters:Le*100,centimetres:Le*100,degrees:360/(2*Math.PI),feet:Le*3.28084,inches:Le*39.37,kilometers:Le/1e3,kilometres:Le/1e3,meters:Le,metres:Le,miles:Le/1609.344,millimeters:Le*1e3,millimetres:Le*1e3,nauticalmiles:Le/1852,radians:1,yards:Le*1.0936};function Cs(n,e="kilometers"){const r=As[e];if(!r)throw new Error(e+" units is invalid");return n*r}function Dt(n){return n%360*Math.PI/180}function er(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function js(n,e,r={}){var t=er(n),o=er(e),l=Dt(o[1]-t[1]),i=Dt(o[0]-t[0]),a=Dt(t[1]),s=Dt(o[1]),c=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return Cs(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),r.units)}var Ss=js;function zs(n){let e=hs({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,o)=>tr(it(e,o.point))-tr(it(e,t.point)));let r=[];for(let t=0;t<n.length;t++){let o=n[t],l=it(o.point,e),i=1;for(let a of Ms(t,n.length)){let s=n[a],c=it(e,s.point),u=Ls(o.point,e,i++),f=Ss(o.point,e),d=wt(u,.5*f,l).geometry.coordinates,p=wt(d,.2*f,c).geometry.coordinates;r.push({point1:u,point2:d,point3:p,kind:"cycling",score:"X",name:`${o.name} to ${s.name}`,notes:""})}}return r}function Ls(n,e,r){let t=.003,l=it(n,e)-90,i=t*r;return wt(n,i,l).geometry.coordinates}function tr(n){return(n+360)%360}function Ms(n,e){let r=[];for(let t=n+1;t<e;t++)r.push(t);for(let t=0;t<n;t++)r.push(t);return r}const Bs="/route-element/assets/movement-aa45473c.svg",Es="/route-element/assets/pan-fbcec4cd.svg";function nr(n,e,r){const t=n.slice();return t[30]=e[r],t[31]=e,t[32]=r,t}function rr(n,e,r){const t=n.slice();return t[33]=e[r],t[34]=e,t[32]=r,t}function or(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m,S,D,g,$,C;function b(R,H){return R[0].mode=="select"?Ts:Ds}let j=b(n),w=j(n);function z(R,H){return R[0].mode=="new-arm"?Is:Ns}let N=z(n),q=N(n);function P(R,H){return R[0].mode=="new-movement"?Fs:Os}let V=P(n),T=V(n);return{c(){e=k("div"),r=k("button"),t=k("img"),l=L(),w.c(),i=L(),a=k("button"),s=Jt("svg"),c=Jt("circle"),u=Jt("text"),f=I("A"),d=L(),q.c(),p=L(),m=k("button"),S=k("img"),g=L(),T.c(),$t(t.src,o=Es)||F(t,"src",o),F(t,"alt","Move map"),Y(t,"vertical-align","middle"),F(r,"class","outline"),F(c,"cx","12"),F(c,"cy","12"),F(c,"r","12"),F(c,"fill","white"),F(u,"x","6"),F(u,"y","16"),F(u,"fill","#4472c4"),F(s,"width","24"),F(s,"height","24"),F(s,"xmlns","http://www.w3.org/2000/svg"),Y(s,"vertical-align","middle"),F(a,"class","outline"),$t(S.src,D=Bs)||F(S,"src",D),F(S,"alt","New movement"),Y(S,"vertical-align","middle"),F(m,"class","outline"),F(e,"class","control-panel svelte-l1e6xi")},m(R,H){y(R,e,H),_(e,r),_(r,t),_(r,l),w.m(r,null),_(e,i),_(e,a),_(a,s),_(s,c),_(s,u),_(u,f),_(a,d),q.m(a,null),_(e,p),_(e,m),_(m,S),_(m,g),T.m(m,null),$||(C=[J(r,"click",function(){Zt(n[3])&&n[3].apply(this,arguments)}),J(a,"click",n[11]),J(m,"click",n[12])],$=!0)},p(R,H){n=R,j!==(j=b(n))&&(w.d(1),w=j(n),w&&(w.c(),w.m(r,null))),N!==(N=z(n))&&(q.d(1),q=N(n),q&&(q.c(),q.m(a,null))),V!==(V=P(n))&&(T.d(1),T=V(n),T&&(T.c(),T.m(m,null)))},d(R){R&&A(e),w.d(),q.d(),T.d(),$=!1,Ae(C)}}}function Ds(n){let e;return{c(){e=I("Move map")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Ts(n){let e;return{c(){e=k("b"),e.textContent="Move map"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Ns(n){let e;return{c(){e=I("New arm")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Is(n){let e;return{c(){e=k("b"),e.textContent="New arm"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Os(n){let e;return{c(){e=I("New movement")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Fs(n){let e;return{c(){e=k("b"),e.textContent="New movement"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function qs(n){let e;return{c(){e=k("span"),e.textContent=`${Vs(n[32])}`,F(e,"class","dot svelte-l1e6xi"),Y(e,"color","#4472c4"),Y(e,"background-color","white")},m(r,t){y(r,e,t)},p:ee,d(r){r&&A(e)}}}function lr(n){let e,r,t;function o(s){n[13](s,n[33])}function l(){return n[14](n[32])}function i(){return n[15](n[32])}let a={draggable:!0,$$slots:{default:[qs]},$$scope:{ctx:n}};return n[33].point!==void 0&&(a.lngLat=n[33].point),e=new Ze({props:a}),fe.push(()=>_e(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){M(e.$$.fragment)},m(s,c){B(e,s,c),t=!0},p(s,c){n=s;const u={};c[1]&16&&(u.$$scope={dirty:c,ctx:n}),!r&&c[0]&18&&(r=!0,u.lngLat=n[33].point,ge(()=>r=!1)),e.$set(u)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){v(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function Ps(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[6][n[30].score]),Y(e,"opacity",n[30].kind=="walking & wheeling"?"0%":"100%")},m(r,t){y(r,e,t)},p(r,t){t[0]&18&&Y(e,"background-color",r[6][r[30].score]),t[0]&18&&Y(e,"opacity",r[30].kind=="walking & wheeling"?"0%":"100%")},d(r){r&&A(e)}}}function Us(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[6][n[30].score])},m(r,t){y(r,e,t)},p(r,t){t[0]&18&&Y(e,"background-color",r[6][r[30].score])},d(r){r&&A(e)}}}function Rs(n){let e;return{c(){e=k("span"),F(e,"class","dot svelte-l1e6xi"),Y(e,"background-color",n[6][n[30].score]),Y(e,"opacity","0%")},m(r,t){y(r,e,t)},p(r,t){t[0]&18&&Y(e,"background-color",r[6][r[30].score])},d(r){r&&A(e)}}}function ir(n){let e,r,t,o,l,i,a,s,c;function u(w){n[16](w,n[30])}function f(){return n[17](n[32])}function d(){return n[18](n[32])}let p={draggable:!0,$$slots:{default:[Ps]},$$scope:{ctx:n}};n[30].point1!==void 0&&(p.lngLat=n[30].point1),e=new Ze({props:p}),fe.push(()=>_e(e,"lngLat",u)),e.$on("dragend",f),e.$on("click",d);function m(w){n[19](w,n[30])}function S(){return n[20](n[32])}function D(){return n[21](n[32])}let g={draggable:!0,$$slots:{default:[Us]},$$scope:{ctx:n}};n[30].point2!==void 0&&(g.lngLat=n[30].point2),o=new Ze({props:g}),fe.push(()=>_e(o,"lngLat",m)),o.$on("dragend",S),o.$on("click",D);function $(w){n[22](w,n[30])}function C(){return n[23](n[32])}function b(){return n[24](n[32])}let j={draggable:!0,$$slots:{default:[Rs]},$$scope:{ctx:n}};return n[30].point3!==void 0&&(j.lngLat=n[30].point3),a=new Ze({props:j}),fe.push(()=>_e(a,"lngLat",$)),a.$on("dragend",C),a.$on("click",b),{c(){M(e.$$.fragment),t=L(),M(o.$$.fragment),i=L(),M(a.$$.fragment)},m(w,z){B(e,w,z),y(w,t,z),B(o,w,z),y(w,i,z),B(a,w,z),c=!0},p(w,z){n=w;const N={};z[0]&18|z[1]&16&&(N.$$scope={dirty:z,ctx:n}),!r&&z[0]&18&&(r=!0,N.lngLat=n[30].point1,ge(()=>r=!1)),e.$set(N);const q={};z[0]&18|z[1]&16&&(q.$$scope={dirty:z,ctx:n}),!l&&z[0]&18&&(l=!0,q.lngLat=n[30].point2,ge(()=>l=!1)),o.$set(q);const P={};z[0]&18|z[1]&16&&(P.$$scope={dirty:z,ctx:n}),!s&&z[0]&18&&(s=!0,P.lngLat=n[30].point3,ge(()=>s=!1)),a.$set(P)},i(w){c||(h(e.$$.fragment,w),h(o.$$.fragment,w),h(a.$$.fragment,w),c=!0)},o(w){v(e.$$.fragment,w),v(o.$$.fragment,w),v(a.$$.fragment,w),c=!1},d(w){w&&(A(t),A(i)),E(e,w),E(o,w),E(a,w)}}}function Gs(n){let e=(n[29].name||"Untitled movement")+"",r;return{c(){r=I(e)},m(t,o){y(t,r,o)},p(t,o){o[0]&536870912&&e!==(e=(t[29].name||"Untitled movement")+"")&&oe(r,e)},d(t){t&&A(r)}}}function Js(n){let e,r;return e=new at({props:{$$slots:{default:[Gs,({props:t})=>({29:t}),({props:t})=>[t?536870912:0]]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o[0]&536870912|o[1]&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Qs(n){let e=(n[29].name||"Untitled movement")+"",r;return{c(){r=I(e)},m(t,o){y(t,r,o)},p(t,o){o[0]&536870912&&e!==(e=(t[29].name||"Untitled movement")+"")&&oe(r,e)},d(t){t&&A(r)}}}function Hs(n){let e,r;return e=new at({props:{$$slots:{default:[Qs,({props:t})=>({29:t}),({props:t})=>[t?536870912:0]]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o[0]&536870912|o[1]&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ks(n){let e,r,t,o,l,i;return e=new Me({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":kt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Js]},$$scope:{ctx:n}}}),e.$on("click",n[8]),t=new Me({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":kt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Hs]},$$scope:{ctx:n}}}),t.$on("click",n[8]),l=new tt({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment),o=L(),M(l.$$.fragment)},m(a,s){B(e,a,s),y(a,r,s),B(t,a,s),y(a,o,s),B(l,a,s),i=!0},p(a,s){const c={};s[1]&16&&(c.$$scope={dirty:s,ctx:a}),e.$set(c);const u={};s[1]&16&&(u.$$scope={dirty:s,ctx:a}),t.$set(u)},i(a){i||(h(e.$$.fragment,a),h(t.$$.fragment,a),h(l.$$.fragment,a),i=!0)},o(a){v(e.$$.fragment,a),v(t.$$.fragment,a),v(l.$$.fragment,a),i=!1},d(a){a&&(A(r),A(o)),E(e,a),E(t,a),E(l,a)}}}function Ws(n){let e,r,t,o;return e=new Me({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Ve({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment)},m(l,i){B(e,l,i),y(l,r,i),B(t,l,i),o=!0},p:ee,i(l){o||(h(e.$$.fragment,l),h(t.$$.fragment,l),o=!0)},o(l){v(e.$$.fragment,l),v(t.$$.fragment,l),o=!1},d(l){l&&A(r),E(e,l),E(t,l)}}}function Zs(n){let e,r,t,o,l,i,a,s,c;e=new Pt({}),e.$on("click",n[7]);let u=n[0].mode!="editing"&&or(n),f=x(n[4].jats[n[1]].properties.details.arms),d=[];for(let g=0;g<f.length;g+=1)d[g]=lr(rr(n,f,g));const p=g=>v(d[g],1,1,()=>{d[g]=null});let m=x(n[4].jats[n[1]].properties.details.movements),S=[];for(let g=0;g<m.length;g+=1)S[g]=ir(nr(n,m,g));const D=g=>v(S[g],1,1,()=>{S[g]=null});return i=new ke({props:{data:n[9](n[4]),$$slots:{default:[Ks]},$$scope:{ctx:n}}}),s=new ke({props:{data:n[5],$$slots:{default:[Ws]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),u&&u.c(),t=L();for(let g=0;g<d.length;g+=1)d[g].c();o=L();for(let g=0;g<S.length;g+=1)S[g].c();l=L(),M(i.$$.fragment),a=L(),M(s.$$.fragment)},m(g,$){B(e,g,$),y(g,r,$),u&&u.m(g,$),y(g,t,$);for(let C=0;C<d.length;C+=1)d[C]&&d[C].m(g,$);y(g,o,$);for(let C=0;C<S.length;C+=1)S[C]&&S[C].m(g,$);y(g,l,$),B(i,g,$),y(g,a,$),B(s,g,$),c=!0},p(g,$){if(g[0].mode!="editing"?u?u.p(g,$):(u=or(g),u.c(),u.m(t.parentNode,t)):u&&(u.d(1),u=null),$[0]&22){f=x(g[4].jats[g[1]].properties.details.arms);let j;for(j=0;j<f.length;j+=1){const w=rr(g,f,j);d[j]?(d[j].p(w,$),h(d[j],1)):(d[j]=lr(w),d[j].c(),h(d[j],1),d[j].m(o.parentNode,o))}for(ae(),j=f.length;j<d.length;j+=1)p(j);ce()}if($[0]&86){m=x(g[4].jats[g[1]].properties.details.movements);let j;for(j=0;j<m.length;j+=1){const w=nr(g,m,j);S[j]?(S[j].p(w,$),h(S[j],1)):(S[j]=ir(w),S[j].c(),h(S[j],1),S[j].m(l.parentNode,l))}for(ae(),j=m.length;j<S.length;j+=1)D(j);ce()}const C={};$[0]&16&&(C.data=g[9](g[4])),$[1]&16&&(C.$$scope={dirty:$,ctx:g}),i.$set(C);const b={};$[0]&32&&(b.data=g[5]),$[1]&16&&(b.$$scope={dirty:$,ctx:g}),s.$set(b)},i(g){if(!c){h(e.$$.fragment,g);for(let $=0;$<f.length;$+=1)h(d[$]);for(let $=0;$<m.length;$+=1)h(S[$]);h(i.$$.fragment,g),h(s.$$.fragment,g),c=!0}},o(g){v(e.$$.fragment,g),d=d.filter(Boolean);for(let $=0;$<d.length;$+=1)v(d[$]);S=S.filter(Boolean);for(let $=0;$<S.length;$+=1)v(S[$]);v(i.$$.fragment,g),v(s.$$.fragment,g),c=!1},d(g){g&&(A(r),A(t),A(o),A(l),A(a)),E(e,g),u&&u.d(g),pe(d,g),pe(S,g),E(i,g),E(s,g)}}}function Xs(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function Vs(n){return String.fromCharCode(n+"A".charCodeAt(0))}function Ys(n,e,r){let t,o,l;te(n,K,O=>r(4,o=O)),te(n,It,O=>r(25,l=O));let{junctionIdx:i}=e,{mode:a}=e,{hoveringSidebar:s}=e,{select:c}=e,{stopEditing:u}=e,f={0:We.red.background,1:We.amber.background,2:We.green.background,X:We.critical.background};function d(O,U,me){let be={type:"FeatureCollection",features:[]},Oe=U.mode=="editing"?U.id:me;return Oe!=null&&(Oe.kind=="arm"?be.features.push(Xs(O.jats[i].properties.details.arms[Oe.idx],Oe.idx)):be.features.push(D(O.jats[i].properties.details.movements[Oe.idx],Oe.idx))),be}async function p(O){if(l){for(let U of l.queryRenderedFeatures(O.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a.mode!="select"){if(a.mode=="editing"){await u();return}a.mode=="new-arm"?(X(K,o.jats[i].properties.details.arms=[...o.jats[i].properties.details.arms,{point:O.detail.lngLat.toArray(),name:""}],o),await c({kind:"arm",idx:o.jats[i].properties.details.arms.length-1})):(X(K,o.jats[i].properties.details.movements=[...o.jats[i].properties.details.movements,{point1:O.detail.lngLat.toArray(),point2:wt(O.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:wt(O.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await c({kind:"movement",idx:o.jats[i].properties.details.movements.length-1}))}}}async function m(O){await c({kind:"movement",idx:O.detail.features[0].id})}function S(O){let U={type:"FeatureCollection",features:O.jats[i].properties.details.movements.map((me,be)=>D(me,be))};for(let me of O.jats[i].properties.details.movements)if(U.features.push(g(me,U.features.length)),me.kind=="walking & wheeling"){let be={...me,point1:me.point3,point3:me.point1};U.features.push(g(be,U.features.length))}return U}function D(O,U){return{type:"Feature",id:U,properties:{name:O.name,kind:O.kind,color:f[O.score]},geometry:{type:"LineString",coordinates:[O.point1,O.point2,O.point3]}}}function g(O,U){return{type:"Feature",id:U,properties:{kind:O.kind,color:f[O.score],angle:it(O.point2,O.point3)},geometry:{type:"Point",coordinates:O.point3}}}const $=()=>r(0,a={mode:"new-arm"}),C=()=>r(0,a={mode:"new-movement"});function b(O,U){n.$$.not_equal(U.point,O)&&(U.point=O,K.set(o))}const j=O=>c({kind:"arm",idx:O}),w=O=>c({kind:"arm",idx:O});function z(O,U){n.$$.not_equal(U.point1,O)&&(U.point1=O,K.set(o))}const N=O=>c({kind:"movement",idx:O}),q=O=>c({kind:"movement",idx:O});function P(O,U){n.$$.not_equal(U.point2,O)&&(U.point2=O,K.set(o))}const V=O=>c({kind:"movement",idx:O}),T=O=>c({kind:"movement",idx:O});function R(O,U){n.$$.not_equal(U.point3,O)&&(U.point3=O,K.set(o))}const H=O=>c({kind:"movement",idx:O}),G=O=>c({kind:"movement",idx:O});return n.$$set=O=>{"junctionIdx"in O&&r(1,i=O.junctionIdx),"mode"in O&&r(0,a=O.mode),"hoveringSidebar"in O&&r(10,s=O.hoveringSidebar),"select"in O&&r(2,c=O.select),"stopEditing"in O&&r(3,u=O.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&1041&&r(5,t=d(o,a,s))},[a,i,c,u,o,t,f,p,m,S,s,$,C,b,j,w,z,N,q,P,V,T,R,H,G]}class xs extends le{constructor(e){super(),ie(this,e,Ys,Zs,re,{junctionIdx:1,mode:0,hoveringSidebar:10,select:2,stopEditing:3},null,[-1,-1])}}function sr(n){if(n.movements.length==0)return"No movements added";let e=0,r=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],r+=2;let t=e/r*100;return`${Math.round(t)}%`}const{window:ea}=st;function ar(n,e,r){const t=n.slice();t[23]=e[r],t[26]=r;const o=t[10][t[23].score];return t[24]=o,t}function cr(n,e,r){const t=n.slice();return t[27]=e[r],t[26]=r,t}function ta(n){let e,r,t,o,l,i,a,s,c;return{c(){e=k("button"),e.textContent="Done",r=L(),t=k("button"),t.textContent="Delete",o=L(),l=k("label"),i=I(`Arm name
        `),a=k("input"),F(a,"type","text")},m(u,f){y(u,e,f),y(u,r,f),y(u,t,f),y(u,o,f),y(u,l,f),_(l,i),_(l,a),he(a,n[4].jats[n[0]].properties.details.arms[n[1].id.idx].name),s||(c=[J(e,"click",n[19]),J(t,"click",n[8]),J(a,"input",n[20])],s=!0)},p(u,f){f&19&&a.value!==u[4].jats[u[0]].properties.details.arms[u[1].id.idx].name&&he(a,u[4].jats[u[0]].properties.details.arms[u[1].id.idx].name)},i:ee,o:ee,d(u){u&&(A(e),A(r),A(t),A(o),A(l)),s=!1,Ae(c)}}}function na(n){let e,r,t,o,l,i,a,s;return e=new fs({props:{junctionIdx:n[0],idx:n[1].id.idx}}),{c(){M(e.$$.fragment),r=L(),t=k("button"),t.textContent="Save",o=L(),l=k("button"),l.textContent="Delete"},m(c,u){B(e,c,u),y(c,r,u),y(c,t,u),y(c,o,u),y(c,l,u),i=!0,a||(s=[J(t,"click",n[7]),J(l,"click",n[8])],a=!0)},p(c,u){const f={};u&1&&(f.junctionIdx=c[0]),u&2&&(f.idx=c[1].id.idx),e.$set(f)},i(c){i||(h(e.$$.fragment,c),i=!0)},o(c){v(e.$$.fragment,c),i=!1},d(c){c&&(A(r),A(t),A(o),A(l)),E(e,c),a=!1,Ae(s)}}}function ra(n){let e,r,t,o,l,i,a,s,c,u,f=n[4].jats[n[0]].properties.name+"",d,p,m=sr(n[4].jats[n[0]].properties.details)+"",S,D,g,$,C,b,j,w,z,N,q=x(n[4].jats[n[0]].properties.details.arms),P=[];for(let G=0;G<q.length;G+=1)P[G]=ur(cr(n,q,G));const V=G=>v(P[G],1,1,()=>{P[G]=null});let T=x(n[4].jats[n[0]].properties.details.movements),R=[];for(let G=0;G<T.length;G+=1)R[G]=fr(ar(n,T,G));const H=G=>v(R[G],1,1,()=>{R[G]=null});return{c(){e=k("button"),e.textContent="Done",r=L(),t=k("h3"),t.textContent="Arms",o=L();for(let G=0;G<P.length;G+=1)P[G].c();l=L(),i=k("h3"),i.textContent="Movements",a=L(),s=k("p"),c=I(`Total JAT score
        `),u=k("i"),d=I(f),p=I(`
        : `),S=I(m),D=L(),g=k("button"),$=I("Generate cycling movements between all arms"),b=L();for(let G=0;G<R.length;G+=1)R[G].c();j=Pe(),F(g,"class","secondary"),g.disabled=C=n[4].jats[n[0]].properties.details.arms.length<2},m(G,O){y(G,e,O),y(G,r,O),y(G,t,O),y(G,o,O);for(let U=0;U<P.length;U+=1)P[U]&&P[U].m(G,O);y(G,l,O),y(G,i,O),y(G,a,O),y(G,s,O),_(s,c),_(s,u),_(u,d),_(s,p),_(s,S),y(G,D,O),y(G,g,O),_(g,$),y(G,b,O);for(let U=0;U<R.length;U+=1)R[U]&&R[U].m(G,O);y(G,j,O),w=!0,z||(N=[J(e,"click",n[12]),J(g,"click",n[11])],z=!0)},p(G,O){if(O&85){q=x(G[4].jats[G[0]].properties.details.arms);let U;for(U=0;U<q.length;U+=1){const me=cr(G,q,U);P[U]?(P[U].p(me,O),h(P[U],1)):(P[U]=ur(me),P[U].c(),h(P[U],1),P[U].m(l.parentNode,l))}for(ae(),U=q.length;U<P.length;U+=1)V(U);ce()}if((!w||O&17)&&f!==(f=G[4].jats[G[0]].properties.name+"")&&oe(d,f),(!w||O&17)&&m!==(m=sr(G[4].jats[G[0]].properties.details)+"")&&oe(S,m),(!w||O&17&&C!==(C=G[4].jats[G[0]].properties.details.arms.length<2))&&(g.disabled=C),O&1109){T=x(G[4].jats[G[0]].properties.details.movements);let U;for(U=0;U<T.length;U+=1){const me=ar(G,T,U);R[U]?(R[U].p(me,O),h(R[U],1)):(R[U]=fr(me),R[U].c(),h(R[U],1),R[U].m(j.parentNode,j))}for(ae(),U=T.length;U<R.length;U+=1)H(U);ce()}},i(G){if(!w){for(let O=0;O<q.length;O+=1)h(P[O]);for(let O=0;O<T.length;O+=1)h(R[O]);w=!0}},o(G){P=P.filter(Boolean);for(let O=0;O<P.length;O+=1)v(P[O]);R=R.filter(Boolean);for(let O=0;O<R.length;O+=1)v(R[O]);w=!1},d(G){G&&(A(e),A(r),A(t),A(o),A(l),A(i),A(a),A(s),A(D),A(g),A(b),A(j)),pe(P,G),pe(R,G),z=!1,Ae(N)}}}function ur(n){let e,r;function t(){return n[13](n[26])}function o(){return n[14](n[26])}return e=new lo({props:{name:`${dr(n[26])} - ${n[27].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[15]),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0},p(l,i){n=l;const a={};i&17&&(a.name=`${dr(n[26])} - ${n[27].name||"Unnamed arm"}`),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l)}}}function oa(n){let e,r,t,o=n[23].score+"",l,i,a,s=pr(n[23].kind)+"",c,u;return{c(){e=k("div"),r=k("span"),t=I("Score: "),l=I(o),i=L(),a=k("span"),c=I(s),u=L(),Y(r,"padding","4px"),Y(r,"color",n[24].font),Y(r,"background-color",n[24].background),Y(e,"width","100%"),Y(e,"display","flex"),Y(e,"justify-content","space-between")},m(f,d){y(f,e,d),_(e,r),_(r,t),_(r,l),_(e,i),_(e,a),_(a,c),y(f,u,d)},p(f,d){d&17&&o!==(o=f[23].score+"")&&oe(l,o),d&17&&Y(r,"color",f[24].font),d&17&&Y(r,"background-color",f[24].background),d&17&&s!==(s=pr(f[23].kind)+"")&&oe(c,s)},d(f){f&&(A(e),A(u))}}}function fr(n){let e,r;function t(){return n[16](n[26])}function o(){return n[17](n[26])}return e=new lo({props:{name:n[23].name||"Unnamed movement",$$slots:{default:[oa]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[18]),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0},p(l,i){n=l;const a={};i&17&&(a.name=n[23].name||"Unnamed movement"),i&536870929&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l)}}}function la(n){let e,r,t,o=n[4].jats[n[0]].properties.name+"",l,i,a,s,c;const u=[ra,na,ta],f=[];function d(p,m){return p[1].mode!="editing"?0:p[1].id.kind=="movement"?1:2}return a=d(n),s=f[a]=u[a](n),{c(){e=k("div"),r=k("h2"),t=I("JAT for "),l=I(o),i=L(),s.c(),F(e,"slot","sidebar")},m(p,m){y(p,e,m),_(e,r),_(r,t),_(r,l),_(e,i),f[a].m(e,null),n[21](e),c=!0},p(p,m){(!c||m&17)&&o!==(o=p[4].jats[p[0]].properties.name+"")&&oe(l,o);let S=a;a=d(p),a===S?f[a].p(p,m):(ae(),v(f[S],1,1,()=>{f[S]=null}),ce(),s=f[a],s?s.p(p,m):(s=f[a]=u[a](p),s.c()),h(s,1),s.m(e,null))},i(p){c||(h(s),c=!0)},o(p){v(s),c=!1},d(p){p&&A(e),f[a].d(),n[21](null)}}}function ia(n){let e,r;return e=new Ve({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function sa(n){let e,r,t,o,l,i,a;return r=new Je({props:{except:"jats"}}),o=new ke({props:{data:de(n[4].jats),generateId:!0,$$slots:{default:[ia]},$$scope:{ctx:n}}}),i=new xs({props:{junctionIdx:n[0],mode:n[1],hoveringSidebar:n[2],select:n[6],stopEditing:n[7]}}),{c(){e=k("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),l=L(),M(i.$$.fragment),F(e,"slot","map")},m(s,c){y(s,e,c),B(r,e,null),_(e,t),B(o,e,null),_(e,l),B(i,e,null),a=!0},p(s,c){const u={};c&16&&(u.data=de(s[4].jats)),c&536870913&&(u.$$scope={dirty:c,ctx:s}),o.$set(u);const f={};c&1&&(f.junctionIdx=s[0]),c&2&&(f.mode=s[1]),c&4&&(f.hoveringSidebar=s[2]),i.$set(f)},i(s){a||(h(r.$$.fragment,s),h(o.$$.fragment,s),h(i.$$.fragment,s),a=!0)},o(s){v(r.$$.fragment,s),v(o.$$.fragment,s),v(i.$$.fragment,s),a=!1},d(s){s&&A(e),E(r),E(o),E(i)}}}function aa(n){let e,r,t,o;return e=new Ie({props:{$$slots:{map:[sa],sidebar:[la]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0,t||(o=J(ea,"keydown",n[9]),t=!0)},p(l,[i]){const a={};i&536870975&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function dr(n){return String.fromCharCode(n+"A".charCodeAt(0))}function pr(n){return n.split(" ").map(e=>e.length>0?e[0].toUpperCase()+e.substr(1):e).join(" ")}function ca(n,e,r){let t,o;te(n,K,P=>r(4,t=P)),te(n,Z,P=>r(5,o=P));let{junctionIdx:l}=e,i={mode:"select"},a=null,s=null,c;async function u(P){a=c.scrollTop,r(1,i={mode:"editing",id:P}),r(2,s=null),await et(),r(3,c.scrollTop=0,c)}async function f(){r(1,i={mode:"select"}),a!=null&&(await et(),r(3,c.scrollTop=a,c),a=null)}function d(){i.mode=="editing"&&window.confirm(`Delete this ${i.id.kind}?`)&&(i.id.kind=="movement"?(t.jats[l].properties.details.movements.splice(i.id.idx,1),K.set(t)):(t.jats[l].properties.details.arms.splice(i.id.idx,1),K.set(t)),f())}function p(P){if(i.mode!="editing")return;let V=P.target.tagName,T=V=="INPUT"||V=="TEXTAREA";P.key=="Escape"||P.key=="Enter"&&!T?(P.stopPropagation(),f()):P.key=="Delete"&&!T&&(P.stopPropagation(),d())}let m={0:We.red,1:We.amber,2:We.green,X:We.critical};function S(){if(t.jats[l].properties.details.movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let P=t.jats[l].properties.details.movements.filter(V=>V.kind=="walking & wheeling");X(K,t.jats[l].properties.details.movements=[...P,...zs(t.jats[l].properties.details.arms)],t)}const D=()=>X(Z,o={kind:"edit-jat",idx:l},o),g=P=>u({kind:"arm",idx:P}),$=P=>r(2,s={kind:"arm",idx:P}),C=()=>r(2,s=null),b=P=>u({kind:"movement",idx:P}),j=P=>r(2,s={kind:"movement",idx:P}),w=()=>r(2,s=null),z=()=>r(1,i={mode:"select"});function N(){t.jats[l].properties.details.arms[i.id.idx].name=this.value,K.set(t)}function q(P){fe[P?"unshift":"push"](()=>{c=P,r(3,c)})}return n.$$set=P=>{"junctionIdx"in P&&r(0,l=P.junctionIdx)},[l,i,s,c,t,o,u,f,d,p,m,S,D,g,$,C,b,j,w,z,N,q]}class ua extends le{constructor(e){super(),ie(this,e,ca,aa,re,{junctionIdx:0})}}const{window:fa}=st;function da(n){let e,r,t,o,l,i,a,s,c,u,f,d;return{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("button"),o.textContent="Delete JAT",l=L(),i=k("label"),a=I(`Name:
      `),s=k("input"),c=L(),u=k("button"),u.textContent="Fill out JAT",F(s,"type","text"),F(e,"slot","sidebar")},m(p,m){y(p,e,m),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(i,a),_(i,s),he(s,n[1].jats[n[0]].properties.name),_(e,c),_(e,u),f||(d=[J(r,"click",n[6]),J(o,"click",n[4]),J(s,"input",n[7]),J(u,"click",n[8])],f=!0)},p(p,m){m&3&&s.value!==p[1].jats[p[0]].properties.name&&he(s,p[1].jats[p[0]].properties.name)},d(p){p&&A(e),f=!1,Ae(d)}}}function pa(n){let e,r;return e=new Ve({props:{filter:["!=",["id"],n[0]],paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":"black","circle-radius":20}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.filter=["!=",["id"],t[0]]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ma(n){let e,r,t,o,l,i,a,s;r=new Je({props:{except:"jats"}}),o=new ke({props:{data:de(n[1].jats),generateId:!0,$$slots:{default:[pa]},$$scope:{ctx:n}}});function c(f){n[5](f)}let u={radius:"50px",outline:!0,color:n[1].jats[n[0]].properties.color};return n[1].jats[n[0]].geometry.coordinates!==void 0&&(u.lngLat=n[1].jats[n[0]].geometry.coordinates),i=new xt({props:u}),fe.push(()=>_e(i,"lngLat",c)),{c(){e=k("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),l=L(),M(i.$$.fragment),F(e,"slot","map")},m(f,d){y(f,e,d),B(r,e,null),_(e,t),B(o,e,null),_(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].jats)),d&513&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};d&3&&(m.color=f[1].jats[f[0]].properties.color),!a&&d&3&&(a=!0,m.lngLat=f[1].jats[f[0]].geometry.coordinates,ge(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){v(r.$$.fragment,f),v(o.$$.fragment,f),v(i.$$.fragment,f),s=!1},d(f){f&&A(e),E(r),E(o),E(i)}}}function _a(n){let e,r,t,o;return e=new Ie({props:{$$slots:{map:[ma],sidebar:[da]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0,t||(o=J(fa,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&519&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function ga(n,e,r){let t,o;te(n,K,d=>r(1,t=d)),te(n,Z,d=>r(2,o=d));let{idx:l}=e;function i(d){d.key=="Escape"&&X(Z,o={kind:"neutral"},o)}async function a(){window.confirm("Really delete this JAT?")&&(X(Z,o={kind:"neutral"},o),await et(),t.jats.splice(l,1),K.set(t))}function s(d){n.$$.not_equal(t.jats[l].geometry.coordinates,d)&&(t.jats[l].geometry.coordinates=d,K.set(t))}const c=()=>X(Z,o={kind:"neutral"},o);function u(){t.jats[l].properties.name=this.value,K.set(t)}const f=()=>X(Z,o={kind:"edit-jat-detail",idx:l},o);return n.$$set=d=>{"idx"in d&&r(0,l=d.idx)},[l,t,o,i,a,s,c,u,f]}class ha extends le{constructor(e){super(),ie(this,e,ga,_a,re,{idx:0})}}function mr(n,e,r){const t=n.slice();return t[5]=e[r],t[6]=e,t[7]=r,t}function ba(n){let e,r;return{c(){e=k("span"),r=L(),F(e,"class","dot svelte-jgyhla")},m(t,o){y(t,e,o),y(t,r,o)},p:ee,d(t){t&&(A(e),A(r))}}}function _r(n){let e,r,t;function o(a){n[3](a,n[5],n[6],n[7])}function l(){return n[4](n[7])}let i={draggable:!0,$$slots:{default:[ba]},$$scope:{ctx:n}};return n[5]!==void 0&&(i.lngLat=n[5]),e=new Ze({props:i}),fe.push(()=>_e(e,"lngLat",o)),e.$on("contextmenu",l),{c(){M(e.$$.fragment)},m(a,s){B(e,a,s),t=!0},p(a,s){n=a;const c={};s&256&&(c.$$scope={dirty:s,ctx:n}),!r&&s&1&&(r=!0,c.lngLat=n[5],ge(()=>r=!1)),e.$set(c)},i(a){t||(h(e.$$.fragment,a),t=!0)},o(a){v(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function $a(n){let e,r,t,o;e=new Pt({}),e.$on("click",n[1]);let l=x(n[0].geometry.coordinates),i=[];for(let s=0;s<l.length;s+=1)i[s]=_r(mr(n,l,s));const a=s=>v(i[s],1,1,()=>{i[s]=null});return{c(){M(e.$$.fragment),r=L();for(let s=0;s<i.length;s+=1)i[s].c();t=Pe()},m(s,c){B(e,s,c),y(s,r,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(s,c);y(s,t,c),o=!0},p(s,[c]){if(c&5){l=x(s[0].geometry.coordinates);let u;for(u=0;u<l.length;u+=1){const f=mr(s,l,u);i[u]?(i[u].p(f,c),h(i[u],1)):(i[u]=_r(f),i[u].c(),h(i[u],1),i[u].m(t.parentNode,t))}for(ae(),u=l.length;u<i.length;u+=1)a(u);ce()}},i(s){if(!o){h(e.$$.fragment,s);for(let c=0;c<l.length;c+=1)h(i[c]);o=!0}},o(s){v(e.$$.fragment,s),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)v(i[c]);o=!1},d(s){s&&(A(r),A(t)),E(e,s),pe(i,s)}}}function ka(n,e,r){let{f:t}=e;function o(s){t.geometry.coordinates.push(s.detail.lngLat.toArray()),r(0,t)}function l(s){t.geometry.coordinates.splice(s,1),r(0,t)}function i(s,c,u,f){u[f]=s,r(0,t)}const a=s=>l(s);return n.$$set=s=>{"f"in s&&r(0,t=s.f)},[t,o,l,i,a]}class ao extends le{constructor(e){super(),ie(this,e,ka,$a,re,{f:0})}}const{window:wa}=st;function gr(n,e,r){const t=n.slice();return t[13]=e[r],t[14]=e,t[15]=r,t}function hr(n){let e;return{c(){e=k("p"),e.textContent="A link needs at least two points"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function va(n){let e,r,t;function o(){return n[10](n[13])}return{c(){e=k("button"),e.textContent="?",F(e,"class","outline")},m(l,i){y(l,e,i),r||(t=J(e,"click",o),r=!0)},p(l,i){n=l},d(l){l&&A(e),r=!1,t()}}}function ya(n){let e=n[13].name+"",r,t,o=n[13].description+"",l,i,a,s=Xe[n[13].name]&&va(n);return{c(){r=I(e),t=I(": "),l=I(o),i=L(),s&&s.c(),a=L()},m(c,u){y(c,r,u),y(c,t,u),y(c,l,u),y(c,i,u),s&&s.m(c,u),y(c,a,u)},p(c,u){Xe[c[13].name]&&s.p(c,u)},d(c){c&&(A(r),A(t),A(l),A(i),A(a)),s&&s.d(c)}}}function br(n){let e,r,t;function o(i){n[11](i,n[15])}let l={k:"horiz-radio",choices:n[13].choices,$$slots:{default:[ya]},$$scope:{ctx:n}};return n[1].links[n[0]].properties.answers[n[15]]!==void 0&&(l.value=n[1].links[n[0]].properties.answers[n[15]]),e=new qe({props:l}),fe.push(()=>_e(e,"value",o)),{c(){M(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,a){n=i;const s={};a&65540&&(s.$$scope={dirty:a,ctx:n}),!r&&a&3&&(r=!0,s.value=n[1].links[n[0]].properties.answers[n[15]],ge(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){v(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Aa(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m,S,D=!n[3]&&hr(),g=x(Se),$=[];for(let b=0;b<g.length;b+=1)$[b]=br(gr(n,g,b));const C=b=>v($[b],1,1,()=>{$[b]=null});return{c(){e=k("div"),r=k("button"),t=I("Done"),l=L(),i=k("button"),i.textContent="Delete link",a=L(),D&&D.c(),s=L(),c=k("label"),u=I(`Name:
      `),f=k("input"),d=L();for(let b=0;b<$.length;b+=1)$[b].c();r.disabled=o=!n[3],F(f,"type","text"),F(e,"slot","sidebar")},m(b,j){y(b,e,j),_(e,r),_(r,t),_(e,l),_(e,i),_(e,a),D&&D.m(e,null),_(e,s),_(e,c),_(c,u),_(c,f),he(f,n[1].links[n[0]].properties.name),_(e,d);for(let w=0;w<$.length;w+=1)$[w]&&$[w].m(e,null);p=!0,m||(S=[J(r,"click",n[8]),J(i,"click",n[6]),J(f,"input",n[9])],m=!0)},p(b,j){if((!p||j&8&&o!==(o=!b[3]))&&(r.disabled=o),b[3]?D&&(D.d(1),D=null):D||(D=hr(),D.c(),D.m(e,s)),j&3&&f.value!==b[1].links[b[0]].properties.name&&he(f,b[1].links[b[0]].properties.name),j&7){g=x(Se);let w;for(w=0;w<g.length;w+=1){const z=gr(b,g,w);$[w]?($[w].p(z,j),h($[w],1)):($[w]=br(z),$[w].c(),h($[w],1),$[w].m(e,null))}for(ae(),w=g.length;w<$.length;w+=1)C(w);ce()}},i(b){if(!p){for(let j=0;j<g.length;j+=1)h($[j]);p=!0}},o(b){$=$.filter(Boolean);for(let j=0;j<$.length;j+=1)v($[j]);p=!1},d(b){b&&A(e),D&&D.d(),pe($,b),m=!1,Ae(S)}}}function Ca(n){let e,r;return e=new Me({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":6}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":6}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ja(n){let e,r,t,o,l,i,a,s;r=new Je({props:{except:"links"}}),o=new ke({props:{data:de(n[1].links),generateId:!0,$$slots:{default:[Ca]},$$scope:{ctx:n}}});function c(f){n[7](f)}let u={};return n[1].links[n[0]]!==void 0&&(u.f=n[1].links[n[0]]),i=new ao({props:u}),fe.push(()=>_e(i,"f",c)),{c(){e=k("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),l=L(),M(i.$$.fragment),F(e,"slot","map")},m(f,d){y(f,e,d),B(r,e,null),_(e,t),B(o,e,null),_(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].links)),d&65537&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};!a&&d&3&&(a=!0,m.f=f[1].links[f[0]],ge(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){v(r.$$.fragment,f),v(o.$$.fragment,f),v(i.$$.fragment,f),s=!1},d(f){f&&A(e),E(r),E(o),E(i)}}}function $r(n){let e,r;return e=new Ut({props:{$$slots:{default:[Sa]},$$scope:{ctx:n}}}),e.$on("close",n[12]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&65540&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Sa(n){let e,r=n[2].description+"",t,o,l,i;return l=new ct({props:{metric:n[2]}}),{c(){e=k("p"),t=I(r),o=L(),M(l.$$.fragment)},m(a,s){y(a,e,s),_(e,t),y(a,o,s),B(l,a,s),i=!0},p(a,s){(!i||s&4)&&r!==(r=a[2].description+"")&&oe(t,r);const c={};s&4&&(c.metric=a[2]),l.$set(c)},i(a){i||(h(l.$$.fragment,a),i=!0)},o(a){v(l.$$.fragment,a),i=!1},d(a){a&&(A(e),A(o)),E(l,a)}}}function za(n){let e,r,t,o,l,i;e=new Ie({props:{$$slots:{map:[ja],sidebar:[Aa]},$$scope:{ctx:n}}});let a=n[2]&&$r(n);return{c(){M(e.$$.fragment),r=L(),a&&a.c(),t=Pe()},m(s,c){B(e,s,c),y(s,r,c),a&&a.m(s,c),y(s,t,c),o=!0,l||(i=J(wa,"keydown",n[5]),l=!0)},p(s,[c]){const u={};c&65567&&(u.$$scope={dirty:c,ctx:s}),e.$set(u),s[2]?a?(a.p(s,c),c&4&&h(a,1)):(a=$r(s),a.c(),h(a,1),a.m(t.parentNode,t)):a&&(ae(),v(a,1,1,()=>{a=null}),ce())},i(s){o||(h(e.$$.fragment,s),h(a),o=!0)},o(s){v(e.$$.fragment,s),v(a),o=!1},d(s){s&&(A(r),A(t)),E(e,s),a&&a.d(s),l=!1,i()}}}function La(n,e,r){let t,o,l;te(n,K,D=>r(1,o=D)),te(n,Z,D=>r(4,l=D));let{idx:i}=e,a=null;function s(D){D.key=="Escape"&&t&&X(Z,l={kind:"neutral"},l)}async function c(){window.confirm("Really delete this link?")&&(X(Z,l={kind:"neutral"},l),await et(),o.links.splice(i,1),K.set(o))}function u(D){n.$$.not_equal(o.links[i],D)&&(o.links[i]=D,K.set(o))}const f=()=>X(Z,l={kind:"neutral"},l);function d(){o.links[i].properties.name=this.value,K.set(o)}const p=D=>r(2,a=Xe[D.name]);function m(D,g){n.$$.not_equal(o.links[i].properties.answers[g],D)&&(o.links[i].properties.answers[g]=D,K.set(o))}const S=()=>r(2,a=null);return n.$$set=D=>{"idx"in D&&r(0,i=D.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(3,t=o.links[i].geometry.coordinates.length>=2)},[i,o,a,t,l,s,c,u,f,d,p,m,S]}class Ma extends le{constructor(e){super(),ie(this,e,La,za,re,{idx:0})}}function kr(n,e,r){const t=n.slice();return t[7]=e[r],t[8]=e,t[9]=r,t}function Ba(n){let e;return{c(){e=k("p"),e.textContent=`${n[3].description}`},m(r,t){y(r,e,t)},p:ee,d(r){r&&A(e)}}}function wr(n){let e,r,t=n[7].properties.name+"",o,l,i,a,s,c;function u(d){n[6](d,n[7])}let f={k:"horiz-radio",choices:Se[n[0]].choices};return n[7].properties.answers[n[0]]!==void 0&&(f.value=n[7].properties.answers[n[0]]),i=new qe({props:f}),fe.push(()=>_e(i,"value",u)),{c(){e=k("li"),r=k("span"),o=I(t),l=L(),M(i.$$.fragment),s=L(),Y(r,"color",n[7].properties.color)},m(d,p){y(d,e,p),_(e,r),_(r,o),_(e,l),B(i,e,null),_(e,s),c=!0},p(d,p){n=d,(!c||p&4)&&t!==(t=n[7].properties.name+"")&&oe(o,t),p&4&&Y(r,"color",n[7].properties.color);const m={};p&1&&(m.choices=Se[n[0]].choices),!a&&p&5&&(a=!0,m.value=n[7].properties.answers[n[0]],ge(()=>a=!1)),i.$set(m)},i(d){c||(h(i.$$.fragment,d),c=!0)},o(d){v(i.$$.fragment,d),c=!1},d(d){d&&A(e),E(i)}}}function Ea(n){let e,r;return e=new ct({props:{metric:n[3]}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Da(n){let e,r,t,o,l=Se[n[0]].name+"",i,a,s=Se[n[0]].description+"",c,u,f,d,p,m,S,D,g=n[3]&&Ba(n),$=x(n[2].links),C=[];for(let w=0;w<$.length;w+=1)C[w]=wr(kr(n,$,w));const b=w=>v(C[w],1,1,()=>{C[w]=null});let j=n[3]&&Ea(n);return{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("h2"),i=I(l),a=I(": "),c=I(s),u=L(),g&&g.c(),f=L(),d=k("ol");for(let w=0;w<C.length;w+=1)C[w].c();p=L(),j&&j.c(),F(e,"slot","sidebar")},m(w,z){y(w,e,z),_(e,r),_(e,t),_(e,o),_(o,i),_(o,a),_(o,c),_(e,u),g&&g.m(e,null),_(e,f),_(e,d);for(let N=0;N<C.length;N+=1)C[N]&&C[N].m(d,null);_(e,p),j&&j.m(e,null),m=!0,S||(D=J(r,"click",n[5]),S=!0)},p(w,z){if((!m||z&1)&&l!==(l=Se[w[0]].name+"")&&oe(i,l),(!m||z&1)&&s!==(s=Se[w[0]].description+"")&&oe(c,s),w[3]&&g.p(w,z),z&5){$=x(w[2].links);let N;for(N=0;N<$.length;N+=1){const q=kr(w,$,N);C[N]?(C[N].p(q,z),h(C[N],1)):(C[N]=wr(q),C[N].c(),h(C[N],1),C[N].m(d,null))}for(ae(),N=$.length;N<C.length;N+=1)b(N);ce()}w[3]&&j.p(w,z)},i(w){if(!m){for(let z=0;z<$.length;z+=1)h(C[z]);h(j),m=!0}},o(w){C=C.filter(Boolean);for(let z=0;z<C.length;z+=1)v(C[z]);v(j),m=!1},d(w){w&&A(e),g&&g.d(),pe(C,w),j&&j.d(),S=!1,D()}}}function Ta(n){let e,r,t;return r=new Je({props:{showColor:"links",except:""}}),{c(){e=k("div"),M(r.$$.fragment),F(e,"slot","map")},m(o,l){y(o,e,l),B(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){v(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function Na(n){let e,r,t,o;return e=new Ie({props:{$$slots:{map:[Ta],sidebar:[Da]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0,t||(o=J(window,"keydown",n[4]),t=!0)},p(l,[i]){const a={};i&1031&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function Ia(n,e,r){let t,o;te(n,Z,u=>r(1,t=u)),te(n,K,u=>r(2,o=u));let{qIdx:l}=e,i=Xe[Se[l].name];function a(u){u.key=="Escape"&&X(Z,t={kind:"neutral"},t)}const s=()=>X(Z,t={kind:"neutral"},t);function c(u,f){n.$$.not_equal(f.properties.answers[l],u)&&(f.properties.answers[l]=u,K.set(o))}return n.$$set=u=>{"qIdx"in u&&r(0,l=u.qIdx)},[l,t,o,i,a,s,c]}class Oa extends le{constructor(e){super(),ie(this,e,Ia,Na,re,{qIdx:0})}}function Fa(n){let e,r,t,o;const l=n[2].default,i=Ee(l,n,n[1],null);return{c(){e=k("a"),i&&i.c(),F(e,"href","#"),Y(e,"color",n[0])},m(a,s){y(a,e,s),i&&i.m(e,null),r=!0,t||(o=J(e,"click",Io(n[3])),t=!0)},p(a,[s]){i&&i.p&&(!r||s&2)&&De(i,l,a,a[1],r?Ne(l,a[1],s,null):Te(a[1]),null),s&1&&Y(e,"color",a[0])},i(a){r||(h(i,a),r=!0)},o(a){v(i,a),r=!1},d(a){a&&A(e),i&&i.d(a),t=!1,o()}}}function qa(n,e,r){let{$$slots:t={},$$scope:o}=e,{color:l=void 0}=e;function i(a){je.call(this,n,a)}return n.$$set=a=>{"color"in a&&r(0,l=a.color),"$$scope"in a&&r(1,o=a.$$scope)},[l,o,t,i]}class Ye extends le{constructor(e){super(),ie(this,e,qa,Fa,re,{color:0})}}function vr(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function Pa(n){let e;return{c(){e=I(`ST20
  `)},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Ua(n){let e=n[5].properties.name+"",r;return{c(){r=I(e)},m(t,o){y(t,r,o)},p(t,o){o&2&&e!==(e=t[5].properties.name+"")&&oe(r,e)},d(t){t&&A(r)}}}function yr(n){let e,r,t,o;function l(){return n[4](n[7])}return r=new Ye({props:{color:n[5].properties.color,$$slots:{default:[Ua]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=L()},m(i,a){y(i,e,a),B(r,e,null),_(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[5].properties.color),a&258&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){v(r.$$.fragment,i),o=!1},d(i){i&&A(e),E(r)}}}function Ra(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m,S;i=new Ye({props:{$$slots:{default:[Pa]},$$scope:{ctx:n}}}),i.$on("click",n[3]);let D=x(n[1].bus_stops),g=[];for(let C=0;C<D.length;C+=1)g[C]=yr(vr(n,D,C));const $=C=>v(g[C],1,1,()=>{g[C]=null});return{c(){e=I(`Bus stops:

`),r=k("div"),t=k("button"),t.textContent="New bus stop",o=L(),l=k("div"),M(i.$$.fragment),a=I(`:
  `),s=k("progress"),f=L(),d=k("ol");for(let C=0;C<g.length;C+=1)g[C].c();s.value=c=n[1].bus_stops.filter(Ar).length,F(s,"max",u=n[1].bus_stops.length),F(s,"class","svelte-zadug4")},m(C,b){y(C,e,b),y(C,r,b),_(r,t),y(C,o,b),y(C,l,b),B(i,l,null),_(l,a),_(l,s),y(C,f,b),y(C,d,b);for(let j=0;j<g.length;j+=1)g[j]&&g[j].m(d,null);p=!0,m||(S=J(t,"click",n[2]),m=!0)},p(C,[b]){const j={};if(b&256&&(j.$$scope={dirty:b,ctx:C}),i.$set(j),(!p||b&2&&c!==(c=C[1].bus_stops.filter(Ar).length))&&(s.value=c),(!p||b&2&&u!==(u=C[1].bus_stops.length))&&F(s,"max",u),b&3){D=x(C[1].bus_stops);let w;for(w=0;w<D.length;w+=1){const z=vr(C,D,w);g[w]?(g[w].p(z,b),h(g[w],1)):(g[w]=yr(z),g[w].c(),h(g[w],1),g[w].m(d,null))}for(ae(),w=D.length;w<g.length;w+=1)$(w);ce()}},i(C){if(!p){h(i.$$.fragment,C);for(let b=0;b<D.length;b+=1)h(g[b]);p=!0}},o(C){v(i.$$.fragment,C),g=g.filter(Boolean);for(let b=0;b<g.length;b+=1)v(g[b]);p=!1},d(C){C&&(A(e),A(r),A(o),A(l),A(f),A(d)),E(i),pe(g,C),m=!1,S()}}}const Ar=n=>n.properties.st20!="";function Ga(n,e,r){let t,o;return te(n,Z,s=>r(0,t=s)),te(n,K,s=>r(1,o=s)),[t,o,()=>X(Z,t={kind:"new-point",obj:"bus stop"},t),()=>X(Z,t={kind:"bus-stop-questions"},t),s=>X(Z,t={kind:"edit-bus-stop",idx:s},t)]}let Ja=class extends le{constructor(e){super(),ie(this,e,Ga,Ra,re,{})}};function Cr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Qa(n){let e=n[4].properties.name+"",r;return{c(){r=I(e)},m(t,o){y(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&oe(r,e)},d(t){t&&A(r)}}}function jr(n){let e,r,t,o;function l(){return n[3](n[6])}return r=new Ye({props:{color:n[4].properties.color,$$slots:{default:[Qa]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=L()},m(i,a){y(i,e,a),B(r,e,null),_(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[4].properties.color),a&130&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){v(r.$$.fragment,i),o=!1},d(i){i&&A(e),E(r)}}}function Ha(n){let e,r,t,o,l,i,a,s,c=x(n[1].crossings),u=[];for(let d=0;d<c.length;d+=1)u[d]=jr(Cr(n,c,d));const f=d=>v(u[d],1,1,()=>{u[d]=null});return{c(){e=I(`Crossings:

`),r=k("div"),t=k("button"),t.textContent="New crossing",o=L(),l=k("ol");for(let d=0;d<u.length;d+=1)u[d].c()},m(d,p){y(d,e,p),y(d,r,p),_(r,t),y(d,o,p),y(d,l,p);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(l,null);i=!0,a||(s=J(t,"click",n[2]),a=!0)},p(d,[p]){if(p&3){c=x(d[1].crossings);let m;for(m=0;m<c.length;m+=1){const S=Cr(d,c,m);u[m]?(u[m].p(S,p),h(u[m],1)):(u[m]=jr(S),u[m].c(),h(u[m],1),u[m].m(l,null))}for(ae(),m=c.length;m<u.length;m+=1)f(m);ce()}},i(d){if(!i){for(let p=0;p<c.length;p+=1)h(u[p]);i=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)v(u[p]);i=!1},d(d){d&&(A(e),A(r),A(o),A(l)),pe(u,d),a=!1,s()}}}function Ka(n,e,r){let t,o;return te(n,Z,a=>r(0,t=a)),te(n,K,a=>r(1,o=a)),[t,o,()=>X(Z,t={kind:"new-point",obj:"crossing"},t),a=>X(Z,t={kind:"edit-crossing",idx:a},t)]}let Wa=class extends le{constructor(e){super(),ie(this,e,Ka,Ha,re,{})}};function Sr(n,e,r){const t=n.slice();return t[4]=e[r],t[6]=r,t}function Za(n){let e=n[4].properties.name+"",r;return{c(){r=I(e)},m(t,o){y(t,r,o)},p(t,o){o&2&&e!==(e=t[4].properties.name+"")&&oe(r,e)},d(t){t&&A(r)}}}function zr(n){let e,r,t,o;function l(){return n[3](n[6])}return r=new Ye({props:{color:n[4].properties.color,$$slots:{default:[Za]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=L()},m(i,a){y(i,e,a),B(r,e,null),_(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[4].properties.color),a&130&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){v(r.$$.fragment,i),o=!1},d(i){i&&A(e),E(r)}}}function Xa(n){let e,r,t,o,l,i,a,s,c=x(n[1].jats),u=[];for(let d=0;d<c.length;d+=1)u[d]=zr(Sr(n,c,d));const f=d=>v(u[d],1,1,()=>{u[d]=null});return{c(){e=I(`JATs:

`),r=k("div"),t=k("button"),t.textContent="New JAT",o=L(),l=k("ol");for(let d=0;d<u.length;d+=1)u[d].c()},m(d,p){y(d,e,p),y(d,r,p),_(r,t),y(d,o,p),y(d,l,p);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(l,null);i=!0,a||(s=J(t,"click",n[2]),a=!0)},p(d,[p]){if(p&3){c=x(d[1].jats);let m;for(m=0;m<c.length;m+=1){const S=Sr(d,c,m);u[m]?(u[m].p(S,p),h(u[m],1)):(u[m]=zr(S),u[m].c(),h(u[m],1),u[m].m(l,null))}for(ae(),m=c.length;m<u.length;m+=1)f(m);ce()}},i(d){if(!i){for(let p=0;p<c.length;p+=1)h(u[p]);i=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)v(u[p]);i=!1},d(d){d&&(A(e),A(r),A(o),A(l)),pe(u,d),a=!1,s()}}}function Va(n,e,r){let t,o;return te(n,Z,a=>r(0,t=a)),te(n,K,a=>r(1,o=a)),[t,o,()=>X(Z,t={kind:"new-point",obj:"jat"},t),a=>X(Z,t={kind:"edit-jat",idx:a},t)]}let Ya=class extends le{constructor(e){super(),ie(this,e,Va,Xa,re,{})}};function Lr(n,e,r){const t=n.slice();return t[2]=e[r],t[4]=r,t}function Mr(n,e,r){const t=n.slice();t[5]=e[r];const o=t[5].properties.answers[t[4]];return t[6]=o,t}function Br(n,e,r){const t=n.slice();return t[5]=e[r],t}function Er(n){let e,r=n[5].properties.name+"",t;return{c(){e=k("th"),t=I(r),Y(e,"color",n[5].properties.color)},m(o,l){y(o,e,l),_(e,t)},p(o,l){l&1&&r!==(r=o[5].properties.name+"")&&oe(t,r),l&1&&Y(e,"color",o[5].properties.color)},d(o){o&&A(e)}}}function Dr(n){let e,r=n[6]+"",t;return{c(){e=k("td"),t=I(r),Y(e,"background",n[6]==""?"red":"green")},m(o,l){y(o,e,l),_(e,t)},p(o,l){l&1&&r!==(r=o[6]+"")&&oe(t,r),l&1&&Y(e,"background",o[6]==""?"red":"green")},d(o){o&&A(e)}}}function Tr(n){let e,r,t,o,l=x(n[0].links),i=[];for(let a=0;a<l.length;a+=1)i[a]=Dr(Mr(n,l,a));return{c(){e=k("tr"),r=k("th"),r.textContent=`${n[2].name}`,t=L();for(let a=0;a<i.length;a+=1)i[a].c();o=L()},m(a,s){y(a,e,s),_(e,r),_(e,t);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);_(e,o)},p(a,s){if(s&1){l=x(a[0].links);let c;for(c=0;c<l.length;c+=1){const u=Mr(a,l,c);i[c]?i[c].p(u,s):(i[c]=Dr(u),i[c].c(),i[c].m(e,o))}for(;c<i.length;c+=1)i[c].d(1);i.length=l.length}},d(a){a&&A(e),pe(i,a)}}}function xa(n){let e,r,t,o,l,i,a,s=x(n[0].links),c=[];for(let d=0;d<s.length;d+=1)c[d]=Er(Br(n,s,d));let u=x(Se),f=[];for(let d=0;d<u.length;d+=1)f[d]=Tr(Lr(n,u,d));return{c(){e=k("table"),r=k("thead"),t=k("tr"),o=k("th"),l=L();for(let d=0;d<c.length;d+=1)c[d].c();i=L(),a=k("tbody");for(let d=0;d<f.length;d+=1)f[d].c()},m(d,p){y(d,e,p),_(e,r),_(r,t),_(t,o),_(t,l);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(t,null);_(e,i),_(e,a);for(let m=0;m<f.length;m+=1)f[m]&&f[m].m(a,null)},p(d,p){if(p&1){s=x(d[0].links);let m;for(m=0;m<s.length;m+=1){const S=Br(d,s,m);c[m]?c[m].p(S,p):(c[m]=Er(S),c[m].c(),c[m].m(t,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=s.length}if(p&1){u=x(Se);let m;for(m=0;m<u.length;m+=1){const S=Lr(d,u,m);f[m]?f[m].p(S,p):(f[m]=Tr(S),f[m].c(),f[m].m(a,null))}for(;m<f.length;m+=1)f[m].d(1);f.length=u.length}},d(d){d&&A(e),pe(c,d),pe(f,d)}}}function ec(n){let e,r;return e=new Ut({props:{$$slots:{default:[xa]},$$scope:{ctx:n}}}),e.$on("close",n[1]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,[o]){const l={};o&2049&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function tc(n,e,r){let t;te(n,K,l=>r(0,t=l));function o(l){je.call(this,n,l)}return[t,o]}class nc extends le{constructor(e){super(),ie(this,e,tc,ec,re,{})}}function Nr(n,e,r){const t=n.slice();return t[9]=e[r],t[11]=r,t}function Ir(n,e,r){const t=n.slice();return t[12]=e[r],t[11]=r,t}function Or(n){let e,r;return e=new nc({}),e.$on("close",n[4]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function rc(n){let e=n[12].properties.name+"",r;return{c(){r=I(e)},m(t,o){y(t,r,o)},p(t,o){o&2&&e!==(e=t[12].properties.name+"")&&oe(r,e)},d(t){t&&A(r)}}}function Fr(n){let e,r,t,o;function l(){return n[6](n[11])}return r=new Ye({props:{color:n[12].properties.color,$$slots:{default:[rc]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=L()},m(i,a){y(i,e,a),B(r,e,null),_(e,t),o=!0},p(i,a){n=i;const s={};a&2&&(s.color=n[12].properties.color),a&16386&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){v(r.$$.fragment,i),o=!1},d(i){i&&A(e),E(r)}}}function oc(n){let e=n[9].name+"",r,t;return{c(){r=I(e),t=L()},m(o,l){y(o,r,l),y(o,t,l)},p:ee,d(o){o&&(A(r),A(t))}}}function qr(n){let e,r,t,o,l,i,a,s;function c(){return n[7](n[11])}r=new Ye({props:{$$slots:{default:[oc]},$$scope:{ctx:n}}}),r.$on("click",c);function u(...f){return n[8](n[11],...f)}return{c(){e=k("li"),M(r.$$.fragment),t=I(`:
      `),o=k("progress"),a=L(),o.value=l=n[1].links.filter(u).length,F(o,"max",i=n[1].links.length),F(o,"class","svelte-zadug4")},m(f,d){y(f,e,d),B(r,e,null),_(e,t),_(e,o),_(e,a),s=!0},p(f,d){n=f;const p={};d&16384&&(p.$$scope={dirty:d,ctx:n}),r.$set(p),(!s||d&2&&l!==(l=n[1].links.filter(u).length))&&(o.value=l),(!s||d&2&&i!==(i=n[1].links.length))&&F(o,"max",i)},i(f){s||(h(r.$$.fragment,f),s=!0)},o(f){v(r.$$.fragment,f),s=!1},d(f){f&&A(e),E(r)}}}function lc(n){let e,r,t,o,l,i,a,s,c,u,f,d,p=n[0]&&Or(n),m=x(n[1].links),S=[];for(let b=0;b<m.length;b+=1)S[b]=Fr(Ir(n,m,b));const D=b=>v(S[b],1,1,()=>{S[b]=null});let g=x(Se),$=[];for(let b=0;b<g.length;b+=1)$[b]=qr(Nr(n,g,b));const C=b=>v($[b],1,1,()=>{$[b]=null});return{c(){p&&p.c(),e=L(),r=k("div"),t=k("button"),t.textContent="New link",o=L(),l=k("button"),l.textContent="Table of questions",i=I(`

Links:
`),a=k("ol");for(let b=0;b<S.length;b+=1)S[b].c();s=I(`

Questions:
`),c=k("ol");for(let b=0;b<$.length;b+=1)$[b].c()},m(b,j){p&&p.m(b,j),y(b,e,j),y(b,r,j),_(r,t),_(r,o),_(r,l),y(b,i,j),y(b,a,j);for(let w=0;w<S.length;w+=1)S[w]&&S[w].m(a,null);y(b,s,j),y(b,c,j);for(let w=0;w<$.length;w+=1)$[w]&&$[w].m(c,null);u=!0,f||(d=[J(t,"click",n[3]),J(l,"click",n[5])],f=!0)},p(b,[j]){if(b[0]?p?(p.p(b,j),j&1&&h(p,1)):(p=Or(b),p.c(),h(p,1),p.m(e.parentNode,e)):p&&(ae(),v(p,1,1,()=>{p=null}),ce()),j&6){m=x(b[1].links);let w;for(w=0;w<m.length;w+=1){const z=Ir(b,m,w);S[w]?(S[w].p(z,j),h(S[w],1)):(S[w]=Fr(z),S[w].c(),h(S[w],1),S[w].m(a,null))}for(ae(),w=m.length;w<S.length;w+=1)D(w);ce()}if(j&6){g=x(Se);let w;for(w=0;w<g.length;w+=1){const z=Nr(b,g,w);$[w]?($[w].p(z,j),h($[w],1)):($[w]=qr(z),$[w].c(),h($[w],1),$[w].m(c,null))}for(ae(),w=g.length;w<$.length;w+=1)C(w);ce()}},i(b){if(!u){h(p);for(let j=0;j<m.length;j+=1)h(S[j]);for(let j=0;j<g.length;j+=1)h($[j]);u=!0}},o(b){v(p),S=S.filter(Boolean);for(let j=0;j<S.length;j+=1)v(S[j]);$=$.filter(Boolean);for(let j=0;j<$.length;j+=1)v($[j]);u=!1},d(b){b&&(A(e),A(r),A(i),A(a),A(s),A(c)),p&&p.d(b),pe(S,b),pe($,b),f=!1,Ae(d)}}}function ic(n,e,r){let t,o;te(n,K,d=>r(1,t=d)),te(n,Z,d=>r(2,o=d));let l=!1;function i(){let d=ro(t.links.length);X(K,t.links=[...t.links,d],t),X(Z,o={kind:"edit-link",idx:t.links.length-1},o)}return[l,t,o,i,()=>r(0,l=!1),()=>r(0,l=!0),d=>X(Z,o={kind:"edit-link",idx:d},o),d=>X(Z,o={kind:"link-questions",idx:d},o),(d,p)=>p.properties.answers[d]!=""]}let sc=class extends le{constructor(e){super(),ie(this,e,ic,lc,re,{})}};function Pr(n,e,r){const t=n.slice();return t[5]=e[r],t[7]=r,t}function ac(n){let e;return{c(){e=I(`SA01
  `)},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function cc(n){let e=n[5].properties.name+"",r;return{c(){r=I(e)},m(t,o){y(t,r,o)},p(t,o){o&1&&e!==(e=t[5].properties.name+"")&&oe(r,e)},d(t){t&&A(r)}}}function Ur(n){let e,r,t,o;function l(){return n[4](n[7])}return r=new Ye({props:{color:n[5].properties.color,$$slots:{default:[cc]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){e=k("li"),M(r.$$.fragment),t=L()},m(i,a){y(i,e,a),B(r,e,null),_(e,t),o=!0},p(i,a){n=i;const s={};a&1&&(s.color=n[5].properties.color),a&257&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(i){o||(h(r.$$.fragment,i),o=!0)},o(i){v(r.$$.fragment,i),o=!1},d(i){i&&A(e),E(r)}}}function uc(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m,S;i=new Ye({props:{$$slots:{default:[ac]},$$scope:{ctx:n}}}),i.$on("click",n[3]);let D=x(n[0].side_roads),g=[];for(let C=0;C<D.length;C+=1)g[C]=Ur(Pr(n,D,C));const $=C=>v(g[C],1,1,()=>{g[C]=null});return{c(){e=I(`Side roads:

`),r=k("div"),t=k("button"),t.textContent="New side road",o=L(),l=k("div"),M(i.$$.fragment),a=I(`:
  `),s=k("progress"),f=L(),d=k("ol");for(let C=0;C<g.length;C+=1)g[C].c();s.value=c=n[0].side_roads.filter(Rr).length,F(s,"max",u=n[0].side_roads.length),F(s,"class","svelte-zadug4")},m(C,b){y(C,e,b),y(C,r,b),_(r,t),y(C,o,b),y(C,l,b),B(i,l,null),_(l,a),_(l,s),y(C,f,b),y(C,d,b);for(let j=0;j<g.length;j+=1)g[j]&&g[j].m(d,null);p=!0,m||(S=J(t,"click",n[2]),m=!0)},p(C,[b]){const j={};if(b&256&&(j.$$scope={dirty:b,ctx:C}),i.$set(j),(!p||b&1&&c!==(c=C[0].side_roads.filter(Rr).length))&&(s.value=c),(!p||b&1&&u!==(u=C[0].side_roads.length))&&F(s,"max",u),b&3){D=x(C[0].side_roads);let w;for(w=0;w<D.length;w+=1){const z=Pr(C,D,w);g[w]?(g[w].p(z,b),h(g[w],1)):(g[w]=Ur(z),g[w].c(),h(g[w],1),g[w].m(d,null))}for(ae(),w=D.length;w<g.length;w+=1)$(w);ce()}},i(C){if(!p){h(i.$$.fragment,C);for(let b=0;b<D.length;b+=1)h(g[b]);p=!0}},o(C){v(i.$$.fragment,C),g=g.filter(Boolean);for(let b=0;b<g.length;b+=1)v(g[b]);p=!1},d(C){C&&(A(e),A(r),A(o),A(l),A(f),A(d)),E(i),pe(g,C),m=!1,S()}}}const Rr=n=>n.properties.sa01!="";function fc(n,e,r){let t,o;te(n,K,s=>r(0,t=s)),te(n,Z,s=>r(1,o=s));function l(){let s=oo(t.side_roads.length);X(K,t.side_roads=[...t.side_roads,s],t),X(Z,o={kind:"edit-side-road",idx:t.side_roads.length-1},o)}return[t,o,l,()=>X(Z,o={kind:"side-road-questions"},o),s=>X(Z,o={kind:"edit-side-road",idx:s},o)]}class dc extends le{constructor(e){super(),ie(this,e,fc,uc,re,{})}}function pc(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m,S,D,g,$,C,b,j,w,z,N,q,P,V,T,R,H,G,O;return p=new sc({}),g=new Ya({}),j=new Ja({}),q=new Wa({}),R=new dc({}),{c(){e=k("div"),r=k("div"),t=k("button"),t.textContent="Load file",o=L(),l=k("button"),l.textContent="Download",i=L(),a=k("button"),a.textContent="Clear",s=L(),c=k("button"),c.textContent="Draw an entire route",u=L(),f=k("hr"),d=L(),M(p.$$.fragment),m=L(),S=k("hr"),D=L(),M(g.$$.fragment),$=L(),C=k("hr"),b=L(),M(j.$$.fragment),w=L(),z=k("hr"),N=L(),M(q.$$.fragment),P=L(),V=k("hr"),T=L(),M(R.$$.fragment),F(t,"class","secondary"),F(l,"class","secondary"),F(a,"class","secondary"),F(e,"slot","sidebar")},m(U,me){y(U,e,me),_(e,r),_(r,t),_(r,o),_(r,l),_(r,i),_(r,a),_(e,s),_(e,c),_(e,u),_(e,f),_(e,d),B(p,e,null),_(e,m),_(e,S),_(e,D),B(g,e,null),_(e,$),_(e,C),_(e,b),B(j,e,null),_(e,w),_(e,z),_(e,N),B(q,e,null),_(e,P),_(e,V),_(e,T),B(R,e,null),H=!0,G||(O=[J(t,"click",n[12]),J(l,"click",n[13]),J(a,"click",n[5]),J(c,"click",n[6])],G=!0)},p:ee,i(U){H||(h(p.$$.fragment,U),h(g.$$.fragment,U),h(j.$$.fragment,U),h(q.$$.fragment,U),h(R.$$.fragment,U),H=!0)},o(U){v(p.$$.fragment,U),v(g.$$.fragment,U),v(j.$$.fragment,U),v(q.$$.fragment,U),v(R.$$.fragment,U),H=!1},d(U){U&&A(e),E(p),E(g),E(j),E(q),E(R),G=!1,Ae(O)}}}function mc(n){let e,r;return e=new Me({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":kt(6,9)},hoverCursor:"pointer"}}),e.$on("click",n[7]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function _c(n){let e,r;return e=new Ve({props:{manageHoverState:!0,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":5,"circle-stroke-color":["get","color"],"circle-radius":kt(20,25)},hoverCursor:"pointer"}}),e.$on("click",n[8]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function gc(n){let e,r;return e=new tt({props:{manageHoverState:!0,layout:{"icon-image":"bus_stop","icon-size":3},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[9]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function hc(n){let e,r;return e=new tt({props:{manageHoverState:!0,layout:{"icon-image":"crossing","icon-size":.1},paint:{"icon-color":["get","color"]},hoverCursor:"pointer"}}),e.$on("click",n[10]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function bc(n){let e,r;return e=new Me({props:{manageHoverState:!0,paint:{"line-color":["get","color"],"line-width":kt(3,6)},hoverCursor:"pointer"}}),e.$on("click",n[11]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function $c(n){let e,r,t,o,l,i,a,s,c,u,f;return r=new ke({props:{data:de(n[2].links),generateId:!0,$$slots:{default:[mc]},$$scope:{ctx:n}}}),o=new ke({props:{data:de(n[2].jats),generateId:!0,$$slots:{default:[_c]},$$scope:{ctx:n}}}),i=new ke({props:{data:de(n[2].bus_stops),generateId:!0,$$slots:{default:[gc]},$$scope:{ctx:n}}}),s=new ke({props:{data:de(n[2].crossings),generateId:!0,$$slots:{default:[hc]},$$scope:{ctx:n}}}),u=new ke({props:{data:de(n[2].side_roads),generateId:!0,$$slots:{default:[bc]},$$scope:{ctx:n}}}),{c(){e=k("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),l=L(),M(i.$$.fragment),a=L(),M(s.$$.fragment),c=L(),M(u.$$.fragment),F(e,"slot","map")},m(d,p){y(d,e,p),B(r,e,null),_(e,t),B(o,e,null),_(e,l),B(i,e,null),_(e,a),B(s,e,null),_(e,c),B(u,e,null),f=!0},p(d,p){const m={};p&4&&(m.data=de(d[2].links)),p&131080&&(m.$$scope={dirty:p,ctx:d}),r.$set(m);const S={};p&4&&(S.data=de(d[2].jats)),p&131080&&(S.$$scope={dirty:p,ctx:d}),o.$set(S);const D={};p&4&&(D.data=de(d[2].bus_stops)),p&131080&&(D.$$scope={dirty:p,ctx:d}),i.$set(D);const g={};p&4&&(g.data=de(d[2].crossings)),p&131080&&(g.$$scope={dirty:p,ctx:d}),s.$set(g);const $={};p&4&&($.data=de(d[2].side_roads)),p&131080&&($.$$scope={dirty:p,ctx:d}),u.$set($)},i(d){f||(h(r.$$.fragment,d),h(o.$$.fragment,d),h(i.$$.fragment,d),h(s.$$.fragment,d),h(u.$$.fragment,d),f=!0)},o(d){v(r.$$.fragment,d),v(o.$$.fragment,d),v(i.$$.fragment,d),v(s.$$.fragment,d),v(u.$$.fragment,d),f=!1},d(d){d&&A(e),E(r),E(o),E(i),E(s),E(u)}}}function Gr(n){let e,r;return e=new Ut({props:{$$slots:{default:[kc]},$$scope:{ctx:n}}}),e.$on("close",n[15]),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&131074&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function kc(n){let e,r,t,o,l;return{c(){e=k("h1"),e.textContent="Load a file previously downloaded from this tool",r=L(),t=k("input"),F(t,"type","file")},m(i,a){y(i,e,a),y(i,r,a),y(i,t,a),n[14](t),o||(l=J(t,"change",n[4]),o=!0)},p:ee,d(i){i&&(A(e),A(r),A(t)),n[14](null),o=!1,l()}}}function wc(n){let e,r,t,o;e=new Ie({props:{$$slots:{map:[$c],sidebar:[pc]},$$scope:{ctx:n}}});let l=n[0]&&Gr(n);return{c(){M(e.$$.fragment),r=L(),l&&l.c(),t=Pe()},m(i,a){B(e,i,a),y(i,r,a),l&&l.m(i,a),y(i,t,a),o=!0},p(i,[a]){const s={};a&131085&&(s.$$scope={dirty:a,ctx:i}),e.$set(s),i[0]?l?(l.p(i,a),a&1&&h(l,1)):(l=Gr(i),l.c(),h(l,1),l.m(t.parentNode,t)):l&&(ae(),v(l,1,1,()=>{l=null}),ce())},i(i){o||(h(e.$$.fragment,i),h(l),o=!0)},o(i){v(e.$$.fragment,i),v(l),o=!1},d(i){i&&(A(r),A(t)),E(e,i),l&&l.d(i)}}}function vc(n,e,r){let t,o,l;te(n,It,b=>r(16,t=b)),te(n,K,b=>r(2,o=b)),te(n,Z,b=>r(3,l=b));let i=!1,a;async function s(b){try{let j=JSON.parse(await a.files[0].text());if(xr(j)){X(K,o=j,o),r(0,i=!1);return}}catch{}window.alert("Something's wrong with that file")}function c(){X(K,o.links=[],o),X(K,o.jats=[],o),X(K,o.bus_stops=[],o),X(K,o.crossings=[],o),X(K,o.side_roads=[],o)}async function u(){await Ni(t)}const f=b=>X(Z,l={kind:"edit-link",idx:b.detail.features[0].id},l),d=b=>X(Z,l={kind:"edit-jat",idx:b.detail.features[0].id},l),p=b=>X(Z,l={kind:"edit-bus-stop",idx:b.detail.features[0].id},l),m=b=>X(Z,l={kind:"edit-crossing",idx:b.detail.features[0].id},l),S=b=>X(Z,l={kind:"edit-side-road",idx:b.detail.features[0].id},l),D=()=>r(0,i=!0),g=()=>Jl("rcv2.geojson",JSON.stringify(o));function $(b){fe[b?"unshift":"push"](()=>{a=b,r(1,a)})}return[i,a,o,l,s,c,u,f,d,p,m,S,D,g,$,()=>r(0,i=!1)]}class yc extends le{constructor(e){super(),ie(this,e,vc,wc,re,{})}}function Ac(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled bus stop",color:Ge[n%Ge.length],st20:""}}}function Cc(n,e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{name:"Untitled crossing",color:Ge[n%Ge.length],sa10:""}}}function jc(n){let e,r,t,o,l,i,a,s;return{c(){e=k("div"),r=k("h1"),t=I("Click map to create new "),o=I(n[0]),l=L(),i=k("button"),i.textContent="Cancel",F(e,"slot","sidebar")},m(c,u){y(c,e,u),_(e,r),_(r,t),_(r,o),_(e,l),_(e,i),a||(s=J(i,"click",n[3]),a=!0)},p(c,u){u&1&&oe(o,c[0])},d(c){c&&A(e),a=!1,s()}}}function Sc(n){let e,r,t;return r=new Je({props:{except:""}}),{c(){e=k("div"),M(r.$$.fragment),F(e,"slot","map")},m(o,l){y(o,e,l),B(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){v(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function zc(n){let e,r,t,o;return e=new Pt({}),e.$on("click",n[2]),t=new Ie({props:{$$slots:{map:[Sc],sidebar:[jc]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),r=L(),M(t.$$.fragment)},m(l,i){B(e,l,i),y(l,r,i),B(t,l,i),o=!0},p(l,[i]){const a={};i&35&&(a.$$scope={dirty:i,ctx:l}),t.$set(a)},i(l){o||(h(e.$$.fragment,l),h(t.$$.fragment,l),o=!0)},o(l){v(e.$$.fragment,l),v(t.$$.fragment,l),o=!1},d(l){l&&A(r),E(e,l),E(t,l)}}}function Lc(n,e,r){let t,o;te(n,K,s=>r(4,t=s)),te(n,Z,s=>r(1,o=s));let{obj:l}=e;function i(s){let c=s.detail.lngLat.toArray();if(l=="jat"){let u=no(t.jats.length,c);X(K,t.jats=[...t.jats,u],t),X(Z,o={kind:"edit-jat",idx:t.jats.length-1},o)}else if(l=="crossing"){let u=Cc(t.crossings.length,c);X(K,t.crossings=[...t.crossings,u],t),X(Z,o={kind:"edit-crossing",idx:t.crossings.length-1},o)}else if(l=="bus stop"){let u=Ac(t.bus_stops.length,c);X(K,t.bus_stops=[...t.bus_stops,u],t),X(Z,o={kind:"edit-bus-stop",idx:t.bus_stops.length-1},o)}}const a=()=>X(Z,o={kind:"neutral"},o);return n.$$set=s=>{"obj"in s&&r(0,l=s.obj)},[l,o,i,a]}class Mc extends le{constructor(e){super(),ie(this,e,Lc,zc,re,{obj:0})}}const{window:Bc}=st;function Jr(n){let e;return{c(){e=k("p"),e.textContent="A side road needs at least two points"},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Ec(n){let e;return{c(){e=I("SA01: conflict at side roads and priority junctions")},m(r,t){y(r,e,t)},d(r){r&&A(e)}}}function Dc(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m,S,D,g,$,C,b,j,w=!n[2]&&Jr();function z(q){n[10](q)}let N={k:"horiz-radio",choices:Ce(),$$slots:{default:[Ec]},$$scope:{ctx:n}};return n[1].side_roads[n[0]].properties.sa01!==void 0&&(N.value=n[1].side_roads[n[0]].properties.sa01),p=new qe({props:N}),fe.push(()=>_e(p,"value",z)),$=new ct({props:{metric:n[4]}}),{c(){e=k("div"),r=k("button"),t=I("Done"),l=L(),i=k("button"),i.textContent="Delete side road",a=L(),w&&w.c(),s=L(),c=k("label"),u=I(`Name:
      `),f=k("input"),d=L(),M(p.$$.fragment),S=L(),D=k("p"),D.textContent=`${n[4].description}`,g=L(),M($.$$.fragment),r.disabled=o=!n[2],F(f,"type","text"),F(e,"slot","sidebar")},m(q,P){y(q,e,P),_(e,r),_(r,t),_(e,l),_(e,i),_(e,a),w&&w.m(e,null),_(e,s),_(e,c),_(c,u),_(c,f),he(f,n[1].side_roads[n[0]].properties.name),_(e,d),B(p,e,null),_(e,S),_(e,D),_(e,g),B($,e,null),C=!0,b||(j=[J(r,"click",n[8]),J(i,"click",n[6]),J(f,"input",n[9])],b=!0)},p(q,P){(!C||P&4&&o!==(o=!q[2]))&&(r.disabled=o),q[2]?w&&(w.d(1),w=null):w||(w=Jr(),w.c(),w.m(e,s)),P&3&&f.value!==q[1].side_roads[q[0]].properties.name&&he(f,q[1].side_roads[q[0]].properties.name);const V={};P&2048&&(V.$$scope={dirty:P,ctx:q}),!m&&P&3&&(m=!0,V.value=q[1].side_roads[q[0]].properties.sa01,ge(()=>m=!1)),p.$set(V)},i(q){C||(h(p.$$.fragment,q),h($.$$.fragment,q),C=!0)},o(q){v(p.$$.fragment,q),v($.$$.fragment,q),C=!1},d(q){q&&A(e),w&&w.d(),E(p),E($),b=!1,Ae(j)}}}function Tc(n){let e,r;return e=new Me({props:{paint:{"line-color":["case",["==",["id"],n[0]],["get","color"],"black"],"line-width":3}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&1&&(l.paint={"line-color":["case",["==",["id"],t[0]],["get","color"],"black"],"line-width":3}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Nc(n){let e,r,t,o,l,i,a,s;r=new Je({props:{except:"side_roads"}}),o=new ke({props:{data:de(n[1].side_roads),generateId:!0,$$slots:{default:[Tc]},$$scope:{ctx:n}}});function c(f){n[7](f)}let u={};return n[1].side_roads[n[0]]!==void 0&&(u.f=n[1].side_roads[n[0]]),i=new ao({props:u}),fe.push(()=>_e(i,"f",c)),{c(){e=k("div"),M(r.$$.fragment),t=L(),M(o.$$.fragment),l=L(),M(i.$$.fragment),F(e,"slot","map")},m(f,d){y(f,e,d),B(r,e,null),_(e,t),B(o,e,null),_(e,l),B(i,e,null),s=!0},p(f,d){const p={};d&2&&(p.data=de(f[1].side_roads)),d&2049&&(p.$$scope={dirty:d,ctx:f}),o.$set(p);const m={};!a&&d&3&&(a=!0,m.f=f[1].side_roads[f[0]],ge(()=>a=!1)),i.$set(m)},i(f){s||(h(r.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),s=!0)},o(f){v(r.$$.fragment,f),v(o.$$.fragment,f),v(i.$$.fragment,f),s=!1},d(f){f&&A(e),E(r),E(o),E(i)}}}function Ic(n){let e,r,t,o;return e=new Ie({props:{$$slots:{map:[Nc],sidebar:[Dc]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0,t||(o=J(Bc,"keydown",n[5]),t=!0)},p(l,[i]){const a={};i&2063&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function Oc(n,e,r){let t,o,l;te(n,K,m=>r(1,o=m)),te(n,Z,m=>r(3,l=m));let{idx:i}=e,a=Xe.SA01;function s(m){m.key=="Escape"&&X(Z,l={kind:"neutral"},l)}async function c(){window.confirm("Really delete this side road?")&&(X(Z,l={kind:"neutral"},l),await et(),o.side_roads.splice(i,1),K.set(o))}function u(m){n.$$.not_equal(o.side_roads[i],m)&&(o.side_roads[i]=m,K.set(o))}const f=()=>X(Z,l={kind:"neutral"},l);function d(){o.side_roads[i].properties.name=this.value,K.set(o)}function p(m){n.$$.not_equal(o.side_roads[i].properties.sa01,m)&&(o.side_roads[i].properties.sa01=m,K.set(o))}return n.$$set=m=>{"idx"in m&&r(0,i=m.idx)},n.$$.update=()=>{n.$$.dirty&3&&r(2,t=o.side_roads[i].geometry.coordinates.length>=2)},[i,o,t,l,a,s,c,u,f,d,p]}class Fc extends le{constructor(e){super(),ie(this,e,Oc,Ic,re,{idx:0})}}function Qr(n,e,r){const t=n.slice();return t[6]=e[r],t[7]=e,t[8]=r,t}function Hr(n){let e,r,t=n[6].properties.name+"",o,l,i,a,s,c;function u(d){n[5](d,n[6])}let f={k:"horiz-radio",choices:Ce()};return n[6].properties.sa01!==void 0&&(f.value=n[6].properties.sa01),i=new qe({props:f}),fe.push(()=>_e(i,"value",u)),{c(){e=k("li"),r=k("span"),o=I(t),l=L(),M(i.$$.fragment),s=L(),Y(r,"color",n[6].properties.color)},m(d,p){y(d,e,p),_(e,r),_(r,o),_(e,l),B(i,e,null),_(e,s),c=!0},p(d,p){n=d,(!c||p&2)&&t!==(t=n[6].properties.name+"")&&oe(o,t),p&2&&Y(r,"color",n[6].properties.color);const m={};!a&&p&2&&(a=!0,m.value=n[6].properties.sa01,ge(()=>a=!1)),i.$set(m)},i(d){c||(h(i.$$.fragment,d),c=!0)},o(d){v(i.$$.fragment,d),c=!1},d(d){d&&A(e),E(i)}}}function qc(n){let e,r,t,o,l,i,a,s,c,u,f,d,p,m=x(n[1].side_roads),S=[];for(let g=0;g<m.length;g+=1)S[g]=Hr(Qr(n,m,g));const D=g=>v(S[g],1,1,()=>{S[g]=null});return u=new ct({props:{metric:n[2]}}),{c(){e=k("div"),r=k("button"),r.textContent="Done",t=L(),o=k("h2"),o.textContent="SA01: Conflict at Side ROads and Priority Junctions",l=L(),i=k("p"),i.textContent=`${n[2].description}`,a=L(),s=k("ol");for(let g=0;g<S.length;g+=1)S[g].c();c=L(),M(u.$$.fragment),F(e,"slot","sidebar")},m(g,$){y(g,e,$),_(e,r),_(e,t),_(e,o),_(e,l),_(e,i),_(e,a),_(e,s);for(let C=0;C<S.length;C+=1)S[C]&&S[C].m(s,null);_(e,c),B(u,e,null),f=!0,d||(p=J(r,"click",n[4]),d=!0)},p(g,$){if($&2){m=x(g[1].side_roads);let C;for(C=0;C<m.length;C+=1){const b=Qr(g,m,C);S[C]?(S[C].p(b,$),h(S[C],1)):(S[C]=Hr(b),S[C].c(),h(S[C],1),S[C].m(s,null))}for(ae(),C=m.length;C<S.length;C+=1)D(C);ce()}},i(g){if(!f){for(let $=0;$<m.length;$+=1)h(S[$]);h(u.$$.fragment,g),f=!0}},o(g){S=S.filter(Boolean);for(let $=0;$<S.length;$+=1)v(S[$]);v(u.$$.fragment,g),f=!1},d(g){g&&A(e),pe(S,g),E(u),d=!1,p()}}}function Pc(n){let e,r,t;return r=new Je({props:{showColor:"side_roads",except:""}}),{c(){e=k("div"),M(r.$$.fragment),F(e,"slot","map")},m(o,l){y(o,e,l),B(r,e,null),t=!0},p:ee,i(o){t||(h(r.$$.fragment,o),t=!0)},o(o){v(r.$$.fragment,o),t=!1},d(o){o&&A(e),E(r)}}}function Uc(n){let e,r,t,o;return e=new Ie({props:{$$slots:{map:[Pc],sidebar:[qc]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(l,i){B(e,l,i),r=!0,t||(o=J(window,"keydown",n[3]),t=!0)},p(l,[i]){const a={};i&515&&(a.$$scope={dirty:i,ctx:l}),e.$set(a)},i(l){r||(h(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){E(e,l),t=!1,o()}}}function Rc(n,e,r){let t,o;te(n,Z,c=>r(0,t=c)),te(n,K,c=>r(1,o=c));let l=Xe.SA01;function i(c){c.key=="Escape"&&X(Z,t={kind:"neutral"},t)}const a=()=>X(Z,t={kind:"neutral"},t);function s(c,u){n.$$.not_equal(u.properties.sa01,c)&&(u.properties.sa01=c,K.set(o))}return[t,o,l,i,a,s]}class Gc extends le{constructor(e){super(),ie(this,e,Rc,Uc,re,{})}}function Jc(n){let e,r;return{c(){e=k("div"),r=k("div"),F(e,"slot","left")},m(t,o){y(t,e,o),_(e,r),n[10](r)},p:ee,d(t){t&&A(e),n[10](null)}}}function Qc(n){return{c:ee,m:ee,p:ee,i:ee,o:ee,d:ee}}function Hc(n){let e,r,t;function o(i){n[9](i)}let l={style:n[11],standardControls:!0,hash:!0,images:[{id:"bus_stop",url:Vr,options:{sdf:!0}},{id:"crossing",url:Yr,options:{sdf:!0}}],$$slots:{default:[lu]},$$scope:{ctx:n}};return n[2]!==void 0&&(l.map=n[2]),e=new Fo({props:l}),fe.push(()=>_e(e,"map",o)),{c(){M(e.$$.fragment)},m(i,a){B(e,i,a),t=!0},p(i,a){const s={};a&4110&&(s.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,s.map=i[2],ge(()=>r=!1)),e.$set(s)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){v(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Kc(n){let e,r;return e=new Zi({props:{map:n[2],editingExisting:!1,finish:Ii,cancel:n[8]}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&4&&(l.map=t[2]),o&8&&(l.cancel=t[8]),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Wc(n){let e,r;return e=new kl({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Zc(n){let e,r;return e=new Gc({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Xc(n){let e,r;return e=new Oa({props:{qIdx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.qIdx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Vc(n){let e,r;return e=new Fc({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Yc(n){let e,r;return e=new bi({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function xc(n){let e,r;return e=new El({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function eu(n){let e,r;return e=new ua({props:{junctionIdx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.junctionIdx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function tu(n){let e,r;return e=new ha({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function nu(n){let e,r;return e=new Ma({props:{idx:n[3].idx}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.idx=t[3].idx),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ru(n){let e,r;return e=new Mc({props:{obj:n[3].obj}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,o){const l={};o&8&&(l.obj=t[3].obj),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function ou(n){let e,r;return e=new yc({}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p:ee,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function lu(n){let e,r,t,o,l,i,a;const s=[ou,ru,nu,tu,eu,xc,Yc,Vc,Xc,Zc,Wc,Kc],c=[];function u(f,d){return f[3].kind=="neutral"?0:f[3].kind=="new-point"?1:f[3].kind=="edit-link"?2:f[3].kind=="edit-jat"?3:f[3].kind=="edit-jat-detail"?4:f[3].kind=="edit-bus-stop"?5:f[3].kind=="edit-crossing"?6:f[3].kind=="edit-side-road"?7:f[3].kind=="link-questions"?8:f[3].kind=="side-road-questions"?9:f[3].kind=="bus-stop-questions"?10:f[3].kind=="draw-route"&&f[2]?11:-1}return~(t=u(n))&&(o=c[t]=s[t](n)),i=new ci({}),{c(){e=k("div"),r=L(),o&&o.c(),l=L(),M(i.$$.fragment)},m(f,d){y(f,e,d),n[7](e),y(f,r,d),~t&&c[t].m(f,d),y(f,l,d),B(i,f,d),a=!0},p(f,d){let p=t;t=u(f),t===p?~t&&c[t].p(f,d):(o&&(ae(),v(c[p],1,1,()=>{c[p]=null}),ce()),~t?(o=c[t],o?o.p(f,d):(o=c[t]=s[t](f),o.c()),h(o,1),o.m(l.parentNode,l)):o=null)},i(f){a||(h(o),h(i.$$.fragment,f),a=!0)},o(f){v(o),v(i.$$.fragment,f),a=!1},d(f){f&&(A(e),A(r),A(l)),n[7](null),~t&&c[t].d(f),E(i,f)}}}function iu(n){return{c:ee,m:ee,p:ee,i:ee,o:ee,d:ee}}function su(n){let e,r,t={ctx:n,current:null,token:null,hasCatch:!1,pending:iu,then:Hc,catch:Qc,value:11,blocks:[,,,]};return qo(Xi(new URLSearchParams(window.location.search).get("google")||""),t),{c(){e=k("div"),t.block.c(),F(e,"slot","main"),Y(e,"position","relative"),Y(e,"width","100%"),Y(e,"height","100vh")},m(o,l){y(o,e,l),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,r=!0},p(o,l){n=o,Po(t,n,l)},i(o){r||(h(t.block),r=!0)},o(o){for(let l=0;l<3;l+=1){const i=t.blocks[l];v(i)}r=!1},d(o){o&&A(e),t.block.d(),t.token=null,t=null}}}function au(n){let e,r;return e=new Oo({props:{$$slots:{main:[su],left:[Jc]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},m(t,o){B(e,t,o),r=!0},p(t,[o]){const l={};o&4111&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function cu(n,e,r){let t,o,l,i,a;te(n,Vt,m=>r(4,t=m)),te(n,Xt,m=>r(5,o=m)),te(n,K,m=>r(6,l=m)),te(n,It,m=>r(2,i=m)),te(n,Z,m=>r(3,a=m));let s,c;function u(m){fe[m?"unshift":"push"](()=>{c=m,r(1,c),r(4,t)})}const f=()=>X(Z,a={kind:"neutral"},a);function d(m){i=m,It.set(i)}function p(m){fe[m?"unshift":"push"](()=>{s=m,r(0,s),r(5,o)})}return n.$$.update=()=>{n.$$.dirty&64&&window.localStorage.setItem("tmp-rcv2",JSON.stringify(l)),n.$$.dirty&33&&s&&o&&(r(0,s.innerHTML="",s),s.appendChild(o)),n.$$.dirty&18&&c&&t&&(r(1,c.innerHTML="",c),c.appendChild(t))},[s,c,i,a,t,o,l,u,f,d,p]}class uu extends le{constructor(e){super(),ie(this,e,cu,au,re,{})}}new uu({target:document.getElementById("app")});
